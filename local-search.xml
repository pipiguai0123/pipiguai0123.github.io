<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>K8så¸¸è§æ•…éšœè§£å†³æ–¹æ³•</title>
    <link href="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/"/>
    <url>/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="K8så¸¸è§æ•…éšœè§£å†³æ–¹æ³•"><a href="#K8så¸¸è§æ•…éšœè§£å†³æ–¹æ³•" class="headerlink" title="K8så¸¸è§æ•…éšœè§£å†³æ–¹æ³•"></a>K8så¸¸è§æ•…éšœè§£å†³æ–¹æ³•</h1><p>åŸæ–‡ğŸ”—ï¼š<a href="https://www.cnblogs.com/chalon/p/14415252.html">https://www.cnblogs.com/chalon/p/14415252.html</a></p><h2 id="é—®é¢˜1ï¼šK8Sé›†ç¾¤æœåŠ¡è®¿é—®å¤±è´¥ï¼Ÿ"><a href="#é—®é¢˜1ï¼šK8Sé›†ç¾¤æœåŠ¡è®¿é—®å¤±è´¥ï¼Ÿ" class="headerlink" title="é—®é¢˜1ï¼šK8Sé›†ç¾¤æœåŠ¡è®¿é—®å¤±è´¥ï¼Ÿ"></a>é—®é¢˜1ï¼šK8Sé›†ç¾¤æœåŠ¡è®¿é—®å¤±è´¥ï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210603104322054-411822980.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210603104344862-437503062.png" alt="img"></p><p>åŸå› åˆ†æï¼šè¯ä¹¦ä¸èƒ½è¢«è¯†åˆ«ï¼Œå…¶åŸå› ä¸ºï¼šè‡ªå®šä¹‰è¯ä¹¦ï¼Œè¿‡æœŸç­‰ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šæ›´æ–°è¯ä¹¦å³å¯ã€‚</p><h2 id="é—®é¢˜2ï¼šK8Sé›†ç¾¤æœåŠ¡è®¿é—®å¤±è´¥ï¼Ÿ"><a href="#é—®é¢˜2ï¼šK8Sé›†ç¾¤æœåŠ¡è®¿é—®å¤±è´¥ï¼Ÿ" class="headerlink" title="é—®é¢˜2ï¼šK8Sé›†ç¾¤æœåŠ¡è®¿é—®å¤±è´¥ï¼Ÿ"></a>é—®é¢˜2ï¼šK8Sé›†ç¾¤æœåŠ¡è®¿é—®å¤±è´¥ï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210603105044708-1737680663.png" alt="img"></p><p>curl: (7) Failed connect to 10.103.22.158:3000; Connection refused</p><p>åŸå› åˆ†æï¼šç«¯å£æ˜ å°„é”™è¯¯ï¼ŒæœåŠ¡æ­£å¸¸å·¥ä½œï¼Œä½†ä¸èƒ½æä¾›æœåŠ¡ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šåˆ é™¤svcï¼Œé‡æ–°æ˜ å°„ç«¯å£å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl delete svc nginx-deployment<br></code></pre></td></tr></table></figure><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210603122454382-1766701516.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210603122652066-1288164700.png" alt="img"></p><h2 id="é—®é¢˜3ï¼šK8Sé›†ç¾¤æœåŠ¡æš´éœ²å¤±è´¥ï¼Ÿ"><a href="#é—®é¢˜3ï¼šK8Sé›†ç¾¤æœåŠ¡æš´éœ²å¤±è´¥ï¼Ÿ" class="headerlink" title="é—®é¢˜3ï¼šK8Sé›†ç¾¤æœåŠ¡æš´éœ²å¤±è´¥ï¼Ÿ"></a>é—®é¢˜3ï¼šK8Sé›†ç¾¤æœåŠ¡æš´éœ²å¤±è´¥ï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210603111123847-1730917423.png" alt="img"></p><p>Error from server (AlreadyExists): services â€œnginx-deploymentâ€ already exists</p><p>åŸå› åˆ†æï¼šè¯¥å®¹å™¨å·²æš´éœ²æœåŠ¡äº†ã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210603111239103-1497174416.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210603111220362-852021078.png" alt="img"></p><p>è§£å†³æ–¹æ³•ï¼šåˆ é™¤svcï¼Œé‡æ–°æ˜ å°„ç«¯å£å³å¯ã€‚</p><h2 id="é—®é¢˜4ï¼šå¤–ç½‘æ— æ³•è®¿é—®K8Sé›†ç¾¤æä¾›çš„æœåŠ¡ï¼Ÿ"><a href="#é—®é¢˜4ï¼šå¤–ç½‘æ— æ³•è®¿é—®K8Sé›†ç¾¤æä¾›çš„æœåŠ¡ï¼Ÿ" class="headerlink" title="é—®é¢˜4ï¼šå¤–ç½‘æ— æ³•è®¿é—®K8Sé›†ç¾¤æä¾›çš„æœåŠ¡ï¼Ÿ"></a>é—®é¢˜4ï¼šå¤–ç½‘æ— æ³•è®¿é—®K8Sé›†ç¾¤æä¾›çš„æœåŠ¡ï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210603123538080-142331168.png" alt="img"></p><p>åŸå› åˆ†æï¼šK8Sé›†ç¾¤çš„typeä¸ºClusterIPï¼Œæœªå°†æœåŠ¡æš´éœ²è‡³å¤–ç½‘ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šä¿®æ”¹K8Sé›†ç¾¤çš„typeä¸ºNodePortå³å¯ï¼Œäºæ˜¯å¯é€šè¿‡æ‰€æœ‰K8Sé›†ç¾¤èŠ‚ç‚¹è®¿é—®æœåŠ¡ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl edit svc nginx-deployment<br></code></pre></td></tr></table></figure><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210603123956011-84144343.png" alt="img"></p><h2 id="é—®é¢˜5ï¼špodçŠ¶æ€ä¸ºErrImagePullï¼Ÿ"><a href="#é—®é¢˜5ï¼špodçŠ¶æ€ä¸ºErrImagePullï¼Ÿ" class="headerlink" title="é—®é¢˜5ï¼špodçŠ¶æ€ä¸ºErrImagePullï¼Ÿ"></a>é—®é¢˜5ï¼špodçŠ¶æ€ä¸ºErrImagePullï¼Ÿ</h2><p> readiness-httpget-pod  0&#x2F;1   ErrImagePull  0     10s</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210609111855527-1561009834.png" alt="img"></p><p>åŸå› åˆ†æï¼šimageæ— æ³•æ‹‰å–ï¼›</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210609111921747-76967801.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210609112056358-1704997375.png" alt="img"></p><p> Warning Failed 59m (x4 over 61m) kubelet, k8s-node01 Error: ErrImagePull</p><p>è§£å†³æ–¹æ³•ï¼šæ›´æ¢é•œåƒå³å¯ã€‚</p><h2 id="é—®é¢˜6ï¼šåˆ›å»ºinit-Cå®¹å™¨åï¼Œå…¶çŠ¶æ€ä¸æ­£å¸¸ï¼Ÿ"><a href="#é—®é¢˜6ï¼šåˆ›å»ºinit-Cå®¹å™¨åï¼Œå…¶çŠ¶æ€ä¸æ­£å¸¸ï¼Ÿ" class="headerlink" title="é—®é¢˜6ï¼šåˆ›å»ºinit Cå®¹å™¨åï¼Œå…¶çŠ¶æ€ä¸æ­£å¸¸ï¼Ÿ"></a>é—®é¢˜6ï¼šåˆ›å»ºinit Cå®¹å™¨åï¼Œå…¶çŠ¶æ€ä¸æ­£å¸¸ï¼Ÿ</h2><p>NAME READY STATUS RESTARTS AGE<br>myapp-pod 0&#x2F;1 Init:0&#x2F;2 0 20s</p><p>åŸå› åˆ†æï¼šæŸ¥çœ‹æ—¥å¿—å‘ç°ï¼Œpodä¸€ç›´å‡ºäºåˆå§‹åŒ–ä¸­ï¼›ç„¶åæŸ¥çœ‹podè¯¦ç»†ä¿¡æ¯ï¼Œå®šä½podåˆ›å»ºå¤±è´¥çš„åŸå› ä¸ºï¼šåˆå§‹åŒ–å®¹å™¨æœªæ‰§è¡Œå®Œæ¯•ã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210608142139646-2015534421.png" alt="img"></p><p> Error from server (BadRequest): container â€œmyapp-containerâ€ in pod â€œmyapp-podâ€ is waiting to start: PodInitializing</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210608141834587-828337105.png" alt="img"></p><p> <img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210608141907458-1152976452.png" alt="img"></p><p> <img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210608142357313-1045982108.png" alt="img"></p><p>è§£å†³æ–¹æ³•ï¼šåˆ›å»ºç›¸å…³serviceï¼Œå°†SVCçš„nameå†™å…¥K8Sé›†ç¾¤çš„coreDNSæœåŠ¡å™¨ä¸­ï¼Œäºæ˜¯coreDNSå°±èƒ½å¯¹PODçš„initCå®¹å™¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„åŸŸåè§£æäº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sg">kubectl apply -f myservice.yaml<br></code></pre></td></tr></table></figure><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210608143516835-51702057.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210608143529358-1445097125.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210608143743700-2132332485.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210608145508975-1757531963.png" alt="img"></p><h2 id="é—®é¢˜7ï¼šæ¢æµ‹å­˜æ´»podçŠ¶æ€ä¸ºCrashLoopBackOffï¼Ÿ"><a href="#é—®é¢˜7ï¼šæ¢æµ‹å­˜æ´»podçŠ¶æ€ä¸ºCrashLoopBackOffï¼Ÿ" class="headerlink" title="é—®é¢˜7ï¼šæ¢æµ‹å­˜æ´»podçŠ¶æ€ä¸ºCrashLoopBackOffï¼Ÿ"></a>é—®é¢˜7ï¼šæ¢æµ‹å­˜æ´»podçŠ¶æ€ä¸ºCrashLoopBackOffï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210611154104880-82982759.png" alt="img"></p><p>åŸå› åˆ†æï¼šé•œåƒé—®é¢˜ï¼Œå¯¼è‡´å®¹å™¨é‡å¯å¤±è´¥ã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210611153121868-358978531.png" alt="img"></p><p>è§£å†³æ–¹æ³•ï¼šæ›´æ¢é•œåƒå³å¯ã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210611155102173-1536637770.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210611155032150-1121427176.png" alt="img"></p><h2 id="é—®é¢˜8ï¼šPODåˆ›å»ºå¤±è´¥ï¼Ÿ"><a href="#é—®é¢˜8ï¼šPODåˆ›å»ºå¤±è´¥ï¼Ÿ" class="headerlink" title="é—®é¢˜8ï¼šPODåˆ›å»ºå¤±è´¥ï¼Ÿ"></a>é—®é¢˜8ï¼šPODåˆ›å»ºå¤±è´¥ï¼Ÿ</h2><p>åŸå› åˆ†æï¼šé•œåƒé—®é¢˜å¯¼è‡´å®¹å™¨æ— æ³•å¯åŠ¨ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@k8s-master01 ~]<span class="hljs-comment"># kubectl logs readiness-httpget-pod</span><br>url.js:106<br>throw new errors.TypeError(<span class="hljs-string">&#x27;ERR_INVALID_ARG_TYPE&#x27;</span>, <span class="hljs-string">&#x27;url&#x27;</span>, <span class="hljs-string">&#x27;string&#x27;</span>, url);<br>^<br><br>TypeError [ERR_INVALID_ARG_TYPE]: The <span class="hljs-string">&quot;url&quot;</span> argument must be of <span class="hljs-built_in">type</span> string. Received <span class="hljs-built_in">type</span> undefined<br>at Url.parse (url.js:106:11)<br>at Object.urlParse [as parse] (url.js:100:13)<br>at module.exports (/myapp/node_modules/mongodb/lib/url_parser.js:17:23)<br>at connect (/myapp/node_modules/mongodb/lib/mongo_client.js:159:16)<br>at Function.MongoClient.connect (/myapp/node_modules/mongodb/lib/mongo_client.js:110:3)<br>at Object.&lt;anonymous&gt; (/myapp/app.js:12:13)<br>at Module._compile (module.js:641:30)<br>at Object.Module._extensions..js (module.js:652:10)<br>at Module.load (module.js:560:32)<br>at tryModuleLoad (module.js:503:12)<br>at Function.Module._load (module.js:495:3)<br>at Function.Module.runMain (module.js:682:10)<br>at startup (bootstrap_node.js:191:16)<br>at bootstrap_node.js:613:3<br></code></pre></td></tr></table></figure><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210611155933220-1626419175.png" alt="img"></p><p>è§£å†³æ–¹æ³•ï¼šæ›´æ¢é•œåƒã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210611160715287-1013020495.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210611160654971-1535070994.png" alt="img"></p><h2 id="é—®é¢˜9ï¼šPODçš„readyçŠ¶æ€æœªè¿›å…¥ï¼Ÿ"><a href="#é—®é¢˜9ï¼šPODçš„readyçŠ¶æ€æœªè¿›å…¥ï¼Ÿ" class="headerlink" title="é—®é¢˜9ï¼šPODçš„readyçŠ¶æ€æœªè¿›å…¥ï¼Ÿ"></a>é—®é¢˜9ï¼šPODçš„readyçŠ¶æ€æœªè¿›å…¥ï¼Ÿ</h2><p>readiness-httpget-pod  0&#x2F;1   Running  0     116s</p><p>åŸå› åˆ†æï¼šPODçš„æ‰§è¡Œå‘½ä»¤å¤±è´¥ï¼Œæ— æ³•è·å–èµ„æºã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210611161118476-2133736578.png" alt="img"></p><p>è§£å†³æ–¹æ³•ï¼šè¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œåˆ›å»ºyamlå®šä¹‰çš„èµ„æº</p><p><em><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210611163546862-1553169573.png" alt="img"></em></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210611163604060-258577761.png" alt="img"></p><h2 id="é—®é¢˜10ï¼špodåˆ›å»ºå¤±è´¥ï¼Ÿ"><a href="#é—®é¢˜10ï¼špodåˆ›å»ºå¤±è´¥ï¼Ÿ" class="headerlink" title="é—®é¢˜10ï¼špodåˆ›å»ºå¤±è´¥ï¼Ÿ"></a>é—®é¢˜10ï¼špodåˆ›å»ºå¤±è´¥ï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210624102404105-704505228.png" alt="img"></p><p>åŸå› åˆ†æï¼šymlæ–‡ä»¶å†…å®¹å‡ºé”™â€”ä½¿ç”¨ä¸­æ–‡å­—ç¬¦ï¼›</p><p>è§£å†³æ–¹æ³•ï¼šä¿®æ”¹myregistrykeyå†…å®¹å³å¯ã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210624105624772-504456968.png" alt="img"></p><h2 id="é—®é¢˜11ã€kube-flannel-ds-amd64-ndsf7æ’ä»¶podçš„statusä¸ºInit-0-x2F-1ï¼Ÿ"><a href="#é—®é¢˜11ã€kube-flannel-ds-amd64-ndsf7æ’ä»¶podçš„statusä¸ºInit-0-x2F-1ï¼Ÿ" class="headerlink" title="é—®é¢˜11ã€kube-flannel-ds-amd64-ndsf7æ’ä»¶podçš„statusä¸ºInit:0&#x2F;1ï¼Ÿ"></a>é—®é¢˜11ã€kube-flannel-ds-amd64-ndsf7æ’ä»¶podçš„statusä¸ºInit:0&#x2F;1ï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210219105458263-1617541950.png" alt="img"></p><p> æ’æŸ¥æ€è·¯ï¼škubectl -n kube-system describe pod kube-flannel-ds-amd64-ndsf7 #æŸ¥è¯¢podæè¿°ä¿¡æ¯ï¼›</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210219105646263-1373412665.png" alt="img"></p><p>åŸå› åˆ†æï¼šk8s-slave1èŠ‚ç‚¹æ‹‰å–é•œåƒå¤±è´¥ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šç™»å½•k8s-slave1ï¼Œé‡å¯dockeræœåŠ¡ï¼Œæ‰‹åŠ¨æ‹‰å–é•œåƒã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210219112357117-362606443.png" alt="img"></p><p>k8s-masterèŠ‚ç‚¹ï¼Œé‡æ–°å®‰è£…æ’ä»¶å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl create -f kube-flannel.yml;kubectl get nodes<br></code></pre></td></tr></table></figure><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210219112507651-116731499.png" alt="img"></p><h2 id="é—®é¢˜12ã€K8Såˆ›å»ºæœåŠ¡statusä¸ºErrImagePullï¼Ÿ"><a href="#é—®é¢˜12ã€K8Såˆ›å»ºæœåŠ¡statusä¸ºErrImagePullï¼Ÿ" class="headerlink" title="é—®é¢˜12ã€K8Såˆ›å»ºæœåŠ¡statusä¸ºErrImagePullï¼Ÿ"></a>é—®é¢˜12ã€K8Såˆ›å»ºæœåŠ¡statusä¸ºErrImagePullï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210219113310917-478327760.png" alt="img"></p><p>æ’æŸ¥æ€è·¯ï¼škubectl describe pod test-nginx</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210219113604736-125404248.png" alt="img"></p><p>åŸå› åˆ†æï¼šæ‹‰å–é•œåƒåç§°é—®é¢˜ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šåˆ é™¤é”™è¯¯podï¼›é‡æ–°æ‹‰å–é•œåƒï¼›</p><p>kubectl delete pod test-nginx;kubectl run test-nginx â€“image&#x3D;10.0.0.81:5000&#x2F;nginx:alpine</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210219114452861-657767230.png" alt="img"></p><h2 id="é—®é¢˜13ã€ä¸èƒ½è¿›å…¥æŒ‡å®šå®¹å™¨å†…éƒ¨ï¼Ÿ"><a href="#é—®é¢˜13ã€ä¸èƒ½è¿›å…¥æŒ‡å®šå®¹å™¨å†…éƒ¨ï¼Ÿ" class="headerlink" title="é—®é¢˜13ã€ä¸èƒ½è¿›å…¥æŒ‡å®šå®¹å™¨å†…éƒ¨ï¼Ÿ"></a>é—®é¢˜13ã€ä¸èƒ½è¿›å…¥æŒ‡å®šå®¹å™¨å†…éƒ¨ï¼Ÿ</h2><p>Error from server (BadRequest): container volume-test-container is not valid for pod volume-test-pod</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210624135341043-415174052.png" alt="img"></p><p> åŸå› åˆ†æï¼šymlæ–‡ä»¶comtainerså­—æ®µé‡å¤ï¼Œå¯¼è‡´è¯¥podæ²¡æœ‰è¯¥å®¹å™¨ã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210624135659659-1654041649.png" alt="img"> <img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210624135717240-2062172087.png" alt="img"></p><p> <img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210624135958216-1463656156.png" alt="img"></p><p> è§£å†³æ–¹æ³•ï¼šå»æ‰ymlæ–‡ä»¶ä¸­å¤šä½™çš„containerså­—æ®µï¼Œé‡æ–°ç”Ÿæˆpodã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210624140430692-1813759677.png" alt="img"></p><p> <img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210624140544838-1223478937.png" alt="img"></p><h2 id="é—®é¢˜14ã€åˆ›å»ºPVå¤±è´¥ï¼Ÿ"><a href="#é—®é¢˜14ã€åˆ›å»ºPVå¤±è´¥ï¼Ÿ" class="headerlink" title="é—®é¢˜14ã€åˆ›å»ºPVå¤±è´¥ï¼Ÿ"></a>é—®é¢˜14ã€åˆ›å»ºPVå¤±è´¥ï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210625095834663-1316004106.png" alt="img"></p><p> åŸå› åˆ†æï¼špvçš„nameå­—æ®µé‡å¤ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šä¿®æ”¹pvçš„nameå­—æ®µå³å¯ã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210625095942938-422508268.png" alt="img"></p><h2 id="é—®é¢˜15ã€podæ— æ³•æŒ‚è½½PVCï¼Ÿ"><a href="#é—®é¢˜15ã€podæ— æ³•æŒ‚è½½PVCï¼Ÿ" class="headerlink" title="é—®é¢˜15ã€podæ— æ³•æŒ‚è½½PVCï¼Ÿ"></a>é—®é¢˜15ã€podæ— æ³•æŒ‚è½½PVCï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210625101452262-920564710.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210625101435371-442855016.png" alt="img"></p><p> åŸå› åˆ†æï¼špodæ— æ³•æŒ‚è½½PVCã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210625103917835-653085243.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210625101745179-1317079111.png" alt="img"></p><p>accessModesä¸å¯ä½¿ç”¨çš„PVä¸ä¸€è‡´ï¼Œå¯¼è‡´æ— æ³•æŒ‚è½½PVCï¼Œç”±äºåªèƒ½æŒ‚è½½å¤§äº1Gä¸”accessModesä¸ºRWOçš„PVï¼Œæ•…åªèƒ½æˆåŠŸåˆ›å»º1ä¸ªpodï¼Œç¬¬2ä¸ªpodä¸€è‡´pendingï¼ŒæŒ‰åºåˆ›å»ºæ—¶åˆ™ç¬¬3ä¸ªpodä¸€ç›´æœªè¢«åˆ›å»ºï¼›</p><p>è§£å†³æ–¹æ³•ï¼šä¿®æ”¹ymlæ–‡ä»¶ä¸­accessModesæˆ–PVçš„accessModeså³å¯ã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210625105130441-757342407.png" alt="img"></p><h2 id="é—®é¢˜16ã€é—®é¢˜ï¼špodä½¿ç”¨PVåï¼Œæ— æ³•è®¿é—®å…¶å†…å®¹ï¼Ÿ"><a href="#é—®é¢˜16ã€é—®é¢˜ï¼špodä½¿ç”¨PVåï¼Œæ— æ³•è®¿é—®å…¶å†…å®¹ï¼Ÿ" class="headerlink" title="é—®é¢˜16ã€é—®é¢˜ï¼špodä½¿ç”¨PVåï¼Œæ— æ³•è®¿é—®å…¶å†…å®¹ï¼Ÿ"></a>é—®é¢˜16ã€é—®é¢˜ï¼špodä½¿ç”¨PVåï¼Œæ— æ³•è®¿é—®å…¶å†…å®¹ï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210625113835452-1904340625.png" alt="img"></p><p> åŸå› åˆ†æï¼šnfså·ä¸­æ²¡æœ‰æ–‡ä»¶æˆ–æƒé™ä¸å¯¹ã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210625114032336-1008503957.png" alt="img"></p><p> <img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210625114018810-1389908339.png" alt="img"></p><p> è§£å†³æ–¹æ³•ï¼šåœ¨nfså·ä¸­åˆ›å»ºæ–‡ä»¶å¹¶æˆäºˆæƒé™ã€‚</p><p> <img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210625114555727-1428567866.png" alt="img"></p><p> <img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210625114653101-898239459.png" alt="img"></p><h2 id="é—®é¢˜17ã€æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€å¤±è´¥ï¼Ÿ"><a href="#é—®é¢˜17ã€æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€å¤±è´¥ï¼Ÿ" class="headerlink" title="é—®é¢˜17ã€æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€å¤±è´¥ï¼Ÿ"></a>é—®é¢˜17ã€æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€å¤±è´¥ï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210628091707454-1294021117.png" alt="img"></p><p>åŸå› åˆ†æï¼šæ²¡æœ‰heapsteræœåŠ¡ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šå®‰è£…promethusç›‘æ§ç»„ä»¶å³å¯ã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210628110841093-816405284.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210628110856426-578465221.png" alt="img"></p><h2 id="é—®é¢˜18ã€podä¸€ç›´å¤„äºpendingâ€™çŠ¶æ€ï¼Ÿ"><a href="#é—®é¢˜18ã€podä¸€ç›´å¤„äºpendingâ€™çŠ¶æ€ï¼Ÿ" class="headerlink" title="é—®é¢˜18ã€podä¸€ç›´å¤„äºpendingâ€™çŠ¶æ€ï¼Ÿ"></a>é—®é¢˜18ã€podä¸€ç›´å¤„äºpendingâ€™çŠ¶æ€ï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210629151950882-422456884.png" alt="img"></p><p> åŸå› åˆ†æï¼šç”±äºå·²ä½¿ç”¨åŒæ ·é•œåƒå‘å¸ƒäº†podï¼Œå¯¼è‡´æ— èŠ‚ç‚¹å¯è°ƒåº¦ã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210629152051352-1225823433.png" alt="img"></p><p><em>è§£å†³æ–¹æ³•ï¼šåˆ é™¤æ‰€æœ‰podåéƒ¨ç½²podå³å¯ã€‚</em></p><p><em><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210629152510721-328871187.png" alt="img"></em></p><h2 id="é—®é¢˜19ã€helmå®‰è£…ç»„ä»¶å¤±è´¥ï¼Ÿ"><a href="#é—®é¢˜19ã€helmå®‰è£…ç»„ä»¶å¤±è´¥ï¼Ÿ" class="headerlink" title="é—®é¢˜19ã€helmå®‰è£…ç»„ä»¶å¤±è´¥ï¼Ÿ"></a>é—®é¢˜19ã€helmå®‰è£…ç»„ä»¶å¤±è´¥ï¼Ÿ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"> [root@k8s-master01 hello-world]<span class="hljs-comment"># helm install</span><br><br>Error: This <span class="hljs-built_in">command</span> needs 1 argument: chart nam<br><br>[root@k8s-master01 hello-world]<span class="hljs-comment"># helm install ./</span><br>Error: no Chart.yaml exists <span class="hljs-keyword">in</span> directory <span class="hljs-string">&quot;/root/hello-world&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210707212133091-1095838688.png" alt="img"></p><p> åŸå› åˆ†æï¼šæ–‡ä»¶åæ ¼å¼ä¸å¯¹ã€‚</p><p><em>è§£å†³æ–¹æ³•ï¼šmv chart.yaml Chart.yaml</em></p><p> <img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210707213220258-1665790330.png" alt="img"></p><h2 id="é—®é¢˜20ã€helmæ›´æ–°releaseå¤±è´¥ï¼Ÿ"><a href="#é—®é¢˜20ã€helmæ›´æ–°releaseå¤±è´¥ï¼Ÿ" class="headerlink" title="é—®é¢˜20ã€helmæ›´æ–°releaseå¤±è´¥ï¼Ÿ"></a>é—®é¢˜20ã€helmæ›´æ–°releaseå¤±è´¥ï¼Ÿ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@k8s-master01 hello-world]<span class="hljs-comment"># helm upgrade joyous-wasp ./</span><br>UPGRADE FAILED<br>ROLLING BACK<br>Error: render error <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;hello-world/templates/deployment.yaml&quot;</span>: template: hello-world/templates/deployment.yaml:14:35: executing <span class="hljs-string">&quot;hello-world/templates/deployment.yaml&quot;</span> at &lt;.values.image.reposi...&gt;: can<span class="hljs-string">&#x27;t evaluate field image in type interface &#123;&#125;</span><br><span class="hljs-string">Error: UPGRADE FAILED: render error in &quot;hello-world/templates/deployment.yaml&quot;: template: hello-world/templates/deployment.yaml:14:35: executing &quot;hello-world/templates/deployment.yaml&quot; at &lt;.values.image.reposi...&gt;: can&#x27;</span>t evaluate field image <span class="hljs-keyword">in</span> <span class="hljs-built_in">type</span> interface &#123;&#125;<br></code></pre></td></tr></table></figure><p>åŸå› åˆ†æï¼šyamlæ–‡ä»¶è¯­æ³•é”™è¯¯ã€‚</p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210708095055294-1249964591.png" alt="img"></p><p> è§£å†³æ–¹æ³•ï¼šä¿®æ”¹yamlæ–‡ä»¶å³å¯ã€‚</p><p> <img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210708095335158-562240764.png" alt="img"></p><h2 id="é—®é¢˜21ã€etcdå¯åŠ¨å¤±è´¥ï¼Ÿ"><a href="#é—®é¢˜21ã€etcdå¯åŠ¨å¤±è´¥ï¼Ÿ" class="headerlink" title="é—®é¢˜21ã€etcdå¯åŠ¨å¤±è´¥ï¼Ÿ"></a>é—®é¢˜21ã€etcdå¯åŠ¨å¤±è´¥ï¼Ÿ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@k8s-master01 ~]<span class="hljs-comment"># systemctl enable --now etcd</span><br>Created symlink from /etc/systemd/system/etcd3.service to /usr/lib/systemd/system/etcd.service.<br>Created symlink from /etc/systemd/system/multi-user.target.wants/etcd.service to /usr/lib/systemd/system/etcd.service.<br>Job <span class="hljs-keyword">for</span> etcd.service failed because a <span class="hljs-built_in">timeout</span> was exceeded. See <span class="hljs-string">&quot;systemctl status etcd.service&quot;</span> and <span class="hljs-string">&quot;journalctl -xe&quot;</span> <span class="hljs-keyword">for</span> details.<br></code></pre></td></tr></table></figure><p>åŸå› åˆ†æï¼šè®¤è¯å¤±è´¥åŸå› å¯èƒ½ä¸ºè¯ä¹¦ã€é…ç½®ã€ç«¯å£ç­‰ã€‚æ£€æŸ¥é…ç½®ç¬¦åˆetcdç‰ˆæœ¬è¦æ±‚ï¼Œè¯ä¹¦ç”Ÿæˆè¿‡ç¨‹æœ‰æ•ˆã€‚æœ€åç¡®è®¤ç«¯å£è¢«å ç”¨å¯¼è‡´è®¤è¯å¤±è´¥ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@k8s-master01 ~]``<span class="hljs-comment"># systemctl status etcd``â— etcd.service - Etcd.service``Loaded: loaded (``/usr/lib/systemd/system/etcd``.service; enabled; vendor preset: disabled)``Active: activating (start) since Wed 2021-07-14 09:53:03 CST; 1min 6s ago``Docs: https:``//coreos``.com``/etcd/docs/latest/``Main PID: 39692 (etcd)``CGroup: ``/system``.slice``/etcd``.service``â””â”€39692 ``/usr/local/bin/etcd` `--config-``file``=``/etc/etcd/etcd``.config.yml` `Jul 14 09:54:09 k8s-master01 etcd[39692]: rejected connection from ``&quot;192.168.0.108:46168&quot;` `(error ``&quot;remote error: tls: bad certificate&quot;``, ServerName ``&quot;&quot;``)``Jul 14 09:54:09 k8s-master01 etcd[39692]: rejected connection from ``&quot;192.168.0.108:46166&quot;` `(error ``&quot;remote error: tls: bad certificate&quot;``, ServerName ``&quot;&quot;``)``Jul 14 09:54:09 k8s-master01 etcd[39692]: rejected connection from ``&quot;192.168.0.108:46170&quot;` `(error ``&quot;remote error: tls: bad certificate&quot;``, ServerName ``&quot;&quot;``)``Jul 14 09:54:09 k8s-master01 etcd[39692]: rejected connection from ``&quot;192.168.0.108:46172&quot;` `(error ``&quot;remote error: tls: bad certificate&quot;``, ServerName ``&quot;&quot;``)``Jul 14 09:54:09 k8s-master01 etcd[39692]: rejected connection from ``&quot;192.168.0.108:46176&quot;` `(error ``&quot;remote error: tls: bad certificate&quot;``, ServerName ``&quot;&quot;``)``Jul 14 09:54:09 k8s-master01 etcd[39692]: rejected connection from ``&quot;192.168.0.108:46174&quot;` `(error ``&quot;remote error: tls: bad certificate&quot;``, ServerName ``&quot;&quot;``)``Jul 14 09:54:09 k8s-master01 etcd[39692]: rejected connection from ``&quot;192.168.0.108:46178&quot;` `(error ``&quot;remote error: tls: bad certificate&quot;``, ServerName ``&quot;&quot;``)``Jul 14 09:54:09 k8s-master01 etcd[39692]: rejected connection from ``&quot;192.168.0.108:46180&quot;` `(error ``&quot;remote error: tls: bad certificate&quot;``, ServerName ``&quot;&quot;``)``Jul 14 09:54:10 k8s-master01 etcd[39692]: rejected connection from ``&quot;192.168.0.108:46182&quot;` `(error ``&quot;remote error: tls: bad certificate&quot;``, ServerName ``&quot;&quot;``)``Jul 14 09:54:10 k8s-master01 etcd[39692]: rejected connection from ``&quot;192.168.0.108:46186&quot;` `(error ``&quot;remote error: tls: bad certificate&quot;``, ServerName ``&quot;&quot;``)ã€€</span><br></code></pre></td></tr></table></figure><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210714110933328-892431856.png" alt="img"></p><p><em>è§£å†³æ–¹æ³•ï¼škillå ç”¨2379ç«¯å£çš„è¿›ç¨‹ï¼Œé‡å¯etcdå³å¯ã€‚</em></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210714111148067-685810349.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210714111939253-1593125774.png" alt="img"></p><h2 id="é—®é¢˜22ã€svcåä»£ç†æœåŠ¡ï¼Œè·¨åŸŸè®¿é—®å¤±è´¥ï¼Ÿ"><a href="#é—®é¢˜22ã€svcåä»£ç†æœåŠ¡ï¼Œè·¨åŸŸè®¿é—®å¤±è´¥ï¼Ÿ" class="headerlink" title="é—®é¢˜22ã€svcåä»£ç†æœåŠ¡ï¼Œè·¨åŸŸè®¿é—®å¤±è´¥ï¼Ÿ"></a>é—®é¢˜22ã€svcåä»£ç†æœåŠ¡ï¼Œè·¨åŸŸè®¿é—®å¤±è´¥ï¼Ÿ</h2><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210826164716944-163445187.png" alt="img"></p><p><img src="/2023/06/19/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%B8%B8%E8%A7%81%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/1617751-20210826164902328-1366795862.png" alt="img"></p><p>åŸå› åˆ†æï¼špodè·¨åŸŸè®¿é—®ï¼Œè¢«ç™¾åº¦ç¦æ­¢è®¿é—®ï¼›</p><p>è§£å†³æ–¹æ³•ï¼šä¿®æ”¹è®¿é—®ç­–ç•¥å³å¯ï¼ˆç•¥ç•¥ï¼‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>é—®é¢˜å¤„ç†å’ŒåŸºç¡€å‘½ä»¤</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å½»åº•åˆ é™¤k8sç¯å¢ƒ</title>
    <link href="/2023/06/18/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/%E5%88%A0%E9%99%A4k8s%E7%8E%AF%E5%A2%83/"/>
    <url>/2023/06/18/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/%E5%88%A0%E9%99%A4k8s%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å½»åº•åˆ é™¤k8sç¯å¢ƒ"><a href="#å½»åº•åˆ é™¤k8sç¯å¢ƒ" class="headerlink" title="å½»åº•åˆ é™¤k8sç¯å¢ƒ"></a>å½»åº•åˆ é™¤k8sç¯å¢ƒ</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm reset -f<br>modprobe -r ipip<br>lsmod<br><span class="hljs-built_in">rm</span> -rf ~/.kube/<br><span class="hljs-built_in">rm</span> -rf /etc/kubernetes/<br><span class="hljs-built_in">rm</span> -rf /etc/systemd/system/kubelet.service.d<br><span class="hljs-built_in">rm</span> -rf /etc/systemd/system/kubelet.service<br><span class="hljs-built_in">rm</span> -rf /usr/bin/kube*<br><span class="hljs-built_in">rm</span> -rf /etc/cni<br><span class="hljs-built_in">rm</span> -rf /opt/cni<br><span class="hljs-built_in">rm</span> -rf /var/lib/etcd<br><span class="hljs-built_in">rm</span> -rf /var/etcd<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>é—®é¢˜å¤„ç†å’ŒåŸºç¡€å‘½ä»¤</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¼˜é›…å‡çº§ Kubernetes é›†ç¾¤çš„ Docker å’Œ Containerd ç‰ˆæœ¬</title>
    <link href="/2023/06/18/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%8D%87%E7%BA%A7%20Kubernetes%20%E9%9B%86%E7%BE%A4%E7%9A%84%20Docker%20%E5%92%8C%20Containerd%20%E7%89%88%E6%9C%AC/"/>
    <url>/2023/06/18/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%8D%87%E7%BA%A7%20Kubernetes%20%E9%9B%86%E7%BE%A4%E7%9A%84%20Docker%20%E5%92%8C%20Containerd%20%E7%89%88%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å¦‚ä½•ä¼˜é›…å‡çº§-Kubernetes-é›†ç¾¤çš„-Docker-å’Œ-Containerd-ç‰ˆæœ¬"><a href="#å¦‚ä½•ä¼˜é›…å‡çº§-Kubernetes-é›†ç¾¤çš„-Docker-å’Œ-Containerd-ç‰ˆæœ¬" class="headerlink" title="å¦‚ä½•ä¼˜é›…å‡çº§ Kubernetes é›†ç¾¤çš„ Docker å’Œ Containerd ç‰ˆæœ¬"></a>å¦‚ä½•ä¼˜é›…å‡çº§ Kubernetes é›†ç¾¤çš„ Docker å’Œ Containerd ç‰ˆæœ¬</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…¬å¸ç”¨çš„k8sé›†ç¾¤æ˜¯â€œå¤šç¯å¢ƒåˆä¸€â€çš„æ–¹å¼ï¼Œé›†ç¾¤æµé‡å…¥å£ä¹Ÿæ‘’å¼ƒäº†å¸¸è§çš„traefikå’Œingress-nginxï¼Œç›´æ¥ç”¨äº†ä¸€ä¸ªå›½å†…ä¸å¸¸è§çš„åº•å±‚åŸºäºEnvoyçš„API Gatewayç½‘å…³æœåŠ¡ã€‚å½“ç„¶è¿˜æœ‰éå¸¸å¤šçš„å…¶ä»–é›†ç¾¤æµé‡å…¥å£ç»„ä»¶å¯ä¾›é€‰æ‹©ã€‚</p><p>ç”±äºè¿™ä¸ªç»„ä»¶æ›´æ–°è¿­ä»£ä¹Ÿæ˜¯éå¸¸çš„å¿«é€Ÿï¼Œå¹¶ä¸”å®˜æ–¹æ–‡æ¡£å¾ˆå¿«ä¸å±•ç¤ºæ—§ç‰ˆæœ¬æ–‡æ¡£äº†ï¼Œé‚£ä¹ˆéšç€ç‰ˆæœ¬æ›´æ–°ï¼ŒAPIç‰ˆæœ¬è‡ªç„¶å‘ç”Ÿäº†æ”¹å˜ï¼Œæ–°ç‰ˆæœ¬çš„APIå°±æ²¡æœ‰ä»»ä½•çš„å‚è€ƒæ„ä¹‰äº†ï¼Œå› æ­¤éœ€è¦å‡çº§ç»„ä»¶ç‰ˆæœ¬ã€‚å‡çº§ç»„ä»¶ç‰ˆæœ¬å‰ææ˜¯dockerç‰ˆæœ¬è‡³å°‘éœ€è¦20.10.11ï¼Œcontainerdç‰ˆæœ¬è‡³å°‘æ˜¯1.4.11ã€‚äºæ˜¯è¿™é‡Œå…ˆåŸåœ°å‡çº§è¿™ä¸¤ä¸ªç»„ä»¶ã€‚</p><h2 id="k8sçš„nodeèŠ‚ç‚¹ç»´æŠ¤"><a href="#k8sçš„nodeèŠ‚ç‚¹ç»´æŠ¤" class="headerlink" title="k8sçš„nodeèŠ‚ç‚¹ç»´æŠ¤"></a>k8sçš„nodeèŠ‚ç‚¹ç»´æŠ¤</h2><p>å°½å¯èƒ½åœ¨ç»´æŠ¤èŠ‚ç‚¹ä¹‹å‰ä¿è¯ä½ çš„æœ‰å¦å¤–çš„å†—ä½™èŠ‚ç‚¹ï¼Œèƒ½å¤Ÿæ”¯æ’‘ä½ å½“å‰ç»´æŠ¤èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰podã€‚æˆ–è€…ä¿è¯ä½ ç»´æŠ¤è¿™ä¸ªèŠ‚ç‚¹é©±é€äº†æ‰€æœ‰podåï¼Œå…¶ä»–èŠ‚ç‚¹èƒ½å¤Ÿæ‰¿è½½ä½ è¿™ä¸ªèŠ‚ç‚¹ä¸Šæ‰€æœ‰podã€‚éå¸¸å¯æ€œä¹Ÿéå¸¸å¯æƒœï¼Œæˆ‘è¿™é‡ŒèŠ‚ç‚¹å†…å­˜éƒ½è·‘åˆ°äº†95%ä»¥ä¸Šï¼Œå¹¶ä¸”é¢†å¯¼ä¸ç»™æœºå™¨ï¼Œè®©æˆ‘å¤œé‡Œå‡çº§ã€‚podç›®å‰é›†ç¾¤ä¸Šæœ‰è¶…è¿‡5000ä¸ªã€‚æ­¤æ—¶åªèƒ½ç¡¬ç€å¤´çš®ä¸Šäº†ã€‚ç†å¿µæ˜¯å‡çº§å®Œä¸€å°æ­£å¸¸åå†æ¥ç€å‡ä¸‹ä¸€å°ã€‚</p><h2 id="å‡çº§æ­¥éª¤"><a href="#å‡çº§æ­¥éª¤" class="headerlink" title="å‡çº§æ­¥éª¤"></a>å‡çº§æ­¥éª¤</h2><h3 id="1ã€æŸ¥çœ‹åŸå…ˆçš„containerdå’Œdockerç‰ˆæœ¬"><a href="#1ã€æŸ¥çœ‹åŸå…ˆçš„containerdå’Œdockerç‰ˆæœ¬" class="headerlink" title="1ã€æŸ¥çœ‹åŸå…ˆçš„containerdå’Œdockerç‰ˆæœ¬"></a>1ã€æŸ¥çœ‹åŸå…ˆçš„containerdå’Œdockerç‰ˆæœ¬</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ containerd -v<br>containerd containerd.io 1.2.13 7ad184331fa3e55e52b890ea95e65ba581ae3429<br><br>$ docker -v<br>Docker version 19.03.12, build 48a66213fe<br></code></pre></td></tr></table></figure><h3 id="2ã€é©±é€pod"><a href="#2ã€é©±é€pod" class="headerlink" title="2ã€é©±é€pod"></a>2ã€é©±é€pod</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl drain k8s-node02.ayunw.cn --ignore-daemonsets --delete-local-data --force<br><br>$ kubectl get node<br>NAME                    STATUS                        <br>k8s-master01.ayunw.cn   Ready                         <br>k8s-node01.ayunw.cn     Ready                         <br>k8s-node02.ayunw.cn     NotReady,SchedulingDisabled<br>...<br></code></pre></td></tr></table></figure><h3 id="3ã€åœæ­¢èŠ‚ç‚¹ä¸Šdockerå’Œkubelet"><a href="#3ã€åœæ­¢èŠ‚ç‚¹ä¸Šdockerå’Œkubelet" class="headerlink" title="3ã€åœæ­¢èŠ‚ç‚¹ä¸Šdockerå’Œkubelet"></a>3ã€åœæ­¢èŠ‚ç‚¹ä¸Šdockerå’Œkubelet</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl stop kubelet<br><br>systemctl stop docker<br>systemctl stop docker.socket<br>systemctl stop containerd<br></code></pre></td></tr></table></figure><h3 id="4ã€å¸è½½è€ç‰ˆæœ¬dockerå¹¶å®‰è£…æ–°ç‰ˆæœ¬dockerå’Œcontainerd"><a href="#4ã€å¸è½½è€ç‰ˆæœ¬dockerå¹¶å®‰è£…æ–°ç‰ˆæœ¬dockerå’Œcontainerd" class="headerlink" title="4ã€å¸è½½è€ç‰ˆæœ¬dockerå¹¶å®‰è£…æ–°ç‰ˆæœ¬dockerå’Œcontainerd"></a>4ã€å¸è½½è€ç‰ˆæœ¬dockerå¹¶å®‰è£…æ–°ç‰ˆæœ¬dockerå’Œcontainerd</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y remove docker \<br>              docker-client \<br>              docker-client-latest \<br>              docker-common \<br>              docker-latest \<br>              docker-latest-logrotate \<br>              docker-logrotate \<br>              docker-engine<br><br>dnf -y install yum-utils device-mapper-persistent-data lvm2<br><br>yum-config-manager \<br>    --add-repo \<br>    https://download.docker.com/linux/centos/docker-ce.repo<br><br>yum makecache<br><br>dnf -y install containerd.io-1.4.12-3.1.el8.x86_64.rpm<br><br>dnf -y install docker-ce-20.10.11 docker-ce-cli-20.10.11<br><br>systemctl daemon-reload<br>systemctl start docker<br>systemctl <span class="hljs-built_in">enable</span> docker<br>systemctl status docker<br><br>systemctl status containerd<br>systemctl <span class="hljs-built_in">enable</span> containerd.service<br></code></pre></td></tr></table></figure><h3 id="5ã€æ£€æŸ¥dockerå’Œcontainerdç‰ˆæœ¬"><a href="#5ã€æ£€æŸ¥dockerå’Œcontainerdç‰ˆæœ¬" class="headerlink" title="5ã€æ£€æŸ¥dockerå’Œcontainerdç‰ˆæœ¬"></a>5ã€æ£€æŸ¥dockerå’Œcontainerdç‰ˆæœ¬</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ containerd -v &amp;&amp; docker -v<br>containerd containerd.io 1.4.12 7b11cfaabd73bb80907dd23182b9347b4245eb5d<br>Docker version 20.10.11, build dea9396<br></code></pre></td></tr></table></figure><h3 id="6ã€å¯åŠ¨kubeletå¹¶æ¢å¤èŠ‚ç‚¹"><a href="#6ã€å¯åŠ¨kubeletå¹¶æ¢å¤èŠ‚ç‚¹" class="headerlink" title="6ã€å¯åŠ¨kubeletå¹¶æ¢å¤èŠ‚ç‚¹"></a>6ã€å¯åŠ¨kubeletå¹¶æ¢å¤èŠ‚ç‚¹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start kubelet<br>systemctl status kubelet<br><br>kubectl uncordon k8s-node02.ayunw.cn<br><br>kubectl get node -o wide <br></code></pre></td></tr></table></figure><p>æœ€åå°±èƒ½çœ‹åˆ°ç‰ˆæœ¬å·²ç»å‡çº§å®Œæˆã€‚</p>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>é—®é¢˜å¤„ç†å’ŒåŸºç¡€å‘½ä»¤</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>K8sè¯ä¹¦è¿‡æœŸå¤„ç†</title>
    <link href="/2023/06/17/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E8%AF%81%E4%B9%A6%E8%BF%87%E6%9C%9F%E8%A7%A3%E5%86%B3/"/>
    <url>/2023/06/17/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E8%AF%81%E4%B9%A6%E8%BF%87%E6%9C%9F%E8%A7%A3%E5%86%B3/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="K8sè¯ä¹¦è¿‡æœŸå¤„ç†"><a href="#K8sè¯ä¹¦è¿‡æœŸå¤„ç†" class="headerlink" title="K8sè¯ä¹¦è¿‡æœŸå¤„ç†"></a>K8sè¯ä¹¦è¿‡æœŸå¤„ç†</h1><h2 id="ä¸€ã€kubeadmè¯ä¹¦è¿‡æœŸè§£å†³"><a href="#ä¸€ã€kubeadmè¯ä¹¦è¿‡æœŸè§£å†³" class="headerlink" title="ä¸€ã€kubeadmè¯ä¹¦è¿‡æœŸè§£å†³"></a>ä¸€ã€kubeadmè¯ä¹¦è¿‡æœŸè§£å†³</h2><h3 id="1ã€openssl-æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ"><a href="#1ã€openssl-æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ" class="headerlink" title="1ã€openssl æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ"></a>1ã€openssl æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl x509 -<span class="hljs-keyword">in</span> XX.crt -noout -dates<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨forå¾ªç¯è¾“å‡ºæœ‰æ•ˆæœŸ:</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> `find /etc/kubernetes/pki -maxdepth 2 -name <span class="hljs-string">&quot;*.crt&quot;</span>`;<span class="hljs-keyword">do</span> openssl x509 -<span class="hljs-keyword">in</span> <span class="hljs-variable">$item</span> -text -noout| grep Not;\<br><span class="hljs-built_in">echo</span> ======================<span class="hljs-variable">$item</span>===================;<span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h3 id="2ã€å¤‡ä»½è¯ä¹¦å’Œetcdæ•°æ®ç›®å½•"><a href="#2ã€å¤‡ä»½è¯ä¹¦å’Œetcdæ•°æ®ç›®å½•" class="headerlink" title="2ã€å¤‡ä»½è¯ä¹¦å’Œetcdæ•°æ®ç›®å½•"></a>2ã€å¤‡ä»½è¯ä¹¦å’Œetcdæ•°æ®ç›®å½•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> -r /etc/kubernetes/  /tmp/kubernetes_bak<br><span class="hljs-built_in">cp</span> -r /var/lib/etcd    /tmp/etcd_bak<br></code></pre></td></tr></table></figure><h3 id="3ã€ç”Ÿæˆè¯ä¹¦"><a href="#3ã€ç”Ÿæˆè¯ä¹¦" class="headerlink" title="3ã€ç”Ÿæˆè¯ä¹¦"></a>3ã€ç”Ÿæˆè¯ä¹¦</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm alpha certs renew all --config=kubeadm.yml<br></code></pre></td></tr></table></figure><p><strong>æ²¡æœ‰kubeadm.yamlæ–‡ä»¶çš„å¯ä»¥å¯¼å‡ºé…ç½®æ–‡ä»¶</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm config <span class="hljs-built_in">print</span> init-defaults --kubeconfig ClusterConfiguration &gt; kubeadm.yml<br></code></pre></td></tr></table></figure><h3 id="4ã€kubeadmå†æ¬¡æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ-version-1-15"><a href="#4ã€kubeadmå†æ¬¡æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ-version-1-15" class="headerlink" title="4ã€kubeadmå†æ¬¡æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ(version:1.15+)"></a>4ã€kubeadmå†æ¬¡æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ(version:1.15+)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm alpha certs check-expiration<br></code></pre></td></tr></table></figure><h3 id="5ã€æ›´æ–°-kubeconfig-æ–‡ä»¶"><a href="#5ã€æ›´æ–°-kubeconfig-æ–‡ä»¶" class="headerlink" title="5ã€æ›´æ–° kubeconfig æ–‡ä»¶"></a>5ã€æ›´æ–° kubeconfig æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm init phase kubeconfig all --config kubeadm.yml<br></code></pre></td></tr></table></figure><h3 id="6ã€å°†æ–°ç”Ÿæˆçš„-admin-é…ç½®æ–‡ä»¶è¦†ç›–æ‰åŸæœ¬çš„-admin-æ–‡ä»¶"><a href="#6ã€å°†æ–°ç”Ÿæˆçš„-admin-é…ç½®æ–‡ä»¶è¦†ç›–æ‰åŸæœ¬çš„-admin-æ–‡ä»¶" class="headerlink" title="6ã€å°†æ–°ç”Ÿæˆçš„ admin é…ç½®æ–‡ä»¶è¦†ç›–æ‰åŸæœ¬çš„ admin æ–‡ä»¶"></a>6ã€å°†æ–°ç”Ÿæˆçš„ admin é…ç½®æ–‡ä»¶è¦†ç›–æ‰åŸæœ¬çš„ admin æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mv</span> <span class="hljs-variable">$HOME</span>/.kube/config <span class="hljs-variable">$HOME</span>/.kube/config.old<br><span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br><span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br></code></pre></td></tr></table></figure><h3 id="7ã€é‡å¯-kube-apiserverã€kube-controllerã€kube-schedulerã€etcd-è¿™4ä¸ªå®¹å™¨"><a href="#7ã€é‡å¯-kube-apiserverã€kube-controllerã€kube-schedulerã€etcd-è¿™4ä¸ªå®¹å™¨" class="headerlink" title="7ã€é‡å¯ kube-apiserverã€kube-controllerã€kube-schedulerã€etcd è¿™4ä¸ªå®¹å™¨"></a>7ã€é‡å¯ kube-apiserverã€kube-controllerã€kube-schedulerã€etcd è¿™4ä¸ªå®¹å™¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker ps |grep -E <span class="hljs-string">&#x27;k8s_kube-apiserver|k8s_kube-controller-manager|k8s_kube-scheduler|k8s_etcd_etcd&#x27;</span> | awk -F <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> |xargs docker restart<br></code></pre></td></tr></table></figure><h3 id="8ã€ä½¿ç”¨kubeadmæŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ-version-1-20"><a href="#8ã€ä½¿ç”¨kubeadmæŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ-version-1-20" class="headerlink" title="8ã€ä½¿ç”¨kubeadmæŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ (version:1.20+)"></a>8ã€ä½¿ç”¨kubeadmæŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ (version:1.20+)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm certs check-expiration<br></code></pre></td></tr></table></figure><h3 id="9ã€åŒæ­¥è¯ä¹¦åˆ°å…¶ä»–masteræœºå™¨ä¸Š"><a href="#9ã€åŒæ­¥è¯ä¹¦åˆ°å…¶ä»–masteræœºå™¨ä¸Š" class="headerlink" title="9ã€åŒæ­¥è¯ä¹¦åˆ°å…¶ä»–masteræœºå™¨ä¸Š"></a>9ã€åŒæ­¥è¯ä¹¦åˆ°å…¶ä»–masteræœºå™¨ä¸Š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">scp etc/kubernetes/pki/apiserver* etc/kubernetes/pki/front-proxy* 192.168.94.155:/etc/kubernetes/pki/<br><br>scp etc/kubernetes/admin.conf 192.168.94.155:/etc/kubernetes/<br></code></pre></td></tr></table></figure><h2 id="äºŒã€äºŒè¿›åˆ¶å®‰è£…çš„k8sï¼ŒnodeèŠ‚ç‚¹notreadyï¼Œè¯ä¹¦è¿‡æœŸå¤„ç†"><a href="#äºŒã€äºŒè¿›åˆ¶å®‰è£…çš„k8sï¼ŒnodeèŠ‚ç‚¹notreadyï¼Œè¯ä¹¦è¿‡æœŸå¤„ç†" class="headerlink" title="äºŒã€äºŒè¿›åˆ¶å®‰è£…çš„k8sï¼ŒnodeèŠ‚ç‚¹notreadyï¼Œè¯ä¹¦è¿‡æœŸå¤„ç†"></a>äºŒã€äºŒè¿›åˆ¶å®‰è£…çš„k8sï¼ŒnodeèŠ‚ç‚¹notreadyï¼Œè¯ä¹¦è¿‡æœŸå¤„ç†</h2><h3 id="1ã€é‡å¯nodeèŠ‚ç‚¹kubelete"><a href="#1ã€é‡å¯nodeèŠ‚ç‚¹kubelete" class="headerlink" title="1ã€é‡å¯nodeèŠ‚ç‚¹kubelete"></a>1ã€é‡å¯nodeèŠ‚ç‚¹kubelete</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl  restart kubelet &amp;&amp; systemctl  status  kubelet<br></code></pre></td></tr></table></figure><h3 id="2ã€ä½¿ç”¨CSRé‡æ–°ç”Ÿäº§è¯ä¹¦"><a href="#2ã€ä½¿ç”¨CSRé‡æ–°ç”Ÿäº§è¯ä¹¦" class="headerlink" title="2ã€ä½¿ç”¨CSRé‡æ–°ç”Ÿäº§è¯ä¹¦"></a>2ã€ä½¿ç”¨CSRé‡æ–°ç”Ÿäº§è¯ä¹¦</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl get csr<br><span class="hljs-comment">#-----------ä»¥ä¸‹ä¸ºè¾“å‡ºå†…å®¹:-------------------</span><br>NAME                        AGE       REQUESTOR           CONDITION<br>node-csr-NsKZSz-myrv   11s       kubelet-bootstrap   Pending<br><span class="hljs-comment">#------------------------------------------</span><br><br>kubectl certificate approve node-csr-NsKZSz-myrv<br><span class="hljs-comment">#------------ä»¥ä¸‹ä¸ºè¾“å‡ºå†…å®¹:-----------------</span><br>certificatesigningrequest.certificates.k8s.io/node-csr-NsKZSz-myrv approved<br><br>å¤‡æ³¨ï¼šCSRæˆæƒå®Œæˆåï¼Œkubeleteä¼šè‡ªåŠ¨å‘èµ·CSRè¯·æ±‚æ›´æ–°è¯ä¹¦ã€‚<br></code></pre></td></tr></table></figure><h3 id="3ã€-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"><a href="#3ã€-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€" class="headerlink" title="3ã€ æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"></a>3ã€ æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</h3><p><strong>å¤§æ¦‚ç­‰å¾…10ç§’ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤:</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl get node<br></code></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼šç›´æ¥ç”Ÿæˆä¸‰åå¹´æœ‰æ•ˆæœŸï¼š<a href="https://blog.csdn.net/warlice/article/details/105402449%EF%BC%88%E6%9C%AA%E9%AA%8C%E8%AF%81%EF%BC%89">https://blog.csdn.net/warlice/article/details/105402449ï¼ˆæœªéªŒè¯ï¼‰</a></p><h2 id="ä¸‰ã€masterèŠ‚ç‚¹ä¿®æ”¹é»˜è®¤è¯ä¹¦æœŸé™ï¼ˆåœ¨masterèŠ‚ç‚¹æ“ä½œï¼‰"><a href="#ä¸‰ã€masterèŠ‚ç‚¹ä¿®æ”¹é»˜è®¤è¯ä¹¦æœŸé™ï¼ˆåœ¨masterèŠ‚ç‚¹æ“ä½œï¼‰" class="headerlink" title="ä¸‰ã€masterèŠ‚ç‚¹ä¿®æ”¹é»˜è®¤è¯ä¹¦æœŸé™ï¼ˆåœ¨masterèŠ‚ç‚¹æ“ä½œï¼‰"></a>ä¸‰ã€masterèŠ‚ç‚¹ä¿®æ”¹é»˜è®¤è¯ä¹¦æœŸé™ï¼ˆåœ¨masterèŠ‚ç‚¹æ“ä½œï¼‰</h2><h3 id="1ï¼šæ‹‰å–æºç "><a href="#1ï¼šæ‹‰å–æºç " class="headerlink" title="1ï¼šæ‹‰å–æºç "></a>1ï¼šæ‹‰å–æºç </h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /data &amp;&amp; git <span class="hljs-built_in">clone</span> https://github.com/kubernetes/kubernetes.git<br></code></pre></td></tr></table></figure><h3 id="2ï¼šåˆ‡æ¢åˆ°1-13-0ç‰ˆæœ¬"><a href="#2ï¼šåˆ‡æ¢åˆ°1-13-0ç‰ˆæœ¬" class="headerlink" title="2ï¼šåˆ‡æ¢åˆ°1.13.0ç‰ˆæœ¬"></a>2ï¼šåˆ‡æ¢åˆ°1.13.0ç‰ˆæœ¬</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git checkout -b remotes/origin/release-1.13 v1.13.0<br></code></pre></td></tr></table></figure><h3 id="3ï¼šå®‰è£…goç¯å¢ƒ"><a href="#3ï¼šå®‰è£…goç¯å¢ƒ" class="headerlink" title="3ï¼šå®‰è£…goç¯å¢ƒ"></a>3ï¼šå®‰è£…goç¯å¢ƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /data/soft &amp;&amp; wgethttps://dl.google.com/go/go1.11.2.linux-amd64.tar.gz<br>tar zxvf go1.11.2.linux-amd64.tar.gz  -C /usr/local<br></code></pre></td></tr></table></figure><h3 id="4ï¼šç¼–è¾‘-x2F-etc-x2F-profileæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ï¼š"><a href="#4ï¼šç¼–è¾‘-x2F-etc-x2F-profileæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ï¼š" class="headerlink" title="4ï¼šç¼–è¾‘&#x2F;etc&#x2F;profileæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ï¼š"></a>4ï¼šç¼–è¾‘&#x2F;etc&#x2F;profileæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#go setting</span><br><span class="hljs-built_in">export</span> GOROOT=/usr/local/go<br><span class="hljs-built_in">export</span> GOPATH=/usr/local/gopath<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$GOROOT</span>/bin<br></code></pre></td></tr></table></figure><h3 id="5ï¼šç”Ÿæ•ˆ"><a href="#5ï¼šç”Ÿæ•ˆ" class="headerlink" title="5ï¼šç”Ÿæ•ˆ"></a>5ï¼šç”Ÿæ•ˆ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><h3 id="6ï¼šä¿®æ”¹æºç -åŸæ¥1å¹´ï¼Œ-100è¡¨ç¤º100å¹´"><a href="#6ï¼šä¿®æ”¹æºç -åŸæ¥1å¹´ï¼Œ-100è¡¨ç¤º100å¹´" class="headerlink" title="6ï¼šä¿®æ”¹æºç ,åŸæ¥1å¹´ï¼Œ*100è¡¨ç¤º100å¹´"></a>6ï¼šä¿®æ”¹æºç ,åŸæ¥1å¹´ï¼Œ<code>*100</code>è¡¨ç¤º100å¹´</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /data/kubernetes/staging/src/k8s.io/client-go/util/cert/cert.go<br><span class="hljs-comment">#...</span><br>&gt;112  NotAfter:     time.Now().Add(duration365d * 100).UTC(),<br>&gt;187  NotAfter:  validFrom.Add(maxAge *100),<br>&gt;215  NotAfter:  validFrom.Add(maxAge * 100),<br></code></pre></td></tr></table></figure><h3 id="7ï¼šç¼–è¯‘"><a href="#7ï¼šç¼–è¯‘" class="headerlink" title="7ï¼šç¼–è¯‘"></a>7ï¼šç¼–è¯‘</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /data/kubernetes/ &amp;&amp; make WHAT=cmd/kubeadm<br><span class="hljs-comment">#æŸ¥çœ‹ç¼–è¯‘åçš„æ–‡ä»¶</span><br><span class="hljs-built_in">ls</span> -l /data/kubernetes/_output/bin/kubeadm<br></code></pre></td></tr></table></figure><h3 id="8ï¼šæ›¿æ¢kubeadm"><a href="#8ï¼šæ›¿æ¢kubeadm" class="headerlink" title="8ï¼šæ›¿æ¢kubeadm"></a>8ï¼šæ›¿æ¢kubeadm</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mv</span> /usr/bin/kubeadm /usr/bin/kubeadm_backup<br><span class="hljs-built_in">ln</span> -s /data/kubernetes/_output/bin/kubeadm /usr/bin/kubeadm<br></code></pre></td></tr></table></figure><h3 id="9-æŸ¥çœ‹è¯ä¹¦æœŸé™"><a href="#9-æŸ¥çœ‹è¯ä¹¦æœŸé™" class="headerlink" title="9.æŸ¥çœ‹è¯ä¹¦æœŸé™"></a>9.æŸ¥çœ‹è¯ä¹¦æœŸé™</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl x509 -<span class="hljs-keyword">in</span> front-proxy-client.crt   -noout -text  |grep Not<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>é—®é¢˜å¤„ç†å’ŒåŸºç¡€å‘½ä»¤</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8så®¹å™¨ä¸å®¹å™¨ä¹‹é—´çš„é€šä¿¡</title>
    <link href="/2023/06/16/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%AE%B9%E5%99%A8%E4%B8%8E%E5%AE%B9%E5%99%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/"/>
    <url>/2023/06/16/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%AE%B9%E5%99%A8%E4%B8%8E%E5%AE%B9%E5%99%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="k8så®¹å™¨ä¸å®¹å™¨ä¹‹é—´çš„é€šä¿¡"><a href="#k8så®¹å™¨ä¸å®¹å™¨ä¹‹é—´çš„é€šä¿¡" class="headerlink" title="k8så®¹å™¨ä¸å®¹å™¨ä¹‹é—´çš„é€šä¿¡"></a>k8så®¹å™¨ä¸å®¹å™¨ä¹‹é—´çš„é€šä¿¡</h1><p>å‚è€ƒï¼š<a href="https://www.it1352.com/1536010.html">https://www.it1352.com/1536010.html</a></p><h2 id="1ã€ä¸¾ä¾‹ï¼šå®ç°ä¸¤ä¸ªmongoå®¹å™¨ä¹‹é—´å¯ä»¥äº’ç›¸è¿æ¥mongo"><a href="#1ã€ä¸¾ä¾‹ï¼šå®ç°ä¸¤ä¸ªmongoå®¹å™¨ä¹‹é—´å¯ä»¥äº’ç›¸è¿æ¥mongo" class="headerlink" title="1ã€ä¸¾ä¾‹ï¼šå®ç°ä¸¤ä¸ªmongoå®¹å™¨ä¹‹é—´å¯ä»¥äº’ç›¸è¿æ¥mongo"></a>1ã€ä¸¾ä¾‹ï¼šå®ç°ä¸¤ä¸ªmongoå®¹å™¨ä¹‹é—´å¯ä»¥äº’ç›¸è¿æ¥mongo</h2><h3 id="mongo-testå®¹å™¨çš„yamlæ–‡ä»¶"><a href="#mongo-testå®¹å™¨çš„yamlæ–‡ä»¶" class="headerlink" title="mongo-testå®¹å™¨çš„yamlæ–‡ä»¶"></a>mongo-testå®¹å™¨çš„yamlæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> db-test.yaml<br><br>apiVersion: apps/v1 <br>kind: Deployment<br>metadata:<br>  namespace: default<br>  name: dbtest<br>  labels:<br>    app: dbtest<br> <span class="hljs-comment">#..çœç•¥äº†éƒ¨åˆ†ä¿¡æ¯</span><br>---<br><br>apiVersion: v1<br>kind: Service<br>metadata:<br>  namespace: default <span class="hljs-comment">#å‘½åç©ºé—´</span><br>  name: dbtest <span class="hljs-comment">#å®šä¹‰çš„service-nameçš„åç§°</span><br>  labels:<br>    app: db <span class="hljs-comment">#éœ€è¦é€šä¿¡çš„service-nameåç§°</span><br>spec:<br>  <span class="hljs-built_in">type</span>: NodePort<br>  selector:<br>    app: dbtest<br>  ports:<br>  - port: 27017<br>    nodePort: 9027<br>    protocol: TCP<br>    targetPort: 27017<br></code></pre></td></tr></table></figure><h3 id="mongoå®¹å™¨çš„yamlæ–‡ä»¶"><a href="#mongoå®¹å™¨çš„yamlæ–‡ä»¶" class="headerlink" title="mongoå®¹å™¨çš„yamlæ–‡ä»¶"></a>mongoå®¹å™¨çš„yamlæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> mongo.yaml<br><br>apiVersion: apps/v1 <br>kind: Deployment<br>metadata:<br>  namespace: default<br>  name: dbtest<br>  labels:<br>    app: dbtest<br> <span class="hljs-comment">#...çœç•¥äº†éƒ¨åˆ†ä¿¡æ¯</span><br>---<br><br>apiVersion: v1<br>kind: Service<br>metadata:<br>  namespace: default <span class="hljs-comment">#å‘½åç©ºé—´</span><br>  name: db  <span class="hljs-comment">#å®šä¹‰çš„service-nameçš„åç§°</span><br>  labels:<br>    app: dbtest <span class="hljs-comment">#éœ€è¦é€šä¿¡çš„service-nameåç§°</span><br>spec:<br>  <span class="hljs-built_in">type</span>: NodePort<br>  selector:<br>    app: db<br>  ports:<br>  - port: 27017<br>    nodePort: 9017<br>    protocol: TCP<br>    targetPort: 27017<br><br></code></pre></td></tr></table></figure><h2 id="å¯åŠ¨ä¸¤ä¸ªå®¹å™¨å"><a href="#å¯åŠ¨ä¸¤ä¸ªå®¹å™¨å" class="headerlink" title="å¯åŠ¨ä¸¤ä¸ªå®¹å™¨å"></a>å¯åŠ¨ä¸¤ä¸ªå®¹å™¨å</h2><p>åœ¨å®¹å™¨å†…éƒ¨ä½¿ç”¨å¦‚ä¸‹è§„åˆ™è¿›è¡Œè¿æ¥</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;service-name&gt;.&lt;namespace-name&gt;.svc.cluster.local<br></code></pre></td></tr></table></figure><h2 id="ä¾‹å¦‚ï¼Œæˆ‘è¿™è¾¹è¿›å…¥mongoå®¹å™¨å†…éƒ¨è¿æ¥mongo-testçš„mongo"><a href="#ä¾‹å¦‚ï¼Œæˆ‘è¿™è¾¹è¿›å…¥mongoå®¹å™¨å†…éƒ¨è¿æ¥mongo-testçš„mongo" class="headerlink" title="ä¾‹å¦‚ï¼Œæˆ‘è¿™è¾¹è¿›å…¥mongoå®¹å™¨å†…éƒ¨è¿æ¥mongo-testçš„mongo"></a>ä¾‹å¦‚ï¼Œæˆ‘è¿™è¾¹è¿›å…¥mongoå®¹å™¨å†…éƒ¨è¿æ¥mongo-testçš„mongo</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubect <span class="hljs-built_in">exec</span> -it db-7892j24590 bash <br>&gt;mongo -u<span class="hljs-string">&quot;admin&quot;</span> -p<span class="hljs-string">&quot;adminTest&quot;</span> dbtest.default.svc.cluster.local<br><span class="hljs-comment">#å³å¯è¿æ¥</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>é—®é¢˜å¤„ç†å’ŒåŸºç¡€å‘½ä»¤</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerfileå®æˆ˜-ä½¿ç”¨aplineåˆ¶ä½œé•œåƒ</title>
    <link href="/2023/06/14/docker/dockerfile/dockerfile%E5%AE%9E%E6%88%98-%E4%BD%BF%E7%94%A8apline%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F/"/>
    <url>/2023/06/14/docker/dockerfile/dockerfile%E5%AE%9E%E6%88%98-%E4%BD%BF%E7%94%A8apline%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨aplineåˆ¶ä½œé•œåƒ"><a href="#ä½¿ç”¨aplineåˆ¶ä½œé•œåƒ" class="headerlink" title="ä½¿ç”¨aplineåˆ¶ä½œé•œåƒ"></a>ä½¿ç”¨aplineåˆ¶ä½œé•œåƒ</h1><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://blog.51cto.com/u_15273785/2917117#1alpinejdk_4">https://blog.51cto.com/u_15273785/2917117#1alpinejdk_4</a></p><h2 id="ä¸€ã€åˆ¶ä½œdockerfileå®æˆ˜å’Œè§£é‡Šï¼š"><a href="#ä¸€ã€åˆ¶ä½œdockerfileå®æˆ˜å’Œè§£é‡Šï¼š" class="headerlink" title="ä¸€ã€åˆ¶ä½œdockerfileå®æˆ˜å’Œè§£é‡Šï¼š"></a>ä¸€ã€åˆ¶ä½œdockerfileå®æˆ˜å’Œè§£é‡Šï¼š</h2><h3 id="1-æŒ‡å®šåŸºç¡€é•œåƒï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤"><a href="#1-æŒ‡å®šåŸºç¡€é•œåƒï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤" class="headerlink" title="1.æŒ‡å®šåŸºç¡€é•œåƒï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤"></a>1.æŒ‡å®šåŸºç¡€é•œåƒï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#FROM alpine:latest</span><br>FROM alpine:3.10<br></code></pre></td></tr></table></figure><h3 id="2-æŒ‡æ˜è¯¥é•œåƒçš„ä½œè€…å’Œå…¶ç”µå­é‚®ä»¶"><a href="#2-æŒ‡æ˜è¯¥é•œåƒçš„ä½œè€…å’Œå…¶ç”µå­é‚®ä»¶" class="headerlink" title="2.æŒ‡æ˜è¯¥é•œåƒçš„ä½œè€…å’Œå…¶ç”µå­é‚®ä»¶"></a>2.æŒ‡æ˜è¯¥é•œåƒçš„ä½œè€…å’Œå…¶ç”µå­é‚®ä»¶</h3><p>MAINTAINER zhangzhenzhou â€œ<a href="mailto:&#49;&#57;&#54;&#50;&#56;&#50;&#x31;&#x34;&#x36;&#x31;&#64;&#113;&#113;&#x2e;&#x63;&#x6f;&#109;">&#49;&#57;&#54;&#50;&#56;&#50;&#x31;&#x34;&#x36;&#x31;&#64;&#113;&#113;&#x2e;&#x63;&#x6f;&#109;</a>â€œ</p><h3 id="3-åœ¨æ„å»ºé•œåƒæ—¶ï¼ŒæŒ‡å®šé•œåƒçš„å·¥ä½œç›®å½•ï¼Œä¹‹åçš„å‘½ä»¤éƒ½æ˜¯åŸºäºæ­¤å·¥ä½œç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºç›®å½•"><a href="#3-åœ¨æ„å»ºé•œåƒæ—¶ï¼ŒæŒ‡å®šé•œåƒçš„å·¥ä½œç›®å½•ï¼Œä¹‹åçš„å‘½ä»¤éƒ½æ˜¯åŸºäºæ­¤å·¥ä½œç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºç›®å½•" class="headerlink" title="3.åœ¨æ„å»ºé•œåƒæ—¶ï¼ŒæŒ‡å®šé•œåƒçš„å·¥ä½œç›®å½•ï¼Œä¹‹åçš„å‘½ä»¤éƒ½æ˜¯åŸºäºæ­¤å·¥ä½œç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºç›®å½•"></a>3.åœ¨æ„å»ºé•œåƒæ—¶ï¼ŒæŒ‡å®šé•œåƒçš„å·¥ä½œç›®å½•ï¼Œä¹‹åçš„å‘½ä»¤éƒ½æ˜¯åŸºäºæ­¤å·¥ä½œç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºç›®å½•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">WORKDIR /app/jdk<br></code></pre></td></tr></table></figure><h3 id="4-å°†ä¸€äº›å®‰è£…åŒ…å¤åˆ¶åˆ°é•œåƒä¸­ï¼Œè¯­æ³•ï¼šADD-x2F-COPY-â€¦"><a href="#4-å°†ä¸€äº›å®‰è£…åŒ…å¤åˆ¶åˆ°é•œåƒä¸­ï¼Œè¯­æ³•ï¼šADD-x2F-COPY-â€¦" class="headerlink" title="4.å°†ä¸€äº›å®‰è£…åŒ…å¤åˆ¶åˆ°é•œåƒä¸­ï¼Œè¯­æ³•ï¼šADD&#x2F;COPY â€¦ "></a>4.å°†ä¸€äº›å®‰è£…åŒ…å¤åˆ¶åˆ°é•œåƒä¸­ï¼Œè¯­æ³•ï¼šADD&#x2F;COPY <src>â€¦ <dest></dest></src></h3><h4 id="ADDä¸COPYçš„åŒºåˆ«ï¼šADDå¤åˆ¶å¹¶è§£å‹ï¼ŒCOPYä»…å¤åˆ¶"><a href="#ADDä¸COPYçš„åŒºåˆ«ï¼šADDå¤åˆ¶å¹¶è§£å‹ï¼ŒCOPYä»…å¤åˆ¶" class="headerlink" title="ADDä¸COPYçš„åŒºåˆ«ï¼šADDå¤åˆ¶å¹¶è§£å‹ï¼ŒCOPYä»…å¤åˆ¶"></a>ADDä¸COPYçš„åŒºåˆ«ï¼šADDå¤åˆ¶å¹¶è§£å‹ï¼ŒCOPYä»…å¤åˆ¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ADD jdk-8u221-linux-x64.tar.gz /app/jdk/<br></code></pre></td></tr></table></figure><h4 id="glibcå®‰è£…åŒ…å¦‚æœä»ç½‘ç»œä¸‹è½½é€Ÿåº¦å®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œå…ˆæå‰ä¸‹è½½å¤åˆ¶åˆ°é•œåƒä¸­"><a href="#glibcå®‰è£…åŒ…å¦‚æœä»ç½‘ç»œä¸‹è½½é€Ÿåº¦å®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œå…ˆæå‰ä¸‹è½½å¤åˆ¶åˆ°é•œåƒä¸­" class="headerlink" title="glibcå®‰è£…åŒ…å¦‚æœä»ç½‘ç»œä¸‹è½½é€Ÿåº¦å®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œå…ˆæå‰ä¸‹è½½å¤åˆ¶åˆ°é•œåƒä¸­"></a>glibcå®‰è£…åŒ…å¦‚æœä»ç½‘ç»œä¸‹è½½é€Ÿåº¦å®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œå…ˆæå‰ä¸‹è½½å¤åˆ¶åˆ°é•œåƒä¸­</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">COPY glibc-2.29-r0.apk /app/jdk/<br>COPY glibc-bin-2.29-r0.apk /app/jdk/<br>COPY glibc-i18n-2.29-r0.apk /app/jdk/<br></code></pre></td></tr></table></figure><h3 id="5-æ›´æ–°Alpineçš„è½¯ä»¶æºä¸ºé˜¿é‡Œäº‘ï¼Œå› ä¸ºä»é»˜è®¤å®˜æºæ‹‰å–å®åœ¨å¤ªæ…¢äº†"><a href="#5-æ›´æ–°Alpineçš„è½¯ä»¶æºä¸ºé˜¿é‡Œäº‘ï¼Œå› ä¸ºä»é»˜è®¤å®˜æºæ‹‰å–å®åœ¨å¤ªæ…¢äº†" class="headerlink" title="5.æ›´æ–°Alpineçš„è½¯ä»¶æºä¸ºé˜¿é‡Œäº‘ï¼Œå› ä¸ºä»é»˜è®¤å®˜æºæ‹‰å–å®åœ¨å¤ªæ…¢äº†"></a>5.æ›´æ–°Alpineçš„è½¯ä»¶æºä¸ºé˜¿é‡Œäº‘ï¼Œå› ä¸ºä»é»˜è®¤å®˜æºæ‹‰å–å®åœ¨å¤ªæ…¢äº†</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">RUN <span class="hljs-built_in">echo</span> http://mirrors.aliyun.com/alpine/v3.10/main/ &gt; /etc/apk/repositories &amp;&amp; \<br>    <span class="hljs-built_in">echo</span> http://mirrors.aliyun.com/alpine/v3.10/community/ &gt;&gt; /etc/apk/repositories<br>RUN apk update &amp;&amp; apk upgrade<br></code></pre></td></tr></table></figure><h3 id="6-è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤"><a href="#6-è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤" class="headerlink" title="6.è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤"></a>6.è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤</h3><p>Alpine linuxä¸ºäº†ç²¾ç®€æœ¬èº«å¹¶æ²¡æœ‰å®‰è£…å¤ªå¤šçš„å¸¸ç”¨è½¯ä»¶,apkç±»ä¼¼äºubuntuçš„apt-getï¼Œç”¨æ¥å®‰è£…ä¸€äº›å¸¸ç”¨è½¯ä»¶ï¼Œå…¶è¯­æ³•å¦‚ä¸‹ï¼šapk add bash wget curl git make vim docker<br>wgetæ˜¯linuxä¸‹çš„ftp&#x2F;httpä¼ è¾“å·¥å…·ï¼Œæ²¡å®‰è£…ä¼šæŠ¥é”™â€œ&#x2F;bin&#x2F;sh:wget: not foundâ€ï¼Œç½‘ä¸Šä¾‹å­å°‘å®‰è£…wget</p><p>ca-certificatesè¯ä¹¦æœåŠ¡ï¼Œæ˜¯å®‰è£…glibcå‰ç½®ä¾èµ–</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">RUN apk --no-cache add ca-certificates wget \<br>    &amp;&amp; wget -q -O /etc/apk/keys/sgerrand.rsa.pub https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub \<br>    &amp;&amp; apk add glibc-2.29-r0.apk glibc-bin-2.29-r0.apk glibc-i18n-2.29-r0.apk \<br>    &amp;&amp; <span class="hljs-built_in">rm</span> -rf /var/cache/apk/* glibc-2.29-r0.apk glibc-bin-2.29-r0.apk glibc-i18n-2.29-r0.apk<br></code></pre></td></tr></table></figure><h3 id="7-é…ç½®ç¯å¢ƒå˜é‡"><a href="#7-é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="7.é…ç½®ç¯å¢ƒå˜é‡"></a>7.é…ç½®ç¯å¢ƒå˜é‡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">ENV JAVA_HOME=/app/jdk/jdk1.8.0_221<br>ENV CLASSPATH=.:<span class="hljs-variable">$JAVA_HOME</span>/lib/dt.jar:<span class="hljs-variable">$JAVA_HOME</span>/lib/tools.jar<br>ENV PATH=<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure><h3 id="8-å®¹å™¨å¯åŠ¨æ—¶éœ€è¦æ‰§è¡Œçš„å‘½ä»¤"><a href="#8-å®¹å™¨å¯åŠ¨æ—¶éœ€è¦æ‰§è¡Œçš„å‘½ä»¤" class="headerlink" title="8.å®¹å™¨å¯åŠ¨æ—¶éœ€è¦æ‰§è¡Œçš„å‘½ä»¤"></a>8.å®¹å™¨å¯åŠ¨æ—¶éœ€è¦æ‰§è¡Œçš„å‘½ä»¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">CMD [<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;-version&quot;</span>]<br><br></code></pre></td></tr></table></figure><h2 id="äºŒã€ä½¿ç”¨aplineé•œåƒå®‰è£…dockerå’Œmongodb-shell"><a href="#äºŒã€ä½¿ç”¨aplineé•œåƒå®‰è£…dockerå’Œmongodb-shell" class="headerlink" title="äºŒã€ä½¿ç”¨aplineé•œåƒå®‰è£…dockerå’Œmongodb-shell"></a>äºŒã€ä½¿ç”¨aplineé•œåƒå®‰è£…dockerå’Œmongodb-shell</h2><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://www.how2shout.com/linux/how-to-install-mongodb-server-on-alpine-linux/">https://www.how2shout.com/linux/how-to-install-mongodb-server-on-alpine-linux/</a><br>æ’ä»¶åœ°å€ï¼š<a href="http://mirrors.aliyun.com/alpine/%E7%89%88%E6%9C%AC/community/">http://mirrors.aliyun.com/alpine/ç‰ˆæœ¬/community/</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; dockerfile &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">FROM alpine:3.16</span><br><span class="hljs-string">RUN echo https://mirrors.aliyun.com/alpine/v3.16/main/ &gt; /etc/apk/repositories &amp;&amp; \</span><br><span class="hljs-string">    echo https://mirrors.aliyun.com/alpine/v3.16/community/ &gt;&gt; /etc/apk/repositories &amp;&amp; \</span><br><span class="hljs-string">    echo https://mirrors.aliyun.com/alpine/v3.9/main/ &gt;&gt; /etc/apk/repositories &amp;&amp; \</span><br><span class="hljs-string">    echo http://mirrors.aliyun.com/alpine/v3.9/community/ &gt;&gt; /etc/apk/repositories</span><br><span class="hljs-string">RUN apk update &amp;&amp; apk upgrade</span><br><span class="hljs-string">RUN apk add bash curl vim docker </span><br><span class="hljs-string">RUN apk add mongodb-tools mongodb</span><br><span class="hljs-string">RUN rm -rf /var/cache/apk/*</span><br><span class="hljs-string">EOF</span><br><br>docker build -t mongo_alpine . <br><br>docker run -itd --name=app -p 10022:22 -p 10080:3000  -v /var/run/docker.sock:/var/run/docker.sock mongo_alpine:latest<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>dockerfile</category>
      
    </categories>
    
    
    <tags>
      
      <tag>dockerfile</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerfileæ–‡ä»¶å®ä¾‹</title>
    <link href="/2023/06/14/docker/dockerfile/dockerfile%E5%AE%9E%E6%88%98/"/>
    <url>/2023/06/14/docker/dockerfile/dockerfile%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="dockerfileæ–‡ä»¶å®ä¾‹"><a href="#dockerfileæ–‡ä»¶å®ä¾‹" class="headerlink" title="dockerfileæ–‡ä»¶å®ä¾‹"></a>dockerfileæ–‡ä»¶å®ä¾‹</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#from ubuntu:æ“ä½œæ­£åœ¨è¿è¡Œçš„åå«ubuntuçš„é•œåƒ</span><br>FROM ubuntu<br><span class="hljs-comment">#åˆ›å»ºå·¥ä½œç›®å½•</span><br>WORKDIR /work<br><span class="hljs-comment">#å°†å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´åˆ°é•œåƒå†…çš„å·¥ä½œç›®å½•ä¸‹</span><br>COPY ./mongodb-database-tools-ubuntu2004-x86_64-100.5.1.tgz /work/<br>COPY ./mongodb-org-shell_5.0.5_amd64.deb /work/<br><span class="hljs-comment">#æ›´æ–°ã€å®‰è£…ä¾èµ–</span><br>RUN apt update &amp;&amp; apt-get update &amp;&amp; apt install -y libcurl4 &amp;&amp; apt install -y libssl1.1<br><span class="hljs-comment">#å®‰è£…ç¨‹åºåŒ…</span><br>RUN dpkg -i /work/mongodb-org-shell_5.0.5_amd64.deb &amp;&amp; tar -xnf /work/mongodb-database-tools-ubuntu2004-x86_64-100.5.1.tgz <br><span class="hljs-comment">#æ›´å</span><br>RUN <span class="hljs-built_in">mv</span> /work/mongodb-database-tools-ubuntu2004-x86_64-100.5.1 /work/mongodb-tools<br><span class="hljs-comment">#è®¾ç½®ç¯å¢ƒå˜é‡</span><br>ENV MONGODB_TOOLS /work/mongodb-tools<br>ENV PATH <span class="hljs-variable">$MONGODB_TOOLS</span>/bin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment">#åˆ é™¤å®‰è£…åŒ…</span><br>RUN <span class="hljs-built_in">rm</span> -rf /work/mongodb-database-tools-ubuntu2004-x86_64-100.5.1.tgz &amp;&amp; <span class="hljs-built_in">rm</span> -rf /work/mongodb-org-shell_5.0.5_amd64.deb<br><br><span class="hljs-comment">#ä¸Šä¼ nodejs</span><br>COPY ./node-v14.10.1-linux-x64.tar.gz /work/<br><span class="hljs-comment">#è§£å‹ã€å¹¶æ›´å</span><br>RUN tar -xnf /work/node-v14.10.1-linux-x64.tar.gz -C /usr/local &amp;&amp; <span class="hljs-built_in">mv</span> /usr/local/node-v14.10.1-linux-x64 /usr/local/node<br><span class="hljs-comment">#è®¾ç½®ç¯å¢ƒå˜é‡</span><br>ENV NODE_HOME=/usr/local/node<br>ENV PATH <span class="hljs-variable">$NODE_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment">#å®‰è£…cwltool</span><br>RUN apt-get install python3-pip -y &amp;&amp; apt-get install cwltool -y<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å½“å‰ç›®å½•çš„-Dockerfile-åˆ›å»ºé•œåƒï¼Œæ ‡ç­¾ä¸º-test-x2F-ubuntu-v1"><a href="#ä½¿ç”¨å½“å‰ç›®å½•çš„-Dockerfile-åˆ›å»ºé•œåƒï¼Œæ ‡ç­¾ä¸º-test-x2F-ubuntu-v1" class="headerlink" title="ä½¿ç”¨å½“å‰ç›®å½•çš„ Dockerfile åˆ›å»ºé•œåƒï¼Œæ ‡ç­¾ä¸º test&#x2F;ubuntu:v1"></a>ä½¿ç”¨å½“å‰ç›®å½•çš„ Dockerfile åˆ›å»ºé•œåƒï¼Œæ ‡ç­¾ä¸º test&#x2F;ubuntu:v1</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker build -t <span class="hljs-built_in">test</span>/ubuntu:v1 . <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>dockerfile</category>
      
    </categories>
    
    
    <tags>
      
      <tag>dockerfile</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¿ç§»dockerå­˜å‚¨ä½ç½®é•œåƒ</title>
    <link href="/2023/06/14/docker/docker%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/%E8%BF%81%E7%A7%BBdocker%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE%E9%95%9C%E5%83%8F/"/>
    <url>/2023/06/14/docker/docker%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/%E8%BF%81%E7%A7%BBdocker%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE%E9%95%9C%E5%83%8F/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="è¿ç§»dockerå­˜å‚¨ä½ç½®é•œåƒ"><a href="#è¿ç§»dockerå­˜å‚¨ä½ç½®é•œåƒ" class="headerlink" title="è¿ç§»dockerå­˜å‚¨ä½ç½®é•œåƒ"></a>è¿ç§»dockerå­˜å‚¨ä½ç½®é•œåƒ</h1><p><code>å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/weixin_42366752/article/details/112231503</code></p><h2 id="1ã€æŸ¥çœ‹é»˜è®¤çš„å®¹å™¨æ•°æ®ä¿å­˜ä½ç½®"><a href="#1ã€æŸ¥çœ‹é»˜è®¤çš„å®¹å™¨æ•°æ®ä¿å­˜ä½ç½®" class="headerlink" title="1ã€æŸ¥çœ‹é»˜è®¤çš„å®¹å™¨æ•°æ®ä¿å­˜ä½ç½®"></a>1ã€æŸ¥çœ‹é»˜è®¤çš„å®¹å™¨æ•°æ®ä¿å­˜ä½ç½®</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker info | grep <span class="hljs-string">&quot;Docker Root Dir&quot;</span><br><span class="hljs-comment">#å¦‚ä¸‹æ˜¾ç¤ºï¼Œä¸€èˆ¬é»˜è®¤ä¸º/varä¸‹</span><br>Docker Root Dir: /var/lib/docker<br></code></pre></td></tr></table></figure><h2 id="2ã€è¿›è¡Œæ•°æ®è¿ç§»ï¼Œè¿ç§»åˆ°çš„è·¯å¾„ä¸ºï¼š-x2F-app-x2F-dockerimages"><a href="#2ã€è¿›è¡Œæ•°æ®è¿ç§»ï¼Œè¿ç§»åˆ°çš„è·¯å¾„ä¸ºï¼š-x2F-app-x2F-dockerimages" class="headerlink" title="2ã€è¿›è¡Œæ•°æ®è¿ç§»ï¼Œè¿ç§»åˆ°çš„è·¯å¾„ä¸ºï¼š&#x2F;app&#x2F;dockerimages"></a>2ã€è¿›è¡Œæ•°æ®è¿ç§»ï¼Œè¿ç§»åˆ°çš„è·¯å¾„ä¸ºï¼š&#x2F;app&#x2F;dockerimages</h2><h3 id="2-1ã€é¦–å…ˆåœæ‰dockeræœåŠ¡"><a href="#2-1ã€é¦–å…ˆåœæ‰dockeræœåŠ¡" class="headerlink" title="2.1ã€é¦–å…ˆåœæ‰dockeræœåŠ¡"></a>2.1ã€é¦–å…ˆåœæ‰dockeræœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl stop docker.service<br></code></pre></td></tr></table></figure><h3 id="2-2ã€åˆ›å»ºè¿ç§»ç›®å½•ï¼ˆç”¨æ¥æ”¾æ–°æ•°æ®çš„ç›®å½•ï¼‰"><a href="#2-2ã€åˆ›å»ºè¿ç§»ç›®å½•ï¼ˆç”¨æ¥æ”¾æ–°æ•°æ®çš„ç›®å½•ï¼‰" class="headerlink" title="2.2ã€åˆ›å»ºè¿ç§»ç›®å½•ï¼ˆç”¨æ¥æ”¾æ–°æ•°æ®çš„ç›®å½•ï¼‰"></a>2.2ã€åˆ›å»ºè¿ç§»ç›®å½•ï¼ˆç”¨æ¥æ”¾æ–°æ•°æ®çš„ç›®å½•ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /app/dockerimages<br></code></pre></td></tr></table></figure><h3 id="2-3ã€æ•°æ®è¿ç§»"><a href="#2-3ã€æ•°æ®è¿ç§»" class="headerlink" title="2.3ã€æ•°æ®è¿ç§»"></a>2.3ã€æ•°æ®è¿ç§»</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">rsync -avz /var/lib/docker/ /app/dockerimages/<br></code></pre></td></tr></table></figure><h3 id="2-4ã€ä¿®æ”¹dockerä¸‹è½½çš„é»˜è®¤åœ°å€åˆ°-x2F-app-x2F-dockerimagesä¸‹"><a href="#2-4ã€ä¿®æ”¹dockerä¸‹è½½çš„é»˜è®¤åœ°å€åˆ°-x2F-app-x2F-dockerimagesä¸‹" class="headerlink" title="2.4ã€ä¿®æ”¹dockerä¸‹è½½çš„é»˜è®¤åœ°å€åˆ°&#x2F;app&#x2F;dockerimagesä¸‹"></a>2.4ã€ä¿®æ”¹dockerä¸‹è½½çš„é»˜è®¤åœ°å€åˆ°&#x2F;app&#x2F;dockerimagesä¸‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/docker/daemon.json<br>&#123;<br>    <span class="hljs-string">&quot;data-root&quot;</span>: <span class="hljs-string">&quot;/app/dockerimages/&quot;</span>  <span class="hljs-comment">#æ·»åŠ ä¸€è¡Œ</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-5ã€é‡å¯æœåŠ¡"><a href="#2-5ã€é‡å¯æœåŠ¡" class="headerlink" title="2.5ã€é‡å¯æœåŠ¡"></a>2.5ã€é‡å¯æœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart docker.service<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>dockeré—®é¢˜è§£å†³</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerç³»ç»Ÿæ¸…ç†</title>
    <link href="/2023/06/13/docker/docker%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/Docker%E6%B8%85%E7%90%86%E6%95%B0%E6%8D%AE%E3%80%81%E9%95%9C%E5%83%8F/"/>
    <url>/2023/06/13/docker/docker%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/Docker%E6%B8%85%E7%90%86%E6%95%B0%E6%8D%AE%E3%80%81%E9%95%9C%E5%83%8F/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Dockerç³»ç»Ÿæ¸…ç†"><a href="#Dockerç³»ç»Ÿæ¸…ç†" class="headerlink" title="Dockerç³»ç»Ÿæ¸…ç†"></a>Dockerç³»ç»Ÿæ¸…ç†</h1><h2 id="ä¸€ã€æŸ¥çœ‹é•œåƒåŠå®¹å™¨ç£ç›˜å ç”¨æƒ…å†µï¼šdocker-system-dfå‘½ä»¤"><a href="#ä¸€ã€æŸ¥çœ‹é•œåƒåŠå®¹å™¨ç£ç›˜å ç”¨æƒ…å†µï¼šdocker-system-dfå‘½ä»¤" class="headerlink" title="ä¸€ã€æŸ¥çœ‹é•œåƒåŠå®¹å™¨ç£ç›˜å ç”¨æƒ…å†µï¼šdocker system dfå‘½ä»¤"></a>ä¸€ã€æŸ¥çœ‹é•œåƒåŠå®¹å™¨ç£ç›˜å ç”¨æƒ…å†µï¼šdocker system dfå‘½ä»¤</h2><p>æä¾›Dockeræ•´ä½“ç£ç›˜ä½¿ç”¨ç‡çš„æ¦‚å†µï¼ŒåŒ…æ‹¬é•œåƒã€å®¹å™¨å’Œï¼ˆæœ¬åœ°ï¼‰volumeã€‚æ‰€ä»¥æˆ‘ä»¬ç°åœ¨éšæ—¶éƒ½å¯ä»¥æŸ¥çœ‹Dockerä½¿ç”¨äº†å¤šå°‘èµ„æº</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker system <span class="hljs-built_in">df</span><br></code></pre></td></tr></table></figure><h2 id="äºŒã€æ¸…ç†ç£ç›˜ï¼Œåˆ é™¤å…³é—­çš„å®¹å™¨ã€æ— ç”¨çš„æ•°æ®å·å’Œç½‘ç»œï¼Œä»¥åŠdanglingé•œåƒï¼ˆå³æ— tagçš„é•œåƒï¼‰-ï¼šdocker-system-pruneå‘½ä»¤"><a href="#äºŒã€æ¸…ç†ç£ç›˜ï¼Œåˆ é™¤å…³é—­çš„å®¹å™¨ã€æ— ç”¨çš„æ•°æ®å·å’Œç½‘ç»œï¼Œä»¥åŠdanglingé•œåƒï¼ˆå³æ— tagçš„é•œåƒï¼‰-ï¼šdocker-system-pruneå‘½ä»¤" class="headerlink" title="äºŒã€æ¸…ç†ç£ç›˜ï¼Œåˆ é™¤å…³é—­çš„å®¹å™¨ã€æ— ç”¨çš„æ•°æ®å·å’Œç½‘ç»œï¼Œä»¥åŠdanglingé•œåƒï¼ˆå³æ— tagçš„é•œåƒï¼‰ ï¼šdocker system pruneå‘½ä»¤"></a>äºŒã€æ¸…ç†ç£ç›˜ï¼Œåˆ é™¤å…³é—­çš„å®¹å™¨ã€æ— ç”¨çš„æ•°æ®å·å’Œç½‘ç»œï¼Œä»¥åŠdanglingé•œåƒï¼ˆå³æ— tagçš„é•œåƒï¼‰ ï¼šdocker system pruneå‘½ä»¤</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker system prune<br><span class="hljs-comment">#æ³¨æ„ï¼šè°¨æ…ä½¿ç”¨!å°†ä¼šåˆ é™¤æ‰€æœ‰å…³é—­çš„å®¹å™¨ä»¥åŠdanglingé•œåƒ</span><br></code></pre></td></tr></table></figure><p>å‘½ä»¤æ¸…ç†å¾—æ›´åŠ å½»åº•ï¼Œå°†æ²¡æœ‰å®¹å™¨ä½¿ç”¨Dockeré•œåƒéƒ½åˆ æ‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker system prune -a <br><span class="hljs-comment">#æ³¨æ„ï¼šè¿™ä¸¤ä¸ªå‘½ä»¤ä¼šæŠŠä½ æš‚æ—¶å…³é—­çš„å®¹å™¨ï¼Œä»¥åŠæš‚æ—¶æ²¡æœ‰ç”¨åˆ°çš„Dockeré•œåƒéƒ½åˆ æ‰äº†ã€‚</span><br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€æ‰‹åŠ¨åˆ é™¤"><a href="#ä¸‰ã€æ‰‹åŠ¨åˆ é™¤" class="headerlink" title="ä¸‰ã€æ‰‹åŠ¨åˆ é™¤"></a>ä¸‰ã€æ‰‹åŠ¨åˆ é™¤</h2><p>åˆ é™¤æ‰€æœ‰å…³é—­çš„å®¹å™¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker ps -a | grep Exit | <span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27; &#x27;</span> -f 1 | xargs docker <span class="hljs-built_in">rm</span><br></code></pre></td></tr></table></figure><p>åˆ é™¤æ‰€æœ‰danglingé•œåƒï¼ˆå³æ— tagçš„é•œåƒï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker rmi $(docker images | grep <span class="hljs-string">&quot;^&lt;none&gt;&quot;</span> | awk <span class="hljs-string">&quot;&#123;print <span class="hljs-variable">$3</span>&#125;&quot;</span>)<br></code></pre></td></tr></table></figure><p>åˆ é™¤æ‰€æœ‰danglingæ•°æ®å·ï¼ˆå³æ— ç”¨çš„Volumeï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker volume <span class="hljs-built_in">rm</span> $(docker volume <span class="hljs-built_in">ls</span> -qf dangling=<span class="hljs-literal">true</span>)<br></code></pre></td></tr></table></figure><h2 id="å››ã€dockeræ¸…ç†é•œåƒï¼Œåªä¿ç•™æœ€è¿‘ä¸‰ä¸ªé•œåƒ"><a href="#å››ã€dockeræ¸…ç†é•œåƒï¼Œåªä¿ç•™æœ€è¿‘ä¸‰ä¸ªé•œåƒ" class="headerlink" title="å››ã€dockeræ¸…ç†é•œåƒï¼Œåªä¿ç•™æœ€è¿‘ä¸‰ä¸ªé•œåƒ"></a>å››ã€dockeræ¸…ç†é•œåƒï¼Œåªä¿ç•™æœ€è¿‘ä¸‰ä¸ªé•œåƒ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker images | grep <span class="hljs-string">&quot;test-web&quot;</span>  | awk <span class="hljs-string">&#x27;(NR&gt;3)&#123;print&#125;&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs docker rmi<br></code></pre></td></tr></table></figure><h3 id="é€šè¿‡è·å–é•œåƒåå’Œtagç»„åˆæ¸…ç†é•œåƒï¼Œåªä¿ç•™æœ€è¿‘10ä¸ª"><a href="#é€šè¿‡è·å–é•œåƒåå’Œtagç»„åˆæ¸…ç†é•œåƒï¼Œåªä¿ç•™æœ€è¿‘10ä¸ª" class="headerlink" title="é€šè¿‡è·å–é•œåƒåå’Œtagç»„åˆæ¸…ç†é•œåƒï¼Œåªä¿ç•™æœ€è¿‘10ä¸ª"></a>é€šè¿‡è·å–é•œåƒåå’Œtagç»„åˆæ¸…ç†é•œåƒï¼Œåªä¿ç•™æœ€è¿‘10ä¸ª</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker images --format <span class="hljs-string">&quot;&#123;&#123;.Repository&#125;&#125;:&#123;&#123;.Tag&#125;&#125;&quot;</span> | grep <span class="hljs-string">&quot;119.8.45.188:5000/test&quot;</span> | awk <span class="hljs-string">&#x27;(NR&gt;10)&#123;print&#125;&#x27;</span> | xargs docker rmi<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>dockeré—®é¢˜è§£å†³</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerå‘½ä»¤è‡ªåŠ¨è¡¥å…¨</title>
    <link href="/2023/06/12/docker/docker%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/docker%E5%91%BD%E4%BB%A4%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8/"/>
    <url>/2023/06/12/docker/docker%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/docker%E5%91%BD%E4%BB%A4%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="dockerå‘½ä»¤è‡ªåŠ¨è¡¥å…¨"><a href="#dockerå‘½ä»¤è‡ªåŠ¨è¡¥å…¨" class="headerlink" title="dockerå‘½ä»¤è‡ªåŠ¨è¡¥å…¨"></a>dockerå‘½ä»¤è‡ªåŠ¨è¡¥å…¨</h1><h2 id="1-å®‰è£…ä¾èµ–å·¥å…·bash-complete"><a href="#1-å®‰è£…ä¾èµ–å·¥å…·bash-complete" class="headerlink" title="1.å®‰è£…ä¾èµ–å·¥å…·bash-complete"></a>1.å®‰è£…ä¾èµ–å·¥å…·bash-complete</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y bash-completion<br></code></pre></td></tr></table></figure><h2 id="2-åˆ·æ–°è®©å…¶ç”Ÿæ•ˆ"><a href="#2-åˆ·æ–°è®©å…¶ç”Ÿæ•ˆ" class="headerlink" title="2.åˆ·æ–°è®©å…¶ç”Ÿæ•ˆ"></a>2.åˆ·æ–°è®©å…¶ç”Ÿæ•ˆ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /usr/share/bash-completion/bash_completion<br><span class="hljs-built_in">source</span> /usr/share/bash-completion/completions/docker<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>dockeré—®é¢˜è§£å†³</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker overlay å ç”¨ç£ç›˜ 100% çš„é—®é¢˜</title>
    <link href="/2023/06/11/docker/docker%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/Docker_overlay%E5%8D%A0%E7%94%A8%E7%A3%81%E7%9B%98100%25%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2023/06/11/docker/docker%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/Docker_overlay%E5%8D%A0%E7%94%A8%E7%A3%81%E7%9B%98100%25%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Docker-overlay-å ç”¨ç£ç›˜-100-çš„é—®é¢˜"><a href="#Docker-overlay-å ç”¨ç£ç›˜-100-çš„é—®é¢˜" class="headerlink" title="Docker overlay å ç”¨ç£ç›˜ 100% çš„é—®é¢˜"></a>Docker overlay å ç”¨ç£ç›˜ 100% çš„é—®é¢˜</h1><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://zhuanlan.zhihu.com/p/444358715">https://zhuanlan.zhihu.com/p/444358715</a></p><h2 id="1-æ’æŸ¥å®¹å™¨æ ‡å‡†è¾“å‡ºçš„æ—¥å¿—"><a href="#1-æ’æŸ¥å®¹å™¨æ ‡å‡†è¾“å‡ºçš„æ—¥å¿—" class="headerlink" title="1.æ’æŸ¥å®¹å™¨æ ‡å‡†è¾“å‡ºçš„æ—¥å¿—"></a>1.æ’æŸ¥å®¹å™¨æ ‡å‡†è¾“å‡ºçš„æ—¥å¿—</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(docker ps -q ); <span class="hljs-keyword">do</span> <br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ContainerID: <span class="hljs-variable">$i</span>&quot;</span>; <br>  <span class="hljs-built_in">ls</span> -alh $(docker inspect <span class="hljs-variable">$i</span> | grep LogPath|awk -F <span class="hljs-string">&quot;\&quot;&quot;</span> <span class="hljs-string">&#x27;&#123;print $4&#125;&#x27;</span>);<br><span class="hljs-keyword">done</span>;<br></code></pre></td></tr></table></figure><p>ä¸šåŠ¡ä¸­å¾€å¾€å›å› ä¸ºä¸€äº›ç¯å¢ƒé—®é¢˜å¯¼è‡´æ—¥å¿—å ç”¨è¿‡å¤šçš„ç£ç›˜ï¼Œä¸Šé¢çš„è¿™æ¡å‘½ä»¤ä¼šæ‰“å°å‡ºæ¯ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨æ ‡å‡†è¾“å‡ºæ—¥å¿—å ç”¨çš„ç£ç›˜ç©ºé—´ï¼Œå¯ä»¥é€‰æ‹©è¶…è¿‡ä¸€å®šä½“ç§¯ï¼ˆæ¯”å¦‚ 1Gï¼‰çš„æ—¥å¿—æ–‡ä»¶æƒ…å†µï¼Œæƒ…å†µçš„æ–¹å¼å¯ä»¥å¾ˆç²—æš´ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span> &gt; <span class="hljs-variable">$dockerLogFile</span><br></code></pre></td></tr></table></figure><h2 id="2-æ’æŸ¥å®¹å™¨çš„ç£ç›˜å ç”¨"><a href="#2-æ’æŸ¥å®¹å™¨çš„ç£ç›˜å ç”¨" class="headerlink" title="2. æ’æŸ¥å®¹å™¨çš„ç£ç›˜å ç”¨"></a>2. æ’æŸ¥å®¹å™¨çš„ç£ç›˜å ç”¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">cd</span> /var/lib/docker/containers<br>$ <span class="hljs-built_in">du</span> -a --max-depth=1 | <span class="hljs-built_in">sort</span> -nr | <span class="hljs-built_in">head</span> -5<br>726600  .<br>296768  ./027e88e285c1190465d87cbd222feb7fbc7fc32908d42d80807dd6a58de49c38<br>279104  ./0ef2b533543a65b55ea5e1ea438d17245071b0478f4692f8095945b6ad64d1c6<br>121056  ./8722eda85916edf618440ae1a01bfd03553ab7c8bd5a92164714fec32ef12f0c<br>9736    ./dcd939166e13d2db889cdaecc1af7d71f2de9c515541ca43a853dd745cf8002f<br></code></pre></td></tr></table></figure><p>æ’é™¤æ—¥å¿—æ–‡ä»¶å¼‚å¸¸å ç”¨ç£ç›˜é—®é¢˜å¤–ï¼Œå¯ä»¥é€šè¿‡ä¸Šé¢çš„å‘½ä»¤ä¸»è¦é€šè¿‡æ£€æŸ¥å®¹å™¨å ç”¨ç£ç›˜ç©ºé—´æ¥æ‰¾é”…ï¼Œå®šä½åˆ°å®¹å™¨åï¼Œè¿›å…¥å®¹å™¨å†…ï¼Œé€šè¿‡ df -h &#x2F; du -ah ç­‰å‘½ä»¤å°±å¯ä»¥æ‰¾åˆ°å®¹å™¨å†…éƒ¨çš„å¤§æ–‡ä»¶ã€‚</p><h2 id="3-ä»¥ä¸‹çš„è¿™äº›æ˜¯æˆ‘åœ¨å¾—åˆ°ä¸Šè¿°ä¸¤æ­¥å¤„ç†æ–¹æ¡ˆä¹‹å‰èµ°è¿‡çš„è·¯"><a href="#3-ä»¥ä¸‹çš„è¿™äº›æ˜¯æˆ‘åœ¨å¾—åˆ°ä¸Šè¿°ä¸¤æ­¥å¤„ç†æ–¹æ¡ˆä¹‹å‰èµ°è¿‡çš„è·¯" class="headerlink" title="3. ä»¥ä¸‹çš„è¿™äº›æ˜¯æˆ‘åœ¨å¾—åˆ°ä¸Šè¿°ä¸¤æ­¥å¤„ç†æ–¹æ¡ˆä¹‹å‰èµ°è¿‡çš„è·¯"></a>3. ä»¥ä¸‹çš„è¿™äº›æ˜¯æˆ‘åœ¨å¾—åˆ°ä¸Šè¿°ä¸¤æ­¥å¤„ç†æ–¹æ¡ˆä¹‹å‰èµ°è¿‡çš„è·¯</h2><p>ç›®å‰é‡åˆ°çš„æƒ…å†µæ˜¯ docker çš„ overlay å ç”¨ç£ç›˜ç©ºé—´è¿‡å¤šï¼Œé€šè¿‡ df -h å‘½ä»¤æŸ¥çœ‹æ—¶ï¼Œæœ‰å¤šä¸ªæ–‡ä»¶å¤¹æç¤ºç£ç›˜å ç”¨ç‡è¾¾åˆ° 100%,ä½†å®é™…ä¸Šä¸æ˜¯æ¯ä¸ªæ–‡ä»¶å¤¹éƒ½æœ‰é‚£ä¹ˆå¤§çš„ä½“ç§¯ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªæˆ–æŸå‡ ä¸ªæœ‰å¾ˆå¤§çš„ç£ç›˜å ç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬æœ€ä¸»è¦çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ç£ç›˜å ç”¨å¤§çš„ docker å®¹å™¨ï¼Œç„¶åæŸ¥æ‰¾å ç”¨ç£ç›˜é«˜çš„åŸå› ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æ‰¾åˆ°ç£ç›˜é«˜å ç”¨çš„å®¹å™¨æ•°æ®å·</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">du</span> -ah --max-depth=1 $(<span class="hljs-built_in">df</span> -h| grep <span class="hljs-string">&quot;100%&quot;</span> | grep -v <span class="hljs-string">&quot;/dev&quot;</span> | awk <span class="hljs-string">&#x27;&#123;print $6&#125;&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†å…·ä½“æ˜¯å“ªä¸ªæ–‡ä»¶å¤¹å ç”¨äº†å¤§é‡çš„ç£ç›˜ç©ºé—´ï¼Œä½†æ˜¯ä¸çŸ¥é“è¿™ä¸ªæ–‡ä»¶å¤¹å±äºå“ªä¸ªå®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è·å–åˆ°å¯¹åº”å®¹å™¨ä¿¡æ¯:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ docker ps -qa | \<br>    xargs docker inspect --format <span class="hljs-string">&#x27;&#123;&#123;.State.Pid&#125;&#125;, &#123;&#123;.Id&#125;&#125;, &#123;&#123;.Name&#125;&#125;, &#123;&#123;.GraphDriver.Data.WorkDir&#125;&#125;&#x27;</span> | \<br>    grep <span class="hljs-string">&quot;684f534ba9f0852967dc1e979756ecc38355ab0dcebb748d39becebe85cc2fae&quot;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‘½ä»¤ä¼šæ‰“å°å‡ºè¿™ä¸ªæŒ‚è½½å·å¯¹åº”çš„å®¹å™¨ä¿¡æ¯ï¼Œè‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä½åˆ°æ—¶é‚£æ¡ä¸šåŠ¡çº¿å‡ºäº†é—®é¢˜ï¼Œæ˜¯å¼‚å¸¸å¯¼è‡´å¤§é‡æ‰“å°æ—¥å¿—ï¼Ÿè¿˜æ˜¯ç³»ç»Ÿç‰¹æ€§éœ€è¦å¾ˆå¤§ç©ºé—´ï¼Ÿå†æ ¹æ®æƒ…å†µå¤„ç†ç£ç›˜ç©ºé—´ä¸è¶³çš„é—®é¢˜</p><p>é€šè¿‡è¿™ä¸ªå‘½ä»¤å¯ä»¥æ‰¾åˆ°å½“å‰ç›®å½•ä¸‹ç£ç›˜å ç”¨å‰äº”çš„æ–‡ä»¶å¤¹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">du</span> -s * | <span class="hljs-built_in">sort</span> -nr | <span class="hljs-built_in">head</span> -5<br></code></pre></td></tr></table></figure><p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯ä»¥è¿‡æ»¤å‡ºå«æœ‰è¯¥ç£ç›˜é«˜å ç”¨æ–‡ä»¶å¤¹çš„å®¹å™¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(docker ps -q );<span class="hljs-keyword">do</span> <br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;echo <span class="hljs-variable">$i</span>&quot;</span><br>  docker inspect <span class="hljs-variable">$i</span>|grep 65f21502d1c560054539ac1d8d12b97d0951e3e4c3f068889cd8b91ef8bca444; <br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>å½“æŸ¥äº†æ‰€æœ‰æ–‡ä»¶æ²¡æœ‰å‘ç°å¤§æ–‡ä»¶ï¼Œè€Œç£ç›˜å ç”¨åˆå·¨é«˜ï¼Œé‚£å°±å°è¯•ä¸‹é‡å¯ docker æœåŠ¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ service docker stop <br>$ service docker start<br></code></pre></td></tr></table></figure><p>å»ºè®®ä¸è¦ restartï¼Œè€Œæ˜¯ stop ä¹‹ååœ¨ start</p><p>æœ€åå‘ç°æˆ‘ä»¬æµ‹è¯•ç¯å¢ƒç£ç›˜å ç”¨ä¸»è¦æ˜¯ç¨‹åºå¤„ç† rabbitmq çš„æ¶ˆæ¯å¤±è´¥ï¼Œrabbitmq ä¸€ç›´ä¼šæ´¾å‘éœ€è¦é‡è¯•çš„äº‹ä»¶è€Œæ‰“å°äº†å¤§é‡çš„debugæ—¥å¿—ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>dockeré—®é¢˜è§£å†³</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerå›¾å½¢åŒ–å·¥å…·Portainer</title>
    <link href="/2023/06/10/docker/docker%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/Docker%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%B7%A5%E5%85%B7Portainer/"/>
    <url>/2023/06/10/docker/docker%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/Docker%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%B7%A5%E5%85%B7Portainer/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Docker-å›¾å½¢åŒ–å·¥å…·-Portainer"><a href="#Docker-å›¾å½¢åŒ–å·¥å…·-Portainer" class="headerlink" title="Docker å›¾å½¢åŒ–å·¥å…· Portainer:"></a>Docker å›¾å½¢åŒ–å·¥å…· Portainer:</h1><p>å‚è€ƒæ–‡æ¡£ï¼š<code>https://blog.csdn.net/m0_67900727/article/details/123550536</code></p><p>Portainer æ˜¯ä¸€æ¬¾è½»é‡çº§çš„åº”ç”¨ï¼Œå®ƒæä¾›äº†å›¾å½¢åŒ–ç•Œé¢ï¼Œç”¨äºæ–¹ä¾¿åœ°ç®¡ç†Dockerç¯å¢ƒï¼ŒåŒ…æ‹¬å•æœºç¯å¢ƒå’Œé›†ç¾¤ç¯å¢ƒã€‚</p><h2 id="docker-compose-yamlæ–‡ä»¶ï¼šï¼ˆåªé€‚ç”¨äºå•èŠ‚ç‚¹-å¤šèŠ‚ç‚¹ä½¿ç”¨swarmï¼‰"><a href="#docker-compose-yamlæ–‡ä»¶ï¼šï¼ˆåªé€‚ç”¨äºå•èŠ‚ç‚¹-å¤šèŠ‚ç‚¹ä½¿ç”¨swarmï¼‰" class="headerlink" title="docker-compose.yamlæ–‡ä»¶ï¼šï¼ˆåªé€‚ç”¨äºå•èŠ‚ç‚¹,å¤šèŠ‚ç‚¹ä½¿ç”¨swarmï¼‰"></a>docker-compose.yamlæ–‡ä»¶ï¼šï¼ˆåªé€‚ç”¨äºå•èŠ‚ç‚¹,å¤šèŠ‚ç‚¹ä½¿ç”¨swarmï¼‰</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.2&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">agent:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">registry.edoc2.com:5000/edoc2v5/portainer-agent:v2.0</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-comment"># REQUIRED: Should be equal to the service name prefixed by &quot;tasks.&quot; when</span><br>      <span class="hljs-comment"># deployed inside an overlay network</span><br>      <span class="hljs-comment">#AGENT_CLUSTER_ADDR: tasks.agent</span><br>      <span class="hljs-attr">AGENT_CLUSTER_ADDR:</span> <span class="hljs-string">agent</span><br>      <span class="hljs-attr">CAP_HOST_MANAGEMENT:</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">AGENT_PORT:</span> <span class="hljs-number">9001</span><br>      <span class="hljs-attr">LOG_LEVEL:</span> <span class="hljs-string">debug</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run/docker.sock:/var/run/docker.sock</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/lib/docker/volumes:/var/lib/docker/volumes</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">agent_network</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">mode:</span> <span class="hljs-string">global</span><br>      <span class="hljs-attr">placement:</span><br>        <span class="hljs-attr">constraints:</span> [<span class="hljs-string">node.platform.os</span> <span class="hljs-string">==</span> <span class="hljs-string">linux</span>]<br><br>  <span class="hljs-attr">portainer:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">registry.edoc2.com:5000/edoc2v5/portainer-ce:v2.0</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">-H</span> <span class="hljs-string">tcp://agent:9001</span> <span class="hljs-string">--tlsskipverify</span> <br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9000:9000&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8000:8000&quot;</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">agent_network</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">mode:</span> <span class="hljs-string">replicated</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">placement:</span><br>        <span class="hljs-attr">constraints:</span> [<span class="hljs-string">node.labels.nodeportainer</span> <span class="hljs-string">==</span> <span class="hljs-string">Portainer</span>]<br>    <br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">agent_network:</span><br><span class="hljs-comment">#    driver: overlay</span><br>    <span class="hljs-attr">attachable:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>dockeré—®é¢˜è§£å†³</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>docker-compose</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ¶ä½œwindowsé•œåƒå¯¼å…¥è…¾è®¯äº‘</title>
    <link href="/2023/06/09/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/windows-server/%E5%88%B6%E4%BD%9Cwindows%E9%95%9C%E5%83%8F%E5%AF%BC%E5%85%A5%E8%85%BE%E8%AE%AF%E4%BA%91/"/>
    <url>/2023/06/09/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/windows-server/%E5%88%B6%E4%BD%9Cwindows%E9%95%9C%E5%83%8F%E5%AF%BC%E5%85%A5%E8%85%BE%E8%AE%AF%E4%BA%91/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="åˆ¶ä½œwindowsé•œåƒå¯¼å…¥è…¾è®¯äº‘"><a href="#åˆ¶ä½œwindowsé•œåƒå¯¼å…¥è…¾è®¯äº‘" class="headerlink" title="åˆ¶ä½œwindowsé•œåƒå¯¼å…¥è…¾è®¯äº‘"></a>åˆ¶ä½œwindowsé•œåƒå¯¼å…¥è…¾è®¯äº‘</h1><h2 id="ä¸€ã€å®‰è£…å‰ï¼šåˆ¶ä½œé•œåƒæ—¶ï¼Œå»ºè®®ä½¿ç”¨åŸç‰ˆçº¯å‡€é•œåƒ"><a href="#ä¸€ã€å®‰è£…å‰ï¼šåˆ¶ä½œé•œåƒæ—¶ï¼Œå»ºè®®ä½¿ç”¨åŸç‰ˆçº¯å‡€é•œåƒ" class="headerlink" title="ä¸€ã€å®‰è£…å‰ï¼šåˆ¶ä½œé•œåƒæ—¶ï¼Œå»ºè®®ä½¿ç”¨åŸç‰ˆçº¯å‡€é•œåƒ"></a>ä¸€ã€å®‰è£…å‰ï¼šåˆ¶ä½œé•œåƒæ—¶ï¼Œå»ºè®®ä½¿ç”¨åŸç‰ˆçº¯å‡€é•œåƒ</h2><p>é•œåƒä¸‹è½½åœ°å€ï¼ˆå›½å†…ï¼‰ï¼š<a href="https://hellowindows.cn/">https://hellowindows.cn/</a></p><h3 id="1-é•œåƒä¸èƒ½ä½¿ç”¨EFIæ–¹å¼å¯åŠ¨ï¼Œä¿®æ”¹è™šæ‹Ÿæœºè®¾ç½®ï¼š"><a href="#1-é•œåƒä¸èƒ½ä½¿ç”¨EFIæ–¹å¼å¯åŠ¨ï¼Œä¿®æ”¹è™šæ‹Ÿæœºè®¾ç½®ï¼š" class="headerlink" title="1.é•œåƒä¸èƒ½ä½¿ç”¨EFIæ–¹å¼å¯åŠ¨ï¼Œä¿®æ”¹è™šæ‹Ÿæœºè®¾ç½®ï¼š"></a>1.é•œåƒä¸èƒ½ä½¿ç”¨EFIæ–¹å¼å¯åŠ¨ï¼Œä¿®æ”¹è™šæ‹Ÿæœºè®¾ç½®ï¼š</h3><p><img src="/2023/06/09/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/windows-server/%E5%88%B6%E4%BD%9Cwindows%E9%95%9C%E5%83%8F%E5%AF%BC%E5%85%A5%E8%85%BE%E8%AE%AF%E4%BA%91/image-20231106142349554.png" alt="image-20231106142349554"></p><h3 id="2-ä½¿ç”¨vmè™šæ‹Ÿæœºæ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœºã€åœ¨å®‰è£…æ“ä½œç³»ç»Ÿ-é€‰æ‹©â€œè‡ªå®šä¹‰å®‰è£…æ—¶â€æç¤ºï¼šWindowsæ— æ³•å®‰è£…åˆ°è¿™ä¸ªç£ç›˜-é€‰ä¸­çš„ç£ç›˜é‡‡ç”¨gptåˆ†åŒºå½¢å¼ã€‚ï¼ˆGPTæ ¼å¼ä¸èƒ½ä¸Šäº‘ï¼ï¼‰"><a href="#2-ä½¿ç”¨vmè™šæ‹Ÿæœºæ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœºã€åœ¨å®‰è£…æ“ä½œç³»ç»Ÿ-é€‰æ‹©â€œè‡ªå®šä¹‰å®‰è£…æ—¶â€æç¤ºï¼šWindowsæ— æ³•å®‰è£…åˆ°è¿™ä¸ªç£ç›˜-é€‰ä¸­çš„ç£ç›˜é‡‡ç”¨gptåˆ†åŒºå½¢å¼ã€‚ï¼ˆGPTæ ¼å¼ä¸èƒ½ä¸Šäº‘ï¼ï¼‰" class="headerlink" title="2.ä½¿ç”¨vmè™šæ‹Ÿæœºæ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœºã€åœ¨å®‰è£…æ“ä½œç³»ç»Ÿ-é€‰æ‹©â€œè‡ªå®šä¹‰å®‰è£…æ—¶â€æç¤ºï¼šWindowsæ— æ³•å®‰è£…åˆ°è¿™ä¸ªç£ç›˜,é€‰ä¸­çš„ç£ç›˜é‡‡ç”¨gptåˆ†åŒºå½¢å¼ã€‚ï¼ˆGPTæ ¼å¼ä¸èƒ½ä¸Šäº‘ï¼ï¼‰"></a>2.ä½¿ç”¨vmè™šæ‹Ÿæœºæ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœºã€åœ¨å®‰è£…æ“ä½œç³»ç»Ÿ-é€‰æ‹©â€œè‡ªå®šä¹‰å®‰è£…æ—¶â€æç¤ºï¼šWindowsæ— æ³•å®‰è£…åˆ°è¿™ä¸ªç£ç›˜,é€‰ä¸­çš„ç£ç›˜é‡‡ç”¨gptåˆ†åŒºå½¢å¼ã€‚ï¼ˆ<strong>GPTæ ¼å¼ä¸èƒ½ä¸Šäº‘ï¼</strong>ï¼‰</h3><h4 id="æ“ä½œæ–¹å¼ï¼šåœ¨é”®ç›˜ä¸ŠæŒ‰ä¸‹â€œShift-F10â€ç»„åˆé”®ï¼Œå¼¹å‡ºCMDå‘½ä»¤æç¤ºç¬¦çª—å£ï¼š"><a href="#æ“ä½œæ–¹å¼ï¼šåœ¨é”®ç›˜ä¸ŠæŒ‰ä¸‹â€œShift-F10â€ç»„åˆé”®ï¼Œå¼¹å‡ºCMDå‘½ä»¤æç¤ºç¬¦çª—å£ï¼š" class="headerlink" title="æ“ä½œæ–¹å¼ï¼šåœ¨é”®ç›˜ä¸ŠæŒ‰ä¸‹â€œShift+F10â€ç»„åˆé”®ï¼Œå¼¹å‡ºCMDå‘½ä»¤æç¤ºç¬¦çª—å£ï¼š"></a>æ“ä½œæ–¹å¼ï¼šåœ¨é”®ç›˜ä¸ŠæŒ‰ä¸‹â€œShift+F10â€ç»„åˆé”®ï¼Œå¼¹å‡ºCMDå‘½ä»¤æç¤ºç¬¦çª—å£ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br>1ã€è¾“å…¥â€œlist diskâ€ï¼Œå›è½¦é”®ç¡®å®šï¼›<br><span class="hljs-comment">#ä¼šåˆ—å‡ºæ‰€æœ‰çš„ç£ç›˜ï¼Œè®°ä½è‡ªå·±ç¡¬ç›˜çš„ç£ç›˜å·ï¼Œé€šè¿‡å®¹é‡å¤§å°å°±å¯ä»¥åˆ†è¾¨äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç£ç›˜0å°±æ˜¯æˆ‘ä»¬çš„ç¡¬ç›˜ï¼Œç£ç›˜1å°±æ˜¯Uç›˜</span><br><br><br>2ã€è¾“å…¥â€œselect disk 0â€ï¼Œå›è½¦é”®ç¡®å®šï¼›<br><span class="hljs-comment">#é€‰æ‹©ç£ç›˜0ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ç¡¬ç›˜ï¼Œå°±æ˜¯å‡†å¤‡åšç³»ç»Ÿçš„ç¡¬ç›˜</span><br><br>3ã€è¾“å…¥â€œcleanâ€ï¼Œå›è½¦é”®ç¡®å®šï¼›<br><span class="hljs-comment">#æ¸…ç©ºç£ç›˜ï¼Œç›¸å½“äºæ ¼å¼åŒ–å…¨ç›˜</span><br><br>4ã€è¾“å…¥â€œconvert mbrâ€ï¼Œå›è½¦é”®ç¡®å®šï¼›<br><span class="hljs-comment">#å°†è¯¥ç¡¬ç›˜è½¬æ¢ä¸ºmbræ ¼å¼ï¼Œå¦‚æœæƒ³è¦å°†ç¡¬ç›˜è½¬åŒ–ä¸ºgptï¼Œé‚£å°±æ˜¯è¾“å…¥â€œconvert gptâ€ä½†æ˜¯ä¸Šäº‘æ—¶ä¸èƒ½ç”¨gptæ ¼å¼</span><br></code></pre></td></tr></table></figure><p>è™šæ‹Ÿæœºå®‰è£…ç³»ç»Ÿè¿‡ç¨‹å·²ç•¥è¿‡ï¼</p><p><img src="/2023/06/09/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/windows-server/%E5%88%B6%E4%BD%9Cwindows%E9%95%9C%E5%83%8F%E5%AF%BC%E5%85%A5%E8%85%BE%E8%AE%AF%E4%BA%91/image-20231103173929650.png" alt="image-20231103173929650"></p><h2 id="äºŒã€ç³»ç»Ÿå®‰è£…åæ“ä½œï¼š"><a href="#äºŒã€ç³»ç»Ÿå®‰è£…åæ“ä½œï¼š" class="headerlink" title="äºŒã€ç³»ç»Ÿå®‰è£…åæ“ä½œï¼š"></a>äºŒã€ç³»ç»Ÿå®‰è£…åæ“ä½œï¼š</h2><h3 id="1ã€å¼€å¯Administratorè´¦æˆ·ç™»å½•"><a href="#1ã€å¼€å¯Administratorè´¦æˆ·ç™»å½•" class="headerlink" title="1ã€å¼€å¯Administratorè´¦æˆ·ç™»å½•"></a>1ã€å¼€å¯Administratorè´¦æˆ·ç™»å½•</h3><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://www.cnblogs.com/pam-sh/p/12239172.html">https://www.cnblogs.com/pam-sh/p/12239172.html</a></p><h4 id="1-1ã€ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€Windows-PowerShell"><a href="#1-1ã€ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€Windows-PowerShell" class="headerlink" title="1.1ã€ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€Windows-PowerShell"></a>1.1ã€ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€Windows-PowerShell</h4><h4 id="1-2ã€åœ¨å‘½ä»¤æç¤ºç¬¦ä¸­è¾“å…¥å‘½ä»¤â€œnet-user-administrator-x2F-active-yesâ€åå›è½¦"><a href="#1-2ã€åœ¨å‘½ä»¤æç¤ºç¬¦ä¸­è¾“å…¥å‘½ä»¤â€œnet-user-administrator-x2F-active-yesâ€åå›è½¦" class="headerlink" title="1.2ã€åœ¨å‘½ä»¤æç¤ºç¬¦ä¸­è¾“å…¥å‘½ä»¤â€œnet user administrator &#x2F;active:yesâ€åå›è½¦"></a>1.2ã€åœ¨å‘½ä»¤æç¤ºç¬¦ä¸­è¾“å…¥å‘½ä»¤â€œnet user administrator &#x2F;active:yesâ€åå›è½¦</h4><h4 id="1-3ã€administratorç®¡ç†å‘˜è´¦æˆ·å·²å¼€å¯ï¼Œç‚¹å‡»ä»»åŠ¡æ å³å¯åˆ‡æ¢"><a href="#1-3ã€administratorç®¡ç†å‘˜è´¦æˆ·å·²å¼€å¯ï¼Œç‚¹å‡»ä»»åŠ¡æ å³å¯åˆ‡æ¢" class="headerlink" title="1.3ã€administratorç®¡ç†å‘˜è´¦æˆ·å·²å¼€å¯ï¼Œç‚¹å‡»ä»»åŠ¡æ å³å¯åˆ‡æ¢"></a>1.3ã€administratorç®¡ç†å‘˜è´¦æˆ·å·²å¼€å¯ï¼Œç‚¹å‡»ä»»åŠ¡æ å³å¯åˆ‡æ¢</h4><h4 id="1-4ã€åˆ é™¤æ™®é€šè´¦æˆ·ã€ä½¿ç”¨administratorç™»å½•"><a href="#1-4ã€åˆ é™¤æ™®é€šè´¦æˆ·ã€ä½¿ç”¨administratorç™»å½•" class="headerlink" title="1.4ã€åˆ é™¤æ™®é€šè´¦æˆ·ã€ä½¿ç”¨administratorç™»å½•"></a>1.4ã€åˆ é™¤æ™®é€šè´¦æˆ·ã€ä½¿ç”¨administratorç™»å½•</h4><h3 id="2ã€å¼€å¯è¿æ¥è¿œç¨‹"><a href="#2ã€å¼€å¯è¿æ¥è¿œç¨‹" class="headerlink" title="2ã€å¼€å¯è¿æ¥è¿œç¨‹"></a>2ã€å¼€å¯è¿æ¥è¿œç¨‹</h3><p>è®¾ç½®&gt;-ç³»ç»Ÿ&gt;-è¿œç¨‹æ¡Œé¢&#x3D;å¯ç”¨è¿œç¨‹æ¡Œé¢</p><p><img src="/2023/06/09/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/windows-server/%E5%88%B6%E4%BD%9Cwindows%E9%95%9C%E5%83%8F%E5%AF%BC%E5%85%A5%E8%85%BE%E8%AE%AF%E4%BA%91/image-20231103174725152.png" alt="image-20231103174725152"></p><h3 id="ä¸‰ã€å®‰è£…è…¾è®¯äº‘ç›¸å…³ä¾èµ–æ’ä»¶"><a href="#ä¸‰ã€å®‰è£…è…¾è®¯äº‘ç›¸å…³ä¾èµ–æ’ä»¶" class="headerlink" title="ä¸‰ã€å®‰è£…è…¾è®¯äº‘ç›¸å…³ä¾èµ–æ’ä»¶"></a>ä¸‰ã€å®‰è£…è…¾è®¯äº‘ç›¸å…³ä¾èµ–æ’ä»¶</h3><p>è…¾è®¯äº‘å‚è€ƒæ–‡æ¡£ï¼š<br>1.<a href="https://cloud.tencent.com/document/product/213/17815">https://cloud.tencent.com/document/product/213/17815</a></p><p>2.<a href="https://cloud.tencent.com/document/product/213/30000">https://cloud.tencent.com/document/product/213/30000</a></p><p>3.<a href="https://cloud.tencent.com/document/product/213/4945">https://cloud.tencent.com/document/product/213/4945</a></p><h3 id="å››ã€å®‰è£…æ–‡ä»¶åŠ©æ‰‹ï¼ˆéœ€è¦ä¸Šä¼ é•œåƒåˆ°äº‘ä¸Šåæ‰å¯ï¼‰"><a href="#å››ã€å®‰è£…æ–‡ä»¶åŠ©æ‰‹ï¼ˆéœ€è¦ä¸Šä¼ é•œåƒåˆ°äº‘ä¸Šåæ‰å¯ï¼‰" class="headerlink" title="å››ã€å®‰è£…æ–‡ä»¶åŠ©æ‰‹ï¼ˆéœ€è¦ä¸Šä¼ é•œåƒåˆ°äº‘ä¸Šåæ‰å¯ï¼‰"></a>å››ã€å®‰è£…æ–‡ä»¶åŠ©æ‰‹ï¼ˆéœ€è¦ä¸Šä¼ é•œåƒåˆ°äº‘ä¸Šåæ‰å¯ï¼‰</h3><p>è…¾è®¯äº‘å‚è€ƒæ–‡æ¡£ï¼š</p><p>4.<a href="https://www.tencentcloud.com/zh/document/product/1147/46042">https://www.tencentcloud.com/zh/document/product/1147/46042</a></p><p>å½“å‡ºç°å¦‚ä¸‹æŠ¥é”™æ—¶ï¼Œè¯·æ‰“å¼€ieæµè§ˆå™¨ï¼Œå†æ‰§è¡Œï¼</p><p><img src="/2023/06/09/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/windows-server/%E5%88%B6%E4%BD%9Cwindows%E9%95%9C%E5%83%8F%E5%AF%BC%E5%85%A5%E8%85%BE%E8%AE%AF%E4%BA%91/image-20231103181126446.png" alt="image-20231103181126446"></p><p><img src="/2023/06/09/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/windows-server/%E5%88%B6%E4%BD%9Cwindows%E9%95%9C%E5%83%8F%E5%AF%BC%E5%85%A5%E8%85%BE%E8%AE%AF%E4%BA%91/image-20231103181301933.png" alt="image-20231103181301933"></p>]]></content>
    
    
    <categories>
      
      <category>windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windowsè®¾ç½®åå°è¿è¡ŒæŸäº›ä»»åŠ¡</title>
    <link href="/2023/06/08/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/windows-server/windows%E8%AE%BE%E7%BD%AE%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E6%9F%90%E4%BA%9B%E4%BB%BB%E5%8A%A1/"/>
    <url>/2023/06/08/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/windows-server/windows%E8%AE%BE%E7%BD%AE%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E6%9F%90%E4%BA%9B%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="windowsè®¾ç½®åå°è¿è¡ŒæŸäº›ä»»åŠ¡ï¼š"><a href="#windowsè®¾ç½®åå°è¿è¡ŒæŸäº›ä»»åŠ¡ï¼š" class="headerlink" title="windowsè®¾ç½®åå°è¿è¡ŒæŸäº›ä»»åŠ¡ï¼š"></a>windowsè®¾ç½®åå°è¿è¡ŒæŸäº›ä»»åŠ¡ï¼š</h1><h2 id="ä¸€ã€é€šè¿‡vbsã€batéšè—cmdé»‘çª—å£ï¼š"><a href="#ä¸€ã€é€šè¿‡vbsã€batéšè—cmdé»‘çª—å£ï¼š" class="headerlink" title="ä¸€ã€é€šè¿‡vbsã€batéšè—cmdé»‘çª—å£ï¼š"></a>ä¸€ã€é€šè¿‡vbsã€batéšè—cmdé»‘çª—å£ï¼š</h2><h3 id="1ã€vbsæ–¹å¼ï¼š"><a href="#1ã€vbsæ–¹å¼ï¼š" class="headerlink" title="1ã€vbsæ–¹å¼ï¼š"></a>1ã€vbsæ–¹å¼ï¼š</h3><p>æ–°å»ºä¸€ä¸ªtxtæ–‡ä»¶ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼Œä¿å­˜åæŠŠåç¼€æ”¹ä¸º.vbs</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">Set ws = CreateObject(<span class="hljs-string">&quot;Wscript.Shell&quot;</span>) <br>ws.run <span class="hljs-string">&quot;cmd /c C:\Users\Administrator\Desktop\1.bat&quot;</span>,vbhide<br><br><span class="hljs-comment">#C:\Users\Administrator\Desktop\1.bat</span><br><span class="hljs-comment">#è¿™ä¸ªåœ°æ–¹æ˜¯è¦æ‰§è¡Œçš„æ“ä½œï¼Œä¸€èˆ¬æ˜¯é€šè¿‡cmdæ‰§è¡Œbatè„šæœ¬</span><br><br></code></pre></td></tr></table></figure><h3 id="2ã€batæ–¹å¼ï¼š"><a href="#2ã€batæ–¹å¼ï¼š" class="headerlink" title="2ã€batæ–¹å¼ï¼š"></a>2ã€batæ–¹å¼ï¼š</h3><p>æ–°å»ºä¸€ä¸ªtxtæ–‡ä»¶ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼Œä¿å­˜åæŠŠåç¼€æ”¹ä¸º.bat</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">@<span class="hljs-built_in">echo</span> off<br><br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;%1&quot;</span> == <span class="hljs-string">&quot;h&quot;</span> goto begin<br>mshta vbscript:createobject(<span class="hljs-string">&quot;wscript.shell&quot;</span>).run(<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;%~nx0&quot;</span><span class="hljs-string">&quot; h&quot;</span>,0)(window.close)&amp;&amp;<span class="hljs-built_in">exit</span><br>:begin<br>REM<br><br><span class="hljs-comment">#REMåé¢è·Ÿç€è¦æ‰§è¡Œçš„æ“ä½œ</span><br>ä¾‹å¦‚ï¼š<br>REM<br>npc.exe -server=192.168.94.154:9004 -vkey=a414t552315hn2134w -<span class="hljs-built_in">type</span>=tcp<br></code></pre></td></tr></table></figure><h2 id="äºŒã€è®¾ç½®å¼€å¯è‡ªå¯åŠ¨"><a href="#äºŒã€è®¾ç½®å¼€å¯è‡ªå¯åŠ¨" class="headerlink" title="äºŒã€è®¾ç½®å¼€å¯è‡ªå¯åŠ¨"></a>äºŒã€è®¾ç½®å¼€å¯è‡ªå¯åŠ¨</h2><p>windows è®¾ç½®batç¨‹åºå¼€æœºè‡ªå¯åŠ¨<br>ç¬¬ä¸€æ­¥ï¼šåœ¨æ¡Œé¢æƒ…å†µä¸‹ æŒ‰win+R å¿«æ·é”®ï¼Œæ‰“å¼€è¿è¡Œçª—å£</p><p>ç¬¬äºŒæ­¥ï¼šè¾“å…¥ shell:startup æ•²å›è½¦</p><p>ç¬¬ä¸‰æ­¥ï¼šå°†è‡ªå·±çš„batç¨‹åºçš„å¿«æ·æ–¹å¼æ”¾ç½®åœ¨æ‰“å¼€çš„çª—å£ä¸­å³å¯</p><h2 id="ä¸‰ã€é€šè¿‡winswå®ç°windowsæœåŠ¡ï¼Œå®ç°å¼€æœºè‡ªå¯åŠ¨"><a href="#ä¸‰ã€é€šè¿‡winswå®ç°windowsæœåŠ¡ï¼Œå®ç°å¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="ä¸‰ã€é€šè¿‡winswå®ç°windowsæœåŠ¡ï¼Œå®ç°å¼€æœºè‡ªå¯åŠ¨"></a>ä¸‰ã€é€šè¿‡winswå®ç°windowsæœåŠ¡ï¼Œå®ç°å¼€æœºè‡ªå¯åŠ¨</h2><p>#å‚è€ƒæ–‡æ¡£ï¼š<a href="https://blog.csdn.net/qgbihc/article/details/121805661">https://blog.csdn.net/qgbihc/article/details/121805661</a></p><h3 id="1-ä¸‹è½½è½¯ä»¶-exeä¸é…ç½®æ–‡ä»¶-xml"><a href="#1-ä¸‹è½½è½¯ä»¶-exeä¸é…ç½®æ–‡ä»¶-xml" class="headerlink" title="1.ä¸‹è½½è½¯ä»¶.exeä¸é…ç½®æ–‡ä»¶.xml"></a>1.ä¸‹è½½è½¯ä»¶.exeä¸é…ç½®æ–‡ä»¶.xml</h3><p>winswåœ°å€ï¼š<a href="https://github.com/winsw/winsw/releases">https://github.com/winsw/winsw/releases</a><br>ç›®å‰ç¨³å®šç‰ˆæœ¬æ˜¯v2.11.0ï¼Œä¸‹è½½é“¾æ¥ï¼š<a href="https://github.com/winsw/winsw/releases/tag/v2.11.0">https://github.com/winsw/winsw/releases/tag/v2.11.0</a></p><p>sample-minimal.xml æ˜¯ä¸€ä¸ªæœ€å°é…ç½®çš„åˆ—å­ã€‚<br>sample-allOptions.xml æ˜¯ä¸€ä¸ªå…¨éƒ¨å¯é…ç½®å‚æ•°çš„ä¾‹å­<br>windows10è‡ªå¸¦äº†.Net Framework4.0ï¼Œæ ¹æ®.Net Frameworkç‰ˆæœ¬ä¸‹è½½å³å¯ï¼Œå¦‚ï¼šWinSW.NET4.exe</p><p>#ä»¥ä¸‹ä¸ºæµ‹è¯•æ­¥éª¤ï¼šå®ç°å¯åŠ¨æœåŠ¡ï¼Œåœ¨æ¡Œé¢ç”Ÿæˆä¸€ä¸ªtxtæ–‡ä»¶</p><h3 id="2-ä¿®æ”¹exeåç§°ä¸xmlåç§°ä¸€è‡´ï¼Œå¹¶å°†æ‰€æœ‰çš„æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œ"><a href="#2-ä¿®æ”¹exeåç§°ä¸xmlåç§°ä¸€è‡´ï¼Œå¹¶å°†æ‰€æœ‰çš„æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œ" class="headerlink" title="2.ä¿®æ”¹exeåç§°ä¸xmlåç§°ä¸€è‡´ï¼Œå¹¶å°†æ‰€æœ‰çš„æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œ"></a>2.ä¿®æ”¹exeåç§°ä¸xmlåç§°ä¸€è‡´ï¼Œå¹¶å°†æ‰€æœ‰çš„æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œ</h3><p>æˆ‘çš„è¿™äº›æ–‡ä»¶å­˜æ”¾åœ¨äº†ï¼š&lt;C:\Users\Administrator\Downloads&gt;ç›®å½•ä¸‹<br>#ç›®å½•ä¸‹æ–‡ä»¶ä¸ºï¼š<br>test.exe<br>test.xml<br>test.bat</p><h3 id="3-é…ç½®xmlæ–‡ä»¶"><a href="#3-é…ç½®xmlæ–‡ä»¶" class="headerlink" title="3.é…ç½®xmlæ–‡ä»¶"></a>3.é…ç½®xmlæ–‡ä»¶</h3><p>#test.xmlæ–‡ä»¶å†…å®¹<br><service><br>  <id>test</id><br>  <name>test</name><br>  <description>è¿è¡ŒæœåŠ¡ï¼Œæ¡Œé¢ç”Ÿæˆtestæ–‡ä»¶</description><br>  <executable>%BASE%\test.bat</executable><br></service></p><p>ç›¸å…³å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š<br>idï¼šå®‰è£…windowsæœåŠ¡åçš„æœåŠ¡IDï¼Œå¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚<br>nameï¼šæœåŠ¡åç§°ï¼Œä¹Ÿå¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ä¸€èˆ¬å’Œidä¸€è‡´å³å¯ã€‚<br>descriptionï¼šæœåŠ¡è¯´æ˜ï¼Œå¯ä»¥ä½¿ç”¨ä¸­æ–‡ï¼Œå¯åšå¤‡æ³¨ä½¿ç”¨ã€‚<br>executableï¼šæ‰§è¡Œçš„å‘½ä»¤ï¼Œæˆ‘è¿™é‡Œæ˜¯æ‰§è¡Œå½“å‰ç›®å½•ä¸‹çš„batæ–‡ä»¶ï¼Œä¸€èˆ¬å»ºè®®å°†å¯åŠ¨æœåŠ¡å‘½ä»¤å†™è¿›baté‡Œé¢</p><p>è¡¥å……å‚æ•°ï¼š<br><executable>java</executable><br><arguments>-jar api-proj.jar</arguments><br>executableï¼šæ‰§è¡Œçš„å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯åŠ¨springbootåº”ç”¨çš„å‘½ä»¤javaã€‚<br>argumentsï¼šå‘½ä»¤æ‰§è¡Œå‚æ•°ï¼Œæ¯”å¦‚åŒ…è·¯å¾„ï¼Œç±»è·¯å¾„ç­‰ã€‚</p><p>#æˆ‘è¿™è¾¹å°†æ“ä½œå‘½ä»¤å†™åˆ°äº†batæ–‡ä»¶å†…<br>#test.batæ–‡ä»¶å†…å®¹<br>echo â€œthis is test txtâ€ &gt; C:\Users\Administrator\Desktop\test.txt</p><h3 id="4-å®‰è£…æœåŠ¡"><a href="#4-å®‰è£…æœåŠ¡" class="headerlink" title="4.å®‰è£…æœåŠ¡"></a>4.å®‰è£…æœåŠ¡</h3><p>ä»¥ç®¡ç†å‘˜èº«ä»½æ‰§è¡Œcmdï¼Œåˆ‡æ¢åˆ°exeæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">test.exe install<br></code></pre></td></tr></table></figure><p>#åœ¨exeæ–‡ä»¶æ‰€åœ¨ç›®å½•å°†ä¼šç”Ÿæˆæ—¥å¿—ä¿¡æ¯(.log)ç»“å°¾çš„</p><p>é™¤installä¹‹å¤–ï¼Œå…¶ä»–å‘½ä»¤è¡¥å……ï¼š</p><p>uninstallï¼šåˆ é™¤æœåŠ¡<br>startï¼šå¯åŠ¨æœåŠ¡<br>stopï¼šåœæ­¢æœåŠ¡<br>restartï¼šé‡å¯æœåŠ¡<br>statusï¼šæŸ¥çœ‹çŠ¶æ€</p>]]></content>
    
    
    <categories>
      
      <category>windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windows-server-å®‰è£…dockerã€docker-compose</title>
    <link href="/2023/06/07/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/windows-server/windows-server-2022%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85docker/"/>
    <url>/2023/06/07/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/windows-server/windows-server-2022%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85docker/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="windows-server-å®‰è£…dockerã€docker-compose"><a href="#windows-server-å®‰è£…dockerã€docker-compose" class="headerlink" title="windows-server-å®‰è£…dockerã€docker-compose"></a>windows-server-å®‰è£…dockerã€docker-compose</h1><h2 id="ä¸€ã€å®‰è£…docker"><a href="#ä¸€ã€å®‰è£…docker" class="headerlink" title="ä¸€ã€å®‰è£…docker"></a>ä¸€ã€å®‰è£…docker</h2><p>windows-server2019å‚è€ƒæ–‡æ¡£ï¼š<a href="https://blog.csdn.net/djx5201314/article/details/101573920">https://blog.csdn.net/djx5201314/article/details/101573920</a><br>windows-server2016å‚è€ƒæ–‡æ¡£ï¼š<a href="https://www.freesion.com/article/90281060193/">https://www.freesion.com/article/90281060193/</a></p><h3 id="1-é¦–å…ˆå®‰è£…-Windows-æ›´æ–°ï¼ˆæ‰“å¼€cmdæˆ–è€…powershellï¼‰"><a href="#1-é¦–å…ˆå®‰è£…-Windows-æ›´æ–°ï¼ˆæ‰“å¼€cmdæˆ–è€…powershellï¼‰" class="headerlink" title="1.é¦–å…ˆå®‰è£… Windows æ›´æ–°ï¼ˆæ‰“å¼€cmdæˆ–è€…powershellï¼‰"></a>1.é¦–å…ˆå®‰è£… Windows æ›´æ–°ï¼ˆæ‰“å¼€cmdæˆ–è€…powershellï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">sconfig<br><span class="hljs-comment">#è¾“å…¥6 ä¸‹è½½å¹¶å®‰è£…æ›´æ–°</span><br></code></pre></td></tr></table></figure><h3 id="2-è¿›å…¥PowerShell-æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤"><a href="#2-è¿›å…¥PowerShell-æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤" class="headerlink" title="2.è¿›å…¥PowerShell æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤"></a>2.è¿›å…¥PowerShell æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¦è¿è¡Œå®¹å™¨ï¼Œéœ€è¦å¯ç”¨å®¹å™¨åŠŸèƒ½</span><br>Install-WindowsFeature -Name Containers<br><br><span class="hljs-comment">#è§†æƒ…å†µå¯ç”¨æœåŠ¡å™¨Hyper-V,Containersç‰¹æ€§</span><br><span class="hljs-comment">#Install-WindowsFeature -Name Hyper-V,Containers -IncludeAllSubFeature -IncludeManagementTools</span><br><br><br>Install-Module -Name DockerMsftProvider -Repository PSGallery -Force<br></code></pre></td></tr></table></figure><p><strong>æ‰§è¡Œä»¥ä¸Šå‘½ä»¤æ˜¾ç¤ºæ— æ³•å®‰è£…æ—¶ï¼šæ‰¾ä¸åˆ°ä¸æŒ‡å®šçš„æœç´¢æ¡ä»¶å’Œç¨‹åºåŒ…åç§°â€œDockerProviderâ€åŒ¹é…çš„é¡¹ç›®ã€‚æ— æ³•è§£æå®‰è£…æº,æœ‰äººæŠ“åŒ…åå‘ç°æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡é€šä¿¡ç”¨äº†TLS 1.0ã€‚æˆ‘ä»¬å¯ä»¥å¼ºåˆ¶powershellä½¿ç”¨TLS1.2è¿›è¡Œé€šä¿¡</strong></p><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12<br></code></pre></td></tr></table></figure><p>å†é‡æ–°æ‰§è¡Œå‰é¢å‘½ä»¤:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">Install-Module -Name DockerMsftProvider -Repository PSGallery -Force<br>Install-Package -Name docker -ProviderName DockerMsftProvider<br></code></pre></td></tr></table></figure><p>è¯¢é—®æ˜¯å¦ä¿¡ä»»åŒ…æºâ€œDockerDefaultâ€æ—¶ï¼Œé”®å…¥<code>A </code>ä»¥ç»§ç»­è¿›è¡Œå®‰è£…</p><p>å¦‚æœæç¤ºä¸‹è½½ä¸æˆåŠŸï¼Œxxxæ–‡ä»¶ä¸åœ¨,å¯ä»¥ä½¿ç”¨èµ„æºç®¡ç†å™¨å¯¼èˆªåˆ°è·¯å¾„ <code>C:\Users\ADMINI~1\AppData\Local\Temp\2\DockerMsftProvider</code> ä¸‹ï¼Œä¼šå‘ç°é‡Œé¢æœ‰ä¸ªjsonæ–‡ä»¶<br>æ‰“å¼€è¯¥jsonæ–‡ä»¶ï¼Œæ‰¾åˆ°é”™è¯¯æ–‡ä»¶å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¤åˆ¶urlåœ°å€åˆ°æµè§ˆå™¨ä¸‹è½½ç¼ºå¤±çš„æ–‡ä»¶ã€‚</p><p>æˆ–è€…ä½¿ç”¨powershellæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> C:\Users\Administrator\AppData\Local\Temp\2\DockerMsftProvider\<br><br>Start-BitsTransfer -Source æŸ¥åˆ°çš„jsonçš„urlåœ°å€<br></code></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæˆåä¸Šä¼ åˆ°è¯¥ç›®å½•ä¸‹ï¼š<code>C:\Users\Administrator\AppData\Local\Temp\2\DockerMsftProvider\</code><br>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">Get-FileHash -Path C:\Users\Administrator\AppData\Local\Temp\2\DockerMsftProvider\Docker-19-03-1.zip -Algorithm SHA256<br><br>Install-Package -Name docker -ProviderName DockerMsftProvider -Verbose<br></code></pre></td></tr></table></figure><h3 id="3-å¯åŠ¨docker"><a href="#3-å¯åŠ¨docker" class="headerlink" title="3.å¯åŠ¨docker"></a>3.å¯åŠ¨docker</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">Start-Service Docker<br></code></pre></td></tr></table></figure><h3 id="4-å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å·²å®‰è£…çš„Dockerç‰ˆæœ¬ï¼š"><a href="#4-å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å·²å®‰è£…çš„Dockerç‰ˆæœ¬ï¼š" class="headerlink" title="4.å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å·²å®‰è£…çš„Dockerç‰ˆæœ¬ï¼š"></a>4.å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å·²å®‰è£…çš„Dockerç‰ˆæœ¬ï¼š</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ada">Administrator&gt; Get-<span class="hljs-keyword">Package</span> <span class="hljs-title">-Name Docker -ProviderName DockerMsftProvider</span><br>#ä½¿ç”¨docker <span class="hljs-comment">--versionå‘½ä»¤ä¹Ÿå¯ä»¥æŸ¥è¯¢åˆ°ã€‚</span><br><br>å¯ä»¥é€šè¿‡åœ¨PowerShellä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤éšæ—¶è¿›è¡Œå‡çº§ï¼š<br>Install-<span class="hljs-keyword">Package</span> <span class="hljs-title">-Name Docker -ProviderName DockerMsftProvider -Update -Force</span><br></code></pre></td></tr></table></figure><p>dockerçš„daemon.jsoné…ç½®æ–‡ä»¶åœ¨ï¼š<br><code>C:\ProgramData\Docker\config\daemon.json</code></p><h2 id="äºŒã€å®‰è£…docker-compose"><a href="#äºŒã€å®‰è£…docker-compose" class="headerlink" title="äºŒã€å®‰è£…docker-compose"></a>äºŒã€å®‰è£…docker-compose</h2><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://blog.csdn.net/qq_37557801/article/details/104467943?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1.pc_relevant_default&spm=1001.2101.3001.4242.2&utm_relevant_index=4">https://blog.csdn.net/qq_37557801/article/details/104467943?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1.pc_relevant_default&amp;spm=1001.2101.3001.4242.2&amp;utm_relevant_index=4</a></p><p>åœ¨PowerShellä¸­ï¼Œç”±äºGitHubç°åœ¨éœ€è¦TLS1.2ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12<br></code></pre></td></tr></table></figure><p>ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ä¸‹è½½å½“å‰ç¨³å®šçš„Composeç‰ˆæœ¬ï¼ˆv1.25.4ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">Invoke-WebRequest <span class="hljs-string">&quot;https://github.com/docker/compose/releases/download/1.25.4/docker-compose-Windows-x86_64.exe&quot;</span> -UseBasicParsing -OutFile <br><br><span class="hljs-variable">$Env</span>:ProgramFiles\Docker\docker-compose.exe<br><span class="hljs-comment">#å¦‚æœæ—¶é—´è¾ƒé•¿</span><br>ç›´æ¥ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬åä¸Šä¼ åˆ°C:\Program Files\Dockerç›®å½•ä¸‹<br></code></pre></td></tr></table></figure><p>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker-compose --version <br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå¦‚æœè¾“å…¥å‘½ä»¤æ˜¾ç¤ºæœ‰è¯¯ï¼Œè¯·è®¾ç½®ç¯å¢ƒå˜é‡</p><h2 id="ä»¥ä¸Šå®‰è£…ä»¥åï¼Œæ— æ³•ä½¿ç”¨docker-pullé•œåƒæ—¶ï¼Œå¯è¯•ç€æ ¹æ®ä¸‹åˆ—çš„æ–¹æ³•ï¼šåˆ‡æ¢å¯ç”¨LinuxKitç³»ç»Ÿä»¥è¿è¡ŒLinuxå®¹å™¨"><a href="#ä»¥ä¸Šå®‰è£…ä»¥åï¼Œæ— æ³•ä½¿ç”¨docker-pullé•œåƒæ—¶ï¼Œå¯è¯•ç€æ ¹æ®ä¸‹åˆ—çš„æ–¹æ³•ï¼šåˆ‡æ¢å¯ç”¨LinuxKitç³»ç»Ÿä»¥è¿è¡ŒLinuxå®¹å™¨" class="headerlink" title="ä»¥ä¸Šå®‰è£…ä»¥åï¼Œæ— æ³•ä½¿ç”¨docker pullé•œåƒæ—¶ï¼Œå¯è¯•ç€æ ¹æ®ä¸‹åˆ—çš„æ–¹æ³•ï¼šåˆ‡æ¢å¯ç”¨LinuxKitç³»ç»Ÿä»¥è¿è¡ŒLinuxå®¹å™¨"></a>ä»¥ä¸Šå®‰è£…ä»¥åï¼Œæ— æ³•ä½¿ç”¨docker pullé•œåƒæ—¶ï¼Œå¯è¯•ç€æ ¹æ®ä¸‹åˆ—çš„æ–¹æ³•ï¼šåˆ‡æ¢å¯ç”¨LinuxKitç³»ç»Ÿä»¥è¿è¡ŒLinuxå®¹å™¨</h2><h2 id="åœ¨Windows-Server-2019ä¸Šè¿è¡ŒDockerå®¹å™¨"><a href="#åœ¨Windows-Server-2019ä¸Šè¿è¡ŒDockerå®¹å™¨" class="headerlink" title="åœ¨Windows Server 2019ä¸Šè¿è¡ŒDockerå®¹å™¨"></a>åœ¨Windows Server 2019ä¸Šè¿è¡ŒDockerå®¹å™¨</h2><p>windows-service2019å‚è€ƒæ–‡æ¡£ï¼š<a href="https://ywnz.com/linuxjc/4268.html">https://ywnz.com/linuxjc/4268.html</a></p><h3 id="åœ¨ä½¿ç”¨Windows-Containersè¿è¡Œç³»ç»Ÿçš„å¤šä¸ªç‹¬ç«‹åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œä½ éœ€è¦å¯ç”¨å®¹å™¨åŠŸèƒ½å¹¶åœ¨Windows-Server-2019ä¸Šå®‰è£…Dockerã€‚"><a href="#åœ¨ä½¿ç”¨Windows-Containersè¿è¡Œç³»ç»Ÿçš„å¤šä¸ªç‹¬ç«‹åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œä½ éœ€è¦å¯ç”¨å®¹å™¨åŠŸèƒ½å¹¶åœ¨Windows-Server-2019ä¸Šå®‰è£…Dockerã€‚" class="headerlink" title="åœ¨ä½¿ç”¨Windows Containersè¿è¡Œç³»ç»Ÿçš„å¤šä¸ªç‹¬ç«‹åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œä½ éœ€è¦å¯ç”¨å®¹å™¨åŠŸèƒ½å¹¶åœ¨Windows Server 2019ä¸Šå®‰è£…Dockerã€‚"></a>åœ¨ä½¿ç”¨Windows Containersè¿è¡Œç³»ç»Ÿçš„å¤šä¸ªç‹¬ç«‹åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œä½ éœ€è¦å¯ç”¨å®¹å™¨åŠŸèƒ½å¹¶åœ¨Windows Server 2019ä¸Šå®‰è£…Dockerã€‚</h3><h3 id="å¼€ç®±å³ç”¨ï¼ŒWindowsä¸Šçš„Dockeråªè¿è¡ŒWindowså®¹å™¨ï¼Œè¦åœ¨Windows-Serverä¸Šä½¿ç”¨Linuxå®¹å™¨ï¼Œéœ€è¦ä½¿ç”¨Docker-Enterprise-Edition-Previewï¼Œå…¶ä¸­åŒ…å«ç”¨äºè¿è¡ŒDocker-Linuxå®¹å™¨çš„å®Œæ•´LinuxKitç³»ç»Ÿã€‚"><a href="#å¼€ç®±å³ç”¨ï¼ŒWindowsä¸Šçš„Dockeråªè¿è¡ŒWindowså®¹å™¨ï¼Œè¦åœ¨Windows-Serverä¸Šä½¿ç”¨Linuxå®¹å™¨ï¼Œéœ€è¦ä½¿ç”¨Docker-Enterprise-Edition-Previewï¼Œå…¶ä¸­åŒ…å«ç”¨äºè¿è¡ŒDocker-Linuxå®¹å™¨çš„å®Œæ•´LinuxKitç³»ç»Ÿã€‚" class="headerlink" title="å¼€ç®±å³ç”¨ï¼ŒWindowsä¸Šçš„Dockeråªè¿è¡ŒWindowså®¹å™¨ï¼Œè¦åœ¨Windows Serverä¸Šä½¿ç”¨Linuxå®¹å™¨ï¼Œéœ€è¦ä½¿ç”¨Docker Enterprise Edition Previewï¼Œå…¶ä¸­åŒ…å«ç”¨äºè¿è¡ŒDocker Linuxå®¹å™¨çš„å®Œæ•´LinuxKitç³»ç»Ÿã€‚"></a>å¼€ç®±å³ç”¨ï¼ŒWindowsä¸Šçš„Dockeråªè¿è¡ŒWindowså®¹å™¨ï¼Œè¦åœ¨Windows Serverä¸Šä½¿ç”¨Linuxå®¹å™¨ï¼Œéœ€è¦ä½¿ç”¨Docker Enterprise Edition Previewï¼Œå…¶ä¸­åŒ…å«ç”¨äºè¿è¡ŒDocker Linuxå®¹å™¨çš„å®Œæ•´LinuxKitç³»ç»Ÿã€‚</h3><h3 id="1ã€å¸è½½å½“å‰çš„Docker-CEï¼š"><a href="#1ã€å¸è½½å½“å‰çš„Docker-CEï¼š" class="headerlink" title="1ã€å¸è½½å½“å‰çš„Docker CEï¼š"></a>1ã€å¸è½½å½“å‰çš„Docker CEï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">Uninstall-Package -Name docker -ProviderName DockerMSFTProvider<br><br><span class="hljs-comment">#å¦‚æœä½ ä½¿ç”¨åœ¨Hyper-Vä¸Šè¿è¡Œçš„Linuxè™šæ‹Ÿæœºè¿è¡ŒDockerå®¹å™¨ï¼Œåˆ™å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–ï¼š</span><br>Get-VM WinContainerHost | Set-VMProcessor -ExposeVirtualizationExtensions <span class="hljs-variable">$true</span><br></code></pre></td></tr></table></figure><h3 id="2ã€å®‰è£…Docker-EEçš„å½“å‰é¢„è§ˆç‰ˆæœ¬ï¼š"><a href="#2ã€å®‰è£…Docker-EEçš„å½“å‰é¢„è§ˆç‰ˆæœ¬ï¼š" class="headerlink" title="2ã€å®‰è£…Docker EEçš„å½“å‰é¢„è§ˆç‰ˆæœ¬ï¼š"></a>2ã€å®‰è£…Docker EEçš„å½“å‰é¢„è§ˆç‰ˆæœ¬ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">Install-Module DockerProvider<br><br>Install-Package Docker -ProviderName DockerProvider -RequiredVersion preview<br></code></pre></td></tr></table></figure><h3 id="3ã€å¯ç”¨LinuxKitç³»ç»Ÿä»¥è¿è¡ŒLinuxå®¹å™¨ï¼š"><a href="#3ã€å¯ç”¨LinuxKitç³»ç»Ÿä»¥è¿è¡ŒLinuxå®¹å™¨ï¼š" class="headerlink" title="3ã€å¯ç”¨LinuxKitç³»ç»Ÿä»¥è¿è¡ŒLinuxå®¹å™¨ï¼š"></a>3ã€å¯ç”¨LinuxKitç³»ç»Ÿä»¥è¿è¡ŒLinuxå®¹å™¨ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">[Environment]::SetEnvironmentVariable(<span class="hljs-string">&quot;LCOW_SUPPORTED&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;Machine&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="4ã€æ›´æ”¹åé‡æ–°å¯åŠ¨Docker-Serviceï¼š"><a href="#4ã€æ›´æ”¹åé‡æ–°å¯åŠ¨Docker-Serviceï¼š" class="headerlink" title="4ã€æ›´æ”¹åé‡æ–°å¯åŠ¨Docker Serviceï¼š"></a>4ã€æ›´æ”¹åé‡æ–°å¯åŠ¨Docker Serviceï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh">Restart-Service docker<br><br>æµ‹è¯•ä¸€ä¸‹ï¼š<br><br>&gt; docker run -it --<span class="hljs-built_in">rm</span> ubuntu /bin/bash<br><br>root@1440a7fef7e0:/<span class="hljs-comment"># cat /etc/os-release </span><br>NAME=<span class="hljs-string">&quot;Ubuntu&quot;</span><br>VERSION=<span class="hljs-string">&quot;18.04.1 LTS (Bionic Beaver)&quot;</span><br>ID=ubuntu<br>ID_LIKE=debian<br>PRETTY_NAME=<span class="hljs-string">&quot;Ubuntu 18.04.1 LTS&quot;</span><br>VERSION_ID=<span class="hljs-string">&quot;18.04&quot;</span><br>HOME_URL=<span class="hljs-string">&quot;https://www.ubuntu.com/&quot;</span><br>SUPPORT_URL=<span class="hljs-string">&quot;https://help.ubuntu.com/&quot;</span><br>BUG_REPORT_URL=<span class="hljs-string">&quot;https://bugs.launchpad.net/ubuntu/&quot;</span><br>PRIVACY_POLICY_URL=<span class="hljs-string">&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;</span><br>VERSION_CODENAME=bionic<br>UBUNTU_CODENAME=bionic<br>root@1440a7fef7e0:/<span class="hljs-comment"># exit</span><br><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><h3 id="è¦åˆ‡æ¢å›è¿è¡Œçš„Windowså®¹å™¨ï¼Œè¯·è¿è¡Œï¼š"><a href="#è¦åˆ‡æ¢å›è¿è¡Œçš„Windowså®¹å™¨ï¼Œè¯·è¿è¡Œï¼š" class="headerlink" title="è¦åˆ‡æ¢å›è¿è¡Œçš„Windowså®¹å™¨ï¼Œè¯·è¿è¡Œï¼š"></a>è¦åˆ‡æ¢å›è¿è¡Œçš„Windowså®¹å™¨ï¼Œè¯·è¿è¡Œï¼š</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[Environment]</span>::<span class="hljs-built_in">SetEnvironmentVariable</span>(<span class="hljs-string">&quot;LCOW_SUPPORTED&quot;</span>, <span class="hljs-string">&quot;$null&quot;</span>, <span class="hljs-string">&quot;Machine&quot;</span>)<br><br>è‡³æ­¤ï¼Œåœ¨Windows Server <span class="hljs-number">2019</span>ä¸Šè¿è¡ŒLinuxå®¹å™¨<br></code></pre></td></tr></table></figure><h2 id="é—®é¢˜å¤„ç†ï¼š"><a href="#é—®é¢˜å¤„ç†ï¼š" class="headerlink" title="é—®é¢˜å¤„ç†ï¼š"></a>é—®é¢˜å¤„ç†ï¼š</h2><p>PS C:\Users\Administrator&gt; Install-Module -Name DockerMsftProvider -Repository PSGallery -Force<br>Get-PSGalleryApiAvailability : PowerShell åº“å½“å‰ä¸å¯ç”¨ã€‚è¯·ç¨åå†è¯•ã€‚<br>æ‰€åœ¨ä½ç½® C:\Program Files\WindowsPowerShell\Modules\PowerShellGet\1.0.0.1\PSModule.psm1:1711 å­—ç¬¦: 9</p><ul><li><pre><code class="hljs">    Get-PSGalleryApiAvailability -Repository $Repository</code></pre></li><li><pre><code class="hljs">    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</code></pre><ul><li>CategoryInfo          : InvalidOperation: (:) [Get-PSGalleryApiAvailability]ï¼ŒInvalidOperationException</li><li>FullyQualifiedErrorId : PowerShellGalleryUnavailable,Get-PSGalleryApiAvailability</li></ul></li></ul><p>Get-PSGalleryApiAvailability : PowerShell åº“å½“å‰ä¸å¯ç”¨ã€‚è¯·ç¨åå†è¯•ã€‚<br>æ‰€åœ¨ä½ç½® C:\Program Files\WindowsPowerShell\Modules\PowerShellGet\1.0.0.1\PSModule.psm1:4437 å­—ç¬¦: 9</p><ul><li><pre><code class="hljs">    Get-PSGalleryApiAvailability -Repository $Name</code></pre></li><li><pre><code class="hljs">    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</code></pre><ul><li>CategoryInfo          : InvalidOperation: (:) [Get-PSGalleryApiAvailability]ï¼ŒInvalidOperationException</li><li>FullyQualifiedErrorId : PowerShellGalleryUnavailable,Get-PSGalleryApiAvailability</li></ul></li></ul><h3 id="è§£å†³æ–¹æ³•ï¼š"><a href="#è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h3><p>ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€powershellï¼Œä¾æ¬¡è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12<br>Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.201 -Force<br>Install-Module posh-ssh<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntuç³»ç»Ÿå®‰è£…Docker</title>
    <link href="/2023/06/06/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Ubuntu%E7%B3%BB%E7%BB%9F/Ubuntu%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85Docker/"/>
    <url>/2023/06/06/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Ubuntu%E7%B3%BB%E7%BB%9F/Ubuntu%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85Docker/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Ubuntuç³»ç»Ÿå®‰è£…Docker"><a href="#Ubuntuç³»ç»Ÿå®‰è£…Docker" class="headerlink" title="Ubuntuç³»ç»Ÿå®‰è£…Docker"></a>Ubuntuç³»ç»Ÿå®‰è£…Docker</h1><h2 id="1-æ›´æ–°ç³»ç»Ÿï¼Œå¹¶å®‰è£…ç›¸å…³ä¾èµ–"><a href="#1-æ›´æ–°ç³»ç»Ÿï¼Œå¹¶å®‰è£…ç›¸å…³ä¾èµ–" class="headerlink" title="1.æ›´æ–°ç³»ç»Ÿï¼Œå¹¶å®‰è£…ç›¸å…³ä¾èµ–"></a>1.æ›´æ–°ç³»ç»Ÿï¼Œå¹¶å®‰è£…ç›¸å…³ä¾èµ–</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt update  <br>sudo apt upgrade  <br>sudo apt install apt-transport-https ca-certificates curl gnupg-agent software-properties-common<br></code></pre></td></tr></table></figure><h2 id="2-å¯¼å…¥Docker-GPGå¯†é’¥"><a href="#2-å¯¼å…¥Docker-GPGå¯†é’¥" class="headerlink" title="2.å¯¼å…¥Docker-GPGå¯†é’¥"></a>2.å¯¼å…¥Docker-GPGå¯†é’¥</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å®˜æ–¹æºï¼ˆå›½å†…æ¨èç”¨é˜¿é‡Œæºå’Œæ¸…åæºï¼‰</span><br>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -  <br><span class="hljs-comment">#é˜¿é‡Œæºï¼š</span><br>curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | apt-key add -<br><span class="hljs-comment">#æ¸…åæºï¼š</span><br>sudo add-apt-repository <span class="hljs-string">&quot;deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu <span class="hljs-subst">$(lsb_release -cs)</span> stable&quot;</span><br></code></pre></td></tr></table></figure><h2 id="3-æ·»åŠ Dockerè½¯ä»¶æº"><a href="#3-æ·»åŠ Dockerè½¯ä»¶æº" class="headerlink" title="3.æ·»åŠ Dockerè½¯ä»¶æº"></a>3.æ·»åŠ Dockerè½¯ä»¶æº</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å®˜æ–¹æºï¼ˆå›½å†…æ¨èç”¨é˜¿é‡Œæºå’Œæ¸…åæºï¼‰</span><br>add-apt-repository <span class="hljs-string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu <span class="hljs-subst">$(lsb_release -cs)</span> stable&quot;</span> <br><br><span class="hljs-comment">#é˜¿é‡Œäº‘dockeræº</span><br>add-apt-repository <span class="hljs-string">&quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="hljs-subst">$(lsb_release -cs)</span> stable&quot;</span><br><br><span class="hljs-comment">#æ¸…ådockeræºï¼š</span><br>sudo add-apt-repository <span class="hljs-string">&quot;deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu <span class="hljs-subst">$(lsb_release -cs)</span> stable&quot;</span><br></code></pre></td></tr></table></figure><p>é˜¿é‡Œäº‘aptæºï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse&quot;</span> | sudo <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/aliyun.list<br></code></pre></td></tr></table></figure><h2 id="4-å®‰è£…å¹¶å¯åŠ¨Docker-CE"><a href="#4-å®‰è£…å¹¶å¯åŠ¨Docker-CE" class="headerlink" title="4.å®‰è£…å¹¶å¯åŠ¨Docker-CE"></a>4.å®‰è£…å¹¶å¯åŠ¨Docker-CE</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">apt update <br><br>apt install -y docker-ce docker-ce-cli containerd.io  <br>systemctl start docker  <br>systemctl status docker <br>systemctl <span class="hljs-built_in">enable</span> docker<br><br>docker --version<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>liunx</category>
      
      <category>Ubuntu</category>
      
    </categories>
    
    
    <tags>
      
      <tag>liunx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»Centos-7è¿ç§»åˆ°RockyLinux-8.8çš„æ•™ç¨‹</title>
    <link href="/2023/06/05/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Rockyliunx/centos7%E8%BF%81%E7%A7%BB%E5%88%B0Rockylinux/"/>
    <url>/2023/06/05/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Rockyliunx/centos7%E8%BF%81%E7%A7%BB%E5%88%B0Rockylinux/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä»Centos-7è¿ç§»åˆ°RockyLinux-8-8çš„æ•™ç¨‹"><a href="#ä»Centos-7è¿ç§»åˆ°RockyLinux-8-8çš„æ•™ç¨‹" class="headerlink" title="ä»Centos-7è¿ç§»åˆ°RockyLinux-8.8çš„æ•™ç¨‹"></a>ä»Centos-7è¿ç§»åˆ°RockyLinux-8.8çš„æ•™ç¨‹</h1><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://zhuanlan.zhihu.com/p/571385318">https://zhuanlan.zhihu.com/p/571385318</a></p><h2 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h2><ul><li>CentOS 8 å·²åœ¨ 2021 å¹´31æ—¥ç»“æŸæ”¯æŒï¼ŒCentOS 7 ç”±äºç”¨æˆ·åŸºæ•°ä¸ç”¨æˆ·è´¡çŒ®è¾ƒå¤šï¼Œå› æ­¤ä¼šæŒ‰ç…§è®¡åˆ’ç»´æŠ¤è‡³ç”Ÿå‘½å‘¨æœŸç»“æŸå³ 2024 å¹´ 6 æœˆ 30 æ—¥ï¼Œæ¥ä¸‹æ¥ä¸€å¹´ä¼šæŠŠé‡å¿ƒæ”¾åˆ° CentOS Stream ä¸Šã€‚ç”±äºCentOS Streamç›¸å¯¹ä¸ç¨³å®šï¼Œå› æ­¤å¾ˆå¤šæœ‹å‹ä¼šæœ‰ä»Centos7è¿ç§»è‡³RockyLinux-8çš„éœ€æ±‚ã€‚å†™æ­¤æ•™ç¨‹å°±æ˜¯å¸®åŠ©æœ‰ç±»ä¼¼éœ€æ±‚çš„æœ‹å‹æ›´å¥½çš„è¿ç§»åˆ°RockyLinuxä¸Šã€‚</li><li>Rocky Linuxæ˜¯Red Hat Enterprise Linuxçš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå®ƒä½äºRed Hat Enterprise Linuxæˆ–RHELçš„ä¸‹æ¸¸ã€‚ä¸CentOSä¸€æ ·ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç¨³å®šçš„Linuxç‰ˆæœ¬ï¼Œéå¸¸é€‚åˆæœåŠ¡å™¨ã€‚å®ƒæ—¨åœ¨ä½œä¸ºCentOSçš„å…¼å®¹æ›¿ä»£ã€‚</li><li>Rocky Linuxæ˜¯ç”±CentOSåˆ›å§‹äººGregory Kurtzeråˆ›å»ºçš„ï¼ŒRocky Linux 8å’ŒCentOS 8ã€Red Hat Enterprise Linux8æ˜¯å®Œå…¨å…¼å®¹çš„ã€‚</li></ul><p><strong>å¦‚æœåœ¨æ­£å¼ç¯å¢ƒå‡çº§ï¼Œè¯·åšå¥½æ•°æ®å¤‡ä»½ä»¥åŠé‡è¦é…ç½®å¤‡ä»½ï¼</strong></p><h2 id="1-å®‰è£…epelæº"><a href="#1-å®‰è£…epelæº" class="headerlink" title="1.å®‰è£…epelæº"></a>1.å®‰è£…epelæº</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install epel-release<br></code></pre></td></tr></table></figure><h2 id="2-æ›´æ–°ç³»ç»Ÿè‡³æœ€æ–°ç‰ˆæœ¬ï¼Œé˜²æ­¢å‡çº§æ—¶å‡ºç°å„ç§å¥‡è‘©é—®é¢˜"><a href="#2-æ›´æ–°ç³»ç»Ÿè‡³æœ€æ–°ç‰ˆæœ¬ï¼Œé˜²æ­¢å‡çº§æ—¶å‡ºç°å„ç§å¥‡è‘©é—®é¢˜" class="headerlink" title="2.æ›´æ–°ç³»ç»Ÿè‡³æœ€æ–°ç‰ˆæœ¬ï¼Œé˜²æ­¢å‡çº§æ—¶å‡ºç°å„ç§å¥‡è‘©é—®é¢˜"></a>2.æ›´æ–°ç³»ç»Ÿè‡³æœ€æ–°ç‰ˆæœ¬ï¼Œé˜²æ­¢å‡çº§æ—¶å‡ºç°å„ç§å¥‡è‘©é—®é¢˜</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y update<br></code></pre></td></tr></table></figure><h2 id="3-é‡å¯ç³»ç»Ÿ"><a href="#3-é‡å¯ç³»ç»Ÿ" class="headerlink" title="3.é‡å¯ç³»ç»Ÿ"></a>3.é‡å¯ç³»ç»Ÿ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">reboot<br></code></pre></td></tr></table></figure><h2 id="4-å®‰è£…rpmconfå’Œyum-utils"><a href="#4-å®‰è£…rpmconfå’Œyum-utils" class="headerlink" title="4.å®‰è£…rpmconfå’Œyum-utils"></a>4.å®‰è£…rpmconfå’Œyum-utils</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install rpmconf yum-utils<br></code></pre></td></tr></table></figure><h2 id="5-æ‰§è¡Œrpmconf-ï¼Œå¦‚æœå‡ºç°ä¸€äº›æç¤ºï¼Œè¯·è¾“å…¥Yå’Œå›è½¦ç»§ç»­ï¼Œå¦‚æœæ²¡æç¤ºç»§ç»­ç¬¬å››æ­¥æ“ä½œ"><a href="#5-æ‰§è¡Œrpmconf-ï¼Œå¦‚æœå‡ºç°ä¸€äº›æç¤ºï¼Œè¯·è¾“å…¥Yå’Œå›è½¦ç»§ç»­ï¼Œå¦‚æœæ²¡æç¤ºç»§ç»­ç¬¬å››æ­¥æ“ä½œ" class="headerlink" title="5.æ‰§è¡Œrpmconf ï¼Œå¦‚æœå‡ºç°ä¸€äº›æç¤ºï¼Œè¯·è¾“å…¥Yå’Œå›è½¦ç»§ç»­ï¼Œå¦‚æœæ²¡æç¤ºç»§ç»­ç¬¬å››æ­¥æ“ä½œ"></a>5.æ‰§è¡Œrpmconf ï¼Œå¦‚æœå‡ºç°ä¸€äº›æç¤ºï¼Œè¯·è¾“å…¥Yå’Œå›è½¦ç»§ç»­ï¼Œå¦‚æœæ²¡æç¤ºç»§ç»­ç¬¬å››æ­¥æ“ä½œ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">rpmconf -a<br></code></pre></td></tr></table></figure><h2 id="6-å®‰è£…dnf"><a href="#6-å®‰è£…dnf" class="headerlink" title="6.å®‰è£…dnf"></a>6.å®‰è£…dnf</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install dnf<br></code></pre></td></tr></table></figure><h2 id="7-ç§»é™¤yumå’Œyum-metadata-parser"><a href="#7-ç§»é™¤yumå’Œyum-metadata-parser" class="headerlink" title="7.ç§»é™¤yumå’Œyum-metadata-parser"></a>7.ç§»é™¤yumå’Œyum-metadata-parser</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">dnf -y remove yum yum-metadata-parser<br></code></pre></td></tr></table></figure><h2 id="8-å®‰è£…RockyLinux8çš„æºå’Œå‡çº§epelæº"><a href="#8-å®‰è£…RockyLinux8çš„æºå’Œå‡çº§epelæº" class="headerlink" title="8.å®‰è£…RockyLinux8çš„æºå’Œå‡çº§epelæº"></a>8.å®‰è£…RockyLinux8çš„æºå’Œå‡çº§epelæº</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">rpm -e --nodeps `rpm -qa|grep centos-`<br></code></pre></td></tr></table></figure><p><img src="/2023/06/05/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Rockyliunx/centos7%E8%BF%81%E7%A7%BB%E5%88%B0Rockylinux/v2-1c65b4ba4fdedf7947cf50d3e784f875_720w.webp" alt="img"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">rpm -ivh --nodeps --force https://mirrors.aliyun.com/rockylinux/8/BaseOS/x86_64/os/Packages/r/rocky-release-8.8-1.7.el8.noarch.rpm<br>rpm -ivh --nodeps  --force https://mirrors.aliyun.com/rockylinux/8/BaseOS/x86_64/os/Packages/r/rocky-repos-8.8-1.7.el8.noarch.rpm<br>rpm -ivh --nodeps --force https://mirrors.aliyun.com/rockylinux/8/BaseOS/x86_64/os/Packages/r/rocky-gpg-keys-8.8-1.7.el8.noarch.rpm<br>dnf -y upgrade https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm<br><br>dnf clean all<br></code></pre></td></tr></table></figure><h2 id="9-å¸è½½centos7çš„å†…æ ¸åŠä¿®æ”¹pythonç¼–ç "><a href="#9-å¸è½½centos7çš„å†…æ ¸åŠä¿®æ”¹pythonç¼–ç " class="headerlink" title="9.å¸è½½centos7çš„å†…æ ¸åŠä¿®æ”¹pythonç¼–ç "></a>9.å¸è½½centos7çš„å†…æ ¸åŠä¿®æ”¹pythonç¼–ç </h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">rpm -e --nodeps `rpm -qa|grep -i kernel`<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹python2ç¼–ç </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /usr/lib/python2.7/site-packages/sitecustomize.py<br><br><span class="hljs-comment">##æ·»åŠ å¦‚ä¸‹ä»£ç </span><br><span class="hljs-comment"># encoding=utf8   </span><br>import sys   <br> <br>reload(sys)   <br>sys.setdefaultencoding(<span class="hljs-string">&#x27;utf8&#x27;</span>)   <br><span class="hljs-comment"># encoding=utf8  import sys    reload(sys)  sys.setdefaultencoding(&#x27;utf8&#x27;) </span><br></code></pre></td></tr></table></figure><h2 id="10-å‡çº§åˆ°RockyLinux8ï¼Œè¿™ä¸€æ­¥ä¸€èˆ¬ä¼šæŠ¥é”™ï¼Œå¦‚æœæ²¡æœ‰æŠ¥é”™è¯·è¿›è¡Œç¬¬10æ­¥æ“ä½œ"><a href="#10-å‡çº§åˆ°RockyLinux8ï¼Œè¿™ä¸€æ­¥ä¸€èˆ¬ä¼šæŠ¥é”™ï¼Œå¦‚æœæ²¡æœ‰æŠ¥é”™è¯·è¿›è¡Œç¬¬10æ­¥æ“ä½œ" class="headerlink" title="10.å‡çº§åˆ°RockyLinux8ï¼Œè¿™ä¸€æ­¥ä¸€èˆ¬ä¼šæŠ¥é”™ï¼Œå¦‚æœæ²¡æœ‰æŠ¥é”™è¯·è¿›è¡Œç¬¬10æ­¥æ“ä½œ"></a>10.å‡çº§åˆ°RockyLinux8ï¼Œè¿™ä¸€æ­¥ä¸€èˆ¬ä¼šæŠ¥é”™ï¼Œå¦‚æœæ²¡æœ‰æŠ¥é”™è¯·è¿›è¡Œç¬¬10æ­¥æ“ä½œ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">dnf -y --releasever=8 --allowerasing --<span class="hljs-built_in">setopt</span>=deltarpm=<span class="hljs-literal">false</span> distro-sync<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œä¸Šé¢çš„å‘½ä»¤ä¹‹åå¦‚æœæŠ¥ä¸‹é¢çš„é”™!è¯·æŠŠçº¢æ¡†å†…çš„åŒ…åï¼Œæ‰¾åˆ°æœ¬åœ°è·¯å¾„ï¼</p><p><img src="/2023/06/05/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Rockyliunx/centos7%E8%BF%81%E7%A7%BB%E5%88%B0Rockylinux/image-20230705181255532.png" alt="image-20230705181255532"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">find /var/cache/dnf/ -name *mariadb-connector-c-3.1.11-2.el8_3.x86_64*<br></code></pre></td></tr></table></figure><p><img src="/2023/06/05/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Rockyliunx/centos7%E8%BF%81%E7%A7%BB%E5%88%B0Rockylinux/image-20230705181431869.png" alt="image-20230705181431869"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">rpm -ivh --nodeps --force /var/cache/dnf/appstream-62ae9a0bbea44fbe/packages/mariadb-connector-c-3.1.11-2.el8_3.x86_64.rpm<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¤šä¸ªåŒ…ï¼Œé‡å¤æ­¥éª¤</span><br>find /var/cache/dnf/ -name *dracut-network-049-223.git20230119.el8.x86_64*<br><br>rpm -ivh --nodeps --force /var/cache/dnf/baseos-3e608afeebc9a90b/packages/dracut-network-049-223.git20230119.el8.x86_64.rpm<br><br></code></pre></td></tr></table></figure><p><img src="/2023/06/05/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Rockyliunx/centos7%E8%BF%81%E7%A7%BB%E5%88%B0Rockylinux/image-20230706100402115.png" alt="image-20230706100402115"></p><p>é‡æ–°æ‰§è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">dnf -y --releasever=8 --allowerasing --<span class="hljs-built_in">setopt</span>=deltarpm=<span class="hljs-literal">false</span> distro-sync<br></code></pre></td></tr></table></figure><p>é‡æ–°æ‰§è¡Œåï¼Œå‘ç°æœ‰ç›¸å…³æŠ¥é”™ï¼Œéœ€å¸è½½from package åé¢çš„åŒ…å</p><p><img src="/2023/06/05/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Rockyliunx/centos7%E8%BF%81%E7%A7%BB%E5%88%B0Rockylinux/image-20230706100503559.png" alt="image-20230706100503559"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">rpm -e --nodeps sysvinit-tools-2.88-14.dsf.el7.x86_64<br>rpm -e --nodeps python36-rpmconf-1.1.7-1.el7.1.noarch<br></code></pre></td></tr></table></figure><p>å¸è½½å®Œæˆåå†æ¬¡æ‰§è¡Œå‡çº§ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">dnf -y --releasever=8 --allowerasing --<span class="hljs-built_in">setopt</span>=deltarpm=<span class="hljs-literal">false</span> distro-sync<br></code></pre></td></tr></table></figure><h2 id="11-æ‰§è¡Œrpmconfï¼Œä¼šå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼Œä¸€ç›´è¾“å…¥Yå’Œå›è½¦å³å¯"><a href="#11-æ‰§è¡Œrpmconfï¼Œä¼šå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼Œä¸€ç›´è¾“å…¥Yå’Œå›è½¦å³å¯" class="headerlink" title="11.æ‰§è¡Œrpmconfï¼Œä¼šå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼Œä¸€ç›´è¾“å…¥Yå’Œå›è½¦å³å¯"></a>11.æ‰§è¡Œrpmconfï¼Œä¼šå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼Œä¸€ç›´è¾“å…¥Yå’Œå›è½¦å³å¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">rpmconf -a<br></code></pre></td></tr></table></figure><h2 id="12-å®‰è£…å†…æ ¸ï¼ˆé˜²æ­¢æœ‰äº›æ—¶å€™æ²¡å®‰è£…å†…æ ¸å¼€æœºå¤±è´¥ï¼Œå¼€æœºå¤±è´¥çš„å¯ä»¥ç”¨RockyLinux-8-ISOé•œåƒæ•‘æ´æ¨¡å¼å®‰è£…å†…æ ¸ï¼‰"><a href="#12-å®‰è£…å†…æ ¸ï¼ˆé˜²æ­¢æœ‰äº›æ—¶å€™æ²¡å®‰è£…å†…æ ¸å¼€æœºå¤±è´¥ï¼Œå¼€æœºå¤±è´¥çš„å¯ä»¥ç”¨RockyLinux-8-ISOé•œåƒæ•‘æ´æ¨¡å¼å®‰è£…å†…æ ¸ï¼‰" class="headerlink" title="12.å®‰è£…å†…æ ¸ï¼ˆé˜²æ­¢æœ‰äº›æ—¶å€™æ²¡å®‰è£…å†…æ ¸å¼€æœºå¤±è´¥ï¼Œå¼€æœºå¤±è´¥çš„å¯ä»¥ç”¨RockyLinux-8 ISOé•œåƒæ•‘æ´æ¨¡å¼å®‰è£…å†…æ ¸ï¼‰"></a>12.å®‰è£…å†…æ ¸ï¼ˆé˜²æ­¢æœ‰äº›æ—¶å€™æ²¡å®‰è£…å†…æ ¸å¼€æœºå¤±è´¥ï¼Œå¼€æœºå¤±è´¥çš„å¯ä»¥ç”¨RockyLinux-8 ISOé•œåƒæ•‘æ´æ¨¡å¼å®‰è£…å†…æ ¸ï¼‰</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">dnf -y install kernel kernel-core <br>dnf -y install shim grub2-tools-extra grubby grub2-common grub2-pc <br>dnf -y install grub2-tools-efi grub2-tools-minimal grub2-efi grub2-pc-modules grub2-tools<br></code></pre></td></tr></table></figure><h2 id="13-æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œé˜²æ­¢è¿ç§»å®Œæˆåæ‰¾ä¸åˆ°å¼•å¯¼ï¼Œé‡å¯å¼€ä¸äº†æœºï¼Œæ ¹æ®ä»¥ä¸‹å‘½ä»¤é€‰æ‹©åˆ†åŒºè¡¨ç±»å‹ï¼Œæ ¹æ®åˆ†åŒºè¡¨ç±»å‹æ‰§è¡Œç›¸å…³å‘½ä»¤"><a href="#13-æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œé˜²æ­¢è¿ç§»å®Œæˆåæ‰¾ä¸åˆ°å¼•å¯¼ï¼Œé‡å¯å¼€ä¸äº†æœºï¼Œæ ¹æ®ä»¥ä¸‹å‘½ä»¤é€‰æ‹©åˆ†åŒºè¡¨ç±»å‹ï¼Œæ ¹æ®åˆ†åŒºè¡¨ç±»å‹æ‰§è¡Œç›¸å…³å‘½ä»¤" class="headerlink" title="13.æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œé˜²æ­¢è¿ç§»å®Œæˆåæ‰¾ä¸åˆ°å¼•å¯¼ï¼Œé‡å¯å¼€ä¸äº†æœºï¼Œæ ¹æ®ä»¥ä¸‹å‘½ä»¤é€‰æ‹©åˆ†åŒºè¡¨ç±»å‹ï¼Œæ ¹æ®åˆ†åŒºè¡¨ç±»å‹æ‰§è¡Œç›¸å…³å‘½ä»¤"></a>13.æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œé˜²æ­¢è¿ç§»å®Œæˆåæ‰¾ä¸åˆ°å¼•å¯¼ï¼Œé‡å¯å¼€ä¸äº†æœºï¼Œæ ¹æ®ä»¥ä¸‹å‘½ä»¤é€‰æ‹©åˆ†åŒºè¡¨ç±»å‹ï¼Œæ ¹æ®åˆ†åŒºè¡¨ç±»å‹æ‰§è¡Œç›¸å…³å‘½ä»¤</h2><p>æŸ¥çœ‹åˆ†åŒºè¡¨ç±»å‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">fdisk -l<br></code></pre></td></tr></table></figure><p>MBRåˆ†åŒºè¡¨</p><p><img src="/2023/06/05/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Rockyliunx/centos7%E8%BF%81%E7%A7%BB%E5%88%B0Rockylinux/image-20230706152037755.png" alt="image-20230706152037755"></p><p>MBRåˆ†åŒºï¼ˆä¼ ç»Ÿçš„BIOSã€dosã€msdosï¼‰ï¼ˆæ³¨æ„&#x2F;dev&#x2F;sdaéœ€æ ¹æ®å®é™…æƒ…å†µè‡ªè¡Œé€‰æ‹©ç£ç›˜è·¯å¾„ï¼Œå…·ä½“å‚è€ƒä¸Šå›¾ï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">grub2-mkconfig -o /boot/grub2/grub.cfg <br>grub2-install /dev/sda<br></code></pre></td></tr></table></figure><p>GPTåˆ†åŒºè¡¨ï¼ˆUFFIçš„BIOSï¼‰</p><p><img src="/2023/06/05/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Rockyliunx/centos7%E8%BF%81%E7%A7%BB%E5%88%B0Rockylinux/image-20230706154616069.png" alt="image-20230706154616069"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> grubcfg=`find /boot/ -name rocky`<br>grub2-mkconfig -o <span class="hljs-variable">$grubcfg</span>/grub.cfg<br><span class="hljs-built_in">rm</span> -rf `find /boot/ -name centos`<br></code></pre></td></tr></table></figure><p>æ·»åŠ UEFIå¯åŠ¨é¡¹ï¼ˆæ³¨æ„&#x2F;dev&#x2F;nvme0n1ä¸ºefiåˆ†åŒºæ‰€åœ¨ç£ç›˜ï¼Œéœ€æ ¹æ®å®é™…æƒ…å†µè‡ªè¡Œé€‰æ‹©ç£ç›˜è·¯å¾„ï¼Œå…·ä½“å‚è€ƒä¸Šå›¾,-påé¢æ˜¯åˆ†åŒºä½ç½®ï¼ˆé»˜è®¤ä¸º1ï¼‰,efiåˆ†åŒºä¸º&#x2F;dev&#x2F;nvme0n1p1å€¼å°±æ˜¯1,efiåˆ†åŒºä¸º&#x2F;dev&#x2F;nvme0n1p2å€¼å°±æ˜¯2ï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">efibootmgr -c -w -L <span class="hljs-string">&quot;RockyLinux&quot;</span> -d /dev/nvme0n1 -p 1 -l \\EFI\\Boot\\bootx64.efi<br></code></pre></td></tr></table></figure><h2 id="14-é€‰æ‹©æ€§æ‰§è¡Œ-ï¼Œè§£å†³å®‰è£…yumæŠ¥é”™ã€‚"><a href="#14-é€‰æ‹©æ€§æ‰§è¡Œ-ï¼Œè§£å†³å®‰è£…yumæŠ¥é”™ã€‚" class="headerlink" title="14.(é€‰æ‹©æ€§æ‰§è¡Œ)ï¼Œè§£å†³å®‰è£…yumæŠ¥é”™ã€‚"></a>14.(é€‰æ‹©æ€§æ‰§è¡Œ)ï¼Œè§£å†³å®‰è£…yumæŠ¥é”™ã€‚</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">rm</span>- rf /etc/yum<br></code></pre></td></tr></table></figure><h2 id="15-å®‰è£…åŸºç¡€ç¯å¢ƒ"><a href="#15-å®‰è£…åŸºç¡€ç¯å¢ƒ" class="headerlink" title="15.å®‰è£…åŸºç¡€ç¯å¢ƒ"></a>15.å®‰è£…åŸºç¡€ç¯å¢ƒ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">dnf -y groupinstall <span class="hljs-string">&quot;Minimal Install&quot;</span><br></code></pre></td></tr></table></figure><h2 id="16-é‡å¯æœºå™¨"><a href="#16-é‡å¯æœºå™¨" class="headerlink" title="16.é‡å¯æœºå™¨"></a>16.é‡å¯æœºå™¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">reboot<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>liunx</category>
      
      <category>RockyLinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>liunx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>rockyliunxå®‰è£…docker</title>
    <link href="/2023/06/05/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Rockyliunx/rockyliunx%E5%AE%89%E8%A3%85docker/"/>
    <url>/2023/06/05/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Rockyliunx/rockyliunx%E5%AE%89%E8%A3%85docker/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="rockyliunxå®‰è£…docker"><a href="#rockyliunxå®‰è£…docker" class="headerlink" title="rockyliunxå®‰è£…docker"></a>rockyliunxå®‰è£…docker</h1><p><strong>ä¸centoså®‰è£…dockerä¸€è‡´ï¼Œä½†æ˜¯ä¸€ä¸ªæ˜¯ç”¨yumï¼Œä¸€ä¸ªä½¿ç”¨dnf</strong></p><h2 id="1-å®‰è£…dockeræº"><a href="#1-å®‰è£…dockeræº" class="headerlink" title="1.å®‰è£…dockeræº"></a>1.å®‰è£…dockeræº</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">dnf install -y dnf-plugins-core<br><br>sudo dnf config-manager \<br>    --add-repo \<br>    https://download.docker.com/linux/centos/docker-ce.repo<br><span class="hljs-comment">##æˆ–è€…</span><br><span class="hljs-built_in">cat</span> &gt;/etc/yum.repos.d/docker.repo&lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[docker-ce-edge]</span><br><span class="hljs-string">name=Docker CE Edge - \$basearch</span><br><span class="hljs-string">baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/7/\$basearch/edge</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">gpgcheck=1</span><br><span class="hljs-string">gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg</span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment">##æˆ–è€…</span><br><br></code></pre></td></tr></table></figure><h2 id="2-å®‰è£…docker"><a href="#2-å®‰è£…docker" class="headerlink" title="2.å®‰è£…docker"></a>2.å®‰è£…docker</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">dnf install -y docker-ce \<br>docker-ce-cli \<br>containerd.io \<br>docker-compose-plugin<br></code></pre></td></tr></table></figure><h2 id="3-å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨"><a href="#3-å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨" class="headerlink" title="3.å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨"></a>3.å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start docker<br><br>systemctl <span class="hljs-built_in">enable</span> docker.service<br></code></pre></td></tr></table></figure><h2 id="å¸è½½docker"><a href="#å¸è½½docker" class="headerlink" title="å¸è½½docker"></a>å¸è½½docker</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">dnf remove -y docker docker-client-latestnt \<br>docker-client-latest docker-common \<br>docker-latest docker-latest-logrotate \<br>docker-logrotate docker-selinux \<br>docker-engine-selinux docker-engine<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>liunx</category>
      
      <category>RockyLinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>liunx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlè‡ªæœ‰æ–¹å¼é‡‡é›†è·å–ç›‘æ§æ•°æ®</title>
    <link href="/2023/06/04/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/Mysql%E8%87%AA%E6%9C%89%E6%96%B9%E5%BC%8F%E9%87%87%E9%9B%86%E8%8E%B7%E5%8F%96%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE/"/>
    <url>/2023/06/04/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/Mysql%E8%87%AA%E6%9C%89%E6%96%B9%E5%BC%8F%E9%87%87%E9%9B%86%E8%8E%B7%E5%8F%96%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Mysqlè‡ªæœ‰æ–¹å¼é‡‡é›†è·å–ç›‘æ§æ•°æ®"><a href="#Mysqlè‡ªæœ‰æ–¹å¼é‡‡é›†è·å–ç›‘æ§æ•°æ®" class="headerlink" title="Mysqlè‡ªæœ‰æ–¹å¼é‡‡é›†è·å–ç›‘æ§æ•°æ®"></a>Mysqlè‡ªæœ‰æ–¹å¼é‡‡é›†è·å–ç›‘æ§æ•°æ®</h1><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://mp.weixin.qq.com/s/XWaagdDVXhQxZtFrfiSErA">https://mp.weixin.qq.com/s/XWaagdDVXhQxZtFrfiSErA</a></p><p>å¯¹äºå½“å‰æ•°æ®åº“çš„ç›‘æ§æ–¹å¼æœ‰å¾ˆå¤šï¼Œåˆ†ä¸ºæ•°æ®åº“<code>è‡ªå¸¦</code>ã€<code>å•†ç”¨</code>ã€<code>å¼€æº</code>ä¸‰å¤§ç±»ï¼Œæ¯ä¸€ç§éƒ½æœ‰å„è‡ªçš„ç‰¹è‰²ï¼›è€Œå¯¹äº mysql æ•°æ®åº“ç”±äºå…¶æœ‰å¾ˆé«˜çš„ç¤¾åŒºæ´»è·ƒåº¦ï¼Œç›‘æ§æ–¹å¼æ›´æ˜¯å¤šç§å¤šæ ·ï¼Œä¸ç®¡å“ªç§ç›‘æ§æ–¹å¼<strong>æœ€æ ¸å¿ƒçš„å°±æ˜¯ç›‘æ§æ•°æ®</strong>ï¼Œè·å–å¾—åˆ°å…¨é¢çš„ç›‘æ§æ•°æ®åå°±æ˜¯çµæ´»çš„å±•ç¤ºéƒ¨åˆ†ã€‚</p><p>é‚£æˆ‘ä»¬ä»Šå¤©å°±ä»‹ç»ä¸€ä¸‹å®Œå…¨é‡‡ç”¨ mysql è‡ªæœ‰æ–¹å¼é‡‡é›†è·å–ç›‘æ§æ•°æ®ï¼Œåœ¨å•ä½“ä¸‹è¾¾åˆ°æœ€å¿«é€Ÿã€æ–¹ä¾¿ã€æŸè€—æœ€å°ã€‚</p><p>æœ¬æ¬¡æ–‡ç« å®Œå…¨ä½¿ç”¨ mysql è‡ªå¸¦çš„ show å‘½ä»¤å®ç°è·å–ï¼Œä» <code>connects</code>ã€<code>buffercache</code>ã€<code>lock</code>ã€<code>SQ</code>Lã€<code>statement</code>ã€<code>Database throughputs</code>ã€<code>serverconfig</code> 7 å¤§æ–¹é¢å…¨é¢è·å–ç›‘æ§æ•°æ®ã€‚</p><h2 id="ä¸€ã€è¿æ¥æ•°ï¼ˆConnectsï¼‰"><a href="#ä¸€ã€è¿æ¥æ•°ï¼ˆConnectsï¼‰" class="headerlink" title="ä¸€ã€è¿æ¥æ•°ï¼ˆConnectsï¼‰"></a>ä¸€ã€è¿æ¥æ•°ï¼ˆConnectsï¼‰</h2><h3 id="æœ€å¤§ä½¿ç”¨è¿æ¥æ•°ï¼š"><a href="#æœ€å¤§ä½¿ç”¨è¿æ¥æ•°ï¼š" class="headerlink" title="æœ€å¤§ä½¿ç”¨è¿æ¥æ•°ï¼š"></a>æœ€å¤§ä½¿ç”¨è¿æ¥æ•°ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show status like â€˜Max_used_connectionsâ€™<br></code></pre></td></tr></table></figure><h3 id="å½“å‰æ‰“å¼€çš„è¿æ¥æ•°ï¼š"><a href="#å½“å‰æ‰“å¼€çš„è¿æ¥æ•°ï¼š" class="headerlink" title="å½“å‰æ‰“å¼€çš„è¿æ¥æ•°ï¼š"></a>å½“å‰æ‰“å¼€çš„è¿æ¥æ•°ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show status like â€˜Threads_connectedâ€™<br></code></pre></td></tr></table></figure><h2 id="äºŒã€ç¼“å­˜ï¼ˆbufferCacheï¼‰"><a href="#äºŒã€ç¼“å­˜ï¼ˆbufferCacheï¼‰" class="headerlink" title="äºŒã€ç¼“å­˜ï¼ˆbufferCacheï¼‰"></a>äºŒã€ç¼“å­˜ï¼ˆbufferCacheï¼‰</h2><h3 id="æœªä»ç¼“å†²æ± è¯»å–çš„æ¬¡æ•°ï¼š"><a href="#æœªä»ç¼“å†²æ± è¯»å–çš„æ¬¡æ•°ï¼š" class="headerlink" title="æœªä»ç¼“å†²æ± è¯»å–çš„æ¬¡æ•°ï¼š"></a>æœªä»ç¼“å†²æ± è¯»å–çš„æ¬¡æ•°ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show status like â€˜Innodb_buffer_pool_readsâ€™<br></code></pre></td></tr></table></figure><h3 id="ä»ç¼“å†²æ± è¯»å–çš„æ¬¡æ•°ï¼š"><a href="#ä»ç¼“å†²æ± è¯»å–çš„æ¬¡æ•°ï¼š" class="headerlink" title="ä»ç¼“å†²æ± è¯»å–çš„æ¬¡æ•°ï¼š"></a>ä»ç¼“å†²æ± è¯»å–çš„æ¬¡æ•°ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show status like â€˜Innodb_buffer_pool_read_requestsâ€™<br></code></pre></td></tr></table></figure><h3 id="ç¼“å†²æ± çš„æ€»é¡µæ•°ï¼š"><a href="#ç¼“å†²æ± çš„æ€»é¡µæ•°ï¼š" class="headerlink" title="ç¼“å†²æ± çš„æ€»é¡µæ•°ï¼š"></a>ç¼“å†²æ± çš„æ€»é¡µæ•°ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show status like â€˜Innodb_buffer_pool_pages_totalâ€™<br></code></pre></td></tr></table></figure><h3 id="ç¼“å†²æ± ç©ºé—²çš„é¡µæ•°ï¼š"><a href="#ç¼“å†²æ± ç©ºé—²çš„é¡µæ•°ï¼š" class="headerlink" title="ç¼“å†²æ± ç©ºé—²çš„é¡µæ•°ï¼š"></a>ç¼“å†²æ± ç©ºé—²çš„é¡µæ•°ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show status like â€˜Innodb_buffer_pool_pages_freeâ€™<br></code></pre></td></tr></table></figure><h3 id="ç¼“å­˜å‘½ä¸­ç‡è®¡ç®—ï¼š"><a href="#ç¼“å­˜å‘½ä¸­ç‡è®¡ç®—ï¼š" class="headerlink" title="ç¼“å­˜å‘½ä¸­ç‡è®¡ç®—ï¼š"></a>ç¼“å­˜å‘½ä¸­ç‡è®¡ç®—ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ï¼ˆ1-Innodb_buffer_pool_reads/Innodb_buffer_pool_read_requestsï¼‰*100%<br></code></pre></td></tr></table></figure><h3 id="ç¼“å­˜æ± ä½¿ç”¨ç‡ä¸ºï¼š"><a href="#ç¼“å­˜æ± ä½¿ç”¨ç‡ä¸ºï¼š" class="headerlink" title="ç¼“å­˜æ± ä½¿ç”¨ç‡ä¸ºï¼š"></a>ç¼“å­˜æ± ä½¿ç”¨ç‡ä¸ºï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">((Innodb_buffer_pool_pages_total-Innodb_buffer_pool_pages_freeï¼‰/Innodb_buffer_pool_pages_totalï¼‰*<span class="hljs-number">100</span>%<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€é”ï¼ˆlockï¼‰"><a href="#ä¸‰ã€é”ï¼ˆlockï¼‰" class="headerlink" title="ä¸‰ã€é”ï¼ˆlockï¼‰"></a>ä¸‰ã€é”ï¼ˆlockï¼‰</h2><h3 id="é”ç­‰å¾…ä¸ªæ•°ï¼š"><a href="#é”ç­‰å¾…ä¸ªæ•°ï¼š" class="headerlink" title="é”ç­‰å¾…ä¸ªæ•°ï¼š"></a>é”ç­‰å¾…ä¸ªæ•°ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show status like â€˜Innodb_row_lock_waitsâ€™<br></code></pre></td></tr></table></figure><h3 id="å¹³å‡æ¯æ¬¡é”ç­‰å¾…æ—¶é—´ï¼š"><a href="#å¹³å‡æ¯æ¬¡é”ç­‰å¾…æ—¶é—´ï¼š" class="headerlink" title="å¹³å‡æ¯æ¬¡é”ç­‰å¾…æ—¶é—´ï¼š"></a>å¹³å‡æ¯æ¬¡é”ç­‰å¾…æ—¶é—´ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show status like â€˜Innodb_row_lock_time_avgâ€™<br></code></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ˜¯å¦å­˜åœ¨è¡¨é”ï¼š"><a href="#æŸ¥çœ‹æ˜¯å¦å­˜åœ¨è¡¨é”ï¼š" class="headerlink" title="æŸ¥çœ‹æ˜¯å¦å­˜åœ¨è¡¨é”ï¼š"></a>æŸ¥çœ‹æ˜¯å¦å­˜åœ¨è¡¨é”ï¼š</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">open</span> <span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">where</span> in_use&gt;<span class="hljs-number">0</span>ï¼›<br></code></pre></td></tr></table></figure><h3 id="æœ‰æ•°æ®ä»£è¡¨å­˜åœ¨é”è¡¨ï¼Œç©ºä¸ºæ— è¡¨é”"><a href="#æœ‰æ•°æ®ä»£è¡¨å­˜åœ¨é”è¡¨ï¼Œç©ºä¸ºæ— è¡¨é”" class="headerlink" title="æœ‰æ•°æ®ä»£è¡¨å­˜åœ¨é”è¡¨ï¼Œç©ºä¸ºæ— è¡¨é”"></a>æœ‰æ•°æ®ä»£è¡¨å­˜åœ¨é”è¡¨ï¼Œç©ºä¸ºæ— è¡¨é”</h3><p><strong>å¤‡æ³¨</strong>ï¼šé”ç­‰å¾…ç»Ÿè®¡å¾—æ•°é‡ä¸ºç´¯åŠ æ•°æ®ï¼Œæ¯æ¬¡è·å–å¾—æ—¶å€™å¯ä»¥è·Ÿä¹‹å‰å¾—æ•°æ®è¿›è¡Œç›¸å‡ï¼Œå¾—åˆ°å½“å‰ç»Ÿè®¡å¾—æ•°æ®</p><h2 id="å››ã€SQL"><a href="#å››ã€SQL" class="headerlink" title="å››ã€SQL"></a>å››ã€SQL</h2><h3 id="æŸ¥çœ‹-mysql-å¼€å…³æ˜¯å¦æ‰“å¼€ï¼š"><a href="#æŸ¥çœ‹-mysql-å¼€å…³æ˜¯å¦æ‰“å¼€ï¼š" class="headerlink" title="æŸ¥çœ‹ mysql å¼€å…³æ˜¯å¦æ‰“å¼€ï¼š"></a>æŸ¥çœ‹ mysql å¼€å…³æ˜¯å¦æ‰“å¼€ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">show variables like <span class="hljs-string">&#x27;slow_query_log&#x27;</span>ï¼›<br><span class="hljs-comment">#ON ä¸ºå¼€å¯çŠ¶æ€ï¼Œå¦‚æœä¸º OFFï¼Œ`set global slow_query_log=1` è¿›è¡Œå¼€å¯</span><br></code></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-mysql-é˜ˆå€¼ï¼š"><a href="#æŸ¥çœ‹-mysql-é˜ˆå€¼ï¼š" class="headerlink" title="æŸ¥çœ‹ mysql é˜ˆå€¼ï¼š"></a>æŸ¥çœ‹ mysql é˜ˆå€¼ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show variables like â€˜long_query_timeâ€™ï¼›<br></code></pre></td></tr></table></figure><p> æ ¹æ®é¡µé¢ä¼ é€’é˜ˆå€¼å‚æ•°ï¼Œä¿®æ”¹é˜ˆå€¼ <code>set global long_query_time=0.1</code></p><h3 id="æŸ¥çœ‹-mysql-æ…¢-sql-ç›®å½•ï¼š"><a href="#æŸ¥çœ‹-mysql-æ…¢-sql-ç›®å½•ï¼š" class="headerlink" title="æŸ¥çœ‹ mysql æ…¢ sql ç›®å½•ï¼š"></a>æŸ¥çœ‹ mysql æ…¢ sql ç›®å½•ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show variables like â€˜slow_query_log_fileâ€™ï¼›<br></code></pre></td></tr></table></figure><h3 id="æ ¼å¼åŒ–æ…¢-sql-æ—¥å¿—ï¼š"><a href="#æ ¼å¼åŒ–æ…¢-sql-æ—¥å¿—ï¼š" class="headerlink" title="æ ¼å¼åŒ–æ…¢ sql æ—¥å¿—ï¼š"></a>æ ¼å¼åŒ–æ…¢ sql æ—¥å¿—ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysqldumpslow -s at -t 10 /export/data/mysql/log/slow.log<br></code></pre></td></tr></table></figure><p>æ³¨ï¼šæ­¤è¯­å¥é€šè¿‡ jdbc æ‰§è¡Œä¸äº†ï¼Œå±äºå‘½ä»¤è¡Œæ‰§è¡Œã€‚</p><p>æ„æ€ä¸ºï¼šæ˜¾ç¤ºå‡ºè€—æ—¶æœ€é•¿çš„ 10 ä¸ª SQL è¯­å¥æ‰§è¡Œä¿¡æ¯ï¼Œ10 å¯ä»¥ä¿®æ”¹ä¸º TOP ä¸ªæ•°ã€‚æ˜¾ç¤ºçš„ä¿¡æ¯ä¸ºï¼šæ‰§è¡Œæ¬¡æ•°ã€å¹³å‡æ‰§è¡Œæ—¶é—´ã€SQL è¯­å¥</p><p>å¤‡æ³¨ï¼šå½“ mysqldumpslow å‘½ä»¤æ‰§è¡Œå¤±è´¥æ—¶ï¼Œå°†æ…¢æ—¥å¿—åŒæ­¥åˆ°æœ¬åœ°è¿›è¡Œæ ¼å¼åŒ–å¤„ç†ã€‚</p><h2 id="äº”ã€statement"><a href="#äº”ã€statement" class="headerlink" title="äº”ã€statement"></a>äº”ã€statement</h2><p>insert æ•°é‡ï¼š<code>show status like â€˜Com_insertâ€™</code></p><p>delete æ•°é‡ï¼š<code>show status like â€˜Com_deleteâ€™</code></p><p>update æ•°é‡ï¼š<code>show status like â€˜Com_updateâ€™</code></p><p>select æ•°é‡ï¼š<code>show status like â€˜Com_selectâ€™</code></p><h2 id="å…­ã€ååï¼ˆDatabase-throughputsï¼‰"><a href="#å…­ã€ååï¼ˆDatabase-throughputsï¼‰" class="headerlink" title="å…­ã€ååï¼ˆDatabase throughputsï¼‰"></a>å…­ã€ååï¼ˆDatabase throughputsï¼‰</h2><p>å‘é€ååé‡ï¼š<code>show status like â€˜Bytes_sentâ€™</code></p><p>æ¥æ”¶ååé‡ï¼š<code>show status like â€˜Bytes_receivedâ€™</code></p><p>æ€»ååé‡ï¼š<code>Bytes_sent+Bytes_received</code></p><h2 id="ä¸ƒã€æ•°æ®åº“å‚æ•°ï¼ˆserverconfigï¼‰"><a href="#ä¸ƒã€æ•°æ®åº“å‚æ•°ï¼ˆserverconfigï¼‰" class="headerlink" title="ä¸ƒã€æ•°æ®åº“å‚æ•°ï¼ˆserverconfigï¼‰"></a>ä¸ƒã€æ•°æ®åº“å‚æ•°ï¼ˆserverconfigï¼‰</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show variables<br></code></pre></td></tr></table></figure><h2 id="å…«ã€æ…¢-SQL"><a href="#å…«ã€æ…¢-SQL" class="headerlink" title="å…«ã€æ…¢ SQL"></a>å…«ã€æ…¢ SQL</h2><p>æ…¢ SQL æŒ‡çš„æ˜¯ MySQL æ…¢æŸ¥è¯¢ï¼Œå…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡ long_query_time å€¼çš„ SQLã€‚</p><p>æˆ‘ä»¬å¸¸å¬ MySQL ä¸­æœ‰äºŒè¿›åˆ¶æ—¥å¿— binlogã€ä¸­ç»§æ—¥å¿— relaylogã€é‡åšå›æ»šæ—¥å¿— redologã€undolog ç­‰ã€‚é’ˆå¯¹æ…¢æŸ¥è¯¢ï¼Œè¿˜æœ‰ä¸€ç§æ…¢æŸ¥è¯¢æ—¥å¿— slowlogï¼Œç”¨æ¥è®°å½•åœ¨ MySQL ä¸­å“åº”æ—¶é—´è¶…è¿‡é˜€å€¼çš„è¯­å¥ã€‚</p><p>æ…¢ SQL å¯¹å®é™…ç”Ÿäº§ä¸šåŠ¡å½±å“æ˜¯è‡´å‘½çš„ï¼Œæ‰€ä»¥æµ‹è¯•äººå‘˜åœ¨æ€§èƒ½æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå¯¹æ•°æ®åº“ SQL è¯­å¥æ‰§è¡Œæƒ…å†µå®æ–½ç›‘æ§ï¼Œç»™å¼€å‘æä¾›å‡†ç¡®çš„æ€§èƒ½ä¼˜åŒ–æ„è§æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚é‚£æ€ä¹ˆä½¿ç”¨ Mysql æ•°æ®åº“æä¾›çš„æ…¢æŸ¥è¯¢æ—¥å¿—æ¥ç›‘æ§ SQL è¯­å¥æ‰§è¡Œæƒ…å†µï¼Œæ‰¾åˆ°æ¶ˆè€—è¾ƒé«˜çš„ SQL è¯­å¥ï¼Œä»¥ä¸‹è¯¦ç»†è¯´æ˜ä¸€ä¸‹æ…¢æŸ¥è¯¢æ—¥å¿—çš„ä½¿ç”¨æ­¥éª¤ï¼š</p><ul><li>ç¡®ä¿æ‰“å¼€æ…¢ SQL å¼€å…³ <code>slow_query_log</code></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">show variables like <span class="hljs-string">&#x27;slow_query_log&#x27;</span><br><span class="hljs-comment">#æŸ¥è¯¢å‡ºæ¥ç»“æœæ˜¯ON</span><br></code></pre></td></tr></table></figure><ul><li>è®¾ç½®æ…¢ SQL åŸŸå€¼ <code>long_query_time</code></li></ul><p>è¿™ä¸ª long_query_time æ˜¯ç”¨æ¥å®šä¹‰æ…¢äºå¤šå°‘ç§’çš„æ‰ç®— â€œæ…¢æŸ¥è¯¢â€ï¼Œæ³¨æ„å•ä½æ˜¯ç§’ï¼Œé€šè¿‡æ‰§è¡Œ sql æŒ‡ä»¤ <code>set long_query_time=1 </code>æ¥è®¾ç½® long_query_time çš„å€¼ä¸º 1, ä¹Ÿå°±æ˜¯æ‰§è¡Œæ—¶é—´è¶…è¿‡ 1 ç§’çš„éƒ½ç®—æ…¢æŸ¥è¯¢</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show variables like <span class="hljs-string">&#x27;long_query_time&#x27;</span><br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹æ…¢ SQL æ—¥å¿—è·¯å¾„</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show variables like <span class="hljs-string">&#x27;slow_query_log_file&#x27;</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡æ…¢ sql åˆ†æå·¥å…· mysqldumpslow æ ¼å¼åŒ–åˆ†ææ…¢ SQL æ—¥å¿— mysqldumpslow æ…¢æŸ¥è¯¢åˆ†æå·¥å…·ï¼Œæ˜¯ mysql å®‰è£…åè‡ªå¸¦çš„ï¼Œå¯ä»¥é€šè¿‡<code>./mysqldumpslow â€”help</code> æŸ¥çœ‹ä½¿ç”¨å‚æ•°è¯´æ˜</p><h3 id="å¸¸è§ç”¨æ³•ï¼š"><a href="#å¸¸è§ç”¨æ³•ï¼š" class="headerlink" title="å¸¸è§ç”¨æ³•ï¼š"></a>å¸¸è§ç”¨æ³•ï¼š</h3><h4 id="å–å‡ºä½¿ç”¨æœ€å¤šçš„-10-æ¡æ…¢æŸ¥è¯¢"><a href="#å–å‡ºä½¿ç”¨æœ€å¤šçš„-10-æ¡æ…¢æŸ¥è¯¢" class="headerlink" title="å–å‡ºä½¿ç”¨æœ€å¤šçš„ 10 æ¡æ…¢æŸ¥è¯¢"></a>å–å‡ºä½¿ç”¨æœ€å¤šçš„ 10 æ¡æ…¢æŸ¥è¯¢</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">./mysqldumpslow -s c -t 10 /export/data/mysql/log/slow.log<br></code></pre></td></tr></table></figure><h4 id="å–å‡ºæŸ¥è¯¢æ—¶é—´æœ€æ…¢çš„-3-æ¡æ…¢æŸ¥è¯¢"><a href="#å–å‡ºæŸ¥è¯¢æ—¶é—´æœ€æ…¢çš„-3-æ¡æ…¢æŸ¥è¯¢" class="headerlink" title="å–å‡ºæŸ¥è¯¢æ—¶é—´æœ€æ…¢çš„ 3 æ¡æ…¢æŸ¥è¯¢"></a>å–å‡ºæŸ¥è¯¢æ—¶é—´æœ€æ…¢çš„ 3 æ¡æ…¢æŸ¥è¯¢</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">./mysqldumpslow -s t -t 3 /export/data/mysql/log/slow.log<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä½¿ç”¨ mysqldumpslow çš„åˆ†æç»“æœä¸ä¼šæ˜¾ç¤ºå…·ä½“å®Œæ•´çš„ sql è¯­å¥ï¼Œåªä¼šæ˜¾ç¤º sql çš„ç»„æˆç»“æ„ï¼›</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">å‡å¦‚: SELECT FROM sms_send WHERE service_id=10 GROUP BY content LIMIT 0, 1000;<br>mysqldumpslow å‘½ä»¤æ‰§è¡Œåæ˜¾ç¤ºï¼š<br>Count: 2 Time=1.5s (3s) Lock=0.00s (0s) Rows=1000.0 (2000), vgos_dba[vgos_dba]@[10.130.229.196]SELECT FROM sms_send WHERE service_id=N GROUP BY content LIMIT N, N<br></code></pre></td></tr></table></figure><p>mysqldumpslow çš„åˆ†æç»“æœè¯¦è§£ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">Countï¼šè¡¨ç¤ºè¯¥ç±»å‹çš„è¯­å¥æ‰§è¡Œæ¬¡æ•°ï¼Œä¸Šå›¾ä¸­è¡¨ç¤º select è¯­å¥æ‰§è¡Œäº† 2 æ¬¡ã€‚<br>Timeï¼šè¡¨ç¤ºè¯¥ç±»å‹çš„è¯­å¥æ‰§è¡Œçš„å¹³å‡æ—¶é—´ï¼ˆæ€»è®¡æ—¶é—´ï¼‰<br>Lockï¼šé”æ—¶é—´ 0sã€‚<br>Rowsï¼šå•æ¬¡è¿”å›çš„ç»“æœæ•°æ˜¯ 1000 æ¡è®°å½•ï¼Œ2 æ¬¡æ€»å…±è¿”å› 2000 æ¡è®°å½•ã€‚<br></code></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªå·¥å…·å°±å¯ä»¥æŸ¥è¯¢å‡ºæ¥å“ªäº› sql è¯­å¥æ˜¯æ…¢ SQLï¼Œä»è€Œåé¦ˆç ”å‘è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚åŠ ç´¢å¼•ï¼Œè¯¥åº”ç”¨çš„å®ç°æ–¹å¼ç­‰ã€‚</p><h2 id="ä¹ã€å¸¸è§æ…¢-SQL-æ’æŸ¥"><a href="#ä¹ã€å¸¸è§æ…¢-SQL-æ’æŸ¥" class="headerlink" title="ä¹ã€å¸¸è§æ…¢ SQL æ’æŸ¥"></a>ä¹ã€å¸¸è§æ…¢ SQL æ’æŸ¥</h2><h3 id="ä¸ä½¿ç”¨å­æŸ¥è¯¢"><a href="#ä¸ä½¿ç”¨å­æŸ¥è¯¢" class="headerlink" title="ä¸ä½¿ç”¨å­æŸ¥è¯¢"></a>ä¸ä½¿ç”¨å­æŸ¥è¯¢</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">SELECT FROM t1 WHERE <span class="hljs-built_in">id</span> (SELECT <span class="hljs-built_in">id</span> FROM t2 WHERE name=â€™hechunyangâ€™);<br></code></pre></td></tr></table></figure><p>å­æŸ¥è¯¢åœ¨ MySQL5.5 ç‰ˆæœ¬é‡Œï¼Œå†…éƒ¨æ‰§è¡Œè®¡åˆ’å™¨æ˜¯è¿™æ ·æ‰§è¡Œçš„ï¼šå…ˆæŸ¥å¤–è¡¨å†åŒ¹é…å†…è¡¨ï¼Œè€Œä¸æ˜¯å…ˆæŸ¥å†…è¡¨ t2ï¼Œå½“å¤–è¡¨çš„æ•°æ®å¾ˆå¤§æ—¶ï¼ŒæŸ¥è¯¢é€Ÿåº¦ä¼šéå¸¸æ…¢ã€‚</p><p>åœ¨ MariaDB10&#x2F;MySQL5.6 ç‰ˆæœ¬é‡Œï¼Œé‡‡ç”¨ join å…³è”æ–¹å¼å¯¹å…¶è¿›è¡Œäº†ä¼˜åŒ–ï¼Œè¿™æ¡ SQL ä¼šè‡ªåŠ¨è½¬æ¢ä¸º <code>SELECT t1. FROM t1 JOIN t2 ON t1.id = t2.id;</code></p><p>ä½†è¯·æ³¨æ„çš„æ˜¯ï¼šä¼˜åŒ–åªé’ˆå¯¹ SELECT æœ‰æ•ˆï¼Œå¯¹ UPDATE&#x2F;DELETE å­ æŸ¥è¯¢æ— æ•ˆï¼Œ ç”Ÿäº§ç¯å¢ƒå°½é‡åº”é¿å…ä½¿ç”¨å­æŸ¥è¯¢ã€‚</p><h3 id="é¿å…å‡½æ•°ç´¢å¼•"><a href="#é¿å…å‡½æ•°ç´¢å¼•" class="headerlink" title="é¿å…å‡½æ•°ç´¢å¼•"></a>é¿å…å‡½æ•°ç´¢å¼•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">SELECT FROM t WHERE YEAR(d) &gt;= 2016;<br></code></pre></td></tr></table></figure><p>ç”±äº MySQL ä¸åƒ Oracle é‚£æ ·â½€æŒå‡½æ•°ç´¢å¼•ï¼Œå³ä½¿ d å­—æ®µæœ‰ç´¢å¼•ï¼Œä¹Ÿä¼šç›´æ¥å…¨è¡¨æ‰«æã€‚</p><p>åº”æ”¹ä¸º &gt; <code>SELECT FROM t WHERE d &gt;= â€˜2016-01-01â€™;</code></p><h3 id="ç”¨-IN-æ¥æ›¿æ¢-OR-ä½æ•ˆæŸ¥è¯¢"><a href="#ç”¨-IN-æ¥æ›¿æ¢-OR-ä½æ•ˆæŸ¥è¯¢" class="headerlink" title="ç”¨ IN æ¥æ›¿æ¢ OR ä½æ•ˆæŸ¥è¯¢"></a>ç”¨ IN æ¥æ›¿æ¢ OR ä½æ•ˆæŸ¥è¯¢</h3><p>æ…¢ <code>SELECT FROM t WHERE LOC_ID = 10 OR LOC_ID = 20 OR LOC_ID = 30;</code></p><p>é«˜æ•ˆæŸ¥è¯¢ &gt; <code>SELECT FROM t WHERE LOC_IN IN (10,20,30);</code></p><h3 id="LIKE-åŒç™¾åˆ†å·æ— æ³•ä½¿ç”¨åˆ°ç´¢å¼•"><a href="#LIKE-åŒç™¾åˆ†å·æ— æ³•ä½¿ç”¨åˆ°ç´¢å¼•" class="headerlink" title="LIKE åŒç™¾åˆ†å·æ— æ³•ä½¿ç”¨åˆ°ç´¢å¼•"></a>LIKE åŒç™¾åˆ†å·æ— æ³•ä½¿ç”¨åˆ°ç´¢å¼•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">SELECT FROM t WHERE name LIKE â€˜%de%â€™;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">SELECT FROM t WHERE name LIKE â€˜de%â€™;<br></code></pre></td></tr></table></figure><h3 id="åˆ†ç»„ç»Ÿè®¡å¯ä»¥ç¦æ­¢æ’åº"><a href="#åˆ†ç»„ç»Ÿè®¡å¯ä»¥ç¦æ­¢æ’åº" class="headerlink" title="åˆ†ç»„ç»Ÿè®¡å¯ä»¥ç¦æ­¢æ’åº"></a>åˆ†ç»„ç»Ÿè®¡å¯ä»¥ç¦æ­¢æ’åº</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">SELECT goods_id,count() FROM t GROUP BY goods_id;<br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQL å¯¹æ‰€æœ‰ GROUP BY col1ï¼Œcol2â€¦ çš„å­—æ®µè¿›â¾æ’åºã€‚å¦‚æœæŸ¥è¯¢åŒ…æ‹¬ GROUP BYï¼Œæƒ³è¦é¿å…æ’åºç»“æœçš„æ¶ˆè€—ï¼Œåˆ™å¯ä»¥æŒ‡å®š ORDER BY NULL ç¦æ­¢æ’åºã€‚</p><p>ä½¿ç”¨ <code>SELECT goods_id,count () FROM t GROUP BY goods_id ORDER BY NULL;</code></p><h3 id="ç¦æ­¢ä¸å¿…è¦çš„-ORDER-BY-æ’åº"><a href="#ç¦æ­¢ä¸å¿…è¦çš„-ORDER-BY-æ’åº" class="headerlink" title="ç¦æ­¢ä¸å¿…è¦çš„ ORDER BY æ’åº"></a>ç¦æ­¢ä¸å¿…è¦çš„ ORDER BY æ’åº</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">SELECT count(1) FROM user u LEFT JOIN user_info i ON u.id = i.user_id WHERE 1 = 1 ORDER BY u.create_time DESC;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>SELECT count (1) FROM user u LEFT JOIN user_info i ON u.id = i.user_id;</code></p><h2 id="åã€æ€»ç»“"><a href="#åã€æ€»ç»“" class="headerlink" title="åã€æ€»ç»“"></a>åã€æ€»ç»“</h2><p>mysql æ•°æ®åº“çš„ç›‘æ§æ”¯æŒé€šè¿‡ SQL æ–¹å¼ä» performance_schema åº“ä¸­è®¿é—®å¯¹åº”çš„è¡¨æ•°æ®ï¼Œå‰ææ˜¯åˆå§‹åŒ–æ­¤åº“å¹¶å¼€å¯ç›‘æ§æ•°æ®å†™å…¥ã€‚</p><p>å¯¹äºç›‘æ§è€Œè¨€ï¼Œä¸åœ¨äºæ‰‹æ®µçš„å¤šæ ·æ€§ï¼Œè€Œéœ€è¦æ˜ç™½ç›‘æ§çš„æœ¬è´¨ï¼Œä»¥åŠéœ€è¦çš„ç›‘æ§é¡¹å†…å®¹ï¼Œæ‰¾åˆ°ç¬¦åˆè‡ªèº«é¡¹ç›®ç‰¹è‰²çš„ç›‘æ§æ–¹å¼ã€‚</p><p>åœ¨é€‰æ‹©ç›‘æ§å·¥å…·å¯¹ mysql ç›‘æ§æ—¶ï¼Œéœ€è¦å…³æ³¨ç›‘æ§å·¥å…·æœ¬èº«å¯¹äºæ•°æ®åº“æœåŠ¡å™¨çš„æ¶ˆè€—ï¼Œä¸è¦å½±å“åˆ°å…¶è‡ªèº«çš„ä½¿ç”¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pgsqlå‘½ä»¤è®°å½•</title>
    <link href="/2023/06/03/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/pgsql%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/06/03/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/pgsql%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="pgsqlå‘½ä»¤è®°å½•"><a href="#pgsqlå‘½ä»¤è®°å½•" class="headerlink" title="pgsqlå‘½ä»¤è®°å½•"></a>pgsqlå‘½ä»¤è®°å½•</h1><h2 id="1ã€æ§åˆ¶å°å‘½ä»¤ï¼š"><a href="#1ã€æ§åˆ¶å°å‘½ä»¤ï¼š" class="headerlink" title="1ã€æ§åˆ¶å°å‘½ä»¤ï¼š"></a>1ã€æ§åˆ¶å°å‘½ä»¤ï¼š</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">\hï¼šæŸ¥çœ‹SQLå‘½ä»¤çš„è§£é‡Šï¼Œæ¯”å¦‚\h selectã€‚<br>\?ï¼šæŸ¥çœ‹psqlå‘½ä»¤åˆ—è¡¨ã€‚<br>\lï¼šåˆ—å‡ºæ‰€æœ‰æ•°æ®åº“ã€‚<br>\c [database_name]ï¼šè¿æ¥å…¶ä»–æ•°æ®åº“ã€‚<br>\dï¼šåˆ—å‡ºå½“å‰æ•°æ®åº“çš„æ‰€æœ‰è¡¨æ ¼ã€‚<br>\d [table_name]ï¼šåˆ—å‡ºæŸä¸€å¼ è¡¨æ ¼çš„ç»“æ„ã€‚<br>\<span class="hljs-built_in">du</span>ï¼šåˆ—å‡ºæ‰€æœ‰ç”¨æˆ·ã€‚<br>\eï¼šæ‰“å¼€æ–‡æœ¬ç¼–è¾‘å™¨ã€‚<br>\conninfoï¼šåˆ—å‡ºå½“å‰æ•°æ®åº“å’Œè¿æ¥çš„ä¿¡æ¯ã€‚<br></code></pre></td></tr></table></figure><h2 id="2ã€å¸¸ç”¨å‘½ä»¤ï¼š"><a href="#2ã€å¸¸ç”¨å‘½ä»¤ï¼š" class="headerlink" title="2ã€å¸¸ç”¨å‘½ä»¤ï¼š"></a>2ã€å¸¸ç”¨å‘½ä»¤ï¼š</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># åˆ›å»ºæ–°è¡¨ </span><br>CREATE TABLE user_tbl(name VARCHAR(20), signup_date DATE);<br><span class="hljs-comment"># æ’å…¥æ•°æ® </span><br>INSERT INTO user_tbl(name, signup_date) VALUES(<span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>, <span class="hljs-string">&#x27;2013-12-22&#x27;</span>);<br><span class="hljs-comment"># é€‰æ‹©è®°å½• </span><br>SELECT * FROM user_tbl;<br><span class="hljs-comment"># æ›´æ–°æ•°æ® </span><br>UPDATE user_tbl <span class="hljs-built_in">set</span> name = <span class="hljs-string">&#x27;æå››&#x27;</span> WHERE name = <span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>;<br><span class="hljs-comment"># åˆ é™¤è®°å½• </span><br>DELETE FROM user_tbl WHERE name = <span class="hljs-string">&#x27;æå››&#x27;</span> ;<br><span class="hljs-comment"># æ·»åŠ æ ä½ </span><br>ALTER TABLE user_tbl ADD email VARCHAR(40);<br><span class="hljs-comment"># æ›´æ–°ç»“æ„ </span><br>ALTER TABLE user_tbl ALTER COLUMN signup_date SET NOT NULL;<br><span class="hljs-comment"># æ›´åæ ä½ </span><br>ALTER TABLE user_tbl RENAME COLUMN signup_date TO signup;<br><span class="hljs-comment"># åˆ é™¤æ ä½ </span><br>ALTER TABLE user_tbl DROP COLUMN email;<br><span class="hljs-comment"># è¡¨æ ¼æ›´å </span><br>ALTER TABLE user_tbl RENAME TO backup_tbl;<br><span class="hljs-comment"># åˆ é™¤è¡¨æ ¼ </span><br>DROP TABLE IF EXISTS backup_tbl;<br></code></pre></td></tr></table></figure><h2 id="3ã€ç”¨æˆ·ä¸è®¿é—®æˆæƒè¯­æ³•ç¤ºä¾‹"><a href="#3ã€ç”¨æˆ·ä¸è®¿é—®æˆæƒè¯­æ³•ç¤ºä¾‹" class="headerlink" title="3ã€ç”¨æˆ·ä¸è®¿é—®æˆæƒè¯­æ³•ç¤ºä¾‹"></a>3ã€ç”¨æˆ·ä¸è®¿é—®æˆæƒè¯­æ³•ç¤ºä¾‹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ–°å»ºç”¨æˆ·</span><br>CREATE USER <span class="hljs-built_in">test</span> WITH PASSWORD <span class="hljs-string">&#x27;test&#x27;</span>;<br> <br><span class="hljs-comment">#èµ‹äºˆæŒ‡å®šè´¦æˆ·æŒ‡å®šæ•°æ®åº“æ‰€æœ‰æƒé™</span><br>GRANT ALL PRIVILEGES ON DATABASE mydb TO <span class="hljs-built_in">test</span>;<br> <br><span class="hljs-comment">#ç§»é™¤æŒ‡å®šè´¦æˆ·æŒ‡å®šæ•°æ®åº“æ‰€æœ‰æƒé™</span><br>REVOKE ALL PRIVILEGES ON DATABASE mydb TO <span class="hljs-built_in">test</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>PostgreSQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PostgreSQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>rabbitmqçš„å®‰è£…å’Œæ¦‚å¿µ</title>
    <link href="/2023/06/02/%E4%B8%AD%E9%97%B4%E4%BB%B6/rabbitmq/rabbitmq%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E6%A6%82%E5%BF%B5/"/>
    <url>/2023/06/02/%E4%B8%AD%E9%97%B4%E4%BB%B6/rabbitmq/rabbitmq%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="rabbitmqçš„å®‰è£…å’Œæ¦‚å¿µ"><a href="#rabbitmqçš„å®‰è£…å’Œæ¦‚å¿µ" class="headerlink" title="rabbitmqçš„å®‰è£…å’Œæ¦‚å¿µ"></a>rabbitmqçš„å®‰è£…å’Œæ¦‚å¿µ</h1><h2 id="ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ"><a href="#ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ"></a>ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ</h2><p>åŸºç¡€æ¦‚å¿µå‚è€ƒæ–‡æ¡£ï¼š<a href="https://mp.weixin.qq.com/s/nhpiIPfD6lWBEAnXuuL4lw">https://mp.weixin.qq.com/s/nhpiIPfD6lWBEAnXuuL4lw</a></p><ul><li><p>ç”Ÿäº§è€…ï¼šäº§ç”Ÿæ•°æ®å‘é€æ¶ˆæ¯çš„ç¨‹åºæ˜¯ç”Ÿäº§è€…</p></li><li><p>äº¤æ¢æœºï¼šäº¤æ¢æœºæ˜¯ RabbitMQ éå¸¸é‡è¦çš„ä¸€ä¸ªéƒ¨ä»¶ï¼Œä¸€æ–¹é¢å®ƒæ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢å®ƒå°†æ¶ˆæ¯ æ¨é€åˆ°é˜Ÿåˆ—ä¸­ã€‚äº¤æ¢æœºå¿…é¡»ç¡®åˆ‡çŸ¥é“å¦‚ä½•å¤„ç†å®ƒæ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œæ˜¯å°†è¿™äº›æ¶ˆæ¯æ¨é€åˆ°ç‰¹å®šé˜Ÿåˆ—è¿˜æ˜¯æ¨ é€åˆ°å¤šä¸ªé˜Ÿåˆ—ï¼Œäº¦æˆ–è€…æ˜¯æŠŠæ¶ˆæ¯ä¸¢å¼ƒï¼Œè¿™ä¸ªå¾—æœ‰äº¤æ¢æœºç±»å‹å†³å®š</p></li><li><p>é˜Ÿåˆ—ï¼šé˜Ÿåˆ—æ˜¯ RabbitMQ å†…éƒ¨ä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå°½ç®¡æ¶ˆæ¯æµç» RabbitMQ å’Œåº”ç”¨ç¨‹åºï¼Œä½†å®ƒä»¬åªèƒ½å­˜ å‚¨åœ¨é˜Ÿåˆ—ä¸­ã€‚é˜Ÿåˆ—ä»…å—ä¸»æœºçš„å†…å­˜å’Œç£ç›˜é™åˆ¶çš„çº¦æŸï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¤§çš„æ¶ˆæ¯ç¼“å†²åŒºã€‚è®¸å¤šç”Ÿäº§è€…å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¸å¤šæ¶ˆè´¹è€…å¯ä»¥å°è¯•ä»ä¸€ä¸ªé˜Ÿåˆ—æ¥æ”¶æ•°æ®ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨é˜Ÿåˆ—çš„æ–¹å¼</p></li><li><p>æ¶ˆè´¹è€…ï¼šæ¶ˆè´¹ä¸æ¥æ”¶å…·æœ‰ç›¸ä¼¼çš„å«ä¹‰ã€‚æ¶ˆè´¹è€…å¤§å¤šæ—¶å€™æ˜¯ä¸€ä¸ªç­‰å¾…æ¥æ”¶æ¶ˆæ¯çš„ç¨‹åºã€‚è¯·æ³¨æ„ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹ è€…å’Œæ¶ˆæ¯ä¸­é—´ä»¶å¾ˆå¤šæ—¶å€™å¹¶ä¸åœ¨åŒä¸€æœºå™¨ä¸Šã€‚åŒä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¢å¯ä»¥æ˜¯ç”Ÿäº§è€…åˆæ˜¯å¯ä»¥æ˜¯æ¶ˆè´¹è€…ã€‚</p></li></ul><h2 id="äºŒã€RabbitMQå·¥ä½œæ¨¡å¼"><a href="#äºŒã€RabbitMQå·¥ä½œæ¨¡å¼" class="headerlink" title="äºŒã€RabbitMQå·¥ä½œæ¨¡å¼"></a>äºŒã€RabbitMQå·¥ä½œæ¨¡å¼</h2><ul><li>1ã€ç®€å•æ¨¡å¼</li><li>2ã€work-queueå·¥ä½œé˜Ÿåˆ—æ¨¡å¼</li><li>3ã€Publish&#x2F;Subscribeå‘å¸ƒä¸è®¢é˜…æ¨¡å¼</li><li>4ã€Routingè·¯ç”±æ¨¡å¼</li><li>5ã€Topicsä¸»é¢˜æ¨¡å¼</li><li>6ã€RPCè¿œç¨‹è°ƒç”¨æ¨¡å¼ï¼ˆè¿œç¨‹è°ƒç”¨ï¼Œä¸å¤ªç®—MQï¼Œä¸ä½œä»‹ç»ï¼‰</li><li>7ã€Publisher Confirmså‘å¸ƒç¡®è®¤</li></ul><h2 id="ä¸‰ã€å·¥ä½œæµç¨‹"><a href="#ä¸‰ã€å·¥ä½œæµç¨‹" class="headerlink" title="ä¸‰ã€å·¥ä½œæµç¨‹"></a>ä¸‰ã€å·¥ä½œæµç¨‹</h2><p><strong>ç”Ÿäº§è€…å®¢æˆ·ç«¯ï¼š</strong></p><ul><li>å®¢æˆ·ç«¯è¿æ¥åˆ°RabbitMQæœåŠ¡å™¨ä¸Šï¼Œæ‰“å¼€ä¸€ä¸ªæ¶ˆæ¯é€šé“ï¼ˆchannelï¼‰ï¼›</li><li>å®¢æˆ·ç«¯å£°æ˜ä¸€ä¸ªæ¶ˆæ¯äº¤æ¢æœºï¼ˆexchangeï¼‰ï¼Œå¹¶è®¾ç½®ç›¸å…³å±æ€§ã€‚</li><li>å®¢æˆ·ç«¯å£°æ˜ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆqueueï¼‰ï¼Œå¹¶è®¾ç½®ç›¸å…³å±æ€§ã€‚</li><li>å®¢æˆ·ç«¯ä½¿ç”¨routing keyåœ¨æ¶ˆæ¯äº¤æ¢æœºï¼ˆexchangeï¼‰å’Œæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆqueueï¼‰ä¸­å»ºç«‹å¥½ç»‘å®šå…³ç³»ã€‚</li><li>å®¢æˆ·ç«¯æŠ•é€’æ¶ˆæ¯éƒ½æ¶ˆæ¯äº¤æ¢æœºï¼ˆexchangeï¼‰ä¸Š</li><li>å®¢æˆ·ç«¯å…³é—­æ¶ˆæ¯é€šé“ï¼ˆchannelï¼‰ä»¥åŠå’ŒæœåŠ¡å™¨çš„è¿æ¥ã€‚<br><strong>æœåŠ¡å™¨ç«¯ï¼š</strong><br>exchangeæ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œæ ¹æ®æ¶ˆæ¯çš„keyå’Œä»¥åŠè®¾ç½®çš„bindingï¼Œè¿›è¡Œæ¶ˆæ¯è·¯ç”±ï¼Œå°†æ¶ˆæ¯æŠ•é€’åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚</li></ul><h2 id="å››ã€å®‰è£…è¿‡ç¨‹ï¼ˆrpmåŒ…å®‰è£…æ–¹å¼åŠäºŒè¿›åˆ¶åŒ…å®‰è£…æ–¹å¼ï¼‰ï¼š"><a href="#å››ã€å®‰è£…è¿‡ç¨‹ï¼ˆrpmåŒ…å®‰è£…æ–¹å¼åŠäºŒè¿›åˆ¶åŒ…å®‰è£…æ–¹å¼ï¼‰ï¼š" class="headerlink" title="å››ã€å®‰è£…è¿‡ç¨‹ï¼ˆrpmåŒ…å®‰è£…æ–¹å¼åŠäºŒè¿›åˆ¶åŒ…å®‰è£…æ–¹å¼ï¼‰ï¼š"></a>å››ã€å®‰è£…è¿‡ç¨‹ï¼ˆrpmåŒ…å®‰è£…æ–¹å¼åŠäºŒè¿›åˆ¶åŒ…å®‰è£…æ–¹å¼ï¼‰ï¼š</h2><p>RabbitMQæ˜¯ç”±erlangè¯­è¨€å¼€å‘ï¼Œæ‰€ä»¥æˆ‘åœ¨å®‰è£… RabbitMQ ä¸€å®šè¦å…ˆå®‰è£…Erlangç¯å¢ƒ,æ³¨æ„ç‰ˆæœ¬åŒ¹é…ã€‚</p><p>æŸ¥çœ‹ç‰ˆæœ¬é€‰æ‹©ï¼š<a href="https://www.rabbitmq.com/which-erlang.html">https://www.rabbitmq.com/which-erlang.html</a></p><p>rabbitmqå®˜ç½‘ä¸‹è½½åœ°å€ï¼š</p><ul><li><a href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a></li><li><a href="https://github.com/rabbitmq/rabbitmq-server/tags">https://github.com/rabbitmq/rabbitmq-server/tags</a></li></ul><p>Erlangå®˜ç½‘ä¸‹è½½åœ°å€ï¼š</p><ul><li><a href="https://www.erlang-solutions.com/downloads/">https://www.erlang-solutions.com/downloads/</a></li><li><a href="http://erlang.org/download/">http://erlang.org/download/</a></li></ul><h3 id="4-1ã€rpmåŒ…å®‰è£…æ–¹å¼å®‰è£…RabbitmqåŠErlang"><a href="#4-1ã€rpmåŒ…å®‰è£…æ–¹å¼å®‰è£…RabbitmqåŠErlang" class="headerlink" title="4.1ã€rpmåŒ…å®‰è£…æ–¹å¼å®‰è£…RabbitmqåŠErlang"></a>4.1ã€rpmåŒ…å®‰è£…æ–¹å¼å®‰è£…RabbitmqåŠErlang</h3><h4 id="4-1-1ã€ä¸‹è½½æˆ–ä¸Šä¼ ç›¸å…³rpmåŒ…ï¼ˆrpmåŒ…å®‰è£…æ–¹å¼ï¼‰"><a href="#4-1-1ã€ä¸‹è½½æˆ–ä¸Šä¼ ç›¸å…³rpmåŒ…ï¼ˆrpmåŒ…å®‰è£…æ–¹å¼ï¼‰" class="headerlink" title="4.1.1ã€ä¸‹è½½æˆ–ä¸Šä¼ ç›¸å…³rpmåŒ…ï¼ˆrpmåŒ…å®‰è£…æ–¹å¼ï¼‰"></a>4.1.1ã€ä¸‹è½½æˆ–ä¸Šä¼ ç›¸å…³rpmåŒ…ï¼ˆrpmåŒ…å®‰è£…æ–¹å¼ï¼‰</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /app<br><br><span class="hljs-comment">#ä¸‹è½½rabbitmqçš„rpmåŒ…</span><br>wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.13.0-rc.1/rabbitmq-server-3.13.0.rc.1-1.el8.noarch.rpm<br><br><span class="hljs-comment">#ä¸‹è½½erlangçš„rpmåŒ…</span><br>wget https://binaries2.erlang-solutions.com/centos/7/esl-erlang_25.0.3_1~centos~7_x86_64.rpm<br></code></pre></td></tr></table></figure><h4 id="4-1-2ã€å®‰è£…"><a href="#4-1-2ã€å®‰è£…" class="headerlink" title="4.1.2ã€å®‰è£…"></a>4.1.2ã€å®‰è£…</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">rpm -ivh  esl-erlang_25.0.3_1~centos~7_x86_64.rpm <br>yum install socat -y<br>rpm -ivh rabbitmq-server-3.13.0.rc.1-1.el8.noarch.rpm<br></code></pre></td></tr></table></figure><h4 id="4-1-3ã€å¯åŠ¨æœåŠ¡"><a href="#4-1-3ã€å¯åŠ¨æœåŠ¡" class="headerlink" title="4.1.3ã€å¯åŠ¨æœåŠ¡"></a>4.1.3ã€å¯åŠ¨æœåŠ¡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># å¯åŠ¨æœåŠ¡</span><br>systemctl start rabbitmq-server<br><span class="hljs-comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span><br>systemctl status rabbitmq-server<br><span class="hljs-comment"># å¼€æœºè‡ªå¯åŠ¨</span><br>systemctl <span class="hljs-built_in">enable</span> rabbitmq-server<br></code></pre></td></tr></table></figure><h3 id="4-2ã€äºŒè¿›åˆ¶å®‰è£…åŒ…æ–¹å¼å®‰è£…RabbitmqåŠErlang"><a href="#4-2ã€äºŒè¿›åˆ¶å®‰è£…åŒ…æ–¹å¼å®‰è£…RabbitmqåŠErlang" class="headerlink" title="4.2ã€äºŒè¿›åˆ¶å®‰è£…åŒ…æ–¹å¼å®‰è£…RabbitmqåŠErlang"></a>4.2ã€äºŒè¿›åˆ¶å®‰è£…åŒ…æ–¹å¼å®‰è£…RabbitmqåŠErlang</h3><h4 id="4-2-1ã€å®‰è£…erlang"><a href="#4-2-1ã€å®‰è£…erlang" class="headerlink" title="4.2.1ã€å®‰è£…erlang"></a>4.2.1ã€å®‰è£…erlang</h4><h5 id="4-2-1-1ã€å®‰è£…ä¾èµ–åŒ…"><a href="#4-2-1-1ã€å®‰è£…ä¾èµ–åŒ…" class="headerlink" title="4.2.1.1ã€å®‰è£…ä¾èµ–åŒ…"></a>4.2.1.1ã€å®‰è£…ä¾èµ–åŒ…</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install make gcc gcc-c++ m4 ncurses-devel openssl-devel unixODBC-devel<br></code></pre></td></tr></table></figure><h5 id="4-2-1-2ã€ä¸‹è½½äºŒè¿›åˆ¶åŒ…"><a href="#4-2-1-2ã€ä¸‹è½½äºŒè¿›åˆ¶åŒ…" class="headerlink" title="4.2.1.2ã€ä¸‹è½½äºŒè¿›åˆ¶åŒ…"></a>4.2.1.2ã€ä¸‹è½½äºŒè¿›åˆ¶åŒ…</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://github.com/erlang/otp/releases/download/OTP-26.1.2/otp_src_26.1.2.tar.gz<br></code></pre></td></tr></table></figure><h5 id="4-2-1-3ã€åˆ›å»ºå·¥ä½œç›®å½•ã€è§£å‹å¹¶ç¼–è¯‘å®‰è£…erlang"><a href="#4-2-1-3ã€åˆ›å»ºå·¥ä½œç›®å½•ã€è§£å‹å¹¶ç¼–è¯‘å®‰è£…erlang" class="headerlink" title="4.2.1.3ã€åˆ›å»ºå·¥ä½œç›®å½•ã€è§£å‹å¹¶ç¼–è¯‘å®‰è£…erlang"></a>4.2.1.3ã€åˆ›å»ºå·¥ä½œç›®å½•ã€è§£å‹å¹¶ç¼–è¯‘å®‰è£…erlang</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /usr/local/erlang <br><br>tar -xnf otp_src_26.1.2.tar.gz<br><br><span class="hljs-built_in">cd</span> otp_src_26.1.2<br>./configure --prefix=/usr/local/erlang --without-javac<br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure><h5 id="4-2-1-4ã€è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#4-2-1-4ã€è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="4.2.1.4ã€è®¾ç½®ç¯å¢ƒå˜é‡"></a>4.2.1.4ã€è®¾ç½®ç¯å¢ƒå˜é‡</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/profile<br><span class="hljs-comment">#åœ¨æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/usr/local/erlang/bin<br><br><span class="hljs-comment">#ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> /etc/profile<br><br><span class="hljs-comment">#æ£€éªŒå®‰è£…</span><br>erl -version<br></code></pre></td></tr></table></figure><h4 id="4-2-2ã€å®‰è£…rabbitmq"><a href="#4-2-2ã€å®‰è£…rabbitmq" class="headerlink" title="4.2.2ã€å®‰è£…rabbitmq"></a>4.2.2ã€å®‰è£…rabbitmq</h4><h5 id="4-2-2-1ã€ä¸‹è½½rabbitmqå®‰è£…åŒ…"><a href="#4-2-2-1ã€ä¸‹è½½rabbitmqå®‰è£…åŒ…" class="headerlink" title="4.2.2.1ã€ä¸‹è½½rabbitmqå®‰è£…åŒ…"></a>4.2.2.1ã€ä¸‹è½½rabbitmqå®‰è£…åŒ…</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install socat -y<br><br>wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.12.7/rabbitmq-server-generic-unix-3.12.7.tar.xz<br></code></pre></td></tr></table></figure><h5 id="4-2-2-2ã€è§£å‹å¹¶ç§»åŠ¨åˆ°æŒ‡å®šå·¥ä½œè·¯å¾„"><a href="#4-2-2-2ã€è§£å‹å¹¶ç§»åŠ¨åˆ°æŒ‡å®šå·¥ä½œè·¯å¾„" class="headerlink" title="4.2.2.2ã€è§£å‹å¹¶ç§»åŠ¨åˆ°æŒ‡å®šå·¥ä½œè·¯å¾„"></a>4.2.2.2ã€è§£å‹å¹¶ç§»åŠ¨åˆ°æŒ‡å®šå·¥ä½œè·¯å¾„</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -xnf  rabbitmq-server*.tar.xz<br><br><span class="hljs-built_in">mv</span> rabbitmq_server-3.12.7/ /usr/local/rabbitmq_server<br><br></code></pre></td></tr></table></figure><h5 id="4-2-2-3ã€è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#4-2-2-3ã€è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="4.2.2.3ã€è®¾ç½®ç¯å¢ƒå˜é‡"></a>4.2.2.3ã€è®¾ç½®ç¯å¢ƒå˜é‡</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/profile<br><span class="hljs-comment">#åœ¨æœ€åæ·»åŠ ä¸€æ </span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/usr/local/rabbitmq_server/sbin<br><br><span class="hljs-comment">#ä½¿ä¹‹ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><h5 id="4-2-2-4ã€åå°å¯åŠ¨Rabbitmq"><a href="#4-2-2-4ã€åå°å¯åŠ¨Rabbitmq" class="headerlink" title="4.2.2.4ã€åå°å¯åŠ¨Rabbitmq"></a>4.2.2.4ã€åå°å¯åŠ¨Rabbitmq</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">rabbitmq-server -detached<br><br><span class="hljs-comment">#å…³é—­rabbitmq</span><br>rabbitmqctl shutdown<br></code></pre></td></tr></table></figure><h2 id="äº”ã€Webç®¡ç†ç•Œé¢åŠæˆæƒæ“ä½œ"><a href="#äº”ã€Webç®¡ç†ç•Œé¢åŠæˆæƒæ“ä½œ" class="headerlink" title="äº”ã€Webç®¡ç†ç•Œé¢åŠæˆæƒæ“ä½œ"></a>äº”ã€Webç®¡ç†ç•Œé¢åŠæˆæƒæ“ä½œ</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¯æ²¡æœ‰å®‰è£…webç«¯çš„å®¢æˆ·ç«¯æ’ä»¶ï¼Œéœ€è¦å®‰è£…æ‰å¯ä»¥ç”Ÿæ•ˆ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">rabbitmq-plugins <span class="hljs-built_in">enable</span> rabbitmq_management<br><span class="hljs-comment">#systemctl restart rabbitmq-server</span><br></code></pre></td></tr></table></figure><p>è®¿é—® <a href="http://127.0.0.1:15672/">http://127.0.0.1:15672</a> ï¼Œç”¨é»˜è®¤è´¦å·å¯†ç (guest)ç™»å½•</p><p><strong>é»˜è®¤æƒ…å†µä¸‹åªèƒ½åœ¨localhostæœ¬æœºè®¿é—®</strong></p><h4 id="5-1ã€-æ·»åŠ è¿œç¨‹ç™»å½•ç”¨æˆ·"><a href="#5-1ã€-æ·»åŠ è¿œç¨‹ç™»å½•ç”¨æˆ·" class="headerlink" title="5.1ã€ æ·»åŠ è¿œç¨‹ç™»å½•ç”¨æˆ·"></a>5.1ã€ æ·»åŠ è¿œç¨‹ç™»å½•ç”¨æˆ·</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># åˆ é™¤é»˜è®¤ç”¨æˆ·</span><br>rabbitmqctl delete_user guest<br><br><span class="hljs-comment"># åˆ›å»ºè´¦å·å’Œå¯†ç </span><br>rabbitmqctl add_user admin 123456<br><br><span class="hljs-comment"># è®¾ç½®ç”¨æˆ·è§’è‰²</span><br>rabbitmqctl set_user_tags admin administrator<br><br><span class="hljs-comment"># ä¸ºç”¨æˆ·æ·»åŠ èµ„æºæƒé™</span><br><span class="hljs-comment"># set_permissions [-p &lt;vhostpath&gt;] &lt;user&gt; &lt;conf&gt; &lt;write&gt; &lt;read&gt;</span><br>rabbitmqctl set_permissions -p <span class="hljs-string">&quot;/&quot;</span> admin <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span><br><span class="hljs-comment"># æ·»åŠ é…ç½®ã€å†™ã€è¯»æƒé™</span><br></code></pre></td></tr></table></figure><p><strong>ç”¨æˆ·çº§åˆ«</strong></p><ul><li>administratorï¼šå¯ä»¥ç™»å½•æ§åˆ¶å°ã€æŸ¥çœ‹æ‰€æœ‰ä¿¡æ¯ã€å¯ä»¥å¯¹ rabbitmq è¿›è¡Œç®¡ç†</li><li>monitoringï¼šç›‘æ§è€… ç™»å½•æ§åˆ¶å°ï¼ŒæŸ¥çœ‹æ‰€æœ‰ä¿¡æ¯</li><li>policymakerï¼šç­–ç•¥åˆ¶å®šè€… ç™»å½•æ§åˆ¶å°ï¼ŒæŒ‡å®šç­–ç•¥</li><li>managmentï¼šæ™®é€šç®¡ç†å‘˜ ç™»å½•æ§åˆ¶å°</li></ul><h4 id="5-2ã€é‡ç½®å‘½ä»¤"><a href="#5-2ã€é‡ç½®å‘½ä»¤" class="headerlink" title="5.2ã€é‡ç½®å‘½ä»¤"></a>5.2ã€é‡ç½®å‘½ä»¤</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å…³é—­åº”ç”¨çš„å‘½ä»¤ï¼š</span><br>rabbitmqctl stop_app<br><span class="hljs-comment">#æ¸…é™¤çš„å‘½ä»¤ï¼š</span><br>rabbitmqctl reset<br><span class="hljs-comment">#é‡æ–°å¯åŠ¨å‘½ä»¤ï¼š</span><br>rabbitmqctl start_app<br></code></pre></td></tr></table></figure><h3 id="5-3ã€å¸¸ç”¨å‘½ä»¤ä»‹ç»"><a href="#5-3ã€å¸¸ç”¨å‘½ä»¤ä»‹ç»" class="headerlink" title="5.3ã€å¸¸ç”¨å‘½ä»¤ä»‹ç»"></a>5.3ã€å¸¸ç”¨å‘½ä»¤ä»‹ç»</h3><p>å¸¸ç”¨çš„ RabbitMQ æ§åˆ¶å°å‘½ä»¤ï¼ˆä½¿ç”¨ rabbitmqctlï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ—å‡ºæ‰€æœ‰é˜Ÿåˆ—</span><br>rabbitmqctl list_queues<br><span class="hljs-comment">#åˆ—å‡ºæ‰€æœ‰äº¤æ¢å™¨</span><br>rabbitmqctl list_exchanges<br><span class="hljs-comment">#åˆ—å‡ºæ‰€æœ‰ç»‘å®š</span><br>rabbitmqctl list_bindings<br><span class="hljs-comment">#åˆ—å‡ºæ‰€æœ‰è¿æ¥</span><br>rabbitmqctl list_connections<br><span class="hljs-comment">#åˆ—å‡ºæ‰€æœ‰é€šé“</span><br>rabbitmqctl list_channels<br><span class="hljs-comment">#åˆ—å‡ºæ‰€æœ‰æ¶ˆè´¹è€…</span><br>rabbitmqctl list_consumers<br><span class="hljs-comment">#æŸ¥çœ‹é˜Ÿåˆ—çš„çŠ¶æ€ä¿¡æ¯</span><br>rabbitmqctl list_queues name messages_ready messages_unacknowledged<br><span class="hljs-comment">#æŸ¥çœ‹äº¤æ¢å™¨çš„çŠ¶æ€ä¿¡æ¯</span><br>rabbitmqctl list_exchanges name <span class="hljs-built_in">type</span><br><span class="hljs-comment">#æŸ¥çœ‹è¿æ¥çš„çŠ¶æ€ä¿¡æ¯</span><br>rabbitmqctl list_connections name user state<br><span class="hljs-comment">#æŸ¥çœ‹é€šé“çš„çŠ¶æ€ä¿¡æ¯</span><br>rabbitmqctl list_channels connection_name user number_of_consumers<br><span class="hljs-comment">#æŸ¥çœ‹ RabbitMQ èŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯</span><br>rabbitmqctl status<br><span class="hljs-comment">#æŸ¥çœ‹ RabbitMQ èŠ‚ç‚¹çš„è¯¦ç»†çŠ¶æ€ä¿¡æ¯</span><br>rabbitmqctl status --verbose<br><span class="hljs-comment">#æŸ¥çœ‹ RabbitMQ èŠ‚ç‚¹çš„é…ç½®ä¿¡æ¯</span><br>rabbitmqctl environment<br><span class="hljs-comment">#æŸ¥çœ‹ RabbitMQ èŠ‚ç‚¹çš„è¿è¡Œæ—¥å¿—</span><br>rabbitmqctl report<br><span class="hljs-comment">#æŸ¥çœ‹ RabbitMQ èŠ‚ç‚¹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</span><br>rabbitmqctl <span class="hljs-built_in">eval</span> <span class="hljs-string">&#x27;memory&#x27;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>rabbitmq</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rabbitmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Prometheusé‡‡é›†ä¿¡æ¯agentï¼ˆcadvisorã€node_exporterï¼‰è¿è¡Œå®‰è£…</title>
    <link href="/2023/06/01/%E7%9B%91%E6%8E%A7/Prometheus/Prometheus%E9%87%87%E9%9B%86%E4%BF%A1%E6%81%AFagent%EF%BC%88cadvisor%E3%80%81node_exporter%EF%BC%89%E8%BF%90%E8%A1%8C%E5%AE%89%E8%A3%85/"/>
    <url>/2023/06/01/%E7%9B%91%E6%8E%A7/Prometheus/Prometheus%E9%87%87%E9%9B%86%E4%BF%A1%E6%81%AFagent%EF%BC%88cadvisor%E3%80%81node_exporter%EF%BC%89%E8%BF%90%E8%A1%8C%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Prometheusé‡‡é›†ä¿¡æ¯agentï¼ˆcadvisorã€node-exporterï¼‰è¿è¡Œå®‰è£…"><a href="#Prometheusé‡‡é›†ä¿¡æ¯agentï¼ˆcadvisorã€node-exporterï¼‰è¿è¡Œå®‰è£…" class="headerlink" title="Prometheusé‡‡é›†ä¿¡æ¯agentï¼ˆcadvisorã€node_exporterï¼‰è¿è¡Œå®‰è£…"></a>Prometheusé‡‡é›†ä¿¡æ¯agentï¼ˆcadvisorã€node_exporterï¼‰è¿è¡Œå®‰è£…</h1><h2 id="å‰è¨€ï¼šè¯¥ä¸¤ä¸ªagenté‡‡ç”¨dockerè¿è¡Œï¼æˆ–è€…äºŒè¿›åˆ¶è¿è¡Œ"><a href="#å‰è¨€ï¼šè¯¥ä¸¤ä¸ªagenté‡‡ç”¨dockerè¿è¡Œï¼æˆ–è€…äºŒè¿›åˆ¶è¿è¡Œ" class="headerlink" title="å‰è¨€ï¼šè¯¥ä¸¤ä¸ªagenté‡‡ç”¨dockerè¿è¡Œï¼æˆ–è€…äºŒè¿›åˆ¶è¿è¡Œ"></a>å‰è¨€ï¼šè¯¥ä¸¤ä¸ªagenté‡‡ç”¨dockerè¿è¡Œï¼æˆ–è€…äºŒè¿›åˆ¶è¿è¡Œ</h2><h2 id="ä¸€ã€ä½¿ç”¨dockerè¿è¡Œ"><a href="#ä¸€ã€ä½¿ç”¨dockerè¿è¡Œ" class="headerlink" title="ä¸€ã€ä½¿ç”¨dockerè¿è¡Œ"></a>ä¸€ã€ä½¿ç”¨dockerè¿è¡Œ</h2><h3 id="1ã€æ”¶é›†å®¹å™¨ä¿¡æ¯ï¼šcadvisor"><a href="#1ã€æ”¶é›†å®¹å™¨ä¿¡æ¯ï¼šcadvisor" class="headerlink" title="1ã€æ”¶é›†å®¹å™¨ä¿¡æ¯ï¼šcadvisor"></a>1ã€æ”¶é›†å®¹å™¨ä¿¡æ¯ï¼šcadvisor</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">mkdir</span> -p /app/prometheus<br><br><span class="hljs-built_in">cat</span> &gt; /app/prometheus/cadvisor.sh &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">#!/bin/bash</span><br><span class="hljs-string">docker rm -f cadvisor</span><br><span class="hljs-string">docker run -v /:/rootfs:ro \\</span><br><span class="hljs-string">--restart=always  \\</span><br><span class="hljs-string">-v /var/run:/var/run/:rw \\</span><br><span class="hljs-string">-v /sys:/sys:ro \\</span><br><span class="hljs-string">-v /var/lib/docker:/var/lib/docker:ro \\</span><br><span class="hljs-string">-p 7000:8080 \\</span><br><span class="hljs-string">--detach=true \\</span><br><span class="hljs-string">--name=cadvisor \\</span><br><span class="hljs-string">google/cadvisor</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h3 id="2ã€æ”¶é›†æœåŠ¡å™¨ä¿¡æ¯ï¼šnode-exporter"><a href="#2ã€æ”¶é›†æœåŠ¡å™¨ä¿¡æ¯ï¼šnode-exporter" class="headerlink" title="2ã€æ”¶é›†æœåŠ¡å™¨ä¿¡æ¯ï¼šnode_exporter"></a>2ã€æ”¶é›†æœåŠ¡å™¨ä¿¡æ¯ï¼šnode_exporter</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /app/prometheus/node_exporter.sh &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">#!/bin/bash</span><br><span class="hljs-string">docker rm -f node-exporter</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker run -d -p 7100:7100 \\</span><br><span class="hljs-string">--restart=always  \\</span><br><span class="hljs-string">-v /proc:/host/proc \\</span><br><span class="hljs-string">-v /sys:/host/sys \\</span><br><span class="hljs-string">-v /:/rootfs \\</span><br><span class="hljs-string">--name node-exporter \\</span><br><span class="hljs-string">--net=host prom/node-exporter \\</span><br><span class="hljs-string">--web.listen-address=&quot;:7100&quot; \\</span><br><span class="hljs-string">--path.procfs /host/proc --path.sysfs /host/sys --collector.filesystem.ignored-mount-points &quot;^/(sys|proc|dev|host|etc)($|/)&quot;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h3 id="3ã€è¿è¡Œ"><a href="#3ã€è¿è¡Œ" class="headerlink" title="3ã€è¿è¡Œ"></a>3ã€è¿è¡Œ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">bash /app/prometheus/cadvisor.sh<br>bash /app/prometheus/node_exporter.sh <br></code></pre></td></tr></table></figure><h2 id="äºŒã€ä½¿ç”¨äºŒè¿›åˆ¶è¿è¡Œï¼Œå¹¶è®¾ç½®ä¸ºæœåŠ¡è‡ªå¯åŠ¨"><a href="#äºŒã€ä½¿ç”¨äºŒè¿›åˆ¶è¿è¡Œï¼Œå¹¶è®¾ç½®ä¸ºæœåŠ¡è‡ªå¯åŠ¨" class="headerlink" title="äºŒã€ä½¿ç”¨äºŒè¿›åˆ¶è¿è¡Œï¼Œå¹¶è®¾ç½®ä¸ºæœåŠ¡è‡ªå¯åŠ¨"></a>äºŒã€ä½¿ç”¨äºŒè¿›åˆ¶è¿è¡Œï¼Œå¹¶è®¾ç½®ä¸ºæœåŠ¡è‡ªå¯åŠ¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¸‹è½½åŒ…</span><br>wget https://github.com/prometheus/node_exporter/releases/download/v1.6.1/node_exporter-1.6.1.linux-amd64.tar.gz<br><span class="hljs-comment">#è§£å‹</span><br>tar -xnf  node_exporter-1.6.1.linux-amd64.tar.gz<br><span class="hljs-built_in">cd</span> node_exporter-1.6.1.linux-amd64<br><span class="hljs-built_in">cp</span> node_exporter /usr/local/bin/<br><span class="hljs-comment">#ç¼–å†™æœåŠ¡æ–‡ä»¶</span><br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF &gt; /usr/lib/systemd/system/node_exporter.service </span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">User=root</span><br><span class="hljs-string">Group=root</span><br><span class="hljs-string">ExecStart=/usr/local/bin/node_exporter --web.listen-address=:7100</span><br><span class="hljs-string">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Install]</span><br><span class="hljs-string">WantedBy=multi-user.target</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Unit]</span><br><span class="hljs-string">Description=node_exporter</span><br><span class="hljs-string">After=network.target </span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment">#å¯åŠ¨</span><br>systemctl start node_exporter.service<br>systemctl status node_exporter<br>systemctl <span class="hljs-built_in">enable</span> node_exporter<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç›‘æ§</category>
      
      <category>prometheus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlæ•…éšœå¤„ç†ï¼Œä»¥åŠè§£å†³æ–¹æ³•</title>
    <link href="/2023/05/17/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%EF%BC%8C%E4%BB%A5%E5%8F%8A%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95/"/>
    <url>/2023/05/17/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%EF%BC%8C%E4%BB%A5%E5%8F%8A%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="mysqlæ•…éšœå¤„ç†ï¼Œä»¥åŠè§£å†³æ–¹æ³•"><a href="#mysqlæ•…éšœå¤„ç†ï¼Œä»¥åŠè§£å†³æ–¹æ³•" class="headerlink" title="mysqlæ•…éšœå¤„ç†ï¼Œä»¥åŠè§£å†³æ–¹æ³•"></a>mysqlæ•…éšœå¤„ç†ï¼Œä»¥åŠè§£å†³æ–¹æ³•</h1><h2 id="ä¸€ã€-æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰æ—¶å¹¶ä¸éœ€è¦åœ¨æœ¬åœ°å®‰è£…ä¸€ä¸ªmysql-serveræœåŠ¡ï¼Œåªéœ€è¦å®‰è£…ä¸€ä¸ªç™»å½•mysql-server-çš„mysqlçš„å®¢æˆ·ç«¯client"><a href="#ä¸€ã€-æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰æ—¶å¹¶ä¸éœ€è¦åœ¨æœ¬åœ°å®‰è£…ä¸€ä¸ªmysql-serveræœåŠ¡ï¼Œåªéœ€è¦å®‰è£…ä¸€ä¸ªç™»å½•mysql-server-çš„mysqlçš„å®¢æˆ·ç«¯client" class="headerlink" title="ä¸€ã€ æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰æ—¶å¹¶ä¸éœ€è¦åœ¨æœ¬åœ°å®‰è£…ä¸€ä¸ªmysql serveræœåŠ¡ï¼Œåªéœ€è¦å®‰è£…ä¸€ä¸ªç™»å½•mysql server çš„mysqlçš„å®¢æˆ·ç«¯client"></a>ä¸€ã€ æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰æ—¶å¹¶ä¸éœ€è¦åœ¨æœ¬åœ°å®‰è£…ä¸€ä¸ªmysql serveræœåŠ¡ï¼Œåªéœ€è¦å®‰è£…ä¸€ä¸ªç™»å½•mysql server çš„mysqlçš„å®¢æˆ·ç«¯client</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#centos6ç³»ç»Ÿä¸Šå®‰è£…mysql-clientçš„æ–¹å¼ï¼š</span><br>yum install mysql-clent mysql-devel -y<br><span class="hljs-comment">#centos7çš„ç³»ç»Ÿä¸Šå®‰è£…mysql clientçš„æ–¹å¼ï¼š</span><br>yum install -y mariadb.x86_64 mariadb-libs.x86_64<br></code></pre></td></tr></table></figure><h2 id="äºŒã€-liunxæœåŠ¡å™¨ä¸­ï¼Œå¯¼å‡ºmysqlæŸ¥è¯¢å‡ºæ¥çš„æ•°æ®"><a href="#äºŒã€-liunxæœåŠ¡å™¨ä¸­ï¼Œå¯¼å‡ºmysqlæŸ¥è¯¢å‡ºæ¥çš„æ•°æ®" class="headerlink" title="äºŒã€ liunxæœåŠ¡å™¨ä¸­ï¼Œå¯¼å‡ºmysqlæŸ¥è¯¢å‡ºæ¥çš„æ•°æ®"></a>äºŒã€ liunxæœåŠ¡å™¨ä¸­ï¼Œå¯¼å‡ºmysqlæŸ¥è¯¢å‡ºæ¥çš„æ•°æ®</h2><p><strong>æŸ¥çœ‹çœ‹æ•°æ®åº“é…ç½®çš„å¯¼å‡ºè·¯å¾„: secure_file_privä¸ºå¯¼å‡ºè·¯å¾„</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">show variables like <span class="hljs-string">&#x27;%secure%&#x27;</span><br>1ã€ <span class="hljs-comment">#å¦‚æœsecure_file_privä¸ºnullåˆ™å¯ä»¥ä½¿ç”¨  </span><br>mysqldump  -uç”¨æˆ·å -p  åº“å  è¡¨å &gt; ä¿å­˜çš„æ–‡ä»¶åç§°(æ–‡ä»¶ä¿å­˜çš„çš„è·¯å¾„ä¸ºå½“å‰ä½¿ç”¨å‘½ä»¤çš„è·¯å¾„)<br>2ã€ <span class="hljs-comment">#å¯¼å‡ºè¯­å¥ä¸­çš„å¯¼å‡ºè·¯å¾„ä¸ºä¸Šé¢æŸ¥è¯¢åˆ°çš„secure_file_privçš„è·¯å¾„</span><br>mysql&gt;select * from table into outfile <span class="hljs-string">&#x27;å¯¼å‡ºè·¯å¾„/1.xls&#x27;</span>;<br></code></pre></td></tr></table></figure><p><code>into outfile</code>ä¸ºæ•°æ®å¯¼å‡ºçš„è·¯å¾„ï¼Œè¿™ä¸ªå°±æ˜¯ç¬¬ä¸€æ­¥æŸ¥è¯¢åˆ°çš„è·¯å¾„ï¼Œå¯¼å‡ºçš„æ•°æ®å¿…é¡»æ˜¯è¿™ä¸ªå€¼çš„æŒ‡å®šè·¯å¾„æ‰å¯ä»¥å¯¼å‡ºï¼Œ<br>é»˜è®¤æœ‰å¯èƒ½æ˜¯NULLå°±ä»£è¡¨ç¦æ­¢å¯¼å‡ºï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®ä¸€ä¸‹ï¼›æˆ‘ä»¬éœ€è¦åœ¨&#x2F;etc&#x2F;my.cnf æ–‡ä»¶çš„æœ«å°¾è¿›è¡Œè®¾ç½®ã€‚</p><p>åœ¨æœ«å°¾æ·»åŠ ä¸€å¥secure_file_priv&#x3D;â€&#x2F;â€œå³å¯å°†æ•°æ®å¯¼å‡ºåˆ°ä»»æ„ç›®å½•ï¼›secure_file_priv</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">1ã€é™åˆ¶mysqld ä¸å…è®¸å¯¼å…¥ã€å¯¼å‡º<br>ã€€ã€€ã€€ secure_file_prive=null<br>2ã€é™åˆ¶mysqld çš„å¯¼å…¥ã€å¯¼å‡º åªèƒ½å‘ç”Ÿåœ¨/tmp/ç›®å½•ä¸‹<br>ã€€ã€€ã€€secure_file_priv=/tmp/<br>3ã€å¯ä»¥å¯¼å‡ºè‡³ä»»æ„ç›®å½•<br>      secure_file_priv=<span class="hljs-string">&quot;/&quot;</span><br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€-æ£€æŸ¥æ‰€ä»¥æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨æ˜¯å¦æ­£å¸¸"><a href="#ä¸‰ã€-æ£€æŸ¥æ‰€ä»¥æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨æ˜¯å¦æ­£å¸¸" class="headerlink" title="ä¸‰ã€ #æ£€æŸ¥æ‰€ä»¥æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨æ˜¯å¦æ­£å¸¸"></a>ä¸‰ã€ #æ£€æŸ¥æ‰€ä»¥æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨æ˜¯å¦æ­£å¸¸</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysqlcheck -c --all-databases -uroot -p <br></code></pre></td></tr></table></figure><h2 id="å››ã€-ERROR-2059-HY000-é”™è¯¯å¤„ç†"><a href="#å››ã€-ERROR-2059-HY000-é”™è¯¯å¤„ç†" class="headerlink" title="å››ã€ ERROR 2059 (HY000)é”™è¯¯å¤„ç†"></a>å››ã€ ERROR 2059 (HY000)é”™è¯¯å¤„ç†</h2><p><strong>é”™è¯¯æç¤ºï¼š</strong><br>ERROR 2059 (HY000): Authentication plugin â€˜caching_sha2_passwordâ€™ <br>cannot be loaded: &#x2F;usr&#x2F;lib64&#x2F;mysql&#x2F;plugin&#x2F;caching_sha2_password.so: cannot open shared object file: No such file or directory<br><strong>å¤„ç†æ–¹å¼ï¼š</strong><br>MySQL8.0ä¹‹åçš„åŠ å¯†è§„åˆ™ä¸ºcaching_sha2_password.è€Œåœ¨æ­¤ä¹‹å‰çš„åŠ å¯†è§„åˆ™ä¸ºmysql_native_passwordã€‚<br>å¯ä»¥å°†åŠ å¯†è§„åˆ™æ”¹æˆmysql_native_passwordæ¥ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ALTER USER <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED WITH mysql_native_password BY <span class="hljs-string">&#x27;root&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="äº”ã€-ERROR-1418-HY000-é”™è¯¯å¤„ç†"><a href="#äº”ã€-ERROR-1418-HY000-é”™è¯¯å¤„ç†" class="headerlink" title="äº”ã€ ERROR 1418 (HY000)é”™è¯¯å¤„ç†"></a>äº”ã€ ERROR 1418 (HY000)é”™è¯¯å¤„ç†</h2><p><strong>é”™è¯¯æç¤ºï¼š</strong><br>ERROR 1418 (HY000): This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA<br><strong>è§£å†³åŠæ³•ï¼š</strong><br>è®¾ç½®ä¸´æ—¶ç¯å¢ƒå˜é‡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">set</span> global log_bin_trust_function_creators=1;<br></code></pre></td></tr></table></figure><h2 id="å…­ã€-é”™è¯¯å¤„ç†ERROR-1712ï¼ˆå¾€æ•°æ®åº“é‡Œé¢æ’å…¥æ•°æ®æ—¶ï¼‰"><a href="#å…­ã€-é”™è¯¯å¤„ç†ERROR-1712ï¼ˆå¾€æ•°æ®åº“é‡Œé¢æ’å…¥æ•°æ®æ—¶ï¼‰" class="headerlink" title="å…­ã€ é”™è¯¯å¤„ç†ERROR 1712ï¼ˆå¾€æ•°æ®åº“é‡Œé¢æ’å…¥æ•°æ®æ—¶ï¼‰"></a>å…­ã€ é”™è¯¯å¤„ç†ERROR 1712ï¼ˆå¾€æ•°æ®åº“é‡Œé¢æ’å…¥æ•°æ®æ—¶ï¼‰</h2><p><strong>é”™è¯¯æç¤ºï¼š</strong><br>ERROR 1712 (HY000): Index PRIMARY is corrupted<br><strong>è§£å†³æ–¹æ³•ï¼š</strong><br>ä½¿ç”¨mysqlçš„å‘½ä»¤ </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">repair table tableName; <span class="hljs-comment">#tableNameï¼šè¡¨å </span><br></code></pre></td></tr></table></figure><h2 id="ä¸ƒã€å½“å¾€æ•°æ®åº“é‡Œé¢æ’å…¥å­—æ®µä»¥åŠæ•°æ®æ—¶æŠ¥é”™"><a href="#ä¸ƒã€å½“å¾€æ•°æ®åº“é‡Œé¢æ’å…¥å­—æ®µä»¥åŠæ•°æ®æ—¶æŠ¥é”™" class="headerlink" title="ä¸ƒã€å½“å¾€æ•°æ®åº“é‡Œé¢æ’å…¥å­—æ®µä»¥åŠæ•°æ®æ—¶æŠ¥é”™"></a>ä¸ƒã€å½“å¾€æ•°æ®åº“é‡Œé¢æ’å…¥å­—æ®µä»¥åŠæ•°æ®æ—¶æŠ¥é”™</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ç™¾å¤šä¸‡çš„æ•°æ®é‡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿›è¡ŒåŠ å­—æ®µæ“ä½œï¼Œä½†æ˜¯å¾—çœ‹æœåŠ¡å™¨çš„è¿è¡Œæƒ…å†µï¼Œå¦‚æœæœ‰å¤§é‡æœåŠ¡å ç”¨å†…å­˜ï¼Œæ·»åŠ å­—æ®µå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚<br>ä¸ºäº†é¿å…å‡ºç°æ— æ³•æ’å…¥ç­‰æŠ¥é”™è¿™ç§é—®é¢˜ï¼Œè®°å½•ä¸€ä¸‹æ¯”è¾ƒå¦¥å¸–çš„åŠæ³•:</p><h3 id="1-åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ–°è¡¨ï¼Œå¤åˆ¶æ—§è¡¨çš„ç»“æ„"><a href="#1-åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ–°è¡¨ï¼Œå¤åˆ¶æ—§è¡¨çš„ç»“æ„" class="headerlink" title="1.åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ–°è¡¨ï¼Œå¤åˆ¶æ—§è¡¨çš„ç»“æ„"></a>1.åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ–°è¡¨ï¼Œå¤åˆ¶æ—§è¡¨çš„ç»“æ„</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">create table <span class="hljs-string">&#x27;tmp&#x27;</span> like <span class="hljs-string">&#x27;old_tables&#x27;</span> ;<br><span class="hljs-comment">#create table &#x27;tmp&#x27; like partybuilding.tmp; #å¤åˆ¶å…¶ä»–åº“çš„è¡¨ç»“æ„</span><br></code></pre></td></tr></table></figure><h3 id="2-ç»™æ–°è¡¨åŠ ä¸Šæ–°å¢çš„å­—æ®µ"><a href="#2-ç»™æ–°è¡¨åŠ ä¸Šæ–°å¢çš„å­—æ®µ" class="headerlink" title="2.ç»™æ–°è¡¨åŠ ä¸Šæ–°å¢çš„å­—æ®µ"></a>2.ç»™æ–°è¡¨åŠ ä¸Šæ–°å¢çš„å­—æ®µ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">ALTER TABLE `tmp`<br>ADD COLUMN `sync_key` varchar(255) NULL COMMENT <span class="hljs-string">&#x27;åŒæ­¥é”®&#x27;</span> ,<br>ADD COLUMN `data_from` varchar(255) NULL  COMMENT <span class="hljs-string">&#x27;æ•°æ®äº§ç”Ÿæ–¹&#x27;</span>,<br>ADD COLUMN `data_update` varchar(255) NULL COMMENT <span class="hljs-string">&#x27;æ•°æ®ä¿®æ”¹æ–¹&#x27;</span> ;<br></code></pre></td></tr></table></figure><h3 id="3-æŠŠæ—§è¡¨çš„æ•°æ®å¤åˆ¶è¿‡æ¥"><a href="#3-æŠŠæ—§è¡¨çš„æ•°æ®å¤åˆ¶è¿‡æ¥" class="headerlink" title="3.æŠŠæ—§è¡¨çš„æ•°æ®å¤åˆ¶è¿‡æ¥"></a>3.æŠŠæ—§è¡¨çš„æ•°æ®å¤åˆ¶è¿‡æ¥</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">insert into tmp (<span class="hljs-built_in">id</span>,name,unit) select <span class="hljs-built_in">id</span>,name,unit from old_table;<br><span class="hljs-comment">#æ³¨æ„ï¼Œæ˜¯æ‰€æœ‰çš„å­—æ®µ</span><br></code></pre></td></tr></table></figure><h3 id="4-é‡å‘½å"><a href="#4-é‡å‘½å" class="headerlink" title="4.é‡å‘½å"></a>4.é‡å‘½å</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">rename table old_tables to old_tables_bak ;<br>rename table tmp to old_tables;<br><span class="hljs-comment">#æ³¨æ„ï¼šéœ€è¦åœ¨mysqlæ²¡æœ‰ä½¿ç”¨çš„æ—¶å€™æ“ä½œï¼Œæˆ–è€…æ˜¯ä¸ä¼šåœ¨çŸ­æ—¶é—´å†…å˜æ›´çš„æ•°æ®</span><br></code></pre></td></tr></table></figure><h2 id="å…«ã€-MySQLé”™è¯¯â€œERROR-2006-ï¼ˆHY000ï¼‰ï¼šMySQL-server-has-gone-awayâ€"><a href="#å…«ã€-MySQLé”™è¯¯â€œERROR-2006-ï¼ˆHY000ï¼‰ï¼šMySQL-server-has-gone-awayâ€" class="headerlink" title="å…«ã€ MySQLé”™è¯¯â€œERROR 2006 ï¼ˆHY000ï¼‰ï¼šMySQL server has gone awayâ€"></a>å…«ã€ MySQLé”™è¯¯â€œERROR 2006 ï¼ˆHY000ï¼‰ï¼šMySQL server has gone awayâ€</h2><h3 id="1-MySQL-æœåŠ¡å™¨çœŸçš„ä¸è§äº†"><a href="#1-MySQL-æœåŠ¡å™¨çœŸçš„ä¸è§äº†" class="headerlink" title="1. MySQL æœåŠ¡å™¨çœŸçš„ä¸è§äº†"></a>1. MySQL æœåŠ¡å™¨çœŸçš„ä¸è§äº†</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥æœåŠ¡å™¨æ­£å¸¸è¿è¡Œæ—¶é—´ï¼ˆuptimeï¼‰å’ŒæœåŠ¡å™¨çš„é”™è¯¯æ—¥å¿—æ¥æ£€æŸ¥æ˜¯å¦æœåŠ¡å™¨ç¡®å®æ¶ˆå¤±äº†ã€‚<br>æŸ¥çœ‹MySQLçš„æ­£å¸¸è¿è¡Œæ—¶é—´ï¼ˆuptimeï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">show global status like <span class="hljs-string">&#x27;uptime&#x27;</span>; <br>æŸ¥è¯¢é”™è¯¯æ—¥å¿—çš„å­˜å‚¨ä½ç½®ï¼š<br>show variables like <span class="hljs-string">&#x27;%error&#x27;</span>; <br></code></pre></td></tr></table></figure><h3 id="2-è¿æ¥è¶…æ—¶"><a href="#2-è¿æ¥è¶…æ—¶" class="headerlink" title="2. è¿æ¥è¶…æ—¶"></a>2. è¿æ¥è¶…æ—¶</h3><p>æŸ¥çœ‹å„é¡¹è¿æ¥æ—¶é—´ï¼š<code>show global variables like &#39;%timeout&#39;;</code></p><h3 id="3-ä½ çš„SQLè¯­å¥è¢«æ€æ­»äº†"><a href="#3-ä½ çš„SQLè¯­å¥è¢«æ€æ­»äº†" class="headerlink" title="3. ä½ çš„SQLè¯­å¥è¢«æ€æ­»äº†"></a>3. ä½ çš„SQLè¯­å¥è¢«æ€æ­»äº†</h3><p>æœ‰äº›ç³»ç»Ÿä¼šä¸»åŠ¨æ€æ­»è¿è¡Œæ—¶é—´è¿‡é•¿çš„SQLè¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹å·²ç»æ‰§è¡Œçš„killè¯­å¥æ•°é‡æ¥æ£€æŸ¥æ˜¯å¦å¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µã€‚<br>æŸ¥çœ‹mysqlè¯·æ±‚è¿æ¥è¿›ç¨‹è¢«ä¸»åŠ¨æ€æ­»ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show global  status like <span class="hljs-string">&#x27;com_kill&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="4-ä½ çš„SQLè¯­å¥å¤ªå¤§äº†"><a href="#4-ä½ çš„SQLè¯­å¥å¤ªå¤§äº†" class="headerlink" title="4. ä½ çš„SQLè¯­å¥å¤ªå¤§äº†"></a>4. ä½ çš„SQLè¯­å¥å¤ªå¤§äº†</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">show global variables like <span class="hljs-string">&#x27;max_allowed_packet&#x27;</span>;<br><br>å¦‚æœå€¼æ¯”è¾ƒå°ï¼Œå¯ä»¥è®¾ç½®å¤§ä¸€ç‚¹ï¼š<br><span class="hljs-built_in">set</span> global max_allowed_packet=1024*1024*16<br></code></pre></td></tr></table></figure><h2 id="ä¹ã€-Mysqldumpå¯¼å‡ºçš„æ–‡ä»¶åªå¯¼å…¥ä¸€å¼ è¡¨"><a href="#ä¹ã€-Mysqldumpå¯¼å‡ºçš„æ–‡ä»¶åªå¯¼å…¥ä¸€å¼ è¡¨" class="headerlink" title="ä¹ã€ Mysqldumpå¯¼å‡ºçš„æ–‡ä»¶åªå¯¼å…¥ä¸€å¼ è¡¨"></a>ä¹ã€ Mysqldumpå¯¼å‡ºçš„æ–‡ä»¶åªå¯¼å…¥ä¸€å¼ è¡¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">grep -i <span class="hljs-string">&#x27;INSERT INTO `tab_pb_flow_out`&#x27;</span> partybuilding20220621.sql &gt; tab_pb_flow_out.sql &amp;<br><br>ç„¶åå†å¯¼å…¥è¯¥sqlæ–‡ä»¶<br>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¤åˆ¶æ•°æ®åº“è¡¨ç»“æ„ï¼š<br>create table <span class="hljs-string">&#x27;tmp&#x27;</span> like partybuilding.tmp;<br>å†è¿›è¡Œå¯¼å…¥<br></code></pre></td></tr></table></figure><h2 id="åã€-MySQLå®‰è£…æ§åˆ¶æ’ä»¶-Connection-Control-â€“å¯æœ‰æ•ˆçš„é˜²æ­¢å®¢æˆ·ç«¯æš´åŠ›ç™»å½•çš„é£é™©-æ”»å‡»"><a href="#åã€-MySQLå®‰è£…æ§åˆ¶æ’ä»¶-Connection-Control-â€“å¯æœ‰æ•ˆçš„é˜²æ­¢å®¢æˆ·ç«¯æš´åŠ›ç™»å½•çš„é£é™©-æ”»å‡»" class="headerlink" title="åã€ MySQLå®‰è£…æ§åˆ¶æ’ä»¶(Connection-Control)â€“å¯æœ‰æ•ˆçš„é˜²æ­¢å®¢æˆ·ç«¯æš´åŠ›ç™»å½•çš„é£é™©(æ”»å‡»)"></a>åã€ MySQLå®‰è£…æ§åˆ¶æ’ä»¶(Connection-Control)â€“å¯æœ‰æ•ˆçš„é˜²æ­¢å®¢æˆ·ç«¯æš´åŠ›ç™»å½•çš„é£é™©(æ”»å‡»)</h2><p>å®ç°æ–‡æ¡£ï¼š<code>https://blog.51cto.com/u_15069450/4331304</code></p><h2 id="åä¸€ã€-è¡¨åˆ†åŒºï¼Œ-åˆ†åŒºæ˜¯ä¸€ç§è¡¨çš„è®¾è®¡æ¨¡å¼ï¼Œæ­£ç¡®çš„åˆ†åŒºå¯ä»¥æå¤§åœ°æå‡æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆç‡ï¼Œå®Œæˆæ›´é«˜è´¨é‡çš„SQLç¼–ç¨‹ã€‚ä½†æ˜¯å¦‚æœé”™è¯¯åœ°ä½¿ç”¨åˆ†åŒºï¼Œé‚£ä¹ˆåˆ†åŒºå¯èƒ½å¸¦æ¥æ¯ç­æ€§çš„çš„ç»“æœã€‚"><a href="#åä¸€ã€-è¡¨åˆ†åŒºï¼Œ-åˆ†åŒºæ˜¯ä¸€ç§è¡¨çš„è®¾è®¡æ¨¡å¼ï¼Œæ­£ç¡®çš„åˆ†åŒºå¯ä»¥æå¤§åœ°æå‡æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆç‡ï¼Œå®Œæˆæ›´é«˜è´¨é‡çš„SQLç¼–ç¨‹ã€‚ä½†æ˜¯å¦‚æœé”™è¯¯åœ°ä½¿ç”¨åˆ†åŒºï¼Œé‚£ä¹ˆåˆ†åŒºå¯èƒ½å¸¦æ¥æ¯ç­æ€§çš„çš„ç»“æœã€‚" class="headerlink" title="åä¸€ã€ è¡¨åˆ†åŒºï¼Œ  åˆ†åŒºæ˜¯ä¸€ç§è¡¨çš„è®¾è®¡æ¨¡å¼ï¼Œæ­£ç¡®çš„åˆ†åŒºå¯ä»¥æå¤§åœ°æå‡æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆç‡ï¼Œå®Œæˆæ›´é«˜è´¨é‡çš„SQLç¼–ç¨‹ã€‚ä½†æ˜¯å¦‚æœé”™è¯¯åœ°ä½¿ç”¨åˆ†åŒºï¼Œé‚£ä¹ˆåˆ†åŒºå¯èƒ½å¸¦æ¥æ¯ç­æ€§çš„çš„ç»“æœã€‚"></a>åä¸€ã€ è¡¨åˆ†åŒºï¼Œ  åˆ†åŒºæ˜¯ä¸€ç§è¡¨çš„è®¾è®¡æ¨¡å¼ï¼Œæ­£ç¡®çš„åˆ†åŒºå¯ä»¥æå¤§åœ°æå‡æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆç‡ï¼Œå®Œæˆæ›´é«˜è´¨é‡çš„SQLç¼–ç¨‹ã€‚ä½†æ˜¯å¦‚æœé”™è¯¯åœ°ä½¿ç”¨åˆ†åŒºï¼Œé‚£ä¹ˆåˆ†åŒºå¯èƒ½å¸¦æ¥æ¯ç­æ€§çš„çš„ç»“æœã€‚</h2><p><strong>è¡¨åˆ†åŒºç®€ä»‹å‚è€ƒæ–‡æ¡£ï¼š</strong><br><a href="https://developer.aliyun.com/article/944253">https://developer.aliyun.com/article/944253</a></p><p><strong>æ“ä½œæ–‡æ¡£ï¼š</strong><br><a href="https://www.cnblogs.com/xibuhaohao/p/10154281.html#_label0_1">https://www.cnblogs.com/xibuhaohao/p/10154281.html#_label0_1</a><br><a href="https://www.cnblogs.com/dw3306/p/12620042.html">https://www.cnblogs.com/dw3306/p/12620042.html</a></p><p><strong>å·²æœ‰æ•°æ®ç»“æ„æ”¹åˆ†åŒºè¡¨ã€ç¬¬äºŒç§</strong><br>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://blog.csdn.net/orangleliu/article/details/57088338">https://blog.csdn.net/orangleliu/article/details/57088338</a></p><p><strong>è‡ªåŠ¨åˆ›å»ºåˆ†åŒºï¼š</strong><br>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://www.cnblogs.com/webenh/p/11667778.html">https://www.cnblogs.com/webenh/p/11667778.html</a></p><h2 id="åäºŒï¼š-mysqlè¡¨ä¼˜åŒ–æŒ‡å—"><a href="#åäºŒï¼š-mysqlè¡¨ä¼˜åŒ–æŒ‡å—" class="headerlink" title="åäºŒï¼š mysqlè¡¨ä¼˜åŒ–æŒ‡å—"></a>åäºŒï¼š mysqlè¡¨ä¼˜åŒ–æŒ‡å—</h2><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://z.itpub.net/article/detail/7EFE8159C8E5AF3C0AB2F77685A49977">https://z.itpub.net/article/detail/7EFE8159C8E5AF3C0AB2F77685A49977</a></p><h2 id="åä¸‰ï¼šæ•°æ®åº“å¯¼å…¥æŠ¥é”™-index-column-size-too-large-the-maximum-column-size-is-767-bytes"><a href="#åä¸‰ï¼šæ•°æ®åº“å¯¼å…¥æŠ¥é”™-index-column-size-too-large-the-maximum-column-size-is-767-bytes" class="headerlink" title="åä¸‰ï¼šæ•°æ®åº“å¯¼å…¥æŠ¥é”™:index column size too large. the maximum column size is 767 bytes"></a>åä¸‰ï¼šæ•°æ®åº“å¯¼å…¥æŠ¥é”™:index column size too large. the maximum column size is 767 bytes</h2><p><strong>åŸå› ï¼š</strong><br>INNODB å¼•æ“ï¼ŒUTF-8ï¼Œä¸»é”®å­—ç¬¦ä¸² é»˜è®¤æœ€å¤§ 767ï¼Œéœ€è¦ä¿®æ”¹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">&gt;mysql <span class="hljs-built_in">set</span> global innodb_file_format = BARRACUDA;<br>&gt;mysql <span class="hljs-built_in">set</span> global innodb_large_prefix = ON;<br><br>ç„¶åä¿®æ”¹å¯¼å…¥çš„sqlæ–‡ä»¶<br>sed -i<span class="hljs-string">&#x27;s/ENGINE=InnoDB/ROW_FORMAT=DYNAMIC &amp;/&#x27;</span> å¯¼å…¥çš„æ•°æ®.sqlæ–‡ä»¶<br></code></pre></td></tr></table></figure><h2 id="åå››ï¼šFatal-error-The-slave-I-x2F-O-thread-stops-because-master-and-slave-have-equal-MySQL-server-UUIDsï¼›"><a href="#åå››ï¼šFatal-error-The-slave-I-x2F-O-thread-stops-because-master-and-slave-have-equal-MySQL-server-UUIDsï¼›" class="headerlink" title="åå››ï¼šFatal error: The slave I&#x2F;O thread stops because master and slave have equal MySQL server UUIDsï¼›"></a>åå››ï¼šFatal error: The slave I&#x2F;O thread stops because master and slave have equal MySQL server UUIDsï¼›</h2><p>åŸå› ï¼šauto.cnfæ–‡ä»¶ä¸­UUIDä¸€è‡´å¯¼è‡´</p><p>è§£å†³ï¼šåˆ é™¤æ•°æ®ç›®å½•ä¸­çš„auto.cnfï¼Œå¯åŠ¨mysql</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">rm</span> -rf /var/lib/mysql/auto.cnf<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlåŸºç¡€è¯­å¥</title>
    <link href="/2023/05/15/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql%E5%9F%BA%E7%A1%80%E8%AF%AD%E5%8F%A5/"/>
    <url>/2023/05/15/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql%E5%9F%BA%E7%A1%80%E8%AF%AD%E5%8F%A5/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="mysqlåŸºç¡€è¯­å¥"><a href="#mysqlåŸºç¡€è¯­å¥" class="headerlink" title="mysqlåŸºç¡€è¯­å¥"></a>mysqlåŸºç¡€è¯­å¥</h1><h2 id="1-ç™»å½•"><a href="#1-ç™»å½•" class="headerlink" title="1.ç™»å½•"></a>1.ç™»å½•</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql  -uç”¨æˆ·å  -pç”¨æˆ·å¯†ç  -hä¸»æœºåœ°å€ -Pç«¯å£<br></code></pre></td></tr></table></figure><h2 id="2-æŸ¥çœ‹æ•°æ®åº“"><a href="#2-æŸ¥çœ‹æ•°æ®åº“" class="headerlink" title="2.æŸ¥çœ‹æ•°æ®åº“"></a>2.æŸ¥çœ‹æ•°æ®åº“</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show databases;<br></code></pre></td></tr></table></figure><h2 id="3-æŒ‰è¡ŒæŸ¥çœ‹æ•°æ®åº“"><a href="#3-æŒ‰è¡ŒæŸ¥çœ‹æ•°æ®åº“" class="headerlink" title="3.æŒ‰è¡ŒæŸ¥çœ‹æ•°æ®åº“"></a>3.æŒ‰è¡ŒæŸ¥çœ‹æ•°æ®åº“</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">show database \G<br><br>â€“e  åé¢æ¥SQLè¯­å¥ï¼Œå¯åœ¨å¤–éƒ¨æŸ¥è¯¢<br><span class="hljs-comment">#ä¾‹å¦‚:</span><br>mysql -uroot -p123456 -e <span class="hljs-string">&#x27;showdatabases&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="4-åˆ›å»ºæ•°æ®åº“"><a href="#4-åˆ›å»ºæ•°æ®åº“" class="headerlink" title="4.åˆ›å»ºæ•°æ®åº“"></a>4.åˆ›å»ºæ•°æ®åº“</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">create database æ•°æ®åº“åç§°;<br><br><span class="hljs-comment">#æ•°æ®åº“æ¥ç‰¹æ®Šç¬¦å·éœ€è¦åŠ ``:</span><br>create database `HA-<span class="hljs-built_in">test</span>` <br><br><span class="hljs-comment">#åˆ›å»ºç‰¹æ®Šä½å­—ç¬¦:</span><br>create database <span class="hljs-keyword">if</span> not exists test03 default character <span class="hljs-built_in">set</span> = <span class="hljs-string">&#x27;utf8&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="5-æ•°æ®åº“çš„å­˜æ”¾è·¯å¾„"><a href="#5-æ•°æ®åº“çš„å­˜æ”¾è·¯å¾„" class="headerlink" title="5.æ•°æ®åº“çš„å­˜æ”¾è·¯å¾„"></a>5.æ•°æ®åº“çš„å­˜æ”¾è·¯å¾„</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ls</span> /var/lib/mysql<br></code></pre></td></tr></table></figure><h2 id="6-æŸ¥è¯¢å½“å‰åœ¨æ“ä½œå“ªä¸ªåº“"><a href="#6-æŸ¥è¯¢å½“å‰åœ¨æ“ä½œå“ªä¸ªåº“" class="headerlink" title="6.æŸ¥è¯¢å½“å‰åœ¨æ“ä½œå“ªä¸ªåº“"></a>6.æŸ¥è¯¢å½“å‰åœ¨æ“ä½œå“ªä¸ªåº“</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">select database();<br></code></pre></td></tr></table></figure><h2 id="7-æŸ¥çœ‹å½“å‰çš„æ•°æ®åº“æ—¶é—´"><a href="#7-æŸ¥çœ‹å½“å‰çš„æ•°æ®åº“æ—¶é—´" class="headerlink" title="7.æŸ¥çœ‹å½“å‰çš„æ•°æ®åº“æ—¶é—´"></a>7.æŸ¥çœ‹å½“å‰çš„æ•°æ®åº“æ—¶é—´</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">select now();<br></code></pre></td></tr></table></figure><h2 id="8-æŸ¥çœ‹å½“å‰çš„æ“ä½œç”¨æˆ·"><a href="#8-æŸ¥çœ‹å½“å‰çš„æ“ä½œç”¨æˆ·" class="headerlink" title="8.æŸ¥çœ‹å½“å‰çš„æ“ä½œç”¨æˆ·"></a>8.æŸ¥çœ‹å½“å‰çš„æ“ä½œç”¨æˆ·</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">select user();<br></code></pre></td></tr></table></figure><h2 id="9-åˆ é™¤æ•°æ®åº“-ç‰¹æ®Šç¬¦å·éœ€è¦åŠ "><a href="#9-åˆ é™¤æ•°æ®åº“-ç‰¹æ®Šç¬¦å·éœ€è¦åŠ " class="headerlink" title="9.åˆ é™¤æ•°æ®åº“,ç‰¹æ®Šç¬¦å·éœ€è¦åŠ "></a>9.åˆ é™¤æ•°æ®åº“,ç‰¹æ®Šç¬¦å·éœ€è¦åŠ </h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">drop database æ•°æ®åº“åç§°;<br><br><span class="hljs-comment">#åˆ¤æ–­æ•°æ®åº“æ˜¯å¦å­˜åœ¨ï¼Œå¹¶åˆ é™¤æ•°æ®åº“if exists:å¦‚æœå­˜åœ¨</span><br>drop database <span class="hljs-keyword">if</span> exists æ•°æ®åº“åç§°;<br></code></pre></td></tr></table></figure><h2 id="10-æŸ¥çœ‹æ˜¯å¦å¼€å¯binlogæ—¥å¿—ï¼š"><a href="#10-æŸ¥çœ‹æ˜¯å¦å¼€å¯binlogæ—¥å¿—ï¼š" class="headerlink" title="10.æŸ¥çœ‹æ˜¯å¦å¼€å¯binlogæ—¥å¿—ï¼š"></a>10.æŸ¥çœ‹æ˜¯å¦å¼€å¯binlogæ—¥å¿—ï¼š</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">show variables like <span class="hljs-string">&#x27;%log_bin%&#x27;</span><br><span class="hljs-comment">#------------------------------------------------------------------</span><br>  log_bin                         | ON                             |<br>| log_bin_basename                | /var/lib/mysql/mysql-bin       |<br>| log_bin_index                   | /var/lib/mysql/mysql-bin.index<br><span class="hljs-comment">#-------------------------------------------------------------------</span><br></code></pre></td></tr></table></figure><h2 id="11-æ•°æ®åº“å¯¼å…¥è„šæœ¬"><a href="#11-æ•°æ®åº“å¯¼å…¥è„šæœ¬" class="headerlink" title="11.æ•°æ®åº“å¯¼å…¥è„šæœ¬"></a>11.æ•°æ®åº“å¯¼å…¥è„šæœ¬</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql -uroot -p<span class="hljs-string">&#x27;å¯†ç &#x27;</span> æ•°æ®åº“ &lt; a.sql<br><span class="hljs-comment">#ä¾‹å¦‚ï¼š</span><br>mysql -uroot -p<span class="hljs-string">&#x27;root@2021&#x27;</span>  <span class="hljs-built_in">test</span> &lt; a.sql<br><br><span class="hljs-comment">#æˆ–è€…è¿æ¥æ•°æ®åº“:</span><br>mysql -uroot -p<span class="hljs-string">&#x27;root@2021&#x27;</span><br><span class="hljs-comment">#é€‰æ‹©ç›¸åº”çš„æ•°æ®åº“åæ‰§è¡Œ</span><br>mysql&gt; <span class="hljs-built_in">source</span> è„šæœ¬æ‰€åœ¨çš„è·¯å¾„  <br><span class="hljs-comment">#ä¾‹å¦‚</span><br><span class="hljs-built_in">source</span> /app/a.sql<br></code></pre></td></tr></table></figure><h2 id="12-é‡ç½®bin-log"><a href="#12-é‡ç½®bin-log" class="headerlink" title="12.é‡ç½®bin_log"></a>12.é‡ç½®bin_log</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿æ¥æ•°æ®åº“å</span><br>reset master;<br></code></pre></td></tr></table></figure><h2 id="13-å¯¼å‡ºæ•°æ®åº“"><a href="#13-å¯¼å‡ºæ•°æ®åº“" class="headerlink" title="13.å¯¼å‡ºæ•°æ®åº“"></a>13.å¯¼å‡ºæ•°æ®åº“</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysqldump -uroot -p<span class="hljs-string">&#x27;&#x27;</span> æ•°æ®åº“ &gt; a.sql<br><br><span class="hljs-comment">#å½“å‰GTID_EXECUTEDå‚æ•°å·²ç»æœ‰å€¼ï¼Œè€Œä»é›†ç¾¤å€’å‡ºæ¥çš„dumpæ–‡ä»¶ä¸­åŒ…å«äº†SET @@GLOBAL.GTID_PURGEDçš„æ“ä½œ</span><br><span class="hljs-comment">#dumpå¯¼å‡ºæ—¶ï¼Œæ·»åŠ --set-gtid-purged=offå‚æ•°ï¼Œé¿å…å°†gtidä¿¡æ¯å¯¼å‡º</span><br>mysqldump -uroot -p --set-gtid-purged=off -d sso &gt; sso1.sql<br></code></pre></td></tr></table></figure><h2 id="14-å¯¼å…¥æ•°æ®åº“"><a href="#14-å¯¼å…¥æ•°æ®åº“" class="headerlink" title="14.å¯¼å…¥æ•°æ®åº“"></a>14.å¯¼å…¥æ•°æ®åº“</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql -uroot -p<span class="hljs-string">&#x27;&#x27;</span> æ•°æ®åº“ &lt; a.sql<br></code></pre></td></tr></table></figure><h2 id="15-å¯¼å‡ºæ•°æ®åº“è¡¨"><a href="#15-å¯¼å‡ºæ•°æ®åº“è¡¨" class="headerlink" title="15.å¯¼å‡ºæ•°æ®åº“è¡¨"></a>15.å¯¼å‡ºæ•°æ®åº“è¡¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysqldump -uroot -p<span class="hljs-string">&#x27;&#x27;</span> æ•°æ®åº“ è¡¨å &gt; a.sql<br></code></pre></td></tr></table></figure><h2 id="16-å¯¼å‡ºæ•°æ®åº“æŸä¸€å¼ è¡¨çš„ç›¸å…³æ•°æ®"><a href="#16-å¯¼å‡ºæ•°æ®åº“æŸä¸€å¼ è¡¨çš„ç›¸å…³æ•°æ®" class="headerlink" title="16.å¯¼å‡ºæ•°æ®åº“æŸä¸€å¼ è¡¨çš„ç›¸å…³æ•°æ®"></a>16.å¯¼å‡ºæ•°æ®åº“æŸä¸€å¼ è¡¨çš„ç›¸å…³æ•°æ®</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysqldump -h172.26.0.11 -uroot -p<span class="hljs-string">&#x27;##&#x27;</span> fpmparty tab_pb_flow_in &gt; tab_pb_flow_in.sql<br><span class="hljs-comment">#fpmparty æ•°æ®åº“å</span><br><span class="hljs-comment">#tab_pd_flow_in è¡¨å</span><br></code></pre></td></tr></table></figure><h2 id="17-mysqlå¯¼å‡ºæŸ¥è¯¢çš„å†…å®¹"><a href="#17-mysqlå¯¼å‡ºæŸ¥è¯¢çš„å†…å®¹" class="headerlink" title="17.mysqlå¯¼å‡ºæŸ¥è¯¢çš„å†…å®¹"></a>17.mysqlå¯¼å‡ºæŸ¥è¯¢çš„å†…å®¹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql --default-character-set=utf8 -uroot -p<span class="hljs-string">&#x27;xQ*SFR1q2w3e4r&#x27;</span>  -Dpartybuilding  -e <span class="hljs-string">&quot;SELECT * FROM sys_dept ORDER BY create_time desc limit 10;&quot;</span> &gt; ./mysql.xls<br><br><span class="hljs-comment">#å‚æ•°è¯´æ˜</span><br>--default-character-set=utf8 å­—ç¬¦é›†è®¾ä¸ºutf-8ï¼Œé˜²æ­¢è¾“å‡ºä¸­æ–‡ä¹±ç <br><span class="hljs-comment">#å¦‚æœåŠ ä¸Š -N åˆ™ä¸è¾“å‡ºè¡¨å¤´ï¼Œåªä¿å­˜æ•°æ®ã€‚</span><br></code></pre></td></tr></table></figure><h2 id="18-mysqlèµ‹æƒ"><a href="#18-mysqlèµ‹æƒ" class="headerlink" title="18.mysqlèµ‹æƒ"></a>18.mysqlèµ‹æƒ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ‰€æœ‰çš„æœºå™¨éƒ½å¯ä»¥è¿æ¥æ‰€æœ‰çš„æ•°æ®åº“</span><br>&gt; grant all on *.* to root@<span class="hljs-string">&quot;%&quot;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>  <span class="hljs-comment">#123456æ˜¯å¯†ç </span><br><br>&gt; grant all on *.* to root@<span class="hljs-string">&#x27;%&#x27;</span> identified by <span class="hljs-string">&#x27;yizheng2017&#x27;</span> with grant option; <span class="hljs-comment">#å…è®¸çº§è”èµ‹æƒã€ä½œç”¨æ˜¯ä½¿å¾—è¯¥ç”¨æˆ·å¯ä»¥æ‹¥æœ‰æƒé™å’Œå›æ”¶æƒé™ç»™å…¶ä»–ç”¨æˆ·ã€‚</span><br></code></pre></td></tr></table></figure><h2 id="19-æŸ¥çœ‹MYSQLæ•°æ®åº“ä¸­æ‰€æœ‰ç”¨æˆ·"><a href="#19-æŸ¥çœ‹MYSQLæ•°æ®åº“ä¸­æ‰€æœ‰ç”¨æˆ·" class="headerlink" title="19.æŸ¥çœ‹MYSQLæ•°æ®åº“ä¸­æ‰€æœ‰ç”¨æˆ·"></a>19.æŸ¥çœ‹MYSQLæ•°æ®åº“ä¸­æ‰€æœ‰ç”¨æˆ·</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">SELECT DISTINCT CONCAT(<span class="hljs-string">&#x27;User: &#x27;</span><span class="hljs-string">&#x27;&#x27;</span>,user,<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;@&#x27;</span><span class="hljs-string">&#x27;&#x27;</span>,host,<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;;&#x27;</span>) AS query FROM mysql.user;<br></code></pre></td></tr></table></figure><h2 id="20-åˆ›å»ºç”¨æˆ·"><a href="#20-åˆ›å»ºç”¨æˆ·" class="headerlink" title="20.åˆ›å»ºç”¨æˆ·"></a>20.åˆ›å»ºç”¨æˆ·</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql&gt; create user <span class="hljs-string">&quot;haidon&quot;</span> identified by <span class="hljs-string">&quot;123456&quot;</span>;       -- æ­¤æ—¶å¯†ç ä¸º123456ï¼Œhostå€¼ä¸º%ã€‚<br>mysql&gt; create user <span class="hljs-string">&quot;haidon&quot;</span>@<span class="hljs-string">&quot;%&quot;</span> identified by <span class="hljs-string">&quot;123456&quot;</span>;   -- æ­¤æ—¶å¯†ç ä¸º123456<br></code></pre></td></tr></table></figure><h2 id="21-æŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„æƒé™"><a href="#21-æŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„æƒé™" class="headerlink" title="21.æŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„æƒé™"></a>21.æŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„æƒé™</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">&gt; SHOW GRANGTS FOR userA;<br></code></pre></td></tr></table></figure><h2 id="22-èµ‹äºˆæŸä¸ªç”¨æˆ·çš„æƒé™"><a href="#22-èµ‹äºˆæŸä¸ªç”¨æˆ·çš„æƒé™" class="headerlink" title="22.èµ‹äºˆæŸä¸ªç”¨æˆ·çš„æƒé™"></a>22.èµ‹äºˆæŸä¸ªç”¨æˆ·çš„æƒé™</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ç»™useAèµ‹äºˆdb1çš„æ‰€æœ‰æƒé™ï¼Œå¹¶å…è®¸å…¨ç½‘æ®µè¿œç¨‹ç™»å½•</span><br>&gt; GRANT ALL PRIVILEGES ON `db1`.* TO <span class="hljs-string">&#x27;userA&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;123456&#x27;</span> WITH GRANT OPTION;<br><br><span class="hljs-comment">#æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹ipæ®µè¿›è¡Œæˆæƒï¼Œå¦‚ &#x27;userA&#x27;@&#x27;%&#x27;æ˜¯å¯¹å…¨ç½‘æ®µï¼Œ&#x27;userA&#x27;@&#x27;10.%.%.%&#x27;æ˜¯å¯¹éƒ¨åˆ†ç½‘æ®µè¿›è¡Œæˆæƒ</span><br><br><span class="hljs-comment">#ä¾‹å¦‚ï¼šå¯¹dyjysyncç”¨æˆ·æˆäºˆpartybuilding_syncæ•°æ®åº“çš„æŸ¥è¯¢æƒé™</span><br>grant select on `partybuilding_sync`.* to <span class="hljs-string">&#x27;dyjysync&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified by <span class="hljs-string">&#x27;dyjysync_2022&#x27;</span>;<br><br><span class="hljs-comment">#å…è®¸è®¿é—®æ‰€æœ‰æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨</span><br>mysql&gt; grant all privileges on *.* to <span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="hljs-string">&#x27;æŒ‡å®šip&#x27;</span> identified by <span class="hljs-string">&#x27;ç”¨æˆ·å¯†ç &#x27;</span> ;<br><br><span class="hljs-comment">#å…è®¸è®¿é—®æŒ‡å®šæ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨</span><br>mysql&gt; grant all privileges on <span class="hljs-built_in">test</span>.* to <span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="hljs-string">&#x27;æŒ‡å®šip&#x27;</span> identified by <span class="hljs-string">&#x27;ç”¨æˆ·å¯†ç &#x27;</span> ;<br><br><span class="hljs-comment">#å…è®¸è®¿é—®æŒ‡å®šæ•°æ®åº“ä¸‹çš„æŒ‡å®šè¡¨</span><br>mysql&gt; grant all privileges on test.test to <span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="hljs-string">&#x27;æŒ‡å®šip&#x27;</span> identified by <span class="hljs-string">&#x27;ç”¨æˆ·å¯†ç &#x27;</span> ;<br><br><br><span class="hljs-comment">#å›æ”¶/åˆ é™¤æƒé™ revoke</span><br>&gt; REVOKE ALL PRIVILEGES ON `db1`.* FROM <span class="hljs-string">&#x27;userA&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="23-æŸ¥çœ‹çº¿ç¨‹"><a href="#23-æŸ¥çœ‹çº¿ç¨‹" class="headerlink" title="23.æŸ¥çœ‹çº¿ç¨‹"></a>23.æŸ¥çœ‹çº¿ç¨‹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">show processlist<br></code></pre></td></tr></table></figure><h2 id="24-æ ¹æ®å®¢æˆ·ipåˆ†ç»„ï¼ŒæŸ¥çœ‹å“ªä¸ªå®¢æˆ·ç«¯çš„é“¾æ¥æ•°é‡æœ€å¤š"><a href="#24-æ ¹æ®å®¢æˆ·ipåˆ†ç»„ï¼ŒæŸ¥çœ‹å“ªä¸ªå®¢æˆ·ç«¯çš„é“¾æ¥æ•°é‡æœ€å¤š" class="headerlink" title="24.æ ¹æ®å®¢æˆ·ipåˆ†ç»„ï¼ŒæŸ¥çœ‹å“ªä¸ªå®¢æˆ·ç«¯çš„é“¾æ¥æ•°é‡æœ€å¤š"></a>24.æ ¹æ®å®¢æˆ·ipåˆ†ç»„ï¼ŒæŸ¥çœ‹å“ªä¸ªå®¢æˆ·ç«¯çš„é“¾æ¥æ•°é‡æœ€å¤š</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">select client_ip,count(client_ip) as client_num from (select substring_index(host,<span class="hljs-string">&#x27;:&#x27;</span> ,1) as client_ip from information_schema.processlist ) as connect_info group by client_ip order by client_num desc;<br></code></pre></td></tr></table></figure><h2 id="25-æŸ¥çœ‹æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¹¶æŒ‰-Time-å€’æ’åºï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ‰§è¡Œæ—¶é—´ç‰¹åˆ«é•¿çš„çº¿ç¨‹"><a href="#25-æŸ¥çœ‹æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¹¶æŒ‰-Time-å€’æ’åºï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ‰§è¡Œæ—¶é—´ç‰¹åˆ«é•¿çš„çº¿ç¨‹" class="headerlink" title="25.æŸ¥çœ‹æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¹¶æŒ‰ Time å€’æ’åºï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ‰§è¡Œæ—¶é—´ç‰¹åˆ«é•¿çš„çº¿ç¨‹"></a>25.æŸ¥çœ‹æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¹¶æŒ‰ Time å€’æ’åºï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ‰§è¡Œæ—¶é—´ç‰¹åˆ«é•¿çš„çº¿ç¨‹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">select * from information_schema.processlist <span class="hljs-built_in">where</span> Command != <span class="hljs-string">&#x27;Sleep&#x27;</span> order by Time desc;<br></code></pre></td></tr></table></figure><h2 id="26-æ‰¾å‡ºæ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡-5-åˆ†é’Ÿçš„çº¿ç¨‹ï¼Œæ‹¼å‡‘å‡º-kill-è¯­å¥ï¼Œæ–¹ä¾¿åé¢æŸ¥æ€-ï¼ˆæ­¤å¤„-60ç§’-å¯æ ¹æ®è‡ªå·±çš„éœ€è¦è°ƒæ•´SQLï¼‰å¯å¤åˆ¶æŸ¥è¯¢ç»“æœåˆ°æ§åˆ¶å°ï¼Œç›´æ¥æ‰§è¡Œï¼Œæ€æ­»å µå¡è¿›ç¨‹"><a href="#26-æ‰¾å‡ºæ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡-5-åˆ†é’Ÿçš„çº¿ç¨‹ï¼Œæ‹¼å‡‘å‡º-kill-è¯­å¥ï¼Œæ–¹ä¾¿åé¢æŸ¥æ€-ï¼ˆæ­¤å¤„-60ç§’-å¯æ ¹æ®è‡ªå·±çš„éœ€è¦è°ƒæ•´SQLï¼‰å¯å¤åˆ¶æŸ¥è¯¢ç»“æœåˆ°æ§åˆ¶å°ï¼Œç›´æ¥æ‰§è¡Œï¼Œæ€æ­»å µå¡è¿›ç¨‹" class="headerlink" title="26.æ‰¾å‡ºæ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡ 5 åˆ†é’Ÿçš„çº¿ç¨‹ï¼Œæ‹¼å‡‘å‡º kill è¯­å¥ï¼Œæ–¹ä¾¿åé¢æŸ¥æ€ ï¼ˆæ­¤å¤„ 60ç§’ å¯æ ¹æ®è‡ªå·±çš„éœ€è¦è°ƒæ•´SQLï¼‰å¯å¤åˆ¶æŸ¥è¯¢ç»“æœåˆ°æ§åˆ¶å°ï¼Œç›´æ¥æ‰§è¡Œï¼Œæ€æ­»å µå¡è¿›ç¨‹"></a>26.æ‰¾å‡ºæ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡ 5 åˆ†é’Ÿçš„çº¿ç¨‹ï¼Œæ‹¼å‡‘å‡º kill è¯­å¥ï¼Œæ–¹ä¾¿åé¢æŸ¥æ€ ï¼ˆæ­¤å¤„ 60ç§’ å¯æ ¹æ®è‡ªå·±çš„éœ€è¦è°ƒæ•´SQLï¼‰å¯å¤åˆ¶æŸ¥è¯¢ç»“æœåˆ°æ§åˆ¶å°ï¼Œç›´æ¥æ‰§è¡Œï¼Œæ€æ­»å µå¡è¿›ç¨‹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">select concat(<span class="hljs-string">&#x27;kill &#x27;</span>, <span class="hljs-built_in">id</span>, <span class="hljs-string">&#x27;;&#x27;</span>) from information_schema.processlist <span class="hljs-built_in">where</span> Command != <span class="hljs-string">&#x27;Sleep&#x27;</span> and Time &gt; 60 order by Time desc;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>K8S-yamlæ–‡ä»¶ç¼–å†™è¯¦è§£</title>
    <link href="/2023/05/11/k8s/k8s%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/k8s%20yaml%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99%E8%AF%A6%E8%A7%A3/"/>
    <url>/2023/05/11/k8s/k8s%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/k8s%20yaml%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="K8S-yamlæ–‡ä»¶ç¼–å†™è¯¦è§£"><a href="#K8S-yamlæ–‡ä»¶ç¼–å†™è¯¦è§£" class="headerlink" title="K8S-yamlæ–‡ä»¶ç¼–å†™è¯¦è§£"></a>K8S-yamlæ–‡ä»¶ç¼–å†™è¯¦è§£</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/lgeng/p/11053063.html<br>å‚è€ƒæ–‡æ¡£ï¼šhttps://www.kubernetes.org.cn/1414.html<br>å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/shunzi115/p/12392784.html<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€å‰è¨€ï¼šK8S-åˆ›å»ºèµ„æºçš„æ–¹å¼"><a href="#ä¸€ã€å‰è¨€ï¼šK8S-åˆ›å»ºèµ„æºçš„æ–¹å¼" class="headerlink" title="ä¸€ã€å‰è¨€ï¼šK8S åˆ›å»ºèµ„æºçš„æ–¹å¼"></a>ä¸€ã€å‰è¨€ï¼šK8S åˆ›å»ºèµ„æºçš„æ–¹å¼</h2><p>K8Sæœ‰ä¸¤ç§åˆ›å»ºèµ„æºçš„æ–¹å¼ï¼š<code>kubectl</code>å‘½ä»¤å’Œ<code>yaml</code>é…ç½®æ–‡ä»¶ã€‚</p><p>kubectlå‘½ä»¤è¡Œï¼šæœ€ä¸ºç®€å•ï¼Œä¸€æ¡å‘½ä»¤å°±OK.<br>yamlé…ç½®æ–‡ä»¶ï¼šæä¾›äº†ä¸€ç§è®©ä½ çŸ¥å…¶ç„¶æ›´çŸ¥å…¶æ‰€ä»¥ç„¶çš„æ–¹å¼ã€‚ä¼˜åŠ¿å¦‚ä¸‹ï¼š</p><ul><li>å®Œæ•´æ€§ï¼šé…ç½®æ–‡ä»¶æè¿°äº†ä¸€ä¸ªèµ„æºçš„å®Œæ•´çŠ¶æ€ï¼Œå¯ä»¥å¾ˆæ¸…æ¥šåœ°çŸ¥é“ä¸€ä¸ªèµ„æºçš„åˆ›å»ºèƒŒåç©¶ç«Ÿåšäº†å“ªäº›äº‹ï¼›</li><li>çµæ´»æ€§ï¼šé…ç½®æ–‡ä»¶å¯ä»¥åˆ›å»ºæ¯”å‘½ä»¤è¡Œæ›´å¤æ‚çš„ç»“æ„ï¼›</li><li>å¯ç»´æŠ¤æ€§ï¼šé…ç½®æ–‡ä»¶æä¾›äº†åˆ›å»ºèµ„æºå¯¹è±¡çš„æ¨¡æ¿ï¼Œèƒ½å¤Ÿé‡å¤ä½¿ç”¨ï¼›</li><li>å¯æ‰©å±•æ€§ï¼šé€‚åˆè·¨ç¯å¢ƒã€è§„æ¨¡åŒ–çš„éƒ¨ç½²ã€‚</li></ul><h2 id="äºŒã€yamlåŸºç¡€"><a href="#äºŒã€yamlåŸºç¡€" class="headerlink" title="äºŒã€yamlåŸºç¡€"></a>äºŒã€yamlåŸºç¡€</h2><p><code>yaml</code>æ˜¯ä¸€ç§ç”¨æ¥å†™é…ç½®æ–‡ä»¶çš„è¯­è¨€ï¼Œyaml åˆè¢«ç§°ä¸ºæ˜¯json çš„è¶…é›†ï¼Œä½¿ç”¨èµ·æ¥æ¯” json æ›´æ–¹ä¾¿ã€‚<br>ç»“æ„ä¸Šå®ƒæœ‰ä¸¤ç§å¯é€‰çš„ç±»å‹ï¼šLists å’Œ Mapsã€‚List ç”¨ -ï¼ˆç ´æŠ˜å·ï¼‰ æ¥å®šä¹‰æ¯ä¸€é¡¹ï¼ŒMap åˆ™æ˜¯ä¸€ä¸ª key:value çš„é”®å€¼å¯¹æ¥è¡¨ç¤ºã€‚</p><p>YAMLè¯­æ³•è§„åˆ™ï¼š</p><ul><li>å¤§å°å†™æ•æ„Ÿ</li><li>ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</li><li>ç¼©è¿›æ—¶ä¸å…è®¸ä½¿ç”¨Talé”®ï¼Œåªå…è®¸ä½¿ç”¨ç©ºæ ¼</li><li>ç¼©è¿›çš„ç©ºæ ¼æ•°ç›®ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦ä¾§å¯¹é½å³å¯</li><li>â€œ#â€è¡¨ç¤ºæ³¨é‡Šï¼Œä»è¿™ä¸ªå­—ç¬¦ä¸€ç›´åˆ°è¡Œå°¾ï¼Œéƒ½ä¼šè¢«è§£æå™¨å¿½ç•¥ã€€</li><li>â€œâ€”â€œâ€ ä¸ºå¯é€‰çš„åˆ†éš”ç¬¦</li></ul><p>ã€€</p><p>åœ¨Kubernetesä¸­ï¼Œåªéœ€è¦çŸ¥é“<code>Lists</code>å’Œ<code>Maps</code>ç»“æ„ç±»å‹å³å¯ï¼š</p><h2 id="ä¸‰ã€kubernetes-yaml-æ–‡ä»¶æ¨¡æ¿ï¼š"><a href="#ä¸‰ã€kubernetes-yaml-æ–‡ä»¶æ¨¡æ¿ï¼š" class="headerlink" title="ä¸‰ã€kubernetes yaml æ–‡ä»¶æ¨¡æ¿ï¼š"></a>ä¸‰ã€kubernetes yaml æ–‡ä»¶æ¨¡æ¿ï¼š</h2><p>yamlæ ¼å¼çš„podå®šä¹‰æ–‡ä»¶å®Œæ•´å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>       <span class="hljs-comment">#å¿…é€‰ï¼Œç‰ˆæœ¬å·ï¼Œä¾‹å¦‚v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span>            <span class="hljs-comment">#å¿…é€‰ï¼ŒPod</span><br><span class="hljs-attr">metadata:</span>            <span class="hljs-comment">#å¿…é€‰ï¼Œå…ƒæ•°æ®</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>       <span class="hljs-comment">#å¿…é€‰ï¼ŒPodåç§°</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">string</span>  <span class="hljs-comment">#å¿…é€‰ï¼ŒPodæ‰€å±çš„å‘½åç©ºé—´</span><br>  <span class="hljs-attr">labels:</span>            <span class="hljs-comment">#è‡ªå®šä¹‰æ ‡ç­¾</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>   <span class="hljs-comment">#è‡ªå®šä¹‰æ ‡ç­¾åå­—</span><br>  <span class="hljs-attr">annotations:</span>       <span class="hljs-comment">#è‡ªå®šä¹‰æ³¨é‡Šåˆ—è¡¨</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br><span class="hljs-attr">spec:</span>                <span class="hljs-comment">#å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span><br>  <span class="hljs-attr">containers:</span>        <span class="hljs-comment">#å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#å¿…é€‰ï¼Œå®¹å™¨åç§°</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">string</span>    <span class="hljs-comment">#å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§°</span><br>    <span class="hljs-attr">imagePullPolicy:</span> [<span class="hljs-string">Always</span> <span class="hljs-string">|</span> <span class="hljs-string">Never</span> <span class="hljs-string">|</span> <span class="hljs-string">IfNotPresent</span>] <span class="hljs-comment">#è·å–é•œåƒçš„ç­–ç•¥ Alawysè¡¨ç¤ºä¸‹è½½é•œåƒ IfnotPresentè¡¨ç¤ºä¼˜å…ˆä½¿ç”¨æœ¬åœ°é•œåƒï¼Œå¦åˆ™ä¸‹è½½é•œåƒï¼ŒNerverè¡¨ç¤ºä»…ä½¿ç”¨æœ¬åœ°é•œåƒ</span><br>    <span class="hljs-attr">command:</span> [<span class="hljs-string">string</span>]    <span class="hljs-comment">#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span><br>    <span class="hljs-attr">args:</span> [<span class="hljs-string">string</span>]       <span class="hljs-comment">#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨</span><br>    <span class="hljs-attr">workingDir:</span> <span class="hljs-string">string</span>   <span class="hljs-comment">#å®¹å™¨çš„å·¥ä½œç›®å½•</span><br>    <span class="hljs-attr">volumeMounts:</span>        <span class="hljs-comment">#æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>       <span class="hljs-comment">#å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å</span><br>      <span class="hljs-attr">mountPath:</span> <span class="hljs-string">string</span>    <span class="hljs-comment">#å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦</span><br>      <span class="hljs-attr">readOnly:</span> <span class="hljs-string">boolean</span>    <span class="hljs-comment">#æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼</span><br>    <span class="hljs-attr">ports:</span>                 <span class="hljs-comment">#éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>         <span class="hljs-comment">#ç«¯å£å·åç§°</span><br>      <span class="hljs-attr">containerPort:</span> <span class="hljs-string">int</span>   <span class="hljs-comment">#å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·</span><br>      <span class="hljs-attr">hostPort:</span> <span class="hljs-string">int</span>        <span class="hljs-comment">#å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ</span><br>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP</span><br>    <span class="hljs-attr">env:</span>                   <span class="hljs-comment">#å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>         <span class="hljs-comment">#ç¯å¢ƒå˜é‡åç§°</span><br>      <span class="hljs-attr">value:</span> <span class="hljs-string">string</span>        <span class="hljs-comment">#ç¯å¢ƒå˜é‡çš„å€¼</span><br>    <span class="hljs-attr">resources:</span>             <span class="hljs-comment">#èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®</span><br>      <span class="hljs-attr">limits:</span>              <span class="hljs-comment">#èµ„æºé™åˆ¶çš„è®¾ç½®</span><br>        <span class="hljs-attr">cpu:</span> <span class="hljs-string">string</span>        <span class="hljs-comment">#Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•°</span><br>        <span class="hljs-attr">memory:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•°</span><br>      <span class="hljs-attr">requests:</span>            <span class="hljs-comment">#èµ„æºè¯·æ±‚çš„è®¾ç½®</span><br>        <span class="hljs-attr">cpu:</span> <span class="hljs-string">string</span>        <span class="hljs-comment">#Cpuè¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span><br>        <span class="hljs-attr">memory:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#å†…å­˜æ¸…æ¥šï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span><br>    <span class="hljs-attr">livenessProbe:</span>         <span class="hljs-comment">#å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ï¼Œæ£€æŸ¥æ–¹æ³•æœ‰execã€httpGetå’ŒtcpSocketï¼Œå¯¹ä¸€ä¸ªå®¹å™¨åªéœ€è®¾ç½®å…¶ä¸­ä¸€ç§æ–¹æ³•å³å¯</span><br>      <span class="hljs-attr">exec:</span>                <span class="hljs-comment">#å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">string</span>]  <span class="hljs-comment">#execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬</span><br>      <span class="hljs-attr">httpGet:</span>             <span class="hljs-comment">#å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGetï¼Œéœ€è¦åˆ¶å®šPathã€port</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-string">number</span><br>        <span class="hljs-attr">host:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">scheme:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">HttpHeaders:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">value:</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">tcpSocket:</span>               <span class="hljs-comment">#å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼</span><br>         <span class="hljs-attr">port:</span> <span class="hljs-string">number</span><br>       <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">0</span>  <span class="hljs-comment">#å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span><br>       <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">0</span>       <span class="hljs-comment">#å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤1ç§’</span><br>       <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">0</span>        <span class="hljs-comment">#å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’ä¸€æ¬¡</span><br>       <span class="hljs-attr">successThreshold:</span> <span class="hljs-number">0</span><br>       <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">0</span><br>       <span class="hljs-attr">securityContext:</span><br>         <span class="hljs-string">privileged:false</span><br>    <span class="hljs-attr">restartPolicy:</span> [<span class="hljs-string">Always</span> <span class="hljs-string">|</span> <span class="hljs-string">Never</span> <span class="hljs-string">|</span> <span class="hljs-string">OnFailure</span>]     <span class="hljs-comment">#Podçš„é‡å¯ç­–ç•¥ï¼ŒAlwaysè¡¨ç¤ºä¸€æ—¦ä¸ç®¡ä»¥ä½•ç§æ–¹å¼ç»ˆæ­¢è¿è¡Œï¼Œkubeletéƒ½å°†é‡å¯ï¼ŒOnFailureè¡¨ç¤ºåªæœ‰Podä»¥é0é€€å‡ºç é€€å‡ºæ‰é‡å¯ï¼ŒNerverè¡¨ç¤ºä¸å†é‡å¯è¯¥Pod</span><br>    <span class="hljs-attr">nodeSelector:</span> <span class="hljs-string">obeject</span>  <span class="hljs-comment">#è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Šï¼Œä»¥keyï¼švalueçš„æ ¼å¼æŒ‡å®š</span><br>    <span class="hljs-attr">imagePullSecrets:</span>      <span class="hljs-comment">#Pullé•œåƒæ—¶ä½¿ç”¨çš„secretåç§°ï¼Œä»¥keyï¼šsecretkeyæ ¼å¼æŒ‡å®š</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>    <span class="hljs-string">hostNetwork:false</span>      <span class="hljs-comment">#æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span><br>    <span class="hljs-attr">volumes:</span>               <span class="hljs-comment">#åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>         <span class="hljs-comment">#å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰</span><br>      <span class="hljs-attr">emptyDir:</span> &#123;&#125;         <span class="hljs-comment">#ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼</span><br>      <span class="hljs-attr">hostPath:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">string</span>       <span class="hljs-comment">#Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•</span><br>      <span class="hljs-attr">secret:</span>              <span class="hljs-comment">#ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secreå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span><br>        <span class="hljs-attr">scretname:</span> <span class="hljs-string">string</span>  <br>        <span class="hljs-attr">items:</span>     <br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">path:</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">configMap:</span>           <span class="hljs-comment">#ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">items:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">string</span><br></code></pre></td></tr></table></figure><h2 id="å››ã€å®ä¾‹æ–‡ä»¶"><a href="#å››ã€å®ä¾‹æ–‡ä»¶" class="headerlink" title="å››ã€å®ä¾‹æ–‡ä»¶"></a>å››ã€å®ä¾‹æ–‡ä»¶</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">extensions/v1beta1</span>   <span class="hljs-comment">#æ¥å£ç‰ˆæœ¬</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>                 <span class="hljs-comment">#æ¥å£ç±»å‹</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ptengine-demo</span>               <span class="hljs-comment">#Deploymentåç§°</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">ptengine-prd</span>           <span class="hljs-comment">#namespace åç§°</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">ptengine-demo</span>              <span class="hljs-comment">#æ ‡ç­¾</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span><br>   <span class="hljs-attr">strategy:</span><br>    <span class="hljs-attr">rollingUpdate:</span>        <span class="hljs-comment">#ç”±äºreplicasä¸º3,åˆ™æ•´ä¸ªå‡çº§,podä¸ªæ•°åœ¨2-4ä¸ªä¹‹é—´</span><br>      <span class="hljs-attr">maxSurge:</span> <span class="hljs-number">1</span>         <span class="hljs-comment">#æ»šåŠ¨å‡çº§æ—¶ä¼šå…ˆå¯åŠ¨1ä¸ªpod</span><br>      <span class="hljs-attr">maxUnavailable:</span> <span class="hljs-number">1</span>   <span class="hljs-comment">#æ»šåŠ¨å‡çº§æ—¶å…è®¸çš„æœ€å¤§Unavailableçš„podä¸ªæ•°</span><br>  <span class="hljs-attr">template:</span>         <br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">ptengine-demo</span>  <span class="hljs-comment">#æ¨¡æ¿åç§°å¿…å¡«</span><br>    <span class="hljs-attr">sepc:</span>                   <span class="hljs-comment">#å®šä¹‰å®¹å™¨æ¨¡æ¿ï¼Œè¯¥æ¨¡æ¿å¯ä»¥åŒ…å«å¤šä¸ªå®¹å™¨</span><br>      <span class="hljs-attr">containers:</span>                                                                   <br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ptengine-demo</span>                                              <span class="hljs-comment">#é•œåƒåç§°</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">reg.pt1.com/ptengine-prd/ptengine-demo:0.0.1-SNAPSHOT</span>     <span class="hljs-comment">#é•œåƒåœ°å€</span><br>          <span class="hljs-attr">CMD:</span> [ <span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;cat /etc/config/path/to/special-key&quot;</span> ]    <span class="hljs-comment">#å¯åŠ¨CMD</span><br>          <span class="hljs-attr">args:</span>                                                            <span class="hljs-comment">#å¯åŠ¨å‚æ•°</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;-storage.local.retention=$(STORAGE_RETENTION)&#x27;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;-web.external-url=$(EXTERNAL_URL)&#x27;</span><br><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>  <span class="hljs-comment">#å¦‚æœä¸å­˜åœ¨åˆ™æ‹‰å–</span><br>          <span class="hljs-attr">livenessProbe:</span>                 <span class="hljs-comment">#è¡¨ç¤ºcontaineræ˜¯å¦å¤„äºliveçŠ¶æ€ã€‚å¦‚æœLivenessProbeå¤±è´¥ï¼ŒLivenessProbeå°†ä¼šé€šçŸ¥kubeletå¯¹åº”çš„containerä¸å¥åº·äº†ã€‚éšåkubeletå°†killæ‰containerï¼Œå¹¶æ ¹æ®RestarPolicyè¿›è¡Œè¿›ä¸€æ­¥çš„æ“ä½œã€‚é»˜è®¤æƒ…å†µä¸‹LivenessProbeåœ¨ç¬¬ä¸€æ¬¡æ£€æµ‹ä¹‹å‰åˆå§‹åŒ–å€¼ä¸ºSuccessï¼Œå¦‚æœcontaineræ²¡æœ‰æä¾›LivenessProbeï¼Œåˆ™ä¹Ÿè®¤ä¸ºæ˜¯Successï¼›</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/health</span>           <span class="hljs-comment">#å¦‚æœæ²¡æœ‰å¿ƒè·³æ£€æµ‹æ¥å£å°±ä¸º/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>              <span class="hljs-attr">scheme:</span> <span class="hljs-string">HTTP</span><br>            <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">60</span>   <span class="hljs-comment">#å¯åŠ¨åå»¶æ—¶å¤šä¹…å¼€å§‹è¿è¡Œæ£€æµ‹</span><br>            <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">5</span><br>            <span class="hljs-attr">successThreshold:</span> <span class="hljs-number">1</span><br>            <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">5</span><br>            <span class="hljs-attr">readinessProbe:</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/health</span>           <span class="hljs-comment">#å¦‚æœæ²¡æœ‰å¥åº·æ£€æµ‹æ¥å£å°±ä¸º/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>              <span class="hljs-attr">scheme:</span> <span class="hljs-string">HTTP</span><br>            <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span>   <span class="hljs-comment">#å¯åŠ¨åå»¶æ—¶å¤šä¹…å¼€å§‹è¿è¡Œæ£€æµ‹</span><br>            <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">5</span><br>            <span class="hljs-attr">successThreshold:</span> <span class="hljs-number">1</span><br>            <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">5</span><br>          <span class="hljs-attr">resources:</span>                  <span class="hljs-comment">#CPUå†…å­˜é™åˆ¶</span><br>            <span class="hljs-attr">requests:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-number">2</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">2048Mi</span><br>            <span class="hljs-attr">limits:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-number">2</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">2048Mi</span><br>          <span class="hljs-attr">env:</span>                         <span class="hljs-comment">#é€šè¿‡ç¯å¢ƒå˜é‡çš„æ–¹å¼ï¼Œç›´æ¥ä¼ é€’pod=è‡ªå®šä¹‰Linux OSç¯å¢ƒå˜é‡</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">LOCAL_KEY</span>          <span class="hljs-comment">#æœ¬åœ°Key</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">value</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CONFIG_MAP_KEY</span>     <span class="hljs-comment">#localç­–ç•¥å¯ä½¿ç”¨configMapçš„é…ç½®Keyï¼Œ</span><br>              <span class="hljs-attr">valueFrom:</span><br>                <span class="hljs-attr">configMapKeyRef:</span><br>                  <span class="hljs-attr">name:</span> <span class="hljs-string">special-config</span>   <span class="hljs-comment">#configmapä¸­æ‰¾åˆ°nameä¸ºspecial-config</span><br>                  <span class="hljs-attr">key:</span> <span class="hljs-string">special.type</span>      <span class="hljs-comment">#æ‰¾åˆ°nameä¸ºspecial-configé‡Œdataä¸‹çš„key</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>              <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span>       <span class="hljs-comment">#å¯¹serviceæš´éœ²ç«¯å£</span><br>          <span class="hljs-attr">volumeMounts:</span>                 <span class="hljs-comment">#æŒ‚è½½volumesä¸­å®šä¹‰çš„ç£ç›˜</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">log-cache</span><br>            <span class="hljs-attr">mount:</span> <span class="hljs-string">/tmp/log</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">sdb</span>                    <span class="hljs-comment">#æ™®é€šç”¨æ³•ï¼Œè¯¥å·è·Ÿéšå®¹å™¨é”€æ¯ï¼ŒæŒ‚è½½ä¸€ä¸ªç›®å½•</span><br>            <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/data/media</span>    <br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nfs-client-root</span>        <span class="hljs-comment">#ç›´æ¥æŒ‚è½½ç¡¬ç›˜æ–¹æ³•ï¼Œå¦‚æŒ‚è½½ä¸‹é¢çš„nfsç›®å½•åˆ°/mnt/nfs</span><br>            <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/mnt/nfs</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">example-volume-config</span>  <span class="hljs-comment">#é«˜çº§ç”¨æ³•ç¬¬1ç§ï¼Œå°†ConfigMapçš„log-script,backup-scriptåˆ†åˆ«æŒ‚è½½åˆ°/etc/configç›®å½•ä¸‹çš„ä¸€ä¸ªç›¸å¯¹è·¯å¾„path/to/...ä¸‹ï¼Œå¦‚æœå­˜åœ¨åŒåæ–‡ä»¶ï¼Œç›´æ¥è¦†ç›–ã€‚</span><br>            <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/etc/config</span>       <br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">rbd-pvc</span>                <span class="hljs-comment">#é«˜çº§ç”¨æ³•ç¬¬2ä¸­ï¼ŒæŒ‚è½½PVC(PresistentVolumeClaim)</span><br><br>          <span class="hljs-comment">#ä½¿ç”¨volumeå°†ConfigMapä½œä¸ºæ–‡ä»¶æˆ–ç›®å½•ç›´æ¥æŒ‚è½½ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªkey-valueé”®å€¼å¯¹éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œkeyä¸ºæ–‡ä»¶åï¼Œvalueä¸ºå†…å®¹ï¼Œ</span><br>          <span class="hljs-attr">volumes:</span>                       <span class="hljs-comment">#å®šä¹‰ç£ç›˜ç»™ä¸Šé¢volumeMountsæŒ‚è½½</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">log-cache</span><br>            <span class="hljs-attr">emptyDir:</span> &#123;&#125;<br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">sdb</span>                    <span class="hljs-comment">#æŒ‚è½½å®¿ä¸»æœºä¸Šé¢çš„ç›®å½•</span><br>            <span class="hljs-attr">hostPath:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/any/path/it/will/be/replaced</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">example-volume-config</span>    <span class="hljs-comment">#ä¾›ConfigMapæ–‡ä»¶å†…å®¹åˆ°æŒ‡å®šè·¯å¾„ä½¿ç”¨</span><br>            <span class="hljs-attr">configMap:</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">example-volume-config</span>  <span class="hljs-comment">#ConfigMapä¸­åç§°</span><br>              <span class="hljs-attr">items:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">log-script</span>           <span class="hljs-comment">#ConfigMapä¸­çš„Key</span><br>                <span class="hljs-attr">path:</span> <span class="hljs-string">path/to/log-script</span>  <span class="hljs-comment">#æŒ‡å®šç›®å½•ä¸‹çš„ä¸€ä¸ªç›¸å¯¹è·¯å¾„path/to/log-script</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">backup-script</span>        <span class="hljs-comment">#ConfigMapä¸­çš„Key</span><br>                <span class="hljs-attr">path:</span> <span class="hljs-string">path/to/backup-script</span>  <span class="hljs-comment">#æŒ‡å®šç›®å½•ä¸‹çš„ä¸€ä¸ªç›¸å¯¹è·¯å¾„path/to/backup-script</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nfs-client-root</span>         <span class="hljs-comment">#ä¾›æŒ‚è½½NFSå­˜å‚¨ç±»å‹</span><br>            <span class="hljs-attr">nfs:</span><br>              <span class="hljs-attr">server:</span> <span class="hljs-number">10.42</span><span class="hljs-number">.0</span><span class="hljs-number">.55</span>          <span class="hljs-comment">#NFSæœåŠ¡å™¨åœ°å€</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/opt/public</span>           <span class="hljs-comment">#showmount -e çœ‹ä¸€ä¸‹è·¯å¾„</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">rbd-pvc</span>                 <span class="hljs-comment">#æŒ‚è½½PVCç£ç›˜</span><br>            <span class="hljs-attr">persistentVolumeClaim:</span><br>              <span class="hljs-attr">claimName:</span> <span class="hljs-string">rbd-pvc1</span>         <span class="hljs-comment">#æŒ‚è½½å·²ç»ç”³è¯·çš„pvcç£ç›˜</span><br></code></pre></td></tr></table></figure><h2 id="äº”ã€yamlæ–‡ä»¶å†…å®šä¹‰çš„portè¯¦è§£"><a href="#äº”ã€yamlæ–‡ä»¶å†…å®šä¹‰çš„portè¯¦è§£" class="headerlink" title="äº”ã€yamlæ–‡ä»¶å†…å®šä¹‰çš„portè¯¦è§£"></a>äº”ã€yamlæ–‡ä»¶å†…å®šä¹‰çš„portè¯¦è§£</h2><ul><li><p>port<br>portæ˜¯k8sé›†ç¾¤å†…éƒ¨è®¿é—®serviceçš„ç«¯å£ï¼Œå³é€šè¿‡clusterIP: portå¯ä»¥è®¿é—®åˆ°æŸä¸ªservice</p></li><li><p>nodePort<br>nodePortæ˜¯å¤–éƒ¨è®¿é—®k8sé›†ç¾¤ä¸­serviceçš„ç«¯å£ï¼Œé€šè¿‡nodeIP: nodePortå¯ä»¥ä»å¤–éƒ¨è®¿é—®åˆ°æŸä¸ªserviceã€‚</p></li><li><p>targetPort<br>targetPortæ˜¯podçš„ç«¯å£ï¼Œä»portå’ŒnodePortæ¥çš„æµé‡ç»è¿‡kube-proxyæµå…¥åˆ°åç«¯podçš„targetPortä¸Šï¼Œæœ€åè¿›å…¥å®¹å™¨ã€‚</p></li><li><p>containerPort<br>containerPortæ˜¯podå†…éƒ¨å®¹å™¨çš„ç«¯å£ï¼ŒtargetPortæ˜ å°„åˆ°containerPort</p></li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">es</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">elasticsearch.yml:</span> <span class="hljs-string">|</span><br><span class="hljs-string">    http.cors.enabled: true</span><br><span class="hljs-string">    http.cors.allow-origin: &quot;*&quot;</span><br><span class="hljs-string">    http.cors.allow-headers: Authorization</span><br><span class="hljs-string">    cluster.name: elasticsearch</span><br><span class="hljs-string">    network.host: 0.0.0.0</span><br><span class="hljs-string">    node.name: robin-node</span><br><span class="hljs-string">    http.port: 9200</span><br><span class="hljs-string">    transport.tcp.port: 9300</span><br><span class="hljs-string">    transport.tcp.compress: true</span><br><span class="hljs-string"></span><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">elasticsearch</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">elasticsearch</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">elasticsearch</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">nodeName:</span> <span class="hljs-string">ct1</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">elasticsearch</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-number">120.77</span><span class="hljs-number">.159</span><span class="hljs-number">.14</span><span class="hljs-string">:5000/yz-test/elasticsearch_ikpinyin:5.6.12</span><br>        <span class="hljs-attr">env:</span> <br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">discovery.type</span><br>          <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;single-node&quot;</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ES_JAVA_OPTS</span><br>          <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;-Xms512m -Xmx512m&quot;</span><br>        <span class="hljs-attr">ports:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9200</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9300</span><br><span class="hljs-comment">#        resources:</span><br><span class="hljs-comment">#            limits:        #å®šä¹‰ä½¿ç”¨çš„è¿è¡Œå†…å­˜å¤§å°</span><br><span class="hljs-comment">#              cpu: &#x27;1&#x27;</span><br><span class="hljs-comment">#              memory: 2Gi</span><br><span class="hljs-comment">#            requests:</span><br><span class="hljs-comment">#              cpu: &#x27;1&#x27;</span><br><span class="hljs-comment">#              memory: 2Gi</span><br>        <span class="hljs-attr">volumeMounts:</span>   <span class="hljs-comment">#éœ€è¦æ˜ å°„å‡ºæ¥çš„æ•°æ®</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">es-data</span><br>          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/usr/share/elasticsearch/data</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">es-config</span><br>          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/usr/share/elasticsearch/config/elasticsearch.yml</span>  <br>          <span class="hljs-attr">subPath:</span> <span class="hljs-string">elasticsearch.yml</span><br>      <span class="hljs-attr">volumes:</span>    <span class="hljs-comment">#æŒ‚è½½çš„æœ¬æœºæ•°æ®å·åœ°å€</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">es-data</span><br>        <span class="hljs-attr">hostPath:</span><br>          <span class="hljs-attr">path:</span> <span class="hljs-string">/app/elasticsearch/data</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">es-config</span><br>        <span class="hljs-attr">configMap:</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">es</span><br>          <span class="hljs-attr">items:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">elasticsearch.yml</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">elasticsearch.yml</span><br>      <span class="hljs-attr">initContainers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">alpine:3.6</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;/sbin/sysctl&quot;</span>, <span class="hljs-string">&quot;-w&quot;</span>, <span class="hljs-string">&quot;vm.max_map_count=262144&quot;</span>]<br>        <span class="hljs-attr">name:</span> <span class="hljs-string">elasticsearch-logging-init</span><br>        <span class="hljs-attr">securityContext:</span><br>          <span class="hljs-attr">privileged:</span> <span class="hljs-literal">true</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">elasticsearch</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">elasticsearch</span><br>  <span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">es-1</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>    <span class="hljs-attr">nodePort:</span> <span class="hljs-number">29200</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">9200</span><br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9200</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">es-2</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>    <span class="hljs-attr">nodePort:</span> <span class="hljs-number">29300</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">9300</span><br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9300</span><br></code></pre></td></tr></table></figure><p>å°±å¯ä»¥é€šè¿‡è®¿é—®29200å’Œ29300ç«¯å£å»è¿›è¡Œè®¿é—®esã€‚</p><h2 id="å…­ã€ä½¿ç”¨commandåœ¨å¯åŠ¨æ—¶æ‰§è¡ŒæŸäº›è„šæœ¬"><a href="#å…­ã€ä½¿ç”¨commandåœ¨å¯åŠ¨æ—¶æ‰§è¡ŒæŸäº›è„šæœ¬" class="headerlink" title="å…­ã€ä½¿ç”¨commandåœ¨å¯åŠ¨æ—¶æ‰§è¡ŒæŸäº›è„šæœ¬"></a>å…­ã€ä½¿ç”¨commandåœ¨å¯åŠ¨æ—¶æ‰§è¡ŒæŸäº›è„šæœ¬</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml">        <span class="hljs-attr">command:</span> [<span class="hljs-string">&#x27;/bin/sh&#x27;</span>]<br>        <span class="hljs-attr">args:</span> <br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;-c&quot;</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">|</span><br><span class="hljs-string">          set -ex</span><br><span class="hljs-string">          bash /home/1.sh  #è·¯å¾„åº”ä¸ºæ˜ å°„è¿›ç³»ç»Ÿå†…çš„è·¯å¾„</span><br><span class="hljs-string"></span><br><span class="hljs-comment">#æˆ–è€…å†™ï¼šcommand: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;bash /home/1.sh&quot;]</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>k8såŸºç¡€æ¦‚å¿µ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kubernetes1.21.1å®‰è£…kube-prometheus</title>
    <link href="/2023/05/09/k8s/k8s%E9%83%A8%E7%BD%B2%E7%9B%B8%E5%85%B3%E6%9C%8D%E5%8A%A1/kubernetes1.21.0%E5%AE%89%E8%A3%85kube-prometheus/"/>
    <url>/2023/05/09/k8s/k8s%E9%83%A8%E7%BD%B2%E7%9B%B8%E5%85%B3%E6%9C%8D%E5%8A%A1/kubernetes1.21.0%E5%AE%89%E8%A3%85kube-prometheus/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="kubernetes1-21-1å®‰è£…kube-prometheus"><a href="#kubernetes1-21-1å®‰è£…kube-prometheus" class="headerlink" title="kubernetes1.21.1å®‰è£…kube-prometheus"></a>kubernetes1.21.1å®‰è£…kube-prometheus</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">å‚è€ƒæ–‡æ¡£ï¼šhttps:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/lfl17718347843/</span>p/<span class="hljs-number">14274728</span>.html<br>å‚è€ƒæ–‡æ¡£ï¼šhttps:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/weixin_50908696/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">123149821</span><br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨kube-prometheuså®‰è£…éå¸¸æ–¹ä¾¿ï¼Œå‰é¢çš„prometheus+grafana+metrics-serveréƒ½ä¸ç”¨å®‰è£…ï¼Œå·²ç»é›†æˆåœ¨é‡Œé¢ã€‚</strong></p><h2 id="1ã€clone-githubåœ°å€"><a href="#1ã€clone-githubåœ°å€" class="headerlink" title="1ã€clone githubåœ°å€"></a>1ã€clone githubåœ°å€</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> https://github.com/coreos/kube-prometheus.git<br><br></code></pre></td></tr></table></figure><h2 id="2ã€éƒ¨ç½²CRD"><a href="#2ã€éƒ¨ç½²CRD" class="headerlink" title="2ã€éƒ¨ç½²CRD"></a>2ã€éƒ¨ç½²CRD</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> kube-prometheus/manifests<br><br>kubectl apply -f setup/<br></code></pre></td></tr></table></figure><p><strong>å¦‚æœæœ‰ä¸€ä¸ªyamlåœ¨applyçš„æ—¶å€™æç¤ºtoo langå°±æ¢æˆcreateåˆ›å»ºï¼Œé—®é¢˜å¦‚ä¸‹:</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl apply -f setup/0prometheusCustomResourceDefinition.yaml<br>The CustomResourceDefinition <span class="hljs-string">&quot;prometheuses.monitoring.coreos.com&quot;</span> is invalid: metadata.annotations: Too long: must have at most 262144 bytes<br><br>kubectl create -f setup/0prometheusCustomResourceDefinition.yaml<br><br></code></pre></td></tr></table></figure><h2 id="3ã€ä¿®æ”¹promethesï¼Œalertmanagerï¼Œgrafanaçš„serviceç±»å‹ä¸ºNodePortç±»å‹"><a href="#3ã€ä¿®æ”¹promethesï¼Œalertmanagerï¼Œgrafanaçš„serviceç±»å‹ä¸ºNodePortç±»å‹" class="headerlink" title="3ã€ä¿®æ”¹promethesï¼Œalertmanagerï¼Œgrafanaçš„serviceç±»å‹ä¸ºNodePortç±»å‹"></a>3ã€ä¿®æ”¹promethesï¼Œalertmanagerï¼Œgrafanaçš„serviceç±»å‹ä¸ºNodePortç±»å‹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim  prometheus-service.yaml <br><br><span class="hljs-comment">#...çœç•¥</span><br>spec:<br>  <span class="hljs-built_in">type</span>: NodePort <span class="hljs-comment"># æ–°å¢</span><br>  ports:<br>  - name: web<br>    port: 9090<br>    targetPort: web<br>    nodePort: 30090 <span class="hljs-comment"># æ–°å¢</span><br><span class="hljs-comment">#...</span><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim alertmanager-service.yaml <br><br><span class="hljs-comment">#...</span><br>spec:<br>  <span class="hljs-built_in">type</span>: NodePort <span class="hljs-comment"># æ–°å¢</span><br>  ports:<br>  - name: web<br>    port: 9093<br>    targetPort: web<br>    nodePort: 30093 <span class="hljs-comment"># æ–°å¢</span><br><span class="hljs-comment">#...</span><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim grafana-service.yaml <br><br>spec:<br>  <span class="hljs-built_in">type</span>: NodePort <span class="hljs-comment"># æ–°å¢</span><br>  ports:<br>  - name: http<br>    port: 3000<br>    targetPort: http<br>    nodePort: 30300 <span class="hljs-comment"># æ–°å¢</span><br></code></pre></td></tr></table></figure><h2 id="4ã€å¯åŠ¨prometheus"><a href="#4ã€å¯åŠ¨prometheus" class="headerlink" title="4ã€å¯åŠ¨prometheus"></a>4ã€å¯åŠ¨prometheus</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl apply -f .<br><br>kubectl get pod -n monitoring<br></code></pre></td></tr></table></figure><p><strong>å¦‚æœæœ‰å‡ ä¸ªpodåˆ›å»ºå¤±è´¥ï¼Œå¯èƒ½æ˜¯å› ä¸ºé•œåƒæ‹‰å–ä¸ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆå…¶ä»–é•œåƒåœ°å€</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">ä¾‹ï¼š<br>vim kubeStateMetrics-deployment.yaml<br><span class="hljs-comment">#ä¿®æ”¹ï¼š</span><br>image: bitnami/kube-state-metrics:v2.8.2<br><br>vim prometheusAdapter-deployment.yaml<br><span class="hljs-comment">#ä¿®æ”¹ï¼š</span><br>image: selina5288/prometheus-adapter:v0.10.1<br></code></pre></td></tr></table></figure><h2 id="5ã€è®¿é—®é¡µé¢"><a href="#5ã€è®¿é—®é¡µé¢" class="headerlink" title="5ã€è®¿é—®é¡µé¢"></a>5ã€è®¿é—®é¡µé¢</h2><p>grafanaé¡µé¢ï¼š<code>30300</code> è´¦å·åŒå¯†ç ï¼š<code>admin</code><br>alertmanageré¡µé¢ï¼š<code>30093</code><br>prometheusé¡µé¢ï¼š<code>30090</code></p><p>æˆ–è€…ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl get svc -n monitoring<br><br></code></pre></td></tr></table></figure><h3 id="è®¿é—®grafanaè®¾ç½®æ¨¡æ¿ã€‚æ¯”å¦‚8685ã€8919ã€10000"><a href="#è®¿é—®grafanaè®¾ç½®æ¨¡æ¿ã€‚æ¯”å¦‚8685ã€8919ã€10000" class="headerlink" title="è®¿é—®grafanaè®¾ç½®æ¨¡æ¿ã€‚æ¯”å¦‚8685ã€8919ã€10000"></a>è®¿é—®grafanaè®¾ç½®æ¨¡æ¿ã€‚æ¯”å¦‚8685ã€8919ã€10000</h3>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>k8séƒ¨ç½²ç›¸å…³æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kubernetes1.21.1å®‰è£…kube-prometheus</title>
    <link href="/2023/05/09/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4%E4%BB%A5%E5%8F%8A%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/"/>
    <url>/2023/05/09/k8s/%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/k8s%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4%E4%BB%A5%E5%8F%8A%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="k8såŸºç¡€å‘½ä»¤åŠé—®é¢˜å¤„ç†"><a href="#k8såŸºç¡€å‘½ä»¤åŠé—®é¢˜å¤„ç†" class="headerlink" title="k8såŸºç¡€å‘½ä»¤åŠé—®é¢˜å¤„ç†"></a>k8såŸºç¡€å‘½ä»¤åŠé—®é¢˜å¤„ç†</h1><h2 id="1-k8så¸¸è§è¡¥å…¨å‘½ä»¤"><a href="#1-k8så¸¸è§è¡¥å…¨å‘½ä»¤" class="headerlink" title="1.k8så¸¸è§è¡¥å…¨å‘½ä»¤"></a>1.k8så¸¸è§è¡¥å…¨å‘½ä»¤</h2><h3 id="1-1ã€kubectlè¡¥é½å‘½ä»¤ä¸€"><a href="#1-1ã€kubectlè¡¥é½å‘½ä»¤ä¸€" class="headerlink" title="1.1ã€kubectlè¡¥é½å‘½ä»¤ä¸€:"></a>1.1ã€kubectlè¡¥é½å‘½ä»¤ä¸€:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y bash-completion<br><span class="hljs-built_in">source</span> /usr/share/bash-completion/bash_completion<br><span class="hljs-built_in">source</span> &lt;(kubectl completion bash)<br>kubectl completion bash &gt; ~/.kube/completion.bash.inc<br><span class="hljs-built_in">source</span> <span class="hljs-string">&#x27;/root/.kube/completion.bash.inc&#x27;</span>  <br><span class="hljs-built_in">source</span> <span class="hljs-variable">$HOME</span>/.bash_profile<br></code></pre></td></tr></table></figure><h3 id="1-2ã€kubectlè¡¥é½å‘½ä»¤äºŒ"><a href="#1-2ã€kubectlè¡¥é½å‘½ä»¤äºŒ" class="headerlink" title="1.2ã€kubectlè¡¥é½å‘½ä»¤äºŒ:"></a>1.2ã€kubectlè¡¥é½å‘½ä»¤äºŒ:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> &lt;(kubectl completion bash)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; ~/.bashrc<br></code></pre></td></tr></table></figure><h3 id="1-3ã€kubeadmè¡¥é½å‘½ä»¤"><a href="#1-3ã€kubeadmè¡¥é½å‘½ä»¤" class="headerlink" title="1.3ã€kubeadmè¡¥é½å‘½ä»¤"></a>1.3ã€kubeadmè¡¥é½å‘½ä»¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> &lt;(kubeadm completion bash)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;source &lt;(kubeadm completion bash)&quot;</span> &gt;&gt; ~/.bashrc<br></code></pre></td></tr></table></figure><h2 id="2-k8sæ­£ç¡®åˆ é™¤ä¸€ä¸ªpod"><a href="#2-k8sæ­£ç¡®åˆ é™¤ä¸€ä¸ªpod" class="headerlink" title="2.k8sæ­£ç¡®åˆ é™¤ä¸€ä¸ªpod"></a>2.k8sæ­£ç¡®åˆ é™¤ä¸€ä¸ªpod</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">1ã€å…ˆåˆ é™¤pod<br><span class="hljs-comment">#kubectl get pod -n å‘½åç©ºé—´</span><br>kubectl delete pod podå -n å‘½åç©ºé—´<br><br>2ã€åˆ é™¤å¯¹åº”çš„deployment<br><span class="hljs-comment">#kubectl get deployment -n å‘½åç©ºé—´</span><br>kubectl delete deployment podå -n å‘½åç©ºé—´<br><br>å¼ºåˆ¶åˆ é™¤pod:<br>kubectl delete pods aos-apiserver-5f8f5b5585-s9l92 --grace-period=0 --force<br></code></pre></td></tr></table></figure><h2 id="3-æŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´"><a href="#3-æŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´" class="headerlink" title="3.æŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´"></a>3.æŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-keyword">for</span> crt <span class="hljs-keyword">in</span> $(find /app/kubernetes/ssl/ -name <span class="hljs-string">&quot;*.crt&quot;</span>); <span class="hljs-keyword">do</span> openssl x509 -<span class="hljs-keyword">in</span> <span class="hljs-variable">$crt</span> -noout -dates; <span class="hljs-keyword">done</span><br><span class="hljs-keyword">for</span> crt <span class="hljs-keyword">in</span> $(find /app/kubernetes/ssl/ -name <span class="hljs-string">&quot;*.pem&quot;</span>); <span class="hljs-keyword">do</span> openssl x509 -<span class="hljs-keyword">in</span> <span class="hljs-variable">$crt</span> -noout -dates; <span class="hljs-keyword">done</span><br><span class="hljs-keyword">for</span> crt <span class="hljs-keyword">in</span> $(find /app/kubernetes/ssl/ -name <span class="hljs-string">&quot;*.pem&quot;</span>|grep -v <span class="hljs-string">&quot;key&quot;</span>); <span class="hljs-keyword">do</span> openssl x509 -<span class="hljs-keyword">in</span> <span class="hljs-variable">$crt</span> -noout -dates; <span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> `find /etc/kubernetes/pki -maxdepth 2 -name <span class="hljs-string">&quot;*.crt&quot;</span>`;<span class="hljs-keyword">do</span> openssl x509 -<span class="hljs-keyword">in</span> <span class="hljs-variable">$item</span> -text -noout| grep Not;<span class="hljs-built_in">echo</span> ======================<span class="hljs-variable">$item</span>===================;<span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h2 id="4-å¯¼å‡ºé…ç½®æ–‡ä»¶åˆ°å·¥ä½œç›®å½•"><a href="#4-å¯¼å‡ºé…ç½®æ–‡ä»¶åˆ°å·¥ä½œç›®å½•" class="headerlink" title="4.å¯¼å‡ºé…ç½®æ–‡ä»¶åˆ°å·¥ä½œç›®å½•"></a>4.å¯¼å‡ºé…ç½®æ–‡ä»¶åˆ°å·¥ä½œç›®å½•</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm config <span class="hljs-built_in">print</span> init-defaults --kubeconfig ClusterConfiguration &gt; kubeadm.yml<br></code></pre></td></tr></table></figure><h2 id="5-kubectlæ£€æŸ¥ç»„ä»¶å¥åº·çŠ¶æ€å¼‚å¸¸å¤„ç†"><a href="#5-kubectlæ£€æŸ¥ç»„ä»¶å¥åº·çŠ¶æ€å¼‚å¸¸å¤„ç†" class="headerlink" title="5.kubectlæ£€æŸ¥ç»„ä»¶å¥åº·çŠ¶æ€å¼‚å¸¸å¤„ç†"></a>5.kubectlæ£€æŸ¥ç»„ä»¶å¥åº·çŠ¶æ€å¼‚å¸¸å¤„ç†</h2><h3 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°:"></a>é—®é¢˜æè¿°:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl get cs<br><span class="hljs-comment">#------------------------------------------------</span><br>Warning: v1 ComponentStatus is deprecated <span class="hljs-keyword">in</span> v1.19+<br>NAME                 STATUS      MESSAGE                                                                                       ERROR<br>controller-manager   Unhealthy   Get <span class="hljs-string">&quot;http://127.0.0.1:10252/healthz&quot;</span>: dial tcp 127.0.0.1:10252: connect: connection refused   <br>scheduler            Unhealthy   Get <span class="hljs-string">&quot;http://127.0.0.1:10251/healthz&quot;</span>: dial tcp 127.0.0.1:10251: connect: connection refused   <br>etcd-0               Healthy     &#123;<span class="hljs-string">&quot;health&quot;</span>:<span class="hljs-string">&quot;true&quot;</span>&#125; <br></code></pre></td></tr></table></figure><h3 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /etc/kubernetes/manifests<br><br>[root@k8s-master1 manifests]<span class="hljs-comment"># ls</span><br>etcd.yaml  kube-apiserver.yaml  kube-controller-manager.yaml  kube-scheduler.yaml<br><br>vim kube-controller-manager.yaml   //æ³¨é‡Š --port=0<br>vim kube-scheduler.yaml   //æ³¨é‡Š --port=0<br><br><span class="hljs-comment">#é‡å¯kubeletæœåŠ¡ï¼š</span><br>å¦‚æœé›†ç¾¤è¿è¡Œå¾ˆä¹…ä¸å»ºè®®é‡å¯kubeletæœåŠ¡ï¼Œå¯ä»¥å¯¹kube-controller-managerã€kube-schedulerçš„deploymenté‡å¯<br><br>systemctl restart kubelet.service<br></code></pre></td></tr></table></figure><h2 id="6-iptableså†…å®¹æœªè®¾ç½®ä¸º1"><a href="#6-iptableså†…å®¹æœªè®¾ç½®ä¸º1" class="headerlink" title="6.iptableså†…å®¹æœªè®¾ç½®ä¸º1"></a>6.iptableså†…å®¹æœªè®¾ç½®ä¸º1</h2><h3 id="é—®é¢˜æè¿°ï¼š"><a href="#é—®é¢˜æè¿°ï¼š" class="headerlink" title="é—®é¢˜æè¿°ï¼š"></a>é—®é¢˜æè¿°ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@k8s-master1 ~]<span class="hljs-comment"># kubeadm init --config kubeadm-config.yaml</span><br><br>[ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables]: /proc/sys/net/bridge/bridge-nf-call-iptables contents are not <span class="hljs-built_in">set</span> to 1<br></code></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ³•ï¼š"><a href="#è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;1&quot;</span> &gt;/proc/sys/net/bridge/bridge-nf-call-iptables<br></code></pre></td></tr></table></figure><h2 id="7-kube-proxyæ— æ³•è¿è¡ŒæˆåŠŸ-çŠ¶æ€ä¸€ç›´ä¸ºï¼šCrashLoopBackOff"><a href="#7-kube-proxyæ— æ³•è¿è¡ŒæˆåŠŸ-çŠ¶æ€ä¸€ç›´ä¸ºï¼šCrashLoopBackOff" class="headerlink" title="7.kube-proxyæ— æ³•è¿è¡ŒæˆåŠŸ çŠ¶æ€ä¸€ç›´ä¸ºï¼šCrashLoopBackOff"></a>7.kube-proxyæ— æ³•è¿è¡ŒæˆåŠŸ çŠ¶æ€ä¸€ç›´ä¸ºï¼šCrashLoopBackOff</h2><h3 id="é—®é¢˜æè¿°ï¼š-1"><a href="#é—®é¢˜æè¿°ï¼š-1" class="headerlink" title="é—®é¢˜æè¿°ï¼š"></a>é—®é¢˜æè¿°ï¼š</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">åœ¨1.20.2ç‰ˆæœ¬ä¸­,ä½¿ç”¨kubeadmè¿›è¡Œé›†ç¾¤åˆå§‹åŒ–æ—¶,è™½ç„¶å¯ä»¥æ­£å¸¸éƒ¨ç½²,ä½†æ˜¯æŸ¥çœ‹podæƒ…å†µçš„æ—¶å€™å¯ä»¥çœ‹åˆ°kube-proxyæ— æ³•è¿è¡ŒæˆåŠŸ çŠ¶æ€ä¸€ç›´ä¸ºï¼šCrashLoopBackOff<br></code></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ³•ï¼š-1"><a href="#è§£å†³æ–¹æ³•ï¼š-1" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl edit cm kube-proxy -n kube-system<br><span class="hljs-comment">#åœ¨ç¼–è¾‘æ¨¡å¼ä¸­æ‰¾åˆ°ä»¥ä¸‹å­—æ®µï¼Œåˆ é™¤åä¿å­˜</span><br>featureGates: <br>  SupportIPVSProxyMode: <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h2 id="8-kubeadmåŠ å…¥masteræœºå™¨æ—¶tokenè¿‡æœŸå¤„ç†"><a href="#8-kubeadmåŠ å…¥masteræœºå™¨æ—¶tokenè¿‡æœŸå¤„ç†" class="headerlink" title="8.kubeadmåŠ å…¥masteræœºå™¨æ—¶tokenè¿‡æœŸå¤„ç†"></a>8.kubeadmåŠ å…¥masteræœºå™¨æ—¶tokenè¿‡æœŸå¤„ç†</h2><h3 id="é—®é¢˜æè¿°ï¼š-2"><a href="#é—®é¢˜æè¿°ï¼š-2" class="headerlink" title="é—®é¢˜æè¿°ï¼š"></a>é—®é¢˜æè¿°ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">masterèŠ‚ç‚¹æœºå™¨æ˜¾ç¤ºï¼šerror execution phase preflight: couldn<span class="hljs-string">&#x27;t validate the identity of the API Server: Get &quot;https://apiserver.cluster.local:6443/api/v1/namespaces/kube-public/configmaps/cluster-info?timeout=10s&quot;: dial tcp 192.168.94.156:6443: connect: connection refused</span><br></code></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ³•ï¼š-2"><a href="#è§£å†³æ–¹æ³•ï¼š-2" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h3><h4 id="8-1ã€æŸ¥çœ‹ä½¿ç”¨çš„tokenæ˜¯å¦è¿‡æœŸï¼ŒæŸ¥çœ‹EXPIRESä¸€æ ï¼Œ-é‡æ–°ç”Ÿæˆtokenå‘½ä»¤ï¼škubeadm-token-create"><a href="#8-1ã€æŸ¥çœ‹ä½¿ç”¨çš„tokenæ˜¯å¦è¿‡æœŸï¼ŒæŸ¥çœ‹EXPIRESä¸€æ ï¼Œ-é‡æ–°ç”Ÿæˆtokenå‘½ä»¤ï¼škubeadm-token-create" class="headerlink" title="8.1ã€æŸ¥çœ‹ä½¿ç”¨çš„tokenæ˜¯å¦è¿‡æœŸï¼ŒæŸ¥çœ‹EXPIRESä¸€æ ï¼Œ#é‡æ–°ç”Ÿæˆtokenå‘½ä»¤ï¼škubeadm token create"></a>8.1ã€æŸ¥çœ‹ä½¿ç”¨çš„tokenæ˜¯å¦è¿‡æœŸï¼ŒæŸ¥çœ‹EXPIRESä¸€æ ï¼Œ#é‡æ–°ç”Ÿæˆtokenå‘½ä»¤ï¼škubeadm token create</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm token list<br></code></pre></td></tr></table></figure><h4 id="8-2ã€ç”Ÿæˆæ–°çš„â€“certificate-key"><a href="#8-2ã€ç”Ÿæˆæ–°çš„â€“certificate-key" class="headerlink" title="8.2ã€ç”Ÿæˆæ–°çš„â€“certificate-key"></a>8.2ã€ç”Ÿæˆæ–°çš„â€“certificate-key</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm init phase upload-certs --upload-certs<br><span class="hljs-comment">#----------------</span><br>[upload-certs] Storing the certificates <span class="hljs-keyword">in</span> Secret <span class="hljs-string">&quot;kubeadm-certs&quot;</span> <span class="hljs-keyword">in</span> the <span class="hljs-string">&quot;kube-system&quot;</span> Namespace<br>[upload-certs] Using certificate key:<br>db5d35d1412ec0678c0b42959a16c44edb1d87d8b19452768ee9843a79414c6f<br></code></pre></td></tr></table></figure><h4 id="8-3ã€æ–¹æ³•ä¸€ï¼šé‡æ–°ç”ŸæˆmasterèŠ‚ç‚¹ä»¤ç‰Œï¼Œä¼šå‡ºç°ç›¸å…³çš„åŠ å…¥å‘½ä»¤"><a href="#8-3ã€æ–¹æ³•ä¸€ï¼šé‡æ–°ç”ŸæˆmasterèŠ‚ç‚¹ä»¤ç‰Œï¼Œä¼šå‡ºç°ç›¸å…³çš„åŠ å…¥å‘½ä»¤" class="headerlink" title="8.3ã€æ–¹æ³•ä¸€ï¼šé‡æ–°ç”ŸæˆmasterèŠ‚ç‚¹ä»¤ç‰Œï¼Œä¼šå‡ºç°ç›¸å…³çš„åŠ å…¥å‘½ä»¤"></a>8.3ã€æ–¹æ³•ä¸€ï¼šé‡æ–°ç”ŸæˆmasterèŠ‚ç‚¹ä»¤ç‰Œï¼Œä¼šå‡ºç°ç›¸å…³çš„åŠ å…¥å‘½ä»¤</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm token create --print-join-command --certificate-key=db5d35d1412ec0678c0b42959a16c44edb1d87d8b19452768ee9843a79414c6f<br></code></pre></td></tr></table></figure><h4 id="8-3ã€æ–¹æ³•äºŒï¼šç›´æ¥ä¿®æ”¹åŠ å…¥å‘½ä»¤"><a href="#8-3ã€æ–¹æ³•äºŒï¼šç›´æ¥ä¿®æ”¹åŠ å…¥å‘½ä»¤" class="headerlink" title="8.3ã€æ–¹æ³•äºŒï¼šç›´æ¥ä¿®æ”¹åŠ å…¥å‘½ä»¤"></a>8.3ã€æ–¹æ³•äºŒï¼šç›´æ¥ä¿®æ”¹åŠ å…¥å‘½ä»¤</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm <span class="hljs-built_in">join</span> apiserver.cluster.local:6443 --token æœ‰æ•ˆçš„token \<br>--discovery-token-ca-cert-hash sha256:è·å–çš„æ­£ç¡®ca-cert-hashå€¼ \<br>--control-plane --certificate-key æ–°ç”Ÿæˆçš„certificate-key<br><br>ä¾‹å¦‚ï¼š<br>æŸ¥çœ‹--discovery-token-ca-cert-hash sha256:çš„å€¼:<br><br>openssl x509 -pubkey -<span class="hljs-keyword">in</span> /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed <span class="hljs-string">&#x27;s/^.* //&#x27;</span><br><br>kubeadm <span class="hljs-built_in">join</span> apiserver.cluster.local:6443 --token 4d0pdh.dz4nqc496ujy7omm \<br>  --discovery-token-ca-cert-hash sha256:4b79b65275442d2d42efb0b7d3b81fa42fbfdbfb21d2beab1659d9d1734a6100 \<br>  --control-plane --certificate-key 9ed38b70791479775ddaeac9bf4bdadfc54d0e9c6a8beab04002df4dacc757d5<br></code></pre></td></tr></table></figure><h3 id="æ–°nodeèŠ‚ç‚¹ä»¤ç‰ŒåŠ å…¥"><a href="#æ–°nodeèŠ‚ç‚¹ä»¤ç‰ŒåŠ å…¥" class="headerlink" title="æ–°nodeèŠ‚ç‚¹ä»¤ç‰ŒåŠ å…¥:"></a>æ–°nodeèŠ‚ç‚¹ä»¤ç‰ŒåŠ å…¥:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm <span class="hljs-built_in">join</span> apiserver.cluster.local:6443 --token æœ‰æ•ˆçš„token --discovery-token-ca-cert-hash sha256:æ­£ç¡®çš„ca-certå€¼<br><br>ä¾‹å¦‚ï¼škubeadm <span class="hljs-built_in">join</span> apiserver.cluster.local:6443 --token 385f5m.zjeniniwgbkxjzbs --discovery-token-ca-cert-hash sha256:4b79b65275442d2d42efb0b7d3b81fa42fbfdbfb21d2beab1659d9d1734a6100<br></code></pre></td></tr></table></figure><h2 id="9-ç½‘ç»œæ’ä»¶-æœªèƒ½ä¸ºèŒƒå›´0åˆ†é…ï¼šèŒƒå›´é›†ä¸­æ²¡æœ‰å¯ç”¨çš„IPåœ°å€"><a href="#9-ç½‘ç»œæ’ä»¶-æœªèƒ½ä¸ºèŒƒå›´0åˆ†é…ï¼šèŒƒå›´é›†ä¸­æ²¡æœ‰å¯ç”¨çš„IPåœ°å€" class="headerlink" title="9.ç½‘ç»œæ’ä»¶ æœªèƒ½ä¸ºèŒƒå›´0åˆ†é…ï¼šèŒƒå›´é›†ä¸­æ²¡æœ‰å¯ç”¨çš„IPåœ°å€"></a>9.ç½‘ç»œæ’ä»¶ æœªèƒ½ä¸ºèŒƒå›´0åˆ†é…ï¼šèŒƒå›´é›†ä¸­æ²¡æœ‰å¯ç”¨çš„IPåœ°å€</h2><h3 id="è§£å†³æ–¹æ³•ï¼š-3"><a href="#è§£å†³æ–¹æ³•ï¼š-3" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å…ˆå…³é—­dockerã€kubeletæœåŠ¡</span><br>systemctl stop kubelet.service<br>systemctl stop docker<br>systemctl stop flannel<br><br><span class="hljs-comment">#åˆ é™¤ipæ± </span><br><span class="hljs-built_in">rm</span> -rf /var/lib/cni/flannel/* &amp;&amp; <span class="hljs-built_in">rm</span> -rf /var/lib/cni/networks/cbr0/* &amp;&amp; ip <span class="hljs-built_in">link</span> delete cni0<br><span class="hljs-built_in">rm</span> -rf  /var/lib/cni/networks/cni0/*<br><span class="hljs-comment">#å¯åŠ¨æœåŠ¡</span><br>systemctl start docker<br>systemctl start flannel<br>systemctl start kubelet.service<br></code></pre></td></tr></table></figure><h2 id="10-k8såˆ é™¤çŠ¶æ€ä¸ºEvictedçš„pod"><a href="#10-k8såˆ é™¤çŠ¶æ€ä¸ºEvictedçš„pod" class="headerlink" title="10.k8såˆ é™¤çŠ¶æ€ä¸ºEvictedçš„pod"></a>10.k8såˆ é™¤çŠ¶æ€ä¸ºEvictedçš„pod</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br> kubectl get pod -n party-system | grep Evicted | awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs kubectl delete pod -n party-system <br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼špodè¿è¡Œåˆ†é…çš„nodeæœåŠ¡å™¨ï¼Œ&#x2F;è·¯å¾„ä¸‹èµ„æºè¶…è¿‡85%æ—¶ä¼šæœ‰æŠ¥é”™</strong></p><h2 id="11-å¯¼å‡ºç‰ˆæœ¬å·"><a href="#11-å¯¼å‡ºç‰ˆæœ¬å·" class="headerlink" title="11.å¯¼å‡ºç‰ˆæœ¬å·"></a>11.å¯¼å‡ºç‰ˆæœ¬å·</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl describe pod -n party-system |grep Image: | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> &gt; desc-images.txt<br></code></pre></td></tr></table></figure><h2 id="12-delete-podæ—¶æ— æ³•åˆ é™¤æ—¶ï¼Œéœ€è¦åˆ é™¤deployments"><a href="#12-delete-podæ—¶æ— æ³•åˆ é™¤æ—¶ï¼Œéœ€è¦åˆ é™¤deployments" class="headerlink" title="12. delete podæ—¶æ— æ³•åˆ é™¤æ—¶ï¼Œéœ€è¦åˆ é™¤deployments"></a>12. delete podæ—¶æ— æ³•åˆ é™¤æ—¶ï¼Œéœ€è¦åˆ é™¤deployments</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl get deployment <br><br>kubectl delete deployment xxx<br></code></pre></td></tr></table></figure><h2 id="13-The-range-of-valid-ports-is-30000-32767-ç«¯å£èŒƒå›´é—®é¢˜"><a href="#13-The-range-of-valid-ports-is-30000-32767-ç«¯å£èŒƒå›´é—®é¢˜" class="headerlink" title="13. The range of valid ports is 30000-32767  ç«¯å£èŒƒå›´é—®é¢˜"></a>13. The range of valid ports is 30000-32767  ç«¯å£èŒƒå›´é—®é¢˜</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/kubernetes/manifests/kube-apiserver.yaml <span class="hljs-comment">#ä½¿ç”¨çš„æ˜¯é»˜è®¤å®‰è£…çš„è·¯å¾„ï¼Œå¯ä»¥ps -ef| grep apiæŸ¥çœ‹</span><br><br>- --service-node-port-range=25000-30000 <span class="hljs-comment">#æ·»åŠ æˆ–è€…ä¿®æ”¹ç«¯å£èŒƒå›´</span><br></code></pre></td></tr></table></figure><h2 id="14-k8så®¹å™¨æ‹·è´æ–‡ä»¶åˆ°æœ¬åœ°"><a href="#14-k8så®¹å™¨æ‹·è´æ–‡ä»¶åˆ°æœ¬åœ°" class="headerlink" title="14.k8så®¹å™¨æ‹·è´æ–‡ä»¶åˆ°æœ¬åœ°"></a>14.k8så®¹å™¨æ‹·è´æ–‡ä»¶åˆ°æœ¬åœ°</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl <span class="hljs-built_in">cp</span> qzcsbj/order-b477c8947-tr8rz:/tmp/jstack.txt /root/test/jstack.txt<br><span class="hljs-comment">#æœ¬åœ°æ–‡ä»¶æ‹·è´åˆ°k8så®¹å™¨</span><br><br>tar cf - data.txt | kubectl <span class="hljs-built_in">exec</span> -i -n qzcsbj order-b477c8947-tr8rz -- tar xf - -C /root/<br></code></pre></td></tr></table></figure><h2 id="15-æ‰§è¡Œkubectlå‘½ä»¤æ—¶æŠ¥é”™-error-You-must-be-logged-in-to-the-server-Unauthorized"><a href="#15-æ‰§è¡Œkubectlå‘½ä»¤æ—¶æŠ¥é”™-error-You-must-be-logged-in-to-the-server-Unauthorized" class="headerlink" title="15.æ‰§è¡Œkubectlå‘½ä»¤æ—¶æŠ¥é”™ error: You must be logged in to the server (Unauthorized)"></a>15.æ‰§è¡Œkubectlå‘½ä»¤æ—¶æŠ¥é”™ error: You must be logged in to the server (Unauthorized)</h2><h3 id="é—®é¢˜è¯¦æƒ…ï¼š"><a href="#é—®é¢˜è¯¦æƒ…ï¼š" class="headerlink" title="é—®é¢˜è¯¦æƒ…ï¼š"></a>é—®é¢˜è¯¦æƒ…ï¼š</h3><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs subunit">Kubernetesé›†ç¾¤masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œkubectlå‘½ä»¤æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š<br><span class="hljs-keyword">error: </span>You must be logged in to the server (Unauthorized)<br>é”™è¯¯ï¼šæ‚¨å¿…é¡»ç™»å½•åˆ°æœåŠ¡å™¨ï¼ˆæœªç»æˆæƒï¼‰<br></code></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ³•-Â·"><a href="#è§£å†³æ–¹æ³•-Â·" class="headerlink" title="è§£å†³æ–¹æ³•:Â·"></a>è§£å†³æ–¹æ³•:Â·</h3><p>åŸå› ï¼šè¿™ä¸ªæ˜¯æƒé™é—®é¢˜ï¼Œé…ç½®èº«ä»½è®¤è¯çš„æ–‡ä»¶ä¸º&#x2F;etc&#x2F;kubernetes&#x2F;admin.confï¼Œé¢å‘è¯ä¹¦æ—¶&#x2F;etc&#x2F;kubernetes&#x2F;admin.confæ–‡ä»¶é‡æ–°ç”Ÿæˆï¼Œä½†æ˜¯$HOME&#x2F;.kube&#x2F;configå¹¶æ²¡æœ‰å¾—åˆ°æ›¿æ¢ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo <span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br></code></pre></td></tr></table></figure><h2 id="16-å…è®¸podåœ¨masterèŠ‚ç‚¹ä¸Šè¿è¡Œ"><a href="#16-å…è®¸podåœ¨masterèŠ‚ç‚¹ä¸Šè¿è¡Œ" class="headerlink" title="16.å…è®¸podåœ¨masterèŠ‚ç‚¹ä¸Šè¿è¡Œ"></a>16.å…è®¸podåœ¨masterèŠ‚ç‚¹ä¸Šè¿è¡Œ</h2><p>é•¿æœŸæ”¹å˜èŠ‚ç‚¹çš„å±æ€§ï¼Œå…è®¸Masterè¿è¡Œåº”ç”¨ï¼Œæ‰§è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl taint nodes --all node-role.kubernetes.io/master-<br></code></pre></td></tr></table></figure><p>ä¸´æ—¶å…è®¸MasterèŠ‚ç‚¹æ‰§è¡Œåº”ç”¨ï¼Œåœ¨åº”ç”¨çš„yamlæ–‡ä»¶ä¸­æ·»åŠ ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh">      tolerations:<br>      - key: node-role.kubernetes.io/master<br>        effect: NoSchedule<br><span class="hljs-comment">#ä¸¾ä¾‹ï¼š</span><br>apiVersion: apps/v1<br>kind: DaemonSet<br>metadata:<br>  name: fluentd-elasticsearch<br>  namespace: <span class="hljs-built_in">test</span><br>  labels:<br>    k8s-app: fluentd-logging<br>spec:<br>  selector:<br>    <span class="hljs-comment">#...</span><br>  template:<br>    <span class="hljs-comment">#...</span><br>    spec:<br>      tolerations:<br>      - key: node-role.kubernetes.io/master<br>        effect: NoSchedule<br>      containers:<br>      <span class="hljs-comment">#...</span><br></code></pre></td></tr></table></figure><h2 id="17-å®¿ä¸»æœºï¼ˆå¤–éƒ¨ï¼‰æ‰§è¡Œpodå®¹å™¨å†…æ“ä½œï¼š"><a href="#17-å®¿ä¸»æœºï¼ˆå¤–éƒ¨ï¼‰æ‰§è¡Œpodå®¹å™¨å†…æ“ä½œï¼š" class="headerlink" title="17.å®¿ä¸»æœºï¼ˆå¤–éƒ¨ï¼‰æ‰§è¡Œpodå®¹å™¨å†…æ“ä½œï¼š"></a>17.å®¿ä¸»æœºï¼ˆå¤–éƒ¨ï¼‰æ‰§è¡Œpodå®¹å™¨å†…æ“ä½œï¼š</h2><p>ä»¥å¤–éƒ¨æ‰§è¡Œå®¹å™¨å†…æŸä¸ªå­—ç¬¦ä¸²çš„å‘½ä»¤ä¸ºä¾‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl <span class="hljs-built_in">exec</span> -it  $(kubectl get po | grep jobmanager | awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>) -- /opt/flink/bin/sql-client.sh -f /opt/flink/scripts/*.sql<br><br>æ³¨æ„ï¼šä¸¤ä¸ªçŸ­æ  -- è¡¨ç¤ºåé¢å¯ä»¥ä¼ å…¥linuxå‘½ä»¤ï¼Œå‰åå„æœ‰ä¸€ä¸ªç©ºæ ¼åˆ†éš”å¼€æ¥<br><br>å¦‚æœä¸€ä¸ªpodä¸­æœ‰å¤šä¸ªpodçš„å®ä¾‹çš„è¯ï¼Œå¯åŠ ä¸Š -c å‚æ•°æ¥æŒ‡å®šç‰¹å®šçš„å®¹å™¨åï¼š<br>kubectl <span class="hljs-built_in">exec</span> -it -n default wyn-project1-7957cdf65f-ds7lh -c testshilie1 -- <span class="hljs-built_in">mkdir</span> /test<br><br>å¦‚æœåŒæ—¶æ‰§è¡Œå¤šä¸ªå‘½ä»¤æ—¶ï¼šå¯ä½¿ç”¨ -- bash -c æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤:<br>kubectl <span class="hljs-built_in">exec</span> -it  $(kubectl get po | grep jobmanager | awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>) -- bash -c <span class="hljs-string">&#x27;cd pb-scripts/ &amp;&amp; ls  | wc -l&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="18-å®‰è£…flannelä¸æä¾›podCIDR"><a href="#18-å®‰è£…flannelä¸æä¾›podCIDR" class="headerlink" title="18.å®‰è£…flannelä¸æä¾›podCIDR"></a>18.å®‰è£…flannelä¸æä¾›podCIDR</h2><h3 id="é—®é¢˜è¯¦æƒ…ï¼š-1"><a href="#é—®é¢˜è¯¦æƒ…ï¼š-1" class="headerlink" title="é—®é¢˜è¯¦æƒ…ï¼š"></a>é—®é¢˜è¯¦æƒ…ï¼š</h3><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs subunit">é”™è¯¯ï¼šThe error from the pod logs:<br><span class="hljs-keyword">Error </span>registering network: failed to acquire lease: node &quot;master1&quot; pod cidr not assigned<br></code></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ³•ï¼š-4"><a href="#è§£å†³æ–¹æ³•ï¼š-4" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl patch node master1 -p <span class="hljs-string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;podCIDR&quot;:&quot;10.244.0.0/16&quot;&#125;&#125;&#x27;</span><br><br>æˆ–è€…ï¼š<br>vim /etc/kubernetes/manifests/kube-controller-manager.yaml<br><span class="hljs-comment">#å¢åŠ å‚æ•°ï¼š</span><br><br>--allocate-node-cidrs=<span class="hljs-literal">true</span><br>--cluster-cidr=10.244.0.0/16<br><br>é‡å¯æœåŠ¡ï¼š<br>systemctl restart kubelet<br></code></pre></td></tr></table></figure><h2 id="19-node-s-had-taints-that-the-pod-didnâ€™t-tolerate-in-kubernetes-cluster"><a href="#19-node-s-had-taints-that-the-pod-didnâ€™t-tolerate-in-kubernetes-cluster" class="headerlink" title="19.node(s) had taints that the pod didnâ€™t tolerate in kubernetes cluster"></a>19.node(s) had taints that the pod didnâ€™t tolerate in kubernetes cluster</h2><h3 id="é—®é¢˜è¯¦æƒ…ï¼šèŠ‚ç‚¹æœ‰æ±¡ç‚¹ï¼Œéœ€è¦æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€å¹¶ä¸”å·¥ä½œæ­£å¸¸"><a href="#é—®é¢˜è¯¦æƒ…ï¼šèŠ‚ç‚¹æœ‰æ±¡ç‚¹ï¼Œéœ€è¦æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€å¹¶ä¸”å·¥ä½œæ­£å¸¸" class="headerlink" title="é—®é¢˜è¯¦æƒ…ï¼šèŠ‚ç‚¹æœ‰æ±¡ç‚¹ï¼Œéœ€è¦æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€å¹¶ä¸”å·¥ä½œæ­£å¸¸"></a>é—®é¢˜è¯¦æƒ…ï¼šèŠ‚ç‚¹æœ‰æ±¡ç‚¹ï¼Œéœ€è¦æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€å¹¶ä¸”å·¥ä½œæ­£å¸¸</h3><h3 id="è§£å†³æ–¹æ³•ï¼š-5"><a href="#è§£å†³æ–¹æ³•ï¼š-5" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h3><p><code>å‚è€ƒæ–‡æ¡£ï¼šhttps://stackoverflow.com/questions/62991596/1-nodes-had-taints-that-the-pod-didnt-tolerate-in-kubernetes-cluster</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl describe node &lt;nodename&gt; | grep Taints<br><br>å½“æŸäº›æ¡ä»¶ä¸ºçœŸæ—¶ï¼ŒèŠ‚ç‚¹æ§åˆ¶å™¨ä¼šè‡ªåŠ¨æ±¡æŸ“èŠ‚ç‚¹ã€‚å†…ç½®ä»¥ä¸‹æ±¡ç‚¹ï¼š<br>node.kubernetes.io/not-ready: èŠ‚ç‚¹è¿˜æ²¡æœ‰å‡†å¤‡å¥½ã€‚è¿™å¯¹åº”äº NodeCondition Ready ä¸ºâ€œFalseâ€ã€‚<br>node.kubernetes.io/unreachableï¼šæ— æ³•ä»èŠ‚ç‚¹æ§åˆ¶å™¨è®¿é—®èŠ‚ç‚¹ã€‚è¿™å¯¹åº”äº NodeCondition Ready ä¸ºâ€œUnknownâ€ã€‚<br>node.kubernetes.io/out-of-disk: èŠ‚ç‚¹å˜å¾—ç£ç›˜ä¸è¶³ã€‚<br>node.kubernetes.io/memory-pressure: èŠ‚ç‚¹æœ‰å†…å­˜å‹åŠ›ã€‚<br>node.kubernetes.io/disk-pressure: èŠ‚ç‚¹æœ‰ç£ç›˜å‹åŠ›ã€‚<br>node.kubernetes.io/network-unavailable: èŠ‚ç‚¹çš„ç½‘ç»œä¸å¯ç”¨ã€‚<br>node.kubernetes.io/unschedulable: èŠ‚ç‚¹ä¸å¯è°ƒåº¦ã€‚<br>node.cloudprovider.kubernetes.io/uninitializedï¼šå½“ kubelet ä»¥â€œå¤–éƒ¨â€äº‘æä¾›å•†å¯åŠ¨æ—¶ï¼Œæ­¤æ±¡ç‚¹ä¼šåœ¨èŠ‚ç‚¹ä¸Šè®¾ç½®ä»¥å°†å…¶æ ‡è®°ä¸ºä¸å¯ç”¨ã€‚åœ¨æ¥è‡ª cloud-controller-manager çš„æ§åˆ¶å™¨åˆå§‹åŒ–æ­¤èŠ‚ç‚¹åï¼Œkubelet ä¼šåˆ é™¤æ­¤æ±¡ç‚¹ã€‚<br><br>é™¤ä¸Šè¿°å†…å®¹å¤–ï¼Œnode-role.kubernetes.io/master:NoScheduleé»˜è®¤æƒ…å†µä¸‹è¿˜å‘ä¸»èŠ‚ç‚¹æ·»åŠ äº†ä¸€ç§ç‰¹æ®Šçš„æ±¡ç‚¹ã€‚<br>taintå¦‚æœåœ¨ pod è§„èŒƒä¸­æ²¡æœ‰å¯¹åº”çš„èŠ‚ç‚¹ï¼Œé€šå¸¸ä¼šå‡ºç°é”™è¯¯tolerationã€‚<br><br><br><span class="hljs-comment">#æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦æœ‰æ±¡ç‚¹:</span><br>kubectl describe node &lt;nodename&gt; | grep Taints<br><span class="hljs-comment">#â€”â€”â€”â€”â€”</span><br>è¾“å‡ºï¼šTaints:   node-role.kubernetes.io/master:NoSchedule<br><br><span class="hljs-comment">#ä»èŠ‚ç‚¹ä¸­åˆ é™¤æ±¡ç‚¹ï¼Œè¿è¡Œï¼š</span><br>kubectl taint node &lt;nodename&gt; node-role.kubernetes.io/master:NoSchedule-<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>k8séƒ¨ç½²ç›¸å…³æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8så®‰è£…metrics-server</title>
    <link href="/2023/05/07/k8s/k8s%E9%83%A8%E7%BD%B2%E7%9B%B8%E5%85%B3%E6%9C%8D%E5%8A%A1/k8s%E5%AE%89%E8%A3%85metrics-server/"/>
    <url>/2023/05/07/k8s/k8s%E9%83%A8%E7%BD%B2%E7%9B%B8%E5%85%B3%E6%9C%8D%E5%8A%A1/k8s%E5%AE%89%E8%A3%85metrics-server/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="k8så®‰è£…metrics-server"><a href="#k8så®‰è£…metrics-server" class="headerlink" title="k8så®‰è£…metrics-server"></a>k8så®‰è£…metrics-server</h1><p><code>å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/lfl17718347843/p/14283796.html</code></p><h2 id="Kubernetes-Metrics-Serverè¯¦è§£ï¼š"><a href="#Kubernetes-Metrics-Serverè¯¦è§£ï¼š" class="headerlink" title="Kubernetes Metrics Serverè¯¦è§£ï¼š"></a>Kubernetes Metrics Serverè¯¦è§£ï¼š</h2><ul><li>Kubernetes Metrics Server æ˜¯ Cluster çš„æ ¸å¿ƒç›‘æ§æ•°æ®çš„èšåˆå™¨ï¼Œkubeadm é»˜è®¤æ˜¯ä¸éƒ¨ç½²çš„ã€‚</li><li>Metrics Server ä¾› Dashboard ç­‰å…¶ä»–ç»„ä»¶ä½¿ç”¨ï¼Œæ˜¯ä¸€ä¸ªæ‰©å±•çš„ APIServerï¼Œä¾èµ–äº API Aggregatorã€‚æ‰€ä»¥ï¼Œåœ¨å®‰è£… Metrics Server ä¹‹å‰éœ€è¦å…ˆåœ¨ kube-apiserver ä¸­å¼€å¯ API Aggregatorã€‚</li><li>Metrics API åªå¯ä»¥æŸ¥è¯¢å½“å‰çš„åº¦é‡æ•°æ®ï¼Œå¹¶ä¸ä¿å­˜å†å²æ•°æ®ã€‚</li><li>Metrics API URI ä¸º &#x2F;apis&#x2F;metrics.k8s.io&#x2F;ï¼Œåœ¨ k8s.io&#x2F;metrics ä¸‹ç»´æŠ¤ã€‚</li><li>å¿…é¡»éƒ¨ç½² metrics-server æ‰èƒ½ä½¿ç”¨è¯¥ APIï¼Œmetrics-server é€šè¿‡è°ƒç”¨ kubelet Summary API è·å–æ•°æ®ã€‚</li></ul><h2 id="ä¸€ã€å‰ææ¡ä»¶"><a href="#ä¸€ã€å‰ææ¡ä»¶" class="headerlink" title="ä¸€ã€å‰ææ¡ä»¶"></a>ä¸€ã€å‰ææ¡ä»¶</h2><p>æ³¨æ„ï¼šä½¿ç”¨ Metrics Server æœ‰å¿…å¤‡ä¸¤ä¸ªæ¡ä»¶ï¼š</p><h3 id="1ã€API-Server-å¯ç”¨-Aggregator-Routing-æ”¯æŒã€‚å¦åˆ™-API-Server-ä¸è¯†åˆ«è¯·æ±‚ï¼š"><a href="#1ã€API-Server-å¯ç”¨-Aggregator-Routing-æ”¯æŒã€‚å¦åˆ™-API-Server-ä¸è¯†åˆ«è¯·æ±‚ï¼š" class="headerlink" title="1ã€API Server å¯ç”¨ Aggregator Routing æ”¯æŒã€‚å¦åˆ™ API Server ä¸è¯†åˆ«è¯·æ±‚ï¼š"></a>1ã€API Server å¯ç”¨ Aggregator Routing æ”¯æŒã€‚å¦åˆ™ API Server ä¸è¯†åˆ«è¯·æ±‚ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">Error from server (ServiceUnavailable): the server is currently unable to handle the request (get pods.metrics.k8s.io)<br></code></pre></td></tr></table></figure><h3 id="2ã€API-Server-èƒ½è®¿é—®-Metrics-Server-Pod-IPã€‚å¦åˆ™-API-Server-æ— æ³•è®¿é—®-Metrics-Serverï¼š"><a href="#2ã€API-Server-èƒ½è®¿é—®-Metrics-Server-Pod-IPã€‚å¦åˆ™-API-Server-æ— æ³•è®¿é—®-Metrics-Serverï¼š" class="headerlink" title="2ã€API Server èƒ½è®¿é—® Metrics Server Pod IPã€‚å¦åˆ™ API Server æ— æ³•è®¿é—® Metrics Serverï¼š"></a>2ã€API Server èƒ½è®¿é—® Metrics Server Pod IPã€‚å¦åˆ™ API Server æ— æ³•è®¿é—® Metrics Serverï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">E1223 07:23:04.330206       1 available_controller.go:420] v1beta1.metrics.k8s.io failed with: failing or missing response from https://10.171.248.214:4443/apis/metrics.k8s.io/v1beta1: Get https://10.171.248.214:4443/apis/metrics.k8s.io/v1beta1: net/http: request canceled <span class="hljs-keyword">while</span> waiting <span class="hljs-keyword">for</span> connection (Client.Timeout exceeded <span class="hljs-keyword">while</span> awaiting headers)<br></code></pre></td></tr></table></figure><h3 id="3ã€å¯ç”¨API-Aggregatorï¼ŒAPI-Aggregation-å…è®¸åœ¨ä¸ä¿®æ”¹-Kubernetes-æ ¸å¿ƒä»£ç çš„åŒæ—¶æ‰©å±•-Kubernetes-APIï¼Œå³ï¼šå°†ç¬¬ä¸‰æ–¹æœåŠ¡æ³¨å†Œåˆ°-Kubernetes-API-ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡-Kubernetes-API-æ¥è®¿é—®ç¬¬ä¸‰æ–¹æœåŠ¡äº†ï¼Œä¾‹å¦‚ï¼šMetrics-Server-APIã€‚æ³¨ï¼šå¦å¤–ä¸€ç§æ‰©å±•-Kubernetes-API-çš„æ–¹æ³•æ˜¯ä½¿ç”¨-CRDï¼ˆCustom-Resource-Definitionï¼Œè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼‰ã€‚"><a href="#3ã€å¯ç”¨API-Aggregatorï¼ŒAPI-Aggregation-å…è®¸åœ¨ä¸ä¿®æ”¹-Kubernetes-æ ¸å¿ƒä»£ç çš„åŒæ—¶æ‰©å±•-Kubernetes-APIï¼Œå³ï¼šå°†ç¬¬ä¸‰æ–¹æœåŠ¡æ³¨å†Œåˆ°-Kubernetes-API-ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡-Kubernetes-API-æ¥è®¿é—®ç¬¬ä¸‰æ–¹æœåŠ¡äº†ï¼Œä¾‹å¦‚ï¼šMetrics-Server-APIã€‚æ³¨ï¼šå¦å¤–ä¸€ç§æ‰©å±•-Kubernetes-API-çš„æ–¹æ³•æ˜¯ä½¿ç”¨-CRDï¼ˆCustom-Resource-Definitionï¼Œè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼‰ã€‚" class="headerlink" title="3ã€å¯ç”¨API Aggregatorï¼ŒAPI Aggregation å…è®¸åœ¨ä¸ä¿®æ”¹ Kubernetes æ ¸å¿ƒä»£ç çš„åŒæ—¶æ‰©å±• Kubernetes APIï¼Œå³ï¼šå°†ç¬¬ä¸‰æ–¹æœåŠ¡æ³¨å†Œåˆ° Kubernetes API ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ Kubernetes API æ¥è®¿é—®ç¬¬ä¸‰æ–¹æœåŠ¡äº†ï¼Œä¾‹å¦‚ï¼šMetrics Server APIã€‚æ³¨ï¼šå¦å¤–ä¸€ç§æ‰©å±• Kubernetes API çš„æ–¹æ³•æ˜¯ä½¿ç”¨ CRDï¼ˆCustom Resource Definitionï¼Œè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼‰ã€‚"></a>3ã€å¯ç”¨API Aggregatorï¼ŒAPI Aggregation å…è®¸åœ¨ä¸ä¿®æ”¹ Kubernetes æ ¸å¿ƒä»£ç çš„åŒæ—¶æ‰©å±• Kubernetes APIï¼Œå³ï¼šå°†ç¬¬ä¸‰æ–¹æœåŠ¡æ³¨å†Œåˆ° Kubernetes API ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ Kubernetes API æ¥è®¿é—®ç¬¬ä¸‰æ–¹æœåŠ¡äº†ï¼Œä¾‹å¦‚ï¼šMetrics Server APIã€‚æ³¨ï¼šå¦å¤–ä¸€ç§æ‰©å±• Kubernetes API çš„æ–¹æ³•æ˜¯ä½¿ç”¨ CRDï¼ˆCustom Resource Definitionï¼Œè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼‰ã€‚</h3><h2 id="äºŒã€ä¿®æ”¹é…ç½®"><a href="#äºŒã€ä¿®æ”¹é…ç½®" class="headerlink" title="äºŒã€ä¿®æ”¹é…ç½®"></a>äºŒã€ä¿®æ”¹é…ç½®</h2><h3 id="1ã€æ£€æŸ¥-API-Server-æ˜¯å¦å¼€å¯äº†-Aggregator-Routingï¼šæŸ¥çœ‹-API-Server-æ˜¯å¦å…·æœ‰-â€“enable-aggregator-routing-x3D-true-é€‰é¡¹"><a href="#1ã€æ£€æŸ¥-API-Server-æ˜¯å¦å¼€å¯äº†-Aggregator-Routingï¼šæŸ¥çœ‹-API-Server-æ˜¯å¦å…·æœ‰-â€“enable-aggregator-routing-x3D-true-é€‰é¡¹" class="headerlink" title="1ã€æ£€æŸ¥ API Server æ˜¯å¦å¼€å¯äº† Aggregator Routingï¼šæŸ¥çœ‹ API Server æ˜¯å¦å…·æœ‰ â€“enable-aggregator-routing&#x3D;true é€‰é¡¹"></a>1ã€æ£€æŸ¥ API Server æ˜¯å¦å¼€å¯äº† Aggregator Routingï¼šæŸ¥çœ‹ API Server æ˜¯å¦å…·æœ‰ â€“enable-aggregator-routing&#x3D;true é€‰é¡¹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ps -ef | grep apiserver | grep enable-aggregator-routing<br></code></pre></td></tr></table></figure><h3 id="2ã€ä¿®æ”¹æ¯ä¸ª-API-Server-çš„-kube-apiserver-yaml-é…ç½®å¼€å¯-Aggregator-Routingï¼šä¿®æ”¹-manifests-é…ç½®å-API-Server-ä¼šè‡ªåŠ¨é‡å¯ç”Ÿæ•ˆ"><a href="#2ã€ä¿®æ”¹æ¯ä¸ª-API-Server-çš„-kube-apiserver-yaml-é…ç½®å¼€å¯-Aggregator-Routingï¼šä¿®æ”¹-manifests-é…ç½®å-API-Server-ä¼šè‡ªåŠ¨é‡å¯ç”Ÿæ•ˆ" class="headerlink" title="2ã€ä¿®æ”¹æ¯ä¸ª API Server çš„ kube-apiserver.yaml é…ç½®å¼€å¯ Aggregator Routingï¼šä¿®æ”¹ manifests é…ç½®å API Server ä¼šè‡ªåŠ¨é‡å¯ç”Ÿæ•ˆ"></a>2ã€ä¿®æ”¹æ¯ä¸ª API Server çš„ kube-apiserver.yaml é…ç½®å¼€å¯ Aggregator Routingï¼šä¿®æ”¹ manifests é…ç½®å API Server ä¼šè‡ªåŠ¨é‡å¯ç”Ÿæ•ˆ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/kubernetes/manifests/kube-apiserver.yaml<br><br><span class="hljs-comment">#...å·²çœç•¥</span><br>spec:<br>  containers:<br>  - <span class="hljs-built_in">command</span>:<br>    - kube-apiserver<br>    - --advertise-address=192.168.200.3<br>    - --allow-privileged=<span class="hljs-literal">true</span><br>    - --authorization-mode=Node,RBAC<br>    - --client-ca-file=/etc/kubernetes/pki/ca.crt<br>    - --enable-admission-plugins=NodeRestriction<br>    - --enable-bootstrap-token-auth=<span class="hljs-literal">true</span><br>    <span class="hljs-comment">#æ·»åŠ :enable-aggregator-routing=true</span><br>    - --enable-aggregator-routing=<span class="hljs-literal">true</span><br>    - --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt<br>    - --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt<br>    - --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key<br>    - --etcd-servers=https://127.0.0.1:2379<br><span class="hljs-comment">#...å·²çœç•¥</span><br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€å®‰è£…"><a href="#ä¸‰ã€å®‰è£…" class="headerlink" title="ä¸‰ã€å®‰è£…"></a>ä¸‰ã€å®‰è£…</h2><h3 id="1ã€ä¸‹è½½yamlæ–‡ä»¶"><a href="#1ã€ä¸‹è½½yamlæ–‡ä»¶" class="headerlink" title="1ã€ä¸‹è½½yamlæ–‡ä»¶"></a>1ã€ä¸‹è½½yamlæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">githubåœ°å€ï¼šhttps://github.com/kubernetes-sigs/metrics-server/releases<br><br>wget https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.6.2/components.yaml<br></code></pre></td></tr></table></figure><h3 id="2ã€ä¿®æ”¹components-yamlæ–‡ä»¶å¹¶å¯åŠ¨"><a href="#2ã€ä¿®æ”¹components-yamlæ–‡ä»¶å¹¶å¯åŠ¨" class="headerlink" title="2ã€ä¿®æ”¹components.yamlæ–‡ä»¶å¹¶å¯åŠ¨"></a>2ã€ä¿®æ”¹components.yamlæ–‡ä»¶å¹¶å¯åŠ¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim components.yaml<br><br><span class="hljs-comment">##çœç•¥</span><br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  labels:<br>    k8s-app: metrics-server<br>  name: metrics-server<br>  namespace: kube-system<br>spec:<br>  selector:<br>    matchLabels:<br>      k8s-app: metrics-server<br>  strategy:<br>    rollingUpdate:<br>      maxUnavailable: 0<br>  template:<br>    metadata:<br>      labels:<br>        k8s-app: metrics-server<br>    spec:<br>      containers:<br>      - args:<br>        - --cert-dir=/tmp<br>        - --secure-port=4443<br>        - --kubelet-preferred-address-types=InternalIP <span class="hljs-comment">#åˆ æ‰ ExternalIP,Hostname</span><br>        - --kubelet-use-node-status-port<br>        - --kubelet-insecure-tls                   <span class="hljs-comment"># åŠ ä¸Šè¯¥å¯åŠ¨å‚æ•°</span><br>        - --metric-resolution=15s<br>        image: k8s.gcr.io/metrics-server/metrics-server:v0.4.1  <span class="hljs-comment"># é•œåƒåœ°å€æ ¹æ®æƒ…å†µä¿®æ”¹</span><br>        imagePullPolicy: IfNotPresent<br>        livenessProbe:<br>          failureThreshold: 3<br><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl apply -f components.yaml<br><br><br><span class="hljs-comment">#æŸ¥çœ‹metrics-serveræœåŠ¡çŠ¶æ€</span><br>kubectl get pod -n kube-system | grep metrics-server<br><br><span class="hljs-comment">#æ£€æŸ¥ API Server æ˜¯å¦å¯ä»¥è¿é€š Metrics Server</span><br>kubectl describe svc metrics-server -n kube-system<br>è¾“å‡ºï¼š<br><span class="hljs-comment">#...çœç•¥</span><br>Endpoints:         10.244.0.7:4443<br><span class="hljs-comment">#...</span><br><br><span class="hljs-comment">#åœ¨å…¶ä»–å‡ ä¸ªèŠ‚ç‚¹pingä¸€ä¸‹Endpointsçš„åœ°å€</span><br>ping 10.244.0.7<br></code></pre></td></tr></table></figure><h3 id="3ã€éªŒè¯å’Œæ£€æŸ¥"><a href="#3ã€éªŒè¯å’Œæ£€æŸ¥" class="headerlink" title="3ã€éªŒè¯å’Œæ£€æŸ¥"></a>3ã€éªŒè¯å’Œæ£€æŸ¥</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl top nodes<br><br><br>kubectl top pods -A<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>k8séƒ¨ç½²ç›¸å…³æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kubeadméƒ¨ç½²é«˜å¯ç”¨k8sé›†ç¾¤</title>
    <link href="/2023/05/06/k8s/k8s%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/kubeadm%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8k8s%E9%9B%86%E7%BE%A4/"/>
    <url>/2023/05/06/k8s/k8s%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/kubeadm%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8k8s%E9%9B%86%E7%BE%A4/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="kubeadméƒ¨ç½²é«˜å¯ç”¨k8sé›†ç¾¤"><a href="#kubeadméƒ¨ç½²é«˜å¯ç”¨k8sé›†ç¾¤" class="headerlink" title="kubeadméƒ¨ç½²é«˜å¯ç”¨k8sé›†ç¾¤"></a>kubeadméƒ¨ç½²é«˜å¯ç”¨k8sé›†ç¾¤</h1><p><code>å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/lfl17718347843/p/13417304.html</code></p><h2 id="å‰è¨€ï¼šHAçš„ä¸¤ç§éƒ¨ç½²æ¨¡å¼ï¼š"><a href="#å‰è¨€ï¼šHAçš„ä¸¤ç§éƒ¨ç½²æ¨¡å¼ï¼š" class="headerlink" title="å‰è¨€ï¼šHAçš„ä¸¤ç§éƒ¨ç½²æ¨¡å¼ï¼š"></a>å‰è¨€ï¼šHAçš„ä¸¤ç§éƒ¨ç½²æ¨¡å¼ï¼š</h2><h3 id="1-å°†ETCDä¸MasterèŠ‚ç‚¹ç»„ä»¶æ··åˆéƒ¨ç½²åœ¨ä¸€èµ·"><a href="#1-å°†ETCDä¸MasterèŠ‚ç‚¹ç»„ä»¶æ··åˆéƒ¨ç½²åœ¨ä¸€èµ·" class="headerlink" title="1.å°†ETCDä¸MasterèŠ‚ç‚¹ç»„ä»¶æ··åˆéƒ¨ç½²åœ¨ä¸€èµ·"></a>1.å°†ETCDä¸MasterèŠ‚ç‚¹ç»„ä»¶æ··åˆéƒ¨ç½²åœ¨ä¸€èµ·</h3><p><img src="/2023/05/06/k8s/k8s%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/kubeadm%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8k8s%E9%9B%86%E7%BE%A4/1805318-20200802132335968-769331513.png" alt="img"></p><h3 id="2-ä½¿ç”¨ç‹¬ç«‹çš„ETCDé›†ç¾¤ï¼Œä¸ä¸MasterèŠ‚ç‚¹æ··åˆéƒ¨ç½²"><a href="#2-ä½¿ç”¨ç‹¬ç«‹çš„ETCDé›†ç¾¤ï¼Œä¸ä¸MasterèŠ‚ç‚¹æ··åˆéƒ¨ç½²" class="headerlink" title="2.ä½¿ç”¨ç‹¬ç«‹çš„ETCDé›†ç¾¤ï¼Œä¸ä¸MasterèŠ‚ç‚¹æ··åˆéƒ¨ç½²"></a>2.ä½¿ç”¨ç‹¬ç«‹çš„ETCDé›†ç¾¤ï¼Œä¸ä¸MasterèŠ‚ç‚¹æ··åˆéƒ¨ç½²</h3><p><img src="/2023/05/06/k8s/k8s%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/kubeadm%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8k8s%E9%9B%86%E7%BE%A4/1805318-20200802132415654-1821383240.png" alt="img"></p><p><strong>ä»¥ä¸‹é‡‡ç”¨ï¼ˆæ–¹å¼1.ï¼‰æ··åˆéƒ¨ç½²å®‰è£…ï¼</strong></p><h2 id="ä¸€ã€ç¯å¢ƒå‡†å¤‡"><a href="#ä¸€ã€ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ä¸€ã€ç¯å¢ƒå‡†å¤‡"></a>ä¸€ã€ç¯å¢ƒå‡†å¤‡</h2><p><strong>é€šè¿‡kubeadmæ­å»ºä¸€ä¸ªé«˜å¯ç”¨çš„k8sé›†ç¾¤ï¼Œkubeadmå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„æ­å»ºk8sé›†ç¾¤ï¼Œé«˜å¯ç”¨ä¸»è¦ä½“ç°åœ¨å¯¹masterèŠ‚ç‚¹ç»„ä»¶åŠetcdå­˜å‚¨çš„é«˜å¯ç”¨</strong></p><table><thead><tr><th>IPåœ°å€</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>192.168.62.128</td><td>master1 + etcd</td></tr><tr><td>192.168.62.129</td><td>master2 + etcd</td></tr><tr><td>192.168.62.130</td><td>master3 + etcd</td></tr><tr><td>192.168.94.123</td><td>è´Ÿè½½å‡è¡¡VIP</td></tr><tr><td>192.168.62.131</td><td>node1</td></tr></tbody></table><h2 id="äºŒã€æœºå™¨åˆå§‹åŒ–"><a href="#äºŒã€æœºå™¨åˆå§‹åŒ–" class="headerlink" title="äºŒã€æœºå™¨åˆå§‹åŒ–"></a>äºŒã€æœºå™¨åˆå§‹åŒ–</h2><h3 id="1-ä¿®æ”¹ä¸»æœºåã€å…³é—­é˜²ç«å¢™ã€selinuxã€å…³é—­swapåˆ†åŒºã€æ—¶é—´åŒæ­¥ã€è®¾ç½®hostsæ–‡ä»¶ç­‰"><a href="#1-ä¿®æ”¹ä¸»æœºåã€å…³é—­é˜²ç«å¢™ã€selinuxã€å…³é—­swapåˆ†åŒºã€æ—¶é—´åŒæ­¥ã€è®¾ç½®hostsæ–‡ä»¶ç­‰" class="headerlink" title="1.ä¿®æ”¹ä¸»æœºåã€å…³é—­é˜²ç«å¢™ã€selinuxã€å…³é—­swapåˆ†åŒºã€æ—¶é—´åŒæ­¥ã€è®¾ç½®hostsæ–‡ä»¶ç­‰"></a>1.ä¿®æ”¹ä¸»æœºåã€å…³é—­é˜²ç«å¢™ã€selinuxã€å…³é—­swapåˆ†åŒºã€æ—¶é—´åŒæ­¥ã€è®¾ç½®hostsæ–‡ä»¶ç­‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¿®æ”¹ä¸»æœºå</span><br>hostnamectl set-hostname master1<br><br><span class="hljs-comment">#å…³é—­é˜²ç«å¢™å’Œselinux</span><br>systemctl stop firewalld &amp;&amp; systemctl <span class="hljs-built_in">disable</span> firewalld<br><br><span class="hljs-comment">#å…³é—­SELiunxå’Œswapåˆ†åŒº</span><br>swapoff -a &amp;&amp; sed -i <span class="hljs-string">&#x27;/ swap / s/^\(.*\)$/#\1/g&#x27;</span> /etc/fstab<br>setenforce 0 &amp;&amp; sed -i <span class="hljs-string">&#x27;s/^SELINUX=.*/SELINUX=disabled/&#x27;</span> /etc/selinux/config<br><br><span class="hljs-comment">#è®¾ç½®æ—¶é—´åŒæ­¥</span><br>yum install ntpd -y<br>ntpdate cn.pool.ntp.org<br><span class="hljs-comment">#è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œè‡ªåŠ¨åŒæ­¥æ—¶é—´</span><br>crontab -e<br>*/15 * * * * /usr/sbin/ntpdate -u pool.ntp.org &gt;/dev/null 2&gt;&amp;1<br><br><span class="hljs-comment">#æ·»åŠ hostsæ–‡ä»¶</span><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">192.168.62.128  master1</span><br><span class="hljs-string">192.168.62.129  master2</span><br><span class="hljs-string">192.168.62.130  master3</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment">#è®¾ç½®å…å¯†ç™»å½•ï¼ˆå¯åšå¯ä¸åšï¼Œæˆ‘åªæ˜¯ä¸ºäº†æ–¹ä¾¿æ“ä½œï¼‰</span><br>ssh-keygen  <span class="hljs-comment">#ä¸€è·¯å›è½¦å³å¯</span><br>ssh-copy-id master2<br>ssh-copy-id master3<br></code></pre></td></tr></table></figure><h3 id="2-å†…æ ¸ä¼˜åŒ–ã€å¼€å¯IPVSã€è®¾ç½®k8s-confç³»ç»Ÿå‚æ•°"><a href="#2-å†…æ ¸ä¼˜åŒ–ã€å¼€å¯IPVSã€è®¾ç½®k8s-confç³»ç»Ÿå‚æ•°" class="headerlink" title="2.å†…æ ¸ä¼˜åŒ–ã€å¼€å¯IPVSã€è®¾ç½®k8s.confç³»ç»Ÿå‚æ•°"></a>2.å†…æ ¸ä¼˜åŒ–ã€å¼€å¯IPVSã€è®¾ç½®k8s.confç³»ç»Ÿå‚æ•°</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å†…æ ¸ä¼˜åŒ–</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt;  /etc/sysctl.d/k8s.conf</span><br><span class="hljs-string">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="hljs-string">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="hljs-string">EOF</span><br><br>sysctl --system<br><br><span class="hljs-comment">#å¼€å¯IPVS</span><br><span class="hljs-built_in">cat</span> &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">#!/bin/bash</span><br><span class="hljs-string">ipvs_modules=&quot;ip_vs ip_vs_lc ip_vs_wlc ip_vs_rr ip_vs_wrr ip_vs_lblc ip_vs_lblcr ip_vs_dh ip_vs_sh ip_vs_fo ip_vs_nq ip_vs_sed ip_vs_ftp nf_conntrack&quot;</span><br><span class="hljs-string">for kernel_module in \$&#123;ipvs_modules&#125;; </span><br><span class="hljs-string">do </span><br><span class="hljs-string">/sbin/modinfo -F filename \$&#123;kernel_module&#125; &gt; /dev/null 2&gt;&amp;1 </span><br><span class="hljs-string">if [ $? -eq 0 ]; then </span><br><span class="hljs-string">/sbin/modprobe \$&#123;kernel_module&#125; </span><br><span class="hljs-string">fi </span><br><span class="hljs-string">done</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-built_in">chmod</span> 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep ip_vs <br><br><span class="hljs-comment">#æ‰€æœ‰æœºå™¨éœ€è¦è®¾å®š/etc/sysctl.d/k8s.confçš„ç³»ç»Ÿå‚æ•° </span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/sysctl.d/k8s.conf </span><br><span class="hljs-string">net.ipv4.tcp_keepalive_time = 600</span><br><span class="hljs-string">net.ipv4.tcp_keepalive_intvl = 30 </span><br><span class="hljs-string">net.ipv4.tcp_keepalive_probes = 10 </span><br><span class="hljs-string">net.ipv6.conf.all.disable_ipv6 = 1 </span><br><span class="hljs-string">net.ipv6.conf.default.disable_ipv6 = 1 </span><br><span class="hljs-string">net.ipv6.conf.lo.disable_ipv6 = 1 </span><br><span class="hljs-string">net.ipv4.neigh.default.gc_stale_time = 120 </span><br><span class="hljs-string">net.ipv4.conf.all.rp_filter = 0 </span><br><span class="hljs-string">net.ipv4.conf.default.rp_filter = 0 </span><br><span class="hljs-string">net.ipv4.conf.default.arp_announce = 2 </span><br><span class="hljs-string">net.ipv4.conf.lo.arp_announce = 2 </span><br><span class="hljs-string">net.ipv4.conf.all.arp_announce = 2</span><br><span class="hljs-string">net.ipv4.ip_forward = 1 </span><br><span class="hljs-string">net.ipv4.tcp_max_tw_buckets = 5000 </span><br><span class="hljs-string">net.ipv4.tcp_syncookies = 1 </span><br><span class="hljs-string">net.ipv4.tcp_max_syn_backlog = 1024 </span><br><span class="hljs-string">net.ipv4.tcp_synack_retries = 2 </span><br><span class="hljs-string">net.bridge.bridge-nf-call-ip6tables = 1 </span><br><span class="hljs-string">net.bridge.bridge-nf-call-iptables = 1 </span><br><span class="hljs-string">net.netfilter.nf_conntrack_max = 2310720 </span><br><span class="hljs-string">fs.inotify.max_user_watches=89100 </span><br><span class="hljs-string">fs.may_detach_mounts = 1 </span><br><span class="hljs-string">fs.file-max = 52706963 </span><br><span class="hljs-string">fs.nr_open = 52706963 </span><br><span class="hljs-string">net.bridge.bridge-nf-call-arptables = 1 </span><br><span class="hljs-string">vm.swappiness = 0 </span><br><span class="hljs-string">vm.overcommit_memory=1 </span><br><span class="hljs-string">vm.panic_on_oom=0</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€å®‰è£…è¿‡ç¨‹"><a href="#ä¸‰ã€å®‰è£…è¿‡ç¨‹" class="headerlink" title="ä¸‰ã€å®‰è£…è¿‡ç¨‹"></a>ä¸‰ã€å®‰è£…è¿‡ç¨‹</h2><h3 id="1-å®‰è£…haproxyä»¥åŠkeepalivedæœåŠ¡ï¼ˆMasterèŠ‚ç‚¹å®‰è£…ï¼‰"><a href="#1-å®‰è£…haproxyä»¥åŠkeepalivedæœåŠ¡ï¼ˆMasterèŠ‚ç‚¹å®‰è£…ï¼‰" class="headerlink" title="1.å®‰è£…haproxyä»¥åŠkeepalivedæœåŠ¡ï¼ˆMasterèŠ‚ç‚¹å®‰è£…ï¼‰"></a>1.å®‰è£…haproxyä»¥åŠkeepalivedæœåŠ¡ï¼ˆMasterèŠ‚ç‚¹å®‰è£…ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install keepalived haproxy -y<br></code></pre></td></tr></table></figure><h3 id="2-ä¿®æ”¹Master1èŠ‚ç‚¹keepalivedé…ç½®æ–‡ä»¶-å…¶ä»–ä¸¤ä¸ªmasterèŠ‚ç‚¹åªä¿®æ”¹æƒé‡ï¼ŒæŠŠmasteræ”¹æˆbackup"><a href="#2-ä¿®æ”¹Master1èŠ‚ç‚¹keepalivedé…ç½®æ–‡ä»¶-å…¶ä»–ä¸¤ä¸ªmasterèŠ‚ç‚¹åªä¿®æ”¹æƒé‡ï¼ŒæŠŠmasteræ”¹æˆbackup" class="headerlink" title="2.ä¿®æ”¹Master1èŠ‚ç‚¹keepalivedé…ç½®æ–‡ä»¶(å…¶ä»–ä¸¤ä¸ªmasterèŠ‚ç‚¹åªä¿®æ”¹æƒé‡ï¼ŒæŠŠmasteræ”¹æˆbackup)"></a>2.ä¿®æ”¹Master1èŠ‚ç‚¹keepalivedé…ç½®æ–‡ä»¶(å…¶ä»–ä¸¤ä¸ªmasterèŠ‚ç‚¹åªä¿®æ”¹æƒé‡ï¼ŒæŠŠmasteræ”¹æˆbackup)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/keepalived/keepalived.conf<br><br>! Configuration File <span class="hljs-keyword">for</span> keepalived<br><br>global_defs &#123;<br>   router_id LVS_DEVEL<br><br>   <span class="hljs-comment">#æŒ‡å®šè¿è¡Œè„šæœ¬çš„ç”¨æˆ·å</span><br>   script_user root<br>   enable_script_security<br>&#125;<br>vrrp_script check_haproxy &#123;<br>    script <span class="hljs-string">&quot;/etc/keepalived/check_haproxy.sh&quot;</span>         <span class="hljs-comment"># æ£€æµ‹è„šæœ¬è·¯å¾„</span><br>    interval 3<br>    weight -2<br>    fall 10<br>    rise 2<br>&#125;<br><br>vrrp_instance VI_1 &#123;<br>    state MASTER <span class="hljs-comment">#å…¶ä»–ä¸¤ä¸ªmasterèŠ‚ç‚¹åªä¿®æ”¹æƒé‡ï¼ŒæŠŠmasteræ”¹æˆbackup</span><br>    <span class="hljs-comment">#éæŠ¢å æ¨¡å¼</span><br>    nopreempt<br>    interface ens33 <span class="hljs-comment">#ç½‘å¡å</span><br>    virtual_router_id 51<br>    priority 100 <span class="hljs-comment">#æƒé‡ï¼Œå…¶ä»–çš„è¦æ¯”ä»–å°</span><br>    advert_int 1 <br>    authentication &#123;<br>        auth_type PASS<br>        auth_pass 1111<br>    &#125;<br>    virtual_ipaddress &#123;<br>        192.168.62.123 <span class="hljs-comment">#è™šæ‹Ÿip</span><br>    &#125;<br>    track_script &#123;<br>       chech_haproxy <span class="hljs-comment">#æ¨¡å—</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="3-ä¸‰å°masterèŠ‚ç‚¹haproxyé…ç½®ä¸€æ ·"><a href="#3-ä¸‰å°masterèŠ‚ç‚¹haproxyé…ç½®ä¸€æ ·" class="headerlink" title="3.ä¸‰å°masterèŠ‚ç‚¹haproxyé…ç½®ä¸€æ ·"></a>3.ä¸‰å°masterèŠ‚ç‚¹haproxyé…ç½®ä¸€æ ·</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> /etc/haproxy/haproxy.cfg<br><span class="hljs-comment">#---------------------------------------------------------------------</span><br><span class="hljs-comment"># Global settings</span><br><span class="hljs-comment">#---------------------------------------------------------------------</span><br>global<br>    <span class="hljs-comment"># to have these messages end up in /var/log/haproxy.log you will</span><br>    <span class="hljs-comment"># need to:</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># 1) configure syslog to accept network log events.  This is done</span><br>    <span class="hljs-comment">#    by adding the &#x27;-r&#x27; option to the SYSLOGD_OPTIONS in</span><br>    <span class="hljs-comment">#    /etc/sysconfig/syslog</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># 2) configure local2 events to go to the /var/log/haproxy.log</span><br>    <span class="hljs-comment">#   file. A line like the following can be added to</span><br>    <span class="hljs-comment">#   /etc/sysconfig/syslog</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment">#    local2.*                       /var/log/haproxy.log</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-built_in">log</span>         127.0.0.1 local2<br><br>    <span class="hljs-built_in">chroot</span>      /var/lib/haproxy<br>    pidfile     /var/run/haproxy.pid<br>    maxconn     4000<br>    user        haproxy<br>    group       haproxy<br>    daemon<br><br>    <span class="hljs-comment"># turn on stats unix socket</span><br>    stats socket /var/lib/haproxy/stats<br><br><span class="hljs-comment">#---------------------------------------------------------------------</span><br><span class="hljs-comment"># common defaults that all the &#x27;listen&#x27; and &#x27;backend&#x27; sections will</span><br><span class="hljs-comment"># use if not designated in their block</span><br><span class="hljs-comment">#---------------------------------------------------------------------</span><br>defaults<br>    mode                    http<br>    <span class="hljs-built_in">log</span>                     global<br>    option                  httplog<br>    option                  dontlognull<br>    option http-server-close<br>    option forwardfor       except 127.0.0.0/8<br>    option                  redispatch<br>    retries                 3<br>    <span class="hljs-built_in">timeout</span> http-request    10s<br>    <span class="hljs-built_in">timeout</span> queue           1m<br>    <span class="hljs-built_in">timeout</span> connect         10s<br>    <span class="hljs-built_in">timeout</span> client          1m<br>    <span class="hljs-built_in">timeout</span> server          1m<br>    <span class="hljs-built_in">timeout</span> http-keep-alive 10s<br>    <span class="hljs-built_in">timeout</span> check           10s<br>    maxconn                 3000<br><br><span class="hljs-comment">#---------------------------------------------------------------------</span><br><span class="hljs-comment"># main frontend which proxys to the backends</span><br><span class="hljs-comment">#---------------------------------------------------------------------</span><br>frontend  kubernetes-apiserver<br>    mode tcp<br>    <span class="hljs-built_in">bind</span> *:16443<br>    optiontcplog<br>    default_backend             kubernetes-apiserver<br><br><span class="hljs-comment">#---------------------------------------------------------------------</span><br><span class="hljs-comment"># round robin balancing between the various backends</span><br><span class="hljs-comment">#---------------------------------------------------------------------</span><br>backend kubernetes-apiserver<br>    mode tcp<br>    balance     roundrobin<br>    server  master1 192.168.62.128:6443 check<br>    server  master2 192.168.62.129:6443 check<br>    server  master3 192.168.62.130:6443 check<br></code></pre></td></tr></table></figure><h3 id="4-ç¼–å†™å¥åº·æ£€æµ‹è„šæœ¬ï¼ˆå„masteræœºå™¨ï¼‰-æ·»åŠ æ‰§è¡Œæƒé™ï¼Œå¹¶å¯åŠ¨keepalivedå’ŒhaproxyæœåŠ¡"><a href="#4-ç¼–å†™å¥åº·æ£€æµ‹è„šæœ¬ï¼ˆå„masteræœºå™¨ï¼‰-æ·»åŠ æ‰§è¡Œæƒé™ï¼Œå¹¶å¯åŠ¨keepalivedå’ŒhaproxyæœåŠ¡" class="headerlink" title="4.ç¼–å†™å¥åº·æ£€æµ‹è„šæœ¬ï¼ˆå„masteræœºå™¨ï¼‰,æ·»åŠ æ‰§è¡Œæƒé™ï¼Œå¹¶å¯åŠ¨keepalivedå’ŒhaproxyæœåŠ¡"></a>4.ç¼–å†™å¥åº·æ£€æµ‹è„šæœ¬ï¼ˆå„masteræœºå™¨ï¼‰,æ·»åŠ æ‰§è¡Œæƒé™ï¼Œå¹¶å¯åŠ¨keepalivedå’ŒhaproxyæœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> /etc/keepalived/check_haproxy.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># HAPROXY down</span><br><br>A=`ps -C haproxy --no-header | <span class="hljs-built_in">wc</span> -l`<br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$A</span> -eq 0 ]<br><span class="hljs-keyword">then</span><br>   systmectl start haproxy<br><br><span class="hljs-comment">#å¦‚æœè¿˜æ˜¯æ— æ³•å¯åŠ¨</span><br><span class="hljs-keyword">if</span> [ ps -C haproxy --no-header | <span class="hljs-built_in">wc</span> -l -eq 0 ]<br><span class="hljs-keyword">then</span><br>   killall -9 haproxy<br>   <span class="hljs-comment">#echo &quot;HAPROXY down&quot; | mail -s &quot;haproxy&quot;</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;`date +&#x27;%Yå¹´%mæœˆ%dæ—¥%Hæ—¶%Måˆ†%Sç§’&#x27;: `HAPROXY down&quot;</span> &gt;&gt; ./error.log<br>   <span class="hljs-built_in">sleep</span> 3600<br><span class="hljs-keyword">fi</span> <br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">#æ·»åŠ æ‰§è¡Œæƒé™</span><br><span class="hljs-built_in">chmod</span> +x /etc/keepalived/check_haproxy.sh<br><br><span class="hljs-comment">#å¯åŠ¨keepalivedå’ŒhaproxyæœåŠ¡</span><br>systemctl <span class="hljs-built_in">enable</span> keepalived &amp;&amp; systemctl start keepalived &amp;&amp; systemctl status keepalived<br>systemctl <span class="hljs-built_in">enable</span> haproxy &amp;&amp; systemctl start haproxy &amp;&amp; systemctl status haproxy<br></code></pre></td></tr></table></figure><h3 id="5-ä¸‹è½½å¹¶å®‰è£…docker"><a href="#5-ä¸‹è½½å¹¶å®‰è£…docker" class="headerlink" title="5.ä¸‹è½½å¹¶å®‰è£…docker"></a>5.ä¸‹è½½å¹¶å®‰è£…docker</h3><h4 id="5-1ã€å¸è½½æ—§ç‰ˆæœ¬docker"><a href="#5-1ã€å¸è½½æ—§ç‰ˆæœ¬docker" class="headerlink" title="5.1ã€å¸è½½æ—§ç‰ˆæœ¬docker"></a>5.1ã€å¸è½½æ—§ç‰ˆæœ¬docker</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum remove -y docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine docker-selinux docker-ce<br></code></pre></td></tr></table></figure><h4 id="5-2ã€å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·"><a href="#5-2ã€å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·" class="headerlink" title="5.2ã€å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·"></a>5.2ã€å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y yum-utils device-mapper-persistent-data lvm2<br></code></pre></td></tr></table></figure><h4 id="5-3ã€æ·»åŠ è½¯ä»¶æºä¿¡æ¯-ä¿®æ”¹dockerçš„yumæºä¸ºé˜¿é‡Œæº"><a href="#5-3ã€æ·»åŠ è½¯ä»¶æºä¿¡æ¯-ä¿®æ”¹dockerçš„yumæºä¸ºé˜¿é‡Œæº" class="headerlink" title="5.3ã€æ·»åŠ è½¯ä»¶æºä¿¡æ¯ ä¿®æ”¹dockerçš„yumæºä¸ºé˜¿é‡Œæº"></a>5.3ã€æ·»åŠ è½¯ä»¶æºä¿¡æ¯ ä¿®æ”¹dockerçš„yumæºä¸ºé˜¿é‡Œæº</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br><span class="hljs-comment">#æˆ–è€…</span><br>wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo<br></code></pre></td></tr></table></figure><h4 id="5-4ã€æ›´æ–°å¹¶å®‰è£…-Docker-CE"><a href="#5-4ã€æ›´æ–°å¹¶å®‰è£…-Docker-CE" class="headerlink" title="5.4ã€æ›´æ–°å¹¶å®‰è£… Docker-CE"></a>5.4ã€æ›´æ–°å¹¶å®‰è£… Docker-CE</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum makecache fast<br>yum -y install docker-ce<br><span class="hljs-comment">#yum -y install docker-ce-18.09.6-3.el7</span><br><span class="hljs-built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span><br><span class="hljs-string">  &quot;log-driver&quot;: &quot;json-file&quot;,</span><br><span class="hljs-string">  &quot;log-opts&quot;: &#123;</span><br><span class="hljs-string">    &quot;max-size&quot;: &quot;100m&quot;,</span><br><span class="hljs-string">    &quot;max-file&quot;: &quot;5&quot; </span><br><span class="hljs-string">  &#125;,</span><br><span class="hljs-string">  &quot;storage-driver&quot;: &quot;overlay2&quot;,</span><br><span class="hljs-string">  &quot;storage-opts&quot;: [</span><br><span class="hljs-string">    &quot;overlay2.override_kernel_check=true&quot;</span><br><span class="hljs-string">  ]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><br></code></pre></td></tr></table></figure><h4 id="5-5ã€é‡å¯dockerï¼Œä½¿ä¹‹ç”Ÿæ•ˆ"><a href="#5-5ã€é‡å¯dockerï¼Œä½¿ä¹‹ç”Ÿæ•ˆ" class="headerlink" title="5.5ã€é‡å¯dockerï¼Œä½¿ä¹‹ç”Ÿæ•ˆ"></a>5.5ã€é‡å¯dockerï¼Œä½¿ä¹‹ç”Ÿæ•ˆ</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart docker<br><br>docker info | grep Cgroup<br><span class="hljs-comment"># Cgroup Driver: systemd k8séœ€è¦ä½¿ç”¨systemdé©±åŠ¨</span><br></code></pre></td></tr></table></figure><h3 id="6-é…ç½®å„èŠ‚ç‚¹k8s-yumæº"><a href="#6-é…ç½®å„èŠ‚ç‚¹k8s-yumæº" class="headerlink" title="6.é…ç½®å„èŠ‚ç‚¹k8s yumæº"></a>6.é…ç½®å„èŠ‚ç‚¹k8s yumæº</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="hljs-string">[kubernetes] </span><br><span class="hljs-string">name=Kubernetes</span><br><span class="hljs-string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">gpgcheck=1</span><br><span class="hljs-string">repo_gpgcheck=1</span><br><span class="hljs-string">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h3 id="7-æ¯ä¸ªèŠ‚ç‚¹å®‰è£…kubeadmã€kubeletã€å’Œkubectl"><a href="#7-æ¯ä¸ªèŠ‚ç‚¹å®‰è£…kubeadmã€kubeletã€å’Œkubectl" class="headerlink" title="7.æ¯ä¸ªèŠ‚ç‚¹å®‰è£…kubeadmã€kubeletã€å’Œkubectl"></a>7.æ¯ä¸ªèŠ‚ç‚¹å®‰è£…kubeadmã€kubeletã€å’Œkubectl</h3><p><strong>å®‰è£…çš„æœåŠ¡ç‰ˆæœ¬éœ€è¦ä¸€è‡´</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install kubeadm-1.21.1 kubectl-1.21.1 kubelet-1.21.1 -y<br><br>systemctl <span class="hljs-built_in">enable</span> kubelet &amp;&amp; systemctl daemon-reload <br></code></pre></td></tr></table></figure><h3 id="8-è·å–é»˜è®¤é…ç½®æ–‡ä»¶"><a href="#8-è·å–é»˜è®¤é…ç½®æ–‡ä»¶" class="headerlink" title="8.è·å–é»˜è®¤é…ç½®æ–‡ä»¶"></a>8.è·å–é»˜è®¤é…ç½®æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm config <span class="hljs-built_in">print</span> init-defaults &gt; kubeadm-config.yaml<br></code></pre></td></tr></table></figure><h3 id="9-ä¿®æ”¹åˆå§‹åŒ–é…ç½®æ–‡ä»¶"><a href="#9-ä¿®æ”¹åˆå§‹åŒ–é…ç½®æ–‡ä»¶" class="headerlink" title="9.ä¿®æ”¹åˆå§‹åŒ–é…ç½®æ–‡ä»¶"></a>9.ä¿®æ”¹åˆå§‹åŒ–é…ç½®æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> kubeadm-config.yaml<br><br>apiServer:<br>  certSANs:<br>    - master1<br>    - master2<br>    - master3<br>    - master.k8s.io <span class="hljs-comment">#è®¾ç½®çš„ç›¸å…³è°ƒç”¨åŸŸåï¼Œä¸hostsæ–‡ä»¶å†…å®šä¹‰ä¸€è‡´</span><br>    - 192.168.62.123<br>    - 192.168.62.128<br>    - 192.168.62.129<br>    - 192.168.62.130<br>    - 127.0.0.1<br>  extraArgs:<br>    authorization-mode: Node,RBAC<br>  timeoutForControlPlane: 4m0s<br>apiVersion: kubeadm.k8s.io/v1beta2<br>certificatesDir: /etc/kubernetes/pki<br>clusterName: kubernetes<br>controlPlaneEndpoint: <span class="hljs-string">&quot;master.k8s.io:16443&quot;</span><br>controllerManager: &#123;&#125;<br>dns:<br>  <span class="hljs-built_in">type</span>: CoreDNS<br>etcd:<br>  <span class="hljs-built_in">local</span>:<br>    dataDir: /var/lib/etcd<br>imageRepository: k8s.gcr.io<br>kind: ClusterConfiguration<br>kubernetesVersion: v1.21.0<br>networking:<br>  dnsDomain: cluster.local<br>  podSubnet: 10.244.0.0/16<br>  serviceSubnet: 10.1.0.0/16<br>scheduler: &#123;&#125;<br><br><br><span class="hljs-comment">#---</span><br><span class="hljs-comment">#apiVersion: kubeproxy.config.k8s.io/v1alpha1</span><br><span class="hljs-comment">#kind: KubeProxyConfiguration</span><br><span class="hljs-comment">#featureGates:</span><br><span class="hljs-comment">#  SupportIPVSProxyMode: true</span><br><span class="hljs-comment">#mode: ipvs</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šyamlæ–‡ä»¶å†…æ³¨é‡Šçš„å†…å®¹éœ€è¦åˆ é™¤</strong></p><h3 id="10-ä¸‹è½½ç›¸å…³é•œåƒ"><a href="#10-ä¸‹è½½ç›¸å…³é•œåƒ" class="headerlink" title="10.ä¸‹è½½ç›¸å…³é•œåƒ"></a>10.ä¸‹è½½ç›¸å…³é•œåƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm config images pull --config kubeadm-config.yaml<br><br>å›½å†…ä¸‹è½½æ—¶å¦‚æœæç¤ºï¼šError response from daemon: manifest <span class="hljs-keyword">for</span> registry.aliyuncs.com/google_containers/coredns:v1.8.4 not found: manifest unknown: manifest unknown, error: <span class="hljs-built_in">exit</span> status 1 To see the stack trace of this error execute with --v=5 or higher<br><br><span class="hljs-comment">#éœ€ä¸‹è½½corednsï¼š1.8.4 å¹¶ä¿®æ”¹tagåŒ…ï¼š</span><br>docker pull coredns/coredns:1.8.4<br>docker tag coredns/coredns:1.8.4 registry.aliyuncs.com/google_containers/coredns:v1.8.4<br></code></pre></td></tr></table></figure><h3 id="11-åˆå§‹åŒ–é›†ç¾¤ï¼Œå¹¶ç”Ÿæˆkubeadm-initã€‚logæ–‡ä»¶ã€æ–‡ä»¶å†…ä¿å­˜ç›¸å…³çš„"><a href="#11-åˆå§‹åŒ–é›†ç¾¤ï¼Œå¹¶ç”Ÿæˆkubeadm-initã€‚logæ–‡ä»¶ã€æ–‡ä»¶å†…ä¿å­˜ç›¸å…³çš„" class="headerlink" title="11.åˆå§‹åŒ–é›†ç¾¤ï¼Œå¹¶ç”Ÿæˆkubeadm-initã€‚logæ–‡ä»¶ã€æ–‡ä»¶å†…ä¿å­˜ç›¸å…³çš„"></a>11.åˆå§‹åŒ–é›†ç¾¤ï¼Œå¹¶ç”Ÿæˆkubeadm-initã€‚logæ–‡ä»¶ã€æ–‡ä»¶å†…ä¿å­˜ç›¸å…³çš„</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm init --config=kubeadm-config.yaml | <span class="hljs-built_in">tee</span> kubeadm-init.log<br><br><span class="hljs-comment">#å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œé‡ç½®åå†æ¬¡åˆå§‹åŒ–ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</span><br>kubeadm reset -f  ; <span class="hljs-built_in">rm</span> -rf ~/.kube<br></code></pre></td></tr></table></figure><h3 id="12-åœ¨å…¶ä»–çš„masterèŠ‚ç‚¹ä¸Šæ–°å»ºç›®å½•ã€‚å¹¶åˆ†å‘è¯ä¹¦åˆ°å…¶ä»–çš„masterèŠ‚ç‚¹ä¸Š"><a href="#12-åœ¨å…¶ä»–çš„masterèŠ‚ç‚¹ä¸Šæ–°å»ºç›®å½•ã€‚å¹¶åˆ†å‘è¯ä¹¦åˆ°å…¶ä»–çš„masterèŠ‚ç‚¹ä¸Š" class="headerlink" title="12.åœ¨å…¶ä»–çš„masterèŠ‚ç‚¹ä¸Šæ–°å»ºç›®å½•ã€‚å¹¶åˆ†å‘è¯ä¹¦åˆ°å…¶ä»–çš„masterèŠ‚ç‚¹ä¸Š"></a>12.åœ¨å…¶ä»–çš„masterèŠ‚ç‚¹ä¸Šæ–°å»ºç›®å½•ã€‚å¹¶åˆ†å‘è¯ä¹¦åˆ°å…¶ä»–çš„masterèŠ‚ç‚¹ä¸Š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ›å»ºç›®å½•</span><br><span class="hljs-built_in">mkdir</span> -p /etc/kubernetes/pki/etcd<br><br><span class="hljs-comment">#åˆ†å‘è¯ä¹¦</span><br>scp /etc/kubernetes/pki/ca.* master2:/etc/kubernetes/pki/<br>scp /etc/kubernetes/pki/sa.* master2:/etc/kubernetes/pki/<br>scp /etc/kubernetes/pki/front-proxy-ca.* master2:/etc/kubernetes/pki/<br>scp /etc/kubernetes/pki/etcd/ca.* master2:/etc/kubernetes/pki/etcd/<br>scp /etc/kubernetes/admin.conf master2:/etc/kubernetes/<br><br>scp /etc/kubernetes/pki/ca.* master3:/etc/kubernetes/pki/<br>scp /etc/kubernetes/pki/sa.* master3:/etc/kubernetes/pki/<br>scp /etc/kubernetes/pki/front-proxy-ca.* master3:/etc/kubernetes/pki/<br>scp /etc/kubernetes/pki/etcd/ca.* master3:/etc/kubernetes/pki/etcd/<br>scp /etc/kubernetes/admin.conf master3:/etc/kubernetes/<br></code></pre></td></tr></table></figure><h3 id="13-masterèŠ‚ç‚¹åŠ å…¥é›†ç¾¤"><a href="#13-masterèŠ‚ç‚¹åŠ å…¥é›†ç¾¤" class="headerlink" title="13.masterèŠ‚ç‚¹åŠ å…¥é›†ç¾¤"></a>13.masterèŠ‚ç‚¹åŠ å…¥é›†ç¾¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm <span class="hljs-built_in">join</span> 192.168.62.123:16443 --token abcdef.0123456789abcdef \<br>    --discovery-token-ca-cert-hash sha256:311c421308389152175e7a230253109fc2e6603156a26904771267e0be1c8177 \<br>    --control-plane<br></code></pre></td></tr></table></figure><h3 id="14-å°†masterä¸»èŠ‚ç‚¹çš„admin-confæ–‡ä»¶å¤åˆ¶åˆ°nodeèŠ‚ç‚¹"><a href="#14-å°†masterä¸»èŠ‚ç‚¹çš„admin-confæ–‡ä»¶å¤åˆ¶åˆ°nodeèŠ‚ç‚¹" class="headerlink" title="14.å°†masterä¸»èŠ‚ç‚¹çš„admin.confæ–‡ä»¶å¤åˆ¶åˆ°nodeèŠ‚ç‚¹"></a>14.å°†masterä¸»èŠ‚ç‚¹çš„admin.confæ–‡ä»¶å¤åˆ¶åˆ°nodeèŠ‚ç‚¹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">scp /etc/kubernetes/admin.conf node1:/etc/kubernetes/<br></code></pre></td></tr></table></figure><h3 id="15-nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤"><a href="#15-nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤" class="headerlink" title="15.nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤"></a>15.nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm <span class="hljs-built_in">join</span> 192.168.62.123:16443 --token abcdef.0123456789abcdef \<br>    --discovery-token-ca-cert-hash sha256:311c421308389152175e7a230253109fc2e6603156a26904771267e0be1c8177<br></code></pre></td></tr></table></figure><h3 id="16-masterèŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒnodeèŠ‚ç‚¹éšæ„"><a href="#16-masterèŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒnodeèŠ‚ç‚¹éšæ„" class="headerlink" title="16.masterèŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒnodeèŠ‚ç‚¹éšæ„"></a>16.masterèŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒnodeèŠ‚ç‚¹éšæ„</h3><p>root ç”¨æˆ·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;export KUBECONFIG=/etc/kubernetes/admin.conf&quot;</span> &gt;&gt; ~/.bash_profile<br><span class="hljs-built_in">source</span> .bash_profile<br></code></pre></td></tr></table></figure><p>é root ç”¨æˆ·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br>sudo <span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br>sudo <span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br></code></pre></td></tr></table></figure><h3 id="17-å®‰è£…ç½‘ç»œæ’ä»¶flannel"><a href="#17-å®‰è£…ç½‘ç»œæ’ä»¶flannel" class="headerlink" title="17.å®‰è£…ç½‘ç»œæ’ä»¶flannel"></a>17.å®‰è£…ç½‘ç»œæ’ä»¶flannel</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml<br></code></pre></td></tr></table></figure><h3 id="18-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"><a href="#18-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€" class="headerlink" title="18.æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"></a>18.æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl get nodes<br>kubectl get pod -A<br></code></pre></td></tr></table></figure><h3 id="19-kubectlè¡¥é½å‘½ä»¤"><a href="#19-kubectlè¡¥é½å‘½ä»¤" class="headerlink" title="19.kubectlè¡¥é½å‘½ä»¤"></a>19.kubectlè¡¥é½å‘½ä»¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> &lt;(kubectl completion bash)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; ~/.bashrc<br></code></pre></td></tr></table></figure><h2 id="å››ã€ETCDéªŒè¯"><a href="#å››ã€ETCDéªŒè¯" class="headerlink" title="å››ã€ETCDéªŒè¯"></a>å››ã€ETCDéªŒè¯</h2><p><strong>è¯¥æ­¥éª¤ä¸»è¦ä¸ºéªŒè¯<code>etcdctl</code>æ˜¯å¦èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œä¸éœ€è¦å®‰è£…çš„å¯ä»¥è·³è¿‡</strong></p><h3 id="1-ä¸‹è½½-etcdctl-å®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…·"><a href="#1-ä¸‹è½½-etcdctl-å®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="1.ä¸‹è½½ etcdctl å®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…·"></a>1.ä¸‹è½½ etcdctl å®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…·</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://github.com/etcd-io/etcd/releases/download/v3.4.14/etcd-v3.4.14-linux-amd64.tar.gz<br></code></pre></td></tr></table></figure><h3 id="2-è§£å‹å¹¶åŠ å…¥ç¯å¢ƒå˜é‡"><a href="#2-è§£å‹å¹¶åŠ å…¥ç¯å¢ƒå˜é‡" class="headerlink" title="2.è§£å‹å¹¶åŠ å…¥ç¯å¢ƒå˜é‡"></a>2.è§£å‹å¹¶åŠ å…¥ç¯å¢ƒå˜é‡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -zxf etcd-v3.4.14-linux-amd64.tar.gz<br><span class="hljs-built_in">mv</span> etcd-v3.4.14-linux-amd64/etcdctl /usr/local/bin<br><span class="hljs-built_in">chmod</span> +x /usr/local/bin/<br></code></pre></td></tr></table></figure><h3 id="3-éªŒè¯etcdctlæ˜¯å¦èƒ½ç”¨"><a href="#3-éªŒè¯etcdctlæ˜¯å¦èƒ½ç”¨" class="headerlink" title="3.éªŒè¯etcdctlæ˜¯å¦èƒ½ç”¨"></a>3.éªŒè¯<code>etcdctl</code>æ˜¯å¦èƒ½ç”¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">etcdctl version<br></code></pre></td></tr></table></figure><h3 id="4-æŸ¥çœ‹etcdé«˜å¯ç”¨é›†ç¾¤å¥åº·çŠ¶æ€"><a href="#4-æŸ¥çœ‹etcdé«˜å¯ç”¨é›†ç¾¤å¥åº·çŠ¶æ€" class="headerlink" title="4.æŸ¥çœ‹etcdé«˜å¯ç”¨é›†ç¾¤å¥åº·çŠ¶æ€"></a>4.æŸ¥çœ‹<code>etcd</code>é«˜å¯ç”¨é›†ç¾¤å¥åº·çŠ¶æ€</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ETCDCTL_API=3 etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/peer.crt --key=/etc/kubernetes/pki/etcd/peer.key --write-out=table --endpoints=192.168.62.128:2379,192.168.62.129:2379,192.168.62.130:2379 endpoint health<br></code></pre></td></tr></table></figure><h3 id="5-æŸ¥çœ‹etcdé«˜å¯ç”¨é›†ç¾¤leader"><a href="#5-æŸ¥çœ‹etcdé«˜å¯ç”¨é›†ç¾¤leader" class="headerlink" title="5.æŸ¥çœ‹etcdé«˜å¯ç”¨é›†ç¾¤leader"></a>5.æŸ¥çœ‹<code>etcd</code>é«˜å¯ç”¨é›†ç¾¤leader</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ETCDCTL_API=3 etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/peer.crt --key=/etc/kubernetes/pki/etcd/peer.key --write-out=table --endpoints=192.168.62.128:2379,192.168.62.129:2379,192.168.62.130:2379 endpoint status<br></code></pre></td></tr></table></figure><h2 id="äº”ã€éƒ¨ç½²dashboard"><a href="#äº”ã€éƒ¨ç½²dashboard" class="headerlink" title="äº”ã€éƒ¨ç½²dashboard"></a>äº”ã€éƒ¨ç½²<code>dashboard</code></h2><h3 id="1-éƒ¨ç½²Kuboard"><a href="#1-éƒ¨ç½²Kuboard" class="headerlink" title="1.éƒ¨ç½²Kuboard"></a>1.éƒ¨ç½²Kuboard</h3><p><img src="/2023/05/06/k8s/k8s%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/kubeadm%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8k8s%E9%9B%86%E7%BE%A4/image-20230526104752545.png" alt="image-20230526104752545"></p><h4 id="æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š"><a href="#æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š" class="headerlink" title="æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š"></a>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl apply -f https://addons.kuboard.cn/kuboard/kuboard-v3.yaml<br><br><br><span class="hljs-comment">#ç­‰å¾…k8så°±ç»ª</span><br><span class="hljs-comment">#åœ¨æµè§ˆå™¨ä¸­æ‰“å¡é“¾æ¥ http://192.168.62.123:30080</span><br><span class="hljs-comment">#åˆå§‹åŒ–ç”¨æˆ·åï¼šadminå’Œå¯†ç ï¼šKuboard123</span><br></code></pre></td></tr></table></figure><h3 id="2-éƒ¨ç½²kubernetes-dashboard"><a href="#2-éƒ¨ç½²kubernetes-dashboard" class="headerlink" title="2.éƒ¨ç½²kubernetes-dashboard"></a>2.éƒ¨ç½²kubernetes-dashboard</h3><p><img src="/2023/05/06/k8s/k8s%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/kubeadm%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8k8s%E9%9B%86%E7%BE%A4/image-20230526112652590.png" alt="image-20230526112652590"></p><h4 id="2-1ã€ä¸‹è½½-recommended-yaml-æ–‡ä»¶"><a href="#2-1ã€ä¸‹è½½-recommended-yaml-æ–‡ä»¶" class="headerlink" title="2.1ã€ä¸‹è½½ recommended.yaml æ–‡ä»¶"></a>2.1ã€ä¸‹è½½ recommended.yaml æ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml<br></code></pre></td></tr></table></figure><h4 id="2-2ã€ä¿®æ”¹recommended-yamlæ–‡ä»¶"><a href="#2-2ã€ä¿®æ”¹recommended-yamlæ–‡ä»¶" class="headerlink" title="2.2ã€ä¿®æ”¹recommended.yamlæ–‡ä»¶"></a>2.2ã€ä¿®æ”¹recommended.yamlæ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">---<br>kind: Service<br>apiVersion: v1<br>metadata:<br>  labels:<br>    k8s-app: kubernetes-dashboard<br>  name: kubernetes-dashboard<br>  namespace: kubernetes-dashboard<br>spec:<br>  <span class="hljs-built_in">type</span>: NodePort <span class="hljs-comment">#å¢åŠ </span><br>  ports:<br>    - port: 443<br>      targetPort: 8443<br>      nodePort: 30000 <span class="hljs-comment">#å¢åŠ </span><br>  selector:<br>    k8s-app: kubernetes-dashboard<br></code></pre></td></tr></table></figure><h4 id="2-3ã€åˆ›å»ºè¯ä¹¦"><a href="#2-3ã€åˆ›å»ºè¯ä¹¦" class="headerlink" title="2.3ã€åˆ›å»ºè¯ä¹¦"></a>2.3ã€åˆ›å»ºè¯ä¹¦</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ›å»ºå·¥ä½œç›®å½•</span><br><span class="hljs-built_in">mkdir</span> /app/dashboard-certs &amp;&amp; <span class="hljs-built_in">cd</span> /app/dashboard-certs/<br><br><span class="hljs-comment"># åˆ›å»ºå‘½åç©ºé—´</span><br>kubectl create namespace kubernetes-dashboard<br><br><span class="hljs-comment"># åˆ›å»ºkeyæ–‡ä»¶</span><br>openssl genrsa -out dashboard.key 2048<br><br><span class="hljs-comment"># è¯ä¹¦è¯·æ±‚</span><br>openssl req -days 36000 -new -out dashboard.csr -key dashboard.key -subj <span class="hljs-string">&#x27;/CN=dashboard-cert&#x27;</span><br><br><span class="hljs-comment"># è‡ªç­¾è¯ä¹¦</span><br>openssl x509 -req -<span class="hljs-keyword">in</span> dashboard.csr -signkey dashboard.key -out dashboard.crt<br><br><span class="hljs-comment"># åˆ›å»º kubernetes-dashboard-certs å¯¹è±¡</span><br>kubectl create secret generic kubernetes-dashboard-certs --from-file=dashboard.key --from-file=dashboard.crt -n kubernetes-dashboard<br><br></code></pre></td></tr></table></figure><h4 id="2-4ã€å¯åŠ¨-dashboard"><a href="#2-4ã€å¯åŠ¨-dashboard" class="headerlink" title="2.4ã€å¯åŠ¨ dashboard"></a>2.4ã€å¯åŠ¨ dashboard</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl apply -f recommended.yaml<br><br><span class="hljs-comment">#ï¼ˆå¦‚æœæŠ¥é”™ï¼šError from server (AlreadyExists): error when creating &quot;./recommended.yaml&quot;: namespaces &quot;kubernetes-dashboard&quot; already existsè¿™ä¸ªå¿½ç•¥ä¸è®¡ï¼Œä¸å½±å“ã€‚ï¼‰</span><br></code></pre></td></tr></table></figure><h4 id="2-5ã€æŸ¥çœ‹è¿è¡ŒçŠ¶æ€"><a href="#2-5ã€æŸ¥çœ‹è¿è¡ŒçŠ¶æ€" class="headerlink" title="2.5ã€æŸ¥çœ‹è¿è¡ŒçŠ¶æ€"></a>2.5ã€æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl get pod -n kubernetes-dashboard -owide<br><br>kubectl get svc -n kubernetes-dashboard<br></code></pre></td></tr></table></figure><h4 id="2-6ã€åˆ›å»º-dashboard-ç®¡ç†å‘˜å¹¶ä¸ºç”¨æˆ·åˆ†é…æƒé™"><a href="#2-6ã€åˆ›å»º-dashboard-ç®¡ç†å‘˜å¹¶ä¸ºç”¨æˆ·åˆ†é…æƒé™" class="headerlink" title="2.6ã€åˆ›å»º dashboard ç®¡ç†å‘˜å¹¶ä¸ºç”¨æˆ·åˆ†é…æƒé™"></a>2.6ã€åˆ›å»º dashboard ç®¡ç†å‘˜å¹¶ä¸ºç”¨æˆ·åˆ†é…æƒé™</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> admin_dashboard-bind-cluster-role.yaml<br><br><span class="hljs-comment">##åˆ›å»º dashboard ç®¡ç†å‘˜</span><br>apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>  labels:<br>    k8s-app: kubernetes-dashboard<br>  name: dashboard-admin<br>  namespace: kubernetes-dashboard<br>---<br><span class="hljs-comment">##ä¸ºç”¨æˆ·åˆ†é…æƒé™</span><br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRoleBinding<br>metadata:<br>  name: dashboard-admin-bind-cluster-role<br>  labels:<br>    k8s-app: kubernetes-dashboard<br>roleRef:<br>  apiGroup: rbac.authorization.k8s.io<br>  kind: ClusterRole<br>  name: cluster-admin<br>subjects:<br>- kind: ServiceAccount<br>  name: dashboard-admin<br>  namespace: kubernetes-dashboard<br><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl apply -f admin_dashboard-bind-cluster-role.yaml<br></code></pre></td></tr></table></figure><h4 id="2-7ã€æŸ¥çœ‹å¹¶å¤åˆ¶ç”¨æˆ·-Token"><a href="#2-7ã€æŸ¥çœ‹å¹¶å¤åˆ¶ç”¨æˆ·-Token" class="headerlink" title="2.7ã€æŸ¥çœ‹å¹¶å¤åˆ¶ç”¨æˆ· Token"></a>2.7ã€æŸ¥çœ‹å¹¶å¤åˆ¶ç”¨æˆ· Token</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep dashboard-admin | awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">Name:         dashboard-admin-token-dfq42<br>Namespace:    kubernetes-dashboard<br>Labels:       &lt;none&gt;<br>Annotations:  kubernetes.io/service-account.name: dashboard-admin<br><span class="hljs-code">              kubernetes.io/service-account.uid: e0d31f53-14b7-4342-b502-6e1635078814</span><br><br>Type:  kubernetes.io/service-account-token<br><br><span class="hljs-section">Data</span><br><span class="hljs-section">====</span><br>namespace:  20 bytes<br>token:      eyJhbGciOiJSUzI1NiIsImtpZCI6ImttWWwtREctYnZEV2RuYUlJRTBYaExOUmdZWFllcWtfVDNRTlB1UVNYNEkifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tZGZxNDIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiZTBkMzFmNTMtMTRiNy00MzQyLWI1MDItNmUxNjM1MDc4ODE0Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.bokZaMGtvHltpg1JN3GIrtTEsOlMha-GeDSOOdKrh-wvNrHeHsj9FSTa1l5gPDSJfzuo2UlItuYQMTm7-A3h33TlW3CeVfAmf0-Vx1irlHT3awnpC0qG2Ci5_WbJai2QKlNqnYNakG-0mw9bEXfZ-LP-wq7d8Xy-tcTp5xd8i3K1h1L-Mh2JRAW2vPpJMOPDegCy9UY2NK9h37eesczIHWfzKNBQYJM3rEuhLgWyxjPsF3A0j3vMbVORvpryj9ushOvMYTDr1KHULmvWKKgo0ZCbAzWXRJKU1e24I48pRkBc9zm29wxBr7aV7TJRFChHNtKnvNphWloVLMNFUVssQg<br>ca.crt:     1066 bytes<br><br></code></pre></td></tr></table></figure><h4 id="2-8ã€å¤åˆ¶-token-å¹¶è®¿é—®-dashboard"><a href="#2-8ã€å¤åˆ¶-token-å¹¶è®¿é—®-dashboard" class="headerlink" title="2.8ã€å¤åˆ¶ token å¹¶è®¿é—® dashboard"></a>2.8ã€å¤åˆ¶ token å¹¶è®¿é—® dashboard</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">https://192.168.62.123:30000<br><br>è¾“å…¥å¤åˆ¶çš„tokenå³å¯è®¿é—®![image-20230526114241393](kubeadméƒ¨ç½²é«˜å¯ç”¨k8sé›†ç¾¤/image-20230526114241393.png)<br></code></pre></td></tr></table></figure><p><img src="/2023/05/06/k8s/k8s%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/kubeadm%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8k8s%E9%9B%86%E7%BE%A4/image-20230526114249795.png" alt="image-20230526114249795"></p><p><strong>cpuå’Œå†…å­˜ä½¿ç”¨æƒ…å†µéœ€è¦éƒ¨ç½²<code>Metrics-Server</code>æ‰ä¼šæ˜¾ç¤ºï¼ã€Šå¯å‚è€ƒk8så®‰è£…metrics-server.mdã€‹æ–‡æ¡£</strong></p>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>k8sç¯å¢ƒæ­å»º</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨LVSå®ç°k8sé«˜å¯ç”¨-å®‰è£…æ‰‹å†Œ</title>
    <link href="/2023/05/05/k8s/k8s%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E4%BD%BF%E7%94%A8LVS%E5%AE%9E%E7%8E%B0k8s%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%89%E8%A3%85/"/>
    <url>/2023/05/05/k8s/k8s%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E4%BD%BF%E7%94%A8LVS%E5%AE%9E%E7%8E%B0k8s%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨LVSå®ç°k8sé«˜å¯ç”¨-å®‰è£…æ‰‹å†Œ"><a href="#ä½¿ç”¨LVSå®ç°k8sé«˜å¯ç”¨-å®‰è£…æ‰‹å†Œ" class="headerlink" title="ä½¿ç”¨LVSå®ç°k8sé«˜å¯ç”¨-å®‰è£…æ‰‹å†Œ"></a>ä½¿ç”¨LVSå®ç°k8sé«˜å¯ç”¨-å®‰è£…æ‰‹å†Œ</h1><h2 id="ä¸€ã€æœºå™¨è§„åˆ’"><a href="#ä¸€ã€æœºå™¨è§„åˆ’" class="headerlink" title="ä¸€ã€æœºå™¨è§„åˆ’"></a>ä¸€ã€æœºå™¨è§„åˆ’</h2><table><thead><tr><th>æœºå™¨IP</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>192.168.94.131</td><td>k8s-master-1</td></tr><tr><td>192.168.94.132</td><td>k8s-master-2</td></tr><tr><td>192.168.94.133</td><td>k8s-master-3</td></tr><tr><td>192.168.94.134</td><td>k8s-node-1</td></tr><tr><td>10.92.96.1</td><td>LVS</td></tr></tbody></table><h2 id="äºŒã€å®‰è£…è¿‡ç¨‹"><a href="#äºŒã€å®‰è£…è¿‡ç¨‹" class="headerlink" title="äºŒã€å®‰è£…è¿‡ç¨‹"></a>äºŒã€å®‰è£…è¿‡ç¨‹</h2><p><strong>å…ˆå…³é—­é˜²ç«å¢™ï¼Œä»¥åŠseliunxã€åŒæ­¥æ—¶é—´ï¼ˆè¿‡ç¨‹å·²è·³è¿‡ï¼‰</strong></p><h3 id="1ã€å„èŠ‚ç‚¹ä¸‹è½½dockeræº"><a href="#1ã€å„èŠ‚ç‚¹ä¸‹è½½dockeræº" class="headerlink" title="1ã€å„èŠ‚ç‚¹ä¸‹è½½dockeræº"></a>1ã€å„èŠ‚ç‚¹ä¸‹è½½dockeræº</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://download.docker.com/linux/centos/docker-ce.repo<br></code></pre></td></tr></table></figure><h3 id="2ã€å„èŠ‚ç‚¹å®‰è£…dockeræœåŠ¡å¹¶åŠ å…¥å¼€æœºå¯åŠ¨"><a href="#2ã€å„èŠ‚ç‚¹å®‰è£…dockeræœåŠ¡å¹¶åŠ å…¥å¼€æœºå¯åŠ¨" class="headerlink" title="2ã€å„èŠ‚ç‚¹å®‰è£…dockeræœåŠ¡å¹¶åŠ å…¥å¼€æœºå¯åŠ¨"></a>2ã€å„èŠ‚ç‚¹å®‰è£…dockeræœåŠ¡å¹¶åŠ å…¥å¼€æœºå¯åŠ¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install docker-ce<br>systemctl start docker &amp;&amp; systemctl <span class="hljs-built_in">enable</span> docker<br></code></pre></td></tr></table></figure><h3 id="3ã€å„èŠ‚ç‚¹é…ç½®dockeråŠ é€Ÿå™¨å¹¶ä¿®æ”¹æˆk8sé©±åŠ¨ã€daemon-jsonæ–‡ä»¶å¦‚æœæ²¡æœ‰è‡ªå·±åˆ›å»º"><a href="#3ã€å„èŠ‚ç‚¹é…ç½®dockeråŠ é€Ÿå™¨å¹¶ä¿®æ”¹æˆk8sé©±åŠ¨ã€daemon-jsonæ–‡ä»¶å¦‚æœæ²¡æœ‰è‡ªå·±åˆ›å»º" class="headerlink" title="3ã€å„èŠ‚ç‚¹é…ç½®dockeråŠ é€Ÿå™¨å¹¶ä¿®æ”¹æˆk8sé©±åŠ¨ã€daemon.jsonæ–‡ä»¶å¦‚æœæ²¡æœ‰è‡ªå·±åˆ›å»º"></a>3ã€å„èŠ‚ç‚¹é…ç½®dockeråŠ é€Ÿå™¨å¹¶ä¿®æ”¹æˆk8sé©±åŠ¨ã€daemon.jsonæ–‡ä»¶å¦‚æœæ²¡æœ‰è‡ªå·±åˆ›å»º</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt;&gt;  /etc/docker/daemon.json &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span><br><span class="hljs-string">  &quot;log-driver&quot;: &quot;json-file&quot;,</span><br><span class="hljs-string">  &quot;log-opts&quot;: &#123;</span><br><span class="hljs-string">    &quot;max-size&quot;: &quot;100m&quot;</span><br><span class="hljs-string">  &#125;,</span><br><span class="hljs-string">  &quot;storage-driver&quot;: &quot;overlay2&quot;,</span><br><span class="hljs-string">  &quot;storage-opts&quot;: [</span><br><span class="hljs-string">    &quot;overlay2.override_kernel_check=true&quot;</span><br><span class="hljs-string">  ]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h3 id="4ã€é‡å¯dockeræœåŠ¡"><a href="#4ã€é‡å¯dockeræœåŠ¡" class="headerlink" title="4ã€é‡å¯dockeræœåŠ¡"></a>4ã€é‡å¯dockeræœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart docker<br></code></pre></td></tr></table></figure><h3 id="5ã€æ›´æ”¹å„èŠ‚ç‚¹ä¸»æœºå"><a href="#5ã€æ›´æ”¹å„èŠ‚ç‚¹ä¸»æœºå" class="headerlink" title="5ã€æ›´æ”¹å„èŠ‚ç‚¹ä¸»æœºå"></a>5ã€æ›´æ”¹å„èŠ‚ç‚¹ä¸»æœºå</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">homenamectl set-hostname k8s-master-1<br></code></pre></td></tr></table></figure><h3 id="6ã€é…ç½®å„èŠ‚ç‚¹hostsæ–‡ä»¶"><a href="#6ã€é…ç½®å„èŠ‚ç‚¹hostsæ–‡ä»¶" class="headerlink" title="6ã€é…ç½®å„èŠ‚ç‚¹hostsæ–‡ä»¶"></a>6ã€é…ç½®å„èŠ‚ç‚¹hostsæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim  /etc/hosts<br><br>192.168.94.131 k8s-master-1<br>192.168.94.132 k8s-master-2<br>192.168.94.133 k8s-master-3<br>192.168.94.131 apiserver.cluster.local <span class="hljs-comment">#å®šä¹‰ä¸€ä¸ªapiçš„åŸŸåï¼Œå¹¶æŒ‡å‘å„å°masteræœºå™¨ï¼Œæœºå™¨ä¸Šipæ”¹ä¸ºå½“å‰masteræœºå™¨</span><br></code></pre></td></tr></table></figure><h3 id="7ã€å„èŠ‚ç‚¹å†…æ ¸è°ƒæ•´-å°†æ¡¥æ¥çš„IPv4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾"><a href="#7ã€å„èŠ‚ç‚¹å†…æ ¸è°ƒæ•´-å°†æ¡¥æ¥çš„IPv4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾" class="headerlink" title="7ã€å„èŠ‚ç‚¹å†…æ ¸è°ƒæ•´,å°†æ¡¥æ¥çš„IPv4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾"></a>7ã€å„èŠ‚ç‚¹å†…æ ¸è°ƒæ•´,å°†æ¡¥æ¥çš„IPv4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/sysctl.d/k8s.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="hljs-string">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="hljs-string">net.ipv4.ip_nonlocal_bind = 1</span><br><span class="hljs-string">net.ipv4.ip_forward = 1</span><br><span class="hljs-string">EOF</span><br><br>sysctl -p /etc/sysctl.d/k8s.conf<br></code></pre></td></tr></table></figure><h3 id="8ã€å„èŠ‚ç‚¹é…ç½®k8sçš„yumæº"><a href="#8ã€å„èŠ‚ç‚¹é…ç½®k8sçš„yumæº" class="headerlink" title="8ã€å„èŠ‚ç‚¹é…ç½®k8sçš„yumæº"></a>8ã€å„èŠ‚ç‚¹é…ç½®k8sçš„yumæº</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">[kubernetes]</span><br><span class="hljs-string">name=Kubernetes</span><br><span class="hljs-string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">gpgcheck=1</span><br><span class="hljs-string">repo_gpgcheck=1</span><br><span class="hljs-string">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg \</span><br><span class="hljs-string">https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h3 id="9ã€å„èŠ‚ç‚¹å®‰è£…ipsetæœåŠ¡"><a href="#9ã€å„èŠ‚ç‚¹å®‰è£…ipsetæœåŠ¡" class="headerlink" title="9ã€å„èŠ‚ç‚¹å®‰è£…ipsetæœåŠ¡"></a>9ã€å„èŠ‚ç‚¹å®‰è£…ipsetæœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install ipvsadm ipset sysstat conntrack libseccomp<br></code></pre></td></tr></table></figure><h3 id="10ã€å„èŠ‚ç‚¹å¼€å¯ipvsæ¨¡å—"><a href="#10ã€å„èŠ‚ç‚¹å¼€å¯ipvsæ¨¡å—" class="headerlink" title="10ã€å„èŠ‚ç‚¹å¼€å¯ipvsæ¨¡å—"></a>10ã€å„èŠ‚ç‚¹å¼€å¯ipvsæ¨¡å—</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">     #!/bin/sh</span><br><span class="hljs-string">     modprobe -- ip_vs</span><br><span class="hljs-string">     modprobe -- ip_vs_rr</span><br><span class="hljs-string">     modprobe -- ip_vs_wrr</span><br><span class="hljs-string">     modprobe -- ip_vs_sh</span><br><span class="hljs-string">     modprobe -- nf_conntrack</span><br><span class="hljs-string">EOF</span><br><span class="hljs-built_in">chmod</span> 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash <br><br>/etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4<br></code></pre></td></tr></table></figure><h3 id="11ã€æ¯ä¸ªèŠ‚ç‚¹å®‰è£…kubeadm-kubeletå’Œkubectl"><a href="#11ã€æ¯ä¸ªèŠ‚ç‚¹å®‰è£…kubeadm-kubeletå’Œkubectl" class="headerlink" title="11ã€æ¯ä¸ªèŠ‚ç‚¹å®‰è£…kubeadm,kubeletå’Œkubectl"></a>11ã€æ¯ä¸ªèŠ‚ç‚¹å®‰è£…kubeadm,kubeletå’Œkubectl</h3><p>å®‰è£…çš„kubeadmã€kubectlå’Œkubeletè¦å’Œkubernetesç‰ˆæœ¬ä¸€è‡´ï¼ŒkubeletåŠ å…¥å¼€æœºå¯åŠ¨ä¹‹åä¸æ‰‹åŠ¨å¯åŠ¨ï¼Œè¦ä¸ç„¶ä¼šæŠ¥é”™ï¼Œåˆå§‹åŒ–é›†ç¾¤ä¹‹åé›†ç¾¤ä¼šè‡ªåŠ¨å¯åŠ¨kubeletæœåŠ¡ï¼</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install kubeadm kubelet kubectl<br><span class="hljs-comment">#æŒ‡å®šç‰ˆæœ¬ï¼šyum install kubeadm-1.21.1 kubectl-1.21.1 kubelet-1.21.1 -y</span><br><br>systemctl <span class="hljs-built_in">enable</span> kubelet &amp;&amp; systemctl daemon-reload<br></code></pre></td></tr></table></figure><h3 id="12ã€è·å–é»˜è®¤é…ç½®æ–‡ä»¶"><a href="#12ã€è·å–é»˜è®¤é…ç½®æ–‡ä»¶" class="headerlink" title="12ã€è·å–é»˜è®¤é…ç½®æ–‡ä»¶"></a>12ã€è·å–é»˜è®¤é…ç½®æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm config <span class="hljs-built_in">print</span> init-defaults &gt; kubeadm-config.yaml<br></code></pre></td></tr></table></figure><h3 id="13ã€ä¿®æ”¹masterèŠ‚ç‚¹åˆå§‹åŒ–é…ç½®æ–‡ä»¶"><a href="#13ã€ä¿®æ”¹masterèŠ‚ç‚¹åˆå§‹åŒ–é…ç½®æ–‡ä»¶" class="headerlink" title="13ã€ä¿®æ”¹masterèŠ‚ç‚¹åˆå§‹åŒ–é…ç½®æ–‡ä»¶"></a>13ã€ä¿®æ”¹masterèŠ‚ç‚¹åˆå§‹åŒ–é…ç½®æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> kubeadm-config.yaml<br><span class="hljs-comment">#</span><br>apiVersion: kubeadm.k8s.io/v1beta3<br>bootstrapTokens:<br>- <span class="hljs-built_in">groups</span>:<br>  - system:bootstrappers:kubeadm:default-node-token<br>  token: abcdef.0123456789abcdef<br>  ttl: 24h0m0s<br>  usages:<br>  - signing<br>  - authentication<br>kind: InitConfiguration<br>localAPIEndpoint:<br>  advertiseAddress: 192.168.94.131  <span class="hljs-comment">#æœ¬æœºåœ°å€</span><br>  bindPort: 6443<br>nodeRegistration:<br>  criSocket: /var/run/dockershim.sock<br>  imagePullPolicy: IfNotPresent<br>  name: k8s-master-1    <span class="hljs-comment">#è®¾ç½®çš„nameå</span><br>  taints: null<br>---<br>apiServer:<br>  timeoutForControlPlane: 4m0s<br>  certSANs:<br>    - 127.0.0.1<br>    - apiserver.cluster.local  <span class="hljs-comment">#è®¾ç½®çš„ç›¸å…³è°ƒç”¨åŸŸåï¼Œä¸hostsæ–‡ä»¶å†…å®šä¹‰ä¸€è‡´</span><br>    - 192.168.94.131<br>    - 192.168.94.132<br>    - 192.168.94.133<br>    - 10.96.96.1   <span class="hljs-comment">#å®šä¹‰çš„è™šæ‹Ÿip</span><br>apiVersion: kubeadm.k8s.io/v1beta3<br>certificatesDir: /etc/kubernetes/pki<br>clusterName: kubernetes<br>controllerManager: &#123;&#125;<br>controlPlaneEndpoint: apiserver.cluster.local:6443<br>dns: &#123;&#125;<br>etcd:<br>  <span class="hljs-built_in">local</span>:<br>    dataDir: /var/lib/etcd<br>imageRepository: registry.aliyuncs.com/google_containers<br>kind: ClusterConfiguration<br>kubernetesVersion: 1.22.1<br>networking:<br>  dnsDomain: cluster.local<br>  serviceSubnet: 10.20.0.0/16<br>  podSubnet: 10.30.0.0/16<br>scheduler: &#123;&#125;<br><br>---<br>apiVersion: kubeproxy.config.k8s.io/v1alpha1<br>kind: KubeProxyConfiguration<br>featureGates:<br>  SupportIPVSProxyMode: <span class="hljs-literal">true</span><br>mode: ipvs<br>ipvs:<br>  excludeCIDRs: <br>    - 10.96.96.1/32<br></code></pre></td></tr></table></figure><h3 id="14ã€ä¸‹è½½ç›¸å…³é•œåƒ"><a href="#14ã€ä¸‹è½½ç›¸å…³é•œåƒ" class="headerlink" title="14ã€ä¸‹è½½ç›¸å…³é•œåƒ"></a>14ã€ä¸‹è½½ç›¸å…³é•œåƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm config images pull --config kubeadm-config.yaml<br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>[config/images] Pulled registry.aliyuncs.com/google_containers/kube-apiserver:v1.22.1<br>[config/images] Pulled registry.aliyuncs.com/google_containers/kube-controller-manager:v1.22.1<br>[config/images] Pulled registry.aliyuncs.com/google_containers/kube-scheduler:v1.22.1<br>[config/images] Pulled registry.aliyuncs.com/google_containers/kube-proxy:v1.22.1<br>[config/images] Pulled registry.aliyuncs.com/google_containers/pause:3.5<br>[config/images] Pulled registry.aliyuncs.com/google_containers/etcd:3.5.0-0<br>failed to pull image <span class="hljs-string">&quot;registry.aliyuncs.com/google_containers/coredns:v1.8.4&quot;</span>: output: Error response from daemon: manifest <span class="hljs-keyword">for</span> registry.aliyuncs.com/google_containers/coredns:v1.8.4 not found: manifest unknown: manifest unknown<br>, error: <span class="hljs-built_in">exit</span> status 1<br>To see the stack trace of this error execute with --v=5 or higher<br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><br><span class="hljs-comment">#ä»“åº“éœ€ä¸‹è½½corednsï¼š1.8.4 å¹¶ä¿®æ”¹tagåŒ…</span><br>docker pull coredns/coredns:1.8.4<br>docker tag coredns/coredns:1.8.4 registry.aliyuncs.com/google_containers/coredns:v1.8.4<br></code></pre></td></tr></table></figure><h3 id="15ã€åˆå§‹åŒ–é›†ç¾¤ï¼Œå¹¶ç”Ÿæˆkubeadm-initã€‚logæ–‡ä»¶ã€æ–‡ä»¶å†…ä¿å­˜ç›¸å…³çš„"><a href="#15ã€åˆå§‹åŒ–é›†ç¾¤ï¼Œå¹¶ç”Ÿæˆkubeadm-initã€‚logæ–‡ä»¶ã€æ–‡ä»¶å†…ä¿å­˜ç›¸å…³çš„" class="headerlink" title="15ã€åˆå§‹åŒ–é›†ç¾¤ï¼Œå¹¶ç”Ÿæˆkubeadm-initã€‚logæ–‡ä»¶ã€æ–‡ä»¶å†…ä¿å­˜ç›¸å…³çš„"></a>15ã€åˆå§‹åŒ–é›†ç¾¤ï¼Œå¹¶ç”Ÿæˆkubeadm-initã€‚logæ–‡ä»¶ã€æ–‡ä»¶å†…ä¿å­˜ç›¸å…³çš„</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm init --config=kubeadm-config.yaml  --upload-certs | <span class="hljs-built_in">tee</span> kubeadm-init.log<br><br><span class="hljs-comment">#å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œé‡ç½®åå†æ¬¡åˆå§‹åŒ–ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</span><br>kubeadm reset -f ; ipvsadm --clear  ; <span class="hljs-built_in">rm</span> -rf ~/.kube<br></code></pre></td></tr></table></figure><h3 id="16ã€masterèŠ‚ç‚¹å®‰è£…calioç½‘ç»œç»„ä»¶"><a href="#16ã€masterèŠ‚ç‚¹å®‰è£…calioç½‘ç»œç»„ä»¶" class="headerlink" title="16ã€masterèŠ‚ç‚¹å®‰è£…calioç½‘ç»œç»„ä»¶"></a>16ã€masterèŠ‚ç‚¹å®‰è£…calioç½‘ç»œç»„ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://docs.projectcalico.org/v3.19/manifests/calico.yaml<br><br>kubectl apply -f calio.yaml<br></code></pre></td></tr></table></figure><h3 id="17ã€masterèŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ‰§è¡Œä»¥ä¸‹å‘½ä»¤"><a href="#17ã€masterèŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ‰§è¡Œä»¥ä¸‹å‘½ä»¤" class="headerlink" title="17ã€masterèŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ‰§è¡Œä»¥ä¸‹å‘½ä»¤"></a>17ã€masterèŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm <span class="hljs-built_in">join</span> apiserver.cluster.local:6443 --token abcdef.0123456789abcdef \<br>  --discovery-token-ca-cert-hash sha256:ec8b3f1b1b32b2fa55f69de41d22eb097e6c04805483dc3957155d2125670fc7 \<br>  --control-plane --certificate-key dffb9dbdbe5b60b775d390460147646a962a5a5d8b2965fa42cc581e533a4fe4<br></code></pre></td></tr></table></figure><h3 id="18ã€å„masteræœºå™¨æ‰§è¡Œ"><a href="#18ã€å„masteræœºå™¨æ‰§è¡Œ" class="headerlink" title="18ã€å„masteræœºå™¨æ‰§è¡Œ"></a>18ã€å„masteræœºå™¨æ‰§è¡Œ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br>sudo <span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br>sudo <span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br></code></pre></td></tr></table></figure><h3 id="19ã€å„masterèŠ‚ç‚¹åŠ å…¥ä»¥åä¿®æ”¹-x2F-etc-x2F-hostsæ–‡ä»¶"><a href="#19ã€å„masterèŠ‚ç‚¹åŠ å…¥ä»¥åä¿®æ”¹-x2F-etc-x2F-hostsæ–‡ä»¶" class="headerlink" title="19ã€å„masterèŠ‚ç‚¹åŠ å…¥ä»¥åä¿®æ”¹&#x2F;etc&#x2F;hostsæ–‡ä»¶"></a>19ã€å„masterèŠ‚ç‚¹åŠ å…¥ä»¥åä¿®æ”¹&#x2F;etc&#x2F;hostsæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/hosts<br>192.168.94.13X apiserver.cluster.local <span class="hljs-comment">#æ”¹æˆæœ¬æœºåœ°å€</span><br></code></pre></td></tr></table></figure><h3 id="å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼š"><a href="#å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼š" class="headerlink" title="å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼š"></a>å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼š</h3><h4 id="1ã€masterèŠ‚ç‚¹é”™è¯¯å¤„ç†ï¼š"><a href="#1ã€masterèŠ‚ç‚¹é”™è¯¯å¤„ç†ï¼š" class="headerlink" title="1ã€masterèŠ‚ç‚¹é”™è¯¯å¤„ç†ï¼š"></a>1ã€masterèŠ‚ç‚¹é”™è¯¯å¤„ç†ï¼š</h4><p>åœ¨1.20.2ç‰ˆæœ¬ä¸­,ä½¿ç”¨kubeadmè¿›è¡Œé›†ç¾¤åˆå§‹åŒ–æ—¶,è™½ç„¶å¯ä»¥æ­£å¸¸éƒ¨ç½²,ä½†æ˜¯æŸ¥çœ‹podæƒ…å†µçš„æ—¶å€™å¯ä»¥çœ‹åˆ°kube-proxyæ— æ³•è¿è¡ŒæˆåŠŸ ä¸€ç›´çŠ¶æ€ä¸ºï¼šCrashLoopBackOff</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl edit cm kube-proxy -n kube-system<br><span class="hljs-comment">#åœ¨ç¼–è¾‘æ¨¡å¼ä¸­æ‰¾åˆ°ä»¥ä¸‹å­—æ®µï¼Œåˆ é™¤åä¿å­˜</span><br>featureGates: <br>  SupportIPVSProxyMode: <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h4 id="2ã€kubectlæ£€æŸ¥ç»„ä»¶å¥åº·çŠ¶æ€å¼‚å¸¸å¤„ç†"><a href="#2ã€kubectlæ£€æŸ¥ç»„ä»¶å¥åº·çŠ¶æ€å¼‚å¸¸å¤„ç†" class="headerlink" title="2ã€kubectlæ£€æŸ¥ç»„ä»¶å¥åº·çŠ¶æ€å¼‚å¸¸å¤„ç†"></a>2ã€kubectlæ£€æŸ¥ç»„ä»¶å¥åº·çŠ¶æ€å¼‚å¸¸å¤„ç†</h4><p>é—®é¢˜æè¿°ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#kubectl get cs</span><br><span class="hljs-comment">#------------------------------------------------</span><br>Warning: v1 ComponentStatus is deprecated <span class="hljs-keyword">in</span> v1.19+<br>NAME                 STATUS      MESSAGE                                                                                       ERROR<br>controller-manager   Unhealthy   Get <span class="hljs-string">&quot;http://127.0.0.1:10252/healthz&quot;</span>: dial tcp 127.0.0.1:10252: connect: connection refused   <br>scheduler            Unhealthy   Get <span class="hljs-string">&quot;http://127.0.0.1:10251/healthz&quot;</span>: dial tcp 127.0.0.1:10251: connect: connection refused   <br>etcd-0               Healthy     &#123;<span class="hljs-string">&quot;health&quot;</span>:<span class="hljs-string">&quot;true&quot;</span>&#125; <br><span class="hljs-comment">#----------------------------------------------------</span><br></code></pre></td></tr></table></figure><p>é—®é¢˜è§£å†³:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /etc/kubernetes/manifests<br><br>vim kube-controller-manager.yaml   //æ³¨é‡Š --port=0<br>vim kube-scheduler.yaml   //æ³¨é‡Š --port=0<br><span class="hljs-comment">#é‡å¯kubeletæœåŠ¡ï¼Œå¦‚æœé›†ç¾¤è¿è¡Œå¾ˆä¹…ä¸å»ºè®®é‡å¯kubeletæœåŠ¡ï¼Œå¯ä»¥å¯¹kube-controller-managerã€kube-schedulerçš„deploymenté‡å¯</span><br>systemctl restart kubelet.service<br></code></pre></td></tr></table></figure><h3 id="20ã€nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ‰§è¡Œä»¥ä¸‹å‘½ä»¤"><a href="#20ã€nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ‰§è¡Œä»¥ä¸‹å‘½ä»¤" class="headerlink" title="20ã€nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ‰§è¡Œä»¥ä¸‹å‘½ä»¤"></a>20ã€nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm <span class="hljs-built_in">join</span> apiserver.cluster.local:6443 --token abcdef.0123456789abcdef \<br>  --discovery-token-ca-cert-hash sha256:4b79b65275442d2d42efb0b7d3b81fa42fbfdbfb21d2beab1659d9d1734a6100<br></code></pre></td></tr></table></figure><h3 id="21ã€åˆ›å»ºLVSæœåŠ¡ã€masteræœºå™¨åˆ›å»ºå¹¶æ‰§è¡Œ-å› ä¸ºéœ€è¦æ‰§è¡Œâ€œæ­¥éª¤22â€æ‰€ä»¥ä»¥ä¸‹å†…å®¹å¯ä»¥ä¸æ‰§è¡Œ"><a href="#21ã€åˆ›å»ºLVSæœåŠ¡ã€masteræœºå™¨åˆ›å»ºå¹¶æ‰§è¡Œ-å› ä¸ºéœ€è¦æ‰§è¡Œâ€œæ­¥éª¤22â€æ‰€ä»¥ä»¥ä¸‹å†…å®¹å¯ä»¥ä¸æ‰§è¡Œ" class="headerlink" title="21ã€åˆ›å»ºLVSæœåŠ¡ã€masteræœºå™¨åˆ›å»ºå¹¶æ‰§è¡Œ(å› ä¸ºéœ€è¦æ‰§è¡Œâ€œæ­¥éª¤22â€æ‰€ä»¥ä»¥ä¸‹å†…å®¹å¯ä»¥ä¸æ‰§è¡Œ)"></a>21ã€åˆ›å»ºLVSæœåŠ¡ã€masteræœºå™¨åˆ›å»ºå¹¶æ‰§è¡Œ(å› ä¸ºéœ€è¦æ‰§è¡Œâ€œæ­¥éª¤22â€æ‰€ä»¥ä»¥ä¸‹å†…å®¹å¯ä»¥ä¸æ‰§è¡Œ)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> kube-lvscare.yaml<br><span class="hljs-comment">#</span><br>apiVersion: apps/v1<br>kind: DaemonSet<br>metadata:<br>  name: kube-lvscare<br>  namespace: kube-system<br>spec:<br>  selector:<br>    matchLabels:<br>      component: kube-lvscare<br>  template:<br>    metadata:<br>      labels:<br>        component: kube-lvscare<br>        tier: control-plane<br>    spec:<br>      affinity:<br>        nodeAffinity:<br>          requiredDuringSchedulingIgnoredDuringExecution:<br>            nodeSelectorTerms:<br>            - matchExpressions:<br>              - key: node-role.kubernetes.io/master<br>                operator: DoesNotExist<br>      hostNetwork: <span class="hljs-literal">true</span><br>      priorityClassName: system-cluster-critical<br>      containers:<br>      - image: fanux/lvscare:v1.1.1<br>        imagePullPolicy: IfNotPresent<br>        name: kube-lvscare<br>        args:<br>        - care<br>        - --vs<br>        - 10.96.96.1:6443 <span class="hljs-comment">#å®šä¹‰çš„LVSè™šæ‹Ÿip</span><br>        - --rs<br>        - 192.168.94.131:6443  <span class="hljs-comment">#masterèŠ‚ç‚¹IPåœ°å€+6443ç«¯å£</span><br>        - --rs<br>        - 192.168.94.132:6443  <span class="hljs-comment">#masterèŠ‚ç‚¹IPåœ°å€+6443ç«¯å£</span><br>        - --rs<br>        - 192.168.94.133:6443  <span class="hljs-comment">#masterèŠ‚ç‚¹IPåœ°å€+6443ç«¯å£</span><br>        - --health-path<br>        - /healthz<br>        - --health-schem<br>        - https<br>        <span class="hljs-built_in">command</span>:<br>        - /usr/bin/lvscare<br>        resources: &#123;&#125;<br>        securityContext:<br>          privileged: <span class="hljs-literal">true</span><br>        volumeMounts:<br>        - mountPath: /lib/modules<br>          name: lib-modules<br>          readOnly: <span class="hljs-literal">true</span><br>      volumes:<br>      - hostPath:<br>          path: /lib/modules<br>          <span class="hljs-built_in">type</span>: <span class="hljs-string">&quot;&quot;</span><br>        name: lib-modules<br><br><span class="hljs-comment">#åˆ›å»ºç›¸å…³LVSæœåŠ¡</span><br>kubectl apply -f kube-lvscare.yaml<br></code></pre></td></tr></table></figure><h3 id="22ã€nodeèŠ‚ç‚¹é…ç½®æ·»åŠ yamlæ–‡ä»¶è®¾ç½®ï¼Œä¸åŠ çš„è¯æœåŠ¡å™¨é‡å¯ä»¥åæ— æ³•è‡ªåŠ¨å¯åŠ¨ç›¸å…³é•œåƒ"><a href="#22ã€nodeèŠ‚ç‚¹é…ç½®æ·»åŠ yamlæ–‡ä»¶è®¾ç½®ï¼Œä¸åŠ çš„è¯æœåŠ¡å™¨é‡å¯ä»¥åæ— æ³•è‡ªåŠ¨å¯åŠ¨ç›¸å…³é•œåƒ" class="headerlink" title="22ã€nodeèŠ‚ç‚¹é…ç½®æ·»åŠ yamlæ–‡ä»¶è®¾ç½®ï¼Œä¸åŠ çš„è¯æœåŠ¡å™¨é‡å¯ä»¥åæ— æ³•è‡ªåŠ¨å¯åŠ¨ç›¸å…³é•œåƒ"></a>22ã€nodeèŠ‚ç‚¹é…ç½®æ·»åŠ yamlæ–‡ä»¶è®¾ç½®ï¼Œä¸åŠ çš„è¯æœåŠ¡å™¨é‡å¯ä»¥åæ— æ³•è‡ªåŠ¨å¯åŠ¨ç›¸å…³é•œåƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> /etc/kubernetes/manifests/kube-lvscare.yaml<br><br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  creationTimestamp: null<br>  labels:<br>    component: kube-lvscare<br>    tier: control-plane<br>  name: kube-sealyun-lvscare<br>  namespace: kube-system<br>spec:<br>  containers:<br>  - <span class="hljs-built_in">command</span>:<br>    - /usr/bin/lvscare<br>    - care<br>    - --vs<br>    - 10.96.96.1:6443<br>    - --health-path<br>    - /healthz<br>    - --health-schem<br>    - https<br>    - --rs<br>    - 192.168.94.131:6443<br>    - --rs<br>    - 192.168.94.132:6443<br>    - --rs<br>    - 192.168.94.133:6443<br>    image: fanux/lvscare:latest<br>    imagePullPolicy: IfNotPresent<br>    name: kube-lvscaree<br>    resources: &#123;&#125;<br>    securityContext:<br>      privileged: <span class="hljs-literal">true</span><br>  hostNetwork: <span class="hljs-literal">true</span><br>  priorityClassName: system-cluster-critical<br>status: &#123;&#125;<br></code></pre></td></tr></table></figure><h3 id="23ã€å¯åŠ¨åä¿®æ”¹nodeèŠ‚ç‚¹hostsæ–‡ä»¶"><a href="#23ã€å¯åŠ¨åä¿®æ”¹nodeèŠ‚ç‚¹hostsæ–‡ä»¶" class="headerlink" title="23ã€å¯åŠ¨åä¿®æ”¹nodeèŠ‚ç‚¹hostsæ–‡ä»¶"></a>23ã€å¯åŠ¨åä¿®æ”¹nodeèŠ‚ç‚¹hostsæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/hosts<br>192.168.94.131 k8s-master-1<br>192.168.94.132 k8s-master-2<br>192.168.94.133 k8s-master-3<br>10.96.96.1 apiserver.cluster.local<br></code></pre></td></tr></table></figure><h3 id="24ã€kubectlè¡¥é½å‘½ä»¤"><a href="#24ã€kubectlè¡¥é½å‘½ä»¤" class="headerlink" title="24ã€kubectlè¡¥é½å‘½ä»¤"></a>24ã€kubectlè¡¥é½å‘½ä»¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> &lt;(kubectl completion bash)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; ~/.bashrc<br><br><span class="hljs-comment">#kubeadmè¡¥é½å‘½ä»¤</span><br><span class="hljs-built_in">source</span> &lt;(kubeadm completion bash)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;source &lt;(kubeadm completion bash)&quot;</span> &gt;&gt; ~/.bashrc<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>k8sç¯å¢ƒæ­å»º</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨kubeadmå®‰è£…Kubernetes 1.21.1</title>
    <link href="/2023/04/27/k8s/k8s%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85Kubernetes1.21.1/"/>
    <url>/2023/04/27/k8s/k8s%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85Kubernetes1.21.1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨kubeadmå®‰è£…Kubernetes-1-21-1"><a href="#ä½¿ç”¨kubeadmå®‰è£…Kubernetes-1-21-1" class="headerlink" title="ä½¿ç”¨kubeadmå®‰è£…Kubernetes 1.21.1"></a>ä½¿ç”¨kubeadmå®‰è£…Kubernetes 1.21.1</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å‚è€ƒæ–‡çŒ®ï¼šhttps://blog.51cto.com/u_13053917/2523020</span><br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€æœºå™¨è§„åˆ’ï¼š"><a href="#ä¸€ã€æœºå™¨è§„åˆ’ï¼š" class="headerlink" title="ä¸€ã€æœºå™¨è§„åˆ’ï¼š"></a>ä¸€ã€æœºå™¨è§„åˆ’ï¼š</h2><table><thead><tr><th>IPåœ°å€</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>192.168.94.121</td><td>k8s-master1</td></tr><tr><td>192.168.94.122</td><td>k8s-node1</td></tr><tr><td>192.168.94.123</td><td>k8s-node2</td></tr></tbody></table><p>æ³¨ï¼šCentOS 7.9 å†…æ ¸ç‰ˆæœ¬ 5.4.101  å¦‚æœæ²¡æœ‰çš„è¯ï¼Œè¯·å‡çº§å†…æ ¸</p><h2 id="äºŒã€æœºå™¨åˆå§‹åŒ–ï¼Œå„èŠ‚ç‚¹å‡éœ€è¦æ‰§è¡Œçš„å‡†å¤‡æ“ä½œ"><a href="#äºŒã€æœºå™¨åˆå§‹åŒ–ï¼Œå„èŠ‚ç‚¹å‡éœ€è¦æ‰§è¡Œçš„å‡†å¤‡æ“ä½œ" class="headerlink" title="äºŒã€æœºå™¨åˆå§‹åŒ–ï¼Œå„èŠ‚ç‚¹å‡éœ€è¦æ‰§è¡Œçš„å‡†å¤‡æ“ä½œ"></a>äºŒã€æœºå™¨åˆå§‹åŒ–ï¼Œå„èŠ‚ç‚¹å‡éœ€è¦æ‰§è¡Œçš„å‡†å¤‡æ“ä½œ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å…³é—­é˜²ç«å¢™å’Œselinux</span><br>systemctl stop firewalld &amp;&amp; systemctl <span class="hljs-built_in">disable</span> firewalld<br><br><span class="hljs-comment">#å…³é—­SELiunxå’Œswapåˆ†åŒº</span><br>swapoff -a &amp;&amp; sed -i <span class="hljs-string">&#x27;/ swap / s/^\(.*\)$/#\1/g&#x27;</span> /etc/fstab<br>setenforce 0 &amp;&amp; sed -i <span class="hljs-string">&#x27;s/^SELINUX=.*/SELINUX=disabled/&#x27;</span> /etc/selinux/config<br><br><span class="hljs-comment">#è®¾ç½®æ—¶é—´åŒæ­¥</span><br><span class="hljs-comment">#è°ƒæ•´ç³»ç»Ÿæ—¶åŒºä¸ºä¸­å›½/ä¸Šæµ·</span><br><span class="hljs-built_in">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<br><span class="hljs-comment"># å°†å½“å‰çš„ UTC æ—¶é—´å†™å…¥ç¡¬ä»¶æ—¶é’Ÿ</span><br>timedatectl set-local-rtc 0<br><span class="hljs-comment">#é‡å¯ä¾èµ–äºç³»ç»Ÿæ—¶é—´çš„æœåŠ¡</span><br>systemctl restart rsyslog<br>systemctl restart crond<br><span class="hljs-comment">#date æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´ hwclock --show æŸ¥çœ‹ç¡¬ä»¶æ—¶é—´</span><br><br><span class="hljs-comment">#æ‰€æœ‰èŠ‚ç‚¹é…ç½®IPVSæ¨¡å—</span><br><span class="hljs-comment">#å¼€å¯IPVS  </span><br><span class="hljs-comment">#æ³¨æ„ï¼šåœ¨å†…æ ¸4.19+ç‰ˆæœ¬nf_conntrack_ipv4å·²ç»æ”¹ä¸ºnf_conntrackï¼Œ4.18ä»¥ä¸‹ä½¿ç”¨nf_conntrack_ipv4å³å¯</span><br><span class="hljs-built_in">cat</span> &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">#!/bin/bash</span><br><span class="hljs-string">ipvs_modules=&quot;ip_vs ip_vs_lc ip_vs_wlc ip_vs_rr ip_vs_wrr ip_vs_lblc ip_vs_lblcr ip_vs_dh ip_vs_sh ip_vs_fo ip_vs_nq ip_vs_sed ip_vs_ftp nf_conntrack&quot;</span><br><span class="hljs-string">for kernel_module in \$&#123;ipvs_modules&#125;; </span><br><span class="hljs-string">do </span><br><span class="hljs-string">/sbin/modinfo -F filename \$&#123;kernel_module&#125; &gt; /dev/null 2&gt;&amp;1 </span><br><span class="hljs-string">if [ $? -eq 0 ]; then </span><br><span class="hljs-string">/sbin/modprobe \$&#123;kernel_module&#125; </span><br><span class="hljs-string">fi </span><br><span class="hljs-string">done</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-built_in">chmod</span> 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep ip_vs<br><br><span class="hljs-comment">#ä¿®æ”¹ä¸»æœºå</span><br>hostnamectl set-hostname k8s-master-1<br><br><span class="hljs-comment">#é…ç½®hostsæ–‡ä»¶</span><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">192.168.94.121  k8s-master1</span><br><span class="hljs-string">192.168.94.122  k8s-node1</span><br><span class="hljs-string">192.168.94.123  k8s-node2</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment">#è®¾ç½®å…å¯†ç™»å½•</span><br>ssh-keygen  <span class="hljs-comment">#ä¸€è·¯å›è½¦å³å¯</span><br>ssh-copy-id k8s-node1<br>ssh-copy-id k8s-node2<br><br><span class="hljs-comment">#æ‰€æœ‰èŠ‚ç‚¹é…ç½®k8så†…æ ¸</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/sysctl.d/k8s.conf</span><br><span class="hljs-string">net.ipv4.ip_forward = 1</span><br><span class="hljs-string">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="hljs-string">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="hljs-string">fs.may_detach_mounts = 1</span><br><span class="hljs-string">vm.overcommit_memory=1</span><br><span class="hljs-string">vm.panic_on_oom=0</span><br><span class="hljs-string">fs.inotify.max_user_watches=89100</span><br><span class="hljs-string">fs.file-max=52706963</span><br><span class="hljs-string">fs.nr_open=52706963</span><br><span class="hljs-string">net.netfilter.nf_conntrack_max=2310720</span><br><span class="hljs-string">net.ipv4.tcp_keepalive_time = 600</span><br><span class="hljs-string">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="hljs-string">net.ipv4.tcp_keepalive_intvl =15</span><br><span class="hljs-string">net.ipv4.tcp_max_tw_buckets = 36000</span><br><span class="hljs-string">net.ipv4.tcp_tw_reuse = 1</span><br><span class="hljs-string">net.ipv4.tcp_max_orphans = 327680</span><br><span class="hljs-string">net.ipv4.tcp_orphan_retries = 3</span><br><span class="hljs-string">net.ipv4.tcp_syncookies = 1</span><br><span class="hljs-string">net.ipv4.tcp_max_syn_backlog = 16384</span><br><span class="hljs-string">net.ipv4.ip_conntrack_max = 65536</span><br><span class="hljs-string">net.ipv4.tcp_max_syn_backlog = 16384</span><br><span class="hljs-string">net.ipv4.tcp_timestamps = 0</span><br><span class="hljs-string">net.core.somaxconn = 16384</span><br><span class="hljs-string">EOF</span><br><br>sysctl --system<br><br><span class="hljs-comment">#æ‰€æœ‰èŠ‚ç‚¹é…ç½®å®Œå†…æ ¸åï¼Œé‡å¯æœåŠ¡å™¨ï¼Œä¿è¯é‡å¯åå†…æ ¸ä¾æ—§åŠ è½½</span><br>lsmod | grep --color=auto -e ip_vs -e nf_conntrack<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£…Docker"><a href="#ä¸‰ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£…Docker" class="headerlink" title="ä¸‰ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£…Docker"></a>ä¸‰ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£…Docker</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install docker-ce -y<br><span class="hljs-comment">#ä¿®æ”¹ docker çš„ cgroup é©±åŠ¨ä¸º systemd</span><br><span class="hljs-built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;registry-mirrors&quot;: [&quot;http://f1361db2.m.daocloud.io&quot;],</span><br><span class="hljs-string">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span><br><span class="hljs-string">  &quot;log-driver&quot;: &quot;json-file&quot;,</span><br><span class="hljs-string">  &quot;log-opts&quot;: &#123;</span><br><span class="hljs-string">    &quot;max-size&quot;: &quot;100m&quot;</span><br><span class="hljs-string">  &#125;,</span><br><span class="hljs-string">  &quot;storage-driver&quot;: &quot;overlay2&quot;,</span><br><span class="hljs-string">  &quot;storage-opts&quot;: [</span><br><span class="hljs-string">    &quot;overlay2.override_kernel_check=true&quot;</span><br><span class="hljs-string">  ]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><br>systemctl daemon-reload &amp;&amp; systemctl <span class="hljs-built_in">enable</span> --now docker &amp;&amp; systemctl restart docker<br></code></pre></td></tr></table></figure><h2 id="å››ã€æ·»åŠ yumä»“åº“"><a href="#å››ã€æ·»åŠ yumä»“åº“" class="headerlink" title="å››ã€æ·»åŠ yumä»“åº“"></a>å››ã€æ·»åŠ yumä»“åº“</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[kubernetes]</span><br><span class="hljs-string">name=Kubernetes Repo</span><br><span class="hljs-string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="hljs-string">gpgcheck=1</span><br><span class="hljs-string">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h2 id="äº”ã€å®‰è£…kubernetes-ç›¸å…³ç»„ä»¶"><a href="#äº”ã€å®‰è£…kubernetes-ç›¸å…³ç»„ä»¶" class="headerlink" title="äº”ã€å®‰è£…kubernetes ç›¸å…³ç»„ä»¶"></a>äº”ã€å®‰è£…kubernetes ç›¸å…³ç»„ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install kubeadm-1.21.1 kubectl-1.21.1 kubelet-1.21.1 -y<br><br>systemctl <span class="hljs-built_in">enable</span> kubelet  <span class="hljs-comment">#æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œ</span><br><br></code></pre></td></tr></table></figure><h2 id="å…­ã€kubernetes-åˆå§‹åŒ–é›†ç¾¤"><a href="#å…­ã€kubernetes-åˆå§‹åŒ–é›†ç¾¤" class="headerlink" title="å…­ã€kubernetes åˆå§‹åŒ–é›†ç¾¤"></a>å…­ã€kubernetes åˆå§‹åŒ–é›†ç¾¤</h2><p><strong>masterèŠ‚ç‚¹æ‰§è¡Œ</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm config images list<br><span class="hljs-comment">#è¾“å‡ºï¼š</span><br>I0518 16:00:21.706704   18647 version.go:254] remote version is much newer: v1.21.1; falling back to: stable-1.20<br>k8s.gcr.io/kube-apiserver:v1.20.7<br>k8s.gcr.io/kube-controller-manager:v1.20.7<br>k8s.gcr.io/kube-scheduler:v1.20.7<br>k8s.gcr.io/kube-proxy:v1.20.7<br>k8s.gcr.io/pause:3.2<br>k8s.gcr.io/etcd:3.4.13-0<br>k8s.gcr.io/coredns:1.7.0<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm init --apiserver-advertise-address 192.168.94.121 \<br>--apiserver-bind-port 6443 \<br>--image-repository <span class="hljs-string">&quot;registry.aliyuncs.com/google_containers&quot;</span> \<br>--kubernetes-version <span class="hljs-string">&quot;v1.21.1&quot;</span> \<br>--pod-network-cidr <span class="hljs-string">&quot;10.244.0.0/16&quot;</span><br><br><span class="hljs-comment">#è¯¦ç»†è§£é‡Šï¼š</span><br>--kubernetes-version=v1.20.1ï¼šæŒ‡å®šè¦å®‰è£…çš„ç‰ˆæœ¬å·ã€‚è¿™ä¸ªç‰ˆæœ¬å·å¯ä»¥é€šè¿‡kubelet --versionæŸ¥çœ‹<br>--apiserver-advertise-addressï¼šæŒ‡å®šç”¨ Master çš„å“ªä¸ªIPåœ°å€ä¸ Clusterçš„å…¶ä»–èŠ‚ç‚¹é€šä¿¡ã€‚<br>--service-cidrï¼šæŒ‡å®šServiceç½‘ç»œçš„èŒƒå›´ï¼Œå³è´Ÿè½½å‡è¡¡VIPä½¿ç”¨çš„IPåœ°å€æ®µã€‚<br>--pod-network-cidrï¼šæŒ‡å®šPodç½‘ç»œçš„èŒƒå›´ï¼Œå³Podçš„IPåœ°å€æ®µã€‚<br>--ignore-preflight-errors=ï¼šå¿½ç•¥è¿è¡Œæ—¶çš„é”™è¯¯ï¼Œä¾‹å¦‚æ‰§è¡Œæ—¶å­˜åœ¨[ERROR NumCPU]å’Œ[ERROR Swap]ï¼Œå¿½ç•¥è¿™ä¸¤ä¸ªæŠ¥é”™å°±æ˜¯å¢åŠ --ignore-preflight-errors=NumCPU å’Œ--ignore-preflight-errors=Swapçš„é…ç½®å³å¯ã€‚<br>--image-repositoryï¼šKubenetesé»˜è®¤Registriesåœ°å€æ˜¯ k8s.gcr.ioï¼Œä¸€èˆ¬åœ¨å›½å†…å¹¶ä¸èƒ½è®¿é—® gcr.ioï¼Œå¯ä»¥å°†å…¶æŒ‡å®šä¸ºé˜¿é‡Œäº‘é•œåƒåœ°å€ï¼šregistry.aliyuncs.com/google_containersã€‚<br></code></pre></td></tr></table></figure><p><strong>ä¿å­˜è¾“å‡ºçš„è¯¥åŠ å…¥å†…å®¹</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm <span class="hljs-built_in">join</span> 192.168.94.198:6443 --token xdtfmh.4vk8hiw8lyviu76w \<br>    --discovery-token-ca-cert-hash sha256:3c6e9295f148dff2fd80ca75f4278afa8656bcba08b1770b46712c618a40e4dd<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå¦‚æœå®‰è£…å¤±è´¥ï¼Œå¯ä»¥æ‰§è¡Œ kubeadm reset å‘½ä»¤å°†ä¸»æœºæ¢å¤åŸçŠ¶ï¼Œé‡æ–°æ‰§è¡Œ kubeadm init å‘½ä»¤å†æ¬¡è¿›è¡Œå®‰è£…</p><p><strong>kubectlé»˜è®¤ä¼šåœ¨æ‰§è¡Œçš„ç”¨æˆ·å®¶ç›®å½•ä¸‹é¢çš„.kubeç›®å½•ä¸‹å¯»æ‰¾configæ–‡ä»¶ã€‚è¿™é‡Œæ˜¯å°†åœ¨åˆå§‹åŒ–æ—¶[kubeconfig]æ­¥éª¤ç”Ÿæˆçš„admin.confæ‹·è´åˆ°.kube&#x2F;configã€‚</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br>sudo <span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br>sudo <span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br></code></pre></td></tr></table></figure><h2 id="äº”ã€å®‰è£…ç½‘ç»œæ’ä»¶flannel"><a href="#äº”ã€å®‰è£…ç½‘ç»œæ’ä»¶flannel" class="headerlink" title="äº”ã€å®‰è£…ç½‘ç»œæ’ä»¶flannel"></a>äº”ã€å®‰è£…ç½‘ç»œæ’ä»¶flannel</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml<br><span class="hljs-comment">#ä»¥ä¸‹ä¸ºè¾“å‡º:</span><br>podsecuritypolicy.policy/psp.flannel.unprivileged created<br>clusterrole.rbac.authorization.k8s.io/flannel created<br>clusterrolebinding.rbac.authorization.k8s.io/flannel created<br>serviceaccount/flannel created<br>configmap/kube-flannel-cfg created<br>daemonset.apps/kube-flannel-ds-amd64 created<br>daemonset.apps/kube-flannel-ds-arm64 created<br>daemonset.apps/kube-flannel-ds-arm created<br>daemonset.apps/kube-flannel-ds-ppc64le created<br>daemonset.apps/kube-flannel-ds-s390x created<br></code></pre></td></tr></table></figure><h2 id="å…­ã€nodeèŠ‚ç‚¹åŠ å…¥master"><a href="#å…­ã€nodeèŠ‚ç‚¹åŠ å…¥master" class="headerlink" title="å…­ã€nodeèŠ‚ç‚¹åŠ å…¥master"></a>å…­ã€nodeèŠ‚ç‚¹åŠ å…¥master</h2><p><strong>nodeèŠ‚ç‚¹æ‰§è¡Œ</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubeadm <span class="hljs-built_in">join</span> 192.168.94.198:6443 --token xdtfmh.4vk8hiw8lyviu76w \<br>    --discovery-token-ca-cert-hash sha256:3c6e9295f148dff2fd80ca75f4278afa8656bcba08b1770b46712c618a40e4dd<br></code></pre></td></tr></table></figure><p>é”™è¯¯æç¤ºï¼šERROR FileContentâ€“proc-sys-net-bridge-bridge-nf-call-iptables<br>è®¾ç½®é”™è¯¯å¯¼è‡´K8så®‰è£…å¤±è´¥å¤„ç†æ–¹æ³•<code>echo &quot;1&quot; &gt;/proc/sys/net/bridge/bridge-nf-call-iptables</code></p><h2 id="ä¸ƒã€éªŒè¯"><a href="#ä¸ƒã€éªŒè¯" class="headerlink" title="ä¸ƒã€éªŒè¯"></a>ä¸ƒã€éªŒè¯</h2><p><strong>åœ¨masteræœºå™¨ä¸Šæ‰§è¡Œ</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl get nodes                                <span class="hljs-comment">#æ‰€æœ‰æœºå™¨å‡ä¸ºreadyå³å¯</span><br>kubectl get pod -owide --all-namespaces          <span class="hljs-comment">#æ‰€æœ‰podå‡ä¸ºrunningå³å¯</span><br></code></pre></td></tr></table></figure><h2 id="å…«ã€é…ç½®kubectlå­å‘½ä»¤è¡¥å…¨"><a href="#å…«ã€é…ç½®kubectlå­å‘½ä»¤è¡¥å…¨" class="headerlink" title="å…«ã€é…ç½®kubectlå­å‘½ä»¤è¡¥å…¨"></a>å…«ã€é…ç½®kubectlå­å‘½ä»¤è¡¥å…¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¡¥é½å‘½ä»¤ä¸€</span><br><span class="hljs-built_in">source</span> &lt;(kubectl completion bash)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; ~/.bashrc<br><br><span class="hljs-comment">#è¡¥é½å‘½ä»¤äºŒ</span><br>yum install -y bash-completion<br><span class="hljs-built_in">source</span> /usr/share/bash-completion/bash_completion<br><span class="hljs-built_in">source</span> &lt;(kubectl completion bash)<br>kubectl completion bash &gt; ~/.kube/completion.bash.inc<br><span class="hljs-built_in">source</span> <span class="hljs-string">&#x27;/root/.kube/completion.bash.inc&#x27;</span>  <br><span class="hljs-built_in">source</span> <span class="hljs-variable">$HOME</span>/.bash_profile<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>k8sç¯å¢ƒæ­å»º</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerå®¹å™¨çš„å®æ—¶æ—¥å¿—æŸ¥çœ‹å™¨Dozzle</title>
    <link href="/2023/04/25/docker/docker%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/(Dozzle)%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E6%97%B6%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E5%99%A8/"/>
    <url>/2023/04/25/docker/docker%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/(Dozzle)%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E6%97%B6%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="dockerå®¹å™¨çš„å®æ—¶æ—¥å¿—æŸ¥çœ‹å™¨Dozzle"><a href="#dockerå®¹å™¨çš„å®æ—¶æ—¥å¿—æŸ¥çœ‹å™¨Dozzle" class="headerlink" title="dockerå®¹å™¨çš„å®æ—¶æ—¥å¿—æŸ¥çœ‹å™¨Dozzle"></a>dockerå®¹å™¨çš„å®æ—¶æ—¥å¿—æŸ¥çœ‹å™¨<code>Dozzle</code></h1><p>å¤‡æ³¨ï¼šDozzleæ˜¯ä¸€ä¸ªç®€å•ã€è½»é‡çº§çš„åº”ç”¨ç¨‹åºï¼Œå®ƒä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªåŸºäºwebçš„ç•Œé¢æ¥å®æ—¶ç›‘è§†Dockerå®¹å™¨æ—¥å¿—ã€‚å®ƒä¸å­˜å‚¨æ—¥å¿—ä¿¡æ¯ï¼Œåªç”¨äºå®æ—¶ç›‘è§†å®¹å™¨æ—¥å¿—ã€‚<br>å¯¹äºä¼ä¸šåº”ç”¨ç¨‹åºï¼ŒLogglyã€Papertrailæˆ–Kibanaç­‰äº§å“æ›´é€‚åˆã€‚</p><h2 id="ä¸€ã€ä½¿ç”¨dockerè¿è¡Œæ—¥å¿—æŸ¥çœ‹å™¨Dozzle"><a href="#ä¸€ã€ä½¿ç”¨dockerè¿è¡Œæ—¥å¿—æŸ¥çœ‹å™¨Dozzle" class="headerlink" title="ä¸€ã€ä½¿ç”¨dockerè¿è¡Œæ—¥å¿—æŸ¥çœ‹å™¨Dozzle"></a>ä¸€ã€ä½¿ç”¨dockerè¿è¡Œæ—¥å¿—æŸ¥çœ‹å™¨<code>Dozzle</code></h2><h3 id="1ã€æ‹‰å–é•œåƒ"><a href="#1ã€æ‹‰å–é•œåƒ" class="headerlink" title="1ã€æ‹‰å–é•œåƒ"></a>1ã€æ‹‰å–é•œåƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull amir20/dozzle:latest<br></code></pre></td></tr></table></figure><h3 id="2ã€è¿è¡Œé•œåƒ"><a href="#2ã€è¿è¡Œé•œåƒ" class="headerlink" title="2ã€è¿è¡Œé•œåƒ"></a>2ã€è¿è¡Œé•œåƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d  --name dozzle \<br>--volume=/var/run/docker.sock:/var/run/docker.sock:ro \<br>-p 8888:8080 \<br>-e DOZZLE_KEY=<span class="hljs-string">&quot;TOKEN_KEY&quot;</span> \<br>-e DOZZLE_USERNAME=<span class="hljs-string">&quot;admin&quot;</span> \<br>-e DOZZLE_PASSWORD=<span class="hljs-string">&quot;123456&quot;</span> \<br>amir20/dozzle:latest<br><br><span class="hljs-comment">#:ro å»ºè®®åŠ ä¸Š ro åªè¯»çš„é™åˆ¶ï¼Œé¿å…å‡ºç°ä¸€äº›æˆ‘ä»¬ä¸å¸Œæœ›å‡ºç°çš„æ„å¤–æƒ…å†µ</span><br><span class="hljs-comment">#å¯è®¿é—®http://localhost:8888/æ‚¨å¯ä»¥å°†-p 8888æ›´æ”¹ä¸ºä»»ä½•ç«¯å£ï¼Œä½¿ç”¨è´¦å·å¯†ç ç™»å½•</span><br></code></pre></td></tr></table></figure><h2 id="äºŒã€ä½¿ç”¨docker-composeè¿è¡Œ"><a href="#äºŒã€ä½¿ç”¨docker-composeè¿è¡Œ" class="headerlink" title="äºŒã€ä½¿ç”¨docker-composeè¿è¡Œ"></a>äºŒã€ä½¿ç”¨docker-composeè¿è¡Œ</h2><p><code>å‚è€ƒæ–‡æ¡£ï¼šhttps://zhuanlan.zhihu.com/p/295007308</code></p><h3 id="1ã€ç¼–å†™yamlæ–‡ä»¶"><a href="#1ã€ç¼–å†™yamlæ–‡ä»¶" class="headerlink" title="1ã€ç¼–å†™yamlæ–‡ä»¶"></a>1ã€ç¼–å†™yamlæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br>version: <span class="hljs-string">&quot;3&quot;</span><br><br>services:<br>  dozzle:<br>    image: amir20/dozzle:latest<br>    container_name: dozzle<br>    environment:<br>      DOZZLE_FILTER: <span class="hljs-string">&quot;name=redis|etcd&quot;</span>  <span class="hljs-comment">#å®¹å™¨è¿‡æ»¤æ¡ä»¶</span><br>      DOZZLE_KEY: <span class="hljs-string">&quot;TOKEN_KEY&quot;</span>           <span class="hljs-comment">#TOKEN</span><br>      DOZZLE_USERNAME: <span class="hljs-string">&quot;admin&quot;</span>          <span class="hljs-comment">#ç™»å½•ç”¨æˆ·å</span><br>      DOZZLE_PASSWORD: <span class="hljs-string">&quot;123456&quot;</span>         <span class="hljs-comment">#ç™»å½•å¯†ç </span><br>    volumes:<br>      - /var/run/docker.sock:/var/run/docker.sock:ro<br>    ports:<br>      - 8080:8080<br>    restart: always<br></code></pre></td></tr></table></figure><h3 id="2ã€å¯åŠ¨å®¹å™¨"><a href="#2ã€å¯åŠ¨å®¹å™¨" class="headerlink" title="2ã€å¯åŠ¨å®¹å™¨"></a>2ã€å¯åŠ¨å®¹å™¨</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker-compose up -d</span><br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€å…¶ä»–å‚æ•°çš„è§£é‡Š"><a href="#ä¸‰ã€å…¶ä»–å‚æ•°çš„è§£é‡Š" class="headerlink" title="ä¸‰ã€å…¶ä»–å‚æ•°çš„è§£é‡Š"></a>ä¸‰ã€å…¶ä»–å‚æ•°çš„è§£é‡Š</h2><h3 id="1ã€é™åˆ¶æ˜¾ç¤ºçš„å®¹å™¨-filterå‚æ•°"><a href="#1ã€é™åˆ¶æ˜¾ç¤ºçš„å®¹å™¨-filterå‚æ•°" class="headerlink" title="1ã€é™åˆ¶æ˜¾ç¤ºçš„å®¹å™¨:--filterå‚æ•°"></a>1ã€é™åˆ¶æ˜¾ç¤ºçš„å®¹å™¨:<code>--filter</code>å‚æ•°</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run --volume=/var/run/docker.sock:/var/run/docker.sock -p 8888:8080 amir20/dozzle:latest --filter name=fpm*<br><span class="hljs-comment">#å¯ä»¥ä½¿ç”¨å…¶ä»–è¿‡æ»¤å™¨-status</span><br></code></pre></td></tr></table></figure><h3 id="2ã€Dozzle-é»˜è®¤åˆ°â€œ-x2F-â€å¦‚æœè¦æ§åˆ¶è®¿é—®åŸºæœ¬è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨è¯¥-baseé€‰é¡¹"><a href="#2ã€Dozzle-é»˜è®¤åˆ°â€œ-x2F-â€å¦‚æœè¦æ§åˆ¶è®¿é—®åŸºæœ¬è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨è¯¥-baseé€‰é¡¹" class="headerlink" title="2ã€Dozzle é»˜è®¤åˆ°â€œ&#x2F;â€å¦‚æœè¦æ§åˆ¶è®¿é—®åŸºæœ¬è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨è¯¥--baseé€‰é¡¹"></a>2ã€Dozzle é»˜è®¤åˆ°â€œ&#x2F;â€å¦‚æœè¦æ§åˆ¶è®¿é—®åŸºæœ¬è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨è¯¥<code>--base</code>é€‰é¡¹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run --volume=/var/run/docker.sock:/var/run/docker.sock -p 8080:8080 amir20/dozzle:latest --base /foobar<br><span class="hljs-comment">#å°†éœ€è¦è®¿é—®http://localhost:8080/foobar/æ‰å¯ä»¥ä½¿ç”¨Dozzle</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>dockeré—®é¢˜è§£å†³</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>docker-compose</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntuç³»ç»Ÿå®‰è£…å’Œä½¿ç”¨</title>
    <link href="/2023/04/24/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Ubuntu%E7%B3%BB%E7%BB%9F/Ubuntu%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/04/24/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Ubuntu%E7%B3%BB%E7%BB%9F/Ubuntu%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Ubuntuç³»ç»Ÿå®‰è£…å’Œä½¿ç”¨"><a href="#Ubuntuç³»ç»Ÿå®‰è£…å’Œä½¿ç”¨" class="headerlink" title="Ubuntuç³»ç»Ÿå®‰è£…å’Œä½¿ç”¨"></a>Ubuntuç³»ç»Ÿå®‰è£…å’Œä½¿ç”¨</h1><h2 id="ä¸€ã€serverç‰ˆæœ¬å®‰è£…å‚è€ƒæ–‡æ¡£å³å¯"><a href="#ä¸€ã€serverç‰ˆæœ¬å®‰è£…å‚è€ƒæ–‡æ¡£å³å¯" class="headerlink" title="ä¸€ã€serverç‰ˆæœ¬å®‰è£…å‚è€ƒæ–‡æ¡£å³å¯"></a>ä¸€ã€serverç‰ˆæœ¬å®‰è£…å‚è€ƒæ–‡æ¡£å³å¯</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">serverç‰ˆå®‰è£…ï¼šhttps:<span class="hljs-regexp">//</span>www.jianshu.com<span class="hljs-regexp">/p/</span><span class="hljs-number">4</span>fcf185bcb29<br>serverç‰ˆå®‰è£…ï¼šhttps:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_42289214/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">106585790</span><br></code></pre></td></tr></table></figure><h2 id="äºŒã€ä¿®æ”¹Ubuntuç³»ç»Ÿip"><a href="#äºŒã€ä¿®æ”¹Ubuntuç³»ç»Ÿip" class="headerlink" title="äºŒã€ä¿®æ”¹Ubuntuç³»ç»Ÿip"></a>äºŒã€ä¿®æ”¹Ubuntuç³»ç»Ÿip</h2><p><code>å‚è€ƒæ–‡æ¡£ï¼šhttps://www.jb51.net/article/187746.htm</code></p><p>12.Xç‰ˆæœ¬ã€14.Xç‰ˆæœ¬ã€16.Xç‰ˆæœ¬:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/network/interfaces<br>auto lo<br>iface lo inet loopback<br> <br>auto ens33<br>iface ens33 inet static<br>address 192.168.94.179<br>netmask 255.255.255.0<br>gateway 192.168.94.2<br></code></pre></td></tr></table></figure><p>18.Xç‰ˆæœ¬åŠä»¥ä¸Š:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/netplan/00-installer-config.yaml<br><span class="hljs-comment"># Let NetworkManager manage all devices on this system</span><br>network:<br> version: 2<br> renderer: NetworkManager<br> ethernets:<br>   ens33:<br>    dhcp4: <span class="hljs-literal">false</span><br>    addresses: [192.168.94.179/24]<br>    gateway4: 192.168.94.2<br>    nameservers:<br>        addresses: [8.8.8.8,114.114.114.114]<br></code></pre></td></tr></table></figure><p>å¯åŠ¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo netplan apply<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€ubuntuç³»ç»Ÿæ›´æ¢é•œåƒæº"><a href="#ä¸‰ã€ubuntuç³»ç»Ÿæ›´æ¢é•œåƒæº" class="headerlink" title="ä¸‰ã€ubuntuç³»ç»Ÿæ›´æ¢é•œåƒæº"></a>ä¸‰ã€ubuntuç³»ç»Ÿæ›´æ¢é•œåƒæº</h2><p><code>lsb_release -a</code>æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬å·ï¼Œæˆ‘çš„ä¸ºï¼šV20.04</p><p>å¤‡ä»½åŸæ¥é•œåƒæº:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mv</span> /etc/apt/sources.list /etc/apt/sources.list.bak<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/apt/sources.list </span><br><span class="hljs-string">deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="hljs-string">deb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="hljs-string"></span><br><span class="hljs-string">deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="hljs-string">deb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="hljs-string"></span><br><span class="hljs-string">deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="hljs-string">deb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="hljs-string"></span><br><span class="hljs-string">deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="hljs-string">deb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="hljs-string"></span><br><span class="hljs-string">deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="hljs-string">deb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><p>æ›´æ–°å’Œå‡çº§</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get update<br>sudo apt-get upgrade<br></code></pre></td></tr></table></figure><h2 id="å››ã€Ubuntuä½¿ç”¨å®šæ—¶ä»»åŠ¡cron"><a href="#å››ã€Ubuntuä½¿ç”¨å®šæ—¶ä»»åŠ¡cron" class="headerlink" title="å››ã€Ubuntuä½¿ç”¨å®šæ—¶ä»»åŠ¡cron"></a>å››ã€Ubuntuä½¿ç”¨å®šæ—¶ä»»åŠ¡cron</h2><p>å¯åŠ¨cron</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">service cron start<br></code></pre></td></tr></table></figure><p>å¦‚æœå¿˜è®°é€‰æ‹©ç¼–è¾‘å™¨ï¼Œç„¶åé€‰æ‹©å¯¹åº”çš„vimåºå·ä¿å­˜</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo select-edito<br><br>é»˜è®¤çš„ç¼–è¾‘å™¨æ¨¡å¼æ˜¯nanoã€‚æ“ä½œä¸ºï¼š<br>ä¿å­˜ï¼šCtrl+o<br>ç¡®è®¤ä¿å­˜ï¼š Y<br>ç„¶åå›è½¦ï¼šenter<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>liunx</category>
      
      <category>Ubuntu</category>
      
    </categories>
    
    
    <tags>
      
      <tag>liunx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>debianç³»ç»Ÿçš„é—®é¢˜å¤„ç†</title>
    <link href="/2023/04/24/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Debian%E7%B3%BB%E7%BB%9F/debian%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/"/>
    <url>/2023/04/24/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Debian%E7%B3%BB%E7%BB%9F/debian%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="debianç³»ç»Ÿçš„é—®é¢˜å¤„ç†"><a href="#debianç³»ç»Ÿçš„é—®é¢˜å¤„ç†" class="headerlink" title="debianç³»ç»Ÿçš„é—®é¢˜å¤„ç†"></a>debianç³»ç»Ÿçš„é—®é¢˜å¤„ç†</h1><h2 id="ä¸€ã€ç³»ç»Ÿé…ç½®IPåœ°å€"><a href="#ä¸€ã€ç³»ç»Ÿé…ç½®IPåœ°å€" class="headerlink" title="ä¸€ã€ç³»ç»Ÿé…ç½®IPåœ°å€"></a>ä¸€ã€ç³»ç»Ÿé…ç½®IPåœ°å€</h2><h3 id="1-ç½‘å¡é€šè¿‡DHCPè‡ªåŠ¨è·å–IPåœ°å€é…ç½®ï¼š"><a href="#1-ç½‘å¡é€šè¿‡DHCPè‡ªåŠ¨è·å–IPåœ°å€é…ç½®ï¼š" class="headerlink" title="1.ç½‘å¡é€šè¿‡DHCPè‡ªåŠ¨è·å–IPåœ°å€é…ç½®ï¼š"></a>1.ç½‘å¡é€šè¿‡DHCPè‡ªåŠ¨è·å–IPåœ°å€é…ç½®ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/network/interfaces<br><span class="hljs-comment"># This file describes the network interfaces available on your system  </span><br><span class="hljs-comment"># and how to activate them. For more information, see interfaces(5).  </span><br><span class="hljs-comment"># </span><br><span class="hljs-comment"># The loopback network interfaceï¼ˆé…ç½®ç¯å›å£ï¼‰  </span><br><span class="hljs-comment"># å¼€æœºè‡ªåŠ¨æ¿€loæ¥å£  </span><br>auto lo  <br><span class="hljs-comment"># é…ç½®loæ¥å£ä¸ºç¯å›å£  </span><br>iface lo inet loopback  <br><span class="hljs-comment">#  </span><br><span class="hljs-comment"># The primary network interface ï¼ˆé…ç½®ä¸»ç½‘ç»œæ¥å£ï¼‰  </span><br><span class="hljs-comment">#å¼€æœºè‡ªåŠ¨æ¿€æ´»eth0æ¥å£  </span><br>auto enss  <br><span class="hljs-comment">#é…ç½®eth0æ¥å£ä¸ºDHCPè‡ªåŠ¨è·å–  </span><br>iface enss inet dhcp       <br></code></pre></td></tr></table></figure><h3 id="2-ç½‘å¡é™æ€åˆ†é…IPåœ°å€"><a href="#2-ç½‘å¡é™æ€åˆ†é…IPåœ°å€" class="headerlink" title="2.ç½‘å¡é™æ€åˆ†é…IPåœ°å€"></a>2.ç½‘å¡é™æ€åˆ†é…IPåœ°å€</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/network/interfaces<br><span class="hljs-comment"># This file describes the network interfaces available on your system </span><br><span class="hljs-comment"># and how to activate them. For more information, see interfaces(5). </span><br><span class="hljs-comment"># </span><br><span class="hljs-comment"># The loopback network interfaceï¼ˆé…ç½®ç¯å›å£ï¼‰ </span><br><span class="hljs-comment"># å¼€æœºè‡ªåŠ¨æ¿€loæ¥å£ </span><br>auto lo <br><span class="hljs-comment"># é…ç½®loæ¥å£ä¸ºç¯å›å£ </span><br>iface lo inet loopback <br><span class="hljs-comment"># </span><br><span class="hljs-comment"># The primary network interface ï¼ˆé…ç½®ä¸»ç½‘ç»œæ¥å£ï¼‰ </span><br><span class="hljs-comment">#å¼€æœºè‡ªåŠ¨æ¿€æ´»eth0æ¥å£ </span><br>auto enss <br><span class="hljs-comment">#é…ç½®eth0æ¥å£ä¸ºé™æ€è®¾ç½®IPåœ°å€ </span><br>iface enss inet static <br>address 192.168.94.111<br>netmask 255.255.255.0 <br>gateway 192.168.94.2<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">service networking restart  é‡å¯æœåŠ¡<br></code></pre></td></tr></table></figure><h2 id="äºŒã€debianç³»ç»Ÿé»˜è®¤ä¸å…è®¸rootç™»å½•ï¼Œè®¾ç½®é»˜è®¤ç”¨rootç”¨æˆ·ç™»å½•"><a href="#äºŒã€debianç³»ç»Ÿé»˜è®¤ä¸å…è®¸rootç™»å½•ï¼Œè®¾ç½®é»˜è®¤ç”¨rootç”¨æˆ·ç™»å½•" class="headerlink" title="äºŒã€debianç³»ç»Ÿé»˜è®¤ä¸å…è®¸rootç™»å½•ï¼Œè®¾ç½®é»˜è®¤ç”¨rootç”¨æˆ·ç™»å½•"></a>äºŒã€debianç³»ç»Ÿé»˜è®¤ä¸å…è®¸rootç™»å½•ï¼Œè®¾ç½®é»˜è®¤ç”¨rootç”¨æˆ·ç™»å½•</h2><h3 id="1ã€å…ˆä½¿ç”¨æ™®é€šè´¦å·ç™»å½•ä»¥å"><a href="#1ã€å…ˆä½¿ç”¨æ™®é€šè´¦å·ç™»å½•ä»¥å" class="headerlink" title="1ã€å…ˆä½¿ç”¨æ™®é€šè´¦å·ç™»å½•ä»¥å"></a>1ã€å…ˆä½¿ç”¨æ™®é€šè´¦å·ç™»å½•ä»¥å</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">su - root <br></code></pre></td></tr></table></figure><h3 id="2ã€ä½¿ç”¨viå‘½ä»¤ä¿®æ”¹gdm3çš„è®¾å®šæ–‡ä»¶"><a href="#2ã€ä½¿ç”¨viå‘½ä»¤ä¿®æ”¹gdm3çš„è®¾å®šæ–‡ä»¶" class="headerlink" title="2ã€ä½¿ç”¨viå‘½ä»¤ä¿®æ”¹gdm3çš„è®¾å®šæ–‡ä»¶"></a>2ã€ä½¿ç”¨viå‘½ä»¤ä¿®æ”¹gdm3çš„è®¾å®šæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/gdm3/daemon.conf<br><span class="hljs-comment">#æ‰¾åˆ°[security],å¹¶åœ¨ä¸‹é¢è¿½åŠ ä¸€è¡Œï¼š</span><br>AllowRoot = ture<br></code></pre></td></tr></table></figure><h3 id="3ã€ä½¿ç”¨viå‘½ä»¤ä¿®æ”¹gdm3çš„ç™»å½•pamæ–‡ä»¶"><a href="#3ã€ä½¿ç”¨viå‘½ä»¤ä¿®æ”¹gdm3çš„ç™»å½•pamæ–‡ä»¶" class="headerlink" title="3ã€ä½¿ç”¨viå‘½ä»¤ä¿®æ”¹gdm3çš„ç™»å½•pamæ–‡ä»¶"></a>3ã€ä½¿ç”¨viå‘½ä»¤ä¿®æ”¹gdm3çš„ç™»å½•pamæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/pam.d/gdm-password<br><span class="hljs-comment">#æ‰¾åˆ°å¦‚ä¸‹è¡Œæ•°æ®è¿›è¡Œæ³¨é‡Šï¼š</span><br>authrequiredpam_succeed_if.so user != root quiet_success  <br></code></pre></td></tr></table></figure><h3 id="4ã€é‡å¯æœºå™¨"><a href="#4ã€é‡å¯æœºå™¨" class="headerlink" title="4ã€é‡å¯æœºå™¨"></a>4ã€é‡å¯æœºå™¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">reboot <br></code></pre></td></tr></table></figure><p><strong>æ³¨ï¼šå¦‚æœè¦å®ç°rootç”¨æˆ·è¿œç¨‹sshç™»å½•ï¼Œè¿˜éœ€è¦ä¿®æ”¹<code>/etc/ssh/sshd_config</code>æ–‡ä»¶</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/ssh/sshd_config<br><span class="hljs-comment">#æ‰¾åˆ°å¦‚ä¸‹è¡Œä¿¡æ¯ï¼š</span><br>PermitRootLogin prohibit-password<br><span class="hljs-comment">#å°†é…ç½®æ”¹ä¸ºï¼šPermitRootLogin yes</span><br><br><span class="hljs-comment">#å†é‡å¯ï¼š</span><br>service sshd restart<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€å®˜æ–¹æºæ¢ä¸ºå›½å†…çš„æºçš„æ“ä½œæ–¹æ³•"><a href="#ä¸‰ã€å®˜æ–¹æºæ¢ä¸ºå›½å†…çš„æºçš„æ“ä½œæ–¹æ³•" class="headerlink" title="ä¸‰ã€å®˜æ–¹æºæ¢ä¸ºå›½å†…çš„æºçš„æ“ä½œæ–¹æ³•"></a>ä¸‰ã€å®˜æ–¹æºæ¢ä¸ºå›½å†…çš„æºçš„æ“ä½œæ–¹æ³•</h2><h3 id="1ã€å°†åŸæ¥çš„é•œåƒæºè¿›è¡Œå¤‡ä»½"><a href="#1ã€å°†åŸæ¥çš„é•œåƒæºè¿›è¡Œå¤‡ä»½" class="headerlink" title="1ã€å°†åŸæ¥çš„é•œåƒæºè¿›è¡Œå¤‡ä»½"></a>1ã€å°†åŸæ¥çš„é•œåƒæºè¿›è¡Œå¤‡ä»½</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> /etc/apt/sources.list /etc/apt/sources.list.bak<br></code></pre></td></tr></table></figure><h3 id="2ã€å†™å…¥å›½å†…çš„é•œåƒæº"><a href="#2ã€å†™å…¥å›½å†…çš„é•œåƒæº" class="headerlink" title="2ã€å†™å…¥å›½å†…çš„é•œåƒæº"></a>2ã€å†™å…¥å›½å†…çš„é•œåƒæº</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/apt/sources.list </span><br><span class="hljs-string">deb http://mirrors.ustc.edu.cn/debian/ buster main</span><br><span class="hljs-string">deb-src http://mirrors.ustc.edu.cn/debian/ buster main</span><br><span class="hljs-string"></span><br><span class="hljs-string">deb http://security.debian.org/debian-security buster/updates main</span><br><span class="hljs-string">deb-src http://security.debian.org/debian-security buster/updates main</span><br><span class="hljs-string">deb http://mirrors.ustc.edu.cn/debian/ buster-updates main</span><br><span class="hljs-string">deb-src http://mirrors.ustc.edu.cn/debian/ buster-updates main</span><br><span class="hljs-string">deb http://mirrors.ustc.edu.cn/debian/ buster-backports main non-free contrib</span><br><span class="hljs-string">deb-src http://mirrors.ustc.edu.cn/debian/ buster-backports main non-free contrib</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment">#ç½‘æ˜“163é•œåƒæºï¼š</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/apt/sources.list </span><br><span class="hljs-string">deb http://mirrors.163.com/debian/ buster main non-free contrib</span><br><span class="hljs-string">deb http://mirrors.163.com/debian/ buster-updates main non-free contrib</span><br><span class="hljs-string">deb http://mirrors.163.com/debian/ buster-backports main non-free contrib</span><br><span class="hljs-string">deb http://mirrors.163.com/debian-security/ buster/updates main non-free contrib</span><br><span class="hljs-string"></span><br><span class="hljs-string">deb-src http://mirrors.163.com/debian/ buster main non-free contrib</span><br><span class="hljs-string">deb-src http://mirrors.163.com/debian/ buster-updates main non-free contrib</span><br><span class="hljs-string">deb-src http://mirrors.163.com/debian/ buster-backports main non-free contrib</span><br><span class="hljs-string">deb-src http://mirrors.163.com/debian-security/ buster/updates main non-free contrib</span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment">#åä¸ºäº‘é•œåƒæºï¼š</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/apt/sources.list </span><br><span class="hljs-string">deb https://mirrors.huaweicloud.com/debian/ buster main contrib non-free</span><br><span class="hljs-string">deb https://mirrors.huaweicloud.com/debian/ buster-updates main contrib non-free</span><br><span class="hljs-string">deb https://mirrors.huaweicloud.com/debian/ buster-backports main contrib non-free</span><br><span class="hljs-string">deb https://mirrors.huaweicloud.com/debian-security/ buster/updates main contrib non-free</span><br><span class="hljs-string"></span><br><span class="hljs-string">deb-src https://mirrors.huaweicloud.com/debian/ buster main contrib non-free</span><br><span class="hljs-string">deb-src https://mirrors.huaweicloud.com/debian/ buster-updates main contrib non-free</span><br><span class="hljs-string">deb-src https://mirrors.huaweicloud.com/debian/ buster-backports main contrib non-free </span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment">#è…¾è®¯äº‘é•œåƒæºï¼š</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/apt/sources.list </span><br><span class="hljs-string">deb http://mirrors.cloud.tencent.com/debian/ buster main non-free contrib</span><br><span class="hljs-string">deb http://mirrors.cloud.tencent.com/debian-security buster/updates main</span><br><span class="hljs-string">deb http://mirrors.cloud.tencent.com/debian/ buster-updates main non-free contrib</span><br><span class="hljs-string">deb http://mirrors.cloud.tencent.com/debian/ buster-backports main non-free contrib</span><br><span class="hljs-string"></span><br><span class="hljs-string">deb-src http://mirrors.cloud.tencent.com/debian-security buster/updates main</span><br><span class="hljs-string">deb-src http://mirrors.cloud.tencent.com/debian/ buster main non-free contrib</span><br><span class="hljs-string">deb-src http://mirrors.cloud.tencent.com/debian/ buster-updates main non-free contrib</span><br><span class="hljs-string">deb-src http://mirrors.cloud.tencent.com/debian/ buster-backports main non-free contrib</span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment">#é˜¿é‡Œäº‘é•œåƒæº</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/apt/sources.list </span><br><span class="hljs-string">deb http://mirrors.aliyun.com/debian/ buster main non-free contrib</span><br><span class="hljs-string">deb http://mirrors.aliyun.com/debian-security buster/updates main</span><br><span class="hljs-string">deb http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib</span><br><span class="hljs-string">deb http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib</span><br><span class="hljs-string"></span><br><span class="hljs-string">deb-src http://mirrors.aliyun.com/debian-security buster/updates main</span><br><span class="hljs-string">deb-src http://mirrors.aliyun.com/debian/ buster main non-free contrib</span><br><span class="hljs-string">deb-src http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib</span><br><span class="hljs-string">deb-src http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib</span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment">#æ¸…åå¤§å­¦é•œåƒæº</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/apt/sources.list </span><br><span class="hljs-string">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free</span><br><span class="hljs-string">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free</span><br><span class="hljs-string">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free</span><br><span class="hljs-string">deb https://mirrors.tuna.tsinghua.edu.cn/debian-security/ buster/updates main contrib non-free</span><br><span class="hljs-string"></span><br><span class="hljs-string">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free</span><br><span class="hljs-string">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free</span><br><span class="hljs-string">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free</span><br><span class="hljs-string">deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security/ buster/updates main contrib non-free</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h3 id="3ã€è¿›è¡Œæ›´æ–°"><a href="#3ã€è¿›è¡Œæ›´æ–°" class="headerlink" title="3ã€è¿›è¡Œæ›´æ–°"></a>3ã€è¿›è¡Œæ›´æ–°</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">apt-get update<br></code></pre></td></tr></table></figure><p>å¦‚æœé‡åˆ°æ— æ³•æ‹‰å– https æºçš„æƒ…å†µï¼Œè¯·å…ˆä½¿ç”¨ http æºå¹¶å®‰è£…ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common<br></code></pre></td></tr></table></figure><p>æ³¨ï¼š<br>ä¸€ä¸ªç³»ç»Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªæºï¼Œä½†æ˜¯ä¸å»ºè®®é‚£ä¹ˆåšï¼Œå¦‚æœæƒ³åŒæ—¶ä½¿ç”¨å¤šä¸ªæºåªéœ€è¦åœ¨å·²æœ‰æºçš„åŸºç¡€ä¸Šè¿½åŠ å³å¯ï¼Œå¦å¤–è¿˜å¯ä»¥åœ¨<code>/etc/apt/sources.list.d/</code>è¿™ä¸ªç›®å½•æ–°å»ºç‹¬ç«‹æºé…ç½®æ–‡ä»¶<br>å…¨çƒé•œåƒç½‘ç«™ï¼š<code>https://www.debian.org/mirror/list</code><br>æœ¬æ–‡å‚è€ƒæ–‡çŒ®ï¼š<code>https://blog.csdn.net/qq_36154886/article/details/107878853</code></p><h2 id="å››ã€debiansç³»ç»Ÿä½¿ç”¨çš„æ˜¯ï¼šapt-getå‘½ä»¤æ‹‰å–ã€ä»–çš„ä½¿ç”¨è·ŸCentosç³»ç»Ÿä¸€æ ·"><a href="#å››ã€debiansç³»ç»Ÿä½¿ç”¨çš„æ˜¯ï¼šapt-getå‘½ä»¤æ‹‰å–ã€ä»–çš„ä½¿ç”¨è·ŸCentosç³»ç»Ÿä¸€æ ·" class="headerlink" title="å››ã€debiansç³»ç»Ÿä½¿ç”¨çš„æ˜¯ï¼šapt-getå‘½ä»¤æ‹‰å–ã€ä»–çš„ä½¿ç”¨è·ŸCentosç³»ç»Ÿä¸€æ ·"></a>å››ã€debiansç³»ç»Ÿä½¿ç”¨çš„æ˜¯ï¼šapt-getå‘½ä»¤æ‹‰å–ã€ä»–çš„ä½¿ç”¨è·ŸCentosç³»ç»Ÿä¸€æ ·</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">apt-get install openssh-client <br></code></pre></td></tr></table></figure><p>å¦‚æœä¸­é€”å‡ºç°ä¸‹è½½ä¸åˆ°æ–‡ä»¶ï¼Œåˆ™æ›´æ–°ä¸‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">apt-get update<br></code></pre></td></tr></table></figure><h2 id="äº”ã€apt-install-nginx-æ—¶å‡ºç°ï¼š-dpkg-å¤„ç†è½¯ä»¶åŒ…-nginx-full-â€“configure-æ—¶å‡ºé”™ï¼š"><a href="#äº”ã€apt-install-nginx-æ—¶å‡ºç°ï¼š-dpkg-å¤„ç†è½¯ä»¶åŒ…-nginx-full-â€“configure-æ—¶å‡ºé”™ï¼š" class="headerlink" title="äº”ã€apt install nginx æ—¶å‡ºç°ï¼š #dpkg: å¤„ç†è½¯ä»¶åŒ… nginx-full (â€“configure)æ—¶å‡ºé”™ï¼š"></a>äº”ã€apt install nginx æ—¶å‡ºç°ï¼š #dpkg: å¤„ç†è½¯ä»¶åŒ… nginx-full (â€“configure)æ—¶å‡ºé”™ï¼š</h2><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mv</span> /var/lib/dpkg/info  /var/lib/dpkg/info_bak<br><span class="hljs-built_in">mkdir</span> /var/lib/dpkg/info<br>apt-get update &amp;&amp; apt-get -f install <br>apt install nginx<br></code></pre></td></tr></table></figure><p>å¦‚æœå®‰è£…nginxåè®¿é—®80ç«¯å£æœ‰é—®é¢˜ï¼ŒæŸ¥çœ‹<code>/etc/nginx/nginx.conf</code>å†…åŒçº§çš„<code>sites-available sites-enabled</code>é‡Œé¢æœ‰2ä¸ªdefaulté…ç½®ï¼Œç›´æ¥åˆ é™¤æ‰</p><h2 id="å…­ã€å®‰è£…nginxä»¥åï¼Œå¯åŠ¨æ—¶å‘ç°80ç«¯å£è¢«å ç”¨ï¼Œéœ€è¦å¸è½½apache2çš„è¯"><a href="#å…­ã€å®‰è£…nginxä»¥åï¼Œå¯åŠ¨æ—¶å‘ç°80ç«¯å£è¢«å ç”¨ï¼Œéœ€è¦å¸è½½apache2çš„è¯" class="headerlink" title="å…­ã€å®‰è£…nginxä»¥åï¼Œå¯åŠ¨æ—¶å‘ç°80ç«¯å£è¢«å ç”¨ï¼Œéœ€è¦å¸è½½apache2çš„è¯"></a>å…­ã€å®‰è£…nginxä»¥åï¼Œå¯åŠ¨æ—¶å‘ç°80ç«¯å£è¢«å ç”¨ï¼Œéœ€è¦å¸è½½apache2çš„è¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">lsof -i:80  <span class="hljs-comment">#å‘ç°æ˜¯apache2å ç”¨</span><br>systemctl stop apache2.service  <span class="hljs-comment">#å…³é—­æœåŠ¡</span><br><span class="hljs-comment"># å¸è½½å‘½ä»¤</span><br>apt-get --purge remove apache2<br>apt-get --purge remove apache2-doc<br>apt-get --purge remove apache2-utils<br><span class="hljs-comment">#æ£€æµ‹æ˜¯å¦å¸è½½å¹²å‡€</span><br><br>dpkg -l | grep apache2<br><span class="hljs-comment">#åˆ é™¤å¤šä½™çš„æ–‡ä»¶</span><br>find /etc -name <span class="hljs-string">&quot;*apache*&quot;</span> |xargs  <span class="hljs-built_in">rm</span> -rf <br><span class="hljs-built_in">rm</span> -rf /var/www<br><span class="hljs-built_in">rm</span> -rf /etc/libapache2-mod-j<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>liunx</category>
      
      <category>debian</category>
      
    </categories>
    
    
    <tags>
      
      <tag>liunx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AlmaLinux 9.0å®‰è£…ä¸é…ç½®</title>
    <link href="/2023/04/24/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Almaliunx/AlmaLinux%209.0%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/"/>
    <url>/2023/04/24/A-%E5%90%84liunx%E7%B3%BB%E7%BB%9F/Almaliunx/AlmaLinux%209.0%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="AlmaLinux-9-0å®‰è£…ä¸é…ç½®"><a href="#AlmaLinux-9-0å®‰è£…ä¸é…ç½®" class="headerlink" title="AlmaLinux 9.0å®‰è£…ä¸é…ç½®"></a>AlmaLinux 9.0å®‰è£…ä¸é…ç½®</h1><h2 id="ä¸€-å®‰è£…"><a href="#ä¸€-å®‰è£…" class="headerlink" title="ä¸€ å®‰è£…"></a>ä¸€ å®‰è£…</h2><h3 id="1-1-é•œåƒæº"><a href="#1-1-é•œåƒæº" class="headerlink" title="1.1 é•œåƒæº"></a>1.1 é•œåƒæº</h3><p>å®˜ç½‘ä¸‹è½½é•œåƒ <code>https://mirrors.almalinux.org/isos/x86_64/9.0.html</code></p><h3 id="1-2-å®‰è£…"><a href="#1-2-å®‰è£…" class="headerlink" title="1.2 å®‰è£…"></a>1.2 å®‰è£…</h3><p><strong>å‚è€ƒcentoså®‰è£…æ–¹å¼</strong>*</p><h2 id="äºŒ-é…ç½®"><a href="#äºŒ-é…ç½®" class="headerlink" title="äºŒ é…ç½®"></a>äºŒ é…ç½®</h2><h3 id="2-1-ä¿®æ”¹æº"><a href="#2-1-ä¿®æ”¹æº" class="headerlink" title="2.1 ä¿®æ”¹æº"></a>2.1 ä¿®æ”¹æº</h3><p>æŸ¥æ‰¾åˆé€‚çš„é•œåƒæºï¼Œå¦‚:mirrors.aliyun.com</p><p>æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œå¤‡ä»½å¹¶æ›¿æ¢é»˜è®¤æº</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">sed -e <span class="hljs-string">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> \<br>  -e <span class="hljs-string">&#x27;s|^# baseurl=https://repo.almalinux.org|baseurl=https://mirrors.aliyun.com|g&#x27;</span> \<br>  -i.bak \<br>  /etc/yum.repos.d/almalinux*.repo<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ç”Ÿæˆç¼“å­˜</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">dnf makecache<br></code></pre></td></tr></table></figure><h3 id="2-2-ä¿®æ”¹è¯­è¨€ç¯å¢ƒ"><a href="#2-2-ä¿®æ”¹è¯­è¨€ç¯å¢ƒ" class="headerlink" title="2.2 ä¿®æ”¹è¯­è¨€ç¯å¢ƒ"></a>2.2 ä¿®æ”¹è¯­è¨€ç¯å¢ƒ</h3><p>ä¿®æ”¹&#x2F;etcç›®å½•ä¸‹locale.confæ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/locale.conf<br><br>LANG=<span class="hljs-string">&quot;en_US.UTF-8&quot;</span><br></code></pre></td></tr></table></figure><h3 id="2-3-ä¿®æ”¹ä¸»æœºå"><a href="#2-3-ä¿®æ”¹ä¸»æœºå" class="headerlink" title="2.3  ä¿®æ”¹ä¸»æœºå"></a>2.3  ä¿®æ”¹ä¸»æœºå</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">hostnamectl set-hostname ä¸»æœºå<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>liunx</category>
      
      <category>AlmaLinux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>liunx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetesé‡Œçš„ä¸‰ç§portä¸ä¸‰ç§ipåŒºåˆ†</title>
    <link href="/2023/04/21/k8s/k8s%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/Kubernetes%E9%87%8C%E7%9A%84%E4%B8%89%E7%A7%8Dport%E4%B8%8E%E4%B8%89%E7%A7%8Dip%E5%8C%BA%E5%88%86/"/>
    <url>/2023/04/21/k8s/k8s%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/Kubernetes%E9%87%8C%E7%9A%84%E4%B8%89%E7%A7%8Dport%E4%B8%8E%E4%B8%89%E7%A7%8Dip%E5%8C%BA%E5%88%86/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Kubernetesé‡Œçš„ä¸‰ç§portä¸ä¸‰ç§ipåŒºåˆ†"><a href="#Kubernetesé‡Œçš„ä¸‰ç§portä¸ä¸‰ç§ipåŒºåˆ†" class="headerlink" title="Kubernetesé‡Œçš„ä¸‰ç§portä¸ä¸‰ç§ipåŒºåˆ†"></a>Kubernetesé‡Œçš„ä¸‰ç§portä¸ä¸‰ç§ipåŒºåˆ†</h1><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">k8s</span>ä¸­çš„serviceæä¾›äº†ä¸€å±‚å¯¹å¤–çš„æœåŠ¡æŠ½è±¡ã€‚Kubernetesçš„Serviceå®šä¹‰äº†ä¸€ç§æŠ½è±¡ï¼šé€»è¾‘ä¸Šçš„ä¸€ç»„Podï¼Œä¸€ç§å¯ä»¥è®¿é—®å®ƒä»¬çš„æ–¹å¼ã€‚è¿™ä¸€ç»„Podèƒ½é€šè¿‡Serviceè¢«è®¿é—®åˆ°ï¼Œé€šè¿‡æ˜¯é€šè¿‡Selectoræ¥å®ç°çš„ã€‚<br><br>ç®€å•æ¥è¯´Serviceå°±æ˜¯ä¸€ä¸ªæŠŠæ‰€æœ‰Podç»Ÿä¸€æˆä¸€ä¸ªç»„ï¼Œç„¶åå¯¹å¤–æä¾›å›ºå®šä¸€ä¸ª<span class="hljs-built_in">IP</span>ï¼Œå…·ä½“æ˜¯å“ªäº›Podï¼Œå¯ä»¥é€šè¿‡ä¹‹å‰ä»‹ç»åˆ°çš„Labelæ ‡ç­¾æ¥è¿›è¡Œè®¾ç½®ï¼Œå‡è®¾ä¸€ä¸ªpodæ­»æ‰ï¼Œå‰¯æœ¬æ§åˆ¶å™¨åœ¨ç”Ÿæˆä¸€ä¸ªpod,è¿™æ˜¯pod <span class="hljs-built_in">ip</span>è‚¯å®šä¼šå˜ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å»å…³å¿ƒä½ pod <span class="hljs-built_in">ip</span>æ˜¯å¤šå°‘ï¼Œæˆ‘ä»¬åªçŸ¥é“service <span class="hljs-built_in">ip</span> æ²¡å˜å°±å¥½äº†ï¼Œå› ä¸ºæ–°çš„pod æ—©å°±åŠ å…¥åˆ°æˆ‘çš„serviceä¸­äº†ï¼Œå„ä¸ªæœåŠ¡ä¹‹é—´é€šä¿¡æ˜¯é€šè¿‡service å”¯ä¸€<span class="hljs-built_in">ip</span>æ¥é€šä¿¡çš„ã€‚<br></code></pre></td></tr></table></figure><h2 id="Kubernetesé‡Œçš„ä¸‰ç§portåˆ†åˆ«å¦‚ä¸‹"><a href="#Kubernetesé‡Œçš„ä¸‰ç§portåˆ†åˆ«å¦‚ä¸‹" class="headerlink" title="Kubernetesé‡Œçš„ä¸‰ç§portåˆ†åˆ«å¦‚ä¸‹:"></a>Kubernetesé‡Œçš„ä¸‰ç§portåˆ†åˆ«å¦‚ä¸‹:</h2><h3 id="NodePort"><a href="#NodePort" class="headerlink" title="NodePort"></a>NodePort</h3><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-title">nodeport</span>æ˜¯å¤–éƒ¨æµé‡è®¿é—®<span class="hljs-type">K8s</span>çš„ä¸€ç§æ–¹å¼ï¼Œå³nodeIP:nodePortï¼Œæ˜¯æä¾›ç»™å¤–éƒ¨æµé‡è®¿é—®<span class="hljs-type">K8s</span>é›†ç¾¤èµ„æºçš„ä¸€ç§æ–¹å¼ã€‚æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨serviceä¸­é…ç½®node<span class="hljs-keyword">port</span>ï¼Œä»è€Œä½¿å¾—æˆ‘ä»¬å¯ä»¥é€šè¿‡é›†ç¾¤å¤–çš„æœºå™¨è¿›è¡Œè®¿é—®æˆ‘ä»¬çš„æœåŠ¡ã€‚<br></code></pre></td></tr></table></figure><h3 id="Port"><a href="#Port" class="headerlink" title="Port"></a>Port</h3><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vhdl"><span class="hljs-keyword">port</span>æ˜¯K8sé›†ç¾¤å†…éƒ¨æœåŠ¡è®¿é—®serviceçš„å…¥å£ã€‚æ˜¯serviceæš´éœ²åœ¨Clusterä¸Šçš„ç«¯å£ï¼ŒClusterIP:<span class="hljs-keyword">Port</span>ã€‚å¦‚ä¸‹é¢çš„yamlé…ç½®æ–‡ä»¶æ‰€ç¤ºï¼ŒK8sé›†ç¾¤å†…éƒ¨èŠ‚ç‚¹å¯ä»¥é€šè¿‡<span class="hljs-number">30080</span>ç«¯å£è®¿é—®NginxæœåŠ¡ï¼Œç„¶è€Œå¤–éƒ¨ç½‘ç»œè¿˜æ˜¯ä¸èƒ½å¤Ÿè®¿é—®åˆ°æœåŠ¡ï¼Œå› ä¸ºnodePortå‚æ•°æ²¡æœ‰é…ç½®ã€‚<br></code></pre></td></tr></table></figure><h3 id="targetPort"><a href="#targetPort" class="headerlink" title="targetPort"></a>targetPort</h3><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-title">targetPort</span>æ˜¯å®¹å™¨çš„ç«¯å£ï¼Œä¹Ÿæ˜¯æœ€ç»ˆåº•å±‚çš„æœåŠ¡æ‰€æä¾›çš„ç«¯å£ï¼Œæ‰€ä»¥è¯´targetPodä¹Ÿå°±æ˜¯<span class="hljs-type">Pod</span>çš„ç«¯å£ã€‚ä»<span class="hljs-keyword">port</span>æˆ–è€…æ˜¯nodePortè¿›å…¥çš„æµé‡ï¼Œç»è¿‡è·¯ç”±è½¬å‘ä¹‹åï¼Œæœ€ç»ˆéƒ½ä¼šéƒ½é€šè¿‡targetPortè¿›å…¥åˆ°Podä¸­ã€‚<br><br>targetPortè¦ä¸Dockerfileä¸­æš´éœ²çš„ç«¯å£ä¸€è‡´ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">apiVersion:</span> v1<br><span class="hljs-symbol">kind:</span> Service<br><span class="hljs-symbol">metadata:</span><br><span class="hljs-symbol"> name:</span> nginx-service<br><span class="hljs-symbol">spec:</span><br><span class="hljs-symbol"> type:</span> NodePort         <span class="hljs-comment">// é…ç½®ä¸ºNodePortï¼Œå¤–éƒ¨å¯ä»¥è®¿é—®</span><br><span class="hljs-symbol"> ports:</span><br> - port: <span class="hljs-number">30080</span>          <span class="hljs-comment">// å®¹å™¨é—´ï¼ŒæœåŠ¡è°ƒç”¨çš„ç«¯å£</span><br><span class="hljs-symbol">   targetPort:</span> <span class="hljs-number">80</span>       <span class="hljs-comment">// å®¹å™¨æš´éœ²çš„ç«¯å£ï¼Œä¸Dockerfileæš´éœ²ç«¯å£ä¿æŒä¸€è‡´</span><br><span class="hljs-symbol">   nodePort:</span> <span class="hljs-number">30001</span>      <span class="hljs-comment">// NodePortï¼Œå¤–éƒ¨è®¿é—®çš„ç«¯å£,å¦‚æœä¸æ˜¾ç¤ºæŒ‡å®šï¼Œk8sä¼šéšæœºåˆ†é…ä¸€ä¸ªç«¯å£</span><br><span class="hljs-symbol"> selector:</span><br><span class="hljs-symbol">  name:</span> nginx-pod<br></code></pre></td></tr></table></figure><h2 id="Kubernetesé›†ç¾¤é‡Œæœ‰ä¸‰ç§IPåœ°å€ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š"><a href="#Kubernetesé›†ç¾¤é‡Œæœ‰ä¸‰ç§IPåœ°å€ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š" class="headerlink" title="Kubernetesé›†ç¾¤é‡Œæœ‰ä¸‰ç§IPåœ°å€ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š"></a>Kubernetesé›†ç¾¤é‡Œæœ‰ä¸‰ç§IPåœ°å€ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">Node</span> <span class="hljs-built_in">IP</span>ï¼šNodeèŠ‚ç‚¹çš„<span class="hljs-built_in">IP</span>åœ°å€ï¼Œå³ç‰©ç†ç½‘å¡çš„<span class="hljs-built_in">IP</span>åœ°å€ã€‚<br><span class="hljs-symbol">Pod</span> <span class="hljs-built_in">IP</span>ï¼šPodçš„<span class="hljs-built_in">IP</span>åœ°å€ï¼Œå³dockerå®¹å™¨çš„<span class="hljs-built_in">IP</span>åœ°å€ï¼Œæ­¤ä¸ºè™šæ‹Ÿ<span class="hljs-built_in">IP</span>åœ°å€ã€‚<br><span class="hljs-symbol">Cluster</span> <span class="hljs-built_in">IP</span>ï¼šServiceçš„<span class="hljs-built_in">IP</span>åœ°å€ï¼Œæ­¤ä¸ºè™šæ‹Ÿ<span class="hljs-built_in">IP</span>åœ°å€ã€‚<br></code></pre></td></tr></table></figure><h3 id="Node-IP"><a href="#Node-IP" class="headerlink" title="Node IP"></a>Node IP</h3><p>å¯ä»¥æ˜¯ç‰©ç†æœºçš„IPï¼ˆä¹Ÿå¯èƒ½æ˜¯è™šæ‹ŸæœºIPï¼‰ã€‚æ¯ä¸ªServiceéƒ½ä¼šåœ¨NodeèŠ‚ç‚¹ä¸Šå¼€é€šä¸€ä¸ªç«¯å£ï¼Œå¤–éƒ¨å¯ä»¥é€šè¿‡NodeIP:NodePortå³å¯è®¿é—®Serviceé‡Œçš„Pod,å’Œæˆ‘ä»¬è®¿é—®æœåŠ¡å™¨éƒ¨ç½²çš„é¡¹ç›®ä¸€æ ·ï¼ŒIP:ç«¯å£&#x2F;é¡¹ç›®åã€‚</p><p>åœ¨kubernetesæŸ¥è¯¢Node IPï¼š</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-number">1</span>.kubectl get nodes<br><span class="hljs-number">2</span>.kubectl describe <span class="hljs-keyword">node</span> <span class="hljs-title">nodeName</span><br><span class="hljs-number">3</span>.æ˜¾ç¤ºå‡ºæ¥çš„InternalIPå°±æ˜¯NodeIP<br></code></pre></td></tr></table></figure><h3 id="Pod-IP"><a href="#Pod-IP" class="headerlink" title="Pod IP"></a>Pod IP</h3><p>Pod IPæ˜¯æ¯ä¸ªPodçš„IPåœ°å€ï¼Œä»–æ˜¯Docker Engineæ ¹æ®dockerç½‘æ¡¥çš„IPåœ°å€æ®µè¿›è¡Œåˆ†é…çš„ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„äºŒå±‚ç½‘ç»œã€‚</p><p>åŒServiceä¸‹çš„podå¯ä»¥ç›´æ¥æ ¹æ®PodIPç›¸äº’é€šä¿¡ã€‚<br>ä¸åŒServiceä¸‹çš„podåœ¨é›†ç¾¤é—´podé€šä¿¡è¦å€ŸåŠ©äº cluster ipã€‚<br>podå’Œé›†ç¾¤å¤–é€šä¿¡ï¼Œè¦å€ŸåŠ©äºnode ipã€‚</p><p>åœ¨kubernetesæŸ¥è¯¢Pod IPï¼š</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-number">1.</span>kubectl <span class="hljs-built_in">get</span> pods<br><span class="hljs-number">2.</span>kubectl <span class="hljs-built_in">describe</span> pod podName<br></code></pre></td></tr></table></figure><h3 id="Cluster-IP"><a href="#Cluster-IP" class="headerlink" title="Cluster IP"></a>Cluster IP</h3><p>Serviceçš„IPåœ°å€ï¼Œæ­¤ä¸ºè™šæ‹ŸIPåœ°å€ã€‚å¤–éƒ¨ç½‘ç»œæ— æ³•pingé€šï¼Œåªæœ‰kubernetesé›†ç¾¤å†…éƒ¨è®¿é—®ä½¿ç”¨ã€‚<br>åœ¨kubernetesæŸ¥è¯¢Cluster IP: </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubectl -n å‘½åç©ºé—´ <span class="hljs-built_in">get</span> Service<br></code></pre></td></tr></table></figure><p>Cluster IPæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„IPï¼Œä½†æ›´åƒæ˜¯ä¸€ä¸ªä¼ªé€ çš„IPç½‘ç»œï¼ŒåŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹:</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-number">1</span>.Cluster <span class="hljs-built_in">IP</span>ä»…ä»…ä½œç”¨äºKubernetes Serviceè¿™ä¸ªå¯¹è±¡ï¼Œå¹¶ç”±Kubernetesç®¡ç†å’Œåˆ†é…Påœ°å€<br><br><span class="hljs-number">2</span>.Cluster <span class="hljs-built_in">IP</span>æ— æ³•è¢«pingï¼Œä»–æ²¡æœ‰ä¸€ä¸ªâ€œå®ä½“ç½‘ç»œå¯¹è±¡â€æ¥å“åº”<br><br><span class="hljs-number">3</span>.Cluster <span class="hljs-built_in">IP</span>åªèƒ½ç»“åˆService Portç»„æˆä¸€ä¸ªå…·ä½“çš„é€šä¿¡ç«¯å£ï¼Œå•ç‹¬çš„Cluster <span class="hljs-built_in">IP</span>ä¸å…·å¤‡é€šä¿¡çš„åŸºç¡€ï¼Œå¹¶ä¸”ä»–ä»¬å±äºKubernetesé›†ç¾¤è¿™æ ·ä¸€ä¸ªå°é—­çš„ç©ºé—´ã€‚<br><br><span class="hljs-number">4</span>.åœ¨ä¸åŒServiceä¸‹çš„podèŠ‚ç‚¹åœ¨é›†ç¾¤é—´ç›¸äº’è®¿é—®å¯ä»¥é€šè¿‡Cluster <span class="hljs-built_in">IP</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>k8såŸºç¡€æ¦‚å¿µ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äºŒè¿›åˆ¶å®‰è£…k8s</title>
    <link href="/2023/04/20/k8s/k8s%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/k8s_V1.20%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/"/>
    <url>/2023/04/20/k8s/k8s%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/k8s_V1.20%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="äºŒè¿›åˆ¶å®‰è£…k8s"><a href="#äºŒè¿›åˆ¶å®‰è£…k8s" class="headerlink" title="äºŒè¿›åˆ¶å®‰è£…k8s"></a>äºŒè¿›åˆ¶å®‰è£…k8s</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">å‚è€ƒæ–‡çŒ®:https:<span class="hljs-regexp">//</span>blog.<span class="hljs-number">51</span>cto.com<span class="hljs-regexp">/13053917/</span><span class="hljs-number">2596613</span><span class="hljs-comment">#h22</span><br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€å‰è¨€ï¼š"><a href="#ä¸€ã€å‰è¨€ï¼š" class="headerlink" title="ä¸€ã€å‰è¨€ï¼š"></a>ä¸€ã€å‰è¨€ï¼š</h2><h3 id="kubernetesçš„äº”ä¸ªç»„ä»¶ï¼š"><a href="#kubernetesçš„äº”ä¸ªç»„ä»¶ï¼š" class="headerlink" title="kubernetesçš„äº”ä¸ªç»„ä»¶ï¼š"></a>kubernetesçš„äº”ä¸ªç»„ä»¶ï¼š</h3><h4 id="masterèŠ‚ç‚¹çš„ä¸‰ä¸ªç»„ä»¶ï¼š"><a href="#masterèŠ‚ç‚¹çš„ä¸‰ä¸ªç»„ä»¶ï¼š" class="headerlink" title="masterèŠ‚ç‚¹çš„ä¸‰ä¸ªç»„ä»¶ï¼š"></a>masterèŠ‚ç‚¹çš„ä¸‰ä¸ªç»„ä»¶ï¼š</h4><ul><li>kube-apiserver:æ•´ä¸ªé›†ç¾¤çš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ã€‚</li><li>kube-controller-manager:æ§åˆ¶å™¨ç®¡ç†å™¨,è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ã€‚ä¿è¯èµ„æºåˆ°è¾¾æœŸæœ›å€¼ã€‚</li><li>kube-schedulerï¼šè°ƒåº¦å™¨,ç»è¿‡ç­–ç•¥è°ƒåº¦PODåˆ°åˆé€‚çš„èŠ‚ç‚¹ä¸Šé¢è¿è¡Œã€‚åˆ†åˆ«æœ‰é¢„é€‰ç­–ç•¥å’Œä¼˜é€‰ç­–ç•¥ã€‚</li></ul><h4 id="nodeèŠ‚ç‚¹çš„ä¸¤ä¸ªç»„ä»¶ï¼š"><a href="#nodeèŠ‚ç‚¹çš„ä¸¤ä¸ªç»„ä»¶ï¼š" class="headerlink" title="nodeèŠ‚ç‚¹çš„ä¸¤ä¸ªç»„ä»¶ï¼š"></a>nodeèŠ‚ç‚¹çš„ä¸¤ä¸ªç»„ä»¶ï¼š</h4><ul><li>kubelet :åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ä»£ç†ï¼Œkubeletä¼šé€šè¿‡å„ç§æœºåˆ¶æ¥ç¡®ä¿å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚kubeletä¸ä¼šç®¡ç†ä¸æ˜¯ç”±kubernetesåˆ›å»ºçš„å®¹å™¨ã€‚kubeletæ¥æ”¶PODçš„æœŸæœ›çŠ¶æ€ï¼ˆå‰¯æœ¬æ•°ã€é•œåƒã€ç½‘ç»œç­‰ï¼‰ï¼Œå¹¶è°ƒç”¨å®¹å™¨è¿è¡Œç¯å¢ƒæ¥å®ç°é¢„æœŸçŠ¶æ€ã€‚kubeletä¼šå®šæ—¶æ±‡æŠ¥èŠ‚ç‚¹çš„çŠ¶æ€ç»™apiserverï¼Œä½œä¸ºschedulerè°ƒåº¦çš„åŸºç¡€ã€‚kubeletä¼šå¯¹é•œåƒå’Œå®¹å™¨è¿›è¡Œæ¸…ç†ï¼Œé¿å…ä¸å¿…è¦çš„æ–‡ä»¶èµ„æºå ç”¨ã€‚</li><li>kube-proxyæ˜¯é›†ç¾¤ä¸­èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç½‘ç»œä»£ç†ï¼Œæ˜¯å®ç°serviceèµ„æºåŠŸèƒ½ç»„ä»¶ä¹‹ä¸€ã€‚kube-proxyå»ºç«‹äº†PODç½‘ç»œå’Œé›†ç¾¤ç½‘ç»œä¹‹é—´çš„å…³ç³»ã€‚ä¸åŒnodeä¸Šçš„serviceæµé‡è½¬å‘è§„åˆ™ä¼šé€šè¿‡kube-proxyæ¥è°ƒç”¨apiserverè®¿é—®etcdè¿›è¡Œè§„åˆ™æ›´æ–°ã€‚serviceæµé‡è°ƒåº¦æ–¹å¼æœ‰ä¸‰ç§æ–¹å¼ï¼šuserspaceï¼ˆåºŸå¼ƒï¼Œæ€§èƒ½å¾ˆå·®ï¼‰ã€iptablesï¼ˆæ€§èƒ½å·®ï¼Œå¤æ‚ï¼Œå³å°†åºŸå¼ƒï¼‰ã€ipvsï¼ˆæ€§èƒ½å¥½ï¼Œè½¬å‘æ–¹å¼æ¸…æ™°ï¼‰ã€‚</li></ul><h2 id="äºŒã€æœºå™¨è§„åˆ’ï¼š"><a href="#äºŒã€æœºå™¨è§„åˆ’ï¼š" class="headerlink" title="äºŒã€æœºå™¨è§„åˆ’ï¼š"></a>äºŒã€æœºå™¨è§„åˆ’ï¼š</h2><table><thead><tr><th>IPåœ°å€</th><th>æœºå™¨åç§°</th><th>å®‰è£…ç»„ä»¶</th></tr></thead><tbody><tr><td>192.168.94.247</td><td>k8s-master-1</td><td>kube-apiserverã€kube-controller-managerã€kube-schedulerã€etcd ã€(kube-proxy)</td></tr><tr><td>192.168.94.248</td><td>k8s-node-1</td><td>kubeletã€kube-proxyã€etcd</td></tr><tr><td>192.168.94.249</td><td>k8s-node-2</td><td>kubeletã€kube-proxyã€etcd</td></tr></tbody></table><h2 id="ä¸‰ã€æ­å»ºk8s"><a href="#ä¸‰ã€æ­å»ºk8s" class="headerlink" title="ä¸‰ã€æ­å»ºk8s"></a>ä¸‰ã€æ­å»ºk8s</h2><h3 id="1ã€æœºå™¨åŸºç¡€é…ç½®"><a href="#1ã€æœºå™¨åŸºç¡€é…ç½®" class="headerlink" title="1ã€æœºå™¨åŸºç¡€é…ç½®"></a>1ã€æœºå™¨åŸºç¡€é…ç½®</h3><h4 id="1-1ã€å…³é—­é˜²ç«å¢™å’Œselinux"><a href="#1-1ã€å…³é—­é˜²ç«å¢™å’Œselinux" class="headerlink" title="1.1ã€å…³é—­é˜²ç«å¢™å’Œselinux:"></a>1.1ã€å…³é—­é˜²ç«å¢™å’Œselinux:</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl stop firewalld &amp;&amp; systemctl <span class="hljs-built_in">disable</span> firewalld<br>setenforce 0<br>sed -i <span class="hljs-string">&#x27;s/^SELINUX=.\*/SELINUX=disabled/&#x27;</span> /etc/selinux/config<br></code></pre></td></tr></table></figure><h4 id="1-2ã€è°ƒæ•´ç³»ç»Ÿæ—¶åŒºä¸ºä¸­å›½-x2F-ä¸Šæµ·ï¼ŒåŒæ­¥æ—¶é—´"><a href="#1-2ã€è°ƒæ•´ç³»ç»Ÿæ—¶åŒºä¸ºä¸­å›½-x2F-ä¸Šæµ·ï¼ŒåŒæ­¥æ—¶é—´" class="headerlink" title="1.2ã€è°ƒæ•´ç³»ç»Ÿæ—¶åŒºä¸ºä¸­å›½&#x2F;ä¸Šæµ·ï¼ŒåŒæ­¥æ—¶é—´"></a>1.2ã€è°ƒæ•´ç³»ç»Ÿæ—¶åŒºä¸ºä¸­å›½&#x2F;ä¸Šæµ·ï¼ŒåŒæ­¥æ—¶é—´</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">timedatectl set-timezone Asia/Shanghai<br><span class="hljs-comment">#å°†å½“å‰çš„ UTC æ—¶é—´å†™å…¥ç¡¬ä»¶æ—¶é’Ÿ</span><br>timedatectl set-local-rtc 0<br><br><span class="hljs-comment"># é‡å¯ä¾èµ–äºç³»ç»Ÿæ—¶é—´çš„æœåŠ¡</span><br>systemctl restart rsyslog<br>systemctl restart crond<br><span class="hljs-comment">#//date æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´  hwclock --show æŸ¥çœ‹ç¡¬ä»¶æ—¶é—´</span><br><br><span class="hljs-comment">#åŒæ­¥æ—¶é—´</span><br>yum install ntpd -y<br>ntpdate cn.pool.ntp.org<br><br><span class="hljs-comment">#è®¾ç½®å®šæ—¶æŸ¥è¯¢æ˜¯å¦åŒæ­¥çš„è„šæœ¬</span><br>crontab -e<br>*/15 * * * * /usr/sbin/ntpdate -u pool.ntp.org &gt;/dev/null 2&gt;&amp;1<br></code></pre></td></tr></table></figure><h4 id="1-3ã€ä¿®æ”¹å„æœºå™¨ä¸»æœºå"><a href="#1-3ã€ä¿®æ”¹å„æœºå™¨ä¸»æœºå" class="headerlink" title="1.3ã€ä¿®æ”¹å„æœºå™¨ä¸»æœºå"></a>1.3ã€ä¿®æ”¹å„æœºå™¨ä¸»æœºå</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">hostnamectl set-hostname k8s-master-1<br>hostnamectl set-hostname k8s-node-1<br>hostnamectl set-hostname k8s-node-2<br></code></pre></td></tr></table></figure><h4 id="1-4ã€ä¿®æ”¹å†…æ ¸å‚æ•°"><a href="#1-4ã€ä¿®æ”¹å†…æ ¸å‚æ•°" class="headerlink" title="1.4ã€ä¿®æ”¹å†…æ ¸å‚æ•°"></a>1.4ã€ä¿®æ”¹å†…æ ¸å‚æ•°</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/sysctl.d/k8s.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">net.ipv4.ip_forward = 1</span><br><span class="hljs-string">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="hljs-string">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="hljs-string">EOF</span><br>sysctl --system<br><br><span class="hljs-comment">#åŠ è½½ipvsæ¨¡å—</span><br>modprobe -- ip_vs<br>modprobe -- ip_vs_rr<br>modprobe -- ip_vs_wrr<br>modprobe -- ip_vs_sh<br>modprobe -- nf_conntrack_ipv4<br>lsmod | grep ip_vs<br>lsmod | grep nf_conntrack_ipv4<br>yum install -y ipvsadm<br></code></pre></td></tr></table></figure><h4 id="1-5ã€é…ç½®hostsæ–‡ä»¶"><a href="#1-5ã€é…ç½®hostsæ–‡ä»¶" class="headerlink" title="1.5ã€é…ç½®hostsæ–‡ä»¶"></a>1.5ã€é…ç½®hostsæ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/hosts<br><br>192.168.94.247  k8s-master-1<br>192.168.94.248  k8s-node-1<br>192.168.94.249  k8s-node-2<br></code></pre></td></tr></table></figure><h4 id="1-6ã€å…å¯†è®¤è¯"><a href="#1-6ã€å…å¯†è®¤è¯" class="headerlink" title="1.6ã€å…å¯†è®¤è¯"></a>1.6ã€å…å¯†è®¤è¯</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è®¾ç½®å…å¯†ç™»å½•</span><br>ssh-keygen  <span class="hljs-comment">#ä¸€è·¯å›è½¦å³å¯</span><br>ssh-copy-id k8s-node-2<br>ssh-copy-id k8s-node-1<br><br><span class="hljs-comment">##å…å¯†è®¤è¯æ–¹å¼äºŒï¼š</span><br>ssh-keygen -t rsa -P <span class="hljs-string">&quot;&quot;</span> -f ~/.ssh/id_rsa<br><span class="hljs-built_in">cat</span> /root/.ssh/id_rsa.pub &gt; /root/.ssh/authorized_keys<br>scp -rp /root/.ssh k8s-node-1:/root<br>scp -rp /root/.ssh k8s-node-2:/root<br><br>å¤‡æ³¨ï¼šä¸ºäº†æ–¹ä¾¿åé¢æ“ä½œï¼Œä¸åšå…å¯†éœ€è¦è¾“å…¥å¯†ç <br><br></code></pre></td></tr></table></figure><h4 id="1-7ã€æ–°å»ºå·¥ä½œç›®å½•-è¯¥ç›®å½•ä¸ºï¼šé…ç½®æ–‡ä»¶å’Œè¯ä¹¦æ–‡ä»¶ç”Ÿæˆç›®å½•ï¼Œåé¢çš„æ‰€æœ‰æ–‡ä»¶ç”Ÿæˆç›¸å…³æ“ä½œå‡åœ¨æ­¤ç›®å½•ä¸‹è¿›è¡Œ"><a href="#1-7ã€æ–°å»ºå·¥ä½œç›®å½•-è¯¥ç›®å½•ä¸ºï¼šé…ç½®æ–‡ä»¶å’Œè¯ä¹¦æ–‡ä»¶ç”Ÿæˆç›®å½•ï¼Œåé¢çš„æ‰€æœ‰æ–‡ä»¶ç”Ÿæˆç›¸å…³æ“ä½œå‡åœ¨æ­¤ç›®å½•ä¸‹è¿›è¡Œ" class="headerlink" title="1.7ã€æ–°å»ºå·¥ä½œç›®å½• è¯¥ç›®å½•ä¸ºï¼šé…ç½®æ–‡ä»¶å’Œè¯ä¹¦æ–‡ä»¶ç”Ÿæˆç›®å½•ï¼Œåé¢çš„æ‰€æœ‰æ–‡ä»¶ç”Ÿæˆç›¸å…³æ“ä½œå‡åœ¨æ­¤ç›®å½•ä¸‹è¿›è¡Œ"></a>1.7ã€æ–°å»ºå·¥ä½œç›®å½• è¯¥ç›®å½•ä¸ºï¼šé…ç½®æ–‡ä»¶å’Œè¯ä¹¦æ–‡ä»¶ç”Ÿæˆç›®å½•ï¼Œåé¢çš„æ‰€æœ‰æ–‡ä»¶ç”Ÿæˆç›¸å…³æ“ä½œå‡åœ¨æ­¤ç›®å½•ä¸‹è¿›è¡Œ</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /data/work<br><span class="hljs-built_in">cd</span> /data/work/<br></code></pre></td></tr></table></figure><h3 id="2ã€æ­å»ºetcdé›†ç¾¤"><a href="#2ã€æ­å»ºetcdé›†ç¾¤" class="headerlink" title="2ã€æ­å»ºetcdé›†ç¾¤"></a>2ã€æ­å»ºetcdé›†ç¾¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•</span><br><span class="hljs-built_in">mkdir</span> -p /app/etcd<br><span class="hljs-comment">#è¯ä¹¦æ–‡ä»¶å­˜æ”¾ç›®å½•</span><br><span class="hljs-built_in">mkdir</span> -p /app/etcd/ssl<br></code></pre></td></tr></table></figure><h4 id="2-1ã€åˆ›å»ºetcdè¯ä¹¦"><a href="#2-1ã€åˆ›å»ºetcdè¯ä¹¦" class="headerlink" title="2.1ã€åˆ›å»ºetcdè¯ä¹¦"></a>2.1ã€åˆ›å»ºetcdè¯ä¹¦</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64<br>wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64<br>wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64<br><span class="hljs-built_in">chmod</span> +x cfssl*<br><span class="hljs-built_in">mv</span> cfssl_linux-amd64 /usr/local/bin/cfssl<br><span class="hljs-built_in">mv</span> cfssljson_linux-amd64 /usr/local/bin/cfssljson<br><span class="hljs-built_in">mv</span> cfssl-certinfo_linux-amd64 /usr/local/bin/cfssl-certinfo<br></code></pre></td></tr></table></figure><h4 id="2-2ã€é…ç½®caè¯·æ±‚æ–‡ä»¶"><a href="#2-2ã€é…ç½®caè¯·æ±‚æ–‡ä»¶" class="headerlink" title="2.2ã€é…ç½®caè¯·æ±‚æ–‡ä»¶"></a>2.2ã€é…ç½®caè¯·æ±‚æ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim ca-csr.json<br><br>&#123;<br>  <span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;kubernetes&quot;</span>,<br>  <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>      <span class="hljs-string">&quot;size&quot;</span>: 2048<br>  &#125;,<br>  <span class="hljs-string">&quot;names&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>      <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;Hubei&quot;</span>,<br>      <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;Wuhan&quot;</span>,<br>      <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;k8s&quot;</span>,<br>      <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;system&quot;</span><br>    &#125;<br>  ],<br>  <span class="hljs-string">&quot;ca&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;expiry&quot;</span>: <span class="hljs-string">&quot;87600h&quot;</span><br>  &#125;<br>&#125;<br><span class="hljs-comment">#8760hï¼š10å¹´æœ‰æ•ˆ</span><br></code></pre></td></tr></table></figure><h4 id="2-3ã€åˆ›å»ºcaè¯ä¹¦"><a href="#2-3ã€åˆ›å»ºcaè¯ä¹¦" class="headerlink" title="2.3ã€åˆ›å»ºcaè¯ä¹¦"></a>2.3ã€åˆ›å»ºcaè¯ä¹¦</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">cfssl gencert -initca ca-csr.json  | cfssljson -bare ca<br><span class="hljs-comment">#ç”Ÿæˆäº†ca-key.pem ca.pem ca.csr</span><br></code></pre></td></tr></table></figure><h4 id="2-4ã€é…ç½®caè¯ä¹¦ç­–ç•¥"><a href="#2-4ã€é…ç½®caè¯ä¹¦ç­–ç•¥" class="headerlink" title="2.4ã€é…ç½®caè¯ä¹¦ç­–ç•¥"></a>2.4ã€é…ç½®caè¯ä¹¦ç­–ç•¥</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim ca-config.json<br><br>&#123;<br>  <span class="hljs-string">&quot;signing&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;default&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;expiry&quot;</span>: <span class="hljs-string">&quot;87600h&quot;</span><br>        &#125;,<br>      <span class="hljs-string">&quot;profiles&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;kubernetes&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;usages&quot;</span>: [<br>                  <span class="hljs-string">&quot;signing&quot;</span>,<br>                  <span class="hljs-string">&quot;key encipherment&quot;</span>,<br>                  <span class="hljs-string">&quot;server auth&quot;</span>,<br>                  <span class="hljs-string">&quot;client auth&quot;</span><br>              ],<br>              <span class="hljs-string">&quot;expiry&quot;</span>: <span class="hljs-string">&quot;87600h&quot;</span><br>          &#125;<br>      &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-5ã€é…ç½®etcdè¯·æ±‚csræ–‡ä»¶"><a href="#2-5ã€é…ç½®etcdè¯·æ±‚csræ–‡ä»¶" class="headerlink" title="2.5ã€é…ç½®etcdè¯·æ±‚csræ–‡ä»¶"></a>2.5ã€é…ç½®etcdè¯·æ±‚csræ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim etcd-csr.json<br><br>&#123;<br>  <span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;etcd&quot;</span>,<br>  <span class="hljs-string">&quot;hosts&quot;</span>: [<br>    <span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.94.247&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.94.248&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.94.249&quot;</span><br><br>  ],<br>  <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>    <span class="hljs-string">&quot;size&quot;</span>: 2048<br>  &#125;,<br>  <span class="hljs-string">&quot;names&quot;</span>: [&#123;<br>    <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>    <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;Hubei&quot;</span>,<br>    <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;Wuhan&quot;</span>,<br>    <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;k8s&quot;</span>,<br>    <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;system&quot;</span><br>  &#125;]<br>&#125;<br><br><br><span class="hljs-comment">#ç”Ÿæˆè¯ä¹¦:</span><br>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes etcd-csr.json | cfssljson  -bare etcd<br><br><span class="hljs-comment">#ç”Ÿæˆ:</span><br><span class="hljs-built_in">ls</span> etcd*.pem<br><span class="hljs-comment">#----------------</span><br>etcd-key.pem  etcd.pem<br><span class="hljs-comment">#-----------------</span><br></code></pre></td></tr></table></figure><h4 id="2-6ã€éƒ¨ç½²etcdé›†ç¾¤"><a href="#2-6ã€éƒ¨ç½²etcdé›†ç¾¤" class="headerlink" title="2.6ã€éƒ¨ç½²etcdé›†ç¾¤"></a>2.6ã€éƒ¨ç½²etcdé›†ç¾¤</h4><h5 id="2-6-1ã€ä¸‹è½½æˆ–ä¸Šä¼ etcdåŒ…-è§£å‹å¹¶åˆ†å‘ç›¸å…³åŒ…"><a href="#2-6-1ã€ä¸‹è½½æˆ–ä¸Šä¼ etcdåŒ…-è§£å‹å¹¶åˆ†å‘ç›¸å…³åŒ…" class="headerlink" title="2.6.1ã€ä¸‹è½½æˆ–ä¸Šä¼ etcdåŒ…,è§£å‹å¹¶åˆ†å‘ç›¸å…³åŒ…:"></a>2.6.1ã€ä¸‹è½½æˆ–ä¸Šä¼ etcdåŒ…,è§£å‹å¹¶åˆ†å‘ç›¸å…³åŒ…:</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://github.com/etcd-io/etcd/releases/download/v3.4.14/etcd-v3.4.14-linux-amd64.tar.gz<br><br>tar -xnf etcd-v3.4.14-linux-amd64.tar.gz <br><br><span class="hljs-built_in">cp</span> etcd-v3.4.14-linux-amd64/etcd* /usr/local/bin/<br><br><span class="hljs-comment">#å°†æ–‡ä»¶åˆ†å‘åˆ°å…¶ä»–èŠ‚ç‚¹</span><br>scp etcd-v3.4.14-linux-amd64/etcd* k8s-node-1:/usr/local/bin/<br>scp etcd-v3.4.14-linux-amd64/etcd* k8s-node-2:/usr/local/bin/<br></code></pre></td></tr></table></figure><h5 id="2-6-2ã€åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#2-6-2ã€åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="2.6.2ã€åˆ›å»ºé…ç½®æ–‡ä»¶:"></a>2.6.2ã€åˆ›å»ºé…ç½®æ–‡ä»¶:</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim etcd.conf<br><br><span class="hljs-comment">#[Member]</span><br>ETCD_NAME=<span class="hljs-string">&quot;etcd1&quot;</span><br>ETCD_DATA_DIR=<span class="hljs-string">&quot;/var/lib/etcd/default.etcd&quot;</span><br>ETCD_LISTEN_PEER_URLS=<span class="hljs-string">&quot;https://192.168.94.247:2380&quot;</span><br>ETCD_LISTEN_CLIENT_URLS=<span class="hljs-string">&quot;https://192.168.94.247:2379,http://127.0.0.1:2379&quot;</span><br><br><span class="hljs-comment">#[Clustering]</span><br>ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="hljs-string">&quot;https://192.168.94.247:2380&quot;</span><br>ETCD_ADVERTISE_CLIENT_URLS=<span class="hljs-string">&quot;https://192.168.94.247:2379&quot;</span><br>ETCD_INITIAL_CLUSTER=<span class="hljs-string">&quot;etcd1=https://192.168.94.247:2380,etcd2=https://192.168.94.248:2380,etcd3=https://192.168.94.249:2380&quot;</span><br>ETCD_INITIAL_CLUSTER_TOKEN=<span class="hljs-string">&quot;etcd-cluster&quot;</span><br>ETCD_INITIAL_CLUSTER_STATE=<span class="hljs-string">&quot;new&quot;</span><br></code></pre></td></tr></table></figure><p>æ³¨ï¼š<br>ETCD_NAMEï¼šèŠ‚ç‚¹åç§°ï¼Œé›†ç¾¤ä¸­å”¯ä¸€<br>ETCD_DATA_DIRï¼šæ•°æ®ç›®å½•<br>ETCD_LISTEN_PEER_URLSï¼šé›†ç¾¤é€šä¿¡ç›‘å¬åœ°å€<br>ETCD_LISTEN_CLIENT_URLSï¼šå®¢æˆ·ç«¯è®¿é—®ç›‘å¬åœ°å€<br>ETCD_INITIAL_ADVERTISE_PEER_URLSï¼šé›†ç¾¤é€šå‘Šåœ°å€<br>ETCD_ADVERTISE_CLIENT_URLSï¼šå®¢æˆ·ç«¯é€šå‘Šåœ°å€<br>ETCD_INITIAL_CLUSTERï¼šé›†ç¾¤èŠ‚ç‚¹åœ°å€<br>ETCD_INITIAL_CLUSTER_TOKENï¼šé›†ç¾¤Token<br>ETCD_INITIAL_CLUSTER_STATEï¼šåŠ å…¥é›†ç¾¤çš„å½“å‰çŠ¶æ€ï¼Œnewæ˜¯æ–°é›†ç¾¤ï¼Œexistingè¡¨ç¤ºåŠ å…¥å·²æœ‰é›†ç¾¤</p><h5 id="2-6-3ã€åˆ›å»ºå¯åŠ¨æœåŠ¡æ–‡ä»¶ï¼š"><a href="#2-6-3ã€åˆ›å»ºå¯åŠ¨æœåŠ¡æ–‡ä»¶ï¼š" class="headerlink" title="2.6.3ã€åˆ›å»ºå¯åŠ¨æœåŠ¡æ–‡ä»¶ï¼š"></a>2.6.3ã€åˆ›å»ºå¯åŠ¨æœåŠ¡æ–‡ä»¶ï¼š</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim etcd.service<br><span class="hljs-comment">#-----------------------------------------------</span><br>[Unit]<br>Description=Etcd Server<br>After=network.target<br>After=network-online.target<br>Wants=network-online.target<br><br>[Service]<br>Type=notify<br>EnvironmentFile=-/app/etcd/etcd.conf<br>WorkingDirectory=/var/lib/etcd/<br>ExecStart=/usr/local/bin/etcd \<br>  --cert-file=/app/etcd/ssl/etcd.pem \<br>  --key-file=/app/etcd/ssl/etcd-key.pem \<br>  --trusted-ca-file=/app/etcd/ssl/ca.pem \<br>  --peer-cert-file=/app/etcd/ssl/etcd.pem \<br>  --peer-key-file=/app/etcd/ssl/etcd-key.pem \<br>  --peer-trusted-ca-file=/app/etcd/ssl/ca.pem \<br>  --peer-client-cert-auth \<br>  --client-cert-auth<br>Restart=on-failure<br>RestartSec=5<br>LimitNOFILE=65536<br><br></code></pre></td></tr></table></figure><h5 id="2-6-4ã€åŒæ­¥æ–‡ä»¶åˆ°æœ¬æœºå’Œå…¶ä»–æœºå™¨èŠ‚ç‚¹çš„å¯¹åº”è·¯å¾„ä¸‹"><a href="#2-6-4ã€åŒæ­¥æ–‡ä»¶åˆ°æœ¬æœºå’Œå…¶ä»–æœºå™¨èŠ‚ç‚¹çš„å¯¹åº”è·¯å¾„ä¸‹" class="headerlink" title="2.6.4ã€åŒæ­¥æ–‡ä»¶åˆ°æœ¬æœºå’Œå…¶ä»–æœºå™¨èŠ‚ç‚¹çš„å¯¹åº”è·¯å¾„ä¸‹:"></a>2.6.4ã€åŒæ­¥æ–‡ä»¶åˆ°æœ¬æœºå’Œå…¶ä»–æœºå™¨èŠ‚ç‚¹çš„å¯¹åº”è·¯å¾„ä¸‹:</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> ca*.pem /app/etcd/ssl/<br><span class="hljs-built_in">cp</span> etcd*.pem /app/etcd/ssl/<br><span class="hljs-built_in">cp</span> etcd.conf /app/etcd/<br><br>scp -r /app/ k8s-node-1:/<br>scp -r /app/ k8s-node-2:/<br><br><span class="hljs-built_in">cp</span> etcd.service /usr/lib/systemd/system/<br>scp etcd.service k8s-node-1:/usr/lib/systemd/system/<br>scp etcd.service k8s-node-2:/usr/lib/systemd/system/<br></code></pre></td></tr></table></figure><h5 id="2-6-5ã€ä¿®æ”¹åŒæ­¥çš„èŠ‚ç‚¹ä¿¡æ¯"><a href="#2-6-5ã€ä¿®æ”¹åŒæ­¥çš„èŠ‚ç‚¹ä¿¡æ¯" class="headerlink" title="2.6.5ã€ä¿®æ”¹åŒæ­¥çš„èŠ‚ç‚¹ä¿¡æ¯"></a>2.6.5ã€ä¿®æ”¹åŒæ­¥çš„èŠ‚ç‚¹ä¿¡æ¯</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /app/etcd/etcd.conf<br>æ³¨:åˆ†åˆ«åœ¨å…¶ä»–æœºå™¨(k8s-node-1ã€k8s-node-2ï¼‰ä¸Šä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­etcdåå­—(ETCD_NAME)å’Œip(é™¤äº†ETCD_INITIAL_CLUSTERå…¶ä»–çš„éƒ½éœ€è¦ä¿®æ”¹æˆè‡ªå·±çš„ipï¼‰<br><br><span class="hljs-comment">#åˆ›å»ºç›®å½•</span><br><span class="hljs-built_in">mkdir</span> -p /var/lib/etcd/default.etcd<br></code></pre></td></tr></table></figure><h5 id="2-6-6ã€å¯åŠ¨etcdé›†ç¾¤-æ‰€æœ‰èŠ‚ç‚¹æœºå™¨åŒæ—¶å¯åŠ¨"><a href="#2-6-6ã€å¯åŠ¨etcdé›†ç¾¤-æ‰€æœ‰èŠ‚ç‚¹æœºå™¨åŒæ—¶å¯åŠ¨" class="headerlink" title="2.6.6ã€å¯åŠ¨etcdé›†ç¾¤,æ‰€æœ‰èŠ‚ç‚¹æœºå™¨åŒæ—¶å¯åŠ¨"></a>2.6.6ã€å¯åŠ¨etcdé›†ç¾¤,æ‰€æœ‰èŠ‚ç‚¹æœºå™¨åŒæ—¶å¯åŠ¨</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl daemon-reload &amp;&amp; systemctl <span class="hljs-built_in">enable</span> etcd.service &amp;&amp; systemctl start etcd<br>systemctl status etcd<br></code></pre></td></tr></table></figure><h5 id="2-6-7ã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"><a href="#2-6-7ã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€" class="headerlink" title="2.6.7ã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"></a>2.6.7ã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">ETCDCTL_API=3 /usr/local/bin/etcdctl --write-out=table --cacert=/app/etcd/ssl/ca.pem --cert=/app/etcd/ssl/etcd.pem \<br>--key=/app/etcd/ssl/etcd-key.pem --endpoints=<span class="hljs-string">&quot;https://192.168.94.247:2379,https://192.168.94.248:2379,https://192.168.94.249:2379&quot;</span> endpoint health<br><span class="hljs-comment">#æˆ–è€…</span><br>etcdctl --cacert=/app/etcd/ssl/ca.pem --cert=/app/etcd/ssl/etcd.pem --key=/app/etcd/ssl/etcd-key.pem \<br> --endpoints=<span class="hljs-string">&quot;https://192.168.94.247:2379,https://192.168.94.248:2379,https://192.168.94.249:2379&quot;</span> endpoint health<br></code></pre></td></tr></table></figure><h3 id="3ã€kubernetesç»„ä»¶éƒ¨ç½²"><a href="#3ã€kubernetesç»„ä»¶éƒ¨ç½²" class="headerlink" title="3ã€kubernetesç»„ä»¶éƒ¨ç½²"></a>3ã€kubernetesç»„ä»¶éƒ¨ç½²</h3><h4 id="éƒ¨ç½²å‰å‡†å¤‡"><a href="#éƒ¨ç½²å‰å‡†å¤‡" class="headerlink" title="éƒ¨ç½²å‰å‡†å¤‡"></a>éƒ¨ç½²å‰å‡†å¤‡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¸‹è½½æˆ–è€…ä¸Šä¼ å®‰è£…åŒ…:</span><br>wget https://dl.k8s.io/v1.20.1/kubernetes-server-linux-amd64.tar.gz<br>tar -xnf kubernetes-server-linux-amd64.tar.gz<br><br><span class="hljs-comment">#è¿›å…¥è§£å‹åçš„k8såŒ…å†…</span><br><span class="hljs-built_in">cd</span> kubernetes/server/bin/<br><br><span class="hljs-comment">#å°†ç›¸å…³çš„æ–‡ä»¶å¤åˆ¶å¹¶åˆ†å‘åˆ°å…¶ä»–æœºå™¨ç›¸å…³è·¯å¾„ä¸Š</span><br><span class="hljs-built_in">cp</span> kube-apiserver kube-controller-manager kube-scheduler /usr/local/bin/  <br>scp kubelet kube-proxy k8s-node-1:/usr/local/bin/<br>scp kubelet kube-proxy k8s-node-2:/usr/local/bin/<br><br><span class="hljs-built_in">cd</span> /data/work/<br><br><span class="hljs-comment">#åˆ›å»ºå·¥ä½œç›®å½•,æ‰€æœ‰æœºå™¨å‡è¦åˆ›å»ºã€‚</span><br><span class="hljs-built_in">mkdir</span> -p /app/kubernetes/     <span class="hljs-comment"># kubernetesç»„ä»¶é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•</span><br><span class="hljs-built_in">mkdir</span> -p /app/kubernetes/ssl  <span class="hljs-comment"># kubernetesç»„ä»¶è¯ä¹¦æ–‡ä»¶å­˜æ”¾ç›®å½•</span><br><span class="hljs-built_in">mkdir</span> /var/log/kubernetes     <span class="hljs-comment"># kubernetesç»„ä»¶æ—¥å¿—æ–‡ä»¶å­˜æ”¾ç›®å½•</span><br></code></pre></td></tr></table></figure><h4 id="3-1ã€éƒ¨ç½²api-server"><a href="#3-1ã€éƒ¨ç½²api-server" class="headerlink" title="3.1ã€éƒ¨ç½²api-server"></a>3.1ã€éƒ¨ç½²api-server</h4><h5 id="3-1-1ã€åˆ›å»ºkube-apiserver-csrè¯·æ±‚æ–‡ä»¶"><a href="#3-1-1ã€åˆ›å»ºkube-apiserver-csrè¯·æ±‚æ–‡ä»¶" class="headerlink" title="3.1.1ã€åˆ›å»ºkube-apiserver-csrè¯·æ±‚æ–‡ä»¶"></a>3.1.1ã€åˆ›å»ºkube-apiserver-csrè¯·æ±‚æ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kube-apiserver-csr.json<br><br>&#123;<br>  <span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;kubernetes&quot;</span>,<br>  <span class="hljs-string">&quot;hosts&quot;</span>: [<br>    <span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.94.247&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.94.248&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.94.249&quot;</span>,<br>    <span class="hljs-string">&quot;10.255.0.1&quot;</span>,<br>    <span class="hljs-string">&quot;kubernetes&quot;</span>,<br>    <span class="hljs-string">&quot;kubernetes.default&quot;</span>,<br>    <span class="hljs-string">&quot;kubernetes.default.svc&quot;</span>,<br>    <span class="hljs-string">&quot;kubernetes.default.svc.cluster&quot;</span>,<br>    <span class="hljs-string">&quot;kubernetes.default.svc.cluster.local&quot;</span><br>  ],<br>  <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>    <span class="hljs-string">&quot;size&quot;</span>: 2048<br>  &#125;,<br>  <span class="hljs-string">&quot;names&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>      <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;BeiJing&quot;</span>,<br>      <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;BeiJing&quot;</span>,<br>      <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;k8s&quot;</span>,<br>      <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;system&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="3-1-2ã€ç”Ÿæˆè¯ä¹¦å’Œtoken-csvæ–‡ä»¶"><a href="#3-1-2ã€ç”Ÿæˆè¯ä¹¦å’Œtoken-csvæ–‡ä»¶" class="headerlink" title="3.1.2ã€ç”Ÿæˆè¯ä¹¦å’Œtoken.csvæ–‡ä»¶"></a>3.1.2ã€ç”Ÿæˆè¯ä¹¦å’Œtoken.csvæ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-apiserver-csr.json | cfssljson -bare kube-apiserver<br><br><span class="hljs-built_in">cat</span> &gt; token.csv &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">$(head -c 16 /dev/urandom | od -An -t x | tr -d &#x27; &#x27;),kubelet-bootstrap,10001,&quot;system:kubelet-bootstrap&quot;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h5 id="3-1-3ã€åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ipåœ°å€"><a href="#3-1-3ã€åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ipåœ°å€" class="headerlink" title="3.1.3ã€åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ipåœ°å€"></a>3.1.3ã€åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ipåœ°å€</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kube-apiserver.conf<br><br>KUBE_APISERVER_OPTS=<span class="hljs-string">&quot;--enable-admission-plugins=NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota \</span><br><span class="hljs-string">  --anonymous-auth=false \</span><br><span class="hljs-string">  --bind-address=192.168.94.247 \</span><br><span class="hljs-string">  --secure-port=6443 \</span><br><span class="hljs-string">  --advertise-address=192.168.94.247 \</span><br><span class="hljs-string">  --insecure-port=0 \</span><br><span class="hljs-string">  --authorization-mode=Node,RBAC \</span><br><span class="hljs-string">  --runtime-config=api/all=true \</span><br><span class="hljs-string">  --enable-bootstrap-token-auth \</span><br><span class="hljs-string">  --service-cluster-ip-range=10.255.0.0/16 \</span><br><span class="hljs-string">  --token-auth-file=/app/kubernetes/token.csv \</span><br><span class="hljs-string">  --service-node-port-range=9000-9500 \</span><br><span class="hljs-string">  --tls-cert-file=/app/kubernetes/ssl/kube-apiserver.pem  \</span><br><span class="hljs-string">  --tls-private-key-file=/app/kubernetes/ssl/kube-apiserver-key.pem \</span><br><span class="hljs-string">  --client-ca-file=/app/kubernetes/ssl/ca.pem \</span><br><span class="hljs-string">  --kubelet-client-certificate=/app/kubernetes/ssl/kube-apiserver.pem \</span><br><span class="hljs-string">  --kubelet-client-key=/app/kubernetes/ssl/kube-apiserver-key.pem \</span><br><span class="hljs-string">  --service-account-key-file=/app/kubernetes/ssl/ca-key.pem \</span><br><span class="hljs-string">  --service-account-signing-key-file=/app/kubernetes/ssl/ca-key.pem  \      # 1.20ä»¥ä¸Šç‰ˆæœ¬å¿…é¡»æœ‰æ­¤å‚æ•° &lt;å¤åˆ¶è¿‡å»è¯·åˆ é™¤æ³¨é‡Š&gt;</span><br><span class="hljs-string">  --service-account-issuer=https://kubernetes.default.svc.cluster.local \   # 1.20ä»¥ä¸Šç‰ˆæœ¬å¿…é¡»æœ‰æ­¤å‚æ•° &lt;å¤åˆ¶è¿‡å»è¯·åˆ é™¤æ³¨é‡Š&gt;</span><br><span class="hljs-string">  --etcd-cafile=/app/etcd/ssl/ca.pem \</span><br><span class="hljs-string">  --etcd-certfile=/app/etcd/ssl/etcd.pem \</span><br><span class="hljs-string">  --etcd-keyfile=/app/etcd/ssl/etcd-key.pem \</span><br><span class="hljs-string">  --etcd-servers=https://192.168.94.247:2379,https://192.168.94.248:2379,https://192.168.94.249:2379 \</span><br><span class="hljs-string">  --enable-swagger-ui=true \</span><br><span class="hljs-string">  --allow-privileged=true \</span><br><span class="hljs-string">  --apiserver-count=3 \</span><br><span class="hljs-string">  --audit-log-maxage=30 \</span><br><span class="hljs-string">  --audit-log-maxbackup=3 \</span><br><span class="hljs-string">  --audit-log-maxsize=100 \</span><br><span class="hljs-string">  --audit-log-path=/var/log/kube-apiserver-audit.log \</span><br><span class="hljs-string">  --event-ttl=1h \</span><br><span class="hljs-string">  --alsologtostderr=true \</span><br><span class="hljs-string">  --logtostderr=false \</span><br><span class="hljs-string">  --log-dir=/var/log/kubernetes \</span><br><span class="hljs-string">  --v=4&quot;</span><br><span class="hljs-comment">#æ³¨ï¼š</span><br><span class="hljs-comment">##--logtostderrï¼šå¯ç”¨æ—¥å¿—</span><br><span class="hljs-comment">##--vï¼šæ—¥å¿—ç­‰çº§</span><br><span class="hljs-comment">##--log-dirï¼šæ—¥å¿—ç›®å½•</span><br><span class="hljs-comment">##--etcd-serversï¼šetcdé›†ç¾¤åœ°å€</span><br><span class="hljs-comment">##--bind-addressï¼šç›‘å¬åœ°å€</span><br><span class="hljs-comment">##--secure-portï¼šhttpså®‰å…¨ç«¯å£</span><br><span class="hljs-comment">##--advertise-addressï¼šé›†ç¾¤é€šå‘Šåœ°å€</span><br><span class="hljs-comment">##--allow-privilegedï¼šå¯ç”¨æˆæƒ</span><br><span class="hljs-comment">##--service-cluster-ip-rangeï¼šServiceè™šæ‹ŸIPåœ°å€æ®µ</span><br><span class="hljs-comment">##--enable-admission-pluginsï¼šå‡†å…¥æ§åˆ¶æ¨¡å—</span><br><span class="hljs-comment">##--authorization-modeï¼šè®¤è¯æˆæƒï¼Œå¯ç”¨RBACæˆæƒå’ŒèŠ‚ç‚¹è‡ªç®¡ç†</span><br><span class="hljs-comment">##--enable-bootstrap-token-authï¼šå¯ç”¨TLS bootstrapæœºåˆ¶</span><br><span class="hljs-comment">##--token-auth-fileï¼šbootstrap tokenæ–‡ä»¶</span><br><span class="hljs-comment">##--service-node-port-rangeï¼šService nodeportç±»å‹é»˜è®¤åˆ†é…ç«¯å£èŒƒå›´</span><br><span class="hljs-comment">##--kubelet-client-xxxï¼šapiserverè®¿é—®kubeletå®¢æˆ·ç«¯è¯ä¹¦</span><br><span class="hljs-comment">##--tls-xxx-fileï¼šapiserver httpsè¯ä¹¦</span><br><span class="hljs-comment">##--etcd-xxxfileï¼šè¿æ¥Etcdé›†ç¾¤è¯ä¹¦</span><br><span class="hljs-comment">##--audit-log-xxxï¼šå®¡è®¡æ—¥å¿—</span><br></code></pre></td></tr></table></figure><h5 id="3-1-4ã€åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶"><a href="#3-1-4ã€åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶" class="headerlink" title="3.1.4ã€åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶"></a>3.1.4ã€åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kube-apiserver.service<br><br>[Unit]<br>Description=Kubernetes API Server<br>Documentation=https://github.com/kubernetes/kubernetes<br>After=etcd.service<br>Wants=etcd.service<br><br>[Service]<br>EnvironmentFile=-/app/kubernetes/kube-apiserver.conf<br>ExecStart=/usr/local/bin/kube-apiserver <span class="hljs-variable">$KUBE_APISERVER_OPTS</span><br>Restart=on-failure<br>RestartSec=5<br>Type=notify<br>LimitNOFILE=65536<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><h5 id="3-1-5ã€åŒæ­¥ç›¸å…³çš„æ–‡ä»¶åˆ°å¯¹åº”è·¯å¾„"><a href="#3-1-5ã€åŒæ­¥ç›¸å…³çš„æ–‡ä»¶åˆ°å¯¹åº”è·¯å¾„" class="headerlink" title="3.1.5ã€åŒæ­¥ç›¸å…³çš„æ–‡ä»¶åˆ°å¯¹åº”è·¯å¾„"></a>3.1.5ã€åŒæ­¥ç›¸å…³çš„æ–‡ä»¶åˆ°å¯¹åº”è·¯å¾„</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> ca*.pem /app/kubernetes/ssl/<br><span class="hljs-built_in">cp</span> kube-apiserver*.pem /app/kubernetes/ssl/<br><span class="hljs-built_in">cp</span> token.csv /app/kubernetes/<br><span class="hljs-built_in">cp</span> kube-apiserver.conf /app/kubernetes/ <br><span class="hljs-built_in">cp</span> kube-apiserver.service /usr/lib/systemd/system/<br></code></pre></td></tr></table></figure><h5 id="3-1-6ã€å¯åŠ¨æœåŠ¡"><a href="#3-1-6ã€å¯åŠ¨æœåŠ¡" class="headerlink" title="3.1.6ã€å¯åŠ¨æœåŠ¡"></a>3.1.6ã€å¯åŠ¨æœåŠ¡</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> kube-apiserver<br>systemctl start kube-apiserver<br>systemctl status kube-apiserver<br></code></pre></td></tr></table></figure><h4 id="3-2ã€éƒ¨ç½²kubectl"><a href="#3-2ã€éƒ¨ç½²kubectl" class="headerlink" title="3.2ã€éƒ¨ç½²kubectl"></a>3.2ã€éƒ¨ç½²kubectl</h4><h5 id="3-2-1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶"><a href="#3-2-1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶" class="headerlink" title="3.2.1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶"></a>3.2.1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim admin-csr.json<br><br>&#123;<br>  <span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>  <span class="hljs-string">&quot;hosts&quot;</span>: [],<br>  <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>    <span class="hljs-string">&quot;size&quot;</span>: 2048<br>  &#125;,<br>  <span class="hljs-string">&quot;names&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>      <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;BeiJing&quot;</span>,<br>      <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;BeiJing&quot;</span>,<br>      <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;system:masters&quot;</span>,<br>      <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;system&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="3-2-2ã€ç”Ÿæˆè¯ä¹¦"><a href="#3-2-2ã€ç”Ÿæˆè¯ä¹¦" class="headerlink" title="3.2.2ã€ç”Ÿæˆè¯ä¹¦"></a>3.2.2ã€ç”Ÿæˆè¯ä¹¦</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes admin-csr.json | cfssljson -bare admin<br><br><span class="hljs-built_in">cp</span> admin*.pem /app/kubernetes/ssl/<br></code></pre></td></tr></table></figure><h5 id="3-2-3ã€åˆ›å»ºkubeconfigé…ç½®æ–‡ä»¶"><a href="#3-2-3ã€åˆ›å»ºkubeconfigé…ç½®æ–‡ä»¶" class="headerlink" title="3.2.3ã€åˆ›å»ºkubeconfigé…ç½®æ–‡ä»¶"></a>3.2.3ã€åˆ›å»ºkubeconfigé…ç½®æ–‡ä»¶</h5><p>kubeconfig ä¸º kubectl çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«è®¿é—® apiserver çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¦‚ apiserver åœ°å€ã€CA è¯ä¹¦å’Œè‡ªèº«ä½¿ç”¨çš„è¯ä¹¦</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è®¾ç½®é›†ç¾¤å‚æ•°  --serverå¦‚æœæœ‰è´Ÿè½½å‡è¡¡VIP å¯ä»¥æ”¹æˆè´Ÿè½½å‡è¡¡VIPçš„åœ°å€</span><br>kubectl config set-cluster kubernetes --certificate-authority=ca.pem --embed-certs=<span class="hljs-literal">true</span> --server=https://192.168.94.247:6443 --kubeconfig=kube.config<br><span class="hljs-comment">#è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°</span><br>kubectl config set-credentials admin --client-certificate=admin.pem --client-key=admin-key.pem --embed-certs=<span class="hljs-literal">true</span> --kubeconfig=kube.config<br><span class="hljs-comment">#è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°</span><br>kubectl config set-context kubernetes --cluster=kubernetes --user=admin --kubeconfig=kube.config<br><span class="hljs-comment">#è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡</span><br>kubectl config use-context kubernetes --kubeconfig=kube.config<br><br><span class="hljs-comment">#åˆ›å»ºç›¸å…³ç›®å½•æ–‡ä»¶</span><br><span class="hljs-built_in">mkdir</span> ~/.kube<br><span class="hljs-built_in">cp</span> kube.config ~/.kube/config<br></code></pre></td></tr></table></figure><h5 id="3-2-4ã€æˆæƒkubernetesè¯ä¹¦è®¿é—®kubelet-apiæƒé™"><a href="#3-2-4ã€æˆæƒkubernetesè¯ä¹¦è®¿é—®kubelet-apiæƒé™" class="headerlink" title="3.2.4ã€æˆæƒkubernetesè¯ä¹¦è®¿é—®kubelet apiæƒé™"></a>3.2.4ã€æˆæƒkubernetesè¯ä¹¦è®¿é—®kubelet apiæƒé™</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl create clusterrolebinding kube-apiserver:kubelet-apis --clusterrole=system:kubelet-api-admin --user kubernetes<br></code></pre></td></tr></table></figure><h5 id="3-2-5ã€æŸ¥çœ‹é›†ç¾¤ç»„ä»¶çŠ¶æ€"><a href="#3-2-5ã€æŸ¥çœ‹é›†ç¾¤ç»„ä»¶çŠ¶æ€" class="headerlink" title="3.2.5ã€æŸ¥çœ‹é›†ç¾¤ç»„ä»¶çŠ¶æ€"></a>3.2.5ã€æŸ¥çœ‹é›†ç¾¤ç»„ä»¶çŠ¶æ€</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl cluster-info<br><span class="hljs-comment">#---</span><br><span class="hljs-comment">#Kubernetes control plane is running at https://192.168.94.247:6443</span><br><br><br>kubectl get componentstatuses<br>kubectl get all --all-namespaces<br></code></pre></td></tr></table></figure><h5 id="3-2-6ã€é…ç½®kubectlå­å‘½ä»¤è¡¥å…¨"><a href="#3-2-6ã€é…ç½®kubectlå­å‘½ä»¤è¡¥å…¨" class="headerlink" title="3.2.6ã€é…ç½®kubectlå­å‘½ä»¤è¡¥å…¨"></a>3.2.6ã€é…ç½®kubectlå­å‘½ä»¤è¡¥å…¨</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¡¥é½å‘½ä»¤ä¸€</span><br>yum install -y bash-completion<br><span class="hljs-built_in">source</span> /usr/share/bash-completion/bash_completion<br><span class="hljs-built_in">source</span> &lt;(kubectl completion bash)<br>kubectl completion bash &gt; ~/.kube/completion.bash.inc<br><span class="hljs-built_in">source</span> <span class="hljs-string">&#x27;/root/.kube/completion.bash.inc&#x27;</span>  <br><span class="hljs-built_in">source</span> <span class="hljs-variable">$HOME</span>/.bash_profile<br><br><span class="hljs-comment">#è¡¥é½å‘½ä»¤äºŒ</span><br><span class="hljs-built_in">source</span> &lt;(kubectl completion bash)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; ~/.bashrc<br><br></code></pre></td></tr></table></figure><h4 id="3-3ã€éƒ¨ç½²kube-controller-manager"><a href="#3-3ã€éƒ¨ç½²kube-controller-manager" class="headerlink" title="3.3ã€éƒ¨ç½²kube-controller-manager"></a>3.3ã€éƒ¨ç½²kube-controller-manager</h4><h5 id="3-3-1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶"><a href="#3-3-1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶" class="headerlink" title="3.3.1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶"></a>3.3.1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kube-controller-manager-csr.json<br><br>&#123;<br>    <span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;system:kube-controller-manager&quot;</span>,<br>    <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>: 2048<br>    &#125;,<br>    <span class="hljs-string">&quot;hosts&quot;</span>: [<br>      <span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>      <span class="hljs-string">&quot;192.168.94.247&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;names&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>        <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;BeiJing&quot;</span>,<br>        <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;BeiJing&quot;</span>,<br>        <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;system:kube-controller-manager&quot;</span>,<br>        <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;system&quot;</span><br>      &#125;<br>    ]<br>&#125;<br><span class="hljs-comment">#æ³¨æ„ï¼šhosts åˆ—è¡¨åŒ…å«æ‰€æœ‰ kube-controller-manager èŠ‚ç‚¹ IPï¼›</span><br></code></pre></td></tr></table></figure><h5 id="3-3-2ã€ç”Ÿæˆè¯ä¹¦"><a href="#3-3-2ã€ç”Ÿæˆè¯ä¹¦" class="headerlink" title="3.3.2ã€ç”Ÿæˆè¯ä¹¦"></a>3.3.2ã€ç”Ÿæˆè¯ä¹¦</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager<br><br><span class="hljs-built_in">ls</span> kube-controller-manager*.pem<br></code></pre></td></tr></table></figure><h5 id="3-3-3ã€è®¾ç½®é›†ç¾¤å‚æ•°"><a href="#3-3-3ã€è®¾ç½®é›†ç¾¤å‚æ•°" class="headerlink" title="3.3.3ã€è®¾ç½®é›†ç¾¤å‚æ•°"></a>3.3.3ã€è®¾ç½®é›†ç¾¤å‚æ•°</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl config set-cluster kubernetes --certificate-authority=ca.pem --embed-certs=<span class="hljs-literal">true</span> --server=https://192.168.94.247:6443 --kubeconfig=kube-controller-manager.kubeconfig<br><span class="hljs-comment">#è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°</span><br>kubectl config set-credentials system:kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=<span class="hljs-literal">true</span> --kubeconfig=kube-controller-manager.kubeconfig<br><span class="hljs-comment">#è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°</span><br>kubectl config set-context system:kube-controller-manager --cluster=kubernetes --user=system:kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig<br><span class="hljs-comment">#è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡</span><br>kubectl config use-context system:kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig<br></code></pre></td></tr></table></figure><h5 id="3-3-4ã€åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#3-3-4ã€åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="3.3.4ã€åˆ›å»ºé…ç½®æ–‡ä»¶"></a>3.3.4ã€åˆ›å»ºé…ç½®æ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kube-controller-manager.conf<br><br>KUBE_CONTROLLER_MANAGER_OPTS=<span class="hljs-string">&quot;--bind-address=127.0.0.1\</span><br><span class="hljs-string">  --secure-port=10257 \</span><br><span class="hljs-string">  --port=0 \</span><br><span class="hljs-string">  --kubeconfig=/app/kubernetes/kube-controller-manager.kubeconfig \</span><br><span class="hljs-string">  --service-cluster-ip-range=10.255.0.0/16 \</span><br><span class="hljs-string">  --cluster-name=kubernetes \</span><br><span class="hljs-string">  --cluster-signing-cert-file=/app/kubernetes/ssl/ca.pem \</span><br><span class="hljs-string">  --cluster-signing-key-file=/app/kubernetes/ssl/ca-key.pem \</span><br><span class="hljs-string">  --allocate-node-cidrs=true \</span><br><span class="hljs-string">  --cluster-cidr=10.0.0.0/16 \</span><br><span class="hljs-string">  --experimental-cluster-signing-duration=87600h \</span><br><span class="hljs-string">  --root-ca-file=/app/kubernetes/ssl/ca.pem \</span><br><span class="hljs-string">  --service-account-private-key-file=/app/kubernetes/ssl/ca-key.pem \</span><br><span class="hljs-string">  --leader-elect=true \</span><br><span class="hljs-string">  --feature-gates=RotateKubeletServerCertificate=true \</span><br><span class="hljs-string">  --controllers=*,bootstrapsigner,tokencleaner \</span><br><span class="hljs-string">  --horizontal-pod-autoscaler-use-rest-clients=true \</span><br><span class="hljs-string">  --horizontal-pod-autoscaler-sync-period=10s \</span><br><span class="hljs-string">  --tls-cert-file=/app/kubernetes/ssl/kube-controller-manager.pem \</span><br><span class="hljs-string">  --tls-private-key-file=/app/kubernetes/ssl/kube-controller-manager-key.pem \</span><br><span class="hljs-string">  --use-service-account-credentials=true \</span><br><span class="hljs-string">  --alsologtostderr=true \</span><br><span class="hljs-string">  --logtostderr=false \</span><br><span class="hljs-string">  --log-dir=/var/log/kubernetes \</span><br><span class="hljs-string">  --v=2&quot;</span><br><br></code></pre></td></tr></table></figure><p>æ³¨ï¼šHTTPæ¢æµ‹å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š400ï¼Œä»1.13å¼€å§‹ï¼Œkube-controller-managerå’Œkube-schedulerå°† 10259ï¼Œ10257 ä½œä¸ºå®‰å…¨ç«¯å£å…¬å¼€<br>ä¸å®‰å…¨çš„ç«¯å£ 10251ï¼Œ10252 å·²è¢«å¼ƒç”¨ã€‚<br>åº”è¯¥ä½¿ç”¨å®‰å…¨ç«¯å£ä½œä¸ºé»˜è®¤çš„livenessProbesã€‚<code>--secure-port=10257</code></p><h6 id="3-3-5ã€åˆ›å»ºå¯åŠ¨æ–‡ä»¶"><a href="#3-3-5ã€åˆ›å»ºå¯åŠ¨æ–‡ä»¶" class="headerlink" title="3.3.5ã€åˆ›å»ºå¯åŠ¨æ–‡ä»¶"></a>3.3.5ã€åˆ›å»ºå¯åŠ¨æ–‡ä»¶</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kube-controller-manager.service<br><br>[Unit]<br>Description=Kubernetes Controller Manager<br>Documentation=https://github.com/kubernetes/kubernetes<br><br>[Service]<br>EnvironmentFile=-/app/kubernetes/kube-controller-manager.conf<br>ExecStart=/usr/local/bin/kube-controller-manager <span class="hljs-variable">$KUBE_CONTROLLER_MANAGER_OPTS</span><br>Restart=on-failure<br>RestartSec=5<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><h5 id="3-3-6ã€åŒæ­¥ç›¸å…³çš„æ–‡ä»¶åˆ°å¯¹åº”è·¯å¾„"><a href="#3-3-6ã€åŒæ­¥ç›¸å…³çš„æ–‡ä»¶åˆ°å¯¹åº”è·¯å¾„" class="headerlink" title="3.3.6ã€åŒæ­¥ç›¸å…³çš„æ–‡ä»¶åˆ°å¯¹åº”è·¯å¾„"></a>3.3.6ã€åŒæ­¥ç›¸å…³çš„æ–‡ä»¶åˆ°å¯¹åº”è·¯å¾„</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> kube-controller-manager*.pem /app/kubernetes/ssl/<br><span class="hljs-built_in">cp</span> kube-controller-manager.kubeconfig /app/kubernetes/<br><span class="hljs-built_in">cp</span> kube-controller-manager.conf /app/kubernetes/<br><span class="hljs-built_in">cp</span> kube-controller-manager.service /usr/lib/systemd/system/<br></code></pre></td></tr></table></figure><h5 id="3-3-7ã€å¯åŠ¨æœåŠ¡"><a href="#3-3-7ã€å¯åŠ¨æœåŠ¡" class="headerlink" title="3.3.7ã€å¯åŠ¨æœåŠ¡"></a>3.3.7ã€å¯åŠ¨æœåŠ¡</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl daemon-reload <br>systemctl <span class="hljs-built_in">enable</span> kube-controller-manager<br>systemctl start kube-controller-manager<br>systemctl status kube-controller-manager<br></code></pre></td></tr></table></figure><h4 id="3-4ã€éƒ¨ç½²kube-scheduler"><a href="#3-4ã€éƒ¨ç½²kube-scheduler" class="headerlink" title="3.4ã€éƒ¨ç½²kube-scheduler"></a>3.4ã€éƒ¨ç½²kube-scheduler</h4><h5 id="3-4-1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶"><a href="#3-4-1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶" class="headerlink" title="3.4.1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶"></a>3.4.1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kube-scheduler-csr.json<br>&#123;<br>    <span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;system:kube-scheduler&quot;</span>,<br>    <span class="hljs-string">&quot;hosts&quot;</span>: [<br>      <span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>      <span class="hljs-string">&quot;192.168.94.247&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>: 2048<br>    &#125;,<br>    <span class="hljs-string">&quot;names&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>        <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;BeiJing&quot;</span>,<br>        <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;BeiJing&quot;</span>,<br>        <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;system:kube-scheduler&quot;</span>,<br>        <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;system&quot;</span><br>      &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="3-4-2ã€ç”Ÿæˆè¯ä¹¦"><a href="#3-4-2ã€ç”Ÿæˆè¯ä¹¦" class="headerlink" title="3.4.2ã€ç”Ÿæˆè¯ä¹¦"></a>3.4.2ã€ç”Ÿæˆè¯ä¹¦</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-scheduler-csr.json | cfssljson -bare kube-scheduler<br></code></pre></td></tr></table></figure><h5 id="3-4-3ã€è®¾ç½®é›†ç¾¤å‚æ•°"><a href="#3-4-3ã€è®¾ç½®é›†ç¾¤å‚æ•°" class="headerlink" title="3.4.3ã€è®¾ç½®é›†ç¾¤å‚æ•°"></a>3.4.3ã€è®¾ç½®é›†ç¾¤å‚æ•°</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl config set-cluster kubernetes --certificate-authority=ca.pem --embed-certs=<span class="hljs-literal">true</span> --server=https://192.168.94.247:6443 --kubeconfig=kube-scheduler.kubeconfig<br><span class="hljs-comment">#è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°</span><br>kubectl config set-credentials system:kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=<span class="hljs-literal">true</span> --kubeconfig=kube-scheduler.kubeconfig<br><span class="hljs-comment">#è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°</span><br>kubectl config set-context system:kube-scheduler --cluster=kubernetes --user=system:kube-scheduler --kubeconfig=kube-scheduler.kubeconfig<br><span class="hljs-comment">#è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡</span><br>kubectl config use-context system:kube-scheduler --kubeconfig=kube-scheduler.kubeconfig<br></code></pre></td></tr></table></figure><h5 id="3-4-4ã€åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#3-4-4ã€åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="3.4.4ã€åˆ›å»ºé…ç½®æ–‡ä»¶"></a>3.4.4ã€åˆ›å»ºé…ç½®æ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kube-scheduler.conf<br><br>KUBE_SCHEDULER_OPTS=<span class="hljs-string">&quot;--address=127.0.0.1 \</span><br><span class="hljs-string">--kubeconfig=/app/kubernetes/kube-scheduler.kubeconfig \</span><br><span class="hljs-string">--leader-elect=true \</span><br><span class="hljs-string">--alsologtostderr=true \</span><br><span class="hljs-string">--logtostderr=false \</span><br><span class="hljs-string">--log-dir=/var/log/kubernetes \</span><br><span class="hljs-string">--v=2&quot;</span><br></code></pre></td></tr></table></figure><h5 id="3-4-5ã€åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶"><a href="#3-4-5ã€åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶" class="headerlink" title="3.4.5ã€åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶"></a>3.4.5ã€åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kube-scheduler.service<br><br>[Unit]<br>Description=Kubernetes Scheduler<br>Documentation=https://github.com/kubernetes/kubernetes<br><br>[Service]<br>EnvironmentFile=-/app/kubernetes/kube-scheduler.conf<br>ExecStart=/usr/local/bin/kube-scheduler <span class="hljs-variable">$KUBE_SCHEDULER_OPTS</span><br>Restart=on-failure<br>RestartSec=5<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><h5 id="3-4-6ã€åŒæ­¥ç›¸å…³çš„æ–‡ä»¶åˆ°å¯¹åº”è·¯å¾„"><a href="#3-4-6ã€åŒæ­¥ç›¸å…³çš„æ–‡ä»¶åˆ°å¯¹åº”è·¯å¾„" class="headerlink" title="3.4.6ã€åŒæ­¥ç›¸å…³çš„æ–‡ä»¶åˆ°å¯¹åº”è·¯å¾„"></a>3.4.6ã€åŒæ­¥ç›¸å…³çš„æ–‡ä»¶åˆ°å¯¹åº”è·¯å¾„</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> kube-scheduler*.pem /app/kubernetes/ssl/<br><span class="hljs-built_in">cp</span> kube-scheduler.kubeconfig /app/kubernetes/<br><span class="hljs-built_in">cp</span> kube-scheduler.conf /app/kubernetes/<br><span class="hljs-built_in">cp</span> kube-scheduler.service /usr/lib/systemd/system/<br></code></pre></td></tr></table></figure><h5 id="3-4-7ã€å¯åŠ¨æœåŠ¡"><a href="#3-4-7ã€å¯åŠ¨æœåŠ¡" class="headerlink" title="3.4.7ã€å¯åŠ¨æœåŠ¡"></a>3.4.7ã€å¯åŠ¨æœåŠ¡</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> kube-scheduler<br>systemctl start kube-scheduler<br></code></pre></td></tr></table></figure><h4 id="3-5ã€å®‰è£…docker-ã€Šå„æœºå™¨ä¸Šéƒ½éœ€è¦å®‰è£…ã€‹"><a href="#3-5ã€å®‰è£…docker-ã€Šå„æœºå™¨ä¸Šéƒ½éœ€è¦å®‰è£…ã€‹" class="headerlink" title="3.5ã€å®‰è£…docker ã€Šå„æœºå™¨ä¸Šéƒ½éœ€è¦å®‰è£…ã€‹"></a>3.5ã€å®‰è£…docker ã€Šå„æœºå™¨ä¸Šéƒ½éœ€è¦å®‰è£…ã€‹</h4><h5 id="3-5-1ã€ä¸‹è½½å…³äºdockerçš„ä¾èµ–ç¯å¢ƒ"><a href="#3-5-1ã€ä¸‹è½½å…³äºdockerçš„ä¾èµ–ç¯å¢ƒ" class="headerlink" title="3.5.1ã€ä¸‹è½½å…³äºdockerçš„ä¾èµ–ç¯å¢ƒ"></a>3.5.1ã€ä¸‹è½½å…³äºdockerçš„ä¾èµ–ç¯å¢ƒ</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install yum-utils device-mapper-persistent-data lvm2<br></code></pre></td></tr></table></figure><h5 id="3-5-2ã€è®¾ç½®ä¸€ä¸‹ä¸‹è½½Dockerçš„é•œåƒæº"><a href="#3-5-2ã€è®¾ç½®ä¸€ä¸‹ä¸‹è½½Dockerçš„é•œåƒæº" class="headerlink" title="3.5.2ã€è®¾ç½®ä¸€ä¸‹ä¸‹è½½Dockerçš„é•œåƒæº"></a>3.5.2ã€è®¾ç½®ä¸€ä¸‹ä¸‹è½½Dockerçš„é•œåƒæº</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br></code></pre></td></tr></table></figure><h5 id="3-5-3ã€å®‰è£…docker"><a href="#3-5-3ã€å®‰è£…docker" class="headerlink" title="3.5.3ã€å®‰è£…docker"></a>3.5.3ã€å®‰è£…docker</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum makecache fast<br>yum -y install docker-ce<br></code></pre></td></tr></table></figure><h5 id="3-5-4ã€å¯åŠ¨dockeræœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨"><a href="#3-5-4ã€å¯åŠ¨dockeræœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨" class="headerlink" title="3.5.4ã€å¯åŠ¨dockeræœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨"></a>3.5.4ã€å¯åŠ¨dockeræœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start docker<br>systemctl <span class="hljs-built_in">enable</span> docker<br></code></pre></td></tr></table></figure><h5 id="3-5-5ã€ä¿®æ”¹dockeræºå’Œé©±åŠ¨-è‡ªå·±æœ¬åœ°æœ‰ä»“åº“çš„å¯ä»¥åŠ è‡ªå·±æœ¬åœ°çš„"><a href="#3-5-5ã€ä¿®æ”¹dockeræºå’Œé©±åŠ¨-è‡ªå·±æœ¬åœ°æœ‰ä»“åº“çš„å¯ä»¥åŠ è‡ªå·±æœ¬åœ°çš„" class="headerlink" title="3.5.5ã€ä¿®æ”¹dockeræºå’Œé©±åŠ¨  è‡ªå·±æœ¬åœ°æœ‰ä»“åº“çš„å¯ä»¥åŠ è‡ªå·±æœ¬åœ°çš„"></a>3.5.5ã€ä¿®æ”¹dockeræºå’Œé©±åŠ¨  è‡ªå·±æœ¬åœ°æœ‰ä»“åº“çš„å¯ä»¥åŠ è‡ªå·±æœ¬åœ°çš„</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">    &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span><br><span class="hljs-string">    &quot;registry-mirrors&quot;: [</span><br><span class="hljs-string">        &quot;https://1nj0zren.mirror.aliyuncs.com&quot;,</span><br><span class="hljs-string">        &quot;https://kfwkfulq.mirror.aliyuncs.com&quot;,</span><br><span class="hljs-string">        &quot;https://2lqq34jg.mirror.aliyuncs.com&quot;,</span><br><span class="hljs-string">        &quot;https://pee6w651.mirror.aliyuncs.com&quot;,</span><br><span class="hljs-string">        &quot;http://hub-mirror.c.163.com&quot;,</span><br><span class="hljs-string">        &quot;https://docker.mirrors.ustc.edu.cn&quot;,</span><br><span class="hljs-string">        &quot;http://f1361db2.m.daocloud.io&quot;,</span><br><span class="hljs-string">        &quot;https://registry.docker-cn.com&quot;</span><br><span class="hljs-string">    ]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment">#å¤‡æ³¨ï¼šexec-optsï¼šæ–‡ä»¶é©±åŠ¨(k8sé»˜è®¤æ˜¯systemd,è€Œdockeré»˜è®¤æ˜¯cgroupfs)</span><br></code></pre></td></tr></table></figure><h5 id="3-5-6ã€é‡å¯docker"><a href="#3-5-6ã€é‡å¯docker" class="headerlink" title="3.5.6ã€é‡å¯docker"></a>3.5.6ã€é‡å¯docker</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart docker<br></code></pre></td></tr></table></figure><h5 id="3-5-7ã€ä¸‹è½½ä¾èµ–é•œåƒ"><a href="#3-5-7ã€ä¸‹è½½ä¾èµ–é•œåƒ" class="headerlink" title="3.5.7ã€ä¸‹è½½ä¾èµ–é•œåƒ"></a>3.5.7ã€ä¸‹è½½ä¾èµ–é•œåƒ</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2<br>docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2 k8s.gcr.io/pause:3.2<br>docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2<br><br>docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.7.0<br>docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.7.0 k8s.gcr.io/coredns:1.7.0<br>docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.7.0<br></code></pre></td></tr></table></figure><h4 id="3-6ã€éƒ¨ç½²kubelet"><a href="#3-6ã€éƒ¨ç½²kubelet" class="headerlink" title="3.6ã€éƒ¨ç½²kubelet"></a>3.6ã€éƒ¨ç½²kubelet</h4><h5 id="3-6-1ã€åˆ›å»ºkubelet-bootstrap-kubeconfig"><a href="#3-6-1ã€åˆ›å»ºkubelet-bootstrap-kubeconfig" class="headerlink" title="3.6.1ã€åˆ›å»ºkubelet-bootstrap.kubeconfig"></a>3.6.1ã€åˆ›å»ºkubelet-bootstrap.kubeconfig</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è®¾ç½®å˜é‡ï¼Œè·å–token.csvä¸­çš„å­—ç¬¦ä¸²â€˜c7dee7fb28103826abeaf98c212d314aâ€™</span><br>BOOTSTRAP_TOKEN=$(awk -F <span class="hljs-string">&quot;,&quot;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> /app/kubernetes/token.csv)<br><br><span class="hljs-comment">#è®¾ç½®é›†ç¾¤å‚æ•°</span><br>kubectl config set-cluster kubernetes --certificate-authority=ca.pem --embed-certs=<span class="hljs-literal">true</span> --server=https://192.168.94.247:6443 --kubeconfig=kubelet-bootstrap.kubeconfig<br><span class="hljs-comment">#è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°</span><br>kubectl config set-credentials kubelet-bootstrap --token=<span class="hljs-variable">$&#123;BOOTSTRAP_TOKEN&#125;</span> --kubeconfig=kubelet-bootstrap.kubeconfig  <br><span class="hljs-comment">#è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°</span><br>kubectl config set-context default --cluster=kubernetes --user=kubelet-bootstrap --kubeconfig=kubelet-bootstrap.kubeconfig<br><span class="hljs-comment">#è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡</span><br>kubectl config use-context default --kubeconfig=kubelet-bootstrap.kubeconfig<br><span class="hljs-comment">#åˆ›å»ºè§’è‰²ç»‘å®š</span><br>kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap<br></code></pre></td></tr></table></figure><h5 id="3-6-2ã€åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#3-6-2ã€åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="3.6.2ã€åˆ›å»ºé…ç½®æ–‡ä»¶"></a>3.6.2ã€åˆ›å»ºé…ç½®æ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kubelet.json<br><br>&#123;<br>  <span class="hljs-string">&quot;kind&quot;</span>: <span class="hljs-string">&quot;KubeletConfiguration&quot;</span>,<br>  <span class="hljs-string">&quot;apiVersion&quot;</span>: <span class="hljs-string">&quot;kubelet.config.k8s.io/v1beta1&quot;</span>,<br>  <span class="hljs-string">&quot;authentication&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;x509&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;clientCAFile&quot;</span>: <span class="hljs-string">&quot;/app/kubernetes/ssl/ca.pem&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;webhook&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;enabled&quot;</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-string">&quot;cacheTTL&quot;</span>: <span class="hljs-string">&quot;2m0s&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;anonymous&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;enabled&quot;</span>: <span class="hljs-literal">false</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;authorization&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;Webhook&quot;</span>,<br>    <span class="hljs-string">&quot;webhook&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;cacheAuthorizedTTL&quot;</span>: <span class="hljs-string">&quot;5m0s&quot;</span>,<br>      <span class="hljs-string">&quot;cacheUnauthorizedTTL&quot;</span>: <span class="hljs-string">&quot;30s&quot;</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;address&quot;</span>: <span class="hljs-string">&quot;192.168.94.248&quot;</span>,<br>  <span class="hljs-string">&quot;port&quot;</span>: 10250,<br>  <span class="hljs-string">&quot;readOnlyPort&quot;</span>: 10255,<br>  <span class="hljs-string">&quot;cgroupDriver&quot;</span>: <span class="hljs-string">&quot;cgroupfs&quot;</span>,     <span class="hljs-comment">#å¦‚æœdockerçš„é©±åŠ¨ä¸ºsystemdï¼Œå¤„ä¿®æ”¹ä¸ºsystemdã€‚æ­¤å¤„è®¾ç½®å¾ˆé‡è¦ï¼Œå¦åˆ™åé¢nodeèŠ‚ç‚¹æ— æ³•åŠ å…¥åˆ°é›†ç¾¤ã€‚</span><br>  <span class="hljs-string">&quot;hairpinMode&quot;</span>: <span class="hljs-string">&quot;promiscuous-bridge&quot;</span>,<br>  <span class="hljs-string">&quot;serializeImagePulls&quot;</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-string">&quot;featureGates&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;RotateKubeletClientCertificate&quot;</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-string">&quot;RotateKubeletServerCertificate&quot;</span>: <span class="hljs-literal">true</span><br>  &#125;,<br>  <span class="hljs-string">&quot;clusterDomain&quot;</span>: <span class="hljs-string">&quot;cluster.local.&quot;</span>,<br>  <span class="hljs-string">&quot;clusterDNS&quot;</span>: [<span class="hljs-string">&quot;10.255.0.2&quot;</span>]<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>æ³¨ï¼šDocker åœ¨é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨çš„ <code>CgroupDriver</code> ä¸º <code>cgroupfs</code>ï¼Œ è€Œ Kubernetes æ¨èä½¿ç”¨<code>systemd</code> æ¥ä»£æ›¿ <code>cgroupfs</code>ï¼Œå¯é€šè¿‡ä¿®æ”¹ Docker çš„<code> Cgroup Driver</code>ä¸º<code>systemd</code><br>æ“ä½œï¼šç¼–è¾‘&#x2F;app&#x2F;docker&#x2F;daemon.json  æ·»åŠ ï¼šâ€exec-optsâ€: [â€œnative.cgroupdriver&#x3D;systemdâ€] </p><p><strong>ä»¥ä¸Šæ­¥éª¤3.5.5å·²ç»ä¿®æ”¹dockerçš„daemon.jsonï¼Œç›´æ¥ä¿®æ”¹ä»¥ä¸Šé…ç½®æ–‡ä»¶çš„<code>CgroupDriver</code>ä¸º<code>systemd</code>å³å¯</strong></p><h5 id="3-6-3ã€åˆ›å»ºå¯åŠ¨æ–‡ä»¶"><a href="#3-6-3ã€åˆ›å»ºå¯åŠ¨æ–‡ä»¶" class="headerlink" title="3.6.3ã€åˆ›å»ºå¯åŠ¨æ–‡ä»¶"></a>3.6.3ã€åˆ›å»ºå¯åŠ¨æ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kubelet.service<br><br>[Unit]<br>Description=Kubernetes Kubelet<br>Documentation=https://github.com/kubernetes/kubernetes<br>After=docker.service<br>Requires=docker.service<br><br>[Service]<br>WorkingDirectory=/var/lib/kubelet<br>ExecStart=/usr/local/bin/kubelet \<br>  --bootstrap-kubeconfig=/app/kubernetes/kubelet-bootstrap.kubeconfig \<br>  --cert-dir=/app/kubernetes/ssl \<br>  --kubeconfig=/app/kubernetes/kubelet.kubeconfig \<br>  --config=/app/kubernetes/kubelet.json \<br>  --network-plugin=cni \<br>  --pod-infra-container-image=k8s.gcr.io/pause:3.2 \<br>  --alsologtostderr=<span class="hljs-literal">true</span> \<br>  --logtostderr=<span class="hljs-literal">false</span> \<br>  --log-dir=/var/log/kubernetes \<br>  --v=2<br>Restart=on-failure<br>RestartSec=5<br><br>[Install]<br>WantedBy=multi-user.target<br><br><br></code></pre></td></tr></table></figure><p>æ³¨ï¼š<br>â€“ hostname-overrideï¼šæ˜¾ç¤ºåç§°ï¼Œé›†ç¾¤ä¸­å”¯ä¸€<br>â€“ network-pluginï¼šå¯ç”¨CNI<br>â€“ kubeconfigï¼šç©ºè·¯å¾„ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œåé¢ç”¨äºè¿æ¥apiserver<br>â€“ bootstrap-kubeconfigï¼šé¦–æ¬¡å¯åŠ¨å‘apiserverç”³è¯·è¯ä¹¦<br>â€“ configï¼šé…ç½®å‚æ•°æ–‡ä»¶<br>â€“ cert-dirï¼škubeletè¯ä¹¦ç”Ÿæˆç›®å½•<br>â€“ pod-infra-container-imageï¼šç®¡ç†Podç½‘ç»œå®¹å™¨çš„é•œåƒ</p><h5 id="3-6-4ã€åŒæ­¥æ–‡ä»¶åˆ°å„ä¸ªnodeèŠ‚ç‚¹ç›¸å…³è·¯å¾„ä¸‹ï¼Œå¹¶ä¿®æ”¹å„ä¸ªnodeèŠ‚ç‚¹çš„kubelet-jsonæ–‡ä»¶"><a href="#3-6-4ã€åŒæ­¥æ–‡ä»¶åˆ°å„ä¸ªnodeèŠ‚ç‚¹ç›¸å…³è·¯å¾„ä¸‹ï¼Œå¹¶ä¿®æ”¹å„ä¸ªnodeèŠ‚ç‚¹çš„kubelet-jsonæ–‡ä»¶" class="headerlink" title="3.6.4ã€åŒæ­¥æ–‡ä»¶åˆ°å„ä¸ªnodeèŠ‚ç‚¹ç›¸å…³è·¯å¾„ä¸‹ï¼Œå¹¶ä¿®æ”¹å„ä¸ªnodeèŠ‚ç‚¹çš„kubelet.jsonæ–‡ä»¶"></a>3.6.4ã€åŒæ­¥æ–‡ä»¶åˆ°å„ä¸ªnodeèŠ‚ç‚¹ç›¸å…³è·¯å¾„ä¸‹ï¼Œå¹¶ä¿®æ”¹å„ä¸ªnodeèŠ‚ç‚¹çš„kubelet.jsonæ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#masterèŠ‚ç‚¹ä¸å®‰è£…kubeletï¼Œåˆ™ä¸ç”¨åœ¨æœ¬æœºæ‰§è¡Œ</span><br><span class="hljs-comment">#cp kubelet-bootstrap.kubeconfig kubelet.json /app/kubernetes/</span><br><span class="hljs-comment">#cp kubelet.service /usr/lib/systemd/system/</span><br><span class="hljs-comment">#-----------------------------------------------------</span><br><br>scp  kubelet-bootstrap.kubeconfig kubelet.json k8s-node-1:/app/kubernetes<br>scp  kubelet-bootstrap.kubeconfig kubelet.json k8s-node-2:/app/kubernetes<br>scp ca.pem k8s-node-1:/app/kubernetes/ssl/<br>scp ca.pem k8s-node-2:/app/kubernetes/ssl/<br>scp kubelet.service k8s-node-1:/usr/lib/systemd/system/<br>scp kubelet.service k8s-node-2:/usr/lib/systemd/system/<br><br><span class="hljs-comment">#ä¿®æ”¹å„ä¸ªèŠ‚ç‚¹çš„kubelet.json</span><br>vim /app/kubernetes/kubelet.json<br>æ³¨ï¼škubelete.jsoné…ç½®æ–‡ä»¶addressæ”¹ä¸ºå„ä¸ªèŠ‚ç‚¹çš„ipåœ°å€<br></code></pre></td></tr></table></figure><h5 id="3-6-5ã€å¯åŠ¨æœåŠ¡-å„ä¸ªnodeèŠ‚ç‚¹ä¸Šæ“ä½œ"><a href="#3-6-5ã€å¯åŠ¨æœåŠ¡-å„ä¸ªnodeèŠ‚ç‚¹ä¸Šæ“ä½œ" class="headerlink" title="3.6.5ã€å¯åŠ¨æœåŠ¡(å„ä¸ªnodeèŠ‚ç‚¹ä¸Šæ“ä½œ)"></a>3.6.5ã€å¯åŠ¨æœåŠ¡(å„ä¸ªnodeèŠ‚ç‚¹ä¸Šæ“ä½œ)</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /var/lib/kubelet  <span class="hljs-comment">#æ·»åŠ å·¥ä½œç›®å½•</span><br><span class="hljs-built_in">mkdir</span> /var/log/kubernetes<br><br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> kubelet<br>systemctl start kubelet<br>systemctl status kubelet<br></code></pre></td></tr></table></figure><h5 id="3-6-6ã€æ‰¹å‡†è¯ä¹¦ç­¾åè¯·æ±‚"><a href="#3-6-6ã€æ‰¹å‡†è¯ä¹¦ç­¾åè¯·æ±‚" class="headerlink" title="3.6.6ã€æ‰¹å‡†è¯ä¹¦ç­¾åè¯·æ±‚"></a>3.6.6ã€æ‰¹å‡†è¯ä¹¦ç­¾åè¯·æ±‚</h5><p><strong>ç¡®è®¤kubeletæœåŠ¡å¯åŠ¨æˆåŠŸåï¼Œæ¥ç€åˆ°masterä¸ŠApproveä¸€ä¸‹bootstrapè¯·æ±‚ã€‚æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªnodeèŠ‚ç‚¹å‘é€äº†ä¸¤ä¸ªCSRè¯·æ±‚</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl get csr<br><br>kubectl certificate approve node-csr-G9iphq731LaemWmaJdmwPHpndwY3BjdF4SiZcRGpcMs<br><span class="hljs-comment">#node-csr-G9iphq731LaemWmaJdmwPHpndwY3BjdF4SiZcRGpcMs æ˜¯kubectl get csr å‡ºæ¥çš„name</span><br><br>kubectl certificate approve node-csr-TgFVoLnpuH_voga9jWlme8EJt98b5cPLLAxCrJr1urs<br><span class="hljs-comment">#node-csr-TgFVoLnpuH_voga9jWlme8EJt98b5cPLLAxCrJr1urs æ˜¯kubectl get csr å‡ºæ¥çš„name</span><br><br><span class="hljs-comment">#æ‰§è¡Œkubectl certificate approve å</span><br>kubectl get csr  <br><span class="hljs-comment">#CONDITIONä¸€æ  ç”±åŸæ¥çš„Pending å˜æˆäº† Approved,Issued</span><br><br><br><span class="hljs-comment">#æŸ¥çœ‹nodeèŠ‚ç‚¹çŠ¶æ€</span><br>kubectl get nodes<br></code></pre></td></tr></table></figure><h4 id="3-7ã€éƒ¨ç½²kube-proxy"><a href="#3-7ã€éƒ¨ç½²kube-proxy" class="headerlink" title="3.7ã€éƒ¨ç½²kube-proxy"></a>3.7ã€éƒ¨ç½²kube-proxy</h4><h5 id="3-7-1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶"><a href="#3-7-1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶" class="headerlink" title="3.7.1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶"></a>3.7.1ã€åˆ›å»ºcsrè¯·æ±‚æ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kube-proxy-csr.json<br><br>&#123;<br>  <span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;system:kube-proxy&quot;</span>,<br>  <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>    <span class="hljs-string">&quot;size&quot;</span>: 2048<br>  &#125;,<br>  <span class="hljs-string">&quot;names&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>      <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;BeiJing&quot;</span>,<br>      <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;BeiJing&quot;</span>,<br>      <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;k8s&quot;</span>,<br>      <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;system&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="3-7-2ã€ç”Ÿæˆè¯ä¹¦"><a href="#3-7-2ã€ç”Ÿæˆè¯ä¹¦" class="headerlink" title="3.7.2ã€ç”Ÿæˆè¯ä¹¦"></a>3.7.2ã€ç”Ÿæˆè¯ä¹¦</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy<br><br><span class="hljs-built_in">ls</span> kube-proxy*.pem<br></code></pre></td></tr></table></figure><h5 id="3-7-3ã€åˆ›å»ºkubeconfigæ–‡ä»¶"><a href="#3-7-3ã€åˆ›å»ºkubeconfigæ–‡ä»¶" class="headerlink" title="3.7.3ã€åˆ›å»ºkubeconfigæ–‡ä»¶"></a>3.7.3ã€åˆ›å»ºkubeconfigæ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl config set-cluster kubernetes --certificate-authority=ca.pem --embed-certs=<span class="hljs-literal">true</span> --server=https://192.168.94.247:6443 --kubeconfig=kube-proxy.kubeconfig<br>kubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=<span class="hljs-literal">true</span> --kubeconfig=kube-proxy.kubeconfig<br>kubectl config set-context default --cluster=kubernetes --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig<br>kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig<br></code></pre></td></tr></table></figure><h5 id="3-7-4ã€åˆ›å»ºkube-proxyé…ç½®æ–‡ä»¶"><a href="#3-7-4ã€åˆ›å»ºkube-proxyé…ç½®æ–‡ä»¶" class="headerlink" title="3.7.4ã€åˆ›å»ºkube-proxyé…ç½®æ–‡ä»¶"></a>3.7.4ã€åˆ›å»ºkube-proxyé…ç½®æ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kube-proxy.yaml<br><br><span class="hljs-comment">#-----------------------</span><br>apiVersion: kubeproxy.config.k8s.io/v1alpha1<br>bindAddress: 192.168.94.248<br>clientConnection:<br>  kubeconfig: /app/kubernetes/kube-proxy.kubeconfig<br><span class="hljs-comment">#clusterCIDR: 192.168.0.0/16            #æ­¤å¤„ç½‘æ®µå¿…é¡»ä¸ç½‘ç»œç»„ä»¶ç½‘æ®µä¿æŒä¸€è‡´ï¼Œå¦åˆ™éƒ¨ç½²ç½‘ç»œç»„ä»¶æ—¶ä¼šæŠ¥é”™</span><br>clusterCIDR: 10.0.0.0/16           <span class="hljs-comment">#æ­¤å¤„ç½‘æ®µå¿…é¡»ä¸ç½‘ç»œç»„ä»¶ç½‘æ®µä¿æŒä¸€è‡´ï¼Œå¦åˆ™éƒ¨ç½²ç½‘ç»œç»„ä»¶æ—¶ä¼šæŠ¥é”™</span><br>healthzBindAddress: 192.168.94.248:10256<br>kind: KubeProxyConfiguration<br>metricsBindAddress: 192.168.94.248:10249<br>mode: <span class="hljs-string">&quot;ipvs&quot;</span><br><span class="hljs-comment">#-----------------------------------</span><br></code></pre></td></tr></table></figure><h5 id="3-7-5ã€åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶"><a href="#3-7-5ã€åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶" class="headerlink" title="3.7.5ã€åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶"></a>3.7.5ã€åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim kube-proxy.service<br><br>[Unit]<br>Description=Kubernetes Kube-Proxy Server<br>Documentation=https://github.com/kubernetes/kubernetes<br>After=network.target<br><br>[Service]<br>WorkingDirectory=/var/lib/kube-proxy<br>ExecStart=/usr/local/bin/kube-proxy \<br>  --config=/app/kubernetes/kube-proxy.yaml \<br>  --alsologtostderr=<span class="hljs-literal">true</span> \<br>  --logtostderr=<span class="hljs-literal">false</span> \<br>  --log-dir=/var/log/kubernetes \<br>  --v=2<br>Restart=on-failure<br>RestartSec=5<br>LimitNOFILE=65536<br><br>[Install]<br>WantedBy=multi-user.target<br><br></code></pre></td></tr></table></figure><h5 id="3-7-6ã€åŒæ­¥æ–‡ä»¶åˆ°å„ä¸ªèŠ‚ç‚¹"><a href="#3-7-6ã€åŒæ­¥æ–‡ä»¶åˆ°å„ä¸ªèŠ‚ç‚¹" class="headerlink" title="3.7.6ã€åŒæ­¥æ–‡ä»¶åˆ°å„ä¸ªèŠ‚ç‚¹"></a>3.7.6ã€åŒæ­¥æ–‡ä»¶åˆ°å„ä¸ªèŠ‚ç‚¹</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#masterèŠ‚ç‚¹ä¸å®‰è£…kube-proxyï¼Œåˆ™ä»¥ä¸‹cpæ­¥éª¤ä¸ç”¨æ‰§è¡Œ</span><br><span class="hljs-comment">#---------------------------------------------------</span><br><span class="hljs-comment">#cp kube-proxy*.pem /app/kubernetes/ssl/</span><br><span class="hljs-comment">#cp kube-proxy.kubeconfig kube-proxy.yaml /app/kubernetes/</span><br><span class="hljs-comment">#cp kube-proxy.service /usr/lib/systemd/system/</span><br><span class="hljs-comment">#--------------------------------------------------------</span><br><br>scp kube-proxy.kubeconfig kube-proxy.yaml k8s-node-1:/app/kubernetes/<br>scp kube-proxy.kubeconfig kube-proxy.yaml k8s-node-2:/app/kubernetes/<br>scp kube-proxy.service k8s-node-1:/usr/lib/systemd/system/<br>scp kube-proxy.service k8s-node-2:/usr/lib/systemd/system/<br><br><br><span class="hljs-comment">#æ³¨ï¼šéœ€è¦å»å„å®‰è£…æœºå™¨ä¸Šï¼Œé…ç½®æ–‡ä»¶kube-proxy.yamlä¸­addressä¿®æ”¹ä¸ºå„èŠ‚ç‚¹çš„å®é™…IP</span><br>vim /app/kubernetes/kube-proxy.yaml<br></code></pre></td></tr></table></figure><h5 id="3-7-7ã€å¯åŠ¨kube-proxyæœåŠ¡"><a href="#3-7-7ã€å¯åŠ¨kube-proxyæœåŠ¡" class="headerlink" title="3.7.7ã€å¯åŠ¨kube-proxyæœåŠ¡"></a>3.7.7ã€å¯åŠ¨kube-proxyæœåŠ¡</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /var/lib/kube-proxy   <br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> kube-proxy<br>systemctl restart kube-proxy<br>systemctl status kube-proxy<br></code></pre></td></tr></table></figure><h5 id="3-7-8ã€é…ç½®ç½‘ç»œç»„ä»¶"><a href="#3-7-8ã€é…ç½®ç½‘ç»œç»„ä»¶" class="headerlink" title="3.7.8ã€é…ç½®ç½‘ç»œç»„ä»¶"></a>3.7.8ã€é…ç½®ç½‘ç»œç»„ä»¶</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://docs.projectcalico.org/v3.14/manifests/calico.yaml<br><br>kubectl apply -f calico.yaml<br><br><span class="hljs-comment">#æŸ¥çœ‹å„ä¸ªèŠ‚ç‚¹ï¼Œå‡ä¸ºReadyçŠ¶æ€</span><br>kubectl get pods -A<br>kubectl get nodes<br></code></pre></td></tr></table></figure><h5 id="3-7-9ã€éƒ¨ç½²coredns"><a href="#3-7-9ã€éƒ¨ç½²coredns" class="headerlink" title="3.7.9ã€éƒ¨ç½²coredns"></a>3.7.9ã€éƒ¨ç½²coredns</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#coredns.yamlæ–‡ä»¶åœ°å€ï¼šÂ https://raw.githubusercontent.com/coredns/deployment/master/kubernetes/coredns.yaml.sed</span><br><br>ä¸‹è½½åéœ€ä¿®æ”¹yamlæ–‡ä»¶:<br><span class="hljs-comment">#kubernetes cluster.local in-addr.arpa ip6.arpa</span><br><span class="hljs-comment">#forward . /etc/resolv.conf</span><br><span class="hljs-comment">#clusterIPä¸ºï¼š10.255.0.2(kubeleté…ç½®æ–‡ä»¶ä¸­çš„clusterDNS)</span><br><span class="hljs-comment">#</span><br>vim coredns.yaml<br><span class="hljs-comment">##----</span><br>apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>  name: coredns<br>  namespace: kube-system<br>---<br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRole<br>metadata:<br>  labels:<br>    kubernetes.io/bootstrapping: rbac-defaults<br>  name: system:coredns<br>rules:<br>- apiGroups:<br>  - <span class="hljs-string">&quot;&quot;</span><br>  resources:<br>  - endpoints<br>  - services<br>  - pods<br>  - namespaces<br>  verbs:<br>  - list<br>  - watch<br>---<br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRoleBinding<br>metadata:<br>  annotations:<br>    rbac.authorization.kubernetes.io/autoupdate: <span class="hljs-string">&quot;true&quot;</span><br>  labels:<br>    kubernetes.io/bootstrapping: rbac-defaults<br>  name: system:coredns<br>roleRef:<br>  apiGroup: rbac.authorization.k8s.io<br>  kind: ClusterRole<br>  name: system:coredns<br>subjects:<br>- kind: ServiceAccount<br>  name: coredns<br>  namespace: kube-system<br>---<br>apiVersion: v1<br>kind: ConfigMap<br>metadata:<br>  name: coredns<br>  namespace: kube-system<br>data:<br>  Corefile: |<br>    .:53 &#123;<br>        errors<br>        health &#123;<br>          lameduck 5s<br>        &#125;<br>        ready<br>        kubernetes cluster.local  in-addr.arpa ip6.arpa &#123;<br>          fallthrough in-addr.arpa ip6.arpa<br>        &#125;<br>        prometheus :9153<br>        forward . /etc/resolv.conf &#123;<br>          max_concurrent 1000<br>        &#125;<br>        cache 30<br>        loop<br>        reload<br>        loadbalance<br>    &#125;<br>---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: coredns<br>  namespace: kube-system<br>  labels:<br>    k8s-app: kube-dns<br>    kubernetes.io/name: <span class="hljs-string">&quot;CoreDNS&quot;</span><br>spec:<br>  <span class="hljs-comment"># replicas: not specified here:</span><br>  <span class="hljs-comment"># 1. Default is 1.</span><br>  <span class="hljs-comment"># 2. Will be tuned in real time if DNS horizontal auto-scaling is turned on.</span><br>  strategy:<br>    <span class="hljs-built_in">type</span>: RollingUpdate<br>    rollingUpdate:<br>      maxUnavailable: 1<br>  selector:<br>    matchLabels:<br>      k8s-app: kube-dns<br>  template:<br>    metadata:<br>      labels:<br>        k8s-app: kube-dns<br>    spec:<br>      priorityClassName: system-cluster-critical<br>      serviceAccountName: coredns<br>      tolerations:<br>        - key: <span class="hljs-string">&quot;CriticalAddonsOnly&quot;</span><br>          operator: <span class="hljs-string">&quot;Exists&quot;</span><br>      nodeSelector:<br>        kubernetes.io/os: linux<br>      affinity:<br>         podAntiAffinity:<br>           preferredDuringSchedulingIgnoredDuringExecution:<br>           - weight: 100<br>             podAffinityTerm:<br>               labelSelector:<br>                 matchExpressions:<br>                   - key: k8s-app<br>                     operator: In<br>                     values: [<span class="hljs-string">&quot;kube-dns&quot;</span>]<br>               topologyKey: kubernetes.io/hostname<br>      containers:<br>      - name: coredns<br>        image: coredns/coredns:1.8.0<br>        imagePullPolicy: IfNotPresent<br>        resources:<br>          limits:<br>            memory: 170Mi<br>          requests:<br>            cpu: 100m<br>            memory: 70Mi<br>        args: [ <span class="hljs-string">&quot;-conf&quot;</span>, <span class="hljs-string">&quot;/etc/coredns/Corefile&quot;</span> ]<br>        volumeMounts:<br>        - name: config-volume<br>          mountPath: /etc/coredns<br>          readOnly: <span class="hljs-literal">true</span><br>        ports:<br>        - containerPort: 53<br>          name: dns<br>          protocol: UDP<br>        - containerPort: 53<br>          name: dns-tcp<br>          protocol: TCP<br>        - containerPort: 9153<br>          name: metrics<br>          protocol: TCP<br>        securityContext:<br>          allowPrivilegeEscalation: <span class="hljs-literal">false</span><br>          capabilities:<br>            add:<br>            - NET_BIND_SERVICE<br>            drop:<br>            - all<br>          readOnlyRootFilesystem: <span class="hljs-literal">true</span><br>        livenessProbe:<br>          httpGet:<br>            path: /health<br>            port: 8080<br>            scheme: HTTP<br>          initialDelaySeconds: 60<br>          timeoutSeconds: 5<br>          successThreshold: 1<br>          failureThreshold: 5<br>        readinessProbe:<br>          httpGet:<br>            path: /ready<br>            port: 8181<br>            scheme: HTTP<br>      dnsPolicy: Default<br>      volumes:<br>        - name: config-volume<br>          configMap:<br>            name: coredns<br>            items:<br>            - key: Corefile<br>              path: Corefile<br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  name: kube-dns<br>  namespace: kube-system<br>  annotations:<br>    prometheus.io/port: <span class="hljs-string">&quot;9153&quot;</span><br>    prometheus.io/scrape: <span class="hljs-string">&quot;true&quot;</span><br>  labels:<br>    k8s-app: kube-dns<br>    kubernetes.io/cluster-service: <span class="hljs-string">&quot;true&quot;</span><br>    kubernetes.io/name: <span class="hljs-string">&quot;CoreDNS&quot;</span><br>spec:<br>  selector:<br>    k8s-app: kube-dns<br>  clusterIP: 10.255.0.2<br>  ports:<br>  - name: dns<br>    port: 53<br>    protocol: UDP<br>  - name: dns-tcp<br>    port: 53<br>    protocol: TCP<br>  - name: metrics<br>    port: 9153<br>    protocol: TCP<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¯åŠ¨coredns.yaml</span><br>kubectl apply -f coredns.yaml<br></code></pre></td></tr></table></figure><h3 id="4ã€æµ‹è¯•"><a href="#4ã€æµ‹è¯•" class="headerlink" title="4ã€æµ‹è¯•"></a>4ã€æµ‹è¯•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim nginx.yaml<br><br>---<br>apiVersion: v1<br>kind: ReplicationController<br>metadata:<br>  name: nginx-controller<br>spec:<br>  replicas: 2<br>  selector:<br>    name: nginx<br>  template:<br>    metadata:<br>      labels:<br>        name: nginx<br>    spec:<br>      containers:<br>        - name: nginx<br>          image: nginx:1.19.6<br>          ports:<br>            - containerPort: 80<br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  name: nginx-service-nodeport<br>spec:<br>  ports:<br>    - port: 80<br>      targetPort: 80<br>      nodePort: 9001<br>      protocol: TCP<br>  <span class="hljs-built_in">type</span>: NodePort<br>  selector:<br>    name: nginx<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl apply nginx.yaml<br>kubectl get svc<br>kubectl get pods<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
      <category>k8sç¯å¢ƒæ­å»º</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ZabbixæœåŠ¡å®‰è£…éƒ¨ç½²åŠç›‘æ§é…ç½®</title>
    <link href="/2023/04/18/%E7%9B%91%E6%8E%A7/Zabbix/Zabbix%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E7%9B%91%E6%8E%A7%E9%85%8D%E7%BD%AE/"/>
    <url>/2023/04/18/%E7%9B%91%E6%8E%A7/Zabbix/Zabbix%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E7%9B%91%E6%8E%A7%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ZabbixæœåŠ¡å®‰è£…éƒ¨ç½²åŠç›‘æ§é…ç½®"><a href="#ZabbixæœåŠ¡å®‰è£…éƒ¨ç½²åŠç›‘æ§é…ç½®" class="headerlink" title="ZabbixæœåŠ¡å®‰è£…éƒ¨ç½²åŠç›‘æ§é…ç½®"></a>ZabbixæœåŠ¡å®‰è£…éƒ¨ç½²åŠç›‘æ§é…ç½®</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">#å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/alexlv/p/14927373.html<br>#å‚è€ƒæ–‡æ¡£ï¼šhttps://mp.weixin.qq.com/s/zqU8wvEgsNRaolN71L0rXg<br></code></pre></td></tr></table></figure><p>ç®€ä»‹ï¼šzabbixæ˜¯ä¸€ä¸ªåŸºäºWEBç•Œé¢çš„æä¾›åˆ†å¸ƒå¼ç³»ç»Ÿç›‘è§†ä»¥åŠç½‘ç»œç›‘è§†åŠŸèƒ½çš„ä¼ä¸šçº§å¼€æºè§£å†³æ–¹æ¡ˆã€‚èƒ½å¤Ÿç›‘è§†å„ç§ç½‘ç»œå‚æ•°ï¼Œä¿è¯æœåŠ¡å™¨ç³»ç»Ÿçš„å®‰å…¨è¿è¥<br>æä¾›çµæ´»çš„é€šçŸ¥æœºåˆ¶è®©ç³»ç»Ÿç®¡ç†å‘˜å¿«é€Ÿå®šä½è§£å†³å­˜åœ¨çš„å„ç§é—®é¢˜</p><p>ä¸»è¦åŠŸèƒ½ï¼š<br>ç›‘æ§CPUè´Ÿè½½ã€å†…å­˜çš„ä½¿ç”¨ã€ç£ç›˜çš„ä½¿ç”¨ã€ç½‘ç»œçŠ¶æ€ã€ç«¯å£ç›‘è§†ã€æ—¥å¿—ç›‘è§†ã€æ’ä»¶å¼€å‘è‡ªå®šä¹‰</p><p>Zabbixçš„ä¸»è¦ç‰¹ç‚¹æœ‰<br>1.æŒ‡æ ‡æ”¶é›†:ä»ä»»ä½•è®¾å¤‡ã€ç³»ç»Ÿã€åº”ç”¨ç¨‹åºä¸Šè¿›è¡ŒæŒ‡æ ‡é‡‡é›†ï¼›<br>2.é—®é¢˜ç›‘æµ‹:å®šä½æ™ºèƒ½é˜€å€¼ï¼›<br>3.å¯è§†åŒ–:å•ä¸€ç•Œé¢ç®¡ç†å¹³å°ï¼›<br>4.å‘Šè­¦å’Œä¿®å¤:ç¡®ä¿åŠæ—¶ï¼Œæœ‰æ•ˆçš„å‘Šè­¦<br>5.å®‰å…¨å’Œè®¤è¯ï¼šä¿æŠ¤æ‚¨æ‰€æœ‰å±‚çº§çš„æ•°æ®<br>6.è½»æ¾æ­å»ºéƒ¨ç½²ï¼šå¤§æ‰¹æ¨¡æ¿ã€å¼€ç®±å³ç”¨ã€èŠ‚çœæ‚¨å®è´µçš„æ—¶é—´<br>7.è‡ªåŠ¨å‘ç°ï¼šè‡ªåŠ¨ç›‘æ§å¤§å‹åŠ¨æ€ç¯å¢ƒ<br>8.åˆ†å¸ƒå¼ç›‘æ§ï¼šæ— é™åˆ¶æ‰©å±•</p><p>è¿è¡Œæœºåˆ¶ï¼š</p><ul><li>Zabbix Serverå¯ä»¥é€šè¿‡ SNMPï¼ŒZabbix agentï¼ŒPingï¼Œç«¯å£ç›‘è§†ç­‰ä½ æ–¹æ³•æä¾›å¯¹è¿œç¨‹æœåŠ¡å™¨&#x2F;ç½‘ç»œçŠ¶æ€çš„ ç›‘è§†ï¼Œæ•°æ®æ”¶é›†åŠŸèƒ½ï¼Œå¯ä»¥åœ¨è¿è¡Œ Linuxï¼ŒSolarisï¼ŒHP-UXï¼ŒAIXï¼ŒFreeBSDï¼ŒOpenBSDï¼ŒOX Xï¼ŒWindows å¤š å¹³å°ã€‚</li><li>Zabbix Agent å®‰è£…åœ¨éœ€è¦è¢«ç›‘æ§çš„ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œä¸»è¦å®Œæˆå¯¹ç¡¬ä»¶ä¿¡æ¯ä¸æ“ä½œç³»ç»Ÿæœ‰å…³çš„å†…å­˜ï¼ŒCPU ç­‰ä½  ä¿¡æ¯æ”¶é›†ã€‚</li><li>Zabbix Server å¯ä»¥å•ç‹¬ç›‘è§†è¿œç¨‹æœåŠ¡å™¨çš„æœåŠ¡çŠ¶æ€ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¸ Zabbix Agent ç»“åˆã€‚å¯ä»¥è½®è¯¢ Zabbix Agent ä¸»åŠ¨æ¥æ”¶ç›‘è§†æ•°æ®ï¼ˆtrapping ä¼ é€’ æ–¹å¼ï¼‰ï¼ŒåŒæ—¶è¿˜å¯ä»¥è¢«åŠ¨æ¥æ”¶ Zabbix Agent å‘é€çš„æ•°æ®ã€‚</li><li>Zabbix proxy ä¸ºserviceæ”¶é›†æ•°æ®ï¼Œåˆ†æ‹…è´Ÿè½½çš„ç¨‹åºã€‚</li></ul><h2 id="ä¸€ã€Zabbixç›‘æ§éƒ¨ç½²ï¼š"><a href="#ä¸€ã€Zabbixç›‘æ§éƒ¨ç½²ï¼š" class="headerlink" title="ä¸€ã€Zabbixç›‘æ§éƒ¨ç½²ï¼š"></a>ä¸€ã€Zabbixç›‘æ§éƒ¨ç½²ï¼š</h2><p><strong>éƒ¨ç½²å‡†å¤‡ï¼š</strong><br>centos7 ç³»ç»ŸæœåŠ¡å™¨3å°ï¼Œä¸€å°ä½œä¸ºç›‘æ§æœåŠ¡å™¨ï¼ˆ192.168.94.154ï¼‰ï¼Œä¸¤å°ä½œä¸ºè¢«ç›‘æ§èŠ‚ç‚¹ï¼ˆ192.168.94.155&#x2F;192.168.94.156ï¼‰ã€‚</p><h3 id="1ã€æœåŠ¡å™¨é…ç½®ï¼š"><a href="#1ã€æœåŠ¡å™¨é…ç½®ï¼š" class="headerlink" title="1ã€æœåŠ¡å™¨é…ç½®ï¼š"></a>1ã€æœåŠ¡å™¨é…ç½®ï¼š</h3><p>| ä¸»æœºå | IPåœ°å€ | å®‰è£… |  å¤‡æ³¨ |<br>| â€”â€“ |<br>| mt-1  | 192.168.94.154 | Zabbix-service | å¼€å¯ç›‘æ§åŠŸèƒ½ |<br>| mt-2  | 192.168.94.155 | Zabbix-agent   | å¼€å¯        |<br>| mt-3  | 192.168.94.155 | Zabbix-agent   | å¼€å¯        |</p><h3 id="2ã€è®¾ç½®å…å¯†ç™»å½•ï¼ˆåœ¨192-168-94-154ä¸Šæ‰§è¡Œï¼‰"><a href="#2ã€è®¾ç½®å…å¯†ç™»å½•ï¼ˆåœ¨192-168-94-154ä¸Šæ‰§è¡Œï¼‰" class="headerlink" title="2ã€è®¾ç½®å…å¯†ç™»å½•ï¼ˆåœ¨192.168.94.154ä¸Šæ‰§è¡Œï¼‰"></a>2ã€è®¾ç½®å…å¯†ç™»å½•ï¼ˆåœ¨192.168.94.154ä¸Šæ‰§è¡Œï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">ssh-keygen  <span class="hljs-comment">#ä¸€è·¯å›è½¦å³å¯</span><br>ssh-copy-id mt-2<br>ssh-copy-id mt-3<br></code></pre></td></tr></table></figure><h3 id="3ã€æ‰€æœ‰æœºå™¨è®¾ç½®hosts"><a href="#3ã€æ‰€æœ‰æœºå™¨è®¾ç½®hosts" class="headerlink" title="3ã€æ‰€æœ‰æœºå™¨è®¾ç½®hosts"></a>3ã€æ‰€æœ‰æœºå™¨è®¾ç½®hosts</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">192.168.94.154 mt-1</span><br><span class="hljs-string">192.168.94.155 ct-1</span><br><span class="hljs-string">192.168.94.156 ct-2</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h3 id="4ã€æ‰€æœ‰æœºå™¨åšå¥½åŒæ­¥æ—¶é—´"><a href="#4ã€æ‰€æœ‰æœºå™¨åšå¥½åŒæ­¥æ—¶é—´" class="headerlink" title="4ã€æ‰€æœ‰æœºå™¨åšå¥½åŒæ­¥æ—¶é—´"></a>4ã€æ‰€æœ‰æœºå™¨åšå¥½åŒæ­¥æ—¶é—´</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install ntpd -y<br>ntpdate -u ntp.api.bz<br><span class="hljs-comment">#è®¾ç½®å®šæ—¶æŸ¥è¯¢æ˜¯å¦åŒæ­¥çš„è„šæœ¬</span><br>crontab -e<br><span class="hljs-comment">#æ·»åŠ å¦‚ä¸‹å†…å®¹</span><br>*/15 * * * * /usr/sbin/ntpdate -u pool.ntp.org &gt;/dev/null 2&gt;&amp;1<br></code></pre></td></tr></table></figure><h3 id="5ã€æ‰€æœ‰æœºå™¨å…³é—­é˜²ç«å¢™å’Œseliunx"><a href="#5ã€æ‰€æœ‰æœºå™¨å…³é—­é˜²ç«å¢™å’Œseliunx" class="headerlink" title="5ã€æ‰€æœ‰æœºå™¨å…³é—­é˜²ç«å¢™å’Œseliunx"></a>5ã€æ‰€æœ‰æœºå™¨å…³é—­é˜²ç«å¢™å’Œseliunx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl stop firewalld &amp;&amp; systemctl <span class="hljs-built_in">disable</span> firewalld<br>swapoff -a &amp;&amp; sed -i <span class="hljs-string">&#x27;/ swap / s/^\(.*\)$/#\1/g&#x27;</span> /etc/fstab<br>setenforce 0 &amp;&amp; sed -i <span class="hljs-string">&#x27;s/^SELINUX=.*/SELINUX=disabled/&#x27;</span> /etc/selinux/config<br></code></pre></td></tr></table></figure><h3 id="6ã€ä¸‹è½½å¹¶å®‰è£…rpmåŒ…ï¼ˆæ‰€æœ‰æœºå™¨å‡ä¸‹è½½å®‰è£…ï¼‰"><a href="#6ã€ä¸‹è½½å¹¶å®‰è£…rpmåŒ…ï¼ˆæ‰€æœ‰æœºå™¨å‡ä¸‹è½½å®‰è£…ï¼‰" class="headerlink" title="6ã€ä¸‹è½½å¹¶å®‰è£…rpmåŒ…ï¼ˆæ‰€æœ‰æœºå™¨å‡ä¸‹è½½å®‰è£…ï¼‰"></a>6ã€ä¸‹è½½å¹¶å®‰è£…rpmåŒ…ï¼ˆæ‰€æœ‰æœºå™¨å‡ä¸‹è½½å®‰è£…ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">##è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…rpmæº</span><br>rpm -Uvh https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm<br>sed -i <span class="hljs-string">&#x27;s#http://repo.zabbix.com#https://mirrors.aliyun.com/zabbix#&#x27;</span> /etc/yum.repos.d/zabbix.repo<br>yum clean all<br></code></pre></td></tr></table></figure><h3 id="7ã€å®‰è£…zabbix-serverå’Œagent"><a href="#7ã€å®‰è£…zabbix-serverå’Œagent" class="headerlink" title="7ã€å®‰è£…zabbix serverå’Œagent"></a>7ã€å®‰è£…zabbix serverå’Œagent</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install zabbix-server-mysql zabbix-agent -y<br></code></pre></td></tr></table></figure><h3 id="8ã€å®‰è£…zabbixå‰ç«¯"><a href="#8ã€å®‰è£…zabbixå‰ç«¯" class="headerlink" title="8ã€å®‰è£…zabbixå‰ç«¯"></a>8ã€å®‰è£…zabbixå‰ç«¯</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">##å®‰è£…Software Collections</span><br>yum install centos-release-scl -y<br><br><span class="hljs-comment">##å°†[zabbix-frontend]ä¸‹çš„ enabled æ”¹ä¸º 1</span><br>vim /etc/yum.repos.d/zabbix.repo <br><span class="hljs-comment">#--</span><br>enabled=1<br></code></pre></td></tr></table></figure><h3 id="9ã€å®‰è£…zabbix-å‰ç«¯å’Œç›¸å…³ç¯å¢ƒ"><a href="#9ã€å®‰è£…zabbix-å‰ç«¯å’Œç›¸å…³ç¯å¢ƒ" class="headerlink" title="9ã€å®‰è£…zabbix å‰ç«¯å’Œç›¸å…³ç¯å¢ƒ"></a>9ã€å®‰è£…zabbix å‰ç«¯å’Œç›¸å…³ç¯å¢ƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install zabbix-web-mysql-scl zabbix-apache-conf-scl -y<br></code></pre></td></tr></table></figure><h3 id="10ã€é…ç½®æ•°æ®åº“"><a href="#10ã€é…ç½®æ•°æ®åº“" class="headerlink" title="10ã€é…ç½®æ•°æ®åº“"></a>10ã€é…ç½®æ•°æ®åº“</h3><h4 id="æ–¹æ³•ä¸€ï¼šä½¿ç”¨çš„dockerè¿è¡Œçš„mysql"><a href="#æ–¹æ³•ä¸€ï¼šä½¿ç”¨çš„dockerè¿è¡Œçš„mysql" class="headerlink" title="æ–¹æ³•ä¸€ï¼šä½¿ç”¨çš„dockerè¿è¡Œçš„mysql"></a>æ–¹æ³•ä¸€ï¼šä½¿ç”¨çš„dockerè¿è¡Œçš„mysql</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull mysql:5.7<br><span class="hljs-comment">##è¿è¡Œmysqlå®¹å™¨</span><br>docker run -p 3306:3306 \<br>--name mysql -e TZ=Asia/Shanghai \<br>--restart=always \<br>-v /app/mysql/data:/var/lib/mysql \<br>-e MYSQL_ROOT_PASSWORD=123456 \<br>-d mysql:5.7<br><span class="hljs-comment">##åˆ›å»ºæ•°æ®åº“ï¼Œå¹¶æˆæƒ</span><br>mysql -uroot -p123456 --host 192.168.94.156 --port 3306 -e <span class="hljs-string">&quot;create database zabbix character set utf8 collate utf8_bin; grant all on zabbix.* to zabbix@&#x27;%&#x27;  identified by &#x27;zabbix&#x27; &quot;</span><br><span class="hljs-comment">###æ•°æ®åº“åzabbix ã€‚å…è®¸zabbixç”¨æˆ·é€šè¿‡æ‰€æœ‰ç½‘æ®µè®¿é—®æ•°æ®åº“ï¼ˆå¯ä»¥å°†%è®¾ç½®ä¸ºlocalhostï¼Œä»£è¡¨æœ¬æœºç½‘æ®µï¼‰ï¼Œå¯†ç zabbix</span><br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•äºŒï¼šå®‰è£…mariadbæ•°æ®åº“"><a href="#æ–¹æ³•äºŒï¼šå®‰è£…mariadbæ•°æ®åº“" class="headerlink" title="æ–¹æ³•äºŒï¼šå®‰è£…mariadbæ•°æ®åº“"></a>æ–¹æ³•äºŒï¼šå®‰è£…mariadbæ•°æ®åº“</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install mariadb-server -y<br><span class="hljs-comment">##å¯åŠ¨æ•°æ®åº“å¹¶é…ç½®å¼€æœºå¯åŠ¨</span><br>systemctl <span class="hljs-built_in">enable</span> --now mariadb<br><span class="hljs-comment">##åˆå§‹åŒ–æ•°æ®</span><br>mysql_secure_installation<br><span class="hljs-comment">##åˆ›å»ºzabbixæ•°æ®åº“åŠæ•°æ®åº“ç”¨æˆ·</span><br>mysql -u root -p <span class="hljs-string">&#x27;123456&#x27;</span><br><span class="hljs-comment">##åˆ›å»ºzabbixæ•°æ®åº“</span><br>create database zabbix default character <span class="hljs-built_in">set</span> utf8 COLLATE utf8_bin;<br><span class="hljs-comment">##åˆ›å»ºzabbixæ•°æ®åº“ç”¨æˆ·</span><br>grant all privileges on zabbix.* to zabbix@localhost identified by <span class="hljs-string">&quot;zabbix&quot;</span> ; <span class="hljs-comment">###æ•°æ®åº“åzabbix ã€‚å…è®¸zabbixç”¨æˆ·é€šè¿‡æœ¬æœºç½‘æ®µè®¿é—®æ•°æ®åº“ï¼ˆå¯ä»¥å°†localhostè®¾ç½®ä¸º%ä»£è¡¨æ‰€æœ‰ç½‘æ®µï¼‰ï¼Œå¯†ç zabbix</span><br>quit <span class="hljs-comment">#é€€å‡º</span><br></code></pre></td></tr></table></figure><h3 id="11ã€å¯¼å…¥zabbixæ•°æ®åº“"><a href="#11ã€å¯¼å…¥zabbixæ•°æ®åº“" class="headerlink" title="11ã€å¯¼å…¥zabbixæ•°æ®åº“"></a>11ã€å¯¼å…¥zabbixæ•°æ®åº“</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ls /usr/share/doc/zabbix-server-mysql*/create.sql.gz æŸ¥çœ‹æ˜¯å¦</span><br>zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz |mysql -uzabbix -pzabbix --host 192.168.94.156 --port 3306 zabbix<br></code></pre></td></tr></table></figure><h3 id="12ã€zabbixé…ç½®åŠå‰ç«¯é¡µé¢å®‰è£…"><a href="#12ã€zabbixé…ç½®åŠå‰ç«¯é¡µé¢å®‰è£…" class="headerlink" title="12ã€zabbixé…ç½®åŠå‰ç«¯é¡µé¢å®‰è£…"></a>12ã€zabbixé…ç½®åŠå‰ç«¯é¡µé¢å®‰è£…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¿®æ”¹zabbix serveré…ç½®æ–‡ä»¶é‡Œçš„æ•°æ®åº“ä¿¡æ¯</span><br>vim /etc/zabbix/zabbix_server.conf<br><br>DBPassword=zabbix <span class="hljs-comment">#æ•°æ®åº“å¯†ç æ”¹ä¸ºzabbixæ•°æ®åº“çš„å¯†ç </span><br><span class="hljs-comment"># DBHost=192.168.94.156 #é»˜è®¤æ˜¯è¿æ¥æœ¬æœºï¼Œå¦‚æœä¸æ˜¯æœ¬æœºå¯åŠ¨çš„æ•°æ®åº“éœ€è¦è®¾ç½®hoståœ°å€</span><br><br><span class="hljs-comment">#ä¿®æ”¹zabbix phpé…ç½®æ–‡ä»¶é‡Œçš„æ—¶åŒº</span><br>vim /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf<br><span class="hljs-comment">##æ‰¾åˆ°php_value[date.timezone]ï¼Œå»æ‰æ³¨é‡ŠåŠå‰é¢çš„æ ‡ç‚¹ç¬¦å·ï¼Œæ”¹æˆAsia/Shanghai</span><br>php_value[date.timezone] = Asia/Shanghai <br><br><span class="hljs-comment">#å¯åŠ¨ç›¸å…³æœåŠ¡å¹¶é…ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</span><br>systemctl restart zabbix-server zabbix-agent httpd rh-php72-php-fpm<br>systemctl <span class="hljs-built_in">enable</span> zabbix-server zabbix-agent httpd rh-php72-php-fpm<br></code></pre></td></tr></table></figure><h3 id="13ã€è®¿é—®ï¼šhttp-192-168-94-154-zabbix-setup-php-ç»§ç»­å®‰è£…"><a href="#13ã€è®¿é—®ï¼šhttp-192-168-94-154-zabbix-setup-php-ç»§ç»­å®‰è£…" class="headerlink" title="13ã€è®¿é—®ï¼šhttp://192.168.94.154/zabbix/setup.php ç»§ç»­å®‰è£…"></a>13ã€è®¿é—®ï¼š<a href="http://192.168.94.154/zabbix/setup.php">http://192.168.94.154/zabbix/setup.php</a> ç»§ç»­å®‰è£…</h3><p>1ã€ç‚¹å‡»Next stepå¼€å§‹å®‰è£…<br>2ã€è‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒï¼Œæ‰€æœ‰é€‰é¡¹éƒ½ä¸ºOKåˆ™ç‚¹å‡»Next stepè¿›è¡Œä¸‹ä¸€æ­¥<br>3ã€é…ç½®æ•°æ®åº“è¿æ¥ï¼Œportå¡«å†™0ä¸ºé»˜è®¤3306ç«¯å£ï¼Œé…ç½®æ­£ç¡®çš„hostã€nameã€passwordåç‚¹å‡»Next stepè¿›è¡Œä¸‹ä¸€æ­¥<br>4ã€Zabbix serberé…ç½®é»˜è®¤æ— éœ€ä¿®æ”¹ï¼Œç›´æ¥ç‚¹å‡»Next stepè¿›è¡Œä¸‹ä¸€æ­¥<br>5ã€æ£€æŸ¥æ‰€æœ‰å‚æ•°ï¼Œç„¶åç‚¹å‡»Next stepè¿›è¡Œä¸‹ä¸€æ­¥<br>6ã€æ˜¾ç¤ºsuccessfullyåä»£è¡¨å®‰è£…å®Œæˆï¼Œç‚¹å‡»Finishå®Œæˆå®‰è£…</p><p>ç™»å½•zabbixï¼Œé»˜è®¤ç”¨æˆ·åä¸ºAdminï¼Œå¯†ç ä¸ºzabbix</p><p>é…ç½®ä¸­æ–‡è¯­è¨€ï¼š<br>ç‚¹å‡»å·¦ä¸‹è§’User settingsï¼Œé€‰æ‹©Languageä¸ºChineseï¼ˆzh_CNï¼‰</p><h3 id="14ã€é…ç½®ç›‘æ§ä¸»æœºï¼ˆmt-2-ã€mt-3ï¼‰"><a href="#14ã€é…ç½®ç›‘æ§ä¸»æœºï¼ˆmt-2-ã€mt-3ï¼‰" class="headerlink" title="14ã€é…ç½®ç›‘æ§ä¸»æœºï¼ˆmt-2 ã€mt-3ï¼‰"></a>14ã€é…ç½®ç›‘æ§ä¸»æœºï¼ˆmt-2 ã€mt-3ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å®‰è£…zabbix-agent</span><br>rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm<br>yum -y install zabbix-agent<br><br><span class="hljs-comment">#é…ç½®zabbix-agent</span><br>ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹å†…å®¹<br>vim /etc/zabbix/zabbix_agentd.conf<br><br>Server=192.168.94.154    <span class="hljs-comment"># zabbixzæœåŠ¡ç«¯IPï¼ˆè¢«åŠ¨æ¨¡å¼ï¼‰</span><br>ServerActive=192.168.94.154  <span class="hljs-comment"># zabbixzæœåŠ¡ç«¯IPï¼ŒActiveè¡¨ç¤ºagentä¸»åŠ¨æ¨é€</span><br>Hostname=mt2     <span class="hljs-comment"># zabbixå®¢æˆ·ç«¯ä¸»æœºåç§°</span><br><br><span class="hljs-comment">#å¯ç”¨zabbix-agent</span><br>systemctl <span class="hljs-built_in">enable</span> zabbix-agent<br>systemctl restart zabbix-agent<br></code></pre></td></tr></table></figure><h3 id="15ã€æµ‹è¯•"><a href="#15ã€æµ‹è¯•" class="headerlink" title="15ã€æµ‹è¯•"></a>15ã€æµ‹è¯•</h3><p>åœ¨ä¸»ç›‘æ§æœºå­ï¼ˆzabbix-serviceï¼‰ä¸Šï¼Œæµ‹è¯•æ˜¯å¦è¿é€šè¢«ç›‘æ§æœºå­ï¼š</p><h4 id="1-åœ¨ç›‘æ§ä¸»æœºä¸Š"><a href="#1-åœ¨ç›‘æ§ä¸»æœºä¸Š" class="headerlink" title="1.åœ¨ç›‘æ§ä¸»æœºä¸Š"></a>1.åœ¨ç›‘æ§ä¸»æœºä¸Š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install zabbix-get -y<br></code></pre></td></tr></table></figure><h4 id="2-æµ‹è¯•ä¸è¢«æ§æœåŠ¡å™¨çš„è¿é€šæ€§ï¼Œä¸‹é¢ipåœ°å€ï¼Œæ˜¯è¢«ç›‘æ§æœåŠ¡å™¨çš„ipåœ°å€"><a href="#2-æµ‹è¯•ä¸è¢«æ§æœåŠ¡å™¨çš„è¿é€šæ€§ï¼Œä¸‹é¢ipåœ°å€ï¼Œæ˜¯è¢«ç›‘æ§æœåŠ¡å™¨çš„ipåœ°å€" class="headerlink" title="2.æµ‹è¯•ä¸è¢«æ§æœåŠ¡å™¨çš„è¿é€šæ€§ï¼Œä¸‹é¢ipåœ°å€ï¼Œæ˜¯è¢«ç›‘æ§æœåŠ¡å™¨çš„ipåœ°å€"></a>2.æµ‹è¯•ä¸è¢«æ§æœåŠ¡å™¨çš„è¿é€šæ€§ï¼Œä¸‹é¢ipåœ°å€ï¼Œæ˜¯è¢«ç›‘æ§æœåŠ¡å™¨çš„ipåœ°å€</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">zabbix_get -s <span class="hljs-string">&#x27;192.168.5.111&#x27;</span> -p 10050 -k <span class="hljs-string">&quot;agent.ping&quot;</span>    1ä»£è¡¨æˆåŠŸ<br>zabbix_get -s <span class="hljs-string">&#x27;192.168.5.111&#x27;</span> -p 10050 -k <span class="hljs-string">&quot;system.hostname&quot;</span>    çœ‹çœ‹è¿”å›çš„ä¸»æœºå <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç›‘æ§</category>
      
      <category>Zabbix</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zabbix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨dockerå®‰è£…Zabbix</title>
    <link href="/2023/04/17/%E7%9B%91%E6%8E%A7/Zabbix/docker%E5%AE%89%E8%A3%85zabbix/"/>
    <url>/2023/04/17/%E7%9B%91%E6%8E%A7/Zabbix/docker%E5%AE%89%E8%A3%85zabbix/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨dockerå®‰è£…Zabbixï¼š"><a href="#ä½¿ç”¨dockerå®‰è£…Zabbixï¼š" class="headerlink" title="ä½¿ç”¨dockerå®‰è£…Zabbixï¼š"></a>ä½¿ç”¨dockerå®‰è£…Zabbixï¼š</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">#å‚è€ƒæ–‡æ¡£ï¼šdockerå®‰è£…zabbixï¼šhttps://www.cnblogs.com/xdzy/p/13805762.html<br>#å‚è€ƒæ–‡æ¡£ï¼šhttps://hlynford.com/616.html<br>#å‚è€ƒæ–‡æ¡£ï¼šhttps://www.csdn.net/tags/MtjaMgysMjY5MTQtYmxvZwO0O0OO0O0O.html<br></code></pre></td></tr></table></figure><h2 id="1-å‡†å¤‡æœºå™¨"><a href="#1-å‡†å¤‡æœºå™¨" class="headerlink" title="1.å‡†å¤‡æœºå™¨"></a>1.å‡†å¤‡æœºå™¨</h2><table><thead><tr><th>IPåœ°å€</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>192.168.5.112</td><td>ä½¿ç”¨dockerå®‰è£…ï¼šzabbix-serverã€mysql</td></tr><tr><td>192.168.5.111</td><td>zabbix-agent</td></tr></tbody></table><p>å…³é—­é˜²ç«å¢™</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl stop firewalld<br></code></pre></td></tr></table></figure><h2 id="2-å®‰è£…mysql"><a href="#2-å®‰è£…mysql" class="headerlink" title="2.å®‰è£…mysql"></a>2.å®‰è£…mysql</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull mysql:5.7<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå®¹å™¨:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run --name mysql-server -t \<br>      -p 3307:3306 \<br>      -e MYSQL_DATABASE=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      -e MYSQL_USER=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      -e MYSQL_PASSWORD=<span class="hljs-string">&quot;zabbix_pwd&quot;</span> \<br>      -e MYSQL_ROOT_PASSWORD=<span class="hljs-string">&quot;admins&quot;</span> \<br>      -d mysql:5.7 \<br>      --character-set-server=utf8 --collation-server=utf8_bin<br></code></pre></td></tr></table></figure><p>&lt;æ–¹æ³•äºŒï¼šä¸å¼€æ”¾ç«¯å£ï¼Œç›´æ¥ç”¨linkæ–¹å¼&gt;è¿›è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run --name mysql-server -t \<br>      -e MYSQL_DATABASE=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      -e MYSQL_USER=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      -e MYSQL_PASSWORD=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      -e MYSQL_ROOT_PASSWORD=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      -d mysql:5.7 \<br>      --character-set-server=utf8 --collation-server=utf8_bin<br></code></pre></td></tr></table></figure><h2 id="3-å®‰è£…zabbix-java-gateway"><a href="#3-å®‰è£…zabbix-java-gateway" class="headerlink" title="3.å®‰è£…zabbix-java-gateway"></a>3.å®‰è£…zabbix-java-gateway</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull zabbix/zabbix-java-gateway<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå®¹å™¨:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run --name zabbix-java-gateway -t \<br>  -d zabbix/zabbix-java-gateway:latest<br></code></pre></td></tr></table></figure><h2 id="4-å®‰è£…zabbix-server-mysql"><a href="#4-å®‰è£…zabbix-server-mysql" class="headerlink" title="4.å®‰è£…zabbix-server-mysql"></a>4.å®‰è£…zabbix-server-mysql</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull zabbix/zabbix-server-mysql<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå®¹å™¨:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run --name zabbix-server-mysql -t \<br>  -e DB_SERVER_HOST=<span class="hljs-string">&quot;192.168.5.112&quot;</span> \<br>  -e DB_SERVER_PORT=3307 \<br>  -e MYSQL_DATABASE=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>  -e MYSQL_USER=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>  -e MYSQL_PASSWORD=<span class="hljs-string">&quot;zabbix_pwd&quot;</span> \<br>  -e MYSQL_ROOT_PASSWORD=<span class="hljs-string">&quot;admins&quot;</span> \<br>  -e ZBX_JAVAGATEWAY=<span class="hljs-string">&quot;zabbix-java-gateway&quot;</span> \<br>  --<span class="hljs-built_in">link</span> mysql-server:mysql \<br>  --<span class="hljs-built_in">link</span> zabbix-java-gateway:zabbix-java-gateway \<br>  -p 10051:10051 \<br>  -d zabbix/zabbix-server-mysql:latest<br><br><span class="hljs-comment">#å¤‡æ³¨ï¼šDB_SERVER_HOSTåœ°å€ä¸ºmysqléƒ¨ç½²æœºå™¨ip</span><br></code></pre></td></tr></table></figure><p>å½“å‰é¢ä½¿ç”¨ä½¿ç”¨&lt;æ–¹æ³•äºŒï¼šä¸å¼€æ”¾ç«¯å£è¿è¡Œmysqlæ—¶&gt;è¿è¡Œå¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run --name zabbix-server-mysql -t \<br>      -e DB_SERVER_HOST=<span class="hljs-string">&quot;mysql-server&quot;</span> \<br>      -e MYSQL_DATABASE=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      -e MYSQL_USER=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      -e MYSQL_PASSWORD=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      -e MYSQL_ROOT_PASSWORD=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      -e ZBX_JAVAGATEWAY=<span class="hljs-string">&quot;zabbix-java-gateway&quot;</span> \<br>      --<span class="hljs-built_in">link</span> mysql-server:mysql \<br>      --<span class="hljs-built_in">link</span> zabbix-java-gateway:zabbix-java-gateway \<br>      -p 10051:10051 \<br>      -d zabbix/zabbix-server-mysql:latest<br></code></pre></td></tr></table></figure><h2 id="5-å®‰è£…zabbix-web-nginx-mysql"><a href="#5-å®‰è£…zabbix-web-nginx-mysql" class="headerlink" title="5.å®‰è£…zabbix-web-nginx-mysql"></a>5.å®‰è£…zabbix-web-nginx-mysql</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull zabbix/zabbix-web-nginx-mysql<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå®¹å™¨:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run --name zabbix-web-nginx-mysql -t \<br>    -e PHP_TZ=<span class="hljs-string">&quot;Asia/Shanghai&quot;</span> \<br>    -e DB_SERVER_HOST=<span class="hljs-string">&quot;192.168.5.112&quot;</span> \<br>    -e DB_SERVER_PORT=3307 \<br>    -e MYSQL_DATABASE=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>    -e MYSQL_USER=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>    -e MYSQL_PASSWORD=<span class="hljs-string">&quot;zabbix_pwd&quot;</span> \<br>    -e MYSQL_ROOT_PASSWORD=<span class="hljs-string">&quot;admins&quot;</span> \<br>    --<span class="hljs-built_in">link</span> mysql-server:mysql \<br>    --<span class="hljs-built_in">link</span> zabbix-server-mysql:zabbix-server \<br>    -p 80:8080 \<br>    -d zabbix/zabbix-web-nginx-mysql:latest<br></code></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼šDB_SERVER_HOSTåœ°å€ä¸ºmysqléƒ¨ç½²æœºå™¨ip</p><p>å½“å‰é¢ä½¿ç”¨ä½¿ç”¨&lt;æ–¹æ³•äºŒï¼šä¸å¼€æ”¾ç«¯å£è¿è¡Œmysqlæ—¶&gt;è¿è¡Œå¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run --name zabbix-web-nginx-mysql -t \<br>      -e DB_SERVER_HOST=<span class="hljs-string">&quot;mysql-server&quot;</span> \<br>      -e MYSQL_DATABASE=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      -e MYSQL_USER=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      -e MYSQL_PASSWORD=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      -e MYSQL_ROOT_PASSWORD=<span class="hljs-string">&quot;zabbix&quot;</span> \<br>      --<span class="hljs-built_in">link</span> mysql-server:mysql \<br>      --<span class="hljs-built_in">link</span> zabbix-server-mysql:zabbix-server \<br>      -p 80:8080 \<br>      -d zabbix/zabbix-web-nginx-mysql:latest<br></code></pre></td></tr></table></figure><h2 id="6-ç™»å½•"><a href="#6-ç™»å½•" class="headerlink" title="6.ç™»å½•"></a>6.ç™»å½•</h2><p>è®¿é—®ï¼š192.168.5.112:80</p><p>ç™»å½•è´¦å·ï¼šAdmin<br>ç™»å½•å¯†ç ï¼šzabbix</p><h2 id="7-è®¾ç½®ä¸ºä¸­æ–‡å­—ä½“"><a href="#7-è®¾ç½®ä¸ºä¸­æ–‡å­—ä½“" class="headerlink" title="7.è®¾ç½®ä¸ºä¸­æ–‡å­—ä½“"></a>7.è®¾ç½®ä¸ºä¸­æ–‡å­—ä½“</h2><p>User settings &gt;&gt; Profile &gt;&gt; language</p><p><strong>è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜ï¼š</strong><br>åœ¨è‡ªå·±windowç”µè„‘ä¸Šè¿›å…¥åˆ° C:\Windows\Fonts\ æœç´¢æ¥·ä½“èƒ½æ‰¾åˆ°è¯¥å­—ä½“ï¼Œå°†è¯¥å­—ä½“ä¸Šä¼ åˆ°æœåŠ¡å™¨<br>æ‹·è´åˆ°å®¹å™¨å†…ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker <span class="hljs-built_in">cp</span> simkai.ttf zabbix-web-nginx-mysql:/usr/share/zabbix/assets/fonts/<br></code></pre></td></tr></table></figure><p>è¿›å…¥å®¹å™¨ä¿®æ”¹é…ç½®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker <span class="hljs-built_in">exec</span> -it zabbix-web-nginx-mysql /bin/bash<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /usr/share/zabbix/include/defines.inc.php<br><span class="hljs-comment">#.....</span><br><span class="hljs-comment">#æ›´æ”¹å‰</span><br>// define(<span class="hljs-string">&#x27;ZBX_GRAPH_FONT_NAME&#x27;</span>,                <span class="hljs-string">&#x27;DejaVuSans&#x27;</span>); // font file name<br><span class="hljs-comment">#æ›´æ”¹å</span><br>define(<span class="hljs-string">&#x27;ZBX_GRAPH_FONT_NAME&#x27;</span>,           <span class="hljs-string">&#x27;simkai&#x27;</span>); // font file name<br></code></pre></td></tr></table></figure><h2 id="8-liunxå®‰è£…zabbix-agent"><a href="#8-liunxå®‰è£…zabbix-agent" class="headerlink" title="8.liunxå®‰è£…zabbix-agent:"></a>8.liunxå®‰è£…zabbix-agent:</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å®‰è£…Zabbix Yumæºä»“åº“</span><br>rpm -Uvh https://repo.zabbix.com/zabbix/5.4/rhel/7/x86_64/zabbix-release-5.4-1.el7.noarch.rpm<br>yum clean all<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¿®æ”¹Zabbix 5.0 Yumæºé…ç½®æ–‡ä»¶ï¼š</span><br>sed -i <span class="hljs-string">&quot;s/gpgcheck=1/gpgcheck=0/g&quot;</span> /etc/yum.repos.d/zabbix.repo<br><br><span class="hljs-comment">#å®‰è£…zabbix-agent 5.0è½¯ä»¶</span><br>yum -y install zabbix-agent<br><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¿®æ”¹zabbix-agenté…ç½®æ–‡ä»¶ï¼š</span><br>vim /etc/zabbix/zabbix_agentd.conf<br><br>119 Server=192.168.5.112   //Zabbix-serveråœ°å€ï¼Œå¤šä¸ªç”¨<span class="hljs-string">&quot;,&quot;</span>éš”å¼€<br>125 ListenPort=10050       //è‡ªå·±ç›‘å¬çš„ç«¯å£<br>133 ListenIP=0.0.0.0       //è‡ªå·±ç›‘å¬çš„åœ°å€ï¼Œ0.0.0.0ä»£è¡¨æœ¬æœºæ‰€æœ‰çš„åœ°å€<br>160 ServerActive=192.168.5.112     //ä¸»åŠ¨æ£€æŸ¥æœ¬ä¸»æœºæ•°æ®å‘é€ç»™Zabbix-server<br>171 <span class="hljs-comment">#Hostname=Zabbix server</span><br>172 Hostname=192.168.5.111     //Zabbix-agentåœ°å€<br></code></pre></td></tr></table></figure><p>å¯åŠ¨zabbix-agent</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start zabbix-agent<br>systemctl <span class="hljs-built_in">enable</span> zabbix-agent<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ç«¯å£æ˜¯å¦æ­£å¸¸</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ss -antulp | grep :10050<br></code></pre></td></tr></table></figure><h2 id="9-é…ç½®ç›‘æ§çš„agentæœºå™¨"><a href="#9-é…ç½®ç›‘æ§çš„agentæœºå™¨" class="headerlink" title="9. é…ç½®ç›‘æ§çš„agentæœºå™¨"></a>9. é…ç½®ç›‘æ§çš„agentæœºå™¨</h2><p>#ç‚¹å‡»é…ç½® &gt;&gt; ä¸»æœº  &gt;&gt; è®¾ç½®ä¸»æœºåç§°ï¼Œç¾¤ç»„ä»¥åŠInterfaces  &gt;&gt; ç„¶åé€‰æ‹©æ¨¡æ¿</p><p><img src="/2023/04/17/%E7%9B%91%E6%8E%A7/Zabbix/docker%E5%AE%89%E8%A3%85zabbix/image-20220715172504701.png" alt="image-20220715172504701"></p><p>å…³è”æ¨¡æ¿(å¦‚æœä¸å…³è”ç›‘æ§æ¨¡æ¿ï¼Œzbx å¯ç”¨æ€§å›¾æ ‡ä¼šä¸€ç›´ä¸äº®)</p><p><img src="/2023/04/17/%E7%9B%91%E6%8E%A7/Zabbix/docker%E5%AE%89%E8%A3%85zabbix/image-20220715172925565.png" alt="image-20220715172925565"></p><p><img src="/2023/04/17/%E7%9B%91%E6%8E%A7/Zabbix/docker%E5%AE%89%E8%A3%85zabbix/image-20220715172943385.png" alt="image-20220715172943385"></p>]]></content>
    
    
    <categories>
      
      <category>ç›‘æ§</category>
      
      <category>Zabbix</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zabbix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªåŠ¨å®‰è£…dockeråŠdocker-compose</title>
    <link href="/2023/04/16/%E8%84%9A%E6%9C%AC/%E5%AE%89%E8%A3%85docker%EF%BC%8Cdocker-compose%E8%84%9A%E6%9C%AC/"/>
    <url>/2023/04/16/%E8%84%9A%E6%9C%AC/%E5%AE%89%E8%A3%85docker%EF%BC%8Cdocker-compose%E8%84%9A%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="è‡ªåŠ¨å®‰è£…dockerã€docker-composeï¼Œéœ€è¦åœ¨æœ‰ç½‘ç¯å¢ƒä¸‹"><a href="#è‡ªåŠ¨å®‰è£…dockerã€docker-composeï¼Œéœ€è¦åœ¨æœ‰ç½‘ç¯å¢ƒä¸‹" class="headerlink" title="è‡ªåŠ¨å®‰è£…dockerã€docker-composeï¼Œéœ€è¦åœ¨æœ‰ç½‘ç¯å¢ƒä¸‹"></a>è‡ªåŠ¨å®‰è£…dockerã€docker-composeï¼Œéœ€è¦åœ¨æœ‰ç½‘ç¯å¢ƒä¸‹</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#! /bin/bash</span><br><span class="hljs-comment">#å¤‡æ³¨ï¼šè‡ªåŠ¨å®‰è£…dockeråŠdocker-compose</span><br><span class="hljs-comment">#Authorï¼šzhangzhenzhou</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ã€å¼€å§‹å®‰è£…ã€‘&quot;</span><br><span class="hljs-built_in">sleep</span> 1<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ã€åˆ¤æ–­æ˜¯å¦å®‰è£…äº†dockerã€‘&quot;</span><br><span class="hljs-keyword">if</span> ! <span class="hljs-built_in">type</span> docker &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br><span class="hljs-comment">#ä½¿ç”¨yumä¸‹è½½Dockerçš„é•œåƒæºï¼Œä¸‹é¢ä¸ºcatç›´æ¥å†™å…¥</span><br><span class="hljs-comment">#yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><br><span class="hljs-built_in">cat</span> &gt;/etc/yum.repos.d/docker.repo&lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[docker-ce-edge]</span><br><span class="hljs-string">name=Docker CE Edge - \$basearch</span><br><span class="hljs-string">baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/7/\$basearch/edge</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">gpgcheck=1</span><br><span class="hljs-string">gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;ã€docker æœªå®‰è£…ï¼ã€‘&#x27;</span>;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;ã€å¼€å§‹å®‰è£…Docker....ã€‘&#x27;</span>;<br>yum -y install yum-utils device-mapper-persistent-data lvm2<br>yum -y install bash-completion.noarch net-tools vim lrzsz wget tree screen lsof tcpdump nc telnet unzip <br><br>yum -y install docker-ce<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;ã€é…ç½®Dockerå¼€æœºå¯åŠ¨ï¼ã€‘&#x27;</span>;<br>systemctl <span class="hljs-built_in">enable</span> docker<br>systemctl start docker<br><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/docker/daemon.json &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;registry-mirrors&quot;:[&quot;https://vt62jyiw.mirror.aliyuncs.com&quot;]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><br>    systemctl restart docker<br><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;ã€docker å·²å®‰è£…ï¼ã€‘&#x27;</span>;<br>    docker -v<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;ã€æ˜¯å¦éœ€è¦å®‰è£…docker-composeï¼Ÿã€‘[y/n]ï¼š    &quot;</span> need_anzhuang<br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$need_anzhuang</span> == <span class="hljs-string">&#x27;y&#x27;</span> ]; <span class="hljs-keyword">then</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ã€åˆ¤æ–­æ˜¯å¦å®‰è£…äº†docker-composeã€‘&quot;</span><br><span class="hljs-keyword">if</span> ! <span class="hljs-built_in">type</span> docker-compose &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;ã€docker-compose æœªå®‰è£…ï¼ã€‘&#x27;</span>;<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;ã€å¼€å§‹å®‰è£…docker-compose....ã€‘&#x27;</span>;<br>    wget http://oss.moguit.cn/script//docker-compose-Linux-x86_64<br>    <span class="hljs-built_in">mv</span> docker-compose-Linux-x86_64  docker-compose<br>    <span class="hljs-built_in">chmod</span> +x docker-compose<br>    <span class="hljs-built_in">mv</span> docker-compose /usr/local/bin/<br>    docker-compose -v<br><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;ã€docker-compose å·²å®‰è£…ï¼ã€‘&#x27;</span>;<br>    docker-compose -v<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;ã€ç”¨æˆ·å–æ¶ˆå®‰è£…ï¼ã€‘&#x27;</span><br><span class="hljs-keyword">fi</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>è„šæœ¬</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>docker-compose</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>squidå‡çº§-å®‰è£…</title>
    <link href="/2023/04/15/%E4%B8%AD%E9%97%B4%E4%BB%B6/squid/squid%E5%8D%87%E7%BA%A7-%E5%AE%89%E8%A3%85/"/>
    <url>/2023/04/15/%E4%B8%AD%E9%97%B4%E4%BB%B6/squid/squid%E5%8D%87%E7%BA%A7-%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="squidå‡çº§-å®‰è£…"><a href="#squidå‡çº§-å®‰è£…" class="headerlink" title="squidå‡çº§-å®‰è£…"></a>squidå‡çº§-å®‰è£…</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å®‰è£…å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/weixin_47151643/article/details/109103742<br></code></pre></td></tr></table></figure><p>squidæ¦‚è¿°<br>Squidï¼ˆSquid cacheï¼Œç®€ç§°Squidï¼‰æ˜¯Linuxç³»ç»Ÿä¸­æœ€å¸¸ç”¨çš„ä¸€æ¬¾å¼€æºä»£ç†æœåŠ¡è½¯ä»¶ï¼Œå¯ä»¥å¾ˆå¥½åœ°å®ç°HTTPå’ŒFTPï¼Œ<br>ä»¥åŠDNSæŸ¥è¯¢ã€SSLç­‰åº”ç”¨çš„ç¼“å­˜ä»£ç†ï¼ŒåŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œæœ¬ç¯‡åšå®¢è¯¦ç»†ä»‹ç»äº†ä¼ ç»Ÿä»£ç†ã€é€æ˜ä»£ç†ï¼Œsquidæ—¥å¿—åˆ†æçš„é…ç½®ã€‚squidçš„å®˜æ–¹ç½‘ç«™ä¸º<a href="http://www.squid-cache.org/">http://www.squid-cache.org</a></p><h2 id="1-å‡†å¤‡å·¥ä½œ"><a href="#1-å‡†å¤‡å·¥ä½œ" class="headerlink" title="1.å‡†å¤‡å·¥ä½œ"></a>1.å‡†å¤‡å·¥ä½œ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¸‹è½½squid5.2ç‰ˆæœ¬</span><br>wget http://www.squid-cache.org/Versions/v5/squid-5.2.tar.gz<br><br><span class="hljs-comment">#å¸è½½åŸæœ‰ç‰ˆæœ¬</span><br>yum -y remove squid<br></code></pre></td></tr></table></figure><h2 id="2-å®‰è£…squidæœåŠ¡"><a href="#2-å®‰è£…squidæœåŠ¡" class="headerlink" title="2.å®‰è£…squidæœåŠ¡"></a>2.å®‰è£…squidæœåŠ¡</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è§£å‹ä¸‹è½½æ–‡ä»¶</span><br>tar -xnf squid-5.2.tar.gz<br><br><span class="hljs-comment">#å®‰è£…ç¼–è¯‘å·¥å…·</span><br>yum -y install gcc gcc-c++<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#configureé…ç½®</span><br><span class="hljs-built_in">cd</span> squid-5.2/<br><br>./configure --prefix=/usr/local/squid \<br>--sysconfdir=/etc/squid \<br>--enable-arp-acl \<br>--enable-linux-netfilter \<br>--enable-linux-tproxy \<br>--enable-async-io=100 \<br>--enable-err-language=<span class="hljs-string">&quot;Simplify_Chinses&quot;</span> \<br>--enable-poll \<br>--enable-gnuregex \<br>--enable-underscore<br><br><span class="hljs-comment">#è§£é‡Šï¼š</span><br><span class="hljs-comment">#--enable-linux-netfilter \ //å†…æ ¸è¿‡æ»¤</span><br><span class="hljs-comment">#--enable-linux-tproxy \ //é€æ˜ä»£ç†åŠŸèƒ½æ¨¡å—</span><br><span class="hljs-comment">#--enable-async-io=100 \ //ioå¯¹äºioçš„ä¼˜åŒ– å¼‚æ­¥I/O æå‡å­˜å‚¨æ€§èƒ½</span><br><span class="hljs-comment">#--enable-err-language=&quot;Simplify_Chinses&quot; \ //err-language æŠ¥é”™ä¿¡æ¯è®¾ç½®ä¸ºä¸­æ–‡</span><br><span class="hljs-comment">#--enable-poll \ //æå‡åŠŸèƒ½ ä½¿ç”¨pollï¼ˆï¼‰æ¨¡å¼</span><br><span class="hljs-comment">#--enable-gnuregex \ //æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼</span><br><span class="hljs-comment">#--enable-underscore //å…è®¸URLæ”¯æŒä¸‹åˆ’çº¿</span><br><br><span class="hljs-comment">#ç¼–è¯‘åŠå®‰è£…</span><br>make &amp;&amp; make install<br><br><span class="hljs-comment">#è·¯å¾„ä¼˜åŒ–ï¼Œä¾¿äºç³»ç»Ÿç®¡ç†</span><br><span class="hljs-built_in">ln</span> -s /usr/local/squid/sbin/* /usr/sbin<br>æˆ–è€…:<span class="hljs-built_in">cp</span> /usr/local/squid/sbin/squid /usr/sbin<br><br><span class="hljs-comment">#åˆ›å»ºsquidç¨‹åºæ€§ç”¨æˆ·</span><br>useradd -M -s /sbin/nologin squid<br><span class="hljs-comment">#èµ‹äºˆç›®å½•æƒé™</span><br><span class="hljs-built_in">chown</span> -R squid.squid /usr/local/squid/var/<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶</span><br>vim /etc/squid.conf<br><span class="hljs-comment">#56è¡Œ</span><br>http_access allow all <span class="hljs-comment">#å¼€å¯å…è®¸æ‰€æœ‰è®¿é—®</span><br><span class="hljs-comment">#http_access deny all  æ³¨é‡Šæ‹’ç»è®¿é—®</span><br>http_port 3128<br><span class="hljs-comment">#ä¸‹é¢æ·»åŠ </span><br>cache_effective_user squid <span class="hljs-comment">#ç¼“å­˜ç›¸å¯¹çš„ç”¨æˆ·</span><br>cache_effective_group squid <span class="hljs-comment">#ç¼“å­˜ç›¸å¯¹çš„ç»„</span><br><br><br><span class="hljs-comment">#éªŒè¯è¯­æ³•é…ç½®æ–‡ä»¶è¯­æ³•</span><br>squid -k parse<br><span class="hljs-comment">#åˆå§‹åŒ–ç¼“å­˜ç›®å½•</span><br>squid -z<br></code></pre></td></tr></table></figure><h2 id="3-å¯åŠ¨squidæœåŠ¡"><a href="#3-å¯åŠ¨squidæœåŠ¡" class="headerlink" title="3.å¯åŠ¨squidæœåŠ¡"></a>3.å¯åŠ¨squidæœåŠ¡</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">squid<br><br><span class="hljs-comment">#æŸ¥çœ‹ç‰ˆæœ¬</span><br>squid -v<br><br><span class="hljs-comment">#æŸ¥çœ‹ç«¯å£</span><br>netstat -lntup | grep 3128<br></code></pre></td></tr></table></figure><h2 id="4-åˆ›å»ºsystemctlå¯åŠ¨è„šæœ¬"><a href="#4-åˆ›å»ºsystemctlå¯åŠ¨è„šæœ¬" class="headerlink" title="4. #åˆ›å»ºsystemctlå¯åŠ¨è„šæœ¬"></a>4. #åˆ›å»ºsystemctlå¯åŠ¨è„šæœ¬</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/init.d/squid<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#chkconfig: 2345 90 25</span><br>PID=<span class="hljs-string">&quot;/usr/local/squid/var/run/squid.pid&quot;</span><br>CONF=<span class="hljs-string">&quot;/etc/squid/squid.conf&quot;</span><br>CMD=<span class="hljs-string">&quot;/usr/local/squid/sbin/squid&quot;</span><br><br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-keyword">in</span><br>  start)<br>    netstat -natp | grep squid &amp;&gt; /dev/null<br>    <span class="hljs-keyword">if</span> [ $? -eq 0 ]<br>    <span class="hljs-keyword">then</span><br>      <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;squid is running&quot;</span><br>      <span class="hljs-keyword">else</span><br>      <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ­£åœ¨å¯åŠ¨ squid...&quot;</span><br>      <span class="hljs-variable">$CMD</span><br>    <span class="hljs-keyword">fi</span><br>  ;;<br>  stop)<br>    <span class="hljs-variable">$CMD</span> -k <span class="hljs-built_in">kill</span> &amp;&gt; /dev/null<br>    <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$PID</span> &amp;&gt; /dev/null<br>  ;;<br>  status)<br>    [ -f <span class="hljs-variable">$PID</span> ] &amp;&gt; /dev/null<br>      <span class="hljs-keyword">if</span> [ $? -eq 0 ]<br>      <span class="hljs-keyword">then</span><br>        netstat -natp | grep squid<br>      <span class="hljs-keyword">else</span><br>```  <br>```sh     <br><span class="hljs-comment">#å¢åŠ æ‰§è¡Œæƒé™</span><br><span class="hljs-built_in">chmod</span> +x squid <br><br><span class="hljs-comment">#æ·»åŠ åˆ°squidæœåŠ¡</span><br>chkconfig --add squid <br><br><span class="hljs-comment">#è®¾ç½®å¼€æœºå¯åŠ¨</span><br>chkconfig --level 35 squid on<br><br><span class="hljs-comment">#æŸ¥çœ‹ç«¯å£</span><br>netstat -ntap | grep 3128<br>tcp6       0      0 :::3128                 :::*                    LISTEN      118846/(squid-1)    <br><br><span class="hljs-comment">#é‡å¯squidæœåŠ¡</span><br>service squid stop <br>setenforce 0<br>service squid start <br></code></pre></td></tr></table></figure><h2 id="5-è®¾ç½®ç¼“å­˜å‚æ•°"><a href="#5-è®¾ç½®ç¼“å­˜å‚æ•°" class="headerlink" title="5. è®¾ç½®ç¼“å­˜å‚æ•°"></a>5. è®¾ç½®ç¼“å­˜å‚æ•°</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/squid.conf<br><br>http_port 3128<br><span class="hljs-comment">#ä¸‹é¢æ·»åŠ       </span><br>cache_mem 64 MB                      <span class="hljs-comment">#ç¼“å­˜64Mçš„å†…å®¹</span><br>reply_body_max_size 10 MB            <span class="hljs-comment">#ç¦æ­¢ä¸‹è½½çš„è¶…è¿‡10MBçš„æ–‡ä»¶</span><br>maximum_object_size 4096 KB          <span class="hljs-comment">#è¶…è¿‡4MB:çš„æ–‡ä»¶ä¸è¿›è¡Œç¼“å­˜</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>squid</category>
      
    </categories>
    
    
    <tags>
      
      <tag>squid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jdkä¸€é”®å®‰è£…è„šæœ¬ï¼ˆæœ‰ç½‘ä¸æ— ç½‘å‡å¯ï¼‰</title>
    <link href="/2023/04/13/%E8%84%9A%E6%9C%AC/jdk%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC/"/>
    <url>/2023/04/13/%E8%84%9A%E6%9C%AC/jdk%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="jdkä¸€é”®å®‰è£…è„šæœ¬"><a href="#jdkä¸€é”®å®‰è£…è„šæœ¬" class="headerlink" title="jdkä¸€é”®å®‰è£…è„šæœ¬"></a>jdkä¸€é”®å®‰è£…è„šæœ¬</h1><p><strong>å¼€ç®±å³ç”¨</strong><br>å‰è¨€ï¼šä½¿ç”¨<code>bash/sh</code>æ‰§è¡Œè¯¥è„šæœ¬åéœ€è¦æ‰§è¡Œ<code>source /etc/profile</code>ï¼Œå› ä¸ºè„šæœ¬å†…æ‰§è¡Œåæ— æ³•æ”¹å˜ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œå¯ä½¿ç”¨ <code>source</code> è¯¥è„šæœ¬ï¼</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#author:zhangzhenzhou</span><br><span class="hljs-comment">#email:1962821461@qq.com</span><br><span class="hljs-comment">#å®ç°ï¼š</span><br><span class="hljs-comment">#1ã€åœ¨æœ‰ç½‘ç»œæƒ…å†µä¸‹ï¼Œåªéœ€è¦æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ä¸‹è½½åœ°å€ï¼ˆ$jdkdizhi)</span><br><span class="hljs-comment">#2ã€åœ¨æ²¡ç½‘æƒ…å†µä¸‹ï¼Œæ³¨é‡Šè™šçº¿å†…å†…å®¹ï¼Œå°†javaåŒ…ä¸Šä¼ æœåŠ¡å™¨ï¼Œå¹¶ä¿®æ”¹å‹ç¼©åŒ…æ–‡ä»¶è·¯å¾„($jdkTargz) </span><br><br><br><span class="hljs-comment">#--------------æ— ç½‘æƒ…å†µè¯·æ³¨é‡Šè¯¥å†…å®¹------------------------</span><br><span class="hljs-comment">#ä¸‹è½½åœ°å€ï¼š</span><br>jdkdizhi=<span class="hljs-string">&quot;http://download.oracle.com/otn-pub/java/jdk/8u131-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk-8u131-linux-x64.tar.gz&quot;</span><br>wget --no-check-certificate --no-cookies --header <span class="hljs-string">&quot;Cookie: oraclelicense=accept-securebackup-cookie&quot;</span> <span class="hljs-variable">$jdkdizhi</span> -O /opt/jdk.tar.gz<br><span class="hljs-comment">#--------------------------------------------------------</span><br><br>jdkTargz=<span class="hljs-string">&quot;/opt/jdk.tar.gz&quot;</span><br><span class="hljs-comment">#ä¸¾ä¾‹ï¼šjdkTargz=&quot;/opt/jdk-8u131-linux-x64.tar.gz&quot;</span><br><br><span class="hljs-comment"># æ£€æŸ¥åŸå…ˆæ˜¯å¦å·²é…ç½®javaç¯å¢ƒå˜é‡</span><br><span class="hljs-function"><span class="hljs-title">checkExist</span></span>()&#123;<br>jdk1=$(grep -n <span class="hljs-string">&quot;JAVA_HOME=.*&quot;</span> /etc/profile | <span class="hljs-built_in">cut</span> -f1 -d<span class="hljs-string">&#x27;:&#x27;</span>)<br>  <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">&quot;<span class="hljs-variable">$jdk1</span>&quot;</span> ];<span class="hljs-keyword">then</span><br>      <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;JAVA_HOMEå·²é…ç½®ï¼Œåˆ é™¤å†…å®¹&quot;</span><br>      sed -i <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;jdk1&#125;</span>d&quot;</span> /etc/profile<br>  <span class="hljs-keyword">fi</span><br>jdk2=$(grep -n <span class="hljs-string">&quot;CLASSPATH=.*\$JAVA_HOME.*&quot;</span> /etc/profile | <span class="hljs-built_in">cut</span> -f1 -d<span class="hljs-string">&#x27;:&#x27;</span>)<br>  <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">&quot;<span class="hljs-variable">$jdk2</span>&quot;</span> ];<span class="hljs-keyword">then</span><br>      <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;CLASSPATHè·¯å¾„å·²é…ç½®ï¼Œåˆ é™¤å†…å®¹&quot;</span><br>      sed -i <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;jdk2&#125;</span>d&quot;</span> /etc/profile<br>  <span class="hljs-keyword">fi</span><br>jdk3=$(grep -n <span class="hljs-string">&quot;PATH=.*\$JAVA_HOME.*&quot;</span> /etc/profile | <span class="hljs-built_in">cut</span> -f1 -d<span class="hljs-string">&#x27;:&#x27;</span>)<br>  <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">&quot;<span class="hljs-variable">$jdk3</span>&quot;</span> ];<span class="hljs-keyword">then</span><br>      <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;PATH-JAVAè·¯å¾„å·²é…ç½®ï¼Œåˆ é™¤å†…å®¹&quot;</span><br>      sed -i <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;jdk3&#125;</span>d&quot;</span> /etc/profile<br>  <span class="hljs-keyword">fi</span><br>jdk4=$(grep -n <span class="hljs-string">&quot;export JAVA_HOME PATH CLASSPATH&quot;</span> /etc/profile | <span class="hljs-built_in">cut</span> -f1 -d<span class="hljs-string">&#x27;:&#x27;</span>)<br>  <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">&quot;<span class="hljs-variable">$jdk3</span>&quot;</span> ];<span class="hljs-keyword">then</span><br>      <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;PATH-JAVAè·¯å¾„å·²é…ç½®ï¼Œåˆ é™¤å†…å®¹&quot;</span><br>      sed -i <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;jdk3&#125;</span>d&quot;</span> /etc/profile<br>  <span class="hljs-keyword">fi</span><br>&#125;<br><br><span class="hljs-built_in">mv</span> <span class="hljs-variable">$jdkTargz</span> /opt/jdk.tar.gz<br><span class="hljs-comment"># æŸ¥è¯¢æ˜¯å¦æœ‰jdk.tar.gz</span><br><span class="hljs-keyword">if</span> [ -e /opt/jdk.tar.gz ];<span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;â€• â€• å­˜åœ¨jdkå‹ç¼©åŒ… â€• â€•&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ­£åœ¨è§£å‹jdkå‹ç¼©åŒ…...&quot;</span><br><span class="hljs-built_in">mkdir</span> -p /opt/jdk<br><br><span class="hljs-comment">#tar -zxvf $jdkTargz -C /opt/jdk --strip-components 1</span><br>tar -xnf /opt/jdk.tar.gz -C /opt/jdk --strip-components 1<br><br><span class="hljs-comment">#è§£å‹ååˆ é™¤å‹ç¼©åŒ…</span><br><span class="hljs-built_in">rm</span> -rf /opt/jdk.tar.gz<br><br><span class="hljs-comment"># æ£€æŸ¥é…ç½®ä¿¡æ¯</span><br>checkExist <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;---------------------------------&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ­£åœ¨é…ç½®jdkç¯å¢ƒ...&quot;</span><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/profile &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">JAVA_HOME=/opt/jdk</span><br><span class="hljs-string">PATH=\$PATH:\$JAVA_HOME/bin</span><br><span class="hljs-string">CLASSPATH=.:\$JAVA_HOME/lib/dt.jar:\$JAVA_HOME/lib/tools.jar</span><br><span class="hljs-string">export JAVA_HOME PATH CLASSPATH</span><br><span class="hljs-string">EOF</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;---------------------------------&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;JAVAç¯å¢ƒé…ç½®å·²å®Œæˆ...&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;---------------------------------&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ­£åœ¨é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶...&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;---------------------------------&quot;</span><br><span class="hljs-built_in">source</span> /etc/profile<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;é…ç½®ç‰ˆæœ¬ä¿¡æ¯å¦‚ä¸‹ï¼š&quot;</span><br>java -version<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;è„šæœ¬å®‰è£…å®Œæˆåè¯·æ‰§è¡Œsource /etc/profileï¼Œä½¿ä¹‹ç”Ÿæ•ˆï¼ï¼ˆå¦‚æœä½¿ç”¨&#x27;source+è„šæœ¬&#x27;å‘½ä»¤å¯ä¸æ‰§è¡Œï¼‰&quot;</span><br><br><span class="hljs-keyword">else</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æœªæ£€æµ‹åˆ°å®‰è£…åŒ…ï¼Œè¯·å°†å®‰è£…åŒ…æ”¾åˆ°/optç›®å½•ä¸‹&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>è„šæœ¬</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®‰è£…Python3.Xç‰ˆæœ¬</title>
    <link href="/2023/04/13/%E7%8E%AF%E5%A2%83/Python/%E5%AE%89%E8%A3%85Python3.X%E7%89%88%E6%9C%AC/"/>
    <url>/2023/04/13/%E7%8E%AF%E5%A2%83/Python/%E5%AE%89%E8%A3%85Python3.X%E7%89%88%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å®‰è£…Python3-Xç‰ˆæœ¬"><a href="#å®‰è£…Python3-Xç‰ˆæœ¬" class="headerlink" title="å®‰è£…Python3.Xç‰ˆæœ¬"></a>å®‰è£…Python3.Xç‰ˆæœ¬</h1><p><code>windowså®‰è£…å‚è€ƒé“¾æ¥ï¼šhttps://edu.csdn.net/skill/python/python-3-2?category=1&amp;typeId=17337</code><br><code>æ–‡æ¡£æœæ’°å‚è€ƒæ–‡æ¡£ï¼šhttps://zhuanlan.zhihu.com/p/590965831</code></p><p><strong>å‰è¨€ï¼šCentos7é»˜è®¤å®‰è£…äº†python2.7.5ç‰ˆæœ¬ï¼Œå› æ­¤æƒ³å®‰è£…python 3.Xç‰ˆæœ¬å°±éœ€è¦ç‰¹æ®Šå¤„ç†<br>Centos7é»˜è®¤å®‰è£…äº†python2.7.5 å› ä¸ºä¸€äº›å‘½ä»¤è¦ç”¨å®ƒæ¯”å¦‚yum å®ƒä½¿ç”¨çš„æ˜¯python2.7.5ã€‚</strong></p><h2 id="ä¸€ã€å‡†å¤‡é˜¶æ®µ"><a href="#ä¸€ã€å‡†å¤‡é˜¶æ®µ" class="headerlink" title="ä¸€ã€å‡†å¤‡é˜¶æ®µ"></a>ä¸€ã€å‡†å¤‡é˜¶æ®µ</h2><h3 id="ä¸‹è½½æ–°ç‰ˆæœ¬çš„Python"><a href="#ä¸‹è½½æ–°ç‰ˆæœ¬çš„Python" class="headerlink" title="ä¸‹è½½æ–°ç‰ˆæœ¬çš„Python"></a>ä¸‹è½½æ–°ç‰ˆæœ¬çš„Python</h3><p><strong>ä¸‹è½½Pythonæ–°ç‰ˆæœ¬<a href="https://www.python.org/downloads/source/">https://www.python.org/downloads/source/</a></strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">ä¸‹è½½.tar.xzåŒ…å°±å¯ä»¥äº†ã€‚å…¶å®ä¸‹é¢çš„2ä¸ªåŒ…å…¶ä¸€éƒ½å¯ä»¥ä½¿ç”¨<br>Python-3.11.1.tgz ï¼ˆè¿™ä¸ªä¸æ˜¯ç¼–è¯‘è¿‡çš„ä¸œè¥¿ï¼Œä¸èƒ½è§£å‹ä¹‹åç›´æ¥ä½¿ç”¨ï¼‰<br>Python-3.11.1.tar.xz (è¿™ä¸ªæ˜¯pthonçš„æºç )<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /app/python &amp;&amp; <span class="hljs-built_in">cd</span> /app/python<br><span class="hljs-comment">#ä¸‹è½½PythonåŒ…</span><br>wget https://www.python.org/ftp/python/3.11.1/Python-3.11.1.tgz<br><br><span class="hljs-comment">#è§£å‹PythonåŒ…</span><br>tar -xnf Python-3.11.1.tgz<br></code></pre></td></tr></table></figure><h2 id="äºŒã€å®‰è£…é˜¶æ®µ"><a href="#äºŒã€å®‰è£…é˜¶æ®µ" class="headerlink" title="äºŒã€å®‰è£…é˜¶æ®µ"></a>äºŒã€å®‰è£…é˜¶æ®µ</h2><h3 id="1-å®‰è£…ç¼–è¯‘ç›¸å…³å·¥å…·"><a href="#1-å®‰è£…ç¼–è¯‘ç›¸å…³å·¥å…·" class="headerlink" title="1.å®‰è£…ç¼–è¯‘ç›¸å…³å·¥å…·"></a>1.å®‰è£…ç¼–è¯‘ç›¸å…³å·¥å…·</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gcc make</span><br><span class="hljs-comment">#yum install -y zlib zlib-dev openssl-devel sqlite-devel bzip2-devel libffi libffi-devel gcc gcc-c++</span><br><span class="hljs-comment">#yum -y install libffi-devel </span><br><br><span class="hljs-comment">#å®‰è£…æºç ç¼–è¯‘éœ€è¦çš„ç¼–è¯‘ç¯å¢ƒ</span><br>yum -y install gcc zlib zlib-devel libffi libffi-devel<br><span class="hljs-comment">##å¯ä»¥è§£å†³åæœŸå‡ºç°çš„æ–¹å‘é”®ã€åˆ é™¤é”®ä¹±ç é—®é¢˜ï¼Œè¿™é‡Œæå‰é¿å…ã€‚</span><br>yum -y install readline-devel<br><span class="hljs-comment">#å®‰è£…openssl11ï¼ŒåæœŸçš„pip3å®‰è£…ç½‘ç»œç›¸å…³æ¨¡å—éœ€è¦ç”¨åˆ°sslæ¨¡å—ã€‚</span><br>yum -y install openssl-devel openssl11 openssl11-devel<br><span class="hljs-comment">#è®¾ç½®ç¼–è¯‘FLAGï¼Œä»¥ä¾¿ä½¿ç”¨æœ€æ–°çš„opensslåº“</span><br><span class="hljs-built_in">export</span> CFLAGS=$(pkg-config --cflags openssl11)<br><span class="hljs-built_in">export</span> LDFLAGS=$(pkg-config --libs openssl11)<br></code></pre></td></tr></table></figure><h3 id="2-ç¼–è¯‘å®‰è£…"><a href="#2-ç¼–è¯‘å®‰è£…" class="headerlink" title="2.ç¼–è¯‘å®‰è£…"></a>2.ç¼–è¯‘å®‰è£…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ›å»ºç¼–è¯‘å®‰è£…ç›®å½•</span><br><span class="hljs-built_in">mkdir</span> -p /usr/local/python3 <br><br><span class="hljs-comment">#è¿›å…¥è§£å‹åPythonç›®å½•ï¼Œç¼–è¯‘</span><br><span class="hljs-built_in">cd</span> /app/python/Python-3.11.1<br><span class="hljs-comment">#æŒ‡å®šå®‰è£…ç›®å½•ï¼Œå¹¶ä½¿ç”¨sslæ¨¡å—ï¼ŒæŒ‡å®šç›®å½•å¥½å¤„æ˜¯åæœŸåˆ é™¤æ­¤æ–‡ä»¶å¤¹å°±å¯ä»¥å®Œå…¨åˆ é™¤è½¯ä»¶äº†ã€‚</span><br>./configure --prefix=/usr/local/python3 --with-ssl<br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure><h3 id="3-åˆ›å»ºè½¯è¿æ¥"><a href="#3-åˆ›å»ºè½¯è¿æ¥" class="headerlink" title="3.åˆ›å»ºè½¯è¿æ¥"></a>3.åˆ›å»ºè½¯è¿æ¥</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ln</span> -s /usr/local/python3/bin/python3 /usr/local/bin/python3<br><span class="hljs-built_in">ln</span> -s /usr/local/python3/bin/pip3 /usr/local/bin/pip3<br></code></pre></td></tr></table></figure><h3 id="4-éªŒè¯æ˜¯å¦æˆåŠŸ"><a href="#4-éªŒè¯æ˜¯å¦æˆåŠŸ" class="headerlink" title="4.éªŒè¯æ˜¯å¦æˆåŠŸ"></a>4.éªŒè¯æ˜¯å¦æˆåŠŸ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">python3 -V<br>pip3 -V<br></code></pre></td></tr></table></figure><h3 id="5-å®‰è£…å¸¸ç”¨åˆ°çš„ç½‘å·¥é…ç½®æ¨¡å—paramikoã€netmiko"><a href="#5-å®‰è£…å¸¸ç”¨åˆ°çš„ç½‘å·¥é…ç½®æ¨¡å—paramikoã€netmiko" class="headerlink" title="5.å®‰è£…å¸¸ç”¨åˆ°çš„ç½‘å·¥é…ç½®æ¨¡å—paramikoã€netmiko"></a>5.å®‰è£…å¸¸ç”¨åˆ°çš„ç½‘å·¥é…ç½®æ¨¡å—paramikoã€netmiko</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">pip3 install netmiko -i https://pypi.tuna.tsinghua.edu.cn/simple/ --trusted-host pypi.tuna.tsinghua.edu.cn<br>pip3 install paramiko -i https://pypi.tuna.tsinghua.edu.cn/simple/ --trusted-host pypi.tuna.tsinghua.edu.cn<br><span class="hljs-comment">#ä½¿ç”¨çš„æ¸…åå¤§å­¦çš„å®‰è£…æºï¼Œä¸ªåˆ«å…¶ä»–çš„å®‰è£…æºä¼šæ²¡æœ‰ç›¸åº”çš„å®‰è£…åŒ…</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç¯å¢ƒ</category>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é…ç½®Javaç¯å¢ƒ</title>
    <link href="/2023/04/13/%E7%8E%AF%E5%A2%83/jdk/%E9%85%8D%E7%BD%AEJava%E7%8E%AF%E5%A2%83/"/>
    <url>/2023/04/13/%E7%8E%AF%E5%A2%83/jdk/%E9%85%8D%E7%BD%AEJava%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="é…ç½®Javaç¯å¢ƒ"><a href="#é…ç½®Javaç¯å¢ƒ" class="headerlink" title="é…ç½®Javaç¯å¢ƒ"></a>é…ç½®Javaç¯å¢ƒ</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">å®˜ç½‘ä¸‹è½½åœ°å€1:https://www.oracle.com/java/technologies/javase-downloads.htmlï¼›<br>å®˜ç½‘ä¸‹è½½åœ°å€2:https://www.oracle.com/java/technologies/downloads/#java8<br></code></pre></td></tr></table></figure><p>å½“è¦åœ¨å®˜ç½‘ä¸‹è½½éæœ€æ–°ç‰ˆæœ¬çš„jdkæ—¶ï¼Œä¼šæç¤ºè¦ä½ ç™»å½•ï¼Œå¯ä»¥å®ç°å¦‚ä¸‹æ–¹å¼ç›´æ¥ä¸‹è½½ï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs txt">åœ¨ç›¸åº”çš„ä¸‹è½½é“¾æ¥è¿›å…¥ä¸‹è½½ç•Œé¢ï¼Œç‚¹å‡»ä¸‹è½½ï¼Œä¼šå¼¹å‡ºéœ€è¦ç™»å½•çš„å¼¹çª—ï¼Œåœ¨å¼¹å‡ºçš„æ¡†å†…,åŒæ„å®¡æŸ¥ï¼Œç„¶åå°†é¼ æ ‡æ”¾åˆ°ä¸‹è½½jdk-8u333-linux-x64.tar.gzï¼Œç„¶åç‚¹å³é”®å¤åˆ¶é“¾æ¥åœ°å€ï¼Œå¾—åˆ°ä»¥ä¸‹è¿æ¥<br>https://www.oracle.com/webapps/redirect/signon?nexturl=https://download.oracle.com/otn/java/jdk/8u333-b02/2dee051a5d0647d5be72a7c0abff270e/jdk-8u333-linux-x64.tar.gz<br><br>å»æ‰å‰é¢çš„è·³è½¬url,åŒæ—¶ä¿®æ”¹otnä¸ºotn-pub<br>https://download.oracle.com/otn-pub/java/jdk/8u333-b02/2dee051a5d0647d5be72a7c0abff270e/jdk-8u333-linux-x64.tar.gz<br>å°±å¯ä»¥ä½¿ç”¨è¯¥åœ°å€ç›´æ¥æµè§ˆå™¨è®¿é—®ä¸‹è½½äº†<br></code></pre></td></tr></table></figure><h2 id="1-ä¸‹è½½jdkæ–‡ä»¶"><a href="#1-ä¸‹è½½jdkæ–‡ä»¶" class="headerlink" title="1.ä¸‹è½½jdkæ–‡ä»¶"></a>1.ä¸‹è½½jdkæ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget --no-check-certificate --no-cookies --header <span class="hljs-string">&quot;Cookie: oraclelicense=accept-securebackup-cookie&quot;</span> http://download.oracle.com/otn-pub/java/jdk/8u131-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk-8u131-linux-x64.tar.gz<br></code></pre></td></tr></table></figure><h2 id="2-è§£å‹åˆ°-x2F-usr-x2F-localç›®å½•ä¸‹"><a href="#2-è§£å‹åˆ°-x2F-usr-x2F-localç›®å½•ä¸‹" class="headerlink" title="2.è§£å‹åˆ°&#x2F;usr&#x2F;localç›®å½•ä¸‹"></a>2.è§£å‹åˆ°&#x2F;usr&#x2F;localç›®å½•ä¸‹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar zxvf jdk-7u51-linux-x64.tar.gz -C /usr/local/<br></code></pre></td></tr></table></figure><h2 id="3-æŸ¥çœ‹è§£å‹åçš„æ–‡ä»¶å"><a href="#3-æŸ¥çœ‹è§£å‹åçš„æ–‡ä»¶å" class="headerlink" title="3.æŸ¥çœ‹è§£å‹åçš„æ–‡ä»¶å"></a>3.æŸ¥çœ‹è§£å‹åçš„æ–‡ä»¶å</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ls</span> /usr/local/<br></code></pre></td></tr></table></figure><h2 id="4-é…ç½®ç¯å¢ƒå˜é‡çš„é…ç½®æ–‡ä»¶"><a href="#4-é…ç½®ç¯å¢ƒå˜é‡çš„é…ç½®æ–‡ä»¶" class="headerlink" title="4.é…ç½®ç¯å¢ƒå˜é‡çš„é…ç½®æ–‡ä»¶"></a>4.é…ç½®ç¯å¢ƒå˜é‡çš„é…ç½®æ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/profile &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">JAVA_HOME=/usr/local/jdk1.8.0 #è·å–åˆ°çš„æ–‡ä»¶åè·¯å¾„</span><br><span class="hljs-string">PATH=\$PATH:\$JAVA_HOME/bin</span><br><span class="hljs-string">CLASSPATH=.:\$JAVA_HOME/lib/dt.jar:\$JAVA_HOME/lib/tools.jar</span><br><span class="hljs-string">export JAVA_HOME PATH CLASSPATH</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h2 id="5-ä½¿è®¾ç½®ç”Ÿæ•ˆ"><a href="#5-ä½¿è®¾ç½®ç”Ÿæ•ˆ" class="headerlink" title="5.ä½¿è®¾ç½®ç”Ÿæ•ˆ"></a>5.ä½¿è®¾ç½®ç”Ÿæ•ˆ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><h2 id="6-éªŒè¯"><a href="#6-éªŒè¯" class="headerlink" title="6.éªŒè¯"></a>6.éªŒè¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">java  -version<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç¯å¢ƒ</category>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­å»ºNFSæ–‡ä»¶å…±äº«å­˜å‚¨æœåŠ¡å®‰è£…goç¯å¢ƒ</title>
    <link href="/2023/04/13/%E7%8E%AF%E5%A2%83/golang/%E5%AE%89%E8%A3%85go%E7%8E%AF%E5%A2%83/"/>
    <url>/2023/04/13/%E7%8E%AF%E5%A2%83/golang/%E5%AE%89%E8%A3%85go%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å®‰è£…goç¯å¢ƒ"><a href="#å®‰è£…goç¯å¢ƒ" class="headerlink" title="å®‰è£…goç¯å¢ƒ"></a>å®‰è£…goç¯å¢ƒ</h1><p>** goå®˜æ–¹ä¸‹è½½åœ°å€ï¼š<a href="https://golang.google.cn/dl/">https://golang.google.cn/dl/</a> **</p><h2 id="1ã€ä¸‹è½½golangåŒ…"><a href="#1ã€ä¸‹è½½golangåŒ…" class="headerlink" title="1ã€ä¸‹è½½golangåŒ…:"></a>1ã€ä¸‹è½½golangåŒ…:</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://golang.google.cn/dl/go1.19.1.linux-amd64.tar.gz --no-check-certificate<br><br></code></pre></td></tr></table></figure><h2 id="2ã€è§£å‹åˆ°åˆ¶å®šè·¯å¾„ï¼š"><a href="#2ã€è§£å‹åˆ°åˆ¶å®šè·¯å¾„ï¼š" class="headerlink" title="2ã€è§£å‹åˆ°åˆ¶å®šè·¯å¾„ï¼š"></a>2ã€è§£å‹åˆ°åˆ¶å®šè·¯å¾„ï¼š</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -C /usr/local -xzf go1.19.1.linux-amd64.tar.gz<br></code></pre></td></tr></table></figure><h2 id="3ã€è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#3ã€è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="3ã€è®¾ç½®ç¯å¢ƒå˜é‡"></a>3ã€è®¾ç½®ç¯å¢ƒå˜é‡</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å°† /usr/local/go/bin ç›®å½•æ·»åŠ è‡³ PATH ç¯å¢ƒå˜é‡ï¼š</span><br><br>vim ~/.bash_profile <br><span class="hljs-comment">#å°†ä»¥ä¸‹å‘½ä»¤æ·»åŠ è¯¥æ–‡ä»¶çš„æœ«å°¾</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/usr/local/go/bin<br><br><span class="hljs-comment">#æ‰§è¡Œç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> ~/.bash_profile<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç¯å¢ƒ</category>
      
      <category>golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¾ç½®Hadoopå•èŠ‚ç‚¹é›†ç¾¤ï¼ˆHadoopå•èŠ‚ç‚¹ç¯å¢ƒæ­å»ºï¼‰</title>
    <link href="/2023/04/13/%E4%B8%AD%E9%97%B4%E4%BB%B6/spark+hadoop/%E6%90%AD%E5%BB%BAHadoop%20%E5%8D%95%E8%8A%82%E7%82%B9/"/>
    <url>/2023/04/13/%E4%B8%AD%E9%97%B4%E4%BB%B6/spark+hadoop/%E6%90%AD%E5%BB%BAHadoop%20%E5%8D%95%E8%8A%82%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="CentOSè®¾ç½®Hadoopå•èŠ‚ç‚¹é›†ç¾¤ï¼ˆHadoopå•èŠ‚ç‚¹ç¯å¢ƒæ­å»ºï¼‰"><a href="#CentOSè®¾ç½®Hadoopå•èŠ‚ç‚¹é›†ç¾¤ï¼ˆHadoopå•èŠ‚ç‚¹ç¯å¢ƒæ­å»ºï¼‰" class="headerlink" title="CentOSè®¾ç½®Hadoopå•èŠ‚ç‚¹é›†ç¾¤ï¼ˆHadoopå•èŠ‚ç‚¹ç¯å¢ƒæ­å»ºï¼‰"></a>CentOSè®¾ç½®Hadoopå•èŠ‚ç‚¹é›†ç¾¤ï¼ˆHadoopå•èŠ‚ç‚¹ç¯å¢ƒæ­å»ºï¼‰</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">å®˜æ–¹å‚è€ƒæ–‡æ¡£ï¼šhttps://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/SingleCluster.html<br>å‚è€ƒåšä¸»æ–‡æ¡£ï¼šhttps://blog.csdn.net/lt5227/article/details/119417295<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šé¦–å…ˆè¦ç¡®å®šè‡ªå·±çš„æœºå™¨ä¸Šå·²å®‰è£… Java è¿è¡Œç¯å¢ƒ!!</strong></p><h2 id="å‡†å¤‡å·¥ä½œï¼šæ–°å»ºä¸€ä¸ªhadoopçš„è´¦å·-ä¸æ¨èä½¿ç”¨rootè´¦å·è¿›è¡Œé…ç½®"><a href="#å‡†å¤‡å·¥ä½œï¼šæ–°å»ºä¸€ä¸ªhadoopçš„è´¦å·-ä¸æ¨èä½¿ç”¨rootè´¦å·è¿›è¡Œé…ç½®" class="headerlink" title="å‡†å¤‡å·¥ä½œï¼šæ–°å»ºä¸€ä¸ªhadoopçš„è´¦å·!(ä¸æ¨èä½¿ç”¨rootè´¦å·è¿›è¡Œé…ç½®)"></a>å‡†å¤‡å·¥ä½œï¼šæ–°å»ºä¸€ä¸ªhadoopçš„è´¦å·!(ä¸æ¨èä½¿ç”¨rootè´¦å·è¿›è¡Œé…ç½®)</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æœåŠ¡å™¨åˆ›å»º hadoop è´¦å·</span><br>useradd hadoop<br><br><span class="hljs-comment">#ç»™ hadoop ç”¨æˆ·èµ‹äºˆsudo æƒé™ï¼š</span><br>vim /etc/sudoers<br><br><span class="hljs-comment">#åœ¨ä¸€ä¸‹è¡Œä¸‹æ·»åŠ hadoop ALL=(ALL) ALL</span><br><br>root    ALL=(ALL)       ALL<br>hadoop ALL=(ALL) ALL<br><br><span class="hljs-comment">#è®¾ç½® hadoop è´¦å·å¯†ç </span><br>passwd hadoop<br><br><span class="hljs-comment">#åˆ‡æ¢è´¦å·</span><br>su - hadoop<br></code></pre></td></tr></table></figure><h2 id="1ã€ä¸‹è½½hadoop"><a href="#1ã€ä¸‹è½½hadoop" class="headerlink" title="1ã€ä¸‹è½½hadoop"></a>1ã€ä¸‹è½½hadoop</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://mirror-hk.koddos.net/apache/hadoop/common/stable/">https://mirror-hk.koddos.net/apache/hadoop/common/stable/</a></p><p>é€‰æ‹© 3.3.4 ç¨³å®šç‰ˆ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /app/hadoop &amp;&amp; <span class="hljs-built_in">cd</span> /app/hadoop<br><br>wget https://mirror-hk.koddos.net/apache/hadoop/common/stable/hadoop-3.3.4.tar.gz<br></code></pre></td></tr></table></figure><h2 id="2ã€è§£å‹hadopp"><a href="#2ã€è§£å‹hadopp" class="headerlink" title="2ã€è§£å‹hadopp"></a>2ã€è§£å‹hadopp</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -zxvf hadoop-3.3.4.tar.gz<br><br><span class="hljs-built_in">cd</span> hadoop-3.3.4<br></code></pre></td></tr></table></figure><h2 id="3ã€ç¼–è¾‘hadoopç›®å½•ä¸‹çš„etc-x2F-hadoop-x2F-hadoop-env-shæ–‡ä»¶ï¼Œå®šä¹‰å¦‚ä¸‹å‚æ•°"><a href="#3ã€ç¼–è¾‘hadoopç›®å½•ä¸‹çš„etc-x2F-hadoop-x2F-hadoop-env-shæ–‡ä»¶ï¼Œå®šä¹‰å¦‚ä¸‹å‚æ•°" class="headerlink" title="3ã€ç¼–è¾‘hadoopç›®å½•ä¸‹çš„etc&#x2F;hadoop&#x2F;hadoop-env.shæ–‡ä»¶ï¼Œå®šä¹‰å¦‚ä¸‹å‚æ•°:"></a>3ã€ç¼–è¾‘hadoopç›®å½•ä¸‹çš„etc&#x2F;hadoop&#x2F;hadoop-env.shæ–‡ä»¶ï¼Œå®šä¹‰å¦‚ä¸‹å‚æ•°:</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim etc/hadoop/hadoop-env.sh<br><br><span class="hljs-comment"># æ‰¾åˆ°JAVA_HOMEï¼Œè®¾ç½®ä¸ºJavaå®‰è£…çš„æ ¹ç›®å½•</span><br><span class="hljs-built_in">export</span> JAVA_HOME=/usr/local/jdk1.8.0<br><br><span class="hljs-comment">#ä¸çŸ¥é“å®‰è£…è·¯å¾„çš„ä½¿ç”¨whereis javaå‘½ä»¤æŸ¥çœ‹</span><br></code></pre></td></tr></table></figure><h2 id="4ã€é…ç½®-HADOOP-HOME-ç¯å¢ƒå˜é‡"><a href="#4ã€é…ç½®-HADOOP-HOME-ç¯å¢ƒå˜é‡" class="headerlink" title="4ã€é…ç½® HADOOP_HOME ç¯å¢ƒå˜é‡"></a>4ã€é…ç½® HADOOP_HOME ç¯å¢ƒå˜é‡</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo vim /etc/profile<br><br>HADOOP_HOME=/app/hadoop/hadoop-3.3.4<br>PATH=<span class="hljs-variable">$HADOOP_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> PATH<br><br><br><span class="hljs-comment">#æ›´æ–°ç¯å¢ƒå˜é‡</span><br><span class="hljs-built_in">source</span> /etc/profile<br><br><span class="hljs-comment">#è¿›è¡ŒéªŒè¯</span><br>hadoop version<br></code></pre></td></tr></table></figure><h2 id="5ã€Hadoop-ä¼ªåˆ†å¸ƒå¼æ¨¡å¼é…ç½®"><a href="#5ã€Hadoop-ä¼ªåˆ†å¸ƒå¼æ¨¡å¼é…ç½®" class="headerlink" title="5ã€Hadoop ä¼ªåˆ†å¸ƒå¼æ¨¡å¼é…ç½®"></a>5ã€Hadoop ä¼ªåˆ†å¸ƒå¼æ¨¡å¼é…ç½®</h2><p>Hadoop å¯ä»¥ä»¥ä¼ªåˆ†å¸ƒå¼æ¨¡å¼è¿è¡Œåœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå…¶ä¸­æ¯ä¸ªHadoopå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨å•ç‹¬çš„ Java è¿›ç¨‹ä¸­ã€‚</p><h3 id="1-é…ç½®"><a href="#1-é…ç½®" class="headerlink" title="1.é…ç½®:"></a>1.é…ç½®:</h3><p>åœ¨ Hadoop ç›®å½•ä¸‹çš„ etc&#x2F;hadoop&#x2F;core-site.xml ä¸­å¢åŠ ä¸‹é¢çš„é…ç½®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim etc/hadoop/core-site.xml<br><br>&lt;configuration&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;fs.defaultFS&lt;/name&gt;<br>        &lt;value&gt;hdfs://127.0.0.1:9000&lt;/value&gt;<br>    &lt;/property&gt;<br>&lt;/configuration&gt;<br></code></pre></td></tr></table></figure><p>å…³äº core-site.xml ç›¸å…³é…ç½®çš„å±æ€§çš„è¯´æ˜å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/core-default.xml">https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/core-default.xml</a></p><h3 id="2-å»ºè®®é…ç½®ä¸€ä¸‹-hadoop-çš„æ–‡ä»¶ç›®å½•ï¼Œè¯¥ç›®å½•é»˜è®¤æŒ‡å‘-x2F-tmp-x2F-hadoop-user-name"><a href="#2-å»ºè®®é…ç½®ä¸€ä¸‹-hadoop-çš„æ–‡ä»¶ç›®å½•ï¼Œè¯¥ç›®å½•é»˜è®¤æŒ‡å‘-x2F-tmp-x2F-hadoop-user-name" class="headerlink" title="2.å»ºè®®é…ç½®ä¸€ä¸‹ hadoop çš„æ–‡ä»¶ç›®å½•ï¼Œè¯¥ç›®å½•é»˜è®¤æŒ‡å‘ &#x2F;tmp&#x2F;hadoop-${user.name}"></a>2.å»ºè®®é…ç½®ä¸€ä¸‹ hadoop çš„æ–‡ä»¶ç›®å½•ï¼Œè¯¥ç›®å½•é»˜è®¤æŒ‡å‘ &#x2F;tmp&#x2F;hadoop-${user.name}</h3><p>ç”±äºåœ¨ &#x2F;tmp ç›®å½•ä¸‹ï¼Œæ‰€ä»¥ä¸€æ—¦æœºå™¨é‡å¯ï¼Œæ•°æ®ä¼šä¸¢å¤±ã€‚åœ¨æœåŠ¡å™¨ä¸­åˆ›å»ºæ•°æ®ç›®å½•å­˜æ”¾åœ°å€ï¼Œè¿™é‡Œæˆ‘åˆ›å»ºäº† &#x2F;opt&#x2F;hadoop_tmp_dir ç›®å½•ï¼Œåœ¨ etc&#x2F;hadoop&#x2F;core-site.xml ä¸­ç»§ç»­å¢åŠ ä¸‹é¢çš„é…ç½®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /opt/hadoop_tmp_dir<br><span class="hljs-comment">#å¦‚æœæ˜¯ä½¿ç”¨hadoopç”¨æˆ·å¯åŠ¨æ—¶ï¼Œéœ€è¦ä¿®æ”¹è¯¥æ–‡ä»¶çš„æƒé™ä»¥åŠæ‰€å±</span><br><span class="hljs-comment">#æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:</span><br><span class="hljs-comment">#chown hadoop /opt/hadoop_tmp_dir</span><br><span class="hljs-comment">#chmod -R 777 /opt/hadoop_tmp_dir/</span><br><br>vim etc/hadoop/core-site.xml<br><span class="hljs-comment">#...</span><br><span class="hljs-comment">#åœ¨&lt;/property&gt;åæ·»åŠ </span><br>    &lt;property&gt;<br>        &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;<br>        &lt;value&gt;/opt/hadoop_tmp_dir&lt;/value&gt;<br>    &lt;/property&gt;<br>&lt;/configuration&gt;<br></code></pre></td></tr></table></figure><h3 id="3-ä¹‹ååœ¨-Hadoop-ç›®å½•ä¸‹çš„-etc-x2F-hadoop-x2F-hdfs-site-xml-ä¸­å¢åŠ ä¸‹é¢çš„é…ç½®ï¼š"><a href="#3-ä¹‹ååœ¨-Hadoop-ç›®å½•ä¸‹çš„-etc-x2F-hadoop-x2F-hdfs-site-xml-ä¸­å¢åŠ ä¸‹é¢çš„é…ç½®ï¼š" class="headerlink" title="3.ä¹‹ååœ¨ Hadoop ç›®å½•ä¸‹çš„ etc&#x2F;hadoop&#x2F;hdfs-site.xml ä¸­å¢åŠ ä¸‹é¢çš„é…ç½®ï¼š"></a>3.ä¹‹ååœ¨ Hadoop ç›®å½•ä¸‹çš„ etc&#x2F;hadoop&#x2F;hdfs-site.xml ä¸­å¢åŠ ä¸‹é¢çš„é…ç½®ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim etc/hadoop/hdfs-site.xml<br><br>&lt;configuration&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;dfs.replication&lt;/name&gt;<br>        &lt;value&gt;1&lt;/value&gt;<br>    &lt;/property&gt;<br>&lt;/configuration&gt;<br><br><span class="hljs-comment">#è¿™é‡ŒæŒ‡çš„æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„å‰¯æœ¬ç³»æ•°ã€‚æœ‰å…³ hdfs-site.xml ç›¸å…³é…ç½®å±æ€§çš„è¯´æ˜å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/hdfs-default.xml</span><br></code></pre></td></tr></table></figure><h3 id="4-è®¾ç½®SSHå…å¯†ç™»é™†"><a href="#4-è®¾ç½®SSHå…å¯†ç™»é™†" class="headerlink" title="4.è®¾ç½®SSHå…å¯†ç™»é™†"></a>4.è®¾ç½®SSHå…å¯†ç™»é™†</h3><p>ç°åœ¨æ£€æŸ¥æ˜¯å¦å¯ä»¥åœ¨ä¸ä½¿ç”¨å¯†ç çš„æƒ…å†µä¸‹ ssh åˆ°æœ¬åœ°ä¸»æœº:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ssh localhost<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œå¦‚æœéœ€è¦è¾“å…¥å¯†ç æ‰èƒ½ç™»é™†åˆ° localhost çš„è¯ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">ssh-keygen -t rsa -P <span class="hljs-string">&#x27;&#x27;</span> -f ~/.ssh/id_rsa<br><span class="hljs-built_in">cat</span> ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys<br><span class="hljs-built_in">chmod</span> 0600 ~/.ssh/authorized_keys<br><br><span class="hljs-comment">#ä¸Šé¢çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œå°±å¯ä»¥äº†ï¼Œ æ‰§è¡Œå®Œåè¾“å…¥ssh localhostå°±å¯ä»¥ä¸ç”¨è¾“å…¥å¯†ç è€Œç›´æ¥ç™»é™†äº†ã€‚</span><br></code></pre></td></tr></table></figure><h3 id="5-æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ"><a href="#5-æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="5.æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ"></a>5.æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ</h3><p>å¯åŠ¨ HDFSï¼Œåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ä¸€å®šè¦æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿï¼Œ åé¢å¯åŠ¨å°±ä¸éœ€è¦äº†ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">hdfs namenode -format<br><br><span class="hljs-comment">#è¿™ä¸ªæ—¶å€™å°±ä¼šåœ¨ä¹‹å‰æˆ‘ä»¬é…ç½®çš„ /opt/hadoop_tmp_dir ç›®å½•ä¸‹ç”Ÿæˆ dfs ç›®å½•æ–‡ä»¶ä¿¡æ¯ã€‚</span><br></code></pre></td></tr></table></figure><h3 id="6-å¯åŠ¨-NameNode-å®ˆæŠ¤è¿›ç¨‹å’Œ-DataNode-å®ˆæŠ¤è¿›ç¨‹"><a href="#6-å¯åŠ¨-NameNode-å®ˆæŠ¤è¿›ç¨‹å’Œ-DataNode-å®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="6.å¯åŠ¨ NameNode å®ˆæŠ¤è¿›ç¨‹å’Œ DataNode å®ˆæŠ¤è¿›ç¨‹"></a>6.å¯åŠ¨ NameNode å®ˆæŠ¤è¿›ç¨‹å’Œ DataNode å®ˆæŠ¤è¿›ç¨‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sbin/start-dfs.sh<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šåœ¨ sbin ç›®å½•ä¸‹è¿è¡Œä¸Šé¢çš„è„šæœ¬ï¼Œå¯åŠ¨ HDFS ã€‚å¦‚æœå‡ºç°ä¸‹é¢çš„é”™è¯¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@stackstone-001 sbin]<span class="hljs-comment"># ./start-dfs.sh </span><br>Starting namenodes on [localhost]<br>ERROR: Attempting to operate on hdfs namenode as root<br>ERROR: but there is no HDFS_NAMENODE_USER defined. Aborting operation.<br>Starting datanodes<br>ERROR: Attempting to operate on hdfs datanode as root<br>ERROR: but there is no HDFS_DATANODE_USER defined. Aborting operation.<br>Starting secondary namenodes [stackstone-001]<br>ERROR: Attempting to operate on hdfs secondarynamenode as root<br>ERROR: but there is no HDFS_SECONDARYNAMENODE_USER defined. Aborting operation.<br><br>åˆ™éœ€è¦è®¾ç½®è„šæœ¬  ï¼Œå¢åŠ 3ä¸ªå˜é‡è®¾ç½®ï¼š<br><br>vim sbin/start-dfs.sh<br><span class="hljs-comment">#æ‰¾åˆ°HDFS_DATANODE_USERï¼Œæ·»åŠ å¦‚ä¸‹</span><br><br>HDFS_NAMENODE_USER=root<br>HDFS_DATANODE_USER=root<br>HDFS_SECONDARYNAMENODE_USER=root<br><br><span class="hljs-comment">#æ³¨ï¼šæœ€å¥½ä¸è¦ç”¨rootè´¦å·æ¥å¯åŠ¨æˆ‘ä»¬çš„HadoopæœåŠ¡ï¼Œå»ºè®®æ”¹æˆhadoop</span><br><br></code></pre></td></tr></table></figure><h3 id="7-å¯åŠ¨æˆåŠŸåéªŒè¯"><a href="#7-å¯åŠ¨æˆåŠŸåéªŒè¯" class="headerlink" title="7.å¯åŠ¨æˆåŠŸåéªŒè¯"></a>7.å¯åŠ¨æˆåŠŸåéªŒè¯</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@stackstone-001 sbin]<span class="hljs-comment"># jps</span><br>6017 DataNode<br>6262 SecondaryNameNode<br>9639 Jps<br>5869 NameNode<br><br>[root@stackstone-001 sbin]<span class="hljs-comment"># hadoop dfs -mkdir /test</span><br>WARNING: Use of this script to execute dfs is deprecated.<br>WARNING: Attempting to execute replacement <span class="hljs-string">&quot;hdfs dfs&quot;</span> instead.<br><br>[root@stackstone-001 sbin]<span class="hljs-comment"># hdfs dfs -ls /</span><br>Found 1 items<br>drwxr-xr-x   - root supergroup          0 2021-08-05 18:16 /test<br><br></code></pre></td></tr></table></figure><p>åœ¨hdfsä¸‹åˆ›å»º&#x2F;testç›®å½•å¹¶æŸ¥çœ‹ï¼Œä»ä¸Šé¢çš„å‘½ä»¤è¡Œå¯ä»¥çœ‹å‡ºï¼Œæ–°ç‰ˆçš„å‘½ä»¤æ”¹ä¸ºï¼šhdfs dfs è¿›è¡Œæ“ä½œã€‚<br>å¤‡æ³¨ï¼šå¦‚æœéœ€è¦åœæ­¢æœåŠ¡ï¼Œåˆ™è¿è¡Œ stop-dfs.sh è„šæœ¬ï¼Œå¦‚æœå‡ºç°å’Œå¯åŠ¨è„šæœ¬ä¸€æ ·çš„é”™è¯¯ï¼ŒåŒæ ·åœ¨è¯¥è„šæœ¬ä¸­åŠ å…¥ HDFS_NAMENODE_USERã€HDFS_DATANODE_USERã€HDFS_SECONDARYNAMENODE_USER çš„è®¾ç½®ã€‚</p><h3 id="8-è®¿é—®webé¡µé¢"><a href="#8-è®¿é—®webé¡µé¢" class="headerlink" title="8.è®¿é—®webé¡µé¢**"></a>8.è®¿é—®webé¡µé¢**</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">http://localhost:9868<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Hadoop</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hadoop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sparkæ­å»ºå•èŠ‚ç‚¹</title>
    <link href="/2023/04/13/%E4%B8%AD%E9%97%B4%E4%BB%B6/spark+hadoop/spark%E6%90%AD%E5%BB%BA%E5%8D%95%E8%8A%82%E7%82%B9/"/>
    <url>/2023/04/13/%E4%B8%AD%E9%97%B4%E4%BB%B6/spark+hadoop/spark%E6%90%AD%E5%BB%BA%E5%8D%95%E8%8A%82%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="sparkæ­å»ºå•èŠ‚ç‚¹"><a href="#sparkæ­å»ºå•èŠ‚ç‚¹" class="headerlink" title="sparkæ­å»ºå•èŠ‚ç‚¹"></a>sparkæ­å»ºå•èŠ‚ç‚¹</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://www.jianshu.com/p/8c0b1b39d0e5<br>é›†ç¾¤å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/zhangyongli2011/p/10572152.html<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€å‡†å¤‡"><a href="#ä¸€ã€å‡†å¤‡" class="headerlink" title="ä¸€ã€å‡†å¤‡"></a>ä¸€ã€å‡†å¤‡</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">1.å®‰è£…jdkç¯å¢ƒ     <br>2.å®‰è£…å¹¶å¯åŠ¨hadoop<br>æˆ‘çš„hadoopçš„è·¯å¾„åœ¨/home/hadoop/hadoop-3.3.4<br></code></pre></td></tr></table></figure><h2 id="äºŒã€å®‰è£…spark"><a href="#äºŒã€å®‰è£…spark" class="headerlink" title="äºŒã€å®‰è£…spark"></a>äºŒã€å®‰è£…spark</h2><p>å„ç‰ˆæœ¬ä¸‹è½½åœ°å€ï¼š<a href="https://archive.apache.org/dist/spark/">https://archive.apache.org/dist/spark/</a></p><h3 id="1-ä¸‹è½½sparkå®‰è£…åŒ…"><a href="#1-ä¸‹è½½sparkå®‰è£…åŒ…" class="headerlink" title="1.ä¸‹è½½sparkå®‰è£…åŒ…"></a>1.ä¸‹è½½sparkå®‰è£…åŒ…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://dlcdn.apache.org/spark/spark-3.3.0/spark-3.3.0-bin-hadoop3.tgz --no-check-certificate<br></code></pre></td></tr></table></figure><h3 id="2-è§£å‹æ–‡ä»¶åˆ°æŒ‡å®šä½ç½®"><a href="#2-è§£å‹æ–‡ä»¶åˆ°æŒ‡å®šä½ç½®" class="headerlink" title="2.è§£å‹æ–‡ä»¶åˆ°æŒ‡å®šä½ç½®:"></a>2.è§£å‹æ–‡ä»¶åˆ°æŒ‡å®šä½ç½®:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo tar -C /usr/local -xzf spark-3.3.0-bin-hadoop3.tgz<br></code></pre></td></tr></table></figure><h3 id="3-è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#3-è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="3.è®¾ç½®ç¯å¢ƒå˜é‡:"></a>3.è®¾ç½®ç¯å¢ƒå˜é‡:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo vim /etc/profile<br><span class="hljs-comment">#å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</span><br>SPARK_HOME=/usr/local/spark-3.3.0-bin-hadoop3<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$SPARK_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment">#æ‰§è¡Œï¼Œè®©é…ç½®ç”Ÿæ•ˆ</span><br><br><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><h3 id="4-è¿è¡Œspark-shell"><a href="#4-è¿è¡Œspark-shell" class="headerlink" title="4.è¿è¡Œspark-shell:"></a>4.è¿è¡Œspark-shell:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">spark-shell<br></code></pre></td></tr></table></figure><p><strong>sparkç®¡ç†é¡µé¢:<a href="http://localhost:4040/">http://localhost:4040</a></strong></p><h2 id="ä¸‰ã€é…ç½®spark"><a href="#ä¸‰ã€é…ç½®spark" class="headerlink" title="ä¸‰ã€é…ç½®spark"></a>ä¸‰ã€é…ç½®spark</h2><h3 id="1-ä¿®æ”¹host-userï¼š"><a href="#1-ä¿®æ”¹host-userï¼š" class="headerlink" title="1.ä¿®æ”¹host-userï¼š"></a>1.ä¿®æ”¹host-userï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim ~/.ssh/config<br><br>Host minio-1<br>  user hadoop<br><br><span class="hljs-comment">#host ä»¥ä½ è‡ªèº«ä¸»æœºåä¸ºå‡†ï¼Œuserä»¥ä½ çš„ç”¨æˆ·åä¸ºä¸»</span><br></code></pre></td></tr></table></figure><h3 id="2-é…ç½®æƒé™ï¼š"><a href="#2-é…ç½®æƒé™ï¼š" class="headerlink" title="2.é…ç½®æƒé™ï¼š"></a>2.é…ç½®æƒé™ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo <span class="hljs-built_in">chown</span> -R hadoop /usr/local/spark-3.3.0-bin-hadoop3/<br></code></pre></td></tr></table></figure><h3 id="3-ç¼–è¾‘spark-env-sh"><a href="#3-ç¼–è¾‘spark-env-sh" class="headerlink" title="3.ç¼–è¾‘spark-env.sh"></a>3.ç¼–è¾‘spark-env.sh</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$SPARK_HOME</span>/conf<br><span class="hljs-built_in">cp</span> spark-env.sh.template spark-env.sh<br><br>vim spark-env.sh<br><span class="hljs-comment">#æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</span><br><span class="hljs-comment">#!/usr/bin/env bash</span><br><span class="hljs-comment">#javaçš„è·¯å¾„</span><br><span class="hljs-built_in">export</span> JAVA_HOME=/usr/local/jdk1.8.0<br><span class="hljs-comment">#hadoopè·¯å¾„</span><br><span class="hljs-built_in">export</span> SPARK_DIST_CLASSPATH=$(/home/hadoop/hadoop-3.3.4/bin/hadoop classpath)<br><span class="hljs-built_in">export</span> HADOOP_CONF_DIR=/home/hadoop/hadoop-3.3.4/etc/hadoop<br><span class="hljs-comment">#æœåŠ¡å™¨ip</span><br><span class="hljs-built_in">export</span> SPARK_MASTER_IP=192.168.62.129<br><span class="hljs-comment">#æœåŠ¡å™¨host</span><br><span class="hljs-built_in">export</span> SPARK_MASTER_HOST=192.168.62.129<br><br></code></pre></td></tr></table></figure><h3 id="4-sparkå¯åŠ¨ï¼š"><a href="#4-sparkå¯åŠ¨ï¼š" class="headerlink" title="4.sparkå¯åŠ¨ï¼š"></a>4.sparkå¯åŠ¨ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$SPARK_HOME</span>/sbin<br><br>./start-all.sh<br></code></pre></td></tr></table></figure><h2 id="éªŒè¯spark"><a href="#éªŒè¯spark" class="headerlink" title="éªŒè¯spark"></a>éªŒè¯spark</h2><p>è®¿é—® <a href="http://localhost:8080/">http://localhost:8080</a>  å³å¯æŸ¥çœ‹ç½‘é¡µç«¯ï¼ŒWorker Idèƒ½çœ‹åˆ°æœ¬æœºèŠ‚ç‚¹</p>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>spark</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spark</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jaegerå®‰è£…</title>
    <link href="/2023/04/12/%E4%B8%AD%E9%97%B4%E4%BB%B6/jaeger/jaeger%E5%AE%89%E8%A3%85/"/>
    <url>/2023/04/12/%E4%B8%AD%E9%97%B4%E4%BB%B6/jaeger/jaeger%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å®‰è£…å’Œéƒ¨ç½²"><a href="#å®‰è£…å’Œéƒ¨ç½²" class="headerlink" title="å®‰è£…å’Œéƒ¨ç½²"></a>å®‰è£…å’Œéƒ¨ç½²</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://juejin.cn/post/6844903833143869453<br>jaegerçš„å®˜ç½‘æ˜¯:www.jaegertracing.io/<br></code></pre></td></tr></table></figure><h2 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»:"></a>åŸºæœ¬ä»‹ç»:</h2><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta">æ”¯æŒOpenTracingçš„<span class="hljs-keyword">server</span>ç«¯æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬æ€»è¦é€‰ä¸€ä¸ªã€‚åœ¨è¿™é‡Œï¼Œé€‰ç”¨jaegerã€‚<br>jaegerçš„å¼€å‘è¾ƒä¸ºæ´»è·ƒï¼Œæ”¯æŒçš„å®¢æˆ·ç«¯å®ç°ä¹Ÿè¾ƒå¤šã€‚ç”±äºé‡‡ç”¨äº†golangå¼€å‘ï¼Œå‘è¡ŒåŒ…ä¹Ÿæ¯”è¾ƒç®€æ´ã€‚<br></code></pre></td></tr></table></figure><h2 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">jaegerçš„å¼€å‘è¯­è¨€æ˜¯`golang`<br>jaegeræ”¯æŒOpenTracingåè®®ï¼ŒåŒå±äºCNCFåŸºé‡‘ä¼š <br>jaegeræ”¯æŒå„ç§å„æ ·çš„å®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬Goã€Javaã€<span class="hljs-keyword">Node</span><span class="hljs-title">ã€Python</span>ã€C++ç­‰<br>jaegeræ”¯æŒudpåè®®ä¼ è¾“ï¼Œå½“ç„¶ä¹Ÿæ”¯æŒhttp<br></code></pre></td></tr></table></figure><h2 id="jaegerèƒ½å¤Ÿè§£å†³ä»¥ä¸‹é—®é¢˜"><a href="#jaegerèƒ½å¤Ÿè§£å†³ä»¥ä¸‹é—®é¢˜" class="headerlink" title="jaegerèƒ½å¤Ÿè§£å†³ä»¥ä¸‹é—®é¢˜"></a>jaegerèƒ½å¤Ÿè§£å†³ä»¥ä¸‹é—®é¢˜</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">åˆ†å¸ƒå¼äº‹åŠ¡ç›‘æ§<br>æ€§èƒ½åˆ†æä¸æ€§èƒ½ä¼˜åŒ–<br>è°ƒç”¨é“¾ï¼Œæ‰¾åˆ°æ ¹æºé—®é¢˜<br>æœåŠ¡ä¾èµ–åˆ†æï¼ˆéœ€å¤§æ•°æ®åˆ†æ)<br></code></pre></td></tr></table></figure><h2 id="å¤åˆ¶ä»£ç å®‰è£…éœ€äº†è§£çš„æŠ€æœ¯æ ˆï¼š"><a href="#å¤åˆ¶ä»£ç å®‰è£…éœ€äº†è§£çš„æŠ€æœ¯æ ˆï¼š" class="headerlink" title="å¤åˆ¶ä»£ç å®‰è£…éœ€äº†è§£çš„æŠ€æœ¯æ ˆï¼š"></a>å¤åˆ¶ä»£ç å®‰è£…éœ€äº†è§£çš„æŠ€æœ¯æ ˆï¼š</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">OpenTracing</span><br>Golang<br>ElasticSearch<br>Kafka ï¼ˆå¯é€‰)<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs armasm">ç¯å¢ƒå‡†å¤‡ï¼š<br>ä¸»æœº<span class="hljs-built_in">ip</span>åœ°å€ï¼š<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">62</span>.<span class="hljs-number">129</span><br>ä¸»æœºç³»ç»Ÿï¼šcentos7<br></code></pre></td></tr></table></figure><h3 id="1-ä¸‹è½½å¹¶è§£å‹"><a href="#1-ä¸‹è½½å¹¶è§£å‹" class="headerlink" title="1.ä¸‹è½½å¹¶è§£å‹"></a>1.ä¸‹è½½å¹¶è§£å‹</h3><p>jaegeræ˜¯äºŒè¿›åˆ¶å‘è¡ŒåŒ…ï¼Œä½¿ç”¨wgetä¸‹è½½å³å¯ï¼Œè¿™é‡Œä»¥linuxç‰ˆæœ¬ä¸ºä¾‹ã€‚<br>ä¸‹è½½åœ°å€:<code>https://github.com/jaegertracing/jaeger/tags</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://github.com/jaegertracing/jaeger/releases/download/v1.39.0/jaeger-1.39.0-linux-amd64.tar.gz<br><br>tar -xnf jaeger-1.39.0-linux-amd64.tar.gz<br><br><span class="hljs-comment">#è§£å‹åjaegerçš„äºŒè¿›åˆ¶å‘è¡ŒåŒ…åŒ…å«å…­ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼š</span><br>example-hotrod<br>jaeger-agent<br>jaeger-collector<br>jaeger-query<br>jaeger-all-in-one<br>jaeger-ingester<br><br></code></pre></td></tr></table></figure><h3 id="2-é€‰æ‹©å­˜å‚¨"><a href="#2-é€‰æ‹©å­˜å‚¨" class="headerlink" title="2.é€‰æ‹©å­˜å‚¨"></a>2.é€‰æ‹©å­˜å‚¨</h3><p>traceæ•°æ®æ€»è¦å­˜åœ¨ä¸€ä¸ªåœ°æ–¹ã€‚jaegeræ”¯æŒESå’ŒCanssandraä¸¤ç§åç«¯DBã€‚å›½å†…ç”¨ESçš„å¤šä¸€ç‚¹ï¼Œæˆ‘ä»¬å°±ä»¥ESä¸ºä¾‹ï¼ˆESå®‰è£…è¿‡ç¨‹å·²ç•¥è¿‡ï¼‰ï¼š</p><p><code>esè¿æ¥åœ°å€ï¼š192.168.62.128:9200</code></p><p>ç”±äºä¸Šé¢å››ä¸ªå‘½ä»¤éƒ½æœ‰å¾ˆå¤šå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ›å»ºæ–‡ä»¶æ¥å­˜æ”¾è¿™å‡ ä¸ªè„šæœ¬ï¼Œæ¥æ”¯æŒjaegerçš„å¯åŠ¨ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> jaeger-sh &amp;&amp; <span class="hljs-built_in">cd</span> jaeger-sh<br><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim start-collector.sh<br><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">export</span> SPAN_STORAGE_TYPE=elasticsearch<br><span class="hljs-built_in">nohup</span> ../jaeger-collector  --es.server-urls http://192.168.62.128:9200/  --log-level=debug &gt; collector.log  2&gt;&amp;1 &amp;<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim start-agent.sh<br><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">export</span> SPAN_STORAGE_TYPE=elasticsearch<br><span class="hljs-built_in">nohup</span>  ../jaeger-agent  --admin.http.host-port=192.168.62.129:14267 --reporter.grpc.discovery.min-peers=1 --log-level=debug &gt; agent.log 2&gt;&amp;1 &amp;<br><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim start-query.sh<br><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">export</span> SPAN_STORAGE_TYPE=elasticsearch<br><span class="hljs-built_in">nohup</span> ../jaeger-query --span-storage.type=elasticsearch --es.server-urls=http://192.168.62.128:9200/  &gt; query.log 2&gt;&amp;1 &amp;<br><br></code></pre></td></tr></table></figure><h2 id="éƒ¨ç½²æ–¹å¼"><a href="#éƒ¨ç½²æ–¹å¼" class="headerlink" title="éƒ¨ç½²æ–¹å¼"></a>éƒ¨ç½²æ–¹å¼</h2><p>jaegeræœ‰ä¸¤ç§éƒ¨ç½²æ–¹å¼ã€‚ä¸‹é¢ä¸€ä¸€ä»‹ç»ã€‚å¦‚æœä½ çš„æ•°æ®é‡ç‰¹åˆ«å¤šï¼Œä½¿ç”¨kafkaç¼“å†²ä¸€ä¸‹ä¹Ÿæ˜¯å¯ä»¥çš„(æ‰€ä»¥å°±å¼•å…¥äº†å¦å¤–ä¸€ä¸ªç»„ä»¶jaeger-ingesterï¼‰ï¼Œä¸å¤šåšä»‹ç»ã€‚</p><p>æµ‹è¯•ç¯å¢ƒï¼š</p><p><img src="/2023/04/12/%E4%B8%AD%E9%97%B4%E4%BB%B6/jaeger/jaeger%E5%AE%89%E8%A3%85/image-20221110161255214.png" alt="image-20221110161255214"></p><p>å¤‡æ³¨ï¼šè¿™ç§æ–¹å¼ä¸€èˆ¬ç”¨åœ¨devç¯å¢ƒæˆ–è€…å…¶ä»–æµ‹è¯•ç¯å¢ƒã€‚åªéœ€è¦éƒ¨ç½²ä¸€ä¸ªå•ä¸€èŠ‚ç‚¹å³å¯ã€‚æˆ‘ä»¬çš„appï¼Œéœ€è¦æ‰‹åŠ¨å¡«å†™agentçš„åœ°å€ï¼Œè¿™ä¸ªåœ°å€ä¸€èˆ¬éƒ½æ˜¯å›ºå®šçš„ã€‚è¿™äº›ç¯å¢ƒçš„æµé‡å¾ˆå°ï¼Œä¸€ä¸ªagentæ˜¯è¶³å¤Ÿçš„ã€‚æ›´åŠ ç®€æ´çš„éƒ¨ç½²æ–¹å¼ï¼Œè¿agentéƒ½ä¸éœ€è¦ï¼Œç›´æ¥å‘collectorå‘é€æ•°æ®å³å¯ã€‚ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬ä½¿ç”¨æ­¤æ–¹å¼ã€‚</p><p>æ­£å¼ç¯å¢ƒï¼š</p><p><img src="/2023/04/12/%E4%B8%AD%E9%97%B4%E4%BB%B6/jaeger/jaeger%E5%AE%89%E8%A3%85/image-20221110161404044.png" alt="image-20221110161404044"></p><p>å¤‡æ³¨ï¼šä¸Šé¢è¿™ç§éƒ¨ç½²æ–¹å¼ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒã€‚agentå®‰è£…åœ¨æ¯ä¸€å°ä¸šåŠ¡æœºå™¨ä¸Šã€‚Clientç«¯çš„ç›®æ ‡agentåªéœ€è¦å¡«å†™localhostå³å¯ã€‚è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯ç”Ÿäº§ç¯å¢ƒçš„é…ç½®éå¸¸çš„ç®€å•ã€‚å³ä½¿ä½ çš„æœºå™¨æ˜¯æ··åˆéƒ¨ç½²çš„ï¼Œä¹Ÿèƒ½æ­£å¸¸æ”¶é›†traceä¿¡æ¯</p><p>â€‹</p><h2 id="è°ƒç”¨å…³ç³»å›¾"><a href="#è°ƒç”¨å…³ç³»å›¾" class="headerlink" title="è°ƒç”¨å…³ç³»å›¾"></a>è°ƒç”¨å…³ç³»å›¾</h2><p>jaegerçš„è°ƒç”¨å…³ç³»å›¾æ˜¯ä½¿ç”¨sparkä»»åŠ¡è¿›è¡Œè®¡ç®—çš„ã€‚é¡¹ç›®åœ°å€ä¸ºï¼š<a href="https://github.com/jaegertracing/spark-dependencies">https://github.com/jaegertracing/spark-dependencies</a></p><p>ä½œä¸ºä¸€ä¸ªå¯é€‰éƒ¨åˆ†ï¼Œåªæœ‰åœ¨è®¡ç®—å®Œæ¯•åï¼Œæ‰èƒ½åœ¨jaegerçš„åå°ä¸­è¿›è¡Œå±•ç°ã€‚</p><h2 id="ç«¯å£æ•´ç†"><a href="#ç«¯å£æ•´ç†" class="headerlink" title="ç«¯å£æ•´ç†"></a>ç«¯å£æ•´ç†</h2><p><strong>Agent</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">5775 UDPåè®®ï¼Œæ¥æ”¶å…¼å®¹zipkinçš„åè®®æ•°æ®<br>6831 UDPåè®®ï¼Œæ¥æ”¶å…¼å®¹jaegerçš„å…¼å®¹åè®®<br>6832 UDPåè®®ï¼Œæ¥æ”¶jaegerçš„äºŒè¿›åˆ¶åè®®<br>5778 HTTPåè®®ï¼Œæ•°æ®é‡å¤§ä¸å»ºè®®ä½¿ç”¨<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¤‡æ³¨ï¼šå®ƒä»¬ä¹‹é—´çš„ä¼ è¾“åè®®éƒ½æ˜¯åŸºäºthriftå°è£…çš„ã€‚æˆ‘ä»¬é»˜è®¤ä½¿ç”¨5775ä½œä¸ºä¼ è¾“ç«¯å£ã€‚</span><br></code></pre></td></tr></table></figure><p><strong>Collector</strong></p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">14267 </span>tcp agentå‘é€jaeger.thriftæ ¼å¼æ•°æ®<br><span class="hljs-symbol">14250 </span>tcp agentå‘é€protoæ ¼å¼æ•°æ®ï¼ˆèƒŒågRPC)<br><span class="hljs-symbol">14268 </span>http ç›´æ¥æ¥å—å®¢æˆ·ç«¯æ•°æ®<br><span class="hljs-symbol">14269 </span>http å¥åº·æ£€æŸ¥<br></code></pre></td></tr></table></figure><p><strong>Query</strong></p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">16686 </span>http jaegerçš„å‰ç«¯ï¼Œæ”¾ç»™ç”¨æˆ·çš„æ¥å£<br><span class="hljs-symbol">16687 </span>http å¥åº·æ£€æŸ¥<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>jaeger</category>
      
    </categories>
    
    
    <tags>
      
      <tag>jaeger</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxä¹‹Zookeeperé›†ç¾¤æ­å»º</title>
    <link href="/2023/04/11/%E4%B8%AD%E9%97%B4%E4%BB%B6/Zookeeper/Liunx%E4%B9%8BZookeeper%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"/>
    <url>/2023/04/11/%E4%B8%AD%E9%97%B4%E4%BB%B6/Zookeeper/Liunx%E4%B9%8BZookeeper%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Linuxä¹‹Zookeeperé›†ç¾¤æ­å»ºï¼š"><a href="#Linuxä¹‹Zookeeperé›†ç¾¤æ­å»ºï¼š" class="headerlink" title="Linuxä¹‹Zookeeperé›†ç¾¤æ­å»ºï¼š"></a>Linuxä¹‹Zookeeperé›†ç¾¤æ­å»ºï¼š</h1><p><code>å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/carefree2005/article/details/118027821</code></p><h2 id="ä¸€ã€Zookeeperé›†ç¾¤ç®€ä»‹ï¼š"><a href="#ä¸€ã€Zookeeperé›†ç¾¤ç®€ä»‹ï¼š" class="headerlink" title="ä¸€ã€Zookeeperé›†ç¾¤ç®€ä»‹ï¼š"></a>ä¸€ã€Zookeeperé›†ç¾¤ç®€ä»‹ï¼š</h2><p>  Zookeeperæ˜¯ä¸€ä¸ªé«˜æ•ˆçš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œå¯ä»¥æä¾›é…ç½®ä¿¡æ¯ç®¡ç†ã€å‘½åã€åˆ†å¸ƒå¼åŒæ­¥ã€é›†ç¾¤ç®¡ç†ã€æ•°æ®åº“åˆ‡æ¢ç­‰æœåŠ¡ã€‚å®ƒä¸é€‚ç”¨ä¸å­˜å‚¨å¤§é‡ä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥å­˜å‚¨ä¸€äº›é…ç½®ã€å‘å¸ƒä¸è®¢é˜…ç­‰å°‘é‡ä¿¡æ¯ã€‚Hadoopã€Stormã€æ¶ˆæ¯ä¸­é—´ä»¶ã€<br>RPCæœåŠ¡æ¡†æ¶ã€åˆ†å¸ƒå¼æ•°æ®åº“åŒæ­¥ç³»ç»Ÿï¼Œè¿™äº›éƒ½æ˜¯Zookeeperçš„åº”ç”¨åœºæ™¯ã€‚å¯¹Zookeeperé›†ç¾¤è¿›è¡Œäº†è¿™ä¸‰ç§è§’è‰²çš„åˆ’åˆ†ï¼šleaderã€followerã€observerï¼›</p><ul><li>é¢†å¯¼è€…(leader)ï¼šè´Ÿè´£è®°æ€§æŠ•ç¥¨çš„å‘èµ·å’Œå†³è®®ã€æ›´æ–°ç³»ç»ŸçŠ¶æ€</li><li>è·Ÿéšè€…(follower):ç”¨äºæ¥å—å®¢æˆ·ç«¯è¯·æ±‚å¹¶å‘å®¢æˆ·ç«¯è¿”å›ç»“æœä»¥åŠé€‰ä¸¾è¿‡ç¨‹ä¸­å‚ä¸æŠ•ç¥¨</li><li>è§‚å¯Ÿè€…(observer):å¯ä»¥æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œå°†å†™è¯·æ±‚è½¬å‘ç»™leaderèŠ‚ç‚¹ï¼Œä½†æ˜¯ä¸å‚ä¸æŠ•ç¥¨è¿‡ç¨‹ï¼ŒåªåŒæ­¥leaderçš„çŠ¶æ€ã€‚é€šå¸¸å¯¹æŸ¥è¯¢æ“ä½œåšè´Ÿè½½</li></ul><p>Zookeeperçš„ä¸‰ä¸ªç«¯å£ä½œç”¨</p><ul><li>2181ï¼šå¯¹clientç«¯æä¾›æœåŠ¡</li><li>2888ï¼šé›†ç¾¤å†…æœºå™¨é€šä¿¡ä½¿ç”¨</li><li>3888ï¼šé€‰ä¸¾leaderä½¿ç”¨</li></ul><h2 id="äºŒã€æ­å»ºæ­¥éª¤"><a href="#äºŒã€æ­å»ºæ­¥éª¤" class="headerlink" title="äºŒã€æ­å»ºæ­¥éª¤"></a>äºŒã€æ­å»ºæ­¥éª¤</h2><h3 id="1ã€è§„åˆ’é›†ç¾¤èŠ‚ç‚¹"><a href="#1ã€è§„åˆ’é›†ç¾¤èŠ‚ç‚¹" class="headerlink" title="1ã€è§„åˆ’é›†ç¾¤èŠ‚ç‚¹"></a>1ã€è§„åˆ’é›†ç¾¤èŠ‚ç‚¹</h3><table><thead><tr><th>ä¸»æœº</th><th>ipåœ°å€</th><th>ç›‘å¬ç«¯å£</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>mt-1</td><td>192.168.94.154</td><td>2181  3888</td><td>leaderç›‘å¬2888</td></tr><tr><td>mt-2</td><td>192.168.94.155</td><td>2181  3888</td><td></td></tr><tr><td>mt-3</td><td>192.168.94.188</td><td>2181  3888</td><td></td></tr></tbody></table><h3 id="2ã€å®‰è£…JDK-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ"><a href="#2ã€å®‰è£…JDK-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ" class="headerlink" title="2ã€å®‰è£…JDK (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)"></a>2ã€å®‰è£…JDK (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)</h3><h3 id="3ã€åˆ›å»ºzookeeperç”¨æˆ·-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ"><a href="#3ã€åˆ›å»ºzookeeperç”¨æˆ·-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ" class="headerlink" title="3ã€åˆ›å»ºzookeeperç”¨æˆ· (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)"></a>3ã€åˆ›å»ºzookeeperç”¨æˆ· (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">useradd zk<br>passwd zk<br>&gt;è¾“å…¥å¯†ç <br><br>su - zk<br></code></pre></td></tr></table></figure><h3 id="4ã€ä¸‹è½½Zookeeperæœ€æ–°ç¨³å®šç‰ˆ-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ"><a href="#4ã€ä¸‹è½½Zookeeperæœ€æ–°ç¨³å®šç‰ˆ-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ" class="headerlink" title="4ã€ä¸‹è½½Zookeeperæœ€æ–°ç¨³å®šç‰ˆ (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)"></a>4ã€ä¸‹è½½Zookeeperæœ€æ–°ç¨³å®šç‰ˆ (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://mirrors.bfsu.edu.cn/apache/zookeeper/zookeeper-3.5.10/apache-zookeeper-3.5.10-bin.tar.gz --no-check-certificate<br></code></pre></td></tr></table></figure><p>å…¶ä»–ç‰ˆæœ¬ï¼š<a href="https://mirrors.bfsu.edu.cn/apache/zookeeper">https://mirrors.bfsu.edu.cn/apache/zookeeper</a></p><h3 id="5ã€è§£å‹Zookeeperå‹ç¼©åŒ…-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ"><a href="#5ã€è§£å‹Zookeeperå‹ç¼©åŒ…-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ" class="headerlink" title="5ã€è§£å‹Zookeeperå‹ç¼©åŒ… (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)"></a>5ã€è§£å‹Zookeeperå‹ç¼©åŒ… (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -xnf apache-zookeeper-3.5.10-bin.tar.gz<br><br>è®¾ç½®è½¯é“¾æ¥ï¼š<br><span class="hljs-built_in">ln</span> -s apache-zookeeper-3.5.10-bin zookeeper<br></code></pre></td></tr></table></figure><h3 id="6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶zoo-cfg-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ"><a href="#6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶zoo-cfg-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ" class="headerlink" title="6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶zoo.cfg (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)"></a>6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶zoo.cfg (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> data<br><span class="hljs-built_in">cd</span> zookeeper/conf<br><br>ç¼–è¾‘cfgæ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š<br><span class="hljs-built_in">cp</span> zoo_sample.cfg zoo.cfg<br><br><span class="hljs-built_in">cat</span> zoo.cfg<br><br>tickTime=2000<br>initLimit=10<br>syncLimit=5<br>dataDir=/home/zk/data<br>clientPort=2181<br>server.1=192.168.94.154:2888:3888<br>server.2=192.168.94.155:2888:3888<br>server.3=192.168.94.188:2888:3888<br></code></pre></td></tr></table></figure><p><strong>zoo.cfgé…ç½®æ–‡ä»¶å‚æ•°è¯´æ˜ï¼š</strong><br>tickTimeï¼šåŸºæœ¬äº‹ä»¶å•å…ƒï¼Œè¿™ä¸ªæ—¶é—´æ˜¯ä½œä¸ºZookeeperæœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œæ¯éš”tickTimeæ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ï¼›æœ€å° çš„sessionè¿‡æœŸæ—¶é—´ä¸º2å€tickTime<br>dataDirï¼šå­˜å‚¨å†…å­˜ä¸­æ•°æ®åº“å¿«ç…§çš„ä½ç½®ï¼Œé™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™æŒ‡å‘æ•°æ®åº“æ›´æ–°çš„äº‹åŠ¡æ—¥å¿—ã€‚æ³¨æ„ï¼šåº”è¯¥è°¨æ…çš„é€‰æ‹©æ—¥å¿—å­˜æ”¾çš„ä½ç½®ï¼Œä½¿ç”¨ä¸“ç”¨çš„æ—¥å¿—å­˜å‚¨è®¾å¤‡èƒ½å¤Ÿå¤§å¤§æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå¦‚æœå°†æ—¥å¿—å­˜å‚¨åœ¨æ¯”è¾ƒç¹å¿™çš„å­˜å‚¨è®¾å¤‡ä¸Šï¼Œé‚£ä¹ˆå°†ä¼šå¾ˆå¤§ç¨‹åº¦ä¸Šå½±åƒç³»ç»Ÿæ€§èƒ½ã€‚<br>clientï¼šç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£ã€‚<br>initLimitï¼šå…è®¸followerè¿æ¥å¹¶åŒæ­¥åˆ°Leaderçš„åˆå§‹åŒ–è¿æ¥æ—¶é—´ï¼Œä»¥tickTimeä¸ºå•ä½ã€‚å½“åˆå§‹åŒ–è¿æ¥æ—¶é—´è¶…è¿‡è¯¥å€¼ï¼Œåˆ™è¡¨ç¤ºè¿æ¥å¤±è´¥ã€‚<br>syncLimitï¼šè¡¨ç¤ºLeaderä¸Followerä¹‹é—´å‘é€æ¶ˆæ¯æ—¶ï¼Œè¯·æ±‚å’Œåº”ç­”æ—¶é—´é•¿åº¦ã€‚å¦‚æœfolloweråœ¨è®¾ç½®æ—¶é—´å†…ä¸èƒ½ä¸leaderé€šä¿¡ï¼Œé‚£ä¹ˆæ­¤followerå°†ä¼šè¢«ä¸¢å¼ƒã€‚<br>server.A&#x3D;B:C:D<br>Aï¼šå…¶ä¸­ A æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè¿™ä¸ªæ˜¯æœåŠ¡å™¨çš„ç¼–å·ï¼›<br>Bï¼šæ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„ ip åœ°å€ï¼›<br>Cï¼šZookeeperæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ç«¯å£ï¼›<br>Dï¼šLeaderé€‰ä¸¾çš„ç«¯å£ã€‚</p><h3 id="7ã€åˆ›å»ºmyidæ–‡ä»¶"><a href="#7ã€åˆ›å»ºmyidæ–‡ä»¶" class="headerlink" title="7ã€åˆ›å»ºmyidæ–‡ä»¶"></a>7ã€åˆ›å»ºmyidæ–‡ä»¶</h3><p>åœ¨192.168.94.154ï¼ˆserver.1)ä¸Šåˆ›å»ºï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#cd /home/zk/data</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;1&quot;</span> &gt; /home/zk/data/myid<br><br>åœ¨192.168.94.155ï¼ˆserver.2)ä¸Šåˆ›å»ºï¼š<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;2&quot;</span> &gt; /home/zk/data/myid<br><br>åœ¨192.168.94.188ï¼ˆserver.3)ä¸Šåˆ›å»ºï¼š<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;3&quot;</span> &gt; /home/zk/data/myid<br></code></pre></td></tr></table></figure><h3 id="8ã€å¯åŠ¨ZookeeperæœåŠ¡-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ"><a href="#8ã€å¯åŠ¨ZookeeperæœåŠ¡-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ" class="headerlink" title="8ã€å¯åŠ¨ZookeeperæœåŠ¡ (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)"></a>8ã€å¯åŠ¨ZookeeperæœåŠ¡ (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> ~/zookeeper/bin/<br>./zkServer.sh start<br><br><span class="hljs-comment">#-----------è¾“å‡ºï¼š--------------------</span><br>/usr/bin/java<br>ZooKeeper JMX enabled by default<br>Using config: /home/zk/zookeeper/bin/../conf/zoo.cfg<br>Starting zookeeper ... STARTED<br><span class="hljs-comment">#--------------------------------</span><br></code></pre></td></tr></table></figure><h3 id="9ã€æ£€æŸ¥zookeeperçŠ¶æ€"><a href="#9ã€æ£€æŸ¥zookeeperçŠ¶æ€" class="headerlink" title="9ã€æ£€æŸ¥zookeeperçŠ¶æ€"></a>9ã€æ£€æŸ¥zookeeperçŠ¶æ€</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">./zkServer.sh status  <span class="hljs-comment">#ModeçŠ¶æ€ä¸º: leaderã€followerã€observer</span><br><span class="hljs-comment">#------------------------è¾“å‡º-------------------------------</span><br>ZooKeeper JMX enabled by default<br>Using config: /home/zk/zookeeper/bin/../conf/zoo.cfg<br>Client port found: 2181. Client address: localhost. Client SSL: <span class="hljs-literal">false</span>.<br>Mode: follower <span class="hljs-comment">#å¯ä»¥çœ‹åˆ°æœ‰leaderã€followerçŠ¶æ€</span><br><span class="hljs-comment">#-----------------------------------</span><br><br>netstat -lntup <span class="hljs-comment">#æ£€æŸ¥ç«¯å£ï¼Œå¯ä»¥å‘ç°é¢†å¯¼è€…å¤šäº†ä¸€ä¸ªç«¯å£2888</span><br></code></pre></td></tr></table></figure><h3 id="10ã€è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#10ã€è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="10ã€è®¾ç½®ç¯å¢ƒå˜é‡"></a>10ã€è®¾ç½®ç¯å¢ƒå˜é‡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#éœ€åˆ‡æ¢ä¸ºrootç”¨æˆ·</span><br>vim /etc/profile<br><br><span class="hljs-built_in">export</span> ZOOKEEPER_HOME=/home/zk/zookeeper<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ZOOKEEPER_HOME</span>/bin<br><br><span class="hljs-comment">#ä½¿ä¹‹ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Zookeeper</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zookeeper</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­å»ºNFSæ–‡ä»¶å…±äº«å­˜å‚¨æœåŠ¡</title>
    <link href="/2023/04/11/%E6%93%8D%E4%BD%9C%E5%92%8C%E6%9C%8D%E5%8A%A1/%E6%90%AD%E5%BB%BANFS%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB/CentOS%207%E4%B8%AD%E6%90%AD%E5%BB%BANFS%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AE%8C%E6%95%B4%E6%AD%A5%E9%AA%A4/"/>
    <url>/2023/04/11/%E6%93%8D%E4%BD%9C%E5%92%8C%E6%9C%8D%E5%8A%A1/%E6%90%AD%E5%BB%BANFS%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB/CentOS%207%E4%B8%AD%E6%90%AD%E5%BB%BANFS%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AE%8C%E6%95%B4%E6%AD%A5%E9%AA%A4/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="CentOS-7ä¸­æ­å»ºNFSæ–‡ä»¶å…±äº«å­˜å‚¨æœåŠ¡çš„å®Œæ•´æ­¥éª¤"><a href="#CentOS-7ä¸­æ­å»ºNFSæ–‡ä»¶å…±äº«å­˜å‚¨æœåŠ¡çš„å®Œæ•´æ­¥éª¤" class="headerlink" title="CentOS 7ä¸­æ­å»ºNFSæ–‡ä»¶å…±äº«å­˜å‚¨æœåŠ¡çš„å®Œæ•´æ­¥éª¤"></a>CentOS 7ä¸­æ­å»ºNFSæ–‡ä»¶å…±äº«å­˜å‚¨æœåŠ¡çš„å®Œæ•´æ­¥éª¤</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">#å‚è€ƒæ–‡æ¡£ï¼šhttps://cloud.tencent.com/developer/article/1721166<br>#å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/remzhang/article/details/101101126<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€å‡†å¤‡ç¯å¢ƒ"><a href="#ä¸€ã€å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="ä¸€ã€å‡†å¤‡ç¯å¢ƒ"></a>ä¸€ã€å‡†å¤‡ç¯å¢ƒ</h2><p>æˆ‘ä»¬éœ€è¦ä¸¤å°CentOS7æœºå™¨ï¼Œæˆ‘ä»¬ç”¨è™šæ‹Ÿæœºåšæµ‹è¯•ï¼Œåˆ†åˆ«åšNFSæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><table><thead><tr><th>IPåœ°å€</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>192.168.183.88</td><td>NFSæœåŠ¡å™¨ip</td></tr><tr><td>192.168.11.89</td><td>å®¢æˆ·ç«¯ip</td></tr></tbody></table><h2 id="äºŒã€æ­å»ºè¿‡ç¨‹"><a href="#äºŒã€æ­å»ºè¿‡ç¨‹" class="headerlink" title="äºŒã€æ­å»ºè¿‡ç¨‹"></a>äºŒã€æ­å»ºè¿‡ç¨‹</h2><h3 id="1-NFSæœåŠ¡å™¨é…ç½®-å®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯éƒ½éœ€è¦æ‰§è¡Œ"><a href="#1-NFSæœåŠ¡å™¨é…ç½®-å®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯éƒ½éœ€è¦æ‰§è¡Œ" class="headerlink" title="1.NFSæœåŠ¡å™¨é…ç½® (å®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯éƒ½éœ€è¦æ‰§è¡Œ)"></a>1.NFSæœåŠ¡å™¨é…ç½® (å®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯éƒ½éœ€è¦æ‰§è¡Œ)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install rpcbind nfs-utils<br></code></pre></td></tr></table></figure><h3 id="2-åˆ›å»ºå…±äº«ç›®å½•"><a href="#2-åˆ›å»ºå…±äº«ç›®å½•" class="headerlink" title="2.åˆ›å»ºå…±äº«ç›®å½•"></a>2.åˆ›å»ºå…±äº«ç›®å½•</h3><p>åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºå…±äº«ç›®å½•ï¼Œå¹¶è®¾ç½®æƒé™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /data/share/<br><span class="hljs-built_in">chmod</span> 755 -R /data/share/<br></code></pre></td></tr></table></figure><h3 id="3-é…ç½®NFS"><a href="#3-é…ç½®NFS" class="headerlink" title="3.é…ç½®NFS"></a>3.é…ç½®NFS</h3><p>nfsçš„é…ç½®æ–‡ä»¶æ˜¯ &#x2F;etc&#x2F;exports ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ä¸€è¡Œ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/exports<br><br><span class="hljs-comment">#/data/share *(rw,sync,no_root_squash,no_subtree_check) ï¼ˆå…è®¸æ‰€æœ‰çš„å®¢æˆ·ç«¯è®¿é—®ï¼‰</span><br>/data/share/ 192.168.183.89(rw,no_root_squash,no_all_squash,<span class="hljs-built_in">sync</span>)<br><br><span class="hljs-comment">#è¿™è¡Œä»£ç çš„æ„æ€æ˜¯æŠŠå…±äº«ç›®å½•/data/share/å…±äº«ç»™192.168.11.34è¿™ä¸ªå®¢æˆ·ç«¯ipï¼Œåé¢æ‹¬å·é‡Œçš„å†…å®¹æ˜¯æƒé™å‚æ•°ï¼Œå…¶ä¸­ï¼š</span><br>rw:è¡¨ç¤ºè®¾ç½®ç›®å½•å¯è¯»å†™ã€‚<br><span class="hljs-built_in">sync</span>:è¡¨ç¤ºæ•°æ®ä¼šåŒæ­¥å†™å…¥åˆ°å†…å­˜å’Œç¡¬ç›˜ä¸­ï¼Œç›¸å rsync è¡¨ç¤ºæ•°æ®ä¼šå…ˆæš‚å­˜äºå†…å­˜ä¸­ï¼Œè€Œéç›´æ¥å†™å…¥åˆ°ç¡¬ç›˜ä¸­ã€‚<br>no_root_squash:NFSå®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶å¦‚æœä½¿ç”¨çš„æ˜¯rootçš„è¯ï¼Œé‚£ä¹ˆå¯¹æœåŠ¡ç«¯åˆ†äº«çš„ç›®å½•æ¥è¯´ï¼Œä¹Ÿæ‹¥æœ‰rootæƒé™ã€‚<br>no_all_squash:ä¸è®ºNFSå®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ä½¿ç”¨ä»€ä¹ˆç”¨æˆ·ï¼Œå¯¹æœåŠ¡ç«¯åˆ†äº«çš„ç›®å½•æ¥è¯´éƒ½ä¸ä¼šæ‹¥æœ‰åŒ¿åç”¨æˆ·æƒé™ã€‚<br><br><span class="hljs-comment">#å¦‚æœæœ‰å¤šä¸ªå…±äº«ç›®å½•é…ç½®ï¼Œåˆ™ä½¿ç”¨å¤šè¡Œï¼Œä¸€è¡Œä¸€ä¸ªé…ç½®ã€‚ä¿å­˜å¥½é…ç½®æ–‡ä»¶åï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®ç«‹å³ç”Ÿæ•ˆï¼š</span><br>exportfs -r<br></code></pre></td></tr></table></figure><h3 id="4-è®¾ç½®é˜²ç«å¢™-å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰å¼€å¯é˜²ç«å¢™ï¼Œé‚£ä¹ˆè¯¥æ­¥éª¤å¯ä»¥çœç•¥ã€‚"><a href="#4-è®¾ç½®é˜²ç«å¢™-å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰å¼€å¯é˜²ç«å¢™ï¼Œé‚£ä¹ˆè¯¥æ­¥éª¤å¯ä»¥çœç•¥ã€‚" class="headerlink" title="4.è®¾ç½®é˜²ç«å¢™(å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰å¼€å¯é˜²ç«å¢™ï¼Œé‚£ä¹ˆè¯¥æ­¥éª¤å¯ä»¥çœç•¥ã€‚)"></a>4.è®¾ç½®é˜²ç«å¢™(å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰å¼€å¯é˜²ç«å¢™ï¼Œé‚£ä¹ˆè¯¥æ­¥éª¤å¯ä»¥çœç•¥ã€‚)</h3><p>NFSçš„é˜²ç«å¢™ç‰¹åˆ«éš¾æï¼Œå› ä¸ºé™¤äº†å›ºå®šçš„port111ã€2049å¤–ï¼Œè¿˜æœ‰å…¶ä»–æœåŠ¡å¦‚rpc.mountedç­‰å¼€å¯çš„ä¸å›ºå®šçš„ç«¯å£ï¼Œè¿™æ ·å¯¹é˜²ç«å¢™æ¥è¯´å°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®NFSæœåŠ¡çš„ç«¯å£é…ç½®æ–‡ä»¶ã€‚</p><h4 id="4-1ã€ä¿®æ”¹-x2F-etc-x2F-sysconfig-x2F-nfsæ–‡ä»¶ï¼Œå°†ä¸‹åˆ—å†…å®¹çš„æ³¨é‡Šå»æ‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ·»åŠ ï¼š"><a href="#4-1ã€ä¿®æ”¹-x2F-etc-x2F-sysconfig-x2F-nfsæ–‡ä»¶ï¼Œå°†ä¸‹åˆ—å†…å®¹çš„æ³¨é‡Šå»æ‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ·»åŠ ï¼š" class="headerlink" title="4.1ã€ä¿®æ”¹&#x2F;etc&#x2F;sysconfig&#x2F;nfsæ–‡ä»¶ï¼Œå°†ä¸‹åˆ—å†…å®¹çš„æ³¨é‡Šå»æ‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ·»åŠ ï¼š"></a>4.1ã€ä¿®æ”¹&#x2F;etc&#x2F;sysconfig&#x2F;nfsæ–‡ä»¶ï¼Œå°†ä¸‹åˆ—å†…å®¹çš„æ³¨é‡Šå»æ‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ·»åŠ ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/sysconfig/nfs<br><br>RQUOTAD_PORT=1001<br>LOCKD_TCPPORT=30001<br>LOCKD_UDPPORT=30002<br>MOUNTD_PORT=1002<br></code></pre></td></tr></table></figure><h4 id="4-2ã€ä¿å­˜å¥½åï¼Œå°†ç«¯å£åŠ å…¥åˆ°é˜²ç«å¢™å…è®¸ç­–ç•¥ä¸­ã€‚æ‰§è¡Œï¼š"><a href="#4-2ã€ä¿å­˜å¥½åï¼Œå°†ç«¯å£åŠ å…¥åˆ°é˜²ç«å¢™å…è®¸ç­–ç•¥ä¸­ã€‚æ‰§è¡Œï¼š" class="headerlink" title="4.2ã€ä¿å­˜å¥½åï¼Œå°†ç«¯å£åŠ å…¥åˆ°é˜²ç«å¢™å…è®¸ç­–ç•¥ä¸­ã€‚æ‰§è¡Œï¼š"></a>4.2ã€ä¿å­˜å¥½åï¼Œå°†ç«¯å£åŠ å…¥åˆ°é˜²ç«å¢™å…è®¸ç­–ç•¥ä¸­ã€‚æ‰§è¡Œï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">firewall-cmd --zone=public --add-port=111/tcp --add-port=111/udp --add-port=2049/tcp --add-port=2049/udp --add-port=1001/tcp --add-port=1001/udp --add-port=1002/tcp --add-port=1002/udp --add-port=30001/tcp --add-port=30002/udp --permanent<br>firewall-cmd --reload<br></code></pre></td></tr></table></figure><h3 id="5-å¯åŠ¨æœåŠ¡"><a href="#5-å¯åŠ¨æœåŠ¡" class="headerlink" title="5.å¯åŠ¨æœåŠ¡"></a>5.å¯åŠ¨æœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start rpcbind<br>systemctl start nfs<br>åŠ å…¥å¼€æœºå¯åŠ¨ï¼š<br>systemctl <span class="hljs-built_in">enable</span> rpcbind <br>systemctl <span class="hljs-built_in">enable</span> nfs<br></code></pre></td></tr></table></figure><p><strong>nfsæœåŠ¡å¯åŠ¨åï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>rpcinfo -p</code> æŸ¥çœ‹ç«¯å£æ˜¯å¦ç”Ÿæ•ˆã€‚</strong></p><p>æœåŠ¡å¯åŠ¨åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ showmount å‘½ä»¤æ¥æŸ¥çœ‹æ˜¯å¦å¯è¿æ¥ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@localhost ~]<span class="hljs-comment"># showmount -e localhost</span><br>Export list <span class="hljs-keyword">for</span> localhost:<br>/data/share 192.168.183.89<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€å®¢æˆ·ç«¯æŒ‚è½½é…ç½®"><a href="#ä¸‰ã€å®¢æˆ·ç«¯æŒ‚è½½é…ç½®" class="headerlink" title="ä¸‰ã€å®¢æˆ·ç«¯æŒ‚è½½é…ç½®"></a>ä¸‰ã€å®¢æˆ·ç«¯æŒ‚è½½é…ç½®</h2><h3 id="1-æŒ‚è½½è¿œç¨‹nfsæ–‡ä»¶ç³»ç»Ÿ-æŸ¥çœ‹æœåŠ¡ç«¯å·²å…±äº«çš„ç›®å½•"><a href="#1-æŒ‚è½½è¿œç¨‹nfsæ–‡ä»¶ç³»ç»Ÿ-æŸ¥çœ‹æœåŠ¡ç«¯å·²å…±äº«çš„ç›®å½•" class="headerlink" title="1.æŒ‚è½½è¿œç¨‹nfsæ–‡ä»¶ç³»ç»Ÿ,æŸ¥çœ‹æœåŠ¡ç«¯å·²å…±äº«çš„ç›®å½•:"></a>1.æŒ‚è½½è¿œç¨‹nfsæ–‡ä»¶ç³»ç»Ÿ,æŸ¥çœ‹æœåŠ¡ç«¯å·²å…±äº«çš„ç›®å½•:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@master ~]<span class="hljs-comment"># showmount -e 192.168.183.88</span><br>Export list <span class="hljs-keyword">for</span> 192.168.183.88:<br>/data/share 192.168.183.89<br></code></pre></td></tr></table></figure><h3 id="2-å»ºç«‹æŒ‚è½½ç›®å½•ï¼Œæ‰§è¡ŒæŒ‚è½½å‘½ä»¤ï¼š"><a href="#2-å»ºç«‹æŒ‚è½½ç›®å½•ï¼Œæ‰§è¡ŒæŒ‚è½½å‘½ä»¤ï¼š" class="headerlink" title="2.å»ºç«‹æŒ‚è½½ç›®å½•ï¼Œæ‰§è¡ŒæŒ‚è½½å‘½ä»¤ï¼š"></a>2.å»ºç«‹æŒ‚è½½ç›®å½•ï¼Œæ‰§è¡ŒæŒ‚è½½å‘½ä»¤ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /mnt/share<br>mount -t nfs 192.168.183.89:/data/share /mnt/share/ -o nolock,nfsvers=3,vers=3<br><br>å¦‚æœè¦è§£é™¤æŒ‚è½½ï¼Œå¯æ‰§è¡Œå‘½ä»¤ï¼š<br>umount /mnt/share<br><br><span class="hljs-comment">#å¼€æœºè‡ªåŠ¨æŒ‚è½½ :</span><br>[root@localhost ~]<span class="hljs-comment"># vim /etc/rc.d/rc.local</span><br><span class="hljs-comment">#åœ¨æ–‡ä»¶æœ€åæ·»åŠ ä¸€è¡Œï¼š</span><br>mount -t nfs 192.168.183.89:/data/share /mnt/share/ -o nolock,nfsvers=3,vers=3<br></code></pre></td></tr></table></figure><h3 id="3-æŸ¥çœ‹æŒ‚è½½ç»“æœï¼Œåœ¨å®¢æˆ·ç«¯è¾“å…¥-df-h"><a href="#3-æŸ¥çœ‹æŒ‚è½½ç»“æœï¼Œåœ¨å®¢æˆ·ç«¯è¾“å…¥-df-h" class="headerlink" title="3.æŸ¥çœ‹æŒ‚è½½ç»“æœï¼Œåœ¨å®¢æˆ·ç«¯è¾“å…¥ df -h"></a>3.æŸ¥çœ‹æŒ‚è½½ç»“æœï¼Œåœ¨å®¢æˆ·ç«¯è¾“å…¥ <code>df -h</code></h3><p>è¾“å‡ºå¦‚ä¸‹å†…å®¹å³ä»£è¡¨æˆåŠŸï¼š<br><code>192.168.183.88:/data/share   46G  5.0G   41G   11% /mnt/share</code></p>]]></content>
    
    
    <categories>
      
      <category>æœåŠ¡</category>
      
      <category>NFSæ–‡ä»¶å…±äº«å­˜å‚¨æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NFSæ–‡ä»¶å…±äº«å­˜å‚¨æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Tomcatçš„å®‰è£…å’Œé…ç½®</title>
    <link href="/2023/04/11/%E4%B8%AD%E9%97%B4%E4%BB%B6/Tomcat/%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/"/>
    <url>/2023/04/11/%E4%B8%AD%E9%97%B4%E4%BB%B6/Tomcat/%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Tomcatçš„å®‰è£…å’Œé…ç½®"><a href="#Tomcatçš„å®‰è£…å’Œé…ç½®" class="headerlink" title="Tomcatçš„å®‰è£…å’Œé…ç½®"></a>Tomcatçš„å®‰è£…å’Œé…ç½®</h1><h2 id="ä¸€ã€tomcatçš„å®‰è£…"><a href="#ä¸€ã€tomcatçš„å®‰è£…" class="headerlink" title="ä¸€ã€tomcatçš„å®‰è£…"></a>ä¸€ã€tomcatçš„å®‰è£…</h2><h3 id="1ã€é…ç½®Javaç¯å¢ƒ"><a href="#1ã€é…ç½®Javaç¯å¢ƒ" class="headerlink" title="1ã€é…ç½®Javaç¯å¢ƒ"></a>1ã€é…ç½®Javaç¯å¢ƒ</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">å®˜ç½‘ä¸‹è½½åœ°å€ï¼š<br>https://www.oracle.com/java/technologies/javase-downloads.htmlï¼›<br>https://www.oracle.com/java/technologies/downloads/#java8<br></code></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼šjavaç‰ˆæœ¬ä¸ä½äº6</p><h3 id="2ã€ä¸‹è½½jdkæ–‡ä»¶"><a href="#2ã€ä¸‹è½½jdkæ–‡ä»¶" class="headerlink" title="2ã€ä¸‹è½½jdkæ–‡ä»¶"></a>2ã€ä¸‹è½½jdkæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget --no-check-certificate --no-cookies --header <span class="hljs-string">&quot;Cookie: oraclelicense=accept-securebackup-cookie&quot;</span> http://download.oracle.com/otn-pub/java/jdk/8u131-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk-8u131-linux-x64.tar.gz<br></code></pre></td></tr></table></figure><h3 id="3ã€è§£å‹åˆ°-x2F-usr-x2F-localç›®å½•ä¸‹"><a href="#3ã€è§£å‹åˆ°-x2F-usr-x2F-localç›®å½•ä¸‹" class="headerlink" title="3ã€è§£å‹åˆ°&#x2F;usr&#x2F;localç›®å½•ä¸‹"></a>3ã€è§£å‹åˆ°&#x2F;usr&#x2F;localç›®å½•ä¸‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar zxvf jdk-7u51-linux-x64.tar.gz -C /usr/local/<br></code></pre></td></tr></table></figure><h3 id="4ã€é…ç½®ç¯å¢ƒå˜é‡çš„é…ç½®æ–‡ä»¶"><a href="#4ã€é…ç½®ç¯å¢ƒå˜é‡çš„é…ç½®æ–‡ä»¶" class="headerlink" title="4ã€é…ç½®ç¯å¢ƒå˜é‡çš„é…ç½®æ–‡ä»¶"></a>4ã€é…ç½®ç¯å¢ƒå˜é‡çš„é…ç½®æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/profile &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">JAVA_HOME=/usr/local/jdk1.7.0_51  #æ–‡ä»¶å</span><br><span class="hljs-string">PATH=$PATH:$JAVA_HOME/bin</span><br><span class="hljs-string">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="hljs-string">export JAVA_HOME PATH CLASSPATH</span><br><span class="hljs-string">EOF</span><br><br><br><span class="hljs-comment">#ä½¿è®¾ç½®ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> /etc/profile<br><br><span class="hljs-comment">#éªŒè¯</span><br>java  -version<br></code></pre></td></tr></table></figure><h2 id="5ã€tomcatå®‰è£…"><a href="#5ã€tomcatå®‰è£…" class="headerlink" title="5ã€tomcatå®‰è£…"></a>5ã€tomcatå®‰è£…</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://tomcat.apache.org/download-80.cgi">https://tomcat.apache.org/download-80.cgi</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://dlcdn.apache.org/tomcat/tomcat-8/v8.5.83/bin/apache-tomcat-8.5.83.tar.gz --no-check-certificate<br><br>tar -xnf apache-tomcat-8.5.83.tar.gz<br><br><span class="hljs-built_in">mv</span> apache-tomcat-8.5.83 /usr/local/tomcat<br><br></code></pre></td></tr></table></figure><p><strong>è®¾ç½®è‡ªå®šä¹‰JDKè·¯å¾„(åœ¨æŸäº›è°ƒç”¨æˆ–è€…è¿œç¨‹æœåŠ¡å™¨æ—¶ï¼Œæç¤ºæ²¡æœ‰java_homeæ—¶éœ€è¦è®¾ç½®ï¼Œå®‰è£…æ—¶å¯è·³è¿‡æ­¤æ­¥éª¤)</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /usr/local/tomcat/bin/setclasspath.sh<br><span class="hljs-comment"># -----------------------------------------------------------------------------</span><br><span class="hljs-comment">#  Set JAVA_HOME or JRE_HOME if not already set, ensure any provided settings</span><br><span class="hljs-comment">#  are valid and consistent with the selected start-up options and set up the</span><br><span class="hljs-comment">#  endorsed directory.</span><br><span class="hljs-comment"># -----------------------------------------------------------------------------</span><br><span class="hljs-comment"># æ·»åŠ JAVA_HOMEå’ŒJRE_HOMEä¸¤ä¸ªç¯å¢ƒå˜é‡</span><br><span class="hljs-built_in">export</span> JAVA_HOME=/usr/local/jdk1.7.0_51<br><span class="hljs-built_in">export</span> JRE_HOME=/usr/local/jdk1.7.0_51<br><span class="hljs-comment"># Make sure prerequisite environment variables are set</span><br><span class="hljs-comment"># ......çœç•¥......</span><br><br><span class="hljs-comment">#startup.shå¯åŠ¨</span><br>/usr/local/tomcat/bin/startup.sh<br><br><span class="hljs-comment">#shutdown.shå…³é—­</span><br>/usr/local/tomcat/bin/shutdown.sh <br></code></pre></td></tr></table></figure><h2 id="äºŒã€tomcatçš„ä½¿ç”¨ï¼š"><a href="#äºŒã€tomcatçš„ä½¿ç”¨ï¼š" class="headerlink" title="äºŒã€tomcatçš„ä½¿ç”¨ï¼š"></a>äºŒã€tomcatçš„ä½¿ç”¨ï¼š</h2><h3 id="1ã€ä¿®æ”¹ç«¯å£"><a href="#1ã€ä¿®æ”¹ç«¯å£" class="headerlink" title="1ã€ä¿®æ”¹ç«¯å£"></a>1ã€ä¿®æ”¹ç«¯å£</h3><p>é»˜è®¤æ˜¯å¯ç”¨çš„8080ç«¯å£ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹ï¼Œæ‰¾åˆ°tomcatç›®å½•&#x2F;conf&#x2F;server.xml</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /usr/local/tomcat/conf/server.xml<br><br>ä¿®æ”¹port=<span class="hljs-string">&quot;8080&quot;</span>ï¼Œå°†portç«¯å£çš„å€¼ä¿®æ”¹ä¸º80æˆ–è€…å…¶ä»–å®šä¹‰çš„ç«¯å£<br></code></pre></td></tr></table></figure><h3 id="2ã€éƒ¨ç½²html"><a href="#2ã€éƒ¨ç½²html" class="headerlink" title="2ã€éƒ¨ç½²html"></a>2ã€éƒ¨ç½²html</h3><p>æŠŠæˆ‘ä»¬è‡ªå·±ä¹¦å†™çš„htmlï¼Œservletè¿™äº›ä¿¡æ¯ï¼Œéƒ¨ç½²åˆ°tomcatçš„æ–¹å¼</p><p>è‡ªå®šä¹‰é¡¹ç›®å­˜æ”¾è·¯å¾„:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /usr/local/tomcat/conf/server.xml<br><br>&lt;Host name=<span class="hljs-string">&quot;localhost&quot;</span>  appBase=<span class="hljs-string">&quot;webapps&quot;</span> unpackWARs=<span class="hljs-string">&quot;true&quot;</span> autoDeploy=<span class="hljs-string">&quot;true&quot;</span>&gt;<br><span class="hljs-comment">#åœ¨è¯¥å¥åé¢æ·»åŠ ï¼ŒdocBaseåé¢ä¸ºè‡ªå®šä¹‰çš„è·¯å¾„</span><br>&lt;Context path=<span class="hljs-string">&quot;&quot;</span> docBase=<span class="hljs-string">&quot;/app/html/www&quot;</span> debug=<span class="hljs-string">&quot;0&quot;</span> reloadable=<span class="hljs-string">&quot;true&quot;</span> crossContext=<span class="hljs-string">&quot;true&quot;</span> /&gt; <br><br><span class="hljs-comment">#ç„¶åé‡å¯Tomcat</span><br>/usr/local/tomcat/bin/shutdown.sh <br>/usr/local/tomcat/bin/startup.sh<br><br><span class="hljs-comment">#ä½¿ç”¨è‡ªå¸¦çš„å­˜æ”¾è·¯å¾„:</span><br><span class="hljs-built_in">cd</span> /usr/local/tomcat/webapps/ROOT<br><span class="hljs-comment">#å°†é¡¹ç›®æ–‡ä»¶æ”¾åˆ°è¯¥ç›®å½•ä¸‹å³å¯ï¼Œæ³¨æ„Tomcatè·¯å¾„ï¼</span><br></code></pre></td></tr></table></figure><h3 id="3ã€tomcatè®¾ç½®æˆæœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€å¯è‡ªå¯åŠ¨"><a href="#3ã€tomcatè®¾ç½®æˆæœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€å¯è‡ªå¯åŠ¨" class="headerlink" title="3ã€tomcatè®¾ç½®æˆæœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€å¯è‡ªå¯åŠ¨"></a>3ã€tomcatè®¾ç½®æˆæœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€å¯è‡ªå¯åŠ¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#Tomcaté…ç½®æœåŠ¡ã€æ–°å»ºæœåŠ¡è„šæœ¬ï¼š</span><br>vim /etc/init.d/tomcat<br><span class="hljs-comment">#!/bin/bash</span><br>CATALINA_HOME=/usr/local/tomcat/<br><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span><br>        start)<br>                sh <span class="hljs-variable">$CATALINA_HOME</span>/bin/startup.sh<br>                ;;<br>        stop)<br>                sh <span class="hljs-variable">$CATALINA_HOME</span>/bin/shutdown.sh<br>                ;;<br>        restart)<br>                sh <span class="hljs-variable">$CATALINA_HOME</span>/bin/shutdown.sh<br>                sh <span class="hljs-variable">$CATALINA_HOME</span>/bin/startup.sh<br>                ;;<br>        *)<br>                <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;please use : tomcat &#123;start | stop | restart&#125;&#x27;</span><br>        ;;<br><span class="hljs-keyword">esac</span><br><span class="hljs-built_in">exit</span> 0<br><br><span class="hljs-comment">#ä¿å­˜åï¼Œå¯ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ï¼Œæš‚åœã€é‡å¯tomcat</span><br>å¯åŠ¨ï¼šservice tomcat start<br>åœæ­¢ï¼šservice tomcat stop<br>é‡å¯ï¼šservice tomcat restart<br><br><span class="hljs-comment">#Tomcaté…ç½®å¼€æœºè‡ªå¯åŠ¨ï¼š</span><br>chkconfig --add tomcat <span class="hljs-comment">#å‘chkconfigæ·»åŠ  tomcat æœåŠ¡çš„ç®¡ç†</span><br>chkconfig tomcat on <span class="hljs-comment">#è®¾ç½®tomcatæœåŠ¡è‡ªå¯åŠ¨</span><br><br><span class="hljs-comment">#å…¶ä»–é…ç½®</span><br>chkconfig --list | grep tomcat <span class="hljs-comment">#æŸ¥çœ‹tomcatçš„å¯åŠ¨çŠ¶æ€</span><br>chkconfig tomcat off <span class="hljs-comment">#å…³é—­tomcatæœåŠ¡è‡ªå¯åŠ¨</span><br>chkconfig --del tomcat <span class="hljs-comment">#åˆ é™¤tomcatæœåŠ¡åœ¨chkconfigä¸Šçš„ç®¡ç†</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Tomcat</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tomcat</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨dockerè¿è¡Œnpsã€å®ç°å†…ç½‘ç©¿é€</title>
    <link href="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"/>
    <url>/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨dockerè¿è¡Œnpsã€å®ç°å†…ç½‘ç©¿é€"><a href="#ä½¿ç”¨dockerè¿è¡Œnpsã€å®ç°å†…ç½‘ç©¿é€" class="headerlink" title="ä½¿ç”¨dockerè¿è¡Œnpsã€å®ç°å†…ç½‘ç©¿é€"></a>ä½¿ç”¨dockerè¿è¡Œnpsã€å®ç°å†…ç½‘ç©¿é€</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">npså®˜æ–¹æ–‡æ¡£åœ°å€ï¼šhttps://ehang-io.github.io/nps/#/use<br>å‚è€ƒæ–‡æ¡£ï¼šhttps://langeheris.top/2020/03/28/Intranet-penetration/#%E4%BB%80%E4%B9%88%E6%98%AF%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%EF%BC%9F<br></code></pre></td></tr></table></figure><p>ç”¨Centos7ç¯å¢ƒè¿›è¡Œçš„ç›¸å…³æ­å»ºï¼š</p><table><thead><tr><th>æœºå™¨åç§°</th><th>æœºå™¨ip</th><th>å®‰è£…æœåŠ¡</th></tr></thead><tbody><tr><td>å…¬ç½‘æœºå™¨</td><td>192.168.94.156</td><td>å®‰è£…æœåŠ¡ç«¯ï¼ˆnps.serverï¼‰</td></tr><tr><td>å†…ç½‘æœºå™¨</td><td>192.168.94.154</td><td>å®‰è£…å®¢æˆ·ç«¯ï¼ˆnpc.clientï¼‰</td></tr></tbody></table><h2 id="ä¸€ã€åœ¨å…¬ç½‘æœºå™¨ä¸Šæ“ä½œ-gt-gt-å®‰è£…npsæœåŠ¡ç«¯ï¼š"><a href="#ä¸€ã€åœ¨å…¬ç½‘æœºå™¨ä¸Šæ“ä½œ-gt-gt-å®‰è£…npsæœåŠ¡ç«¯ï¼š" class="headerlink" title="ä¸€ã€åœ¨å…¬ç½‘æœºå™¨ä¸Šæ“ä½œ &gt;&gt; å®‰è£…npsæœåŠ¡ç«¯ï¼š"></a>ä¸€ã€åœ¨å…¬ç½‘æœºå™¨ä¸Šæ“ä½œ &gt;&gt; å®‰è£…npsæœåŠ¡ç«¯ï¼š</h2><h3 id="1ã€æ‹‰å–npsé•œåƒ"><a href="#1ã€æ‹‰å–npsé•œåƒ" class="headerlink" title="1ã€æ‹‰å–npsé•œåƒ"></a>1ã€æ‹‰å–npsé•œåƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull ffdfgdfg/nps<br></code></pre></td></tr></table></figure><h3 id="2ã€åˆ›å»ºæŒ‚è½½ç›®å½•ã€å¹¶è¿›å…¥åˆ°æŒ‚è½½ç›®å½•"><a href="#2ã€åˆ›å»ºæŒ‚è½½ç›®å½•ã€å¹¶è¿›å…¥åˆ°æŒ‚è½½ç›®å½•" class="headerlink" title="2ã€åˆ›å»ºæŒ‚è½½ç›®å½•ã€å¹¶è¿›å…¥åˆ°æŒ‚è½½ç›®å½•"></a>2ã€åˆ›å»ºæŒ‚è½½ç›®å½•ã€å¹¶è¿›å…¥åˆ°æŒ‚è½½ç›®å½•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /app  &amp;&amp;  <span class="hljs-built_in">cd</span> /app<br></code></pre></td></tr></table></figure><h3 id="3ã€ä»githubä¸Šæ‹‰å–confæ–‡ä»¶ä¿¡æ¯"><a href="#3ã€ä»githubä¸Šæ‹‰å–confæ–‡ä»¶ä¿¡æ¯" class="headerlink" title="3ã€ä»githubä¸Šæ‹‰å–confæ–‡ä»¶ä¿¡æ¯"></a>3ã€ä»githubä¸Šæ‹‰å–confæ–‡ä»¶ä¿¡æ¯</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y git  <span class="hljs-comment">#å®‰è£…git</span><br>git <span class="hljs-built_in">clone</span> https://gitee.com/mirrors/nps.git<br></code></pre></td></tr></table></figure><p>æ³¨ï¼šcloneæˆåŠŸåä¼šcloneä¸€ä¸ªnpsç›®å½•åˆ°å½“å‰ç›®å½•ä¸‹</p><h3 id="4ã€è¿›å…¥cloneä¸‹æ¥çš„npsçš„confç›®å½•ï¼Œå¯æ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹nps-confæ–‡ä»¶ï¼š"><a href="#4ã€è¿›å…¥cloneä¸‹æ¥çš„npsçš„confç›®å½•ï¼Œå¯æ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹nps-confæ–‡ä»¶ï¼š" class="headerlink" title="4ã€è¿›å…¥cloneä¸‹æ¥çš„npsçš„confç›®å½•ï¼Œå¯æ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹nps.confæ–‡ä»¶ï¼š"></a>4ã€è¿›å…¥cloneä¸‹æ¥çš„npsçš„confç›®å½•ï¼Œå¯æ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹nps.confæ–‡ä»¶ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> /app/nps/conf/nps.conf | grep web_port<br><span class="hljs-comment">#web_port = 3000      #npsçš„webé¡µé¢ç«¯å£</span><br><br><span class="hljs-built_in">cat</span> /app/nps/conf/nps.conf | grep username<br><span class="hljs-comment">#web_username=admin   #ç™»å½•npsçš„è´¦å·</span><br><br><span class="hljs-built_in">cat</span> /app/nps/conf/nps.conf | grep password<br><span class="hljs-comment">#web_password=123456  #ç™»å½•npsçš„å¯†ç </span><br><br><span class="hljs-built_in">cat</span> /app/nps/conf/nps.conf |grep bridge_port<br><span class="hljs-comment">#bridge_port=3002     #å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯çš„ç«¯å£</span><br></code></pre></td></tr></table></figure><p>æ³¨ï¼šä»¥ä¸Šçš„portéœ€è¦åœ¨dockerè¿è¡Œæ—¶è®¾å®šçš„ç«¯å£èŒƒå›´å†…ï¼</p><h3 id="5ã€è¿è¡ŒnpsæœåŠ¡ï¼Œè®¾ç½®ç«¯å£"><a href="#5ã€è¿è¡ŒnpsæœåŠ¡ï¼Œè®¾ç½®ç«¯å£" class="headerlink" title="5ã€è¿è¡ŒnpsæœåŠ¡ï¼Œè®¾ç½®ç«¯å£"></a>5ã€è¿è¡ŒnpsæœåŠ¡ï¼Œè®¾ç½®ç«¯å£</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d -p 3000-3010:3000-3010 -v /app/nps/conf:/conf --name=nps ffdfgdfg/nps<br></code></pre></td></tr></table></figure><p>æ³¨ï¼šå¯-p:è®¾å®šçš„ç«¯å£ï¼Œéœ€ç¡®ä¿èŒƒå›´å†…çš„ç«¯å£æ²¡æœ‰è¢«å ç”¨ï¼</p><h3 id="6ã€è¿è¡Œåå¯ä»¥é€šè¿‡æœ¬æœºip-ç«¯å£è®¿é—®ï¼Œå¹¶è¾“å…¥è´¦å·å’Œå¯†ç ç™»å½•"><a href="#6ã€è¿è¡Œåå¯ä»¥é€šè¿‡æœ¬æœºip-ç«¯å£è®¿é—®ï¼Œå¹¶è¾“å…¥è´¦å·å’Œå¯†ç ç™»å½•" class="headerlink" title="6ã€è¿è¡Œåå¯ä»¥é€šè¿‡æœ¬æœºip+ç«¯å£è®¿é—®ï¼Œå¹¶è¾“å…¥è´¦å·å’Œå¯†ç ç™»å½•"></a>6ã€è¿è¡Œåå¯ä»¥é€šè¿‡æœ¬æœºip+ç«¯å£è®¿é—®ï¼Œå¹¶è¾“å…¥è´¦å·å’Œå¯†ç ç™»å½•</h3><p><strong>æˆ‘è¿™è¾¹è®¿é—®webé¡µé¢åœ°å€ï¼š192.168.94.156:3000  ç™»å½•è´¦å·ï¼šadmin å¯†ç ï¼š123456</strong></p><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127103435729.png" alt="image-20220127103435729"></p><h2 id="äºŒã€åœ¨å†…ç½‘æœºå™¨ä¸Šæ“ä½œ-gt-gt-å®‰è£…npcå®¢æˆ·ç«¯ï¼š"><a href="#äºŒã€åœ¨å†…ç½‘æœºå™¨ä¸Šæ“ä½œ-gt-gt-å®‰è£…npcå®¢æˆ·ç«¯ï¼š" class="headerlink" title="äºŒã€åœ¨å†…ç½‘æœºå™¨ä¸Šæ“ä½œ  &gt;&gt;  å®‰è£…npcå®¢æˆ·ç«¯ï¼š"></a>äºŒã€åœ¨å†…ç½‘æœºå™¨ä¸Šæ“ä½œ  &gt;&gt;  å®‰è£…npcå®¢æˆ·ç«¯ï¼š</h2><h3 id="1ã€ä¸‹è½½æºç åŒ…ï¼š"><a href="#1ã€ä¸‹è½½æºç åŒ…ï¼š" class="headerlink" title="1ã€ä¸‹è½½æºç åŒ…ï¼š"></a>1ã€ä¸‹è½½æºç åŒ…ï¼š</h3><p>æºç åŒ…åœ°å€ï¼š<a href="https://github.com/ehang-io/nps/releases/tags%EF%BC%8C%E7%82%B9%E5%87%BB%E7%9B%B8%E5%BA%94%E7%9A%84%E7%89%88%E6%9C%AC%E5%90%8E%E8%BF%9B%E5%85%A5%E8%AF%A6%E6%83%85%EF%BC%8C%E5%9C%A8Assets%E4%B8%AD%E6%89%BE%E5%88%B0client.tar.gz">https://github.com/ehang-io/nps/releases/tagsï¼Œç‚¹å‡»ç›¸åº”çš„ç‰ˆæœ¬åè¿›å…¥è¯¦æƒ…ï¼Œåœ¨Assetsä¸­æ‰¾åˆ°client.tar.gz</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://github.com/ehang-io/nps/releases/download/v0.26.9/linux_amd64_client.tar.gz<br></code></pre></td></tr></table></figure><h3 id="2ã€æ–°å»ºå·¥ä½œç›®å½•å¹¶è§£å‹æºç åŒ…åˆ°å·¥ä½œç›®å½•ä¸‹ï¼š"><a href="#2ã€æ–°å»ºå·¥ä½œç›®å½•å¹¶è§£å‹æºç åŒ…åˆ°å·¥ä½œç›®å½•ä¸‹ï¼š" class="headerlink" title="2ã€æ–°å»ºå·¥ä½œç›®å½•å¹¶è§£å‹æºç åŒ…åˆ°å·¥ä½œç›®å½•ä¸‹ï¼š"></a>2ã€æ–°å»ºå·¥ä½œç›®å½•å¹¶è§£å‹æºç åŒ…åˆ°å·¥ä½œç›®å½•ä¸‹ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /app/docker-npc &amp;&amp; tar -xnf linux_amd64_client.tar.gz -C /app/docker-npc<br></code></pre></td></tr></table></figure><p>æ³¨ï¼šè§£å‹ååœ¨&#x2F;app&#x2F;docker-npcç›®å½•ä¸‹æ‰¾åˆ°å¯æ‰§è¡Œçš„npcæ–‡ä»¶ï¼</p><p>##éœ€è¦ä½¿ç”¨dockeré•œåƒçš„æ–¹å¼è¿è¡Œnpcå®¢æˆ·ç«¯æ—¶è¯·æ‰§è¡Œæ­¥éª¤ â€œ3â€ï¼Œå¦‚æœä¸éœ€è¦ç”¨dokcerè¿è¡Œï¼Œè¯·è·³è¿‡æ­¥éª¤â€œ3â€ï¼</p><hr><h2 id="3ã€ä½¿ç”¨dockerç¼–è¯‘npcé•œåƒï¼š"><a href="#3ã€ä½¿ç”¨dockerç¼–è¯‘npcé•œåƒï¼š" class="headerlink" title="3ã€ä½¿ç”¨dockerç¼–è¯‘npcé•œåƒï¼š"></a>3ã€ä½¿ç”¨dockerç¼–è¯‘npcé•œåƒï¼š</h2><h3 id="3-1ã€ç¼–å†™dockerfileæ–‡ä»¶"><a href="#3-1ã€ç¼–å†™dockerfileæ–‡ä»¶" class="headerlink" title="3.1ã€ç¼–å†™dockerfileæ–‡ä»¶"></a>3.1ã€ç¼–å†™dockerfileæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /app/docker-npc/Dockerfile &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">FROM alpine:latest</span><br><span class="hljs-string">ENV LANG en_US.UTF-8</span><br><span class="hljs-string">ENV npserver=nps.thingsroot.com:7088 npckey=accesskey</span><br><span class="hljs-string">COPY ./npc /usr/bin/npc</span><br><span class="hljs-string">CMD /usr/bin/npc -server=\$npserver -vkey=\$npckey</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h3 id="3-2ã€æ„å»ºé•œåƒ"><a href="#3-2ã€æ„å»ºé•œåƒ" class="headerlink" title="3.2ã€æ„å»ºé•œåƒ"></a>3.2ã€æ„å»ºé•œåƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker build -t docker-npc /app/docker-npc/<br></code></pre></td></tr></table></figure><h3 id="3-3ã€è¿è¡Œé•œåƒ"><a href="#3-3ã€è¿è¡Œé•œåƒ" class="headerlink" title="3.3ã€è¿è¡Œé•œåƒ"></a>3.3ã€è¿è¡Œé•œåƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -td --restart always --name npc --network host docker-npc<br></code></pre></td></tr></table></figure><p>æ³¨ï¼šâ€“network host ï¼šè¿è¡Œçš„é•œåƒä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œ</p><hr><h2 id="ä¸‰ã€å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥ï¼ˆå†…ç½‘ä¸å¤–ç½‘æœºå™¨è¿æ¥ï¼‰"><a href="#ä¸‰ã€å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥ï¼ˆå†…ç½‘ä¸å¤–ç½‘æœºå™¨è¿æ¥ï¼‰" class="headerlink" title="ä¸‰ã€å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥ï¼ˆå†…ç½‘ä¸å¤–ç½‘æœºå™¨è¿æ¥ï¼‰"></a>ä¸‰ã€å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥ï¼ˆå†…ç½‘ä¸å¤–ç½‘æœºå™¨è¿æ¥ï¼‰</h2><h3 id="1ã€è¿æ¥æœåŠ¡ç«¯webé¡µé¢åï¼Œç‚¹å‡»å®¢æˆ·ç«¯-gt-gt-æ–°å¢"><a href="#1ã€è¿æ¥æœåŠ¡ç«¯webé¡µé¢åï¼Œç‚¹å‡»å®¢æˆ·ç«¯-gt-gt-æ–°å¢" class="headerlink" title="1ã€è¿æ¥æœåŠ¡ç«¯webé¡µé¢åï¼Œç‚¹å‡»å®¢æˆ·ç«¯ &gt;&gt; æ–°å¢"></a>1ã€è¿æ¥æœåŠ¡ç«¯webé¡µé¢åï¼Œç‚¹å‡»å®¢æˆ·ç«¯ &gt;&gt; æ–°å¢</h3><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127103504265.png" alt="image-20220127103504265"></p><h3 id="2ã€å¡«å†™æ–°å¢çš„å®¢æˆ·ç«¯ä¿¡æ¯å-gt-gt-æ ¹æ®å®é™…éœ€è¦å¡«å†™ä¿¡æ¯-gt-gt-æ–°å¢"><a href="#2ã€å¡«å†™æ–°å¢çš„å®¢æˆ·ç«¯ä¿¡æ¯å-gt-gt-æ ¹æ®å®é™…éœ€è¦å¡«å†™ä¿¡æ¯-gt-gt-æ–°å¢" class="headerlink" title="2ã€å¡«å†™æ–°å¢çš„å®¢æˆ·ç«¯ä¿¡æ¯å &gt;&gt; æ ¹æ®å®é™…éœ€è¦å¡«å†™ä¿¡æ¯ &gt;&gt; æ–°å¢"></a>2ã€å¡«å†™æ–°å¢çš„å®¢æˆ·ç«¯ä¿¡æ¯å &gt;&gt; æ ¹æ®å®é™…éœ€è¦å¡«å†™ä¿¡æ¯ &gt;&gt; æ–°å¢</h3><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127105150833.png" alt="image-20220127105150833"></p><h3 id="3ã€åœ¨å®¢æˆ·ç«¯å¯çœ‹åˆ°æ–°å¢çš„IDæ—æœ‰ä¸ªâ€œ-â€çš„ç¬¦å·-gt-gt-ç‚¹å‡»â€œ-â€-å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯å‘½ä»¤"><a href="#3ã€åœ¨å®¢æˆ·ç«¯å¯çœ‹åˆ°æ–°å¢çš„IDæ—æœ‰ä¸ªâ€œ-â€çš„ç¬¦å·-gt-gt-ç‚¹å‡»â€œ-â€-å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯å‘½ä»¤" class="headerlink" title="3ã€åœ¨å®¢æˆ·ç«¯å¯çœ‹åˆ°æ–°å¢çš„IDæ—æœ‰ä¸ªâ€œ+â€çš„ç¬¦å· &gt;&gt; ç‚¹å‡»â€œ+â€ å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯å‘½ä»¤"></a>3ã€åœ¨å®¢æˆ·ç«¯å¯çœ‹åˆ°æ–°å¢çš„IDæ—æœ‰ä¸ªâ€œ+â€çš„ç¬¦å· &gt;&gt; ç‚¹å‡»â€œ+â€ å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯å‘½ä»¤</h3><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127103547752.png" alt="image-20220127103547752"></p><h3 id="4ã€å°†å†…ç½‘æœºå™¨ä¸å¤–ç½‘æœºå™¨è¿æ¥ï¼š"><a href="#4ã€å°†å†…ç½‘æœºå™¨ä¸å¤–ç½‘æœºå™¨è¿æ¥ï¼š" class="headerlink" title="4ã€å°†å†…ç½‘æœºå™¨ä¸å¤–ç½‘æœºå™¨è¿æ¥ï¼š"></a>4ã€å°†å†…ç½‘æœºå™¨ä¸å¤–ç½‘æœºå™¨è¿æ¥ï¼š</h3><p>æŸ¥è¯¢åˆ°å®¢æˆ·ç«¯å‘½ä»¤ä¸ºï¼š<code>./npc -server=192.168.94.156:3002 -vkey=f0a1ssnpxkuxd3hs -type=tcp</code></p><h4 id="4-1ã€ä¸ä½¿ç”¨é•œåƒè¿è¡Œï¼Œç›´æ¥æºç è¿è¡Œæ—¶ï¼š"><a href="#4-1ã€ä¸ä½¿ç”¨é•œåƒè¿è¡Œï¼Œç›´æ¥æºç è¿è¡Œæ—¶ï¼š" class="headerlink" title="4.1ã€ä¸ä½¿ç”¨é•œåƒè¿è¡Œï¼Œç›´æ¥æºç è¿è¡Œæ—¶ï¼š"></a>4.1ã€ä¸ä½¿ç”¨é•œåƒè¿è¡Œï¼Œç›´æ¥æºç è¿è¡Œæ—¶ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">/app/docker-npc/npc -server=192.168.94.156:3002 -vkey=f0a1ssnpxkuxd3hs -<span class="hljs-built_in">type</span>=tcp &amp;<br></code></pre></td></tr></table></figure><p>æ³¨ï¼šåŠ  â€œ&amp;â€ä»£è¡¨åå°è¿è¡Œï¼Œå¦‚æœä¸éœ€è¦åå°è¿è¡Œï¼Œå¯å°†â€œ&amp;â€ç¬¦å·åˆ é™¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åå°è¿è¡Œå¯é€šè¿‡ ï¼šps -ef | grep npc æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦è¿è¡Œï¼</span><br></code></pre></td></tr></table></figure><h4 id="4-2ã€ä½¿ç”¨dockeré•œåƒè¿è¡Œæ—¶ï¼š"><a href="#4-2ã€ä½¿ç”¨dockeré•œåƒè¿è¡Œæ—¶ï¼š" class="headerlink" title="4.2ã€ä½¿ç”¨dockeré•œåƒè¿è¡Œæ—¶ï¼š"></a>4.2ã€ä½¿ç”¨dockeré•œåƒè¿è¡Œæ—¶ï¼š</h4><h5 id="4-2-1ã€è¿›å…¥åˆ°è¿è¡Œçš„å®¹å™¨å†…"><a href="#4-2-1ã€è¿›å…¥åˆ°è¿è¡Œçš„å®¹å™¨å†…" class="headerlink" title="4.2.1ã€è¿›å…¥åˆ°è¿è¡Œçš„å®¹å™¨å†…"></a>4.2.1ã€è¿›å…¥åˆ°è¿è¡Œçš„å®¹å™¨å†…</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker <span class="hljs-built_in">exec</span> -it npc sh<br></code></pre></td></tr></table></figure><h5 id="4-2-2ã€åœ¨å®¹å™¨å†…è¾“å…¥å¤åˆ¶çš„å®¢æˆ·ç«¯å‘½ä»¤"><a href="#4-2-2ã€åœ¨å®¹å™¨å†…è¾“å…¥å¤åˆ¶çš„å®¢æˆ·ç«¯å‘½ä»¤" class="headerlink" title="4.2.2ã€åœ¨å®¹å™¨å†…è¾“å…¥å¤åˆ¶çš„å®¢æˆ·ç«¯å‘½ä»¤"></a>4.2.2ã€åœ¨å®¹å™¨å†…è¾“å…¥å¤åˆ¶çš„å®¢æˆ·ç«¯å‘½ä»¤</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">npc -server=192.168.94.156:3002 -vkey=f0a1ssnpxkuxd3hs -<span class="hljs-built_in">type</span>=tcp &amp;<br></code></pre></td></tr></table></figure><h3 id="5ã€éªŒè¯æ˜¯å¦è¿æ¥æˆåŠŸï¼"><a href="#5ã€éªŒè¯æ˜¯å¦è¿æ¥æˆåŠŸï¼" class="headerlink" title="5ã€éªŒè¯æ˜¯å¦è¿æ¥æˆåŠŸï¼"></a>5ã€éªŒè¯æ˜¯å¦è¿æ¥æˆåŠŸï¼</h3><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127103608428.png" alt="image-20220127105104033"></p><p>æ³¨ï¼šæ˜¾ç¤ºä¸ºåœ¨çº¿å³è¡¨ç¤ºå·²ç»è¿æ¥æˆåŠŸï¼</p><h2 id="å››ã€å®ç°æŸäº›æ“ä½œ"><a href="#å››ã€å®ç°æŸäº›æ“ä½œ" class="headerlink" title="å››ã€å®ç°æŸäº›æ“ä½œ"></a>å››ã€å®ç°æŸäº›æ“ä½œ</h2><h3 id="1ã€å®ç°ï¼šé€šè¿‡è¿æ¥å…¬ç½‘æœåŠ¡å™¨ï¼ˆ192-168-94-156ï¼‰çš„3008ç«¯å£è¿œç¨‹è¿æ¥å†…ç½‘æœºå™¨ï¼ˆ192-168-94-154ï¼‰"><a href="#1ã€å®ç°ï¼šé€šè¿‡è¿æ¥å…¬ç½‘æœåŠ¡å™¨ï¼ˆ192-168-94-156ï¼‰çš„3008ç«¯å£è¿œç¨‹è¿æ¥å†…ç½‘æœºå™¨ï¼ˆ192-168-94-154ï¼‰" class="headerlink" title="1ã€å®ç°ï¼šé€šè¿‡è¿æ¥å…¬ç½‘æœåŠ¡å™¨ï¼ˆ192.168.94.156ï¼‰çš„3008ç«¯å£è¿œç¨‹è¿æ¥å†…ç½‘æœºå™¨ï¼ˆ192.168.94.154ï¼‰"></a>1ã€å®ç°ï¼šé€šè¿‡è¿æ¥å…¬ç½‘æœåŠ¡å™¨ï¼ˆ192.168.94.156ï¼‰çš„3008ç«¯å£è¿œç¨‹è¿æ¥å†…ç½‘æœºå™¨ï¼ˆ192.168.94.154ï¼‰</h3><h4 id="1-1ã€å®Œæˆ-æ­¥éª¤ä¸€ã€äºŒã€ä¸‰åï¼Œç‚¹å‡»éš§é“-gt-gt-ç‚¹å‡»æ–°å¢"><a href="#1-1ã€å®Œæˆ-æ­¥éª¤ä¸€ã€äºŒã€ä¸‰åï¼Œç‚¹å‡»éš§é“-gt-gt-ç‚¹å‡»æ–°å¢" class="headerlink" title="1.1ã€å®Œæˆ æ­¥éª¤ä¸€ã€äºŒã€ä¸‰åï¼Œç‚¹å‡»éš§é“ &gt;&gt; ç‚¹å‡»æ–°å¢"></a>1.1ã€å®Œæˆ æ­¥éª¤ä¸€ã€äºŒã€ä¸‰åï¼Œç‚¹å‡»éš§é“ &gt;&gt; ç‚¹å‡»æ–°å¢</h4><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127103632274.png" alt="image-20220127103632274"></p><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127103720043.png" alt="image-20220127103720043"></p><h4 id="1-2ã€è¾“å…¥æˆ‘ä»¬è®¾ç½®çš„æœåŠ¡ç«¯ç«¯å£å’Œç›®æ ‡ipç«¯å£-gt-gt-æ–°å¢"><a href="#1-2ã€è¾“å…¥æˆ‘ä»¬è®¾ç½®çš„æœåŠ¡ç«¯ç«¯å£å’Œç›®æ ‡ipç«¯å£-gt-gt-æ–°å¢" class="headerlink" title="1.2ã€è¾“å…¥æˆ‘ä»¬è®¾ç½®çš„æœåŠ¡ç«¯ç«¯å£å’Œç›®æ ‡ipç«¯å£ &gt;&gt; æ–°å¢"></a>1.2ã€è¾“å…¥æˆ‘ä»¬è®¾ç½®çš„æœåŠ¡ç«¯ç«¯å£å’Œç›®æ ‡ipç«¯å£ &gt;&gt; æ–°å¢</h4><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127103734930.png" alt="image-20220127103734930"></p><h4 id="1-3ã€åœ¨æˆ‘ä»¬çš„å…¬ç½‘æœºå™¨ä¸Šä½¿ç”¨xshellè¿æ¥3008ç«¯å£"><a href="#1-3ã€åœ¨æˆ‘ä»¬çš„å…¬ç½‘æœºå™¨ä¸Šä½¿ç”¨xshellè¿æ¥3008ç«¯å£" class="headerlink" title="1.3ã€åœ¨æˆ‘ä»¬çš„å…¬ç½‘æœºå™¨ä¸Šä½¿ç”¨xshellè¿æ¥3008ç«¯å£"></a>1.3ã€åœ¨æˆ‘ä»¬çš„å…¬ç½‘æœºå™¨ä¸Šä½¿ç”¨xshellè¿æ¥3008ç«¯å£</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ssh -p3008 root@192.168.94.156<br></code></pre></td></tr></table></figure><p>æ³¨ï¼šå‡ºç°å¦‚ä¸‹å†…å®¹å³å®ç°äº†è¿æ¥å…¬ç½‘3008ç«¯å£ï¼Œè¿œç¨‹è¿æ¥å†…ç½‘æœºå™¨ï¼å³ï¼šå¯ä»¥åœ¨å…¶ä»–æœºå™¨ä¸Šé€šè¿‡è¿æ¥å…¬ç½‘æœºå™¨+è®¾ç½®çš„æœåŠ¡ç«¯å£è¿›è¡Œè¿æ¥å†…ç½‘æœºå™¨</p><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127110121856.png" alt="image-20220127110121856"></p><h3 id="2ã€å®ç°ï¼šä½¿ç”¨sockæ¨¡å¼è¿›è¡Œå†…ç½‘è®¿é—®ï¼Œè®¾ç½®è®¤è¯è´¦å·ï¼šadmin-è®¤è¯å¯†ç ï¼šadmin123-è®¤è¯ç«¯å£ä¸º3007ï¼"><a href="#2ã€å®ç°ï¼šä½¿ç”¨sockæ¨¡å¼è¿›è¡Œå†…ç½‘è®¿é—®ï¼Œè®¾ç½®è®¤è¯è´¦å·ï¼šadmin-è®¤è¯å¯†ç ï¼šadmin123-è®¤è¯ç«¯å£ä¸º3007ï¼" class="headerlink" title="2ã€å®ç°ï¼šä½¿ç”¨sockæ¨¡å¼è¿›è¡Œå†…ç½‘è®¿é—®ï¼Œè®¾ç½®è®¤è¯è´¦å·ï¼šadmin è®¤è¯å¯†ç ï¼šadmin123  è®¤è¯ç«¯å£ä¸º3007ï¼"></a>2ã€å®ç°ï¼šä½¿ç”¨sockæ¨¡å¼è¿›è¡Œå†…ç½‘è®¿é—®ï¼Œè®¾ç½®è®¤è¯è´¦å·ï¼šadmin è®¤è¯å¯†ç ï¼šadmin123  è®¤è¯ç«¯å£ä¸º3007ï¼</h3><h4 id="2-1ã€å®Œæˆ-æ­¥éª¤ä¸€ã€äºŒã€ä¸‰ï¼Œåœ¨æ­¥éª¤ä¸‰æ–°å¢å®¢æˆ·ç«¯æ—¶-gt-gt-å¡«å†™basicè®¤è¯ç”¨æˆ·åå’Œå¯†ç -gt-gt-æ–°å¢"><a href="#2-1ã€å®Œæˆ-æ­¥éª¤ä¸€ã€äºŒã€ä¸‰ï¼Œåœ¨æ­¥éª¤ä¸‰æ–°å¢å®¢æˆ·ç«¯æ—¶-gt-gt-å¡«å†™basicè®¤è¯ç”¨æˆ·åå’Œå¯†ç -gt-gt-æ–°å¢" class="headerlink" title="2.1ã€å®Œæˆ æ­¥éª¤ä¸€ã€äºŒã€ä¸‰ï¼Œåœ¨æ­¥éª¤ä¸‰æ–°å¢å®¢æˆ·ç«¯æ—¶&gt;&gt; å¡«å†™basicè®¤è¯ç”¨æˆ·åå’Œå¯†ç  &gt;&gt; æ–°å¢"></a>2.1ã€å®Œæˆ æ­¥éª¤ä¸€ã€äºŒã€ä¸‰ï¼Œåœ¨æ­¥éª¤ä¸‰æ–°å¢å®¢æˆ·ç«¯æ—¶&gt;&gt; å¡«å†™basicè®¤è¯ç”¨æˆ·åå’Œå¯†ç  &gt;&gt; æ–°å¢</h4><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127110151297.png" alt="image-20220127110151297"></p><h4 id="2-2ã€ç‚¹å‡»éš§é“-gt-gt-æ–°å¢-gt-gt-é€‰æ‹©æ¨¡å¼ä¸ºSOCKSä»£ç†-gt-gt-å¡«å†™æœåŠ¡ç«¯ç«¯å£"><a href="#2-2ã€ç‚¹å‡»éš§é“-gt-gt-æ–°å¢-gt-gt-é€‰æ‹©æ¨¡å¼ä¸ºSOCKSä»£ç†-gt-gt-å¡«å†™æœåŠ¡ç«¯ç«¯å£" class="headerlink" title="2.2ã€ç‚¹å‡»éš§é“ &gt;&gt;  æ–°å¢  &gt;&gt;  é€‰æ‹©æ¨¡å¼ä¸ºSOCKSä»£ç†  &gt;&gt; å¡«å†™æœåŠ¡ç«¯ç«¯å£"></a>2.2ã€ç‚¹å‡»éš§é“ &gt;&gt;  æ–°å¢  &gt;&gt;  é€‰æ‹©æ¨¡å¼ä¸ºSOCKSä»£ç†  &gt;&gt; å¡«å†™æœåŠ¡ç«¯ç«¯å£</h4><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127110216963.png" alt="image-20220127110216963"></p><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127110236198.png" alt="image-20220127110236198"></p><h4 id="2-3ã€ä¸‹è½½å¹¶å®‰è£…Proxifierã€‚"><a href="#2-3ã€ä¸‹è½½å¹¶å®‰è£…Proxifierã€‚" class="headerlink" title="2.3ã€ä¸‹è½½å¹¶å®‰è£…Proxifierã€‚"></a>2.3ã€ä¸‹è½½å¹¶å®‰è£…Proxifierã€‚</h4><p><code>ä¸‹è½½åœ°å€ï¼šhttp://soft.onlinedown.net/soft/971579.htm</code></p><p>#ä¸­æ–‡æ±‰åŒ–ç‰ˆï¼Œç›´æ¥å®‰è£…ã€‚</p><h4 id="2-4ã€æ‰“å¼€Proxifier-gt-gt-ç‚¹å‡»é…ç½®æ–‡ä»¶-gt-gt-ä»£ç†æœåŠ¡å™¨"><a href="#2-4ã€æ‰“å¼€Proxifier-gt-gt-ç‚¹å‡»é…ç½®æ–‡ä»¶-gt-gt-ä»£ç†æœåŠ¡å™¨" class="headerlink" title="2.4ã€æ‰“å¼€Proxifier  &gt;&gt; ç‚¹å‡»é…ç½®æ–‡ä»¶  &gt;&gt;  ä»£ç†æœåŠ¡å™¨"></a>2.4ã€æ‰“å¼€Proxifier  &gt;&gt; ç‚¹å‡»é…ç½®æ–‡ä»¶  &gt;&gt;  ä»£ç†æœåŠ¡å™¨</h4><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127110254912.png" alt="image-20220127110254912"></p><h4 id="2-5ã€æ·»åŠ ä»£ç†æœåŠ¡å™¨-gt-gt-è¾“å…¥å…¬ç½‘ipï¼ˆ192-168-94-156ï¼‰ç«¯å£ï¼š3007-gt-gt-åè®®é€‰æ‹©socksç‰ˆæœ¬5-gt-gt-éªŒè¯é€‰æ‹©å¯ç”¨ï¼šï¼ˆè¾“å…¥è®¾ç½®çš„basicç”¨æˆ·åï¼šadmin-å¯†ç ï¼š-admin123ï¼‰-gt-gt-ç‚¹å‡»æ£€æŸ¥"><a href="#2-5ã€æ·»åŠ ä»£ç†æœåŠ¡å™¨-gt-gt-è¾“å…¥å…¬ç½‘ipï¼ˆ192-168-94-156ï¼‰ç«¯å£ï¼š3007-gt-gt-åè®®é€‰æ‹©socksç‰ˆæœ¬5-gt-gt-éªŒè¯é€‰æ‹©å¯ç”¨ï¼šï¼ˆè¾“å…¥è®¾ç½®çš„basicç”¨æˆ·åï¼šadmin-å¯†ç ï¼š-admin123ï¼‰-gt-gt-ç‚¹å‡»æ£€æŸ¥" class="headerlink" title="2.5ã€æ·»åŠ ä»£ç†æœåŠ¡å™¨  &gt;&gt;  è¾“å…¥å…¬ç½‘ipï¼ˆ192.168.94.156ï¼‰ç«¯å£ï¼š3007  &gt;&gt;  åè®®é€‰æ‹©socksç‰ˆæœ¬5  &gt;&gt;  éªŒè¯é€‰æ‹©å¯ç”¨ï¼šï¼ˆè¾“å…¥è®¾ç½®çš„basicç”¨æˆ·åï¼šadmin å¯†ç ï¼š admin123ï¼‰ &gt;&gt;  ç‚¹å‡»æ£€æŸ¥"></a>2.5ã€æ·»åŠ ä»£ç†æœåŠ¡å™¨  &gt;&gt;  è¾“å…¥å…¬ç½‘ipï¼ˆ192.168.94.156ï¼‰ç«¯å£ï¼š3007  &gt;&gt;  åè®®é€‰æ‹©socksç‰ˆæœ¬5  &gt;&gt;  éªŒè¯é€‰æ‹©å¯ç”¨ï¼šï¼ˆè¾“å…¥è®¾ç½®çš„basicç”¨æˆ·åï¼šadmin å¯†ç ï¼š admin123ï¼‰ &gt;&gt;  ç‚¹å‡»æ£€æŸ¥</h4><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127110317058.png" alt="image-20220127110317058"></p><h4 id="2-6ã€æ˜¾ç¤ºé€šè¿‡ä»¥å-gt-gt-è¿æ¥"><a href="#2-6ã€æ˜¾ç¤ºé€šè¿‡ä»¥å-gt-gt-è¿æ¥" class="headerlink" title="2.6ã€æ˜¾ç¤ºé€šè¿‡ä»¥å  &gt;&gt;  è¿æ¥"></a>2.6ã€æ˜¾ç¤ºé€šè¿‡ä»¥å  &gt;&gt;  è¿æ¥</h4><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127110334282.png" alt="image-20220127110334282"></p><h4 id="2-7ã€è¿æ¥å-gt-gt-ç‚¹å‡»ä»£ç†è§„åˆ™ï¼Œè§„åˆ™åç§°é»˜è®¤é€‰æ‹©çš„ä¸ºLocalhostï¼Œæˆ–è€…è‡ªå·±æ–°å¢è§„åˆ™åç§°ï¼ˆè‡ªå·±æ–°å¢çš„è¯ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©ç”±å“ªä¸ªåº”ç”¨ç¨‹åºè®¿é—®ç½‘ç»œï¼Œæˆ‘è¿™è¾¹é€‰æ‹©ç”¨qqæµè§ˆå™¨è®¿é—®è¯¥ç½‘ç»œï¼‰-gt-gt-åŠ¨ä½œé€‰æ‹©ä¸ºåˆšåˆšæˆ‘ä»¬socksçš„ip-gt-gt-ç‚¹å‡»ç¡®å®š"><a href="#2-7ã€è¿æ¥å-gt-gt-ç‚¹å‡»ä»£ç†è§„åˆ™ï¼Œè§„åˆ™åç§°é»˜è®¤é€‰æ‹©çš„ä¸ºLocalhostï¼Œæˆ–è€…è‡ªå·±æ–°å¢è§„åˆ™åç§°ï¼ˆè‡ªå·±æ–°å¢çš„è¯ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©ç”±å“ªä¸ªåº”ç”¨ç¨‹åºè®¿é—®ç½‘ç»œï¼Œæˆ‘è¿™è¾¹é€‰æ‹©ç”¨qqæµè§ˆå™¨è®¿é—®è¯¥ç½‘ç»œï¼‰-gt-gt-åŠ¨ä½œé€‰æ‹©ä¸ºåˆšåˆšæˆ‘ä»¬socksçš„ip-gt-gt-ç‚¹å‡»ç¡®å®š" class="headerlink" title="2.7ã€è¿æ¥å  &gt;&gt;  ç‚¹å‡»ä»£ç†è§„åˆ™ï¼Œè§„åˆ™åç§°é»˜è®¤é€‰æ‹©çš„ä¸ºLocalhostï¼Œæˆ–è€…è‡ªå·±æ–°å¢è§„åˆ™åç§°ï¼ˆè‡ªå·±æ–°å¢çš„è¯ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©ç”±å“ªä¸ªåº”ç”¨ç¨‹åºè®¿é—®ç½‘ç»œï¼Œæˆ‘è¿™è¾¹é€‰æ‹©ç”¨qqæµè§ˆå™¨è®¿é—®è¯¥ç½‘ç»œï¼‰ &gt;&gt;  åŠ¨ä½œé€‰æ‹©ä¸ºåˆšåˆšæˆ‘ä»¬socksçš„ip  &gt;&gt;   ç‚¹å‡»ç¡®å®š"></a>2.7ã€è¿æ¥å  &gt;&gt;  ç‚¹å‡»ä»£ç†è§„åˆ™ï¼Œè§„åˆ™åç§°é»˜è®¤é€‰æ‹©çš„ä¸ºLocalhostï¼Œæˆ–è€…è‡ªå·±æ–°å¢è§„åˆ™åç§°ï¼ˆè‡ªå·±æ–°å¢çš„è¯ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©ç”±å“ªä¸ªåº”ç”¨ç¨‹åºè®¿é—®ç½‘ç»œï¼Œæˆ‘è¿™è¾¹é€‰æ‹©ç”¨qqæµè§ˆå™¨è®¿é—®è¯¥ç½‘ç»œï¼‰ &gt;&gt;  åŠ¨ä½œé€‰æ‹©ä¸ºåˆšåˆšæˆ‘ä»¬socksçš„ip  &gt;&gt;   ç‚¹å‡»ç¡®å®š</h4><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127110406976.png" alt="image-20220127110406976"></p><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127110441124.png" alt="image-20220127110441124"></p><h4 id="2-8ã€ç¡®å®šä»¥åï¼Œå°±å¯ä»¥è®©åœ¨å¦ä¸€ä¸ªåœ°æ–¹çš„æœºå™¨ï¼ˆä¸åŒç½‘ç»œä¸‹çš„æœºå™¨ï¼‰pingè¯¥å†…ç½‘æœºå™¨ipï¼ˆ192-168-94-154ï¼‰æ˜¯å¦é€šï¼Œæˆ–è€…sshè¿æ¥è¯¥å†…ç½‘ipï¼ˆ192-168-94-154ï¼‰ï¼Œæˆ–è€…ç›´æ¥è®¿é—®è¯¥å†…ç½‘æœºå™¨æŸäº›è¿è¡Œçš„æœåŠ¡ã€‚"><a href="#2-8ã€ç¡®å®šä»¥åï¼Œå°±å¯ä»¥è®©åœ¨å¦ä¸€ä¸ªåœ°æ–¹çš„æœºå™¨ï¼ˆä¸åŒç½‘ç»œä¸‹çš„æœºå™¨ï¼‰pingè¯¥å†…ç½‘æœºå™¨ipï¼ˆ192-168-94-154ï¼‰æ˜¯å¦é€šï¼Œæˆ–è€…sshè¿æ¥è¯¥å†…ç½‘ipï¼ˆ192-168-94-154ï¼‰ï¼Œæˆ–è€…ç›´æ¥è®¿é—®è¯¥å†…ç½‘æœºå™¨æŸäº›è¿è¡Œçš„æœåŠ¡ã€‚" class="headerlink" title="2.8ã€ç¡®å®šä»¥åï¼Œå°±å¯ä»¥è®©åœ¨å¦ä¸€ä¸ªåœ°æ–¹çš„æœºå™¨ï¼ˆä¸åŒç½‘ç»œä¸‹çš„æœºå™¨ï¼‰pingè¯¥å†…ç½‘æœºå™¨ipï¼ˆ192.168.94.154ï¼‰æ˜¯å¦é€šï¼Œæˆ–è€…sshè¿æ¥è¯¥å†…ç½‘ipï¼ˆ192.168.94.154ï¼‰ï¼Œæˆ–è€…ç›´æ¥è®¿é—®è¯¥å†…ç½‘æœºå™¨æŸäº›è¿è¡Œçš„æœåŠ¡ã€‚"></a>2.8ã€ç¡®å®šä»¥åï¼Œå°±å¯ä»¥è®©åœ¨å¦ä¸€ä¸ªåœ°æ–¹çš„æœºå™¨ï¼ˆä¸åŒç½‘ç»œä¸‹çš„æœºå™¨ï¼‰pingè¯¥å†…ç½‘æœºå™¨ipï¼ˆ192.168.94.154ï¼‰æ˜¯å¦é€šï¼Œæˆ–è€…sshè¿æ¥è¯¥å†…ç½‘ipï¼ˆ192.168.94.154ï¼‰ï¼Œæˆ–è€…ç›´æ¥è®¿é—®è¯¥å†…ç½‘æœºå™¨æŸäº›è¿è¡Œçš„æœåŠ¡ã€‚</h4><p><img src="/2023/04/10/%E4%B8%AD%E9%97%B4%E4%BB%B6/nps/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8Cnps%E3%80%81%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/image-20220127110458832.png" alt="image-20220127110458832"></p><p>æ³¨ï¼šå†…ç½‘å†…å…¶ä»–çš„æœºå™¨èƒ½è¿”å›æ•°æ®ï¼Œå³å·²æˆåŠŸå®ç°ä½¿ç”¨sockæ¨¡å¼è¿›è¡Œå†…ç½‘è®¿é—®ï¼</p>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>nps</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nps</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨docker-composeå®‰è£…prometheus</title>
    <link href="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/docker-compose%E5%AE%89%E8%A3%85prometheus/"/>
    <url>/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/docker-compose%E5%AE%89%E8%A3%85prometheus/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨docker-composeå®‰è£…prometheus"><a href="#ä½¿ç”¨docker-composeå®‰è£…prometheus" class="headerlink" title="ä½¿ç”¨docker-composeå®‰è£…prometheus"></a>ä½¿ç”¨docker-composeå®‰è£…prometheus</h1><h2 id="docker-compose-yamlæ–‡ä»¶"><a href="#docker-compose-yamlæ–‡ä»¶" class="headerlink" title="docker-compose.yamlæ–‡ä»¶"></a>docker-compose.yamlæ–‡ä»¶</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">prometheus:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">prom/prometheus:latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">monitoring_prometheus</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/prometheus/config:/etc/prometheus/</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/prometheus/data:/prometheus</span><br>    <span class="hljs-attr">command:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;-config.file=/etc/prometheus/prometheus.yml&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;-storage.local.path=/prometheus&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;-alertmanager.url=http://alertmanager:9093&#x27;</span><br>    <span class="hljs-attr">expose:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">9090</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">9090</span><span class="hljs-string">:9090</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">cadvisor:cadvisor</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">node-exporter:node-exporter</span><br><br>  <span class="hljs-attr">node-exporter:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">prom/node-exporter:latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">monitoring_node_exporter</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">expose:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">9100</span><br><br>  <span class="hljs-attr">cadvisor:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">google/cadvisor:latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">monitoring_cadvisor</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/:/rootfs:ro</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run:/var/run:rw</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/sys:/sys:ro</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/lib/docker/:/var/lib/docker:ro</span><br>    <span class="hljs-attr">expose:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">8080</span><br>  <br>  <span class="hljs-attr">grafana:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">grafana/grafana:latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">monitoring_grafana</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">prometheus:prometheus</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/grafana:/var/lib/grafana</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_SECURITY_ADMIN_PASSWORD=MYPASSWORT</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_USERS_ALLOW_SIGN_UP=false</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_SERVER_DOMAIN=myrul.com</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_SMTP_ENABLED=true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_SMTP_HOST=smtp.gmail.com:587</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_SMTP_USER=myadrress@gmail.com</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_SMTP_PASSWORD=mypassword</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_SMTP_FROM_ADDRESS=myaddress@gmail.com</span><br></code></pre></td></tr></table></figure><h2 id="æ˜ å°„å‡ºæ¥çš„é…ç½®æ–‡ä»¶prometheus-yml"><a href="#æ˜ å°„å‡ºæ¥çš„é…ç½®æ–‡ä»¶prometheus-yml" class="headerlink" title="æ˜ å°„å‡ºæ¥çš„é…ç½®æ–‡ä»¶prometheus.yml"></a>æ˜ å°„å‡ºæ¥çš„é…ç½®æ–‡ä»¶<code>prometheus.yml</code></h2><p>é™„ä¸Šprometheus.ymlæ–‡ä»¶å‚æ•°è¯¦ç»†è§£é‡Šï¼š<a href="https://blog.51cto.com/shijianfeng/5151307">https://blog.51cto.com/shijianfeng/5151307</a></p><p>ä»¥ä¸‹ä¸ºç¤ºä¾‹æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># my global config</span><br><span class="hljs-attr">global:</span><br>  <span class="hljs-attr">scrape_interval:</span>     <span class="hljs-string">120s</span> <span class="hljs-comment"># é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ 15 ç§’æŠ“å–ä¸€æ¬¡ç›®æ ‡</span><br>  <span class="hljs-attr">evaluation_interval:</span> <span class="hljs-string">120s</span> <span class="hljs-comment"># é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ 15 ç§’æŠ“å–ä¸€æ¬¡ç›®æ ‡</span><br>  <span class="hljs-comment"># scrape_timeout è®¾ç½®ä¸ºå…¨å±€é»˜è®¤å€¼ï¼ˆ10 ç§’ï¼‰ã€‚</span><br><br>  <span class="hljs-comment"># Attach these labels to any time series or alerts when communicating with</span><br>  <span class="hljs-comment"># external systems (federation, remote storage, Alertmanager).</span><br>  <span class="hljs-attr">external_labels:</span><br>      <span class="hljs-attr">monitor:</span> <span class="hljs-string">&#x27;my-project&#x27;</span><br><br><span class="hljs-comment"># Load and evaluate rules in this file every &#x27;evaluation_interval&#x27; seconds.</span><br><span class="hljs-attr">rule_files:</span><br>  <span class="hljs-comment"># - &quot;alert.rules&quot;</span><br>  <span class="hljs-comment"># - &quot;first.rules&quot;</span><br>  <span class="hljs-comment"># - &quot;second.rules&quot;</span><br><br><span class="hljs-comment"># A scrape configuration containing exactly one endpoint to scrape:</span><br><span class="hljs-comment"># Here it&#x27;s Prometheus itself.</span><br><span class="hljs-attr">scrape_configs:</span><br>  <span class="hljs-comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;prometheus&#x27;</span><br><br>    <span class="hljs-comment"># Override the global default and scrape targets from this job every 5 seconds.</span><br>    <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">120s</span><br><br>    <span class="hljs-comment"># metrics_path defaults to &#x27;/metrics&#x27;</span><br>    <span class="hljs-comment"># scheme defaults to &#x27;http&#x27;.</span><br><br>    <span class="hljs-attr">static_configs:</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">&#x27;localhost:9090&#x27;</span>,<span class="hljs-string">&#x27;cadvisor:8080&#x27;</span>,<span class="hljs-string">&#x27;node-exporter:9100&#x27;</span>, <span class="hljs-string">&#x27;nginx-exporter:9113&#x27;</span>]<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç›‘æ§</category>
      
      <category>prometheus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerå®‰è£…Prometheusä¹‹éƒ¨ç½²ç»„ä»¶ä»¥åŠæ¨¡æ¿</title>
    <link href="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/"/>
    <url>/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Dockerå®‰è£…Prometheusä¹‹éƒ¨ç½²ç»„ä»¶åŠæ¨¡æ¿ã€é‚®ä»¶é€šçŸ¥"><a href="#Dockerå®‰è£…Prometheusä¹‹éƒ¨ç½²ç»„ä»¶åŠæ¨¡æ¿ã€é‚®ä»¶é€šçŸ¥" class="headerlink" title="Dockerå®‰è£…Prometheusä¹‹éƒ¨ç½²ç»„ä»¶åŠæ¨¡æ¿ã€é‚®ä»¶é€šçŸ¥"></a>Dockerå®‰è£…Prometheusä¹‹éƒ¨ç½²ç»„ä»¶åŠæ¨¡æ¿ã€é‚®ä»¶é€šçŸ¥</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£1ï¼šhttps://www.freesion.com/article/7143903065/<br>å‚è€ƒæ–‡æ¡£2ï¼šhttps://www.freesion.com/article/4040903004/<br><br>å…¶ä»–å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/weixin_43909790/article/details/126562341<br></code></pre></td></tr></table></figure><p><strong>ç¯å¢ƒï¼š(å…¨éƒ¨å…³é—­é˜²ç«å¢™ï¼Œç¦ç”¨selinux)</strong></p><table><thead><tr><th>æœåŠ¡å™¨èŠ‚ç‚¹åç§°</th><th>ipåœ°å€</th><th>å®‰è£…ç»„ä»¶</th></tr></thead><tbody><tr><td>Docker1</td><td>192.168.94.154</td><td>nodeExporter,Cadvisor,grafana,Prometheus server</td></tr><tr><td>Docker2</td><td>192.168.94.155</td><td>nodeExporter,Cadvisor</td></tr><tr><td>Docker3</td><td>192.168.94.156</td><td>nodeExporter,Cadvisor</td></tr></tbody></table><p><strong>éœ€è¦éƒ¨ç½²çš„ç»„ä»¶ï¼š</strong></p><ul><li>Prometheus server:æ™®ç½—ç±³ä¿®æ–¯çš„ä¸»æœåŠ¡å™¨</li><li>nodeexporter:è´Ÿè´£æ”¶é›†hostç¡¬ä»¶ä¿¡æ¯å’Œæ“ä½œç³»ç»Ÿä¿¡æ¯</li><li>CAdvisor:è´Ÿè´£æ”¶é›†hostä¸Šè¿è¡Œçš„å®¹å™¨ä¿¡æ¯</li><li>grafana:è´Ÿè´£å±•ç¤ºæ™®ç½—ç±³ä¿®æ–¯ç›‘æ§ç•Œé¢</li></ul><h2 id="ä¸€ã€éƒ¨ç½²åŸºç¡€çš„ç»„ä»¶ï¼ˆPrometheus-grafanaï¼‰"><a href="#ä¸€ã€éƒ¨ç½²åŸºç¡€çš„ç»„ä»¶ï¼ˆPrometheus-grafanaï¼‰" class="headerlink" title="ä¸€ã€éƒ¨ç½²åŸºç¡€çš„ç»„ä»¶ï¼ˆPrometheus +  grafanaï¼‰"></a>ä¸€ã€éƒ¨ç½²åŸºç¡€çš„ç»„ä»¶ï¼ˆPrometheus +  grafanaï¼‰</h2><h3 id="1ã€ï¼‰å°†ä¸‰ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œå…¨éƒ¨éƒ¨ç½²node-exporterå’Œcadvisor"><a href="#1ã€ï¼‰å°†ä¸‰ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œå…¨éƒ¨éƒ¨ç½²node-exporterå’Œcadvisor" class="headerlink" title="1ã€ï¼‰å°†ä¸‰ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œå…¨éƒ¨éƒ¨ç½²node-exporterå’Œcadvisor"></a>1ã€ï¼‰å°†ä¸‰ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œå…¨éƒ¨éƒ¨ç½²node-exporterå’Œcadvisor</h3><h4 id="1-1ã€éƒ¨ç½²node-exporter"><a href="#1-1ã€éƒ¨ç½²node-exporter" class="headerlink" title="1.1ã€éƒ¨ç½²node-exporter"></a>1.1ã€éƒ¨ç½²node-exporter</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d -p 9100:9100 \<br>-v /proc:/host/proc \<br>-v /sys:/host/sys \<br>-v /:/rootfs \<br>--name node-exporter \<br>--net=host prom/node-exporter \<br><span class="hljs-comment">#--web.listen-address=:7100 è®¾ç½®ç«¯å£ä¸º7100</span><br>--path.procfs /host/proc --path.sysfs /host/sys --collector.filesystem.ignored-mount-points <span class="hljs-string">&quot;^/(sys|proc|dev|host|etc)($|/)&quot;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨äº†â€“net&#x3D;hostï¼Œè¿™æ ·prometheus   server å¯ä»¥ç›´æ¥ä¸node-exporteré€šä¿¡ã€‚<br>docker ps å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªimageä¸ºï¼šprom&#x2F;node-exporterçš„é•œåƒè¿è¡Œ</p><h4 id="1-2ã€éƒ¨ç½²å®‰è£…cadvisor-æ”¶é›†èŠ‚ç‚¹å®¹å™¨ä¿¡æ¯ï¼šï¼ˆåœ¨æµè§ˆå™¨ä¸ŠéªŒè¯ï¼ŒçŒ«å¤´é¹°å¤´åƒï¼‰"><a href="#1-2ã€éƒ¨ç½²å®‰è£…cadvisor-æ”¶é›†èŠ‚ç‚¹å®¹å™¨ä¿¡æ¯ï¼šï¼ˆåœ¨æµè§ˆå™¨ä¸ŠéªŒè¯ï¼ŒçŒ«å¤´é¹°å¤´åƒï¼‰" class="headerlink" title="1.2ã€éƒ¨ç½²å®‰è£…cadvisor,æ”¶é›†èŠ‚ç‚¹å®¹å™¨ä¿¡æ¯ï¼šï¼ˆåœ¨æµè§ˆå™¨ä¸ŠéªŒè¯ï¼ŒçŒ«å¤´é¹°å¤´åƒï¼‰"></a>1.2ã€éƒ¨ç½²å®‰è£…cadvisor,æ”¶é›†èŠ‚ç‚¹å®¹å™¨ä¿¡æ¯ï¼šï¼ˆåœ¨æµè§ˆå™¨ä¸ŠéªŒè¯ï¼ŒçŒ«å¤´é¹°å¤´åƒï¼‰</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -v /:/rootfs:ro \<br>-v /var/run:/var/run/:rw \<br>-v /sys:/sys:ro \<br>-v /var/lib/docker:/var/lib/docker:ro \<br>-p 8080:8080 \<br>--detach=<span class="hljs-literal">true</span> \<br>--name=cadvisor \<br>--net=host google/cadvisor<br></code></pre></td></tr></table></figure><p>è¿è¡Œå®Œæˆåï¼Œå¯ä»¥è®¿é—®ip+9100ç«¯å£æ˜¾ç¤ºï¼šNode Exporter</p><h3 id="2ã€ï¼‰åœ¨docker1ä¸Šéƒ¨ç½²prometheus-serveræœåŠ¡ï¼šåœ¨éƒ¨ç½²prometheusä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒçš„é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œå…ˆå°†å…¶é…ç½®æ–‡ä»¶æ‹·è´å‡ºæ¥"><a href="#2ã€ï¼‰åœ¨docker1ä¸Šéƒ¨ç½²prometheus-serveræœåŠ¡ï¼šåœ¨éƒ¨ç½²prometheusä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒçš„é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œå…ˆå°†å…¶é…ç½®æ–‡ä»¶æ‹·è´å‡ºæ¥" class="headerlink" title="2ã€ï¼‰åœ¨docker1ä¸Šéƒ¨ç½²prometheus serveræœåŠ¡ï¼šåœ¨éƒ¨ç½²prometheusä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒçš„é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œå…ˆå°†å…¶é…ç½®æ–‡ä»¶æ‹·è´å‡ºæ¥**"></a>2ã€ï¼‰åœ¨docker1ä¸Šéƒ¨ç½²prometheus serveræœåŠ¡ï¼šåœ¨éƒ¨ç½²prometheusä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒçš„é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œå…ˆå°†å…¶é…ç½®æ–‡ä»¶æ‹·è´å‡ºæ¥**</h3><h4 id="2-1ã€åˆ›å»ºæ–‡ä»¶ç›®å½•ï¼Œå¹¶ä¸´æ—¶è¿è¡Œä¸€ä¸ªå®¹å™¨"><a href="#2-1ã€åˆ›å»ºæ–‡ä»¶ç›®å½•ï¼Œå¹¶ä¸´æ—¶è¿è¡Œä¸€ä¸ªå®¹å™¨" class="headerlink" title="2.1ã€åˆ›å»ºæ–‡ä»¶ç›®å½•ï¼Œå¹¶ä¸´æ—¶è¿è¡Œä¸€ä¸ªå®¹å™¨"></a>2.1ã€åˆ›å»ºæ–‡ä»¶ç›®å½•ï¼Œå¹¶ä¸´æ—¶è¿è¡Œä¸€ä¸ªå®¹å™¨</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /app<br>docker run -d -p 9090:9090 --name prometheus --net=host prom/prometheus<br><span class="hljs-comment">#docker exec -it prometheus /bin/sh</span><br></code></pre></td></tr></table></figure><p>å°†å®¹å™¨å†…çš„prometheus.ymlæ‹·è´åˆ°&#x2F;appç›®å½•ä¸‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker <span class="hljs-built_in">cp</span> prometheus:/etc/prometheus/prometheus.yml ./<br></code></pre></td></tr></table></figure><h4 id="2-2ã€ä¿®æ”¹prometheus-ymlæ–‡ä»¶"><a href="#2-2ã€ä¿®æ”¹prometheus-ymlæ–‡ä»¶" class="headerlink" title="2.2ã€ä¿®æ”¹prometheus.ymlæ–‡ä»¶"></a>2.2ã€ä¿®æ”¹prometheus.ymlæ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ç¬¬29è¡Œï¼Œè¿™é‡ŒæŒ‡å®šäº†promethusçš„ç›‘æ§é¡¹ï¼ŒåŒ…æ‹¬å®ƒä¹Ÿä¼šç›‘æ§è‡ªå·±æ”¶é›†åˆ°çš„æ•°æ®ã€‚</span><br>    - targetsï¼š[<span class="hljs-string">&#x27;localhost:9090&#x27;</span>,<span class="hljs-string">&#x27;localhost:8080&#x27;</span>,<span class="hljs-string">&#x27;localhost:9100&#x27;</span>,<span class="hljs-string">&#x27;192.168.94.155:8080&#x27;</span>,<span class="hljs-string">&#x27;192.168.94.155:9100&#x27;</span>,<span class="hljs-string">&#x27;192.168.94.156:8080&#x27;</span>,<span class="hljs-string">&#x27;192.168.94.156:9100&#x27;</span>]  <br></code></pre></td></tr></table></figure><h4 id="2-3ã€åˆ é™¤ä¸´æ—¶è¿è¡Œçš„å®¹å™¨ã€‚é‡æ–°è¿è¡Œï¼Œå¹¶æŒ‡å®šprometheus-ymlé…ç½®æ–‡ä»¶"><a href="#2-3ã€åˆ é™¤ä¸´æ—¶è¿è¡Œçš„å®¹å™¨ã€‚é‡æ–°è¿è¡Œï¼Œå¹¶æŒ‡å®šprometheus-ymlé…ç½®æ–‡ä»¶" class="headerlink" title="2.3ã€åˆ é™¤ä¸´æ—¶è¿è¡Œçš„å®¹å™¨ã€‚é‡æ–°è¿è¡Œï¼Œå¹¶æŒ‡å®šprometheus.ymlé…ç½®æ–‡ä»¶"></a>2.3ã€åˆ é™¤ä¸´æ—¶è¿è¡Œçš„å®¹å™¨ã€‚é‡æ–°è¿è¡Œï¼Œå¹¶æŒ‡å®šprometheus.ymlé…ç½®æ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker <span class="hljs-built_in">rm</span> -f prometheus<br>docker run -d -p 9090:9090 --name prometheus --restart=always --net=host -v /app/prometheus.yml:/etc/prometheus/prometheus.yml prom/prometheus<br></code></pre></td></tr></table></figure><p>å¤‡æ³¨:åœ¨æµè§ˆå™¨ä¸Šè®¿é—®æˆ‘ä»¬çš„docker1æœåŠ¡å™¨ï¼š192.168.94.154:9090 ç‚¹å‡»statusâ€“targetsè¿™é‡Œèƒ½å¤ŸæŸ¥çœ‹åˆ°æˆ‘ä»¬å„ä¸ªç›‘æ§é¡¹ï¼š</p><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/2.3.png" alt="5398e3e3f9e82616ba8a567998bcdd39.png"></p><h3 id="3ã€ï¼‰åœ¨docker1ä¸Šï¼Œéƒ¨ç½²graganaæœåŠ¡ï¼Œç”¨æ¥å±•ç¤ºprometheus"><a href="#3ã€ï¼‰åœ¨docker1ä¸Šï¼Œéƒ¨ç½²graganaæœåŠ¡ï¼Œç”¨æ¥å±•ç¤ºprometheus" class="headerlink" title="3ã€ï¼‰åœ¨docker1ä¸Šï¼Œéƒ¨ç½²graganaæœåŠ¡ï¼Œç”¨æ¥å±•ç¤ºprometheus"></a>3ã€ï¼‰åœ¨docker1ä¸Šï¼Œéƒ¨ç½²graganaæœåŠ¡ï¼Œç”¨æ¥å±•ç¤ºprometheus</h3><h4 id="3-1ã€åˆ›å»ºæŒ‚è½½ç›®å½•ï¼Œå¹¶è®¾ç½®æƒé™"><a href="#3-1ã€åˆ›å»ºæŒ‚è½½ç›®å½•ï¼Œå¹¶è®¾ç½®æƒé™" class="headerlink" title="3.1ã€åˆ›å»ºæŒ‚è½½ç›®å½•ï¼Œå¹¶è®¾ç½®æƒé™"></a>3.1ã€åˆ›å»ºæŒ‚è½½ç›®å½•ï¼Œå¹¶è®¾ç½®æƒé™</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /app/grafana-storage<br><span class="hljs-built_in">chmod</span> 777 -R /app/grafana-storage<br></code></pre></td></tr></table></figure><h4 id="3-2ã€è¿è¡ŒgrafanaæœåŠ¡"><a href="#3-2ã€è¿è¡ŒgrafanaæœåŠ¡" class="headerlink" title="3.2ã€è¿è¡ŒgrafanaæœåŠ¡"></a>3.2ã€è¿è¡ŒgrafanaæœåŠ¡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d -p 3000:3000 --name grafana  --restart=always -v /app/grafana-storage:/var/lib/grafana -e <span class="hljs-string">&quot;GF_SECURITY_ADMIN_PASSWORD=123456&quot;</span> grafana/grafana<br></code></pre></td></tr></table></figure><p>ç™»å½•ï¼š192.168.94.154:3000 è¾“å…¥è´¦å·å¯†ç ç™»å½•ï¼šadmin&#x2F;123456</p><h3 id="4ã€ï¼‰é…ç½®prometheuså’Œgrafanaè¿æ¥"><a href="#4ã€ï¼‰é…ç½®prometheuså’Œgrafanaè¿æ¥" class="headerlink" title="4ã€ï¼‰é…ç½®prometheuså’Œgrafanaè¿æ¥"></a>4ã€ï¼‰é…ç½®prometheuså’Œgrafanaè¿æ¥</h3><h4 id="4-1ã€ç™»å½•æˆåŠŸå-gt-gt-æ·»åŠ æ•°æ®æº"><a href="#4-1ã€ç™»å½•æˆåŠŸå-gt-gt-æ·»åŠ æ•°æ®æº" class="headerlink" title="4.1ã€ç™»å½•æˆåŠŸå&gt;&gt;æ·»åŠ æ•°æ®æº"></a>4.1ã€ç™»å½•æˆåŠŸå&gt;&gt;æ·»åŠ æ•°æ®æº</h4><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20220222163231173.png" alt="image-20220222163231173"></p><h4 id="4-2ã€é€‰æ‹©Prometheusæº-gt-gt-è‡ªå®šä¹‰åç§°å’Œæºåœ°å€-gt-gt-é€‰æ‹©â€save-amp-testâ€"><a href="#4-2ã€é€‰æ‹©Prometheusæº-gt-gt-è‡ªå®šä¹‰åç§°å’Œæºåœ°å€-gt-gt-é€‰æ‹©â€save-amp-testâ€" class="headerlink" title="4.2ã€é€‰æ‹©Prometheusæº&gt;&gt;è‡ªå®šä¹‰åç§°å’Œæºåœ°å€&gt;&gt;é€‰æ‹©â€save &amp; testâ€"></a>4.2ã€é€‰æ‹©Prometheusæº&gt;&gt;è‡ªå®šä¹‰åç§°å’Œæºåœ°å€&gt;&gt;é€‰æ‹©â€save &amp; testâ€</h4><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20220222163321309.png" alt="image-20220222163321309"></p><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20220222163703942.png" alt="image-20220222163703942"></p><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20220222163923398.png" alt="image-20220222163923398"></p><h4 id="4-3ã€grafanaå®˜æ–¹ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›æ¨¡æ¿ï¼Œæä¾›æ•°æ®å±•ç¤ºï¼Œ"><a href="#4-3ã€grafanaå®˜æ–¹ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›æ¨¡æ¿ï¼Œæä¾›æ•°æ®å±•ç¤ºï¼Œ" class="headerlink" title="4.3ã€grafanaå®˜æ–¹ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›æ¨¡æ¿ï¼Œæä¾›æ•°æ®å±•ç¤ºï¼Œ"></a>4.3ã€grafanaå®˜æ–¹ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›æ¨¡æ¿ï¼Œæä¾›æ•°æ®å±•ç¤ºï¼Œ</h4><p>åœ°å€ï¼š<a href="https://grafana.com/grafana/dashboards/?pg=community&plcmt=topnav">https://grafana.com/grafana/dashboards/?pg=community&amp;plcmt=topnav</a></p><h5 id="4-3-1ã€æ‰“å¼€å®˜ç½‘åï¼Œé€‰æ‹©â€œDashboardsâ€-gt-gt-é€‰æ‹©DataSourceä¸ºPrometheusåæœç´¢â€œdockerâ€-gt-gt-é€‰æ‹©æ¨¡æ¿"><a href="#4-3-1ã€æ‰“å¼€å®˜ç½‘åï¼Œé€‰æ‹©â€œDashboardsâ€-gt-gt-é€‰æ‹©DataSourceä¸ºPrometheusåæœç´¢â€œdockerâ€-gt-gt-é€‰æ‹©æ¨¡æ¿" class="headerlink" title="4.3.1ã€æ‰“å¼€å®˜ç½‘åï¼Œé€‰æ‹©â€œDashboardsâ€&gt;&gt;é€‰æ‹©DataSourceä¸ºPrometheusåæœç´¢â€œdockerâ€&gt;&gt;é€‰æ‹©æ¨¡æ¿"></a>4.3.1ã€æ‰“å¼€å®˜ç½‘åï¼Œé€‰æ‹©â€œDashboardsâ€&gt;&gt;é€‰æ‹©DataSourceä¸ºPrometheusåæœç´¢â€œdockerâ€&gt;&gt;é€‰æ‹©æ¨¡æ¿</h5><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20220222164300151.png" alt="image-20220222164300151"></p><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20220222164423204.png" alt="image-20220222164423204"></p><h5 id="4-3-2ã€å¤åˆ¶IDæˆ–è€…ä¸‹è½½JSONæ–‡ä»¶-gt-gt-æ‰“å¼€grafanaï¼Œé€‰æ‹©Import-gt-gt-è¾“å…¥IDæˆ–è€…ä¸Šä¼ JSON-gt-gt-é€‰æ‹©æ•°æ®æºå³å¯"><a href="#4-3-2ã€å¤åˆ¶IDæˆ–è€…ä¸‹è½½JSONæ–‡ä»¶-gt-gt-æ‰“å¼€grafanaï¼Œé€‰æ‹©Import-gt-gt-è¾“å…¥IDæˆ–è€…ä¸Šä¼ JSON-gt-gt-é€‰æ‹©æ•°æ®æºå³å¯" class="headerlink" title="4.3.2ã€å¤åˆ¶IDæˆ–è€…ä¸‹è½½JSONæ–‡ä»¶&gt;&gt;æ‰“å¼€grafanaï¼Œé€‰æ‹©Import &gt;&gt;è¾“å…¥IDæˆ–è€…ä¸Šä¼ JSON&gt;&gt;é€‰æ‹©æ•°æ®æºå³å¯"></a>4.3.2ã€å¤åˆ¶IDæˆ–è€…ä¸‹è½½JSONæ–‡ä»¶&gt;&gt;æ‰“å¼€grafanaï¼Œé€‰æ‹©Import &gt;&gt;è¾“å…¥IDæˆ–è€…ä¸Šä¼ JSON&gt;&gt;é€‰æ‹©æ•°æ®æºå³å¯</h5><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20220222164826393.png" alt="image-20220222164826393"></p><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20220222164938738.png" alt="image-20220222164938738"></p><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20220222165201800.png" alt="image-20220222165201800"></p><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20220222165755007.png" alt="image-20220222165755007"></p><h2 id="äºŒã€éƒ¨ç½²ç›‘æ§åŠé‚®ä»¶ã€é’‰é’‰é£ä¹¦æŠ¥è­¦"><a href="#äºŒã€éƒ¨ç½²ç›‘æ§åŠé‚®ä»¶ã€é’‰é’‰é£ä¹¦æŠ¥è­¦" class="headerlink" title="äºŒã€éƒ¨ç½²ç›‘æ§åŠé‚®ä»¶ã€é’‰é’‰é£ä¹¦æŠ¥è­¦"></a>äºŒã€éƒ¨ç½²ç›‘æ§åŠé‚®ä»¶ã€é’‰é’‰é£ä¹¦æŠ¥è­¦</h2><p>åœ¨<strong>docker1</strong>ä¸Šéƒ¨ç½²AlertManageræŠ¥è­¦æ’ä»¶ã€‚</p><h3 id="1ã€ï¼‰é…ç½®alertmanager"><a href="#1ã€ï¼‰é…ç½®alertmanager" class="headerlink" title="1ã€ï¼‰é…ç½®alertmanager:"></a>1ã€ï¼‰é…ç½®alertmanager:</h3><p><strong>alertmanager</strong>ï¼šç”¨æ¥æ¥æ”¶<strong>prometheus</strong>å‘é€çš„æŠ¥è­¦ä¿¡æ¯ï¼Œå¹¶ä¸”æ‰§è¡Œè®¾ç½®å¥½çš„æŠ¥è­¦æ–¹å¼ï¼ŒæŠ¥è­¦å†…å®¹ã€‚</p><p><strong>Prometheus</strong>çš„æŠ¥è­¦æ–¹å¼æœ‰å¥½å‡ ç§æ–¹å¼ï¼Œå¦‚ï¼šé‚®ç®±ã€é’‰é’‰ã€å¾®ä¿¡ç­‰ã€‚</p><h4 id="ä»¥ä¸‹é‡‡ç”¨é‚®ç®±æŠ¥è­¦ï¼š"><a href="#ä»¥ä¸‹é‡‡ç”¨é‚®ç®±æŠ¥è­¦ï¼š" class="headerlink" title="ä»¥ä¸‹é‡‡ç”¨é‚®ç®±æŠ¥è­¦ï¼š"></a>ä»¥ä¸‹é‡‡ç”¨é‚®ç®±æŠ¥è­¦ï¼š</h4><h4 id="1-1ã€æ‹‰å–AlertManagerçš„é•œåƒï¼š"><a href="#1-1ã€æ‹‰å–AlertManagerçš„é•œåƒï¼š" class="headerlink" title="1.1ã€æ‹‰å–AlertManagerçš„é•œåƒï¼š"></a>1.1ã€æ‹‰å–AlertManagerçš„é•œåƒï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker1 ~]<span class="hljs-comment"># docker pull prom/alertmanager</span><br>[root@docker1 ~]<span class="hljs-comment"># docker images</span><br>prom/alertmanager    latest              30594e96cbe8        3 months ago        53.2MB<br></code></pre></td></tr></table></figure><h4 id="1-2ã€å…ˆè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œå°†é…ç½®æ–‡ä»¶å¯¼å‡ºåˆ°æœ¬åœ°ã€‚"><a href="#1-2ã€å…ˆè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œå°†é…ç½®æ–‡ä»¶å¯¼å‡ºåˆ°æœ¬åœ°ã€‚" class="headerlink" title="1.2ã€å…ˆè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œå°†é…ç½®æ–‡ä»¶å¯¼å‡ºåˆ°æœ¬åœ°ã€‚"></a>1.2ã€å…ˆè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œå°†é…ç½®æ–‡ä»¶å¯¼å‡ºåˆ°æœ¬åœ°ã€‚</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker1 ~]<span class="hljs-comment"># docker run -d --name alertmanager -p 9300:9300 prom/alertmanager</span><br><br>[root@docker1 ~]<span class="hljs-comment"># docker cp alertmanager:/etc/alertmanager/alertmanager.yml /app/prometheus/</span><br><span class="hljs-comment">#å°†å®¹å™¨ä¸­çš„é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°/app/prometheus/ç›®å½•ä¸‹</span><br></code></pre></td></tr></table></figure><h4 id="1-3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹åçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š"><a href="#1-3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹åçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š" class="headerlink" title="1.3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹åçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š"></a>1.3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹åçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker ~]<span class="hljs-comment"># cat /app/prometheus/alertmanager.yml </span><br>global:<br>  resolve_timeout: 5m        <span class="hljs-comment">#å¤„ç†è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º5min              </span><br>  smtp_from: <span class="hljs-string">&#x27;1962821461@qq.com&#x27;</span>                 <span class="hljs-comment">###å‘é€è€…ä¿¡æ¯</span><br>  smtp_smarthost: <span class="hljs-string">&#x27;smtp.qq.com:465&#x27;</span>             <span class="hljs-comment">###qqé‚®ç®±çš„SMTPæœåŠ¡å™¨åœ°å€</span><br>  smtp_auth_username: <span class="hljs-string">&#x27;1962821461@qq.com&#x27;</span><span class="hljs-comment">###æ¥æ”¶è€…ä¿¡æ¯</span><br>  smtp_auth_password: <span class="hljs-string">&#x27;shouquanma&#x27;</span><span class="hljs-comment">###ä½¿ç”¨qqé‚®ç®±ç”Ÿæˆçš„æˆæƒç </span><br>  smtp_require_tls: <span class="hljs-literal">false</span><br>  smtp_hello: <span class="hljs-string">&#x27;qq.com&#x27;</span><br>route:<br>  group_by: [<span class="hljs-string">&#x27;alertname&#x27;</span>] <br>  group_wait: 5s<br>  group_interval: 5s<br>  repeat_interval: 5m<br>  receiver: <span class="hljs-string">&#x27;email&#x27;</span><br>receivers:<br>- name: <span class="hljs-string">&#x27;email&#x27;</span><br>  email_configs:<br>  - to: <span class="hljs-string">&#x27;1962821461@qq.com&#x27;</span><span class="hljs-comment">###å‘é€è€…ä¿¡æ¯</span><br>    send_resolved: <span class="hljs-literal">true</span><br>inhibit_rules:<br>  - source_match:<br>      severity: <span class="hljs-string">&#x27;critical&#x27;</span><br>    target_match:<br>      severity: <span class="hljs-string">&#x27;warning&#x27;</span><br>    equal: [<span class="hljs-string">&#x27;alertname&#x27;</span>, <span class="hljs-string">&#x27;dev&#x27;</span>, <span class="hljs-string">&#x27;instance&#x27;</span>]<br></code></pre></td></tr></table></figure><p><strong>AlertManager.yml</strong>é…ç½®æ–‡ä»¶è¯¦è§£ï¼š</p><ul><li>globalï¼šå…¨å±€é…ç½®ï¼ŒåŒ…æ‹¬æŠ¥è­¦è§£å†³åçš„è¶…æ—¶æ—¶é—´ã€<strong>SMTP</strong>ç›¸å…³é…ç½®ã€å„ç§æ¸ é“é€šçŸ¥çš„<strong>API</strong>åœ°å€ç­‰æ–°æ¶ˆæ¯ã€‚</li><li>routeï¼šç”¨æ¥è®¾ç½®æŠ¥è­¦çš„åˆ†å‘ç­–ç•¥ã€‚</li><li>receiversï¼šé…ç½®å‘Šè­¦æ¶ˆæ¯æ¥æ”¶è€…ä¿¡æ¯ã€‚<br>â€‹- inhibit_rulesï¼šæŠ‘åˆ¶è§„åˆ™é…ç½®ï¼Œå½“å­˜åœ¨äºå¦ä¸€ç»„åŒ¹é…çš„è­¦æŠ¥æ—¶ï¼ŒæŠ‘åˆ¶è§„åˆ™å°†ç¦ç”¨äºä¸€ç»„åŒ¹é…çš„è­¦æŠ¥ã€‚</li></ul><h4 id="1-4ã€åˆ é™¤åˆšåˆšè¿è¡Œçš„å®¹å™¨ï¼ˆalertmanagerï¼‰ã€‚"><a href="#1-4ã€åˆ é™¤åˆšåˆšè¿è¡Œçš„å®¹å™¨ï¼ˆalertmanagerï¼‰ã€‚" class="headerlink" title="1.4ã€åˆ é™¤åˆšåˆšè¿è¡Œçš„å®¹å™¨ï¼ˆalertmanagerï¼‰ã€‚"></a>1.4ã€åˆ é™¤åˆšåˆšè¿è¡Œçš„å®¹å™¨ï¼ˆalertmanagerï¼‰ã€‚</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker1 ~]<span class="hljs-comment"># docker rm -f alertmanager </span><br>Alertmanager<br> <br>é‡æ–°è¿è¡Œå®¹å™¨ï¼š<br>[root@docker1 ~]<span class="hljs-comment"># docker run -d --name alertmanager --restart=always -p 9093:9093 -v /app/prometheus/alertmanager.yml:/etc/alertmanager/alertmanager.yml prom/alertmanager</span><br> <br></code></pre></td></tr></table></figure><h4 id="1-5ã€Prometheusé…ç½®alertmanageræŠ¥è­¦è§„åˆ™ï¼š"><a href="#1-5ã€Prometheusé…ç½®alertmanageræŠ¥è­¦è§„åˆ™ï¼š" class="headerlink" title="1.5ã€Prometheusé…ç½®alertmanageræŠ¥è­¦è§„åˆ™ï¼š"></a>1.5ã€Prometheusé…ç½®alertmanageræŠ¥è­¦è§„åˆ™ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker1 ~]<span class="hljs-comment"># mkdir -p /app/prometheus/rules</span><br>[root@docker1 ~]<span class="hljs-comment"># cd /app/prometheus/rules/</span><br>[root@docker1 rules]<span class="hljs-comment"># vim node-up.rules </span><br><span class="hljs-built_in">groups</span>:<br>- name: node-up<br>  rules:<br>  - alert: node-up<br>    <span class="hljs-built_in">expr</span>: up&#123;job=<span class="hljs-string">&quot;prometheus&quot;</span>&#125; == 0<span class="hljs-comment">#å¿…é¡»ä¸prometheusä¸­é…ç½®æ–‡ä»¶ï¼ˆymlæ–‡ä»¶ï¼‰ä¸­çš„  - job_name: &#x27;prometheus&#x27; ä¸€æ ·ã€‚å¯æ‰§è¡Œã€cat /app/prometheus.yml | grep  jobã€‘æŸ¥çœ‹ã€‚</span><br>    <span class="hljs-keyword">for</span>: 15s<br>    labels:<br>      severity: 1<br>      team: node<br>    annotations:<br>      summary: <span class="hljs-string">&quot;&#123;&#123; <span class="hljs-variable">$labels</span>.instance &#125;&#125; å·²åœæ­¢è¿è¡Œè¶…è¿‡ 15sï¼&quot;</span><br></code></pre></td></tr></table></figure><p>â€‹#å…·ä½“çš„è§„åˆ™æ€ä¹ˆå†™ï¼Œåœ¨å®˜ç½‘æ–‡æ¡£ä¸Šæœ‰è§„åˆ™æ¨¡æ¿ï¼š<a href="https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/">https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/</a></p><h4 id="1-6ã€é…ç½®å®ŒæŠ¥è­¦è§„åˆ™åï¼Œç¼–è¾‘prometheusçš„é…ç½®æ–‡ä»¶ï¼ˆæœ¬åœ°æŒ‚è½½çš„ï¼‰"><a href="#1-6ã€é…ç½®å®ŒæŠ¥è­¦è§„åˆ™åï¼Œç¼–è¾‘prometheusçš„é…ç½®æ–‡ä»¶ï¼ˆæœ¬åœ°æŒ‚è½½çš„ï¼‰" class="headerlink" title="1.6ã€é…ç½®å®ŒæŠ¥è­¦è§„åˆ™åï¼Œç¼–è¾‘prometheusçš„é…ç½®æ–‡ä»¶ï¼ˆæœ¬åœ°æŒ‚è½½çš„ï¼‰"></a>1.6ã€é…ç½®å®ŒæŠ¥è­¦è§„åˆ™åï¼Œç¼–è¾‘prometheusçš„é…ç½®æ–‡ä»¶ï¼ˆæœ¬åœ°æŒ‚è½½çš„ï¼‰</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@docker01</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># vim /app/prometheus.yml </span><br><span class="hljs-comment"># Alertmanager configuration</span><br><span class="hljs-attr">alerting:</span><br>  <span class="hljs-attr">alertmanagers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">static_configs:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.94</span><span class="hljs-number">.154</span><span class="hljs-string">:9093</span><span class="hljs-comment">#ä¿®æ”¹è¿™ä¸€è¡Œã€‚å¿…é¡»æ ¼å¤–æ³¨æ„é…ç½®æ–‡ä»¶çš„æ ¼å¼ï¼Œæ³¨æ„ç¼©è¿›ã€‚</span><br>      <br><span class="hljs-attr">rule_files:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;/usr/local/prometheus/rules/*.rules&quot;</span><span class="hljs-comment">#æ·»åŠ è¯¥è¡Œï¼Œæ­¤ä¸ºå®¹å™¨å†…çš„è·¯å¾„ï¼Œæ˜¯æˆ‘ä»¬åˆšåˆšå®šä¹‰çš„æŠ¥è­¦è§„åˆ™ã€‚</span><br>  <span class="hljs-comment"># - &quot;first_rules.yml&quot;</span><br>  <span class="hljs-comment"># - &quot;second_rules.yml&quot;</span><br></code></pre></td></tr></table></figure><h4 id="1-7ã€åˆ é™¤Prometheusçš„å®¹å™¨ï¼š"><a href="#1-7ã€åˆ é™¤Prometheusçš„å®¹å™¨ï¼š" class="headerlink" title="1.7ã€åˆ é™¤Prometheusçš„å®¹å™¨ï¼š"></a>1.7ã€åˆ é™¤Prometheusçš„å®¹å™¨ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker <span class="hljs-built_in">rm</span> -f prometheus <br></code></pre></td></tr></table></figure><h4 id="1-8ã€é‡æ–°è¿è¡Œprometheuså®¹å™¨ï¼š"><a href="#1-8ã€é‡æ–°è¿è¡Œprometheuså®¹å™¨ï¼š" class="headerlink" title="1.8ã€é‡æ–°è¿è¡Œprometheuså®¹å™¨ï¼š"></a>1.8ã€é‡æ–°è¿è¡Œprometheuså®¹å™¨ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d -p 9090:9090 --name prometheus  --restart=always --net=host \<br>-v /app/prometheus.yml:/etc/prometheus/prometheus.yml \<br>-v /app/prometheus/rules:/usr/local/prometheus/rules  prom/prometheus<br></code></pre></td></tr></table></figure><h3 id="2ã€ï¼‰åˆ›å»ºç›‘æ§è§„åˆ™ï¼Œä½¿ç”¨emailæŠ¥è­¦æ–¹å¼ã€‚ç›‘æ§æœåŠ¡è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœæœåŠ¡èŠ‚ç‚¹downæœºçŠ¶æ€ï¼Œåˆ™å‘é€é‚®ä»¶ã€‚"><a href="#2ã€ï¼‰åˆ›å»ºç›‘æ§è§„åˆ™ï¼Œä½¿ç”¨emailæŠ¥è­¦æ–¹å¼ã€‚ç›‘æ§æœåŠ¡è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœæœåŠ¡èŠ‚ç‚¹downæœºçŠ¶æ€ï¼Œåˆ™å‘é€é‚®ä»¶ã€‚" class="headerlink" title="2ã€ï¼‰åˆ›å»ºç›‘æ§è§„åˆ™ï¼Œä½¿ç”¨emailæŠ¥è­¦æ–¹å¼ã€‚ç›‘æ§æœåŠ¡è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœæœåŠ¡èŠ‚ç‚¹downæœºçŠ¶æ€ï¼Œåˆ™å‘é€é‚®ä»¶ã€‚"></a>2ã€ï¼‰åˆ›å»ºç›‘æ§è§„åˆ™ï¼Œä½¿ç”¨emailæŠ¥è­¦æ–¹å¼ã€‚ç›‘æ§æœåŠ¡è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœæœåŠ¡èŠ‚ç‚¹downæœºçŠ¶æ€ï¼Œåˆ™å‘é€é‚®ä»¶ã€‚</h3><h4 id="2-1ã€è®¿é—®ï¼šhttp-192-168-94-154-9090-rulesï¼ŒéªŒè¯æŸ¥è¯¢æŠ¥è­¦è§„åˆ™"><a href="#2-1ã€è®¿é—®ï¼šhttp-192-168-94-154-9090-rulesï¼ŒéªŒè¯æŸ¥è¯¢æŠ¥è­¦è§„åˆ™" class="headerlink" title="2.1ã€è®¿é—®ï¼šhttp://192.168.94.154:9090/rulesï¼ŒéªŒè¯æŸ¥è¯¢æŠ¥è­¦è§„åˆ™"></a>2.1ã€è®¿é—®ï¼š<a href="http://192.168.94.154:9090/rules%EF%BC%8C%E9%AA%8C%E8%AF%81%E6%9F%A5%E8%AF%A2%E6%8A%A5%E8%AD%A6%E8%A7%84%E5%88%99">http://192.168.94.154:9090/rulesï¼ŒéªŒè¯æŸ¥è¯¢æŠ¥è­¦è§„åˆ™</a></h4><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20220302153227063.png" alt="image-20220302153227063"></p><h4 id="2-2ã€å°†docker3æœºå™¨çš„node-exporteræœåŠ¡åœæ­¢ï¼Œæµ‹è¯•æ˜¯å¦ä¼šæ¨é€é‚®ä»¶ã€‚"><a href="#2-2ã€å°†docker3æœºå™¨çš„node-exporteræœåŠ¡åœæ­¢ï¼Œæµ‹è¯•æ˜¯å¦ä¼šæ¨é€é‚®ä»¶ã€‚" class="headerlink" title="2.2ã€å°†docker3æœºå™¨çš„node-exporteræœåŠ¡åœæ­¢ï¼Œæµ‹è¯•æ˜¯å¦ä¼šæ¨é€é‚®ä»¶ã€‚"></a>2.2ã€å°†docker3æœºå™¨çš„node-exporteræœåŠ¡åœæ­¢ï¼Œæµ‹è¯•æ˜¯å¦ä¼šæ¨é€é‚®ä»¶ã€‚</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker3 ~]<span class="hljs-comment"># docker stop node-exporter </span><br></code></pre></td></tr></table></figure><p>ä¼šæ¨é€é‚®ä»¶åˆ°æŒ‡å®šçš„é‚®ä»¶æ¥æ”¶äºº:</p><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20220302153640005.png" alt="image-20220302153640005"></p><p><strong>Altermanageré…ç½®è‡ªå®šä¹‰é‚®ä»¶æ¨¡æ¿</strong></p><p><code>å¯å‚è€ƒæ–‡æ¡£ï¼šhttps://www.appblog.cn/2019/09/09/Prometheus%20+%20Alertmanager%20%E6%8A%A5%E8%AD%A6%E5%AE%9E%E7%8E%B0%EF%BC%88email%E6%8A%A5%E8%AD%A6%EF%BC%89/</code></p><h4 id="2-3ã€åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾email-tmpl"><a href="#2-3ã€åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾email-tmpl" class="headerlink" title="2.3ã€åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾email.tmpl"></a>2.3ã€åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾email.tmpl</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker01 prometheus]<span class="hljs-comment"># mkdir -p  /app/prometheus/alertmanager-tmpl</span><br>[root@docker01 prometheus]<span class="hljs-comment"># ls</span><br>alertmanager-tmpl  rules<br>[root@docker01 prometheus]<span class="hljs-comment"># cd alertmanager-tmpl/</span><br>[root@docker01 alertmanager-tmpl]<span class="hljs-comment"># vim email.tmpl</span><br>&#123;&#123; define <span class="hljs-string">&quot;email.html&quot;</span> &#125;&#125;<br>&lt;table border=<span class="hljs-string">&quot;1&quot;</span>&gt;<br>    &lt;<span class="hljs-built_in">tr</span>&gt;<br>        &lt;td&gt;æŠ¥è­¦é¡¹&lt;/td&gt;<br>        &lt;td&gt;å‘Šè­¦çº§åˆ«&lt;/td&gt;<br>        &lt;td&gt;æ•…éšœä¸»æœº&lt;/td&gt;<br>        &lt;td&gt;å‘Šè­¦ä¸»é¢˜&lt;/td&gt;<br>        &lt;td&gt;è§¦å‘æ—¶é—´&lt;/td&gt;<br>    &lt;/tr&gt;<br>    &#123;&#123; range <span class="hljs-variable">$i</span>, <span class="hljs-variable">$alert</span> := .Alerts &#125;&#125;<br>        &lt;<span class="hljs-built_in">tr</span>&gt;<br>            &lt;td&gt;&#123;&#123; index <span class="hljs-variable">$alert</span>.Labels <span class="hljs-string">&quot;alertname&quot;</span> &#125;&#125;&lt;/td&gt;<br>            &lt;td&gt;&#123;&#123; index <span class="hljs-variable">$alert</span>.Labels <span class="hljs-string">&quot;severity&quot;</span> &#125;&#125;çº§&lt;/td&gt;<br>            &lt;td&gt;&#123;&#123; index <span class="hljs-variable">$alert</span>.Labels <span class="hljs-string">&quot;instance&quot;</span> &#125;&#125;&lt;/td&gt;<br>            &lt;td&gt;&#123;&#123; index <span class="hljs-variable">$alert</span>.Annotations <span class="hljs-string">&quot;summary&quot;</span> &#125;&#125;&lt;/td&gt;<br>            &lt;td&gt;&#123;&#123; <span class="hljs-variable">$alert</span>.StartsAt &#125;&#125;&lt;/td&gt;<br>        &lt;/tr&gt;<br>    &#123;&#123; end &#125;&#125;<br>&lt;/table&gt;<br>&#123;&#123; end &#125;&#125;<br></code></pre></td></tr></table></figure><h4 id="2-4ã€ç¼–è¾‘å®Œæˆåï¼Œä¿å­˜é€€å‡ºï¼Œç¼–è¾‘alertmanageré…ç½®æ–‡ä»¶ã€‚"><a href="#2-4ã€ç¼–è¾‘å®Œæˆåï¼Œä¿å­˜é€€å‡ºï¼Œç¼–è¾‘alertmanageré…ç½®æ–‡ä»¶ã€‚" class="headerlink" title="2.4ã€ç¼–è¾‘å®Œæˆåï¼Œä¿å­˜é€€å‡ºï¼Œç¼–è¾‘alertmanageré…ç½®æ–‡ä»¶ã€‚"></a>2.4ã€ç¼–è¾‘å®Œæˆåï¼Œä¿å­˜é€€å‡ºï¼Œç¼–è¾‘alertmanageré…ç½®æ–‡ä»¶ã€‚</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@docker01 ~]<span class="hljs-comment"># vim /app/prometheus/alertmanager.yml </span><br>global:<br>  resolve_timeout: 5m<br>  smtp_from: <span class="hljs-string">&#x27;1962821461@qq.com&#x27;</span>                 <span class="hljs-comment">###å‘é€è€…ä¿¡æ¯</span><br>  smtp_smarthost: <span class="hljs-string">&#x27;smtp.qq.com:465&#x27;</span>             <span class="hljs-comment">###qqé‚®ç®±çš„SMTPæœåŠ¡å™¨åœ°å€</span><br>  smtp_auth_username: <span class="hljs-string">&#x27;1962821461@qq.com&#x27;</span>                <span class="hljs-comment">###æ¥æ”¶è€…ä¿¡æ¯</span><br>  smtp_auth_password: <span class="hljs-string">&#x27;iehrzrphebqmgace&#x27;</span>                <span class="hljs-comment">###ä½¿ç”¨qqé‚®ç®±ç”Ÿæˆçš„æˆæƒç </span><br>  smtp_require_tls: <span class="hljs-literal">false</span><br>  smtp_hello: <span class="hljs-string">&#x27;qq.com&#x27;</span><br>templates:               <span class="hljs-comment">#æ·»åŠ æ­¤è¡Œ</span><br>  - <span class="hljs-string">&#x27;/etc/alertmanager-tmpl/*.tmpl&#x27;</span>     <span class="hljs-comment">#å®¹å™¨å†…çš„è·¯å¾„ï¼Œéœ€è¦å»æŒ‚è½½ä¸€ä¸‹ã€‚</span><br>route:<br>  group_by: [<span class="hljs-string">&#x27;alertname&#x27;</span>]<br>  group_wait: 5s<br>  group_interval: 5s<br>  repeat_interval: 5m<br>  receiver: <span class="hljs-string">&#x27;email&#x27;</span><br>receivers:<br>- name: <span class="hljs-string">&#x27;email&#x27;</span><br>  email_configs:<br> - to: <span class="hljs-string">&#x27;&#123;&#123; template &quot;email.to&quot; &#125;&#125;&#x27;</span>  <span class="hljs-comment">#æ¥æ”¶è­¦æŠ¥çš„emailé…ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å†™é‚®ç®±åœ°å€ï¼Œä¾‹å¦‚ï¼š  - to: &#x27;1962821461@qq.com&#x27;</span><br>    html: <span class="hljs-string">&#x27;&#123;&#123; template &quot;email.html&quot; . &#125;&#125;&#x27;</span><span class="hljs-comment">#è®¾å®šé‚®ç®±çš„å†…å®¹æ¨¡æ¿ï¼Œå¿…é¡»å’Œemail.tmplä¸­çš„&#123;&#123; define &quot;email.html&quot; &#125;&#125; å¯¹åº”</span><br>    headers: &#123; Subject: <span class="hljs-string">&quot;[WARN] æŠ¥è­¦é‚®ä»¶&quot;</span>&#125;   <span class="hljs-comment">## æ¥æ”¶é‚®ä»¶çš„æ ‡é¢˜</span><br>    send_resolved: <span class="hljs-literal">true</span><br>inhibit_rules:<br>  - source_match:<br>      severity: <span class="hljs-string">&#x27;critical&#x27;</span><br>    target_match:<br>      severity: <span class="hljs-string">&#x27;warning&#x27;</span><br>    equal: [<span class="hljs-string">&#x27;alertname&#x27;</span>, <span class="hljs-string">&#x27;dev&#x27;</span>, <span class="hljs-string">&#x27;instance&#x27;</span>]<br></code></pre></td></tr></table></figure><h4 id="2-5ã€å°†alertmanagerå®¹å™¨åˆ é™¤ï¼Œé‡æ–°è¿è¡Œã€‚é‡æ–°è¿è¡Œalertmanagerå®¹å™¨ï¼Œå¹¶æŒ‚è½½æ¨¡æ¿æ–‡ä»¶ã€‚"><a href="#2-5ã€å°†alertmanagerå®¹å™¨åˆ é™¤ï¼Œé‡æ–°è¿è¡Œã€‚é‡æ–°è¿è¡Œalertmanagerå®¹å™¨ï¼Œå¹¶æŒ‚è½½æ¨¡æ¿æ–‡ä»¶ã€‚" class="headerlink" title="2.5ã€å°†alertmanagerå®¹å™¨åˆ é™¤ï¼Œé‡æ–°è¿è¡Œã€‚é‡æ–°è¿è¡Œalertmanagerå®¹å™¨ï¼Œå¹¶æŒ‚è½½æ¨¡æ¿æ–‡ä»¶ã€‚"></a>2.5ã€å°†alertmanagerå®¹å™¨åˆ é™¤ï¼Œé‡æ–°è¿è¡Œã€‚é‡æ–°è¿è¡Œalertmanagerå®¹å™¨ï¼Œå¹¶æŒ‚è½½æ¨¡æ¿æ–‡ä»¶ã€‚</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker <span class="hljs-built_in">rm</span> -f alertmanager<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d --name alertmanger --restart=always -p 9093:9093 -v /app/prometheus/alertmanager.yml:/etc/alertmanager/alertmanager.yml -v /app/prometheus/alertmanager-tmpl:/etc/alertmanager-tmpl \<br>prom/alertmanager<br></code></pre></td></tr></table></figure><h4 id="2-6ã€é‚®ä»¶å¯æ¥æ”¶åˆ°å¦‚ä¸‹ä¿¡æ¯ã€‚"><a href="#2-6ã€é‚®ä»¶å¯æ¥æ”¶åˆ°å¦‚ä¸‹ä¿¡æ¯ã€‚" class="headerlink" title="2.6ã€é‚®ä»¶å¯æ¥æ”¶åˆ°å¦‚ä¸‹ä¿¡æ¯ã€‚"></a>2.6ã€é‚®ä»¶å¯æ¥æ”¶åˆ°å¦‚ä¸‹ä¿¡æ¯ã€‚</h4><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20220302170928150.png" alt="image-20220302170928150"></p><h3 id="3ã€ï¼‰èåˆé‚®ä»¶-larké£ä¹¦ã€é’‰é’‰åŒæ—¶å‘Šè­¦ï¼ˆéœ€è¦å®‰è£…prometheus-alertï¼‰"><a href="#3ã€ï¼‰èåˆé‚®ä»¶-larké£ä¹¦ã€é’‰é’‰åŒæ—¶å‘Šè­¦ï¼ˆéœ€è¦å®‰è£…prometheus-alertï¼‰" class="headerlink" title="3ã€ï¼‰èåˆé‚®ä»¶+larké£ä¹¦ã€é’‰é’‰åŒæ—¶å‘Šè­¦ï¼ˆéœ€è¦å®‰è£…prometheus-alertï¼‰**"></a>3ã€ï¼‰èåˆé‚®ä»¶+larké£ä¹¦ã€é’‰é’‰åŒæ—¶å‘Šè­¦ï¼ˆéœ€è¦å®‰è£…prometheus-alertï¼‰**</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/yyuggjggg/article/details/122862496<br>å‚è€ƒæ–‡æ¡£ï¼šhttps://feiyu563.gitbook.io/prometheusalert/base-install<br></code></pre></td></tr></table></figure><h4 id="3-1ã€ä½¿ç”¨dockerè¿è¡Œprometheus-alert"><a href="#3-1ã€ä½¿ç”¨dockerè¿è¡Œprometheus-alert" class="headerlink" title="3.1ã€ä½¿ç”¨dockerè¿è¡Œprometheus-alert"></a>3.1ã€ä½¿ç”¨dockerè¿è¡Œprometheus-alert</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ›å»ºé…ç½®æ–‡ä»¶</span><br><span class="hljs-built_in">mkdir</span> /etc/prometheusalert-center/<br>wget https://raw.githubusercontent.com/feiyu563/PrometheusAlert/master/conf/app-example.conf -O /etc/prometheusalert-center/app.conf<br><br><span class="hljs-comment">#å¯åŠ¨PrometheusAlertå¹¶æŒ‚è½½é…ç½®æ–‡ä»¶</span><br>docker run -d -p 9999:8080 -v /etc/prometheusalert-center:/app/conf --name prometheusalert-center feiyu563/prometheus-alert:latest<br><br><span class="hljs-comment">#å¯åŠ¨åå¯ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ä»¥ä¸‹åœ°å€æŸ¥çœ‹ï¼šhttp://127.0.0.1:9999</span><br><span class="hljs-comment">#é»˜è®¤ç™»å½•å¸å·å’Œå¯†ç åœ¨app.confä¸­æœ‰é…ç½®ï¼š</span><br><span class="hljs-comment">#è´¦å·ï¼šå¯†ç </span><br>login_user=prometheusalert          <br><span class="hljs-comment">#............                                                                                  </span><br>login_password=prometheusalert <br><br><br><span class="hljs-comment">#ä»¥ä¸‹ä¸ºè®¾ç½®ç¯å¢ƒå˜é‡ä¼ å‚</span><br>docker run -d \<br>-p 8080:8080 \<br>-e PA_LOGIN_USER=prometheusalert \<br>-e PA_LOGIN_PASSWORD=prometheusalert \<br>-e PA_TITLE=PrometheusAlert \<br>-e PA_OPEN_FEISHU=1 \<br>-e PA_OPEN_DINGDING=1 \<br>-e PA_OPEN_WEIXIN=1 \<br>feiyu563/prometheus-alert:latest<br><span class="hljs-comment">#è®¾ç½®çš„è´¦å·å¯†ç ä¸ºï¼šprometheusalert</span><br></code></pre></td></tr></table></figure><h4 id="3-2ã€è¿è¡Œåæ‰“å¼€prometheus-alertå¹¶ç™»å½•"><a href="#3-2ã€è¿è¡Œåæ‰“å¼€prometheus-alertå¹¶ç™»å½•" class="headerlink" title="3.2ã€è¿è¡Œåæ‰“å¼€prometheus-alertå¹¶ç™»å½•"></a>3.2ã€è¿è¡Œåæ‰“å¼€prometheus-alertå¹¶ç™»å½•</h4><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20221216113452790.png" alt="image-20221216113452790"></p><h4 id="3-3ã€æ ¹æ®è‡ªå·±éœ€æ±‚ï¼Œå¤åˆ¶é»˜è®¤è‡ªå¸¦çš„æ¨¡æ¿è·¯å¾„urlï¼ˆä¹Ÿå¯è‡ªå·±æ·»åŠ æ¨¡æ¿ï¼Œè‡ªå·±æ·»åŠ æ¨¡æ¿æ­¥éª¤å·²ç•¥è¿‡ï¼‰"><a href="#3-3ã€æ ¹æ®è‡ªå·±éœ€æ±‚ï¼Œå¤åˆ¶é»˜è®¤è‡ªå¸¦çš„æ¨¡æ¿è·¯å¾„urlï¼ˆä¹Ÿå¯è‡ªå·±æ·»åŠ æ¨¡æ¿ï¼Œè‡ªå·±æ·»åŠ æ¨¡æ¿æ­¥éª¤å·²ç•¥è¿‡ï¼‰" class="headerlink" title="3.3ã€æ ¹æ®è‡ªå·±éœ€æ±‚ï¼Œå¤åˆ¶é»˜è®¤è‡ªå¸¦çš„æ¨¡æ¿è·¯å¾„urlï¼ˆä¹Ÿå¯è‡ªå·±æ·»åŠ æ¨¡æ¿ï¼Œè‡ªå·±æ·»åŠ æ¨¡æ¿æ­¥éª¤å·²ç•¥è¿‡ï¼‰"></a>3.3ã€æ ¹æ®è‡ªå·±éœ€æ±‚ï¼Œå¤åˆ¶é»˜è®¤è‡ªå¸¦çš„æ¨¡æ¿è·¯å¾„urlï¼ˆä¹Ÿå¯è‡ªå·±æ·»åŠ æ¨¡æ¿ï¼Œè‡ªå·±æ·»åŠ æ¨¡æ¿æ­¥éª¤å·²ç•¥è¿‡ï¼‰</h4><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20221216113631968.png" alt="image-20221216113631968"></p><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20221216120124489.png" alt="image-20221216120124489"></p><p>ä¾‹å¦‚æˆ‘çš„ä¸ºï¼š<a href="http://192.168.62.128:9999/prometheusalert?type=fs&tpl=prometheus-fsv2&fsurl=https://open.larksuite.com/open-apis/bot/v2/hook/00af844f-26a1-4f20-8a36-ec31e4879eab">http://192.168.62.128:9999/prometheusalert?type=fs&amp;tpl=prometheus-fsv2&amp;fsurl=https://open.larksuite.com/open-apis/bot/v2/hook/00af844f-26a1-4f20-8a36-ec31e4879eab</a></p><h4 id="3-4ã€ç¼–è¾‘alertmanageré…ç½®æ–‡ä»¶"><a href="#3-4ã€ç¼–è¾‘alertmanageré…ç½®æ–‡ä»¶" class="headerlink" title="3.4ã€ç¼–è¾‘alertmanageré…ç½®æ–‡ä»¶"></a>3.4ã€ç¼–è¾‘alertmanageré…ç½®æ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@localhost ~]<span class="hljs-comment"># cat /app/prometheus/alertmanager.yml</span><br>global:<br>  resolve_timeout: 5m<br>  smtp_from: <span class="hljs-string">&#x27;1962821461@qq.com&#x27;</span>                 <span class="hljs-comment">###å‘é€è€…ä¿¡æ¯</span><br>  smtp_smarthost: <span class="hljs-string">&#x27;smtp.qq.com:465&#x27;</span>             <span class="hljs-comment">###qqé‚®ç®±çš„SMTPæœåŠ¡å™¨åœ°å€</span><br>  smtp_auth_username: <span class="hljs-string">&#x27;1962821461@qq.com&#x27;</span>                <span class="hljs-comment">###æ¥æ”¶è€…ä¿¡æ¯</span><br>  smtp_auth_password: <span class="hljs-string">&#x27;iehrzrphebqmgace&#x27;</span>                <span class="hljs-comment">###ä½¿ç”¨qqé‚®ç®±ç”Ÿæˆçš„æˆæƒç </span><br>  smtp_require_tls: <span class="hljs-literal">false</span><br>  smtp_hello: <span class="hljs-string">&#x27;qq.com&#x27;</span><br>templates:               <span class="hljs-comment">#æ·»åŠ æ­¤è¡Œ</span><br>  - <span class="hljs-string">&#x27;/etc/alertmanager-tmpl/*.tmpl&#x27;</span>     <span class="hljs-comment">#å®¹å™¨å†…çš„è·¯å¾„ï¼Œéœ€è¦å»æŒ‚è½½ä¸€ä¸‹ã€‚</span><br>route:<br>  group_by: [<span class="hljs-string">&#x27;alertname&#x27;</span>]<br>  group_wait: 5s<br>  group_interval: 5s<br>  repeat_interval: 15s<br>  receiver: <span class="hljs-string">&#x27;email&#x27;</span><br>  <br>receivers:<br>- name: <span class="hljs-string">&#x27;email&#x27;</span><br>  email_configs:<br>  - to: <span class="hljs-string">&#x27;1962821461@qq.com&#x27;</span>  <span class="hljs-comment">#æ¥æ”¶è­¦æŠ¥çš„emailé…ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å†™é‚®ç®±åœ°å€ï¼Œä¾‹å¦‚ï¼š  - to: &#x27;1962821461@qq.com&#x27;</span><br>    html: <span class="hljs-string">&#x27;&#123;&#123; template &quot;email.html&quot; . &#125;&#125;&#x27;</span>   <span class="hljs-comment">#è®¾å®šé‚®ç®±çš„å†…å®¹æ¨¡æ¿ï¼Œå¿…é¡»å’Œemail.tmplä¸­çš„&#123;&#123; define &quot;email.html&quot; &#125;&#125; å¯¹åº”</span><br>    headers: &#123; Subject: <span class="hljs-string">&quot;[WARN] æŠ¥è­¦é‚®ä»¶&quot;</span>&#125;   <span class="hljs-comment">## æ¥æ”¶é‚®ä»¶çš„æ ‡é¢˜</span><br>    send_resolved: <span class="hljs-literal">true</span><br><span class="hljs-comment">#ä¸ºè‡ªå®šä¹‰æœºå™¨äººç”Ÿæˆçš„ webhook åœ°å€ï¼Œéœ€ä¿®æ”¹æˆè‡ªå·±çš„</span><br>  webhook_configs:<br>    - url: <span class="hljs-string">&quot;http://192.168.62.128:9999/prometheusalert?type=fs&amp;tpl=prometheus-fsv2&amp;fsurl=https://open.larksuite.com/open-apis/bot/v2/hook/00af844f-26a1-4f20-8a36-ec31e4879eab&quot;</span><br><br>inhibit_rules:<br>  - source_match:<br>      severity: <span class="hljs-string">&#x27;critical&#x27;</span><br>    target_match:<br>      severity: <span class="hljs-string">&#x27;warning&#x27;</span><br>    equal: [<span class="hljs-string">&#x27;alertname&#x27;</span>, <span class="hljs-string">&#x27;dev&#x27;</span>, <span class="hljs-string">&#x27;instance&#x27;</span>]<br></code></pre></td></tr></table></figure><h4 id="3-5ã€é‡å¯alertmanageræœåŠ¡"><a href="#3-5ã€é‡å¯alertmanageræœåŠ¡" class="headerlink" title="3.5ã€é‡å¯alertmanageræœåŠ¡"></a>3.5ã€é‡å¯alertmanageræœåŠ¡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker restart alertmanager<br></code></pre></td></tr></table></figure><h4 id="3-6ã€åœæ­¢ç›‘æ§çš„é¡¹åå³å¯æ¥æ”¶åˆ°é£ä¹¦å’Œé‚®ä»¶å‘Šè­¦"><a href="#3-6ã€åœæ­¢ç›‘æ§çš„é¡¹åå³å¯æ¥æ”¶åˆ°é£ä¹¦å’Œé‚®ä»¶å‘Šè­¦" class="headerlink" title="3.6ã€åœæ­¢ç›‘æ§çš„é¡¹åå³å¯æ¥æ”¶åˆ°é£ä¹¦å’Œé‚®ä»¶å‘Šè­¦"></a>3.6ã€åœæ­¢ç›‘æ§çš„é¡¹åå³å¯æ¥æ”¶åˆ°é£ä¹¦å’Œé‚®ä»¶å‘Šè­¦</h4><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20221216114556777.png" alt="image-20221216114556777"></p><p><img src="/2023/04/10/%E7%9B%91%E6%8E%A7/Prometheus/Docker%E5%AE%89%E8%A3%85Prometheus%E4%B9%8B%E9%83%A8%E7%BD%B2%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%9D%BF/image-20221216114644906.png" alt="image-20221216114644906"></p><h3 id="4ã€ï¼‰å½“åªéœ€è¦é’‰é’‰æˆ–è€…é£ä¹¦å‘Šè­¦æ—¶"><a href="#4ã€ï¼‰å½“åªéœ€è¦é’‰é’‰æˆ–è€…é£ä¹¦å‘Šè­¦æ—¶" class="headerlink" title="4ã€ï¼‰å½“åªéœ€è¦é’‰é’‰æˆ–è€…é£ä¹¦å‘Šè­¦æ—¶"></a>4ã€ï¼‰å½“åªéœ€è¦é’‰é’‰æˆ–è€…é£ä¹¦å‘Šè­¦æ—¶</h3><p><strong>## å¤‡æ³¨ï¼šå¦‚æœä¸éœ€è¦é‚®ä»¶å‘Šè­¦ï¼Œå¯ç›´æ¥ç•¥è¿‡æ­¥éª¤äºŒä¸­çš„2ã€ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ç•¥è¿‡ä¹Ÿä¸å½±å“ç»“æœï¼åªéœ€è¦ä¿®æ”¹alertmanager.ymlæ–‡ä»¶</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@localhost</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># cat /app/prometheus/alertmanager.yml</span><br><span class="hljs-attr">global:</span><br>  <span class="hljs-attr">resolve_timeout:</span> <span class="hljs-string">1m</span><br><span class="hljs-attr">route:</span><br>  <span class="hljs-attr">group_by:</span> [<span class="hljs-string">&#x27;alertname&#x27;</span>]<br>  <span class="hljs-attr">group_wait:</span> <span class="hljs-string">5s</span><br>  <span class="hljs-attr">group_interval:</span> <span class="hljs-string">5s</span><br>  <span class="hljs-attr">repeat_interval:</span> <span class="hljs-string">1m</span><br>  <span class="hljs-attr">receiver:</span> <span class="hljs-string">&#x27;prometheusalert-feishu&#x27;</span><br><span class="hljs-comment">#  receiver: &#x27;web.hook.prometheusalert&#x27;</span><br><span class="hljs-comment">#  routes:</span><br><span class="hljs-comment">#  - receiver: &#x27;prometheusalert-feishu&#x27;</span><br><span class="hljs-comment">#    group_wait: 10s</span><br><span class="hljs-comment">#    match:</span><br><span class="hljs-comment">#      level: &#x27;2&#x27;</span><br><span class="hljs-attr">receivers:</span><br><span class="hljs-comment">#- name: &#x27;web.hook.prometheusalert&#x27;</span><br><span class="hljs-comment">#  webhook_configs:</span><br><span class="hljs-comment">#  - url: &quot;http://[prometheusalert_url]:9999/prometheusalert/alert&quot;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;prometheusalert-feishu&#x27;</span><br><span class="hljs-comment">#ä¸ºè‡ªå®šä¹‰æœºå™¨äººç”Ÿæˆçš„ webhook åœ°å€ï¼Œéœ€ä¿®æ”¹æˆè‡ªå·±çš„</span><br>  <span class="hljs-attr">webhook_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">&quot;http://192.168.62.128:9999/prometheusalert?type=fs&amp;tpl=prometheus-fsv2&amp;fsurl=https://open.larksuite.com/open-apis/bot/v2/hook/00af844f-26a1-4f20-8a36-ec31e4879eab&quot;</span><br><br></code></pre></td></tr></table></figure><h3 id="5ã€ï¼‰æœªæ¨é€é£ä¹¦æ¶ˆæ¯æ—¶ï¼ŒæŸ¥çœ‹æ—¥å¿—æç¤ºé£ä¹¦æ¥å£æœªé…ç½®æœªå¼€å¯çŠ¶æ€-è¯·å…ˆé…ç½®open-feishuä¸º1"><a href="#5ã€ï¼‰æœªæ¨é€é£ä¹¦æ¶ˆæ¯æ—¶ï¼ŒæŸ¥çœ‹æ—¥å¿—æç¤ºé£ä¹¦æ¥å£æœªé…ç½®æœªå¼€å¯çŠ¶æ€-è¯·å…ˆé…ç½®open-feishuä¸º1" class="headerlink" title="5ã€ï¼‰æœªæ¨é€é£ä¹¦æ¶ˆæ¯æ—¶ï¼ŒæŸ¥çœ‹æ—¥å¿—æç¤ºé£ä¹¦æ¥å£æœªé…ç½®æœªå¼€å¯çŠ¶æ€,è¯·å…ˆé…ç½®open-feishuä¸º1"></a>5ã€ï¼‰æœªæ¨é€é£ä¹¦æ¶ˆæ¯æ—¶ï¼ŒæŸ¥çœ‹æ—¥å¿—æç¤ºé£ä¹¦æ¥å£æœªé…ç½®æœªå¼€å¯çŠ¶æ€,è¯·å…ˆé…ç½®open-feishuä¸º1</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">1.è¿›å…¥å®¹å™¨å†…<br><br>2.ä¿®æ”¹/app/conf/app.confæ–‡ä»¶<br><br>ä¿®æ”¹æˆï¼šopen-feishu=1<br><br>3.é‡å¯prometheus-alertæœåŠ¡<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç›‘æ§</category>
      
      <category>prometheus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntuå®‰è£…slurm</title>
    <link href="/2023/04/07/%E4%B8%AD%E9%97%B4%E4%BB%B6/slurm/Ubuntu%E5%AE%89%E8%A3%85slurm/"/>
    <url>/2023/04/07/%E4%B8%AD%E9%97%B4%E4%BB%B6/slurm/Ubuntu%E5%AE%89%E8%A3%85slurm/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Ubuntuå®‰è£…slurm"><a href="#Ubuntuå®‰è£…slurm" class="headerlink" title="Ubuntuå®‰è£…slurm"></a>Ubuntuå®‰è£…slurm</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttp://t.csdn.cn/0nZEE<br></code></pre></td></tr></table></figure><p><strong>æ¼”ç¤ºç¯å¢ƒ</strong></p><table><thead><tr><th>æœåŠ¡å™¨ip</th><th>ç³»ç»Ÿ</th><th>å®‰è£…æœåŠ¡</th></tr></thead><tbody><tr><td>192.168.94.128</td><td>Ubuntu 20.04.5</td><td>mysqlã€slurm</td></tr></tbody></table><h2 id="ä¸€ã€å®‰è£…å¿…è¦åº“æ–‡ä»¶"><a href="#ä¸€ã€å®‰è£…å¿…è¦åº“æ–‡ä»¶" class="headerlink" title="ä¸€ã€å®‰è£…å¿…è¦åº“æ–‡ä»¶"></a>ä¸€ã€å®‰è£…å¿…è¦åº“æ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo su -<br>apt-get install make hwloc libhwloc-dev libmunge-dev libmunge2 munge libmysqlclient-dev -y<br></code></pre></td></tr></table></figure><h2 id="äºŒã€å¯åŠ¨mungeæœåŠ¡"><a href="#äºŒã€å¯åŠ¨mungeæœåŠ¡" class="headerlink" title="äºŒã€å¯åŠ¨mungeæœåŠ¡"></a>äºŒã€å¯åŠ¨mungeæœåŠ¡</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è®¾ç½®mungeå¼€æœºè‡ªå¯åŠ¨</span><br>systemctl <span class="hljs-built_in">enable</span> munge   <br><span class="hljs-comment">#å¯åŠ¨mungeæœåŠ¡</span><br>systemctl start munge    <br><span class="hljs-comment">#æŸ¥çœ‹mungeçŠ¶æ€</span><br>systemctl status munge   <br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€ç¼–è¯‘å®‰è£…slurm"><a href="#ä¸‰ã€ç¼–è¯‘å®‰è£…slurm" class="headerlink" title="ä¸‰ã€ç¼–è¯‘å®‰è£…slurm"></a>ä¸‰ã€ç¼–è¯‘å®‰è£…slurm</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¸‹è½½å®‰è£…åŒ…</span><br>wget https://download.schedmd.com/slurm/slurm-20.11.9.tar.bz2<br><br><span class="hljs-comment">#è§£å‹å®‰è£…åŒ…</span><br>tar -jxvf slurm-20.11.9.tar.bz2 <br><br><span class="hljs-comment">#è¿›å…¥è§£å‹åçš„æ–‡ä»¶å¤¹ä¸­</span><br><span class="hljs-built_in">cd</span> slurm-20.11.9<br><br><span class="hljs-comment">#ç¼–è¯‘å®‰è£…ï¼ŒæŒ‡å®šè·¯å¾„</span><br>./configure --prefix=/opt/slurm/20.11.9 --sysconfdir=/opt/slurm/20.11.9/etc<br>make -j16<br>make install<br><br></code></pre></td></tr></table></figure><h2 id="å››ã€æ‹·è´é…ç½®æ–‡ä»¶"><a href="#å››ã€æ‹·è´é…ç½®æ–‡ä»¶" class="headerlink" title="å››ã€æ‹·è´é…ç½®æ–‡ä»¶"></a>å››ã€æ‹·è´é…ç½®æ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ‹·è´serviceå¯åŠ¨è„šæœ¬</span><br><span class="hljs-built_in">cp</span> -r etc/slurm*.service /etc/systemd/system/<br><br><span class="hljs-comment">#åˆ›å»ºconfæ–‡ä»¶ç›®å½•</span><br><span class="hljs-built_in">mkdir</span> -p  /opt/slurm/20.11.9/etc<br><br><span class="hljs-comment">#æ‹·è´confæ–‡ä»¶</span><br><span class="hljs-built_in">cp</span> etc/slurm.conf.example /opt/slurm/20.11.9/etc/slurm.conf<br><span class="hljs-built_in">cp</span> etc/cgroup.conf.example /opt/slurm/20.11.9/etc/cgroup.conf<br><span class="hljs-built_in">cp</span> etc/slurmdbd.conf.example /opt/slurm/20.11.9/etc/slurmdbd.conf<br><br><span class="hljs-comment">#èµ‹äºˆæƒé™</span><br><span class="hljs-built_in">chmod</span> 600 /opt/slurm/20.11.9/etc/slurmdbd.conf<br></code></pre></td></tr></table></figure><h2 id="äº”ã€å®‰è£…æ•°æ®åº“ï¼ˆæˆ‘é‡‡ç”¨dockerè¿è¡Œmysqlï¼Œä¹Ÿå¯ä½¿ç”¨MariaDBï¼‰"><a href="#äº”ã€å®‰è£…æ•°æ®åº“ï¼ˆæˆ‘é‡‡ç”¨dockerè¿è¡Œmysqlï¼Œä¹Ÿå¯ä½¿ç”¨MariaDBï¼‰" class="headerlink" title="äº”ã€å®‰è£…æ•°æ®åº“ï¼ˆæˆ‘é‡‡ç”¨dockerè¿è¡Œmysqlï¼Œä¹Ÿå¯ä½¿ç”¨MariaDBï¼‰"></a>äº”ã€å®‰è£…æ•°æ®åº“ï¼ˆæˆ‘é‡‡ç”¨dockerè¿è¡Œmysqlï¼Œä¹Ÿå¯ä½¿ç”¨MariaDBï¼‰</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ‹‰å–mysqlé•œåƒ</span><br>docker pull mysql:5.7<br><br><span class="hljs-comment">#åˆ›å»ºå·¥ä½œç›®å½•</span><br><span class="hljs-built_in">mkdir</span> -p /app/mysql/&#123;data,conf&#125;<br><br><span class="hljs-comment">#ä¸ºäº†æ»¡è¶³é…ç½®è¦æ±‚</span><br><span class="hljs-built_in">cat</span> &gt;&gt; /app/mysql/conf/my.cnf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">[mysqld]</span><br><span class="hljs-string">innodb_buffer_pool_size=1024M</span><br><span class="hljs-string">innodb_log_file_size=64M</span><br><span class="hljs-string">innodb_lock_wait_timeout=900</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment">#è¿è¡Œmysql</span><br>docker run -p 3306:3306 \<br>--name mysql -e TZ=Asia/Shanghai \<br>--restart=always \<br>-v /app/mysql/data:/var/lib/mysql \<br>-v /app/mysql/conf:/etc/mysql/conf.d \<br>-e MYSQL_ROOT_PASSWORD=123456 \<br>-d mysql:5.7<br></code></pre></td></tr></table></figure><h2 id="å…­ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#å…­ã€ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="å…­ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>å…­ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><h3 id="1ã€ä¿®æ”¹slurm-confæ–‡ä»¶"><a href="#1ã€ä¿®æ”¹slurm-confæ–‡ä»¶" class="headerlink" title="1ã€ä¿®æ”¹slurm.confæ–‡ä»¶"></a>1ã€ä¿®æ”¹slurm.confæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /opt/slurm/20.11.9/etc/slurm.conf<br><span class="hljs-comment">#ä¿®æ”¹å¦‚ä¸‹å†…å®¹ï¼š</span><br><br>ClusterName=cluster  <span class="hljs-comment">#é›†ç¾¤åï¼Œå¯è‡ªå·±å¡«å†™</span><br>ControlMachine=<span class="hljs-built_in">test</span>  <span class="hljs-comment">#æ§åˆ¶èŠ‚ç‚¹å</span><br><span class="hljs-comment">#......</span><br><span class="hljs-comment">#SlurmUser=slurm //æŠŠè¿™ä¸€è¡Œæ³¨é‡Šæ‰ï¼Œä¸€å®šè¦æŠŠè¿™ä¸€è¡Œæ³¨é‡Šæ‰ã€‚ï¼ˆæˆ‘æ”¹æˆäº†rootï¼‰</span><br><br><span class="hljs-comment">#......</span><br>AccountingStorageType=accounting_storage/slurmdbd<br><span class="hljs-comment">#......</span><br>StateSaveLocation=/var/spool/slurmctld <span class="hljs-comment">#ä¸»èŠ‚ç‚¹logæ—¥å¿—</span><br>SlurmdSpoolDir=/var/spool/slurmd <span class="hljs-comment">#å­èŠ‚ç‚¹logæ—¥å¿—</span><br><br><span class="hljs-comment">#......</span><br>NodeName=<span class="hljs-built_in">test</span> Procs=1 State=UNKNOWN <br></code></pre></td></tr></table></figure><h3 id="2ã€ä¿®æ”¹slurmdbd-conf"><a href="#2ã€ä¿®æ”¹slurmdbd-conf" class="headerlink" title="2ã€ä¿®æ”¹slurmdbd.conf"></a>2ã€ä¿®æ”¹slurmdbd.conf</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /opt/slurm/20.11.9/etc/slurmdbd.conf<br><span class="hljs-comment">#ä¿®æ”¹å¦‚ä¸‹å†…å®¹ï¼š</span><br><br><span class="hljs-comment">#ArchiveScript=</span><br><span class="hljs-comment">##JobPurge=12</span><br><span class="hljs-comment">##StepPurge=1</span><br><span class="hljs-comment">##</span><br><span class="hljs-comment">## Authentication info</span><br>AuthType=auth/munge<br>AuthInfo=/var/run/munge/munge.socket.2<br><span class="hljs-comment">##</span><br><span class="hljs-comment">## slurmDBD info</span><br>DbdAddr=192.168.94.128  <span class="hljs-comment">#æ•°æ®å­˜å‚¨æ§åˆ¶èŠ‚ç‚¹</span><br>DbdHost=<span class="hljs-built_in">test</span> <span class="hljs-comment">#æ•°æ®å­˜å‚¨æ§åˆ¶èŠ‚ç‚¹å</span><br>DbdPort=7031<br>SlurmUser=root  <span class="hljs-comment">#å¦‚æœè®¾ç½®äº†slurmï¼Œåˆ™æ”¹ä¸ºslurm</span><br><span class="hljs-comment">#iMessageTimeout=60</span><br>DebugLevel=4<br><span class="hljs-comment">#DefaultQOS=normal</span><br>LogFile=/var/log/Slurmdbd.<span class="hljs-built_in">log</span><br>PidFile=/var/run/slurmdbd.pid<br><br><span class="hljs-comment">## Database info</span><br>StorageType=accounting_storage/mysql<br>StorageHost=192.168.94.128  <span class="hljs-comment">#æ•°æ®åº“è¿æ¥åœ°å€</span><br>StoragePort=3306   <span class="hljs-comment">#æ•°æ®åº“ç«¯å£</span><br>StoragePass=123456  <span class="hljs-comment">#æ•°æ®åº“å¯†ç </span><br>StorageUser=root <span class="hljs-comment">#æ•°æ®åº“ç”¨æˆ·ï¼Œè®¾ç½®äº†slurmçš„æ”¹ä¸ºslurm</span><br>StorageLoc=slurm_acct_db<br></code></pre></td></tr></table></figure><h2 id="ä¸ƒã€å¯åŠ¨slurmæœåŠ¡"><a href="#ä¸ƒã€å¯åŠ¨slurmæœåŠ¡" class="headerlink" title="ä¸ƒã€å¯åŠ¨slurmæœåŠ¡"></a>ä¸ƒã€å¯åŠ¨slurmæœåŠ¡</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">slurmdbd -vvvvDDDD<br><span class="hljs-comment">#æ£€æŸ¥ï¼Œæ—¥å¿—è¾“å‡ºæ— é”™è¯¯åå¯åŠ¨æœåŠ¡</span><br><br>systemctl <span class="hljs-built_in">enable</span> slurmd<br>systemctl start slurmd<br>systemctl status slurmd<br><span class="hljs-comment"># systemctl stop slurmd</span><br> <br>systemctl <span class="hljs-built_in">enable</span> slurmdbd<br>systemctl start slurmdbd<br>systemctl status slurmdbd<br><span class="hljs-comment"># systemctl stop slurmdbd</span><br> <br>systemctl <span class="hljs-built_in">enable</span> slurmctld<br>systemctl start slurmctld<br>systemctl status slurmctld<br><span class="hljs-comment"># systemctl stop slurmctld</span><br><br></code></pre></td></tr></table></figure><h2 id="å…«ã€è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#å…«ã€è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="å…«ã€è®¾ç½®ç¯å¢ƒå˜é‡"></a>å…«ã€è®¾ç½®ç¯å¢ƒå˜é‡</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">SLURMPATH=/opt/slurm/20.11.9<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;export PATH=\$PATH:<span class="hljs-variable">$SLURMPATH</span>/bin:<span class="hljs-variable">$SLURMPATH</span>/sbin&quot;</span> &gt;&gt; /etc/bash.bashrc<br><span class="hljs-built_in">source</span> /etc/bash.bashrc<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Slurm</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Slurm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Slurmé›†ç¾¤éƒ¨ç½²</title>
    <link href="/2023/04/07/%E4%B8%AD%E9%97%B4%E4%BB%B6/slurm/Slurm%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/"/>
    <url>/2023/04/07/%E4%B8%AD%E9%97%B4%E4%BB%B6/slurm/Slurm%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Slurmé›†ç¾¤éƒ¨ç½²"><a href="#Slurmé›†ç¾¤éƒ¨ç½²" class="headerlink" title="Slurmé›†ç¾¤éƒ¨ç½²:"></a>Slurmé›†ç¾¤éƒ¨ç½²:</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs txt">#å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/qq_34149581/article/details/101902935<br>#è¯¦ç»†å‚è€ƒå…¨æ–‡æ¡£ï¼šhttp://hmli.ustc.edu.cn/doc/linux/slurm-install/slurm-install.html#id14<br>#å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/u010797364/article/details/119929836<br>#å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/liu-shaobo/p/13285839.html<br>#å‚è€ƒæ–‡æ¡£ï¼šhttps://www.slothparadise.com/how-to-install-slurm-on-centos-7-cluster/<br>#ç›¸å¯¹å…¨é¢çš„SLURMé›†ç¾¤çš„é…ç½®è¯¦è§£ã€å®‰è£…åŠä¸€äº›å°é—®é¢˜çš„è§£å†³ï¼šhttps://blog.csdn.net/datuqiqi/article/details/50827040<br>#å¤§é›†ç¾¤æ¡†æ¶æ­å»ºå‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/weixin_28686463/article/details/111927953<br>#å•æœºå®‰è£…ï¼šhttps://cndaqiang.github.io/2020/02/24/slurm/<br>#æµ…è°ˆslurmä½œä¸šè°ƒåº¦ç³»ç»Ÿï¼šhttps://blog.csdn.net/lovebaby1689/article/details/123208698<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€åŸºç¡€ç¯å¢ƒï¼š"><a href="#ä¸€ã€åŸºç¡€ç¯å¢ƒï¼š" class="headerlink" title="ä¸€ã€åŸºç¡€ç¯å¢ƒï¼š"></a>ä¸€ã€åŸºç¡€ç¯å¢ƒï¼š</h2><table><thead><tr><th>ipåœ°å€</th><th>ä¸»æœºå</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>192.168.94.154</td><td>mt1</td><td>æ§åˆ¶èŠ‚ç‚¹ï¼Œæ•°æ®å­˜å‚¨æ§åˆ¶å™¨</td></tr><tr><td>192.168.94.155</td><td>ct1</td><td>è®¡ç®—èŠ‚ç‚¹</td></tr><tr><td>192.168.94.156</td><td>ct2</td><td>è®¡ç®—èŠ‚ç‚¹ã€æ•°æ®å­˜å‚¨èŠ‚ç‚¹ï¼ˆå®‰è£…mysqlï¼‰</td></tr></tbody></table><h3 id="1-è®¾ç½®ä¸»æœºåï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰ï¼š"><a href="#1-è®¾ç½®ä¸»æœºåï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰ï¼š" class="headerlink" title="1.è®¾ç½®ä¸»æœºåï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰ï¼š"></a>1.è®¾ç½®ä¸»æœºåï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">hostnamectl set-hostname mt1<br>hostnamectl set-hostname ct1<br>hostnamectl set-hostname ct2<br><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">192.168.94.154  mt1</span><br><span class="hljs-string">192.168.94.155  ct1</span><br><span class="hljs-string">192.168.94.156  ct2</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h3 id="2-å…³é—­é˜²ç«å¢™ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰ï¼š"><a href="#2-å…³é—­é˜²ç«å¢™ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰ï¼š" class="headerlink" title="2.å…³é—­é˜²ç«å¢™ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰ï¼š"></a>2.å…³é—­é˜²ç«å¢™ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl stop firewalld<br>systemctl <span class="hljs-built_in">disable</span> firewalld<br>systemctl stop iptables<br>systemctl <span class="hljs-built_in">disable</span> iptables<br></code></pre></td></tr></table></figure><h3 id="3-ä¿®æ”¹èµ„æºé™åˆ¶ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"><a href="#3-ä¿®æ”¹èµ„æºé™åˆ¶ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰" class="headerlink" title="3.ä¿®æ”¹èµ„æºé™åˆ¶ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"></a>3.ä¿®æ”¹èµ„æºé™åˆ¶ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/security/limits.conf&lt;&lt;-<span class="hljs-string">EOF</span><br><span class="hljs-string">* hard nofile 1000000</span><br><span class="hljs-string">* soft nofile 1000000</span><br><span class="hljs-string">* soft core unlimited</span><br><span class="hljs-string">* soft stack 10240</span><br><span class="hljs-string">* soft memlock unlimited</span><br><span class="hljs-string">* hard memlock unlimited</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h3 id="4-è°ƒæ•´ç³»ç»Ÿæ—¶åŒºä¸ºä¸­å›½-x2F-ä¸Šæµ·ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"><a href="#4-è°ƒæ•´ç³»ç»Ÿæ—¶åŒºä¸ºä¸­å›½-x2F-ä¸Šæµ·ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰" class="headerlink" title="4.è°ƒæ•´ç³»ç»Ÿæ—¶åŒºä¸ºä¸­å›½&#x2F;ä¸Šæµ·ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"></a>4.è°ƒæ•´ç³»ç»Ÿæ—¶åŒºä¸ºä¸­å›½&#x2F;ä¸Šæµ·ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<br><span class="hljs-comment">#è®¾ç½®æ—¶é—´åŒæ­¥</span><br><span class="hljs-comment">#å®‰è£…ntpdateå·¥å…·</span><br>yum -y install ntp ntpdate<br><span class="hljs-comment">#è®¾ç½®ç³»ç»Ÿæ—¶é—´ä¸ç½‘ç»œæ—¶é—´åŒæ­¥</span><br>ntpdate cn.pool.ntp.org<br><span class="hljs-comment"># å°†ç³»ç»Ÿæ—¶é—´å†™å…¥ç¡¬ä»¶æ—¶é—´</span><br>hwclock --systohc<br><span class="hljs-comment">#å¼ºåˆ¶ç³»ç»Ÿæ—¶é—´å†™å…¥CMOSä¸­é˜²æ­¢é‡å¯å¤±æ•ˆ</span><br>hwclock -w <span class="hljs-comment">#æˆ– clock -w</span><br>systemctl start ntpd<br>systemctl <span class="hljs-built_in">enable</span> ntpd<br></code></pre></td></tr></table></figure><h3 id="5-å®‰è£…EPELæºï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"><a href="#5-å®‰è£…EPELæºï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰" class="headerlink" title="5.å®‰è£…EPELæºï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"></a>5.å®‰è£…EPELæºï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install epel-release -y<br></code></pre></td></tr></table></figure><h3 id="6-å®‰è£…NFSï¼ˆæ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œï¼‰"><a href="#6-å®‰è£…NFSï¼ˆæ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œï¼‰" class="headerlink" title="6.å®‰è£…NFSï¼ˆæ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œï¼‰"></a>6.å®‰è£…NFSï¼ˆæ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œï¼‰</h3><p><strong>å¦‚æœéœ€è¦å…±äº«ç›®å½•æ—¶æ‰§è¡Œæ­¥éª¤6ï¼ï¼</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install nfs-utils rpcbind<br><span class="hljs-comment">#ç¼–è¾‘/etc/exportsæ–‡ä»¶</span><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/exports &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">/software/ *(rw,async,insecure,no_root_squash)</span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment">#å¯åŠ¨NFS</span><br>systemctl start nfs<br>systemctl start rpcbind<br>systemctl <span class="hljs-built_in">enable</span> nfs<br>systemctl <span class="hljs-built_in">enable</span> rpcbind<br><span class="hljs-comment">#å®¢æˆ·ç«¯æŒ‚è½½NFSï¼ˆåœ¨éœ€è¦å…±äº«åˆ°çš„å®¢æˆ·ç«¯ä¸Šæ‰§è¡Œï¼‰</span><br>yum -y install nfs-utils<br><span class="hljs-built_in">mkdir</span> /software<br>mount 192.168.94.154:/software /software<br></code></pre></td></tr></table></figure><h3 id="7ã€é…ç½®SSHå…ç™»é™†ï¼ˆæ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œï¼‰"><a href="#7ã€é…ç½®SSHå…ç™»é™†ï¼ˆæ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œï¼‰" class="headerlink" title="7ã€é…ç½®SSHå…ç™»é™†ï¼ˆæ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œï¼‰"></a>7ã€é…ç½®SSHå…ç™»é™†ï¼ˆæ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">ssh-keygen  <span class="hljs-comment">#ä¸€è·¯å›è½¦</span><br>ssh-copy-id -i .ssh/id_rsa.pub ct1<br>ssh-copy-id -i .ssh/id_rsa.pub ct2<br></code></pre></td></tr></table></figure><h2 id="äºŒã€é…ç½®Munge"><a href="#äºŒã€é…ç½®Munge" class="headerlink" title="äºŒã€é…ç½®Munge:"></a>äºŒã€é…ç½®Munge:</h2><h3 id="1-åˆ›å»ºMungeç”¨æˆ·ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"><a href="#1-åˆ›å»ºMungeç”¨æˆ·ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰" class="headerlink" title="1.åˆ›å»ºMungeç”¨æˆ·ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"></a>1.åˆ›å»ºMungeç”¨æˆ·ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰</h3><p>Mungeç”¨æˆ·è¦ç¡®ä¿Master Nodeå’ŒCompute Nodesçš„UIDå’ŒGIDç›¸åŒï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦åˆ›å»ºMungeï¼›</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">groupadd -g 1108 munge<br>useradd -m -c <span class="hljs-string">&quot;Munge Uid &#x27;N&#x27; Gid Emporium&quot;</span> -d /var/lib/munge -u 1108 -g munge -s /sbin/nologin munge<br></code></pre></td></tr></table></figure><h3 id="2-éƒ¨ç½²Mungeï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"><a href="#2-éƒ¨ç½²Mungeï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰" class="headerlink" title="2.éƒ¨ç½²Mungeï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"></a>2.éƒ¨ç½²Mungeï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰</h3><p>Mungeæ˜¯è®¤è¯æœåŠ¡ï¼Œå®ç°æœ¬åœ°æˆ–è€…è¿œç¨‹ä¸»æœºè¿›ç¨‹çš„UIDã€GIDéªŒè¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install munge munge-libs munge-devel -y<br></code></pre></td></tr></table></figure><h3 id="3-ç”Ÿæˆç†µæ± -å®‰è£…rng-tools-æ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œåï¼Œä»æ§åˆ¶èŠ‚ç‚¹åŒæ­¥Mungeçš„keyåˆ°æ‰€æœ‰çš„è®¡ç®—èŠ‚ç‚¹"><a href="#3-ç”Ÿæˆç†µæ± -å®‰è£…rng-tools-æ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œåï¼Œä»æ§åˆ¶èŠ‚ç‚¹åŒæ­¥Mungeçš„keyåˆ°æ‰€æœ‰çš„è®¡ç®—èŠ‚ç‚¹" class="headerlink" title="3.ç”Ÿæˆç†µæ± ,å®‰è£…rng-tools(æ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œåï¼Œä»æ§åˆ¶èŠ‚ç‚¹åŒæ­¥Mungeçš„keyåˆ°æ‰€æœ‰çš„è®¡ç®—èŠ‚ç‚¹)"></a>3.ç”Ÿæˆç†µæ± ,å®‰è£…rng-tools(æ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œåï¼Œä»æ§åˆ¶èŠ‚ç‚¹åŒæ­¥Mungeçš„keyåˆ°æ‰€æœ‰çš„è®¡ç®—èŠ‚ç‚¹)</h3><h4 id="3-1ã€å®‰è£…rng-tools"><a href="#3-1ã€å®‰è£…rng-tools" class="headerlink" title="3.1ã€å®‰è£…rng-tools"></a>3.1ã€å®‰è£…rng-tools</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y rng-tools<br><br>rngd -r /dev/urandom<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /usr/lib/systemd/system/rngd.service<br><span class="hljs-comment">#ä¿®æ”¹å¦‚ä¸‹å‚æ•°</span><br>[service]<br>ExecStart=/sbin/rngd -f -r /dev/urandom<br><span class="hljs-comment">#æˆ–è€…ä½¿ç”¨æ›¿æ¢å‘½ä»¤ä¿®æ”¹å‚æ•°ï¼š</span><br><span class="hljs-comment">#sed -i &#x27;s\ExecStart=/sbin/rngd -f\ExecStart=/sbin/rngd -f -r /dev/urandom\g&#x27; /usr/lib/systemd/system/rngd.service</span><br><br>systemctl daemon-reload<br>systemctl start rngd<br>systemctl <span class="hljs-built_in">enable</span> rngd<br></code></pre></td></tr></table></figure><h4 id="3-2ã€åˆ›å»ºå…¨å±€å¯†é’¥"><a href="#3-2ã€åˆ›å»ºå…¨å±€å¯†é’¥" class="headerlink" title="3.2ã€åˆ›å»ºå…¨å±€å¯†é’¥"></a>3.2ã€åˆ›å»ºå…¨å±€å¯†é’¥</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åœ¨Master Nodeåˆ›å»ºå…¨å±€ä½¿ç”¨çš„å¯†é’¥ï¼ˆ192.168.94.154ï¼‰</span><br>/usr/sbin/create-munge-key -r<br><br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/urandom bs=1 count=1024 &gt; /etc/munge/munge.key<br></code></pre></td></tr></table></figure><h4 id="3-3ã€å°†æ§åˆ¶èŠ‚ç‚¹å¯†é’¥åŒæ­¥åˆ°æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹"><a href="#3-3ã€å°†æ§åˆ¶èŠ‚ç‚¹å¯†é’¥åŒæ­¥åˆ°æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹" class="headerlink" title="3.3ã€å°†æ§åˆ¶èŠ‚ç‚¹å¯†é’¥åŒæ­¥åˆ°æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹"></a>3.3ã€å°†æ§åˆ¶èŠ‚ç‚¹å¯†é’¥åŒæ­¥åˆ°æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">scp -p /etc/munge/munge.key root@ct1:/etc/munge<br>scp -p /etc/munge/munge.key root@ct2:/etc/munge<br></code></pre></td></tr></table></figure><h4 id="3-4ã€æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šéƒ½å·²ç»æœ‰äº†keyï¼Œå¯åŠ¨Mungeå¹¶ä¸”é…ç½®mungeæƒé™"><a href="#3-4ã€æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šéƒ½å·²ç»æœ‰äº†keyï¼Œå¯åŠ¨Mungeå¹¶ä¸”é…ç½®mungeæƒé™" class="headerlink" title="3.4ã€æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šéƒ½å·²ç»æœ‰äº†keyï¼Œå¯åŠ¨Mungeå¹¶ä¸”é…ç½®mungeæƒé™"></a>3.4ã€æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šéƒ½å·²ç»æœ‰äº†keyï¼Œå¯åŠ¨Mungeå¹¶ä¸”é…ç½®mungeæƒé™</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">chown</span> -R munge: /etc/munge/ /var/log/munge/<br><span class="hljs-built_in">chmod</span> 0700 /etc/munge/ /var/log/munge/<br><br><span class="hljs-comment">#èµ‹äºˆæƒé™ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰</span><br><span class="hljs-built_in">chown</span> munge: /etc/munge/munge.key<br><span class="hljs-built_in">chmod</span> 400 /etc/munge/munge.key<br><br><span class="hljs-comment">#å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰</span><br>systemctl start munge<br>systemctl <span class="hljs-built_in">enable</span> munge<br>systemctl status munge<br></code></pre></td></tr></table></figure><h3 id="4-ä»¥ä¸‹ä¸ºæµ‹è¯•MungeæœåŠ¡"><a href="#4-ä»¥ä¸‹ä¸ºæµ‹è¯•MungeæœåŠ¡" class="headerlink" title="4.ä»¥ä¸‹ä¸ºæµ‹è¯•MungeæœåŠ¡"></a>4.ä»¥ä¸‹ä¸ºæµ‹è¯•MungeæœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æœ¬åœ°æŸ¥çœ‹å‡­æ®</span><br>munge -n<br><span class="hljs-comment">#æœ¬åœ°è§£ç </span><br>munge -n | unmunge<br><span class="hljs-comment">#éªŒè¯:è¿œç¨‹è§£ç ,æ¯ä¸ªè®¡ç®—èŠ‚ç‚¹ä¸æ§åˆ¶èŠ‚ç‚¹è¿›è¡Œè¿æ¥ã€‚</span><br>munge -n | ssh ct1 unmunge<br><span class="hljs-comment">#Mungeå‡­è¯åŸºå‡†æµ‹è¯•</span><br>remunge<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€é…ç½®Slurm"><a href="#ä¸‰ã€é…ç½®Slurm" class="headerlink" title="ä¸‰ã€é…ç½®Slurm"></a>ä¸‰ã€é…ç½®Slurm</h2><h3 id="1ã€åˆ›å»ºSlurmç”¨æˆ·-å„èŠ‚ç‚¹æ‰§è¡Œ"><a href="#1ã€åˆ›å»ºSlurmç”¨æˆ·-å„èŠ‚ç‚¹æ‰§è¡Œ" class="headerlink" title="1ã€åˆ›å»ºSlurmç”¨æˆ·(å„èŠ‚ç‚¹æ‰§è¡Œ)"></a>1ã€åˆ›å»ºSlurmç”¨æˆ·(å„èŠ‚ç‚¹æ‰§è¡Œ)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">groupadd -g 1109 slurm<br>useradd -m -c <span class="hljs-string">&quot;Slurm manager&quot;</span> -d /var/lib/slurm -u 1109 -g slurm -s /bin/bash slurm<br></code></pre></td></tr></table></figure><h3 id="2ã€å®‰è£…SlurmåŠä¾èµ–ï¼ˆå„èŠ‚ç‚¹å®‰è£…ä¾èµ–ï¼‰"><a href="#2ã€å®‰è£…SlurmåŠä¾èµ–ï¼ˆå„èŠ‚ç‚¹å®‰è£…ä¾èµ–ï¼‰" class="headerlink" title="2ã€å®‰è£…SlurmåŠä¾èµ–ï¼ˆå„èŠ‚ç‚¹å®‰è£…ä¾èµ–ï¼‰"></a>2ã€å®‰è£…SlurmåŠä¾èµ–ï¼ˆå„èŠ‚ç‚¹å®‰è£…ä¾èµ–ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install gcc gcc-c++ readline-devel perl-ExtUtils-MakeMaker pam-devel rpm-build mysql-devel python3 -y<br><span class="hljs-comment">#yum install openssl openssl-devel pam-devel numactl numactl-devel hwloc hwloc-devel lua lua-devel readline-devel rrdtool-devel ncurses-devel man2html libibmad libibumad -y</span><br></code></pre></td></tr></table></figure><h4 id="2-1ã€ä¸‹è½½å¹¶ç¼–è¯‘Slurmï¼ˆåœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šåˆ›å»ºå®‰è£…åŒ…ï¼Œå…¶ä»–èŠ‚ç‚¹å¯ä»¥é€šè¿‡scp-r-å‘½ä»¤å°†å®‰è£…åŒ…æ‰€åœ¨ç›®å½•ä¼ è¾“è¿‡å»ï¼‰"><a href="#2-1ã€ä¸‹è½½å¹¶ç¼–è¯‘Slurmï¼ˆåœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šåˆ›å»ºå®‰è£…åŒ…ï¼Œå…¶ä»–èŠ‚ç‚¹å¯ä»¥é€šè¿‡scp-r-å‘½ä»¤å°†å®‰è£…åŒ…æ‰€åœ¨ç›®å½•ä¼ è¾“è¿‡å»ï¼‰" class="headerlink" title="2.1ã€ä¸‹è½½å¹¶ç¼–è¯‘Slurmï¼ˆåœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šåˆ›å»ºå®‰è£…åŒ…ï¼Œå…¶ä»–èŠ‚ç‚¹å¯ä»¥é€šè¿‡scp -r å‘½ä»¤å°†å®‰è£…åŒ…æ‰€åœ¨ç›®å½•ä¼ è¾“è¿‡å»ï¼‰"></a>2.1ã€ä¸‹è½½å¹¶ç¼–è¯‘Slurmï¼ˆåœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šåˆ›å»ºå®‰è£…åŒ…ï¼Œå…¶ä»–èŠ‚ç‚¹å¯ä»¥é€šè¿‡scp -r å‘½ä»¤å°†å®‰è£…åŒ…æ‰€åœ¨ç›®å½•ä¼ è¾“è¿‡å»ï¼‰</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://download.schedmd.com/slurm/slurm-20.11.9.tar.bz2<br><span class="hljs-comment">#ä¼ è¾“åˆ°å…¶ä»–èŠ‚ç‚¹</span><br>scp -r slurm-20.11.9.tar.bz2 ct1:/root<br>scp -r slurm-20.11.9.tar.bz2 ct2:/root<br></code></pre></td></tr></table></figure><h4 id="2-2ã€å®‰è£…ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"><a href="#2-2ã€å®‰è£…ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰" class="headerlink" title="2.2ã€å®‰è£…ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"></a>2.2ã€å®‰è£…ï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">rpmbuild -ta slurm-20.11.9.tar.bz2 <br><span class="hljs-built_in">cd</span> /root/rpmbuild/RPMS/x86_64/<br></code></pre></td></tr></table></figure><h4 id="2-3ã€å®‰è£…Slurmï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"><a href="#2-3ã€å®‰è£…Slurmï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰" class="headerlink" title="2.3ã€å®‰è£…Slurmï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰"></a>2.3ã€å®‰è£…Slurmï¼ˆå„èŠ‚ç‚¹æ‰§è¡Œï¼‰</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum localinstall slurm-* -y<br></code></pre></td></tr></table></figure><h3 id="3ã€é…ç½®æ§åˆ¶èŠ‚ç‚¹Slurm-æ§åˆ¶èŠ‚ç‚¹ä¸Šæ“ä½œ"><a href="#3ã€é…ç½®æ§åˆ¶èŠ‚ç‚¹Slurm-æ§åˆ¶èŠ‚ç‚¹ä¸Šæ“ä½œ" class="headerlink" title="3ã€é…ç½®æ§åˆ¶èŠ‚ç‚¹Slurm(æ§åˆ¶èŠ‚ç‚¹ä¸Šæ“ä½œ)"></a>3ã€é…ç½®æ§åˆ¶èŠ‚ç‚¹Slurm(æ§åˆ¶èŠ‚ç‚¹ä¸Šæ“ä½œ)</h3><h4 id="3-1ã€å®‰è£…å®Œæˆåï¼Œéœ€è¦é…ç½®slurmçš„é…ç½®æ–‡ä»¶"><a href="#3-1ã€å®‰è£…å®Œæˆåï¼Œéœ€è¦é…ç½®slurmçš„é…ç½®æ–‡ä»¶" class="headerlink" title="3.1ã€å®‰è£…å®Œæˆåï¼Œéœ€è¦é…ç½®slurmçš„é…ç½®æ–‡ä»¶"></a>3.1ã€å®‰è£…å®Œæˆåï¼Œéœ€è¦é…ç½®slurmçš„é…ç½®æ–‡ä»¶</h4><p>æ–¹æ³•ä¸€ï¼šå¯ä»¥è®¿é—®å®˜ç½‘ï¼Œå¡«å†™ç›¸å…³ä¿¡æ¯åç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š<a href="http://slurm.schedmd.com/configurator.easy.html%EF%BC%8C%E5%B0%86%E7%94%9F%E6%88%90%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A4%8D%E5%88%B6%E5%88%B0/etc/slurm%E4%B8%8B">http://slurm.schedmd.com/configurator.easy.htmlï¼Œå°†ç”Ÿæˆçš„é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°/etc/slurmä¸‹</a></p><p>æ–¹æ³•äºŒï¼šåœ¨&#x2F;etc&#x2F;slurm&#x2F;æ–‡ä»¶å¤¹ä¸‹æœ‰slurmçš„é…ç½®æ–‡ä»¶æ¨¡æ¿xxx.conf.exampleï¼Œä»¥ä¸‹ä¸ºæ–¹æ³•äºŒï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒslurm.confæ–‡ä»¶ï¼šhttps://blog.csdn.net/xhk12345678/article/details/124710528<br>å‚è€ƒslurm.confæ–‡ä»¶ï¼šhttps://blog.csdn.net/qq_34149581/article/details/104868057<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> /etc/slurm/slurm.conf.example /etc/slurm/slurm.conf<br><br><br>vim /etc/slurm/slurm.conf<br><span class="hljs-comment">#ä¿®æ”¹å¦‚ä¸‹éƒ¨åˆ†</span><br>ClusterName=cluster  <span class="hljs-comment">#é›†ç¾¤åï¼Œå¯è‡ªå·±å¡«å†™</span><br>ControlMachine=mt1  <span class="hljs-comment">#æ§åˆ¶èŠ‚ç‚¹å</span><br><span class="hljs-comment">#......</span><br>StateSaveLocation=/var/spool/slurmctld <span class="hljs-comment">#ä¸»èŠ‚ç‚¹logæ—¥å¿—</span><br>SlurmdSpoolDir=/var/spool/slurmd <span class="hljs-comment">#å­èŠ‚ç‚¹logæ—¥å¿—</span><br><span class="hljs-comment">#......</span><br>NodeName=ct[1-2] Procs=1 State=UNKNOWN <span class="hljs-comment">#ct[1-2] æŒ‡çš„è®¡ç®—èŠ‚ç‚¹ct1å’Œct2,ä¹Ÿå¯ä»¥å†™æˆct1,ct2</span><br><br><span class="hljs-comment">#Slurmä¸­é»˜è®¤æ˜¯æ²¡æœ‰é…ç½®accountingçš„åŠŸèƒ½çš„ï¼Œå¼€å¯åœ¨è¯¥æ–‡ä»¶å†…æ·»åŠ ï¼š</span><br>JobAcctGatherType=jobacct_gather/linux<br>JobAcctGatherFrequency=30<br><span class="hljs-comment">#</span><br>AccountingStorageEnforce=associations,limits,qos  <span class="hljs-comment">#accountå­˜å‚¨æ•°æ®çš„é…ç½®é€‰é¡¹</span><br>AccountingStorageHost=192.168.94.188    <span class="hljs-comment">#æ•°æ®åº“å­˜å‚¨èŠ‚ç‚¹</span><br>AccountingStoragePass=/var/run/munge/munge.socket.2 <span class="hljs-comment">#mungeè®¤è¯æ–‡ä»¶ï¼Œä¸slurmdbd.confæ–‡ä»¶ä¸­çš„AuthInfoæ–‡ä»¶åŒåã€‚</span><br>AccountingStoragePort=7031     <span class="hljs-comment">#slurmdæœåŠ¡ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ä¸º6819ï¼Œä¸‹æ–‡ç”¨åˆ°çš„ä¸º7031</span><br>AccountingStorageType=accounting_storage/slurmdbd   <span class="hljs-comment">#æ•°æ®åº“è®°è´¦æœåŠ¡</span><br>AccountingStorageTRES=cpu,mem,energy,node,billing,fs/disk,vmem,pages,gres/gpu:tesla  <span class="hljs-comment">#è®°è´¦ä¿¡æ¯</span><br>AcctGatherEnergyType=acct_gather_energy/none   <span class="hljs-comment">#ä½œä¸šæ¶ˆè€—èƒ½æºä¿¡æ¯ï¼Œnoneä»£è¡¨ä¸é‡‡é›†</span><br>AcctGatherFilesystemType=acct_gather_filesystem/none<br>AcctGatherInterconnectType=acct_gather_interconnect/none<br>AcctGatherNodeFreq=0<br>AcctGatherProfileType=acct_gather_profile/none<br>ExtSensorsType=ext_sensors/none<br>ExtSensorsFreq=0<br><br><br><span class="hljs-comment">#å¯ä»¥è®¾ç½®é»˜è®¤çš„ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ•´ä¸ªé›†ç¾¤</span><br><span class="hljs-comment">#NodeName=mt1,ct[1-2] Procs=1 State=UNKNOWN</span><br><span class="hljs-comment">#PartitionName=control Nodes=mt1 Default=NO MaxTime=INFINITE State=UP</span><br><span class="hljs-comment">#PartitionName=compute Nodes=ct[1-2] Default=YES MaxTime=INFINITE State=UP</span><br></code></pre></td></tr></table></figure><h4 id="3-2ã€å¤åˆ¶æ§åˆ¶èŠ‚ç‚¹é…ç½®æ–‡ä»¶åˆ°è®¡ç®—èŠ‚ç‚¹ï¼ˆæ§åˆ¶èŠ‚ç‚¹ä¸Šæ“ä½œï¼‰"><a href="#3-2ã€å¤åˆ¶æ§åˆ¶èŠ‚ç‚¹é…ç½®æ–‡ä»¶åˆ°è®¡ç®—èŠ‚ç‚¹ï¼ˆæ§åˆ¶èŠ‚ç‚¹ä¸Šæ“ä½œï¼‰" class="headerlink" title="3.2ã€å¤åˆ¶æ§åˆ¶èŠ‚ç‚¹é…ç½®æ–‡ä»¶åˆ°è®¡ç®—èŠ‚ç‚¹ï¼ˆæ§åˆ¶èŠ‚ç‚¹ä¸Šæ“ä½œï¼‰"></a>3.2ã€å¤åˆ¶æ§åˆ¶èŠ‚ç‚¹é…ç½®æ–‡ä»¶åˆ°è®¡ç®—èŠ‚ç‚¹ï¼ˆæ§åˆ¶èŠ‚ç‚¹ä¸Šæ“ä½œï¼‰</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> /etc/slurm/cgroup.conf.example /etc/slurm/cgroup.conf<br>scp /etc/slurm/*.conf ct1:/etc/slurm/<br>scp /etc/slurm/*.conf ct2:/etc/slurm/<br></code></pre></td></tr></table></figure><p><strong>å¯¹äºæ§åˆ¶èŠ‚ç‚¹å¿…è¦çš„æ˜¯slurm.confï¼Œå¯¹äºè®¡ç®—èŠ‚ç‚¹å¿…è¦çš„æ˜¯slurm.conf, cgroup.conf</strong></p><h3 id="4ã€è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆä»¥ä¸‹æ–‡ä»¶åœ¨slurm-confæ–‡ä»¶å†…å†™æ˜çš„è·¯å¾„ï¼Œè¯·æ³¨æ„æ ¸å¯¹ï¼‰"><a href="#4ã€è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆä»¥ä¸‹æ–‡ä»¶åœ¨slurm-confæ–‡ä»¶å†…å†™æ˜çš„è·¯å¾„ï¼Œè¯·æ³¨æ„æ ¸å¯¹ï¼‰" class="headerlink" title="4ã€è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆä»¥ä¸‹æ–‡ä»¶åœ¨slurm.confæ–‡ä»¶å†…å†™æ˜çš„è·¯å¾„ï¼Œè¯·æ³¨æ„æ ¸å¯¹ï¼‰"></a>4ã€è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆä»¥ä¸‹æ–‡ä»¶åœ¨slurm.confæ–‡ä»¶å†…å†™æ˜çš„è·¯å¾„ï¼Œè¯·æ³¨æ„æ ¸å¯¹ï¼‰</h3><h4 id="4-1ã€åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šï¼š"><a href="#4-1ã€åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šï¼š" class="headerlink" title="4.1ã€åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šï¼š"></a>4.1ã€åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /var/spool/slurmctld<br><span class="hljs-built_in">chown</span> slurm: /var/spool/slurmctld<br><span class="hljs-built_in">chmod</span> 755 /var/spool/slurmctld<br><br><span class="hljs-built_in">touch</span> /var/log/slurmctld.log<br><span class="hljs-built_in">chown</span> slurm: /var/log/slurmctld.log<br><br><span class="hljs-comment">#touch /var/log/slurm_jobacct.log /var/log/slurm_jobcomp.log</span><br><span class="hljs-comment">#chown slurm: /var/log/slurm_jobacct.log /var/log/slurm_jobcomp.log</span><br></code></pre></td></tr></table></figure><h4 id="4-2ã€åœ¨æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹ä¸Šï¼Œé…ç½®æ—¥å¿—æ–‡ä»¶"><a href="#4-2ã€åœ¨æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹ä¸Šï¼Œé…ç½®æ—¥å¿—æ–‡ä»¶" class="headerlink" title="4.2ã€åœ¨æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹ä¸Šï¼Œé…ç½®æ—¥å¿—æ–‡ä»¶"></a>4.2ã€åœ¨æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹ä¸Šï¼Œé…ç½®æ—¥å¿—æ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /var/spool/slurmd<br><span class="hljs-built_in">chown</span> slurm: /var/spool/slurmd<br><span class="hljs-built_in">chmod</span> 755 /var/spool/slurmd<br><span class="hljs-built_in">touch</span> /var/log/slurmd.log<br><span class="hljs-built_in">chown</span> slurm: /var/log/slurmd.log<br></code></pre></td></tr></table></figure><h3 id="5ã€é…ç½®èŠ‚ç‚¹Slurm-Accounting-ï¼ˆæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯mt1æœºå™¨ä½œä¸ºslurmdbçš„æ•°æ®å­˜å‚¨æ§åˆ¶èŠ‚ç‚¹ï¼‰"><a href="#5ã€é…ç½®èŠ‚ç‚¹Slurm-Accounting-ï¼ˆæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯mt1æœºå™¨ä½œä¸ºslurmdbçš„æ•°æ®å­˜å‚¨æ§åˆ¶èŠ‚ç‚¹ï¼‰" class="headerlink" title="5ã€é…ç½®èŠ‚ç‚¹Slurm Accounting ï¼ˆæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯mt1æœºå™¨ä½œä¸ºslurmdbçš„æ•°æ®å­˜å‚¨æ§åˆ¶èŠ‚ç‚¹ï¼‰"></a>5ã€é…ç½®èŠ‚ç‚¹Slurm Accounting ï¼ˆæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯mt1æœºå™¨ä½œä¸ºslurmdbçš„æ•°æ®å­˜å‚¨æ§åˆ¶èŠ‚ç‚¹ï¼‰</h3><p>Accounting recordsä¸ºslurmæ”¶é›†ä½œä¸šæ­¥éª¤çš„ä¿¡æ¯ï¼Œå¯ä»¥å†™å…¥ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶æˆ–æ•°æ®åº“ï¼Œä½†è¿™ä¸ªæ–‡ä»¶ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨MySQLæ¥å­˜å‚¨ä¿¡æ¯ã€‚</p><h4 id="5-1ã€åœ¨slurmdbdï¼ˆæ§åˆ¶èŠ‚ç‚¹ï¼‰ï¼Œé…ç½®slurmdbdçš„æ—¥å¿—æ–‡ä»¶"><a href="#5-1ã€åœ¨slurmdbdï¼ˆæ§åˆ¶èŠ‚ç‚¹ï¼‰ï¼Œé…ç½®slurmdbdçš„æ—¥å¿—æ–‡ä»¶" class="headerlink" title="5.1ã€åœ¨slurmdbdï¼ˆæ§åˆ¶èŠ‚ç‚¹ï¼‰ï¼Œé…ç½®slurmdbdçš„æ—¥å¿—æ–‡ä»¶"></a>5.1ã€åœ¨slurmdbdï¼ˆæ§åˆ¶èŠ‚ç‚¹ï¼‰ï¼Œé…ç½®slurmdbdçš„æ—¥å¿—æ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">touch</span> /var/log/slurmdbd.log<br><span class="hljs-built_in">chown</span> slurm: /var/log/slurmdbd.log<br></code></pre></td></tr></table></figure><h4 id="5-2ã€åˆ›å»ºæ•°æ®åº“çš„Slurmç”¨æˆ·ï¼ˆMySQLè‡ªè¡Œå®‰è£…-ä»¥ä¸‹ä½¿ç”¨dockerå®‰è£…ï¼Œæˆ‘å®‰è£…åœ¨äº†ct2æœºå™¨ä¸Šï¼‰"><a href="#5-2ã€åˆ›å»ºæ•°æ®åº“çš„Slurmç”¨æˆ·ï¼ˆMySQLè‡ªè¡Œå®‰è£…-ä»¥ä¸‹ä½¿ç”¨dockerå®‰è£…ï¼Œæˆ‘å®‰è£…åœ¨äº†ct2æœºå™¨ä¸Šï¼‰" class="headerlink" title="5.2ã€åˆ›å»ºæ•°æ®åº“çš„Slurmç”¨æˆ·ï¼ˆMySQLè‡ªè¡Œå®‰è£…,ä»¥ä¸‹ä½¿ç”¨dockerå®‰è£…ï¼Œæˆ‘å®‰è£…åœ¨äº†ct2æœºå™¨ä¸Šï¼‰"></a>5.2ã€åˆ›å»ºæ•°æ®åº“çš„Slurmç”¨æˆ·ï¼ˆMySQLè‡ªè¡Œå®‰è£…,ä»¥ä¸‹ä½¿ç”¨dockerå®‰è£…ï¼Œæˆ‘å®‰è£…åœ¨äº†ct2æœºå™¨ä¸Šï¼‰</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull mysql:5.7<br><br><span class="hljs-built_in">mkdir</span> -p /app/mysql/&#123;data,conf&#125;<br><br><span class="hljs-comment">#ä¸ºäº†æ»¡è¶³é…ç½®è¦æ±‚</span><br><span class="hljs-built_in">cat</span> &gt;&gt; /app/mysql/conf/my.cnf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">[mysqld]</span><br><span class="hljs-string">innodb_buffer_pool_size=1024M</span><br><span class="hljs-string">innodb_log_file_size=64M</span><br><span class="hljs-string">innodb_lock_wait_timeout=900</span><br><span class="hljs-string">EOF</span><br><br>docker run -p 3306:3306 \<br>--name mysql -e TZ=Asia/Shanghai \<br>--restart=always \<br>-v /app/mysql/data:/var/lib/mysql \<br>-v /app/mysql/conf:/etc/mysql/conf.d \<br>-e MYSQL_ROOT_PASSWORD=123456 \<br>-d mysql:5.7<br><br></code></pre></td></tr></table></figure><p>è®¾ç½®slurmç”¨æˆ·å»è®¿é—®ï¼ˆæˆ‘ç›´æ¥ä½¿ç”¨çš„rootç”¨æˆ·è¿›è¡Œçš„è¿æ¥ï¼Œéœ€è´¦å·æƒé™åˆ’åˆ†çš„å¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker <span class="hljs-built_in">exec</span> -it mysql bash<br>&gt;mysql -uroot -p123456<br>mysql&gt; grant all on slurm_acct_db.* to <span class="hljs-string">&#x27;slurm&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified by <span class="hljs-string">&#x27;slurm*123&#x27;</span> with grant option;<br><br></code></pre></td></tr></table></figure><h4 id="5-3ã€é…ç½®slurmdbd-confæ–‡ä»¶ï¼ˆæ§åˆ¶èŠ‚ç‚¹ä¸Šï¼‰"><a href="#5-3ã€é…ç½®slurmdbd-confæ–‡ä»¶ï¼ˆæ§åˆ¶èŠ‚ç‚¹ä¸Šï¼‰" class="headerlink" title="5.3ã€é…ç½®slurmdbd.confæ–‡ä»¶ï¼ˆæ§åˆ¶èŠ‚ç‚¹ä¸Šï¼‰"></a>5.3ã€é…ç½®slurmdbd.confæ–‡ä»¶ï¼ˆæ§åˆ¶èŠ‚ç‚¹ä¸Šï¼‰</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> /etc/slurm/slurmdbd.conf.example /etc/slurm/slurmdbd.conf<br><br><span class="hljs-comment">#å‚è€ƒçš„slurmdbd.confæ–‡ä»¶ï¼Œhttps://blog.csdn.net/qq_34149581/article/details/104868194</span><br><span class="hljs-built_in">cat</span> /etc/slurm/slurmdbd.conf <br><span class="hljs-comment">#ArchiveScript=</span><br><span class="hljs-comment">##JobPurge=12</span><br><span class="hljs-comment">##StepPurge=1</span><br><span class="hljs-comment">##</span><br><span class="hljs-comment">## Authentication info</span><br>AuthType=auth/munge<br>AuthInfo=/var/run/munge/munge.socket.2<br><span class="hljs-comment">##</span><br><span class="hljs-comment">## slurmDBD info</span><br>DbdAddr=192.168.94.154  <span class="hljs-comment">#æ•°æ®å­˜å‚¨æ§åˆ¶èŠ‚ç‚¹</span><br>DbdHost=mt1 <span class="hljs-comment">#æ•°æ®å­˜å‚¨æ§åˆ¶èŠ‚ç‚¹å</span><br>DbdPort=7031<br>SlurmUser=root  <span class="hljs-comment">#å¦‚æœè®¾ç½®äº†slurmï¼Œåˆ™æ”¹ä¸ºslurm</span><br><span class="hljs-comment">#iMessageTimeout=60</span><br>DebugLevel=4<br><span class="hljs-comment">#DefaultQOS=normal</span><br>LogFile=/var/log/Slurmdbd.<span class="hljs-built_in">log</span><br>PidFile=/var/run/slurmdbd.pid<br><br><span class="hljs-comment">## Database info</span><br>StorageType=accounting_storage/mysql<br>StorageHost=192.168.94.156  <span class="hljs-comment">#æ•°æ®åº“è¿æ¥åœ°å€</span><br>StoragePort=3306   <span class="hljs-comment">#æ•°æ®åº“ç«¯å£</span><br>StoragePass=123456  <span class="hljs-comment">#æ•°æ®åº“å¯†ç </span><br>StorageUser=root <span class="hljs-comment">#æ•°æ®åº“ç”¨æˆ·ï¼Œè®¾ç½®äº†slurmçš„æ”¹ä¸ºslurm</span><br>StorageLoc=slurm_acct_db<br><br></code></pre></td></tr></table></figure><h4 id="5-4ã€åœ¨æ•°æ®åº“æ§åˆ¶èŠ‚ç‚¹-192-168-94-154-å¯åŠ¨slurmdbd"><a href="#5-4ã€åœ¨æ•°æ®åº“æ§åˆ¶èŠ‚ç‚¹-192-168-94-154-å¯åŠ¨slurmdbd" class="headerlink" title="5.4ã€åœ¨æ•°æ®åº“æ§åˆ¶èŠ‚ç‚¹(192.168.94.154)å¯åŠ¨slurmdbd:"></a>5.4ã€åœ¨æ•°æ®åº“æ§åˆ¶èŠ‚ç‚¹(192.168.94.154)å¯åŠ¨slurmdbd:</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">slurmdbd -vvvvDDDD<br><span class="hljs-comment">#è¿›è¡Œè°ƒè¯•å¯åŠ¨ï¼ŒæŸ¥çœ‹æ˜¯å¦å¯åŠ¨è¿‡ç¨‹ä¸­æœ‰æ— é”™è¯¯ã€‚æ— é”™è¯¯åå¯åŠ¨slurmdbd</span><br></code></pre></td></tr></table></figure><h3 id="6-å¼€å¯èŠ‚ç‚¹æœåŠ¡"><a href="#6-å¼€å¯èŠ‚ç‚¹æœåŠ¡" class="headerlink" title="6.å¼€å¯èŠ‚ç‚¹æœåŠ¡"></a>6.å¼€å¯èŠ‚ç‚¹æœåŠ¡</h3><h4 id="6-1ã€å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹SlurmdbdæœåŠ¡"><a href="#6-1ã€å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹SlurmdbdæœåŠ¡" class="headerlink" title="6.1ã€å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹SlurmdbdæœåŠ¡"></a>6.1ã€å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹SlurmdbdæœåŠ¡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start slurmdbd<br>systemctl status slurmdbd<br>systemctl <span class="hljs-built_in">enable</span> slurmdbd<br></code></pre></td></tr></table></figure><h4 id="6-2ã€å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹slurmctldæœåŠ¡"><a href="#6-2ã€å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹slurmctldæœåŠ¡" class="headerlink" title="6.2ã€å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹slurmctldæœåŠ¡"></a>6.2ã€å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹slurmctldæœåŠ¡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start slurmctld<br>systemctl status slurmctld<br>systemctl <span class="hljs-built_in">enable</span> slurmctld<br></code></pre></td></tr></table></figure><h4 id="6-3ã€å¯åŠ¨è®¡ç®—èŠ‚ç‚¹çš„æœåŠ¡"><a href="#6-3ã€å¯åŠ¨è®¡ç®—èŠ‚ç‚¹çš„æœåŠ¡" class="headerlink" title="6.3ã€å¯åŠ¨è®¡ç®—èŠ‚ç‚¹çš„æœåŠ¡"></a>6.3ã€å¯åŠ¨è®¡ç®—èŠ‚ç‚¹çš„æœåŠ¡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start slurmd<br>systemctl status slurmd<br>systemctl <span class="hljs-built_in">enable</span> slurmd<br></code></pre></td></tr></table></figure><h2 id="å››ã€æ£€æŸ¥Slurmé›†ç¾¤"><a href="#å››ã€æ£€æŸ¥Slurmé›†ç¾¤" class="headerlink" title="å››ã€æ£€æŸ¥Slurmé›†ç¾¤"></a>å››ã€æ£€æŸ¥Slurmé›†ç¾¤</h2><h3 id="1-å¯åŠ¨é›†ç¾¤ï¼š"><a href="#1-å¯åŠ¨é›†ç¾¤ï¼š" class="headerlink" title="1.å¯åŠ¨é›†ç¾¤ï¼š"></a>1.å¯åŠ¨é›†ç¾¤ï¼š</h3><p>MasterèŠ‚ç‚¹éœ€è¦æ‰§è¡Œ <code>slurmctld -c</code>å’Œ<code>slurmd -c</code>ï¼Œéƒ½ä»¥rootè´¦æˆ·æ‰§è¡Œï¼Œæ‰€æœ‰SlaverèŠ‚ç‚¹éƒ½æ‰§è¡Œ <code>slurmd -c</code></p><h3 id="2-æŸ¥çœ‹é›†ç¾¤"><a href="#2-æŸ¥çœ‹é›†ç¾¤" class="headerlink" title="2.æŸ¥çœ‹é›†ç¾¤"></a>2.æŸ¥çœ‹é›†ç¾¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">sinfo<br><span class="hljs-comment">#é›†ç¾¤å¯åŠ¨æ­£å¸¸ã€‚Stateæœ‰idleï¼ˆç©ºé—²ï¼‰ï¼Œsallocï¼ˆå ç”¨ï¼‰,unknownï¼ˆåˆšå¯åŠ¨æ—¶å¯èƒ½å‡ºç°ï¼‰ï¼Œdownï¼ˆè¿ä¸ä¸Šï¼‰ç­‰çŠ¶æ€ã€‚</span><br><br>scontrol show partition<br>scontrol show node<br></code></pre></td></tr></table></figure><h3 id="3-æäº¤ä½œä¸š"><a href="#3-æäº¤ä½œä¸š" class="headerlink" title="3.æäº¤ä½œä¸š"></a>3.æäº¤ä½œä¸š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">srun -N2 hostname<br><span class="hljs-comment">#-N å…è®¸æ‚¨é€‰æ‹©è¦ä½¿ç”¨çš„è®¡ç®—èŠ‚ç‚¹æ•°é‡ã€‚</span><br></code></pre></td></tr></table></figure><h3 id="4-ä»¥ä¸‹ä¸ºå®é™…æ“ä½œä¸¾ä¾‹ï¼š"><a href="#4-ä»¥ä¸‹ä¸ºå®é™…æ“ä½œä¸¾ä¾‹ï¼š" class="headerlink" title="4.ä»¥ä¸‹ä¸ºå®é™…æ“ä½œä¸¾ä¾‹ï¼š"></a>4.ä»¥ä¸‹ä¸ºå®é™…æ“ä½œä¸¾ä¾‹ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt;&gt; /home/ceshi.sh &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">#!/bin/sh</span><br><span class="hljs-string">sudo docker pull nginx:latest</span><br><span class="hljs-string">sudo docker run --name nginx-test -p 8088:80 -d nginx </span><br><span class="hljs-string">echo &quot;Is OK!&quot; &gt;&gt; /home/nginx.log  </span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment">#æäº¤ä½œä¸š</span><br>sbatch /home/job.sh<br><span class="hljs-comment">#sbatch -N 1 -w ct2 /home/job.sh </span><br><span class="hljs-comment">#-w åœ¨ct2ä¸Šæ‰§è¡Œè¯¥è„šæœ¬</span><br><span class="hljs-comment">#-N å…è®¸æ‚¨é€‰æ‹©è¦ä½¿ç”¨çš„è®¡ç®—èŠ‚ç‚¹æ•°é‡ã€‚</span><br><br><span class="hljs-comment">#æŸ¥çœ‹ä½œä¸š</span><br>squeue -a<br><br><span class="hljs-comment">#æŸ¥çœ‹æ ‡å‡†è¾“å‡ºæµï¼Œæ­£åœ¨è¿è¡Œçš„ä½œä¸šæˆ–ä½œä¸šæ­¥éª¤</span><br>scontrol show job 22 <br><br><span class="hljs-comment">#æ€æ­»å·¥ä½œè¿›ç¨‹</span><br>scancel 135  <span class="hljs-comment">#135ï¼šæŸ¥è¯¢å‡ºæ¥çš„JOBID</span><br></code></pre></td></tr></table></figure><h2 id="äº”ã€ä½¿ç”¨"><a href="#äº”ã€ä½¿ç”¨" class="headerlink" title="äº”ã€ä½¿ç”¨"></a>äº”ã€ä½¿ç”¨</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs txt">å®˜ç½‘æ‰‹å†Œï¼šhttps://docs.slurm.cn/users/shou-ce-ye<br>åŸºæœ¬ä½¿ç”¨ï¼šhttps://www.codeleading.com/article/58322478361/<br>SlurmåŸºæœ¬ç”¨æ³•ï¼šhttps://blog.csdn.net/qq_31910613/article/details/102993478<br>åŸºç¡€å‘½ä»¤è¯¦è§£ï¼šhttps://www.cnblogs.com/dahu-daqing/p/12693334.html<br>ä½¿ç”¨å‚è€ƒï¼šhttps://bicmr.pku.edu.cn/~wenzw/pages/slurm.html<br><br>æ“ä½œå‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/ZuoShifan/article/details/80472741?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_ecpm_v1~rank_v31_ecpm-1-80472741.pc_agg_new_rank&amp;utm_term=slurm%E5%A6%82%E4%BD%95%E6%89%80%E6%9C%89%E8%B5%84%E6%BA%90%E7%94%A8%E4%BA%8E%E4%B8%80%E4%B8%AA%E4%BB%BB%E5%8A%A1&amp;spm=1000.2123.3001.4430<br></code></pre></td></tr></table></figure><p>SLURM ç¯å¢ƒå˜é‡ï¼š</p><table><thead><tr><th>å˜é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>SLURM_NPROCS</td><td>è¦åŠ è½½çš„è¿›ç¨‹æ•°</td></tr><tr><td>SLURM_TASKS_PER_NODE</td><td>æ¯èŠ‚ç‚¹è¦åŠ è½½çš„ä»»åŠ¡æ•°</td></tr><tr><td>SLURM_JOB_ID</td><td>ä½œä¸šçš„ JobID</td></tr><tr><td>SLURM_SUBMIT_DIR</td><td>æäº¤ä½œä¸šæ—¶çš„å·¥ä½œç›®å½•</td></tr><tr><td>SLURM_JOB_NODELIST</td><td>ä½œä¸šåˆ†é…çš„èŠ‚ç‚¹åˆ—è¡¨</td></tr><tr><td>SLURM_JOB_CPUS_PER_NODE</td><td>æ¯ä¸ªèŠ‚ç‚¹ä¸Šåˆ†é…ç»™ä½œä¸šçš„ CPU æ•°</td></tr><tr><td>SLURM_JOB_NUM_NODES</td><td>ä½œä¸šåˆ†é…çš„èŠ‚ç‚¹æ•°</td></tr><tr><td>HOSTNAME</td><td>å¯¹äºæ‰¹å¤„ç†ä½œä¸šï¼Œæ­¤å˜é‡è¢«è®¾ç½®ä¸ºæ‰¹å¤„ç†è„šæœ¬æ‰€æ‰§è¡ŒèŠ‚ç‚¹çš„èŠ‚ç‚¹å</td></tr></tbody></table><h2 id="å…­ã€æ‹“å±•ï¼šå°†è¿è¡Œè¿‡ç¨‹çš„è¾“å‡ºæµï¼Œå¤åˆ¶åˆ°æœ¬æœº-x2F-homeä¸‹ï¼ˆæœºå™¨ä¸æœºå™¨ä¹‹é—´æœªå…å¯†ï¼‰ï¼š"><a href="#å…­ã€æ‹“å±•ï¼šå°†è¿è¡Œè¿‡ç¨‹çš„è¾“å‡ºæµï¼Œå¤åˆ¶åˆ°æœ¬æœº-x2F-homeä¸‹ï¼ˆæœºå™¨ä¸æœºå™¨ä¹‹é—´æœªå…å¯†ï¼‰ï¼š" class="headerlink" title="å…­ã€æ‹“å±•ï¼šå°†è¿è¡Œè¿‡ç¨‹çš„è¾“å‡ºæµï¼Œå¤åˆ¶åˆ°æœ¬æœº&#x2F;homeä¸‹ï¼ˆæœºå™¨ä¸æœºå™¨ä¹‹é—´æœªå…å¯†ï¼‰ï¼š"></a>å…­ã€æ‹“å±•ï¼šå°†è¿è¡Œè¿‡ç¨‹çš„è¾“å‡ºæµï¼Œå¤åˆ¶åˆ°æœ¬æœº&#x2F;homeä¸‹ï¼ˆæœºå™¨ä¸æœºå™¨ä¹‹é—´æœªå…å¯†ï¼‰ï¼š</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment">#authorï¼šzhangzhenzhou</span><br><span class="hljs-comment">#versionï¼š1.0</span><br><span class="hljs-comment">#readme:æ‰§è¡Œå‘½ä»¤ååŠ å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå°†è¾“å‡ºæµå¤åˆ¶åˆ°æœ¬æœºçš„/homeç›®å½•ä¸‹</span><br><span class="hljs-comment">#$SLURM_JOB_ID ä½œä¸šçš„ JobID</span><br><span class="hljs-comment">#$SLURM_JOB_NODELIST  #ä½œä¸šåˆ†é…çš„èŠ‚ç‚¹å</span><br>out_path=`scontrol show job <span class="hljs-variable">$SLURM_JOB_ID</span> | grep StdOut | awk -F <span class="hljs-string">&#x27;=&#x27;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br><br><span class="hljs-comment">#scpåˆ°æœ¬æœºä¸Š</span><br>/app/scp.exp <span class="hljs-variable">$out_path</span> root@mt1:/home/<br><br><span class="hljs-comment">#è¾“å‡ºæµä¿¡æ¯è¿›è¡Œè®°å½•</span><br>scontrol show job <span class="hljs-variable">$SLURM_JOB_ID</span>  &gt;&gt; /home/job_<span class="hljs-variable">$SLURM_JOB_ID</span>.version<br>/app/scp.exp /home/job_<span class="hljs-variable">$SLURM_JOB_ID</span>.version root@mt1:/home/<br><br></code></pre></td></tr></table></figure><p>scpè‡ªåŠ¨è¾“å…¥å¯†ç è„šæœ¬ï¼Œéœ€è¦scpçš„æœºå™¨æ‰§è¡Œå®Œä¸€æ¬¡åä¸å†æ‰§è¡Œ:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">##!/bin/sh</span><br><span class="hljs-comment">#authorï¼šjiangzhenzhou</span><br><span class="hljs-comment">#versionï¼š1.0</span><br><br>yum install expect <br><br><span class="hljs-comment">#ç¬¬ä¸€è¡Œè¿™é‡Œæ˜¯ä½ æœºå™¨ä¸Šexpectç¨‹åºçš„è·¯å¾„</span><br><span class="hljs-comment">#passwordåé¢æ¥ä½ çš„å¯†ç </span><br><span class="hljs-built_in">cat</span> &gt; /app/scp.exp &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">#!/usr/bin/expect  </span><br><span class="hljs-string">set timeout 20  </span><br><span class="hljs-string">if &#123; [llength \$argv] &lt; 2&#125; &#123;  </span><br><span class="hljs-string">    puts &quot;Usage:&quot;  </span><br><span class="hljs-string">    puts &quot;\$argv0 local_file remote_path&quot;  </span><br><span class="hljs-string">    exit 1  </span><br><span class="hljs-string">&#125;  </span><br><span class="hljs-string">set local_file [lindex \$argv 0]  </span><br><span class="hljs-string">set remote_path [lindex \$argv 1]  </span><br><span class="hljs-string">set passwd 123456  </span><br><span class="hljs-string">set passwderror 0  </span><br><span class="hljs-string">spawn scp \$local_file \$remote_path  </span><br><span class="hljs-string"></span><br><span class="hljs-string">expect &#123;  </span><br><span class="hljs-string">    &quot;*assword:*&quot; &#123;  </span><br><span class="hljs-string">        if &#123; \$passwderror == 1 &#125; &#123;  </span><br><span class="hljs-string">        puts &quot;passwd is error&quot;  </span><br><span class="hljs-string">        exit 2  </span><br><span class="hljs-string">        &#125;  </span><br><span class="hljs-string">        set timeout 1000  </span><br><span class="hljs-string">        set passwderror 1  </span><br><span class="hljs-string">        send &quot;\$passwd\r&quot;  </span><br><span class="hljs-string">        exp_continue  </span><br><span class="hljs-string">    &#125;  </span><br><span class="hljs-string">    &quot;*es/no)?*&quot; &#123;  </span><br><span class="hljs-string">        send &quot;yes\r&quot;  </span><br><span class="hljs-string">        exp_continue  </span><br><span class="hljs-string">    &#125;  </span><br><span class="hljs-string">    timeout &#123;  </span><br><span class="hljs-string">        puts &quot;connect is timeout&quot;  </span><br><span class="hljs-string">        exit 3  </span><br><span class="hljs-string">    &#125;  </span><br><span class="hljs-string">&#125;  </span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ å¯æ‰§è¡Œæƒé™</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">chmod</span> +x /app/scp.exp<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Slurm</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Slurm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨docker-composeè¿è¡Œsky+es</title>
    <link href="/2023/04/06/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E4%BD%BF%E7%94%A8docker-compose%E8%BF%90%E8%A1%8Csky+es8/"/>
    <url>/2023/04/06/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E4%BD%BF%E7%94%A8docker-compose%E8%BF%90%E8%A1%8Csky+es8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨docker-composeè¿è¡Œsky-es"><a href="#ä½¿ç”¨docker-composeè¿è¡Œsky-es" class="headerlink" title="ä½¿ç”¨docker-composeè¿è¡Œsky+es"></a>ä½¿ç”¨docker-composeè¿è¡Œsky+es</h1><h2 id="sky9-es8"><a href="#sky9-es8" class="headerlink" title="sky9+es8"></a>sky9+es8</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">elasticsearch:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">elasticsearch:8.5.3</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">elasticsearch</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">9200</span><span class="hljs-string">:9200</span><br>    <span class="hljs-attr">healthcheck:</span><br>      <span class="hljs-attr">test:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">CMD-SHELL</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">curl</span> <span class="hljs-string">-sf</span> <span class="hljs-string">http://localhost:9200/_cluster/health</span> <span class="hljs-string">||</span> <span class="hljs-string">exit</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span><br>      <span class="hljs-attr">timeout:</span> <span class="hljs-string">10s</span><br>      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span><br>      <span class="hljs-attr">start_period:</span> <span class="hljs-string">40s</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">discovery.type:</span> <span class="hljs-string">single-node</span><br>      <span class="hljs-attr">ingest.geoip.downloader.enabled:</span> <span class="hljs-string">&quot;false&quot;</span><br>      <span class="hljs-attr">bootstrap.memory_lock:</span> <span class="hljs-string">&quot;true&quot;</span><br>      <span class="hljs-attr">ES_JAVA_OPTS:</span> <span class="hljs-string">-Xms512m</span> <span class="hljs-string">-Xmx512m</span><br>      <span class="hljs-attr">TZ:</span> <span class="hljs-string">Asia/Shanghai</span><br>      <span class="hljs-attr">xpack.security.enabled:</span> <span class="hljs-string">&quot;false&quot;</span><br>    <span class="hljs-attr">ulimits:</span><br>      <span class="hljs-attr">memlock:</span><br>        <span class="hljs-attr">soft:</span> <span class="hljs-number">-1</span><br>        <span class="hljs-attr">hard:</span> <span class="hljs-number">-1</span><br>        <br>  <span class="hljs-attr">skywalking-oap:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">apache/skywalking-oap-server:9.3.0</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">skywalking-oap</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-attr">elasticsearch:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">elasticsearch</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">SW_HEALTH_CHECKER:</span> <span class="hljs-string">default</span><br>      <span class="hljs-attr">SW_STORAGE:</span> <span class="hljs-string">elasticsearch</span><br>      <span class="hljs-attr">SW_STORAGE_ES_CLUSTER_NODES:</span> <span class="hljs-string">elasticsearch:9200</span><br>      <span class="hljs-attr">JAVA_OPTS:</span> <span class="hljs-string">-Xms2048m</span> <span class="hljs-string">-Xmx2048m</span><br>      <span class="hljs-attr">TZ:</span> <span class="hljs-string">Asia/Shanghai</span><br>      <span class="hljs-attr">SW_TELEMETRY:</span> <span class="hljs-string">prometheus</span><br>    <span class="hljs-attr">healthcheck:</span><br>      <span class="hljs-attr">test:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">CMD-SHELL</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">/skywalking/bin/swctl</span> <span class="hljs-string">ch</span><br>      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span><br>      <span class="hljs-attr">timeout:</span> <span class="hljs-string">10s</span><br>      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span><br>      <span class="hljs-attr">start_period:</span> <span class="hljs-string">10s</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">on-failure</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">11800</span><span class="hljs-string">:11800</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">12800</span><span class="hljs-string">:12800</span><br><br>  <span class="hljs-attr">skywalking-ui:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">apache/skywalking-ui:9.3.0</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-attr">skywalking-oap:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">skywalking-oap</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">8080</span><span class="hljs-string">:8080</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">SW_OAP_ADDRESS:</span> <span class="hljs-string">http://skywalking-oap:12800</span><br>      <span class="hljs-attr">SW_HEALTH_CHECKER:</span> <span class="hljs-string">default</span><br>      <span class="hljs-attr">TZ:</span> <span class="hljs-string">Asia/Shanghai</span><br><br></code></pre></td></tr></table></figure><h2 id="sky8-9-es7"><a href="#sky8-9-es7" class="headerlink" title="sky8.9+es7"></a>sky8.9+es7</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">elasticsearch:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">elasticsearch:7.17.8</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">elasticsearch</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">9200</span><span class="hljs-string">:9200</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/data/sky+es/es/data:/usr/share/elasticsearch/data</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/data/sky+es/es/logs:/usr/share/elasticsearch/logs</span><br>    <span class="hljs-attr">healthcheck:</span><br>      <span class="hljs-attr">test:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">CMD-SHELL</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">curl</span> <span class="hljs-string">-sf</span> <span class="hljs-string">http://localhost:9200/_cluster/health</span> <span class="hljs-string">||</span> <span class="hljs-string">exit</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span><br>      <span class="hljs-attr">timeout:</span> <span class="hljs-string">10s</span><br>      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span><br>      <span class="hljs-attr">start_period:</span> <span class="hljs-string">40s</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">discovery.type:</span> <span class="hljs-string">single-node</span><br>      <span class="hljs-attr">ingest.geoip.downloader.enabled:</span> <span class="hljs-string">&quot;false&quot;</span><br>      <span class="hljs-attr">bootstrap.memory_lock:</span> <span class="hljs-string">&quot;true&quot;</span><br>      <span class="hljs-attr">ES_JAVA_OPTS:</span> <span class="hljs-string">-Xms512m</span> <span class="hljs-string">-Xmx512m</span><br>      <span class="hljs-attr">TZ:</span> <span class="hljs-string">Asia/Shanghai</span><br>      <span class="hljs-attr">xpack.security.enabled:</span> <span class="hljs-string">&quot;false&quot;</span><br>    <span class="hljs-attr">ulimits:</span><br>      <span class="hljs-attr">memlock:</span><br>        <span class="hljs-attr">soft:</span> <span class="hljs-number">-1</span><br>        <span class="hljs-attr">hard:</span> <span class="hljs-number">-1</span><br>        <br>  <span class="hljs-attr">skywalking-oap:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">apache/skywalking-oap-server:8.9.0</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">skywalking-oap</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-attr">elasticsearch:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">elasticsearch</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">SW_HEALTH_CHECKER:</span> <span class="hljs-string">default</span><br>      <span class="hljs-attr">SW_STORAGE:</span> <span class="hljs-string">elasticsearch</span><br>      <span class="hljs-attr">SW_STORAGE_ES_CLUSTER_NODES:</span> <span class="hljs-string">elasticsearch:9200</span><br>      <span class="hljs-attr">JAVA_OPTS:</span> <span class="hljs-string">-Xms2048m</span> <span class="hljs-string">-Xmx2048m</span><br>      <span class="hljs-attr">TZ:</span> <span class="hljs-string">Asia/Shanghai</span><br>      <span class="hljs-attr">SW_TELEMETRY:</span> <span class="hljs-string">prometheus</span><br>    <span class="hljs-attr">healthcheck:</span><br>      <span class="hljs-attr">test:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">CMD-SHELL</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">/skywalking/bin/swctl</span> <span class="hljs-string">ch</span><br>      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span><br>      <span class="hljs-attr">timeout:</span> <span class="hljs-string">10s</span><br>      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span><br>      <span class="hljs-attr">start_period:</span> <span class="hljs-string">10s</span><br>    <span class="hljs-string">restart:always</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">11800</span><span class="hljs-string">:11800</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">12800</span><span class="hljs-string">:12800</span><br><br>  <span class="hljs-attr">skywalking-ui:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">apache/skywalking-ui:8.9.0</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">skywalking-ui</span><br>    <span class="hljs-string">restart:always</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-attr">skywalking-oap:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">skywalking-oap</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">8080</span><span class="hljs-string">:8080</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">SW_OAP_ADDRESS:</span> <span class="hljs-string">http://skywalking-oap:12800</span><br>      <span class="hljs-attr">SW_HEALTH_CHECKER:</span> <span class="hljs-string">default</span><br>      <span class="hljs-attr">TZ:</span> <span class="hljs-string">Asia/Shanghai</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>SkyWalking</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SkyWalking</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨dockerè¿è¡ŒSkyWalking</title>
    <link href="/2023/04/06/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8CSkyWalking/"/>
    <url>/2023/04/06/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8CSkyWalking/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨dockerè¿è¡ŒSkyWalking"><a href="#ä½¿ç”¨dockerè¿è¡ŒSkyWalking" class="headerlink" title="ä½¿ç”¨dockerè¿è¡ŒSkyWalking"></a>ä½¿ç”¨dockerè¿è¡ŒSkyWalking</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://ggball.top/pages/787755/#%E6%96%87%E4%BB%B6%E5%87%86%E5%A4%87<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€å®‰è£…es"><a href="#ä¸€ã€å®‰è£…es" class="headerlink" title="ä¸€ã€å®‰è£…es"></a>ä¸€ã€å®‰è£…es</h2><h3 id="å¯åŠ¨-elasticsearch"><a href="#å¯åŠ¨-elasticsearch" class="headerlink" title="å¯åŠ¨ elasticsearch"></a>å¯åŠ¨ elasticsearch</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ›å»ºæŒ‚è½½ç›®å½•</span><br><span class="hljs-built_in">mkdir</span> -p /data/elasticsearch/data<br><span class="hljs-built_in">mkdir</span> -p /data/elasticsearch/logs<br><span class="hljs-built_in">chmod</span> -R 777 /data/elasticsearch/data<br><span class="hljs-built_in">chmod</span> -R 777 /data/elasticsearch/logs<br><span class="hljs-comment">#ä½¿ç”¨dockerè¿è¡Œ</span><br>docker run -d --name=es7 \<br>  --restart=always \<br>  -p 9200:9200 -p 9300:9300 \<br>  -e <span class="hljs-string">&quot;discovery.type=single-node&quot;</span> \<br>  -v /data/elasticsearch/data:/usr/share/elasticsearch/data \<br>  -v /data/elasticsearch/logs:/usr/share/elasticsearch/logs \<br>elasticsearch:7.17.8<br><br></code></pre></td></tr></table></figure><h2 id="äºŒã€å®‰è£…-oap"><a href="#äºŒã€å®‰è£…-oap" class="headerlink" title="äºŒã€å®‰è£… oap"></a>äºŒã€å®‰è£… oap</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br><span class="hljs-comment">#æ³¨æ„ï¼šç­‰å¾… elasticsearch å®Œå…¨å¯åŠ¨ä¹‹åï¼Œå†å¯åŠ¨ oap</span><br><br><span class="hljs-comment">#ä½¿ç”¨dockerè¿è¡Œoap</span><br>docker run --name oap --restart always -d \<br>--restart=always \<br>-e TZ=Asia/Shanghai \<br>-p 12800:12800 \<br>-p 11800:11800 \<br>--<span class="hljs-built_in">link</span> es7:es7 \<br>-e SW_STORAGE=elasticsearch7 \<br>-e SW_STORAGE_ES_CLUSTER_NODES=es7:9200 \<br>apache/skywalking-oap-server:8.3.0-es7<br><br><span class="hljs-comment">#è¯´æ˜ï¼š</span><br>â€“<span class="hljs-built_in">link</span>ï¼š es7 å’Œä½ å¯åŠ¨çš„ es å®¹å™¨çš„ name ä¿æŒä¸€è‡´<br>-e SW_STORAGE=elasticsearch7 æŒ‡å®š elasticsearch7 æ¥å­˜å‚¨æ•°æ®<br>-e SW_STORAGE_ES_CLUSTER_NODESï¼šes7 ä¹Ÿå¯æ”¹ä¸ºä½  es æœåŠ¡å™¨éƒ¨ç½²çš„ Ip åœ°å€ï¼Œå³ ip:9200<br><br></code></pre></td></tr></table></figure><h3 id="å½“æ›´æ”¹åˆ°æ›´é«˜çš„skywalkingåï¼ŒskywalkingæŠ¥é”™ï¼šno-provider-found-for-module-storage"><a href="#å½“æ›´æ”¹åˆ°æ›´é«˜çš„skywalkingåï¼ŒskywalkingæŠ¥é”™ï¼šno-provider-found-for-module-storage" class="headerlink" title="å½“æ›´æ”¹åˆ°æ›´é«˜çš„skywalkingåï¼ŒskywalkingæŠ¥é”™ï¼šno provider found for module storage"></a>å½“æ›´æ”¹åˆ°æ›´é«˜çš„skywalkingåï¼ŒskywalkingæŠ¥é”™ï¼šno provider found for module storage</h3><p>åŸå› åˆ†æï¼š<br>skywalking 8.8ä¹‹å‰ä¸èƒ½è‡ªåŠ¨æ„ŸçŸ¥å­˜å‚¨æºæ˜¯ä»€ä¹ˆï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šæ˜¯es6è¿˜æ˜¯7ï¼›<br>8.8ä¹‹åå¯ä»¥è‡ªåŠ¨æ„ŸçŸ¥å­˜å‚¨æºçš„ç‰ˆæœ¬ï¼Œä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šes6è¿˜æ˜¯7ï¼Œç›´æ¥å†™eså³å¯ï¼›</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">å°†ï¼š-e SW_STORAGE=elasticsearch7 \<br><br>æ”¹æˆï¼š-e SW_STORAGE=elasticsearch<br><br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€å®‰è£…UI"><a href="#ä¸‰ã€å®‰è£…UI" class="headerlink" title="ä¸‰ã€å®‰è£…UI"></a>ä¸‰ã€å®‰è£…UI</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d --name skywalking-ui \<br>--restart=always \<br>-e TZ=Asia/Shanghai \<br>-p 8080:8080 \<br>--<span class="hljs-built_in">link</span> oap:oap \<br>-e SW_OAP_ADDRESS=oap:12800 \<br>apache/skywalking-ui:8.3.0<br><br><span class="hljs-comment">#è¯´æ˜ï¼š</span><br>â€“ <span class="hljs-built_in">link</span>ï¼šæ³¨æ„å®¹å™¨çš„åç§°<br>-e SW_OAP_ADDRESSï¼šoap å®¹å™¨åç§°ï¼Œä¹Ÿå¯æ”¹ä¸º ip:12800ï¼Œå³å…¶ä»–æœåŠ¡çš„ IP å’Œç«¯å£<br></code></pre></td></tr></table></figure><h2 id="å››ã€ä½¿ç”¨agent"><a href="#å››ã€ä½¿ç”¨agent" class="headerlink" title="å››ã€ä½¿ç”¨agent"></a>å››ã€ä½¿ç”¨agent</h2><h3 id="4-1ã€ä¸‹è½½æºç åŒ…"><a href="#4-1ã€ä¸‹è½½æºç åŒ…" class="headerlink" title="4.1ã€ä¸‹è½½æºç åŒ…"></a>4.1ã€ä¸‹è½½æºç åŒ…</h3><p>ä¸‹è½½åœ°å€ï¼š<code>https://archive.apache.org/dist/skywalking/</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://archive.apache.org/dist/skywalking/8.6.0/apache-skywalking-apm-es7-8.6.0.tar.gz<br><span class="hljs-comment">#ä¸‹è½½æºç åŒ…å¹¶è§£å‹ï¼Œä¼šç”¨åˆ°å…¶ä¸­agentæ–‡ä»¶å¤¹</span><br>tar -xnf apache-skywalking-apm-es7-8.6.0.tar.gz &amp;&amp; <span class="hljs-built_in">cd</span> apache-skywalking-apm-bin-es7<br><br><span class="hljs-comment">#æ–‡ä»¶å¤¹æ‹·è´åˆ°å‘å¸ƒå®¹å™¨ä¸­ï¼Œä½ç½®å¯ä»¥æ ¹æ®æƒ…å†µè°ƒæ•´</span><br><span class="hljs-built_in">cp</span> -r ./agent/*  /opt/skywalkingAgent<br><br><span class="hljs-comment">#æ–‡ä»¶è¯´æ˜</span><br>config/agent.configï¼šä¸ºå®¢æˆ·ç«¯ä»£ç†é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ ¹æ®ç³»ç»Ÿæƒ…å†µè¿›è¡Œå“åº”è°ƒæ•´ã€‚<br>logsï¼šSW agent ç›¸å…³è¿è¡Œæƒ…å†µæ—¥å¿—ã€‚<br>skywalking-agent.jarï¼šagent ä»£ç† jar åŒ…ã€‚<br></code></pre></td></tr></table></figure><h3 id="4-2ã€ä½¿ç”¨æ–¹å¼"><a href="#4-2ã€ä½¿ç”¨æ–¹å¼" class="headerlink" title="4.2ã€ä½¿ç”¨æ–¹å¼"></a>4.2ã€ä½¿ç”¨æ–¹å¼</h3><p>æœ‰å››ç§æ–¹å¼é…ç½®ï¼Œä¼˜å…ˆçº§å¦‚ä¸‹:</p><blockquote><p>æ¢é’ˆé…ç½® &gt; JVMé…ç½® &gt; ç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½® &gt; agent.configæ–‡ä»¶</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">java -javaagent:/opt/skywalking/apache-skywalking-apm-bin-es7/agent/skywalking-agent.jar -Dskywalking.agent.service_name=service-pfm   -Dskywalking.collector.backend_service=127.0.0.1:11800  -jar lab-39-demo-2.2.2.RELEASE.jar<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>SkyWalking</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SkyWalking</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­å»ºSkyWalkingå•æœºç¯å¢ƒ</title>
    <link href="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E6%90%AD%E5%BB%BASkyWalking%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83/"/>
    <url>/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E6%90%AD%E5%BB%BASkyWalking%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="æ­å»º-SkyWalking-å•æœºç¯å¢ƒ"><a href="#æ­å»º-SkyWalking-å•æœºç¯å¢ƒ" class="headerlink" title="æ­å»º SkyWalking å•æœºç¯å¢ƒ"></a>æ­å»º SkyWalking å•æœºç¯å¢ƒ</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/#<br></code></pre></td></tr></table></figure><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>åˆ†å¸ƒå¼ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºæ€§èƒ½ç›‘è§†å·¥å…·ï¼Œä¸“ä¸ºå¾®æœåŠ¡ã€äº‘åŸç”Ÿæ¶æ„å’ŒåŸºäºå®¹å™¨ï¼ˆDockerã€K8sã€Mesosï¼‰æ¶æ„è€Œè®¾è®¡ã€‚<br>æä¾›åˆ†å¸ƒå¼è¿½è¸ªã€æœåŠ¡ç½‘æ ¼é¥æµ‹åˆ†æã€åº¦é‡èšåˆå’Œå¯è§†åŒ–ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‚</p><p><img src="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E6%90%AD%E5%BB%BASkyWalking%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83/0081Kckwly1gkl533fk5xj31pc0s8h04.jpg" alt="img"></p><h2 id="ä¸€ã€æ­å»ºè¿‡ç¨‹"><a href="#ä¸€ã€æ­å»ºè¿‡ç¨‹" class="headerlink" title="ä¸€ã€æ­å»ºè¿‡ç¨‹"></a>ä¸€ã€æ­å»ºè¿‡ç¨‹</h2><h3 id="1-æ ¹æ®ä¸‹é¢SkyWalkingæŒ‡å®šçš„esç‰ˆæœ¬å®‰è£…es"><a href="#1-æ ¹æ®ä¸‹é¢SkyWalkingæŒ‡å®šçš„esç‰ˆæœ¬å®‰è£…es" class="headerlink" title="1.æ ¹æ®ä¸‹é¢SkyWalkingæŒ‡å®šçš„esç‰ˆæœ¬å®‰è£…es"></a>1.æ ¹æ®ä¸‹é¢SkyWalkingæŒ‡å®šçš„esç‰ˆæœ¬å®‰è£…es</h3><p>ï¼ˆElasticsearch æ­å»ºè¿‡ç¨‹å·²ç•¥è¿‡ï¼Œå¯å‚è€ƒä¸ªäººæ–‡æ¡£ElasticSearchå®‰è£…ï¼‰</p><h3 id="2-ä¸‹è½½-SkyWalking-è½¯ä»¶åŒ…"><a href="#2-ä¸‹è½½-SkyWalking-è½¯ä»¶åŒ…" class="headerlink" title="2.ä¸‹è½½ SkyWalking è½¯ä»¶åŒ…"></a>2.ä¸‹è½½ SkyWalking è½¯ä»¶åŒ…</h3><p>ä¸‹è½½åœ°å€ï¼š<a href="https://archive.apache.org/dist/skywalking/">https://archive.apache.org/dist/skywalking/</a></p><p><img src="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E6%90%AD%E5%BB%BASkyWalking%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83/image-20221221153753854.png" alt="image-20221221153753854"></p><p><strong>å¤‡æ³¨ï¼Œé€‰æ‹©ä¸Šé¢å¤‡æ³¨äº†esç‰ˆæœ¬çš„åŒ…ä¸‹è½½</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /opt/SkyWalking &amp;&amp; <span class="hljs-built_in">cd</span> /opt/SkyWalking<br><br>wget https://archive.apache.org/dist/skywalking/8.6.0/<br><br>tar -xnf apache-skywalking-apm-es7-8.6.0.tar.gz<br></code></pre></td></tr></table></figure><h3 id="3-ä¿®æ”¹Skywalkingå­˜å‚¨çš„æ•°æ®æºé…ç½®"><a href="#3-ä¿®æ”¹Skywalkingå­˜å‚¨çš„æ•°æ®æºé…ç½®" class="headerlink" title="3.ä¿®æ”¹Skywalkingå­˜å‚¨çš„æ•°æ®æºé…ç½®"></a>3.ä¿®æ”¹Skywalkingå­˜å‚¨çš„æ•°æ®æºé…ç½®</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> apache-skywalking-apm-bin-es7/<br><br>vim config/application.yml<br><br><span class="hljs-comment">#SkyWalking9ç‰ˆæœ¬åå·²ç»å…¼å®¹äº†es678,åªéœ€è¦ä¿®æ”¹elasticsearchå³å¯</span><br></code></pre></td></tr></table></figure><p><img src="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E6%90%AD%E5%BB%BASkyWalking%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83/image-20221221163158665.png" alt="image-20221221163158665"></p><p>å¤‡æ³¨ï¼š$SW_NAMESPACEåé¢åç§°ä¸ºï¼šesçš„elasticsearch.ymlæ–‡ä»¶ä¸­çš„cluster.name:å­—æ®µåç§°</p><h3 id="4-ä¿®æ”¹UIé…ç½®æ–‡ä»¶ï¼Œç«¯å£å·é»˜è®¤ä¸º8080ï¼Œä¸ºäº†é¿å…ç«¯å£å·å†²çªï¼Œå¯ä»¥å°†å…¶ä¿®æ”¹ï¼ˆä¹Ÿå¯ä¸ä¿®æ”¹ï¼‰"><a href="#4-ä¿®æ”¹UIé…ç½®æ–‡ä»¶ï¼Œç«¯å£å·é»˜è®¤ä¸º8080ï¼Œä¸ºäº†é¿å…ç«¯å£å·å†²çªï¼Œå¯ä»¥å°†å…¶ä¿®æ”¹ï¼ˆä¹Ÿå¯ä¸ä¿®æ”¹ï¼‰" class="headerlink" title="4.ä¿®æ”¹UIé…ç½®æ–‡ä»¶ï¼Œç«¯å£å·é»˜è®¤ä¸º8080ï¼Œä¸ºäº†é¿å…ç«¯å£å·å†²çªï¼Œå¯ä»¥å°†å…¶ä¿®æ”¹ï¼ˆä¹Ÿå¯ä¸ä¿®æ”¹ï¼‰"></a>4.ä¿®æ”¹UIé…ç½®æ–‡ä»¶ï¼Œç«¯å£å·é»˜è®¤ä¸º8080ï¼Œä¸ºäº†é¿å…ç«¯å£å·å†²çªï¼Œå¯ä»¥å°†å…¶ä¿®æ”¹ï¼ˆä¹Ÿå¯ä¸ä¿®æ”¹ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim  webapp/webapp.yml<br></code></pre></td></tr></table></figure><p><img src="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E6%90%AD%E5%BB%BASkyWalking%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83/520237-20220329231847575-1603485708.png" alt="img"></p><h3 id="5-å¯åŠ¨skywalkingæœåŠ¡"><a href="#5-å¯åŠ¨skywalkingæœåŠ¡" class="headerlink" title="5.å¯åŠ¨skywalkingæœåŠ¡"></a>5.å¯åŠ¨skywalkingæœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">bin/startup.sh<br></code></pre></td></tr></table></figure><h3 id="6-æµè§ˆå™¨è®¿é—®skywalkingå®¢æˆ·ç«¯é¡µé¢"><a href="#6-æµè§ˆå™¨è®¿é—®skywalkingå®¢æˆ·ç«¯é¡µé¢" class="headerlink" title="6.æµè§ˆå™¨è®¿é—®skywalkingå®¢æˆ·ç«¯é¡µé¢"></a>6.æµè§ˆå™¨è®¿é—®skywalkingå®¢æˆ·ç«¯é¡µé¢</h3><p><img src="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E6%90%AD%E5%BB%BASkyWalking%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83/image-20221221165424543.png" alt="image-20221221165424543"></p><h2 id="äºŒã€ä½¿ç”¨Agent"><a href="#äºŒã€ä½¿ç”¨Agent" class="headerlink" title="äºŒã€ä½¿ç”¨Agent"></a>äºŒã€ä½¿ç”¨Agent</h2><h3 id="1ã€agentæ–‡ä»¶å¤¹è¯¦æƒ…ï¼š"><a href="#1ã€agentæ–‡ä»¶å¤¹è¯¦æƒ…ï¼š" class="headerlink" title="1ã€agentæ–‡ä»¶å¤¹è¯¦æƒ…ï¼š"></a>1ã€agentæ–‡ä»¶å¤¹è¯¦æƒ…ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">ll /opt/SkyWalking/apache-skywalking-apm-bin-es7/agent<br><span class="hljs-comment">#å¯ä»¥çœ‹åˆ°æœ‰å¦‚ä¸‹æ–‡ä»¶å¤¹</span><br></code></pre></td></tr></table></figure><p><img src="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E6%90%AD%E5%BB%BASkyWalking%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83/20200720171829856.png" alt="img"></p><h3 id="2ã€ä¸ºç»§ç»­æµ‹è¯•ä»¥ä¸‹æ­¥éª¤ï¼Œä»ç½‘ä¸Šå·²æ‰¾åˆ°ä¸€ä¸ªlab-39-demo-2-2-2-RELEASE-jaråŒ…ï¼Œgithubåœ°å€ä¸ºï¼šhttps-github-com-YunaiV-SpringBoot-Labs-tree-master-lab-39-lab-39-demoï¼Œå¯ä½¿ç”¨-mvn-clean-package-Dmaven-test-skip-true-ç¼–è¯‘ï¼Œå·²ä¿å­˜æœ¬åœ°"><a href="#2ã€ä¸ºç»§ç»­æµ‹è¯•ä»¥ä¸‹æ­¥éª¤ï¼Œä»ç½‘ä¸Šå·²æ‰¾åˆ°ä¸€ä¸ªlab-39-demo-2-2-2-RELEASE-jaråŒ…ï¼Œgithubåœ°å€ä¸ºï¼šhttps-github-com-YunaiV-SpringBoot-Labs-tree-master-lab-39-lab-39-demoï¼Œå¯ä½¿ç”¨-mvn-clean-package-Dmaven-test-skip-true-ç¼–è¯‘ï¼Œå·²ä¿å­˜æœ¬åœ°" class="headerlink" title="2ã€ä¸ºç»§ç»­æµ‹è¯•ä»¥ä¸‹æ­¥éª¤ï¼Œä»ç½‘ä¸Šå·²æ‰¾åˆ°ä¸€ä¸ªlab-39-demo-2.2.2.RELEASE.jaråŒ…ï¼Œgithubåœ°å€ä¸ºï¼šhttps://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-39/lab-39-demoï¼Œå¯ä½¿ç”¨ mvn clean package -Dmaven.test.skip=true ç¼–è¯‘ï¼Œå·²ä¿å­˜æœ¬åœ°"></a>2ã€ä¸ºç»§ç»­æµ‹è¯•ä»¥ä¸‹æ­¥éª¤ï¼Œä»ç½‘ä¸Šå·²æ‰¾åˆ°ä¸€ä¸ªlab-39-demo-2.2.2.RELEASE.jaråŒ…ï¼Œgithubåœ°å€ä¸ºï¼š<a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-39/lab-39-demo%EF%BC%8C%E5%8F%AF%E4%BD%BF%E7%94%A8">https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-39/lab-39-demoï¼Œå¯ä½¿ç”¨</a> <code>mvn clean package -Dmaven.test.skip=true</code> ç¼–è¯‘ï¼Œå·²ä¿å­˜æœ¬åœ°</h3><h3 id="3ã€ä¿®æ”¹é…ç½®"><a href="#3ã€ä¿®æ”¹é…ç½®" class="headerlink" title="3ã€ä¿®æ”¹é…ç½®"></a>3ã€ä¿®æ”¹é…ç½®</h3><p>æœ‰å››ç§æ–¹å¼é…ç½®ï¼Œä¼˜å…ˆçº§å¦‚ä¸‹:</p><blockquote><p>æ¢é’ˆé…ç½® &gt; JVMé…ç½® &gt; ç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½® &gt; agent.configæ–‡ä»¶</p></blockquote><h4 id="æ–¹å¼ä¸€ï¼šç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½®ï¼š"><a href="#æ–¹å¼ä¸€ï¼šç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½®ï¼š" class="headerlink" title="æ–¹å¼ä¸€ï¼šç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½®ï¼š"></a>æ–¹å¼ä¸€ï¼šç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½®ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># SkyWalking Agent é…ç½®</span><br><span class="hljs-built_in">export</span> SW_AGENT_NAME=my-test <span class="hljs-comment"># é…ç½® Agent åå­—ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ Spring Boot é¡¹ç›®çš„ `spring.application.name` ã€‚</span><br><span class="hljs-built_in">export</span> SW_AGENT_COLLECTOR_BACKEND_SERVICES=127.0.0.1:11800 <span class="hljs-comment"># é…ç½® Collector åœ°å€ã€‚</span><br><span class="hljs-built_in">export</span> SW_AGENT_SPAN_LIMIT=2000 <span class="hljs-comment"># é…ç½®é“¾è·¯çš„æœ€å¤§ Span æ•°é‡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸éœ€è¦é…ç½®ï¼Œé»˜è®¤ä¸º 300 ã€‚ä¸»è¦è€ƒè™‘ï¼Œæœ‰äº›æ–°ä¸Š SkyWalking Agent çš„é¡¹ç›®ï¼Œä»£ç å¯èƒ½æ¯”è¾ƒç³Ÿç³•ã€‚</span><br><span class="hljs-built_in">export</span> JAVA_AGENT=-javaagent:/opt/skywalking/apache-skywalking-apm-bin-es7/agent/skywalking-agent.jar <span class="hljs-comment"># SkyWalking Agent jar åœ°å€ã€‚</span><br><br><span class="hljs-comment"># Jar å¯åŠ¨</span><br>java -jar <span class="hljs-variable">$JAVA_AGENT</span> -jar lab-39-demo-2.2.2.RELEASE.jar<br></code></pre></td></tr></table></figure><h4 id="æ–¹å¼äºŒï¼šJVMå¯åŠ¨ï¼š"><a href="#æ–¹å¼äºŒï¼šJVMå¯åŠ¨ï¼š" class="headerlink" title="æ–¹å¼äºŒï¼šJVMå¯åŠ¨ï¼š"></a>æ–¹å¼äºŒï¼šJVMå¯åŠ¨ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">java -javaagent:/opt/skywalking/apache-skywalking-apm-bin-es7/agent/skywalking-agent.jar -Dskywalking.agent.service_name=service-pfm   -Dskywalking.collector.backend_service=127.0.0.1:11800  -jar lab-39-demo-2.2.2.RELEASE.jar<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•ä¸‰ï¼šé…ç½®æ–‡ä»¶å¯åŠ¨"><a href="#æ–¹æ³•ä¸‰ï¼šé…ç½®æ–‡ä»¶å¯åŠ¨" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šé…ç½®æ–‡ä»¶å¯åŠ¨"></a>æ–¹æ³•ä¸‰ï¼šé…ç½®æ–‡ä»¶å¯åŠ¨</h4><p>agent.configä¸»è¦é…ç½®</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim  /opt/SkyWalking/apache-skywalking-apm-bin-es7/agent/conf/agent.conf<br><br><span class="hljs-comment"># ä¸åŒçš„namespaceä¼šå¯¼è‡´è°ƒç”¨é“¾è·¯è¿½è¸ªä¸­æ–­</span><br>agent.namespace=<span class="hljs-variable">$&#123;SW_AGENT_NAMESPACE:default-namespace&#125;</span><br><br><span class="hljs-comment"># é¡µé¢ä¸Šå±•ç¤ºçš„serviceçš„åç§°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡-Dskywalking.agent.service_name=xxxæŒ‡å®š</span><br>agent.service_name=<span class="hljs-variable">$&#123;SW_AGENT_NAME:my-test&#125;</span><br><br><span class="hljs-comment"># å¹³å°çš„è°ƒç”¨åœ°å€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡-Dskywalking.collector.backend_service=127.0.0.1:11800æŒ‡å®š</span><br>collector.backend_service=<span class="hljs-variable">$&#123;SW_AGENT_COLLECTOR_BACKEND_SERVICES:127.0.0.1:11800&#125;</span><br><br><span class="hljs-comment"># å¿½ç•¥æŒ‡å®šåç¼€çš„è¯·æ±‚æ”¶é›†</span><br>agent.ignore_suffix=<span class="hljs-variable">$&#123;SW_AGENT_IGNORE_SUFFIX:.jpg,.jpeg,.js,.css,.png,.bmp,.gif,.ico,.mp3,.mp4,.html,.svg&#125;</span><br><br><span class="hljs-comment"># æ¯3ç§’çš„é‡‡æ ·ç‡ï¼Œè´Ÿæ•°ä»£è¡¨100%</span><br>agent.sample_n_per_3_secs=<span class="hljs-variable">$&#123;SW_AGENT_SAMPLE:-1&#125;</span><br></code></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼šå¦‚æœCollectorä»¥é›†ç¾¤æ–¹å¼éƒ¨ç½²ï¼Œæ¯”å¦‚ï¼šAcollectorå’ŒBcollectorï¼Œå»ºè®®Acollector.sampleRate &#x3D; Bcollector.sampleRate</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">java -javaagent:/opt/skywalking/apache-skywalking-apm-bin-es7/agent/skywalking-agent.jar  -jar lab-39-demo-2.2.2.RELEASE.jar<br></code></pre></td></tr></table></figure><p>â€“æ³¨æ„ï¼šè¿è¡Œåéƒ½å°†ä¼šåœ¨logsæ–‡ä»¶å¤¹ä¸‹äº§ç”Ÿæ—¥å¿—æ–‡ä»¶â€“</p><h3 id="4ã€æ ¹æ®ä»¥ä¸Šé…ç½®ä¿®æ”¹åè¿›è¡Œå¯åŠ¨ï¼›æˆ‘é€‰æ‹©çš„æ˜¯ã€Šæ–¹å¼äºŒJVMå¯åŠ¨ã€‹ã€‚"><a href="#4ã€æ ¹æ®ä»¥ä¸Šé…ç½®ä¿®æ”¹åè¿›è¡Œå¯åŠ¨ï¼›æˆ‘é€‰æ‹©çš„æ˜¯ã€Šæ–¹å¼äºŒJVMå¯åŠ¨ã€‹ã€‚" class="headerlink" title="4ã€æ ¹æ®ä»¥ä¸Šé…ç½®ä¿®æ”¹åè¿›è¡Œå¯åŠ¨ï¼›æˆ‘é€‰æ‹©çš„æ˜¯ã€Šæ–¹å¼äºŒJVMå¯åŠ¨ã€‹ã€‚"></a>4ã€æ ¹æ®ä»¥ä¸Šé…ç½®ä¿®æ”¹åè¿›è¡Œå¯åŠ¨ï¼›æˆ‘é€‰æ‹©çš„æ˜¯ã€Šæ–¹å¼äºŒJVMå¯åŠ¨ã€‹ã€‚</h3><p>å½“æŒ‰ç…§å‘½ä»¤å°†demoçš„jaråŒ…è¿è¡Œåï¼Œå¯åœ¨æœ¬åœ°æŸ¥çœ‹åˆ°æœ‰ä¸ªä¸º8079çš„ç«¯å£</p><p><img src="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E6%90%AD%E5%BB%BASkyWalking%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83/image-20221222164509266.png" alt="image-20221222164509266"></p><p>è®¿é—®ï¼š<a href="http://192.168.62.128:8079/demo/echo">http://192.168.62.128:8079/demo/echo</a></p><p><img src="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E6%90%AD%E5%BB%BASkyWalking%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83/image-20221222165132936.png" alt="image-20221222165132936"></p><p>ç„¶åæ‰“å¼€æˆ‘ä»¬çš„skywalkingå®¢æˆ·ç«¯é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æœåŠ¡å’Œæ•°æ®</p><p><img src="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/SkyWalking/%E6%90%AD%E5%BB%BASkyWalking%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83/image-20221222165937262.png" alt="image-20221222165937262"></p><h2 id="ä¸‰ã€ä½¿ç”¨systemctl"><a href="#ä¸‰ã€ä½¿ç”¨systemctl" class="headerlink" title="ä¸‰ã€ä½¿ç”¨systemctl"></a>ä¸‰ã€ä½¿ç”¨systemctl</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># åˆ›å»ºåå°å¯åŠ¨æ¨¡ç‰ˆ</span><br>vim /etc/systemd/system/skywaking.service<br><span class="hljs-comment"># å†…å®¹å¦‚ä¸‹ï¼š</span><br>[Unit]<br>Description=skywaking<br>After=network.target<br><br>[Service]<br><span class="hljs-comment">#/opt/SkyWalking/apache-skywalking-apm-bin-es7/ æ–‡ä»¶æ‰€åœ¨è·¯å¾„</span><br>ExecStart=/opt/SkyWalking/apache-skywalking-apm-bin-es7/bin/startup.sh<br><br>[Install]<br>WantedBy=multi-user.target<br><br><br><span class="hljs-comment"># å¯åŠ¨æµ‹è¯•</span><br>systemctl start skywaking.service<br><span class="hljs-comment"># æŸ¥çœ‹å¯åŠ¨çŠ¶æ€</span><br>systemctl status skywaking.service<br><span class="hljs-comment"># å¼€æœºè‡ªå¯</span><br>systemctl <span class="hljs-built_in">enable</span> skywaking.service<br><span class="hljs-comment"># é‡æ–°å¯åŠ¨</span><br>systemctl restart skywaking.service<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>SkyWalking</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SkyWalking</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Seataå®‰è£…éƒ¨ç½²</title>
    <link href="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/Seata/Seata%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"/>
    <url>/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/Seata/Seata%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Seataå®‰è£…éƒ¨ç½²"><a href="#Seataå®‰è£…éƒ¨ç½²" class="headerlink" title="Seataå®‰è£…éƒ¨ç½²"></a>Seataå®‰è£…éƒ¨ç½²</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">å®˜æ–¹æ–‡æ¡£ï¼šhttps://seata.io/zh-cn/docs/ops/deploy-guide-beginner.html<br>å‚è€ƒåšä¸»æ–‡æ¡£ï¼šhttps://www.yht7.com/news/213351<br>Seataåˆ†TCã€TMå’ŒRMä¸‰ä¸ªè§’è‰²ï¼ŒTCï¼ˆServerç«¯ï¼‰ä¸ºå•ç‹¬æœåŠ¡ç«¯éƒ¨ç½²ï¼ŒTMå’ŒRMï¼ˆClientç«¯ï¼‰ç”±ä¸šåŠ¡ç³»ç»Ÿé›†æˆã€‚<br></code></pre></td></tr></table></figure><p>Seata æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚Seata å°†ä¸ºç”¨æˆ·æä¾›äº† ATã€TCCã€SAGA å’Œ XA äº‹åŠ¡æ¨¡å¼ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="1ã€éƒ¨ç½²æ–¹å¼ï¼š"><a href="#1ã€éƒ¨ç½²æ–¹å¼ï¼š" class="headerlink" title="1ã€éƒ¨ç½²æ–¹å¼ï¼š"></a>1ã€éƒ¨ç½²æ–¹å¼ï¼š</h2><p>ä»¥ä¸‹é‡‡ç”¨DB+Nacosæ–¹å¼è¿›è¡Œéƒ¨ç½²ï¼ŒSeataæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒseataæœåŠ¡ç«¯ä¹Ÿæ˜¯ä¸€ä¸ªå¾®æœåŠ¡ï¼Œå’Œå…¶ä»–å¾®æœåŠ¡ä¸€æ ·éœ€è¦æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒã€‚<br>åŒæ—¶äº‹åŠ¡å›æ»šï¼Œéœ€è¦æ•°æ®åº“æ—¥å¿—è®°å½•:</p><ul><li>æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒ: nacos</li><li>æ•°æ®åº“: mysql</li></ul><h3 id="2ã€æœºå™¨-ã€æœåŠ¡è§„åˆ’ï¼š"><a href="#2ã€æœºå™¨-ã€æœåŠ¡è§„åˆ’ï¼š" class="headerlink" title="2ã€æœºå™¨ ã€æœåŠ¡è§„åˆ’ï¼š"></a>2ã€æœºå™¨ ã€æœåŠ¡è§„åˆ’ï¼š</h3><table><thead><tr><th>æœåŠ¡å™¨å</th><th>ipåœ°å€</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>mysql-seata</td><td>192.168.62.128</td><td>éƒ¨ç½²seataå’ŒmysqlæœåŠ¡</td></tr><tr><td>nacos</td><td>192.168.62.129</td><td>éƒ¨ç½²nacosæœåŠ¡</td></tr></tbody></table><h3 id="3ã€å®‰è£…nacosã€mysql"><a href="#3ã€å®‰è£…nacosã€mysql" class="headerlink" title="3ã€å®‰è£…nacosã€mysql"></a>3ã€å®‰è£…nacosã€mysql</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs txt">nacosï¼šï¼ˆå®‰è£…è¿‡ç¨‹ç•¥è¿‡ï¼‰<br>è®¿é—®é¡µé¢ï¼š192.168.62.129:8848/nacos<br>è´¦å·ï¼šnacos<br>å¯†ç ï¼šnacos<br><br>mysqlï¼šï¼ˆä½¿ç”¨dockerè¿è¡Œã€è¿‡ç¨‹ç•¥è¿‡ï¼‰<br>ç«¯å£ï¼š3306<br>è´¦å·ï¼šroot<br>å¯†ç ï¼š123456<br><br></code></pre></td></tr></table></figure><h3 id="4ã€å®‰è£…Seata-å‡åœ¨192-168-62-128æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰"><a href="#4ã€å®‰è£…Seata-å‡åœ¨192-168-62-128æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰" class="headerlink" title="4ã€å®‰è£…Seata(å‡åœ¨192.168.62.128æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰"></a>4ã€å®‰è£…Seata(å‡åœ¨192.168.62.128æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰</h3><p>å®‰è£…åŒ…ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/seata/seata/releases">https://github.com/seata/seata/releases</a></p><h4 id="4-1ã€ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…"><a href="#4-1ã€ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…" class="headerlink" title="4.1ã€ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…"></a>4.1ã€ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /app &amp;&amp; <span class="hljs-built_in">cd</span> /app<br>wget https://github.com/seata/seata/releases/download/v1.5.2/seata-server-1.5.2.tar.gz<br><br>tar -xnf seata-server-1.5.2.tar.gz<br><span class="hljs-built_in">cd</span> seata<br></code></pre></td></tr></table></figure><h4 id="4-2ã€åˆ›å»ºæ•°æ®åº“ï¼Œå¹¶åˆ›å»ºæ‰€éœ€çš„è¡¨"><a href="#4-2ã€åˆ›å»ºæ•°æ®åº“ï¼Œå¹¶åˆ›å»ºæ‰€éœ€çš„è¡¨" class="headerlink" title="4.2ã€åˆ›å»ºæ•°æ®åº“ï¼Œå¹¶åˆ›å»ºæ‰€éœ€çš„è¡¨"></a>4.2ã€åˆ›å»ºæ•°æ®åº“ï¼Œå¹¶åˆ›å»ºæ‰€éœ€çš„è¡¨</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ›å»ºseataæ•°æ®åº“</span><br>mysql -uroot -p123456 -e <span class="hljs-string">&#x27;create database seata;&#x27;</span><br><br><br><span class="hljs-comment">#åˆ›å»ºæ‰€éœ€è¡¨</span><br><span class="hljs-comment">#åœ¨seataæ–‡ä»¶å¤¹é‡Œé¢çš„scriptæ–‡ä»¶ï¼Œæ‰¾åˆ°server -&gt; db -&gt; mysql.sqlï¼Œç„¶ååœ¨æ•°æ®åº“ä¸­æ‰§è¡Œsqlè¯­å¥</span><br>mysql -uroot -p123456 seata &lt; /app/seata/script/server/db/mysql.sql<br><br><span class="hljs-comment">#å…¨å±€äº‹åŠ¡ä¼šè¯ç”±ï¼šå…¨å±€äº‹åŠ¡ã€åˆ†æ”¯äº‹åŠ¡ã€å…¨å±€é”ï¼Œå¯¹åº”è¡¨åˆ†åˆ«ä¸ºglobal_tableã€branch_tableã€lock_table</span><br></code></pre></td></tr></table></figure><h4 id="4-3ã€é…ç½®-nacos"><a href="#4-3ã€é…ç½®-nacos" class="headerlink" title="4.3ã€é…ç½® nacos"></a>4.3ã€é…ç½® nacos</h4><p>åœ¨nacosæ§åˆ¶å°æ·»åŠ æ–°çš„å‘½åç©ºé—´ï¼šæ·»åŠ <code>seata</code>ï¼Œ<code>å‘½åç©ºé—´ID</code>åœ¨åé¢éœ€è¦ç”¨åˆ°</p><p><img src="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/Seata/Seata%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/image-20221107175920290.png" alt="image-20221107175920290"></p><h4 id="4-4ã€ä¸Šä¼ é…ç½®è‡³Nacosé…ç½®ä¸­å¿ƒ"><a href="#4-4ã€ä¸Šä¼ é…ç½®è‡³Nacosé…ç½®ä¸­å¿ƒ" class="headerlink" title="4.4ã€ä¸Šä¼ é…ç½®è‡³Nacosé…ç½®ä¸­å¿ƒ"></a>4.4ã€ä¸Šä¼ é…ç½®è‡³Nacosé…ç½®ä¸­å¿ƒ</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åœ¨seataç›®å½•ä¸­ï¼Œæ‰¾åˆ°nacos-config.shæ–‡ä»¶ï¼Œè·¯å¾„ï¼šscript -&gt; config-center -&gt; nacos -&gt; nacos-config.shã€‚</span><br><span class="hljs-built_in">cd</span> /app/seata/script/config-center/nacos/<br><br><span class="hljs-comment">#æˆäºˆæ‰§è¡Œæƒé™</span><br>chomd 755 nacos-config.sh<br><br><span class="hljs-comment">#æ‰§è¡Œnacos-config.shè„šæœ¬ï¼š</span><br>sh nacos-config.sh -h 192.168.62.129 -p 8848 -g SEATA_GROUP -t 31a973ea-870b-454b-b103-eeec168ca766 -u nacos -w nacos<br><br><span class="hljs-comment">##å‚æ•°è¯¦è§£:</span><br>-h nacosæœåŠ¡IP<br>-p nacosæœåŠ¡ç«¯å£<br>-u nacosç™»å½•å<br>-w nacosç™»å½•å¯†ç <br>-g nacos é…ç½®çš„åˆ†ç»„åç§°ï¼Œé»˜è®¤è®¾ç½®SEATA_GROUP<br>-t ä¸Šä¸€æ­¥é…ç½®çš„å‘½åç©ºé—´ID<br><br><span class="hljs-comment">##æ‰§è¡Œè„šæœ¬ä¹‹åï¼Œè¾“å‡ºä»¥ä¸‹è„šæœ¬:</span><br>Set server.maxCommitRetryTimeout=-1 successfully <br>Set server.maxRollbackRetryTimeout=-1 successfully <br>Set server.rollbackRetryTimeoutUnlockEnable=<span class="hljs-literal">false</span> successfully <br>Set server.distributedLockExpireTime=10000 successfully<br><span class="hljs-comment">###...å†…å®¹çœç•¥</span><br></code></pre></td></tr></table></figure><p>æ‰“å¼€<code>nacos</code>æ§åˆ¶å°æŸ¥çœ‹é…ç½®æ˜¯å¦å¯¼å…¥ï¼š</p><p><img src="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/Seata/Seata%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/image-20221107180534786.png" alt="image-20221107180534786"></p><h4 id="4-5ã€ä¿®æ”¹appplication-ymlæ–‡ä»¶"><a href="#4-5ã€ä¿®æ”¹appplication-ymlæ–‡ä»¶" class="headerlink" title="4.5ã€ä¿®æ”¹appplication.ymlæ–‡ä»¶"></a>4.5ã€ä¿®æ”¹appplication.ymlæ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ‰¾åˆ°appplication.ymlæ–‡ä»¶ï¼Œè·¯å¾„ä¸ºï¼šseata -&gt; conf -&gt; application.yml</span><br><span class="hljs-built_in">cd</span>  /app/seata/conf/ &amp;&amp; <span class="hljs-built_in">cat</span> appplication.yml<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹appplication.ymlæ–‡ä»¶ä¸­çš„ä¸‰ä¸ªå°èŠ‚ï¼Œåˆ†åˆ«é…ç½®storeã€configã€registry:</p><p><img src="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/Seata/Seata%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/image-20221107180833048.png" alt="image-20221107180833048"></p><h5 id="4-5-1ã€é…ç½®seata-store"><a href="#4-5-1ã€é…ç½®seata-store" class="headerlink" title="4.5.1ã€é…ç½®seata.store"></a>4.5.1ã€é…ç½®seata.store</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#seata.storeé…ç½®seataçš„å­˜å‚¨</span><br>vim appplication.yml<br><br><span class="hljs-comment">##ä¿®æ”¹store.mode=&quot;db&quot;</span><br><span class="hljs-comment">##ä¿®æ”¹æ•°æ®åº“è¿æ¥ï¼Œå°† seata -&gt; conf -&gt; application.example.ymlä¸­é™„å¸¦çš„æ¨¡æ¿é…ç½®ï¼Œå°†å…¶dbç›¸å…³é…ç½®å¤åˆ¶è‡³application.yml,ä¿®æ”¹store.dbç›¸å…³å±æ€§ã€‚å’Œæ•°æ®åº“ï¼š</span><br><br><span class="hljs-comment">###..ä»¥ä¸‹ä¸ºä¿®æ”¹åå†…å®¹ï¼Œæ­¤å—å†…å®¹å¯åœ¨application.example.ymlæ–‡ä»¶å†…æ‰¾åˆ°æ¨¡æ¿..</span><br>  store:<br>    <span class="hljs-comment"># support: file ã€ db ã€ redis</span><br>    mode: db<br>    db:<br>      datasource: druid<br>      db-type: mysql<br>      driver-class-name: com.mysql.jdbc.Driver<br>      url: jdbc:mysql://192.168.62.128:3306/seata?rewriteBatchedStatements=<span class="hljs-literal">true</span><br>      user: root<br>      password: 123456<br>      min-conn: 5<br>      max-conn: 100<br>      global-table: global_table<br>      branch-table: branch_table<br>      lock-table: lock_table<br>      distributed-lock-table: distributed_lock<br>      query-limit: 100<br>      max-wait: 5000<br></code></pre></td></tr></table></figure><h5 id="4-5-2ã€é…ç½®seata-config"><a href="#4-5-2ã€é…ç½®seata-config" class="headerlink" title="4.5.2ã€é…ç½®seata.config"></a>4.5.2ã€é…ç½®seata.config</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#seata.configæ˜¯é…ç½®nacosé…ç½®ä¸­å¿ƒç›¸å…³çš„é…ç½®ã€‚</span><br><br>vim appplication.yml<br><br><span class="hljs-comment">##å°†seata.config.typeä¿®æ”¹æˆnacos</span><br><span class="hljs-comment">###..ä»¥ä¸‹ä¸ºä¿®æ”¹åå†…å®¹ï¼Œæ­¤å—å†…å®¹å¯åœ¨application.example.ymlæ–‡ä»¶å†…æ‰¾åˆ°æ¨¡æ¿..</span><br>  config:<br>    <span class="hljs-comment"># support: nacos, consul, apollo, zk, etcd3</span><br>    <span class="hljs-built_in">type</span>: nacos<br>    nacos:<br>      server-addr: 192.168.62.129:8848<br>      <span class="hljs-comment">#å…¶ä¸­namespaceæ˜¯åœ¨nacosæ§åˆ¶å°æ·»åŠ æ–°çš„å‘½åç©ºé—´ID</span><br>      namespace: 31a973ea-870b-454b-b103-eeec168ca766<br>      group: SEATA_GROUP<br>      username: nacos<br>      password: nacos<br>      <span class="hljs-comment">##if use MSE Nacos with auth, mutex with username/password attribute</span><br>      <span class="hljs-comment">#      #access-key: &quot;&quot;</span><br>      <span class="hljs-comment">#            #secret-key: &quot;&quot;</span><br>      <span class="hljs-comment">#data-id: seataServer.properties</span><br><br></code></pre></td></tr></table></figure><h5 id="4-5-3ã€é…ç½®seata-registry"><a href="#4-5-3ã€é…ç½®seata-registry" class="headerlink" title="4.5.3ã€é…ç½®seata.registry"></a>4.5.3ã€é…ç½®seata.registry</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#seata.registryæ˜¯é…ç½®æ³¨å†Œä¸­å¿ƒç›¸å…³å­—æ®µï¼Œå°†seataæœåŠ¡ä½œä¸ºä¸€ä¸ªå¾®æœåŠ¡æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ</span><br><br>vim appplication.yml<br><br><span class="hljs-comment">##å°†registry.typeæ”¹æˆnacos</span><br><span class="hljs-comment">###..ä»¥ä¸‹ä¸ºä¿®æ”¹åå†…å®¹ï¼Œæ­¤å—å†…å®¹å¯åœ¨application.example.ymlæ–‡ä»¶å†…æ‰¾åˆ°æ¨¡æ¿..</span><br>  registry:<br>    <span class="hljs-comment"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span><br>    <span class="hljs-built_in">type</span>: nacos<br>    nacos:<br>      application: seata-server<br>      server-addr: 192.168.62.129:8848<br>      group: SEATA_GROUP<br>      <span class="hljs-comment">#å…¶ä¸­namespaceæ˜¯åœ¨nacosæ§åˆ¶å°æ·»åŠ æ–°çš„å‘½åç©ºé—´ID</span><br>      namespace: 31a973ea-870b-454b-b103-eeec168ca766<br>      cluster: default<br>      username: nacos<br>      password: nacos<br>      <span class="hljs-comment">##if use MSE Nacos with auth, mutex with username/password attribute</span><br>      <span class="hljs-comment">#      #access-key: &quot;&quot;</span><br>      <span class="hljs-comment">#            #secret-key: &quot;&quot;</span><br><br></code></pre></td></tr></table></figure><h4 id="4-6ã€å¯åŠ¨"><a href="#4-6ã€å¯åŠ¨" class="headerlink" title="4.6ã€å¯åŠ¨"></a>4.6ã€å¯åŠ¨</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /app/seata/bin<br><br><br>./seata-server.sh -h 127.0.0.1 -p 8091 -m db<br><br><span class="hljs-comment">##æ§åˆ¶å°è¾“å‡ºï¼š</span><br>apm-skywalking not enabled<br>seata-server is starting, you can check the /app/seata/logs/start.out<br><br><br><span class="hljs-comment">##å‚æ•°è¯¦æƒ…ï¼š</span><br>-h: æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒçš„ip<br>-p: Server rpc ç›‘å¬ç«¯å£<br>-m: å…¨å±€äº‹åŠ¡ä¼šè¯ä¿¡æ¯å­˜å‚¨æ¨¡å¼ï¼Œfileã€dbã€redisï¼Œä¼˜å…ˆè¯»å–å¯åŠ¨å‚æ•° <br><br><span class="hljs-comment">##æ³¨: å †å†…å­˜å»ºè®®åˆ†é…2Gï¼Œå †å¤–å†…å­˜1G</span><br><br></code></pre></td></tr></table></figure><h4 id="4-7ã€éªŒè¯æ˜¯å¦æ­£å¸¸è¿è¡Œ"><a href="#4-7ã€éªŒè¯æ˜¯å¦æ­£å¸¸è¿è¡Œ" class="headerlink" title="4.7ã€éªŒè¯æ˜¯å¦æ­£å¸¸è¿è¡Œ"></a>4.7ã€éªŒè¯æ˜¯å¦æ­£å¸¸è¿è¡Œ</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ‰“å¼€start.outæ—¥å¿—</span><br><span class="hljs-built_in">tail</span> -20f /app/seata/logs/start.out<br><br><span class="hljs-comment">#ç³»ç»Ÿå¯åŠ¨æˆåŠŸå,ç™»é™†seataæ§åˆ¶å°</span><br>ç™»å½•åœ°å€ï¼šhttp://192.168.62.128:709<br>ç™»å½•è´¦å·ï¼šseata<br>å¯†ç ï¼šseata<br></code></pre></td></tr></table></figure><p><code>nacos</code>æ§åˆ¶å°æœåŠ¡åˆ—è¡¨æ–°å¢äº†ä¸€ä¸ªæœåŠ¡ï¼Œè¯´æ˜<code>seata</code>æœåŠ¡æˆåŠŸæ³¨å†Œåˆ°äº†<code>nacos</code>æ³¨å†Œä¸­å¿ƒï¼š</p><p><img src="/2023/04/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/Seata/Seata%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/image-20221107183004871.png" alt="image-20221107183004871"></p>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Seata</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Seata</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rocketmqé›†ç¾¤æ¨¡å¼æ­å»º</title>
    <link href="/2023/04/04/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/rocketmq%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/"/>
    <url>/2023/04/04/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/rocketmq%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Rocketmqé›†ç¾¤æ¨¡å¼æ­å»º"><a href="#Rocketmqé›†ç¾¤æ¨¡å¼æ­å»º" class="headerlink" title="Rocketmqé›†ç¾¤æ¨¡å¼æ­å»º"></a>Rocketmqé›†ç¾¤æ¨¡å¼æ­å»º</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å®˜æ–¹æ–‡æ¡£ï¼šhttps://rocketmq.apache.org/zh/docs/deploymentOperations/15deploy/<br></code></pre></td></tr></table></figure><h2 id="è§’è‰²ï¼š"><a href="#è§’è‰²ï¼š" class="headerlink" title="è§’è‰²ï¼š"></a>è§’è‰²ï¼š</h2><p>RocketMQä¸­ä¸»è¦æ¶‰åŠåˆ°å››ç§è§’è‰²ï¼šNameServeræ³¨å†ŒæœåŠ¡å™¨ã€BrokeræœåŠ¡å™¨ã€Producerç”Ÿäº§è€…ã€Consumeræ¶ˆè´¹è€…ã€‚æ¯ç§è§’è‰²éƒ½å¯ä»¥å•ç‹¬æ­å»ºé›†ç¾¤ã€‚</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs txt">(ä¸€)ã€NameServer é›†ç¾¤<br>NameServer æ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œå¯é›†ç¾¤éƒ¨ç½²ï¼ŒèŠ‚ç‚¹éƒ½æ˜¯å„è‡ªç‹¬ç«‹çš„ï¼Œæ— ä»»ä½•ä¿¡æ¯åŒæ­¥ã€‚<br><br>(äºŒ)ã€ Broker é›†ç¾¤<br>â‘  Broker åˆ†ä¸º Master ä¸ Slaveï¼Œä¸€ä¸ª Master å¯ä»¥å¯¹åº”å¤šä¸ª Slaveï¼Œä½†ä¸€ä¸ª Slave åªèƒ½å¯¹åº”ä¸€ä¸ªMasterï¼›<br>â‘¡ Master ä¸ Slave çš„å¯¹åº”å…³ç³»é€šè¿‡æŒ‡å®šç›¸åŒçš„ BrokerNameï¼Œä¸åŒçš„ BrokerID æ¥å®šä¹‰ï¼Œid ä¸º 0 è¡¨ç¤º Masterï¼Œ é 0 è¡¨ç¤º Slaveï¼›<br>â‘¢ å¯ä»¥éƒ¨ç½²å¤šä¸ª Master å®ç° Broker é›†ç¾¤ï¼Œå³å¤šç»„ Master - Slave çš„ Broker èŠ‚ç‚¹ï¼›<br>â‘£ Master é€šå¸¸ç”¨äºå†™å…¥æ•°æ®ï¼ŒSlave ç”¨äºè¯»å–æ•°æ®ï¼›<br>â‘¤ æ¯ä¸ª Broker ä¸ NameServer é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæ—¶æ³¨å†Œ Topic ä¿¡æ¯åˆ°æ‰€æœ‰ NameServerï¼›<br><br>(ä¸‰)ã€Producer é›†ç¾¤<br>â‘  Producer ä¸ºæ¶ˆæ¯çš„ç”Ÿäº§è€…ï¼Œéƒ½æ˜¯å„è‡ªç‹¬ç«‹çš„æ— çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œå¯ä»¥è®¤ä¸ºåªè¦å‘ mq ä¸­æ¨é€æ¶ˆæ¯çš„èŠ‚ç‚¹éƒ½ç®—ä½œ Producer èŠ‚ç‚¹ã€‚<br>â‘¡ Producer èŠ‚ç‚¹ä¸ NameServer é›†ç¾¤ä¸­çš„éšæœºä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸä» NameServer å–å‡º Topic è·¯ç”±ä¿¡æ¯ï¼Œå¹¶å‘æä¾› Topic æœåŠ¡çš„ Master å»ºç«‹é•¿è¿æ¥ï¼Œä¸”å®šæ—¶å‘ Master å‘é€å¿ƒè·³ã€‚<br><br>(å››)ã€Customer é›†ç¾¤<br>â‘  Customer ä¸ºæ¶ˆæ¯çš„æ¶ˆè´¹è€…ï¼Œéƒ½æ˜¯å„è‡ªç‹¬ç«‹çš„æ— çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œå¯ä»¥è®¤ä¸ºåªè¦å‘ mq ä¸­è·å–æ¶ˆæ¯çš„èŠ‚ç‚¹éƒ½ç®—ä½œ Customer èŠ‚ç‚¹ï¼›<br>â‘¡ Customer èŠ‚ç‚¹ä¸ NameServer é›†ç¾¤ä¸­çš„éšæœºä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸä» NameServer å–å‡º Topic è·¯ç”±ä¿¡æ¯ï¼Œå¹¶å‘æä¾› Topic æœåŠ¡çš„ Masterã€Slave å»ºç«‹é•¿è¿æ¥ï¼Œä¸”å®šæ—¶å‘ Masterã€Slave å‘é€å¿ƒè·³ï¼›<br>â‘¢ Customer èŠ‚ç‚¹æ—¢å¯ä»¥ä» Master è®¢é˜…æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä» Slave è®¢é˜…æ¶ˆæ¯ï¼Œè®¢é˜…è§„åˆ™ç”± Broker é…ç½®å†³å®šï¼›<br></code></pre></td></tr></table></figure><h2 id="RocketMQçš„å››ç§é›†ç¾¤æ¨¡å¼"><a href="#RocketMQçš„å››ç§é›†ç¾¤æ¨¡å¼" class="headerlink" title="RocketMQçš„å››ç§é›†ç¾¤æ¨¡å¼"></a>RocketMQçš„å››ç§é›†ç¾¤æ¨¡å¼</h2><h3 id="ä¸€ã€å•Masteræ¨¡å¼"><a href="#ä¸€ã€å•Masteræ¨¡å¼" class="headerlink" title="ä¸€ã€å•Masteræ¨¡å¼"></a>ä¸€ã€å•Masteræ¨¡å¼</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">è¿™ç§éƒ¨ç½²æ–¹å¼çš„é£é™©æ¯”è¾ƒå¤§ï¼Œä¸€æ—¦Brokerå®•æ‰ï¼Œå°±ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ï¼Œä¸€èˆ¬åªåœ¨å¼€å‘ç¯å¢ƒä¸ºäº†èŠ‚çº¦èµ„æºçš„æ—¶å€™ä½¿ç”¨ï¼Œçº¿ä¸Šç¯å¢ƒéå¸¸ä¸å»ºè®®ä½¿ç”¨ã€‚<br></code></pre></td></tr></table></figure><p><strong>éƒ¨ç½²æ–‡æ¡£:ã€ŠäºŒè¿›åˆ¶æ­å»ºrocketmqå•èŠ‚ç‚¹.mdã€‹</strong></p><h3 id="äºŒã€å¤šMasteræ¨¡å¼"><a href="#äºŒã€å¤šMasteræ¨¡å¼" class="headerlink" title="äºŒã€å¤šMasteræ¨¡å¼"></a>äºŒã€å¤šMasteræ¨¡å¼</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">è¿™ç§æ¨¡å¼ä¼šåœ¨ä¸€ä¸ªé›†ç¾¤ä¸­éƒ¨ç½²å¤šä¸ªMasterï¼Œæ²¡æœ‰Slaveï¼Œè¿™ç§æ¨¡å¼ä¹Ÿæ˜¯å­˜åœ¨ä¸€å®šçš„ä¼˜ç¼ºç‚¹ï¼š<br><br>ä¼˜ç‚¹ï¼šé…ç½®ç®€å•ï¼Œå•ä¸ªMasterå®•æ‰å…¶ä»–å‡ Masterå¯ä»¥æ­£å¸¸æä¾›æœåŠ¡ï¼Œåœ¨ç£ç›˜é…ç½®ä¸ºRAID10æ—¶ï¼Œæ¶ˆæ¯åŸºæœ¬ä¸Šä¸ä¼šä¸¢å¤±ï¼Œä¹‹æ‰€ä»¥ä¸æ˜¯ç™¾åˆ†ç™¾æ˜¯å› ä¸ºå¼‚æ­¥åˆ·ç›˜å¯èƒ½ä¼šä¸¢å¤±å°‘é‡æ¶ˆæ¯ï¼ŒåŒæ­¥åˆ·ç›˜ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚<br>ç¼ºç‚¹ï¼šå¦‚æœå…¶ä¸­ä¸€ä¸ªMasterå®•æ‰ï¼Œè¿™å°æœºå™¨ä¸Šè¿˜æ²¡æœ‰æ¶ˆè´¹çš„æ¶ˆæ¯åœ¨æ¢å¤ä¹‹å‰ä¸èƒ½è¢«æ¶ˆè´¹ï¼Œå¯èƒ½å½±å“æ¶ˆæ¯çš„æ¶ˆè´¹æ—¶æ•ˆã€‚<br></code></pre></td></tr></table></figure><h4 id="éƒ¨ç½²æ­¥éª¤ï¼š"><a href="#éƒ¨ç½²æ­¥éª¤ï¼š" class="headerlink" title="éƒ¨ç½²æ­¥éª¤ï¼š"></a><strong>éƒ¨ç½²æ­¥éª¤ï¼š</strong></h4><h5 id="1ã€ä¸‹è½½å¹¶è§£å‹RocketMQ"><a href="#1ã€ä¸‹è½½å¹¶è§£å‹RocketMQ" class="headerlink" title="1ã€ä¸‹è½½å¹¶è§£å‹RocketMQ"></a>1ã€ä¸‹è½½å¹¶è§£å‹RocketMQ</h5><p>äºŒè¿›åˆ¶åŒ…ä¸‹è½½åœ°å€ï¼š<a href="https://www.apache.org/dyn/closer.cgi?path=rocketmq/5.0.0/rocketmq-all-5.0.0-bin-release.zip">https://www.apache.org/dyn/closer.cgi?path=rocketmq/5.0.0/rocketmq-all-5.0.0-bin-release.zip</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://dlcdn.apache.org/rocketmq/5.0.0/rocketmq-all-5.0.0-bin-release.zip --no-check-certificate<br>unzip rocketmq-all-5.0.0-bin-release.zip<br><span class="hljs-built_in">cd</span> rocketmq-all-5.0.0-bin-release/<br></code></pre></td></tr></table></figure><h5 id="2ã€å¯åŠ¨NameServer"><a href="#2ã€å¯åŠ¨NameServer" class="headerlink" title="2ã€å¯åŠ¨NameServer"></a>2ã€å¯åŠ¨NameServer</h5><p>NameServeréœ€è¦å…ˆäºBrokerå¯åŠ¨ï¼Œä¸”å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œå»ºè®®ä¸€èˆ¬è§„æ¨¡çš„é›†ç¾¤å¯åŠ¨3ä¸ªNameServerï¼Œå„èŠ‚ç‚¹çš„å¯åŠ¨å‘½ä»¤ç›¸åŒï¼Œå¦‚ä¸‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># é¦–å…ˆå¯åŠ¨NameServer</span><br><span class="hljs-built_in">nohup</span> sh bin/mqnamesrv &amp;<br> <br><span class="hljs-comment"># éªŒè¯Name Server æ˜¯å¦å¯åŠ¨æˆåŠŸ</span><br><span class="hljs-built_in">tail</span> -f ~/logs/rocketmqlogs/namesrv.log<br>The Name Server boot success...<br></code></pre></td></tr></table></figure><h5 id="3ã€å¯åŠ¨Brokeré›†ç¾¤ï¼ˆä¸‰å°Masterï¼Œä¸€ä¸ªmqnamesrvï¼‰"><a href="#3ã€å¯åŠ¨Brokeré›†ç¾¤ï¼ˆä¸‰å°Masterï¼Œä¸€ä¸ªmqnamesrvï¼‰" class="headerlink" title="3ã€å¯åŠ¨Brokeré›†ç¾¤ï¼ˆä¸‰å°Masterï¼Œä¸€ä¸ªmqnamesrvï¼‰"></a>3ã€å¯åŠ¨Brokeré›†ç¾¤ï¼ˆä¸‰å°Masterï¼Œä¸€ä¸ªmqnamesrvï¼‰</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># åœ¨æœºå™¨Aï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªMasterï¼Œä¾‹å¦‚NameServerçš„IPä¸ºï¼š192.168.62.128</span><br><span class="hljs-comment">## conf/ä¸­æœ‰è®¸å¤šé…ç½®æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬ä¸‹æ–‡ç›´æ¥æ²¿ç”¨è¯¥2m-noslaveæ–‡ä»¶å¤¹å†…å®¹</span><br><span class="hljs-comment">### 2m-2s-async:ç›®å½•ä¸ºåŒmasteråŒslaveå¼‚æ­¥å¤åˆ¶é…ç½®ç›®å½•</span><br><span class="hljs-comment">### 2m-2s-sync :ç›®å½•ä¸ºåŒmasteråŒslaveåŒæ­¥åŒå†™é…ç½®ç›®å½•</span><br><span class="hljs-comment">### 2m-noslave :ç›®å½•ä¸ºå¤šmasteré…ç½®ç›®å½•</span><br><span class="hljs-built_in">nohup</span> sh bin/mqbroker -n 192.168.62.128:9876 -c ./conf/2m-noslave/broker-a.properties &amp;<br> <br><span class="hljs-comment"># åœ¨æœºå™¨Bï¼Œå¯åŠ¨ç¬¬äºŒä¸ªMasterï¼Œä¾‹å¦‚NameServerçš„IPä¸ºï¼š192.168.62.128</span><br><span class="hljs-built_in">nohup</span> sh bin/mqbroker -n 192.168.62.128:9876 -c ./conf/2m-noslave/broker-b.properties &amp;<br><br><span class="hljs-comment"># åœ¨æœºå™¨Cï¼Œå¯åŠ¨ç¬¬ä¸‰ä¸ªMasterï¼Œä¾‹å¦‚NameServerçš„IPä¸ºï¼š192.168.62.128</span><br><span class="hljs-comment">## å¤åˆ¶é…ç½®æ–‡ä»¶</span><br><span class="hljs-built_in">cp</span> ./conf/2m-noslave/broker-a.properties ./conf/2m-noslave/broker-c.properties<br>vim ./conf/2m-noslave/broker-c.properties<br><br><span class="hljs-comment">## ä¿®æ”¹brokerName</span><br>brokerName=broker-c<br><br><span class="hljs-comment">## å¯åŠ¨ç¬¬ä¸‰ä¸ªMaster</span><br><span class="hljs-built_in">nohup</span> sh bin/mqbroker -n 192.168.62.128:9876 -c ./conf/2m-noslave/broker-c.properties &amp;<br><br><br>å¤‡æ³¨ï¼šå¯¹äºå¤šä¸ªNameServerçš„é›†ç¾¤ï¼ŒBrokerå¯åŠ¨å‘½ä»¤ä¸­-nåé¢çš„åœ°å€åˆ—è¡¨ç”¨åˆ†å·éš”å¼€å³å¯ï¼Œä¾‹å¦‚<span class="hljs-string">&#x27;192.168.1.1:9876;192.161.2:9876&#x27;</span>ã€‚ä¹Ÿå¯åœ¨brokeré…ç½®æ–‡ä»¶å†…å®šä¹‰ã€‚<br></code></pre></td></tr></table></figure><h5 id="4ã€å¯åŠ¨proxyï¼ˆå¯ä»¥åœ¨å¤šå°æœºå™¨å¯åŠ¨å¤šä¸ªProxyï¼‰"><a href="#4ã€å¯åŠ¨proxyï¼ˆå¯ä»¥åœ¨å¤šå°æœºå™¨å¯åŠ¨å¤šä¸ªProxyï¼‰" class="headerlink" title="4ã€å¯åŠ¨proxyï¼ˆå¯ä»¥åœ¨å¤šå°æœºå™¨å¯åŠ¨å¤šä¸ªProxyï¼‰"></a>4ã€å¯åŠ¨proxyï¼ˆå¯ä»¥åœ¨å¤šå°æœºå™¨å¯åŠ¨å¤šä¸ªProxyï¼‰</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åœ¨æœºå™¨Aï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªProxy</span><br><span class="hljs-built_in">nohup</span> sh bin/mqproxy  -n 192.168.62.128:9876 &amp;<br><br><span class="hljs-comment">#åœ¨æœºå™¨Bï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªProxy</span><br><span class="hljs-built_in">nohup</span> sh bin/mqproxy  -n 192.168.62.128:9876 &amp;<br><br><span class="hljs-comment">#åœ¨æœºå™¨Cï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªProxy</span><br><span class="hljs-built_in">nohup</span> sh bin/mqproxy  -n 192.168.62.128:9876 &amp;<br><br><span class="hljs-comment"># å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å¯åŠ¨çŠ¶æ€</span><br>jps <br></code></pre></td></tr></table></figure><h3 id="ä¸‰ã€å¤šMasterå¤šSalveæ¨¡å¼ï¼ˆå¼‚æ­¥ï¼‰"><a href="#ä¸‰ã€å¤šMasterå¤šSalveæ¨¡å¼ï¼ˆå¼‚æ­¥ï¼‰" class="headerlink" title="ä¸‰ã€å¤šMasterå¤šSalveæ¨¡å¼ï¼ˆå¼‚æ­¥ï¼‰"></a>ä¸‰ã€å¤šMasterå¤šSalveæ¨¡å¼ï¼ˆå¼‚æ­¥ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">æ¯ä¸ªMasteré…ç½®ä¸€ä¸ªSlaveï¼Œæœ‰å¤šå¯¹Master-Slaveä¸€èµ·æä¾›æœåŠ¡ï¼ŒHAé‡‡ç”¨å¼‚æ­¥å¤åˆ¶æ–¹å¼ï¼Œä¸»å¤‡æœ‰å¾ˆçŸ­æš‚çš„æ¶ˆæ¯å»¶è¿Ÿï¼Œè¿™ç§æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ï¼š<br><br>ä¼˜ç‚¹ï¼šå³ä½¿ç£ç›˜æŸåï¼Œä¹Ÿåªæ˜¯ä¼šä¸¢å¤±éå¸¸å°‘çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯çš„æ—¶æ•ˆæ€§ä¹Ÿä¸ä¼šæœ‰å½±å“ï¼ŒMasterå®•æœºåä¾ç„¶å¯ä»¥æ¶ˆè´¹ä»Slaveæ¶ˆè´¹æ¶ˆæ¯ï¼Œå¹¶ä¸”è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦äººå·¥å¹²é¢„ï¼Œæ€§èƒ½å’Œå¤šMasteræ¨¡å¼æ¥è¿‘ã€‚<br>ç¼ºç‚¹ï¼šMasterå®•æœºç£ç›˜æŸåçš„æƒ…å†µä¸‹ä¼šä¸¢å¤±å°‘é‡æ¶ˆæ¯ã€‚<br></code></pre></td></tr></table></figure><h4 id="éƒ¨ç½²æ­¥éª¤ï¼š-1"><a href="#éƒ¨ç½²æ­¥éª¤ï¼š-1" class="headerlink" title="éƒ¨ç½²æ­¥éª¤ï¼š"></a><strong>éƒ¨ç½²æ­¥éª¤ï¼š</strong></h4><h5 id="1ã€å¯åŠ¨NameServer-é«˜å¯ç”¨ï¼Œé›†ç¾¤å¯åŠ¨3ä¸ªNameServer"><a href="#1ã€å¯åŠ¨NameServer-é«˜å¯ç”¨ï¼Œé›†ç¾¤å¯åŠ¨3ä¸ªNameServer" class="headerlink" title="1ã€å¯åŠ¨NameServer(é«˜å¯ç”¨ï¼Œé›†ç¾¤å¯åŠ¨3ä¸ªNameServer)"></a>1ã€å¯åŠ¨NameServer(é«˜å¯ç”¨ï¼Œé›†ç¾¤å¯åŠ¨3ä¸ªNameServer)</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å·²ç•¥è¿‡ä¸‹è½½å’Œè§£å‹æ­¥éª¤</span><br><span class="hljs-comment">#å¯åŠ¨Name Server</span><br>$ <span class="hljs-built_in">nohup</span> sh mqnamesrv &amp;<br> <br><span class="hljs-comment">### éªŒè¯Name Server æ˜¯å¦å¯åŠ¨æˆåŠŸ</span><br>$ <span class="hljs-built_in">tail</span> -f ~/logs/rocketmqlogs/namesrv.log<br>The Name Server boot success...<br></code></pre></td></tr></table></figure><h5 id="2ã€å¯åŠ¨Brokeré›†ç¾¤"><a href="#2ã€å¯åŠ¨Brokeré›†ç¾¤" class="headerlink" title="2ã€å¯åŠ¨Brokeré›†ç¾¤"></a>2ã€å¯åŠ¨Brokeré›†ç¾¤</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">## conf/ä¸­æœ‰è®¸å¤šé…ç½®æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬ä¸‹æ–‡ç›´æ¥æ²¿ç”¨è¯¥2m-2s-asyncæ–‡ä»¶å¤¹å†…å®¹</span><br><span class="hljs-comment">### 2m-2s-async:ç›®å½•ä¸ºåŒmasteråŒslaveå¼‚æ­¥å¤åˆ¶é…ç½®ç›®å½•</span><br><span class="hljs-comment">### 2m-2s-sync :ç›®å½•ä¸ºåŒmasteråŒslaveåŒæ­¥åŒå†™é…ç½®ç›®å½•</span><br><span class="hljs-comment">### 2m-noslave :ç›®å½•ä¸ºå¤šmasteré…ç½®ç›®å½•</span><br><br><span class="hljs-comment"># åœ¨æœºå™¨Aï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªMaster,NameServeré›†ç¾¤åœ°å€ä¸ºï¼š192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876</span><br><span class="hljs-built_in">nohup</span> sh bin/mqbroker -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> -c conf/2m-2s-async/broker-a.properties autoCreateTopicEnable=<span class="hljs-literal">true</span> &amp;<br><br><span class="hljs-comment"># åœ¨æœºå™¨Bï¼Œå¯åŠ¨ç¬¬äºŒä¸ªMaster,NameServeré›†ç¾¤åœ°å€ä¸ºï¼š192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876</span><br><span class="hljs-built_in">nohup</span> sh bin/mqbroker -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> -c conf/2m-2s-async/broker-a.properties autoCreateTopicEnable=<span class="hljs-literal">true</span> &amp;<br><br><span class="hljs-comment"># åœ¨æœºå™¨Cï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªSlave,NameServeré›†ç¾¤åœ°å€ä¸ºï¼š192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876</span><br><span class="hljs-built_in">nohup</span> sh bin/mqbroker -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> -c conf/2m-2s-async/broker-a-s.properties autoCreateTopicEnable=<span class="hljs-literal">true</span> &amp;<br><br><span class="hljs-comment"># åœ¨æœºå™¨Dï¼Œå¯åŠ¨ç¬¬äºŒä¸ªSlave,NameServeré›†ç¾¤åœ°å€ä¸ºï¼š192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876</span><br><span class="hljs-built_in">nohup</span> sh bin/mqbroker -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> -c conf/2m-2s-async/broker-b-s.properties autoCreateTopicEnable=<span class="hljs-literal">true</span> &amp;<br> <br><span class="hljs-comment">##autoCreateTopicEnable=true:å…è®¸åˆ›å»ºtopicï¼Œå¯å»æ‰</span><br></code></pre></td></tr></table></figure><h5 id="3ã€å¯åŠ¨proxyï¼ˆå¯ä»¥åœ¨å¤šå°æœºå™¨å¯åŠ¨å¤šä¸ªProxyï¼‰"><a href="#3ã€å¯åŠ¨proxyï¼ˆå¯ä»¥åœ¨å¤šå°æœºå™¨å¯åŠ¨å¤šä¸ªProxyï¼‰" class="headerlink" title="3ã€å¯åŠ¨proxyï¼ˆå¯ä»¥åœ¨å¤šå°æœºå™¨å¯åŠ¨å¤šä¸ªProxyï¼‰"></a>3ã€å¯åŠ¨proxyï¼ˆå¯ä»¥åœ¨å¤šå°æœºå™¨å¯åŠ¨å¤šä¸ªProxyï¼‰</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åœ¨æœºå™¨Aï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªProxy</span><br><span class="hljs-built_in">nohup</span> sh bin/mqproxy  -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> &amp;<br><br><span class="hljs-comment">#åœ¨æœºå™¨Bï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªProxy</span><br><span class="hljs-built_in">nohup</span> sh bin/mqproxy  -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> &amp;<br><br><span class="hljs-comment">#åœ¨æœºå™¨Cï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªProxy</span><br><span class="hljs-built_in">nohup</span> sh bin/mqproxy  -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> &amp;<br><br><span class="hljs-comment"># å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å¯åŠ¨çŠ¶æ€</span><br>jps <br></code></pre></td></tr></table></figure><h3 id="å››ã€å¤šMasterå¤šSlaveæ¨¡å¼ï¼ˆåŒæ­¥ï¼‰"><a href="#å››ã€å¤šMasterå¤šSlaveæ¨¡å¼ï¼ˆåŒæ­¥ï¼‰" class="headerlink" title="å››ã€å¤šMasterå¤šSlaveæ¨¡å¼ï¼ˆåŒæ­¥ï¼‰"></a>å››ã€å¤šMasterå¤šSlaveæ¨¡å¼ï¼ˆåŒæ­¥ï¼‰</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">æ¯ä¸ªMasteré…ç½®ä¸€ä¸ªSlaveï¼Œæœ‰å¤šå¯¹Master-Slaveï¼ŒHAé‡‡ç”¨åŒæ­¥åŒå†™æ–¹å¼ï¼Œå³åªæœ‰ä¸»å¤‡éƒ½å†™æˆåŠŸï¼Œæ‰å‘åº”ç”¨è¿”å›æˆåŠŸï¼Œè¿™ç§æ¨¡å¼çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š<br><br>ä¼˜ç‚¹ï¼šæ•°æ®ä¸æœåŠ¡éƒ½æ— å•ç‚¹æ•…éšœï¼ŒMasterå®•æœºæƒ…å†µä¸‹ï¼Œæ¶ˆæ¯æ— å»¶è¿Ÿï¼ŒæœåŠ¡å¯ç”¨æ€§ä¸æ•°æ®å¯ç”¨æ€§éƒ½éå¸¸é«˜ï¼›<br>ç¼ºç‚¹ï¼šæ€§èƒ½æ¯”å¼‚æ­¥å¤åˆ¶æ¨¡å¼ç•¥ä½ï¼ˆå¤§çº¦ä½10%å·¦å³ï¼‰ï¼Œå‘é€å•ä¸ªæ¶ˆæ¯çš„RTä¼šç•¥é«˜ï¼Œä¸”ç›®å‰ç‰ˆæœ¬åœ¨ä¸»èŠ‚ç‚¹å®•æœºåï¼Œå¤‡æœºä¸èƒ½è‡ªåŠ¨åˆ‡æ¢ä¸ºä¸»æœºã€‚<br></code></pre></td></tr></table></figure><h4 id="éƒ¨ç½²æ­¥éª¤ï¼š-2"><a href="#éƒ¨ç½²æ­¥éª¤ï¼š-2" class="headerlink" title="éƒ¨ç½²æ­¥éª¤ï¼š"></a><strong>éƒ¨ç½²æ­¥éª¤ï¼š</strong></h4><h5 id="1ã€å¯åŠ¨NameServer-é«˜å¯ç”¨ï¼Œé›†ç¾¤å¯åŠ¨3ä¸ªNameServer-1"><a href="#1ã€å¯åŠ¨NameServer-é«˜å¯ç”¨ï¼Œé›†ç¾¤å¯åŠ¨3ä¸ªNameServer-1" class="headerlink" title="1ã€å¯åŠ¨NameServer(é«˜å¯ç”¨ï¼Œé›†ç¾¤å¯åŠ¨3ä¸ªNameServer)"></a>1ã€å¯åŠ¨NameServer(é«˜å¯ç”¨ï¼Œé›†ç¾¤å¯åŠ¨3ä¸ªNameServer)</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å·²ç•¥è¿‡ä¸‹è½½å’Œè§£å‹æ­¥éª¤</span><br><span class="hljs-comment">#å¯åŠ¨Name Server</span><br>$ <span class="hljs-built_in">nohup</span> sh mqnamesrv &amp;<br> <br><span class="hljs-comment">### éªŒè¯Name Server æ˜¯å¦å¯åŠ¨æˆåŠŸ</span><br>$ <span class="hljs-built_in">tail</span> -f ~/logs/rocketmqlogs/namesrv.log<br>The Name Server boot success...<br></code></pre></td></tr></table></figure><h5 id="2ã€å¯åŠ¨Brokeré›†ç¾¤-1"><a href="#2ã€å¯åŠ¨Brokeré›†ç¾¤-1" class="headerlink" title="2ã€å¯åŠ¨Brokeré›†ç¾¤"></a>2ã€å¯åŠ¨Brokeré›†ç¾¤</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">## conf/ä¸­æœ‰è®¸å¤šé…ç½®æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬ä¸‹æ–‡ç›´æ¥æ²¿ç”¨è¯¥2m-2s-syncæ–‡ä»¶å¤¹å†…å®¹ï¼ˆç”Ÿäº§ç¯å¢ƒå¯æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ï¼‰</span><br><span class="hljs-comment">### 2m-2s-async:ç›®å½•ä¸ºåŒmasteråŒslaveå¼‚æ­¥å¤åˆ¶é…ç½®ç›®å½•</span><br><span class="hljs-comment">### 2m-2s-sync :ç›®å½•ä¸ºåŒmasteråŒslaveåŒæ­¥åŒå†™é…ç½®ç›®å½•</span><br><span class="hljs-comment">### 2m-noslave :ç›®å½•ä¸ºå¤šmasteré…ç½®ç›®å½•</span><br><br><span class="hljs-comment"># åœ¨æœºå™¨Aï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªMaster,NameServeré›†ç¾¤åœ°å€ä¸ºï¼š192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876</span><br><span class="hljs-built_in">nohup</span> sh bin/mqbroker -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> -c conf/2m-2s-<span class="hljs-built_in">sync</span>/broker-a.properties autoCreateTopicEnable=<span class="hljs-literal">true</span> &amp;<br><br><span class="hljs-comment"># åœ¨æœºå™¨Bï¼Œå¯åŠ¨ç¬¬äºŒä¸ªMaster,NameServeré›†ç¾¤åœ°å€ä¸ºï¼š192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876</span><br><span class="hljs-built_in">nohup</span> sh bin/mqbroker -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> -c conf/2m-2s-<span class="hljs-built_in">sync</span>/broker-a.properties autoCreateTopicEnable=<span class="hljs-literal">true</span> &amp;<br><br><span class="hljs-comment"># åœ¨æœºå™¨Cï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªSlave,NameServeré›†ç¾¤åœ°å€ä¸ºï¼š192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876</span><br><span class="hljs-built_in">nohup</span> sh bin/mqbroker -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> -c conf/2m-2s-<span class="hljs-built_in">sync</span>/broker-a-s.properties autoCreateTopicEnable=<span class="hljs-literal">true</span> &amp;<br><br><span class="hljs-comment"># åœ¨æœºå™¨Dï¼Œå¯åŠ¨ç¬¬äºŒä¸ªSlave,NameServeré›†ç¾¤åœ°å€ä¸ºï¼š192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876</span><br><span class="hljs-built_in">nohup</span> sh bin/mqbroker -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> -c conf/2m-2s-<span class="hljs-built_in">sync</span>/broker-b-s.properties autoCreateTopicEnable=<span class="hljs-literal">true</span> &amp;<br></code></pre></td></tr></table></figure><h5 id="3ã€å¯åŠ¨proxyï¼ˆå¯ä»¥åœ¨å¤šå°æœºå™¨å¯åŠ¨å¤šä¸ªProxyï¼‰-1"><a href="#3ã€å¯åŠ¨proxyï¼ˆå¯ä»¥åœ¨å¤šå°æœºå™¨å¯åŠ¨å¤šä¸ªProxyï¼‰-1" class="headerlink" title="3ã€å¯åŠ¨proxyï¼ˆå¯ä»¥åœ¨å¤šå°æœºå™¨å¯åŠ¨å¤šä¸ªProxyï¼‰"></a>3ã€å¯åŠ¨proxyï¼ˆå¯ä»¥åœ¨å¤šå°æœºå™¨å¯åŠ¨å¤šä¸ªProxyï¼‰</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åœ¨æœºå™¨Aï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªProxy</span><br><span class="hljs-built_in">nohup</span> sh bin/mqproxy  -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> &amp;<br><br><span class="hljs-comment">#åœ¨æœºå™¨Bï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªProxy</span><br><span class="hljs-built_in">nohup</span> sh bin/mqproxy  -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> &amp;<br><br><span class="hljs-comment">#åœ¨æœºå™¨Cï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªProxy</span><br><span class="hljs-built_in">nohup</span> sh bin/mqproxy  -n <span class="hljs-string">&#x27;192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&#x27;</span> &amp;<br><br><span class="hljs-comment"># å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å¯åŠ¨çŠ¶æ€</span><br>jps <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>rocketmq</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rocketmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RocketMQé›†ç¾¤æ¶æ„</title>
    <link href="/2023/04/04/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/Rocketmq%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84/"/>
    <url>/2023/04/04/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/Rocketmq%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="RocketMQé›†ç¾¤æ¶æ„"><a href="#RocketMQé›†ç¾¤æ¶æ„" class="headerlink" title="RocketMQé›†ç¾¤æ¶æ„"></a>RocketMQé›†ç¾¤æ¶æ„</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒé“¾æ¥ï¼šhttps://blog.csdn.net/Weixiaohuai/article/details/123607472<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€é›†ç¾¤æ¶æ„ï¼š"><a href="#ä¸€ã€é›†ç¾¤æ¶æ„ï¼š" class="headerlink" title="ä¸€ã€é›†ç¾¤æ¶æ„ï¼š"></a>ä¸€ã€é›†ç¾¤æ¶æ„ï¼š</h2><h3 id="ç½‘ç»œéƒ¨ç½²å›¾ï¼š"><a href="#ç½‘ç»œéƒ¨ç½²å›¾ï¼š" class="headerlink" title="ç½‘ç»œéƒ¨ç½²å›¾ï¼š"></a>ç½‘ç»œéƒ¨ç½²å›¾ï¼š</h3><p><img src="/2023/04/04/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/Rocketmq%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84/478598db4e9d3582aa7b8bac569e6c15.png" alt="img"></p><p>RocketMQä¸­ä¸»è¦æ¶‰åŠåˆ°å››ç§è§’è‰²ï¼šNameServeræ³¨å†ŒæœåŠ¡å™¨ã€BrokeræœåŠ¡å™¨ã€Producerç”Ÿäº§è€…ã€Consumeræ¶ˆè´¹è€…ã€‚æ¯ç§è§’è‰²éƒ½å¯ä»¥å•ç‹¬æ­å»ºé›†ç¾¤ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ä»‹ç»ä¸€ä¸‹NameServer é›†ç¾¤ã€Broker é›†ç¾¤ã€Producer é›†ç¾¤ã€Customer é›†ç¾¤ã€‚</p><h3 id="ä¸€-ã€NameServer-é›†ç¾¤"><a href="#ä¸€-ã€NameServer-é›†ç¾¤" class="headerlink" title="(ä¸€)ã€NameServer é›†ç¾¤"></a><strong>(ä¸€)ã€NameServer é›†ç¾¤</strong></h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">NameServer æ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œå¯é›†ç¾¤éƒ¨ç½²ï¼ŒèŠ‚ç‚¹éƒ½æ˜¯å„è‡ªç‹¬ç«‹çš„ï¼Œæ— ä»»ä½•ä¿¡æ¯åŒæ­¥ã€‚<br></code></pre></td></tr></table></figure><h3 id="äºŒ-ã€-Broker-é›†ç¾¤"><a href="#äºŒ-ã€-Broker-é›†ç¾¤" class="headerlink" title="(äºŒ)ã€ Broker é›†ç¾¤"></a><strong>(äºŒ)ã€ Broker é›†ç¾¤</strong></h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs txt">â‘  Broker åˆ†ä¸º Master ä¸ Slaveï¼Œä¸€ä¸ª Master å¯ä»¥å¯¹åº”å¤šä¸ª Slaveï¼Œä½†ä¸€ä¸ª Slave åªèƒ½å¯¹åº”ä¸€ä¸ªMasterï¼›<br>â‘¡ Master ä¸ Slave çš„å¯¹åº”å…³ç³»é€šè¿‡æŒ‡å®šç›¸åŒçš„ BrokerNameï¼Œä¸åŒçš„ BrokerID æ¥å®šä¹‰ï¼Œid ä¸º 0 è¡¨ç¤º Masterï¼Œ é 0 è¡¨ç¤º Slaveï¼›<br>â‘¢ å¯ä»¥éƒ¨ç½²å¤šä¸ª Master å®ç° Broker é›†ç¾¤ï¼Œå³å¤šç»„ Master - Slave çš„ Broker èŠ‚ç‚¹ï¼›<br>â‘£ Master é€šå¸¸ç”¨äºå†™å…¥æ•°æ®ï¼ŒSlave ç”¨äºè¯»å–æ•°æ®ï¼›<br>â‘¤ æ¯ä¸ª Broker ä¸ NameServer é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæ—¶æ³¨å†Œ Topic ä¿¡æ¯åˆ°æ‰€æœ‰ NameServerï¼›<br></code></pre></td></tr></table></figure><h3 id="ä¸‰-ã€Producer-é›†ç¾¤"><a href="#ä¸‰-ã€Producer-é›†ç¾¤" class="headerlink" title="(ä¸‰)ã€Producer é›†ç¾¤"></a><strong>(ä¸‰)ã€Producer é›†ç¾¤</strong></h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">â‘  Producer ä¸ºæ¶ˆæ¯çš„ç”Ÿäº§è€…ï¼Œéƒ½æ˜¯å„è‡ªç‹¬ç«‹çš„æ— çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œå¯ä»¥è®¤ä¸ºåªè¦å‘ mq ä¸­æ¨é€æ¶ˆæ¯çš„èŠ‚ç‚¹éƒ½ç®—ä½œ Producer èŠ‚ç‚¹ã€‚<br>â‘¡ Producer èŠ‚ç‚¹ä¸ NameServer é›†ç¾¤ä¸­çš„éšæœºä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸä» NameServer å–å‡º Topic è·¯ç”±ä¿¡æ¯ï¼Œå¹¶å‘æä¾› Topic æœåŠ¡çš„ Master å»ºç«‹é•¿è¿æ¥ï¼Œä¸”å®šæ—¶å‘ Master å‘é€å¿ƒè·³ã€‚<br></code></pre></td></tr></table></figure><h3 id="å››-ã€Customer-é›†ç¾¤"><a href="#å››-ã€Customer-é›†ç¾¤" class="headerlink" title="(å››)ã€Customer é›†ç¾¤"></a><strong>(å››)ã€Customer é›†ç¾¤</strong></h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">â‘  Customer ä¸ºæ¶ˆæ¯çš„æ¶ˆè´¹è€…ï¼Œéƒ½æ˜¯å„è‡ªç‹¬ç«‹çš„æ— çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œå¯ä»¥è®¤ä¸ºåªè¦å‘ mq ä¸­è·å–æ¶ˆæ¯çš„èŠ‚ç‚¹éƒ½ç®—ä½œ Customer èŠ‚ç‚¹ï¼›<br>â‘¡ Customer èŠ‚ç‚¹ä¸ NameServer é›†ç¾¤ä¸­çš„éšæœºä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸä» NameServer å–å‡º Topic è·¯ç”±ä¿¡æ¯ï¼Œå¹¶å‘æä¾› Topic æœåŠ¡çš„ Masterã€Slave å»ºç«‹é•¿è¿æ¥ï¼Œä¸”å®šæ—¶å‘ Masterã€Slave å‘é€å¿ƒè·³ï¼›<br>â‘¢ Customer èŠ‚ç‚¹æ—¢å¯ä»¥ä» Master è®¢é˜…æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä» Slave è®¢é˜…æ¶ˆæ¯ï¼Œè®¢é˜…è§„åˆ™ç”± Broker é…ç½®å†³å®šï¼›<br></code></pre></td></tr></table></figure><h2 id="äºŒã€RocketMQé›†ç¾¤å·¥ä½œæµç¨‹"><a href="#äºŒã€RocketMQé›†ç¾¤å·¥ä½œæµç¨‹" class="headerlink" title="äºŒã€RocketMQé›†ç¾¤å·¥ä½œæµç¨‹"></a>äºŒã€RocketMQé›†ç¾¤å·¥ä½œæµç¨‹</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs txt">1ã€å¯åŠ¨NameServerï¼ŒNameServerå¯åŠ¨åç›‘å¬ç«¯å£ï¼Œç­‰å¾…Brokerã€Producerã€Consumerè¿ä¸Šæ¥ï¼Œç›¸å½“äºä¸€ä¸ªè·¯ç”±æ§åˆ¶ä¸­å¿ƒã€‚<br>2ã€Brokerå¯åŠ¨ï¼Œè·Ÿæ‰€æœ‰çš„NameServerä¿æŒé•¿è¿æ¥ï¼Œå®šæ—¶å‘é€å¿ƒè·³åŒ…ã€‚å¿ƒè·³åŒ…ä¸­åŒ…å«å½“å‰Brokerä¿¡æ¯(IP+ç«¯å£ç­‰)ä»¥åŠå­˜å‚¨æ‰€æœ‰Topicä¿¡æ¯ã€‚æ³¨å†ŒæˆåŠŸåï¼ŒNameServeré›†ç¾¤ä¸­å°±æœ‰Topicè·ŸBrokerçš„æ˜ å°„å…³ç³»ã€‚<br>3ã€æ”¶å‘æ¶ˆæ¯å‰ï¼Œå…ˆåˆ›å»ºTopicï¼Œåˆ›å»ºTopicæ—¶éœ€è¦æŒ‡å®šè¯¥Topicè¦å­˜å‚¨åœ¨å“ªäº›Brokerä¸Šï¼Œä¹Ÿå¯ä»¥åœ¨å‘é€æ¶ˆæ¯æ—¶è‡ªåŠ¨åˆ›å»ºTopicã€‚<br>4ã€Producerå‘é€æ¶ˆæ¯ï¼Œå¯åŠ¨æ—¶å…ˆè·ŸNameServeré›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€å°å»ºç«‹é•¿è¿æ¥ï¼Œå¹¶ä»NameServerä¸­è·å–å½“å‰å‘é€çš„Topicå­˜åœ¨å“ªäº›Brokerä¸Šï¼Œè½®è¯¢ä»é˜Ÿåˆ—åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç„¶åä¸é˜Ÿåˆ—æ‰€åœ¨çš„Brokerå»ºç«‹é•¿è¿æ¥ä»è€Œå‘Brokerå‘æ¶ˆæ¯ã€‚<br>5ã€Consumerè·ŸProducerç±»ä¼¼ï¼Œè·Ÿå…¶ä¸­ä¸€å°NameServerå»ºç«‹é•¿è¿æ¥ï¼Œè·å–å½“å‰è®¢é˜…Topicå­˜åœ¨å“ªäº›Brokerä¸Šï¼Œç„¶åç›´æ¥è·ŸBrokerå»ºç«‹è¿æ¥é€šé“ï¼Œå¼€å§‹æ¶ˆè´¹æ¶ˆæ¯ã€‚<br></code></pre></td></tr></table></figure><p>Masteræ”¯æŒè¯»å’Œå†™ï¼ŒSlaveä»…æ”¯æŒè¯»ï¼Œä¹Ÿå°±æ˜¯ Produceråªèƒ½å’ŒMasterè¿æ¥å†™å…¥æ¶ˆæ¯ï¼›Consumerå¯ä»¥è¿æ¥ Masterï¼Œä¹Ÿå¯ä»¥è¿æ¥Slaveæ¥è¯»å–æ¶ˆæ¯ã€‚</p><h2 id="ä¸‰ã€RocketMQåˆ·ç›˜æœºåˆ¶"><a href="#ä¸‰ã€RocketMQåˆ·ç›˜æœºåˆ¶" class="headerlink" title="ä¸‰ã€RocketMQåˆ·ç›˜æœºåˆ¶"></a>ä¸‰ã€RocketMQåˆ·ç›˜æœºåˆ¶</h2><p>RocketMQçš„æ¶ˆæ¯æ˜¯å­˜å‚¨åˆ°ç£ç›˜ä¸Šçš„ï¼Œè¿™æ ·æ—¢èƒ½ä¿è¯æ–­ç”µåæ¢å¤ï¼Œ åˆå¯ä»¥è®©å­˜å‚¨çš„æ¶ˆæ¯é‡è¶…å‡ºå†…å­˜çš„é™åˆ¶ã€‚RocketMQä¸ºäº†æé«˜æ€§èƒ½ï¼Œä¼šå°½å¯èƒ½åœ°ä¿è¯ç£ç›˜çš„é¡ºåºå†™ã€‚æ¶ˆæ¯åœ¨é€šè¿‡Producerå†™å…¥RocketMQçš„æ—¶å€™ï¼Œæœ‰ä¸¤ç§å†™ç£ç›˜æ–¹å¼ï¼šåŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜ã€‚å¦‚ä¸‹å›¾ï¼š</p><h3 id="1ï¼‰åŒæ­¥åˆ·ç›˜"><a href="#1ï¼‰åŒæ­¥åˆ·ç›˜" class="headerlink" title="1ï¼‰åŒæ­¥åˆ·ç›˜"></a>1ï¼‰åŒæ­¥åˆ·ç›˜</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">åœ¨è¿”å›å†™æˆåŠŸçŠ¶æ€æ—¶ï¼Œæ¶ˆæ¯å·²ç»è¢«å†™å…¥ç£ç›˜ã€‚å…·ä½“æµç¨‹æ˜¯ï¼Œæ¶ˆæ¯å†™å…¥å†…å­˜çš„PAGECACHEåï¼Œç«‹åˆ»é€šçŸ¥åˆ·ç›˜çº¿ç¨‹åˆ·ç›˜ï¼Œ ç„¶åç­‰å¾…åˆ·ç›˜å®Œæˆï¼Œåˆ·ç›˜çº¿ç¨‹æ‰§è¡Œå®Œæˆåå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼Œè¿”å›æ¶ˆæ¯å†™æˆåŠŸçš„çŠ¶æ€ã€‚<br></code></pre></td></tr></table></figure><h3 id="2ï¼‰å¼‚æ­¥åˆ·ç›˜"><a href="#2ï¼‰å¼‚æ­¥åˆ·ç›˜" class="headerlink" title="2ï¼‰å¼‚æ­¥åˆ·ç›˜"></a>2ï¼‰å¼‚æ­¥åˆ·ç›˜</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">åœ¨è¿”å›å†™æˆåŠŸçŠ¶æ€æ—¶ï¼Œæ¶ˆæ¯å¯èƒ½åªæ˜¯è¢«å†™å…¥äº†å†…å­˜çš„PAGECACHEï¼Œå†™æ“ä½œçš„è¿”å›å¿«ï¼Œååé‡å¤§ï¼›å½“å†…å­˜é‡Œçš„æ¶ˆæ¯é‡ç§¯ç´¯åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œç»Ÿä¸€è§¦å‘å†™ç£ç›˜åŠ¨ä½œï¼Œå¿«é€Ÿå†™å…¥ã€‚<br></code></pre></td></tr></table></figure><h3 id="3ï¼‰æ€ä¹ˆé…ç½®åˆ·ç›˜æ–¹å¼ï¼Ÿ"><a href="#3ï¼‰æ€ä¹ˆé…ç½®åˆ·ç›˜æ–¹å¼ï¼Ÿ" class="headerlink" title="3ï¼‰æ€ä¹ˆé…ç½®åˆ·ç›˜æ–¹å¼ï¼Ÿ"></a>3ï¼‰æ€ä¹ˆé…ç½®åˆ·ç›˜æ–¹å¼ï¼Ÿ</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">åŒæ­¥åˆ·ç›˜è¿˜æ˜¯å¼‚æ­¥åˆ·ç›˜ï¼Œéƒ½æ˜¯é€šè¿‡Brokeré…ç½®æ–‡ä»¶é‡Œçš„flushDiskTypeå‚æ•°è®¾ç½®çš„ï¼Œè¿™ä¸ªå‚æ•°è¢«é…ç½®æˆSYNC_FLUSHï¼ˆåŒæ­¥åˆ·ç›˜ï¼‰ã€ASYNC_FLUSHï¼ˆå¼‚æ­¥åˆ·ç›˜ï¼‰ä¸­çš„ ä¸€ä¸ªã€‚<br></code></pre></td></tr></table></figure><h2 id="å››ã€RocketMQä¸»ä»å¤åˆ¶æœºåˆ¶"><a href="#å››ã€RocketMQä¸»ä»å¤åˆ¶æœºåˆ¶" class="headerlink" title="å››ã€RocketMQä¸»ä»å¤åˆ¶æœºåˆ¶"></a>å››ã€RocketMQä¸»ä»å¤åˆ¶æœºåˆ¶</h2><p>å¦‚æœä¸€ä¸ªBrokerç»„æœ‰Masterå’ŒSlaveï¼Œæ¶ˆæ¯éœ€è¦ä»Masterå¤åˆ¶åˆ°Slave ä¸Šï¼Œæœ‰åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§å¤åˆ¶æ–¹å¼ã€‚</p><h3 id="1ï¼‰åŒæ­¥å¤åˆ¶"><a href="#1ï¼‰åŒæ­¥å¤åˆ¶" class="headerlink" title="1ï¼‰åŒæ­¥å¤åˆ¶"></a>1ï¼‰åŒæ­¥å¤åˆ¶</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">åŒæ­¥å¤åˆ¶æ–¹å¼æ˜¯ç­‰Masterå’ŒSlaveå‡å†™æˆåŠŸåï¼Œæ‰åé¦ˆç»™å®¢æˆ·ç«¯å†™æˆåŠŸçŠ¶æ€ï¼›<br><br>åœ¨åŒæ­¥å¤åˆ¶æ–¹å¼ä¸‹ï¼Œå¦‚æœMasterå‡ºæ•…éšœï¼Œ Slaveä¸Šæœ‰å…¨éƒ¨çš„å¤‡ä»½æ•°æ®ï¼Œå®¹æ˜“æ¢å¤ï¼Œä½†æ˜¯åŒæ­¥å¤åˆ¶ä¼šå¢å¤§æ•°æ®å†™å…¥å»¶è¿Ÿï¼Œé™ä½ç³»ç»Ÿååé‡ã€‚<br></code></pre></td></tr></table></figure><h3 id="2ï¼‰å¼‚æ­¥å¤åˆ¶"><a href="#2ï¼‰å¼‚æ­¥å¤åˆ¶" class="headerlink" title="2ï¼‰å¼‚æ­¥å¤åˆ¶"></a>2ï¼‰å¼‚æ­¥å¤åˆ¶</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">å¼‚æ­¥å¤åˆ¶æ–¹å¼æ˜¯åªè¦Masterå†™æˆåŠŸï¼Œå³å¯åé¦ˆç»™å®¢æˆ·ç«¯å†™æˆåŠŸçŠ¶æ€ã€‚<br><br>åœ¨å¼‚æ­¥å¤åˆ¶æ–¹å¼ä¸‹ï¼Œç³»ç»Ÿæ‹¥æœ‰è¾ƒä½çš„å»¶è¿Ÿå’Œè¾ƒé«˜çš„ååé‡ï¼Œä½†æ˜¯å¦‚æœMasterå‡ºäº†æ•…éšœï¼Œæœ‰äº›æ•°æ®å› ä¸ºæ²¡æœ‰è¢«å†™å…¥Slaveï¼Œæœ‰å¯èƒ½ä¼šä¸¢å¤±ï¼›<br></code></pre></td></tr></table></figure><h3 id="3ï¼‰æ€ä¹ˆé…ç½®å¤åˆ¶æ–¹å¼ï¼Ÿ"><a href="#3ï¼‰æ€ä¹ˆé…ç½®å¤åˆ¶æ–¹å¼ï¼Ÿ" class="headerlink" title="3ï¼‰æ€ä¹ˆé…ç½®å¤åˆ¶æ–¹å¼ï¼Ÿ"></a>3ï¼‰æ€ä¹ˆé…ç½®å¤åˆ¶æ–¹å¼ï¼Ÿ</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">åŒæ­¥å¤åˆ¶å’Œå¼‚æ­¥å¤åˆ¶æ˜¯é€šè¿‡Brokeré…ç½®æ–‡ä»¶é‡Œçš„brokerRoleå‚æ•°è¿›è¡Œè®¾ç½®çš„ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥è¢«è®¾ç½®æˆASYNC_MASTERï¼ˆåŒæ­¥Masterï¼‰ã€ SYNC_MASTERï¼ˆå¼‚æ­¥Masterï¼‰ã€SLAVEï¼ˆä»èŠ‚ç‚¹ï¼‰ä¸‰ä¸ªå€¼ä¸­çš„ä¸€ä¸ªã€‚<br></code></pre></td></tr></table></figure><h3 id="4ï¼‰æ€»ç»“"><a href="#4ï¼‰æ€»ç»“" class="headerlink" title="4ï¼‰æ€»ç»“"></a>4ï¼‰æ€»ç»“</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å®é™…åº”ç”¨ä¸­è¦ç»“åˆä¸šåŠ¡åœºæ™¯ï¼Œåˆç†è®¾ç½®åˆ·ç›˜æ–¹å¼å’Œä¸»ä»å¤åˆ¶æ–¹å¼ï¼Œ å°¤å…¶æ˜¯SYNC_FLUSHæ–¹å¼ï¼Œç”±äºé¢‘ç¹åœ°è§¦å‘ç£ç›˜å†™åŠ¨ä½œï¼Œä¼šæ˜æ˜¾é™ä½æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåº”è¯¥æŠŠMasterå’ŒSaveé…ç½®æˆASYNC_FLUSHï¼ˆå¼‚æ­¥åˆ·ç›˜ï¼‰çš„åˆ·ç›˜æ–¹å¼ï¼Œä¸»ä»ä¹‹é—´é…ç½®æˆSYNC_MASTERï¼ˆåŒæ­¥å¤åˆ¶ï¼‰çš„å¤åˆ¶æ–¹å¼ï¼Œè¿™æ ·å³ä½¿æœ‰ä¸€å°æœºå™¨å‡ºæ•…éšœï¼Œä»ç„¶èƒ½ä¿è¯æ•°æ®ä¸ä¸¢ï¼Œæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>rocketmq</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rocketmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨dockerè¿è¡ŒRocketMQç®¡ç†åˆ©å™¨Dashboard</title>
    <link href="/2023/04/04/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8CRocketMQ%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8Dashboard/"/>
    <url>/2023/04/04/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8CRocketMQ%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8Dashboard/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨dockerè¿è¡ŒRocketMQç®¡ç†åˆ©å™¨Dashboard"><a href="#ä½¿ç”¨dockerè¿è¡ŒRocketMQç®¡ç†åˆ©å™¨Dashboard" class="headerlink" title="ä½¿ç”¨dockerè¿è¡ŒRocketMQç®¡ç†åˆ©å™¨Dashboard"></a>ä½¿ç”¨dockerè¿è¡ŒRocketMQç®¡ç†åˆ©å™¨Dashboard</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://rocketmq.apache.org/zh/docs/deploymentOperations/17Dashboard<br></code></pre></td></tr></table></figure><p><strong>å¤‡æ³¨ï¼šä»¥ä¸‹è®°å½•çš„æ˜¯dockerè¿è¡Œrocketmq-dashboardç®¡ç†åˆ©å™¨ï¼ŒäºŒè¿›åˆ¶åŒ…å¯æŸ¥é˜…ã€Šå‚è€ƒæ–‡æ¡£ã€‹</strong></p><p><strong>RocketMQ Dashboard æ˜¯ RocketMQ çš„ç®¡æ§åˆ©å™¨</strong></p><h2 id="1ã€dockeré•œåƒæ‹‰å–"><a href="#1ã€dockeré•œåƒæ‹‰å–" class="headerlink" title="1ã€dockeré•œåƒæ‹‰å–"></a>1ã€dockeré•œåƒæ‹‰å–</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull apacherocketmq/rocketmq-dashboard:latest<br></code></pre></td></tr></table></figure><h2 id="2ã€è¿è¡Œå®¹å™¨"><a href="#2ã€è¿è¡Œå®¹å™¨" class="headerlink" title="2ã€è¿è¡Œå®¹å™¨"></a>2ã€è¿è¡Œå®¹å™¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d --name rocketmq-dashboard \<br>-e <span class="hljs-string">&quot;JAVA_OPTS=-Drocketmq.namesrv.addr=127.0.0.1:9876&quot;</span> \<br>-p 8080:8080 \<br>-t apacherocketmq/rocketmq-dashboard:latest<br><br><br>å¤‡æ³¨ï¼šnamesrv.addr:port éœ€æ›¿æ¢ä¸º rocketmq ä¸­é…ç½®çš„ nameserver åœ°å€ï¼šç«¯å£å·<br>ä¾‹å¦‚ï¼š<br>docker run -d --name rocketmq-dashboard \<br>-e <span class="hljs-string">&quot;JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.62.128:9876;192.168.62.129:9876;192.168.62.130:9876&quot;</span> \<br>-p 8080:8080 \<br>-t apacherocketmq/rocketmq-dashboard:latest<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>rocketmq</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rocketmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨docker-composeå®‰è£…rocketmqé›†ç¾¤</title>
    <link href="/2023/04/04/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/%E4%BD%BF%E7%94%A8docker-compose%E5%AE%89%E8%A3%85rocketmq%E9%9B%86%E7%BE%A4/"/>
    <url>/2023/04/04/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/%E4%BD%BF%E7%94%A8docker-compose%E5%AE%89%E8%A3%85rocketmq%E9%9B%86%E7%BE%A4/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨docker-composeå®‰è£…rocketmqé›†ç¾¤"><a href="#ä½¿ç”¨docker-composeå®‰è£…rocketmqé›†ç¾¤" class="headerlink" title="ä½¿ç”¨docker-composeå®‰è£…rocketmqé›†ç¾¤"></a>ä½¿ç”¨docker-composeå®‰è£…rocketmqé›†ç¾¤</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">#å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/weixin_42410658/article/details/121668061<br>#é›†ç¾¤ç»“æ„ä¸º2Masterï¼šå‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/scmagic/article/details/124771179<br></code></pre></td></tr></table></figure><p>rocketMQé›†ç¾¤ç»„æˆï¼ˆåŒä¸»åŒä»å¼‚æ­¥åˆ·ç›˜ï¼‰:</p><table><thead><tr><th>å®¹å™¨åç§°</th><th>ä¸å®¿ä¸»æœºçš„ç«¯å£æ˜ å°„</th></tr></thead><tbody><tr><td>rmqnamesrv-a</td><td>9876:9876</td></tr><tr><td>rmqnamesrv-b</td><td>9876:9877</td></tr><tr><td>rmqbroker-a</td><td>10911:10911</td></tr><tr><td>rmqbroker-a-s</td><td>10911:10912</td></tr><tr><td>rmqbroker-b</td><td>10911:10913</td></tr><tr><td>rmqbroker-b-s</td><td>10911:10914</td></tr><tr><td>rmqconsole</td><td>8080:8080</td></tr></tbody></table><h2 id="1-åˆ›å»ºæ–‡ä»¶å¤¹"><a href="#1-åˆ›å»ºæ–‡ä»¶å¤¹" class="headerlink" title="1.åˆ›å»ºæ–‡ä»¶å¤¹"></a>1.åˆ›å»ºæ–‡ä»¶å¤¹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /app/rocketmq/conf/broker1<br><span class="hljs-built_in">mkdir</span> -p /app/rocketmq/conf/broker2<br><span class="hljs-built_in">mkdir</span> -p /app/rocketmq/conf/broker3<br><span class="hljs-built_in">mkdir</span> -p /app/rocketmq/conf/broker4<br></code></pre></td></tr></table></figure><h2 id="2-åˆ›å»ºbroker-conf"><a href="#2-åˆ›å»ºbroker-conf" class="headerlink" title="2.åˆ›å»ºbroker.conf"></a>2.åˆ›å»ºbroker.conf</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#éœ€è¦ä¸ºæ¯ä¸ªèŠ‚ç‚¹é…ç½®ä¸€ä¸ªbroker.confé…ç½®æ–‡ä»¶</span><br>vim /app/rocketmq/conf/broker1/broker.conf<br><br><span class="hljs-comment"># æ‰€å±é›†ç¾¤åç§°ï¼Œå¦‚æœèŠ‚ç‚¹è¾ƒå¤šå¯ä»¥é…ç½®å¤šä¸ª</span><br>brokerClusterName = rocketmq-cluster<br><span class="hljs-comment">#brokeråç§°ï¼Œmasterå’Œslaveä½¿ç”¨ç›¸åŒçš„åç§°ï¼Œè¡¨æ˜ä»–ä»¬çš„ä¸»ä»å…³ç³»</span><br>brokerName = broker-a<br><span class="hljs-comment"># 0è¡¨ç¤ºbroker master  é0è¡¨ç¤º broker slaver</span><br>brokerId = 0<br><br><span class="hljs-comment"># brokerIP1 å½“å‰brokerç›‘å¬çš„IPï¼Œä¸å†™å°†ä¼šä½¿ç”¨dockeré•œåƒip</span><br>brokerIP1 = rmqbroker-a<br><br><span class="hljs-comment"># brokerIP2 å­˜åœ¨brokerä¸»ä»æ—¶ï¼Œåœ¨brokerä¸»èŠ‚ç‚¹ä¸Šé…ç½®äº†brokerIP2çš„è¯,brokerä»èŠ‚ç‚¹ä¼šè¿æ¥ä¸»èŠ‚ç‚¹é…ç½®çš„brokerIP2æ¥åŒæ­¥</span><br><span class="hljs-comment"># brokerIP2 = 192.168.111.129</span><br><br><span class="hljs-comment">#è¡¨ç¤ºå‡ ç‚¹åšæ¶ˆæ¯åˆ é™¤åŠ¨ä½œï¼Œé»˜è®¤æ˜¯å‡Œæ™¨4ç‚¹</span><br>deleteWhen = 04<br><span class="hljs-comment">#åœ¨ç£ç›˜ä¸Šä¿ç•™æ¶ˆæ¯çš„æ—¶é•¿ï¼Œå•ä½æ˜¯å°æ—¶</span><br>fileReservedTime = 48<br><br>namesrvAddr = rmqnamesrv-a:9876;rmqnamesrv-b:9876<br><br><span class="hljs-comment"># æ˜¯å¦èƒ½å¤Ÿè‡ªåŠ¨åˆ›å»ºtopic</span><br>autoCreateTopicEnable = <span class="hljs-literal">true</span><br><br><span class="hljs-comment">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£, é»˜è®¤10911</span><br><span class="hljs-comment"># listenPort = 10911</span><br><br><span class="hljs-comment">#Brokerè§’è‰²</span><br><span class="hljs-comment">#- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master</span><br><span class="hljs-comment">#- SYNC_MASTER åŒæ­¥åŒå†™Master</span><br><span class="hljs-comment">#- SLAVE</span><br>brokerRole = ASYNC_MASTER<br><br><span class="hljs-comment">#åˆ·ç›˜ç­–ç•¥ï¼Œå–å€¼ä¸ºï¼šASYNC_FLUSHï¼ŒSYNC_FLUSHè¡¨ç¤ºåŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜ï¼›SYNC_FLUSHæ¶ˆæ¯å†™å…¥ç£ç›˜åæ‰è¿”å›æˆåŠŸçŠ¶æ€ï¼ŒASYNC_FLUSHä¸éœ€è¦ï¼›</span><br>flushDiskType = ASYNC_FLUSH<br><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /app/rocketmq/conf/broker2/broker.conf<br><span class="hljs-comment">#-=================è¾“å…¥ä»¥ä¸‹å†…å®¹-======================</span><br>brokerClusterName = rocketmq-cluster<br>brokerName = broker-a<br><br><span class="hljs-comment"># 0è¡¨ç¤ºbroker master  é0è¡¨ç¤º broker slaver</span><br>brokerId = 1<br><span class="hljs-comment"># brokerIP1 å½“å‰brokerç›‘å¬çš„IPï¼Œä¸å†™å°†ä¼šä½¿ç”¨dockeré•œåƒip</span><br>brokerIP1 = rmqbroker-a-s<br><br>deleteWhen = 04<br>fileReservedTime = 48<br><br>namesrvAddr = rmqnamesrv-a:9876;rmqnamesrv-b:9876<br><br><span class="hljs-comment"># autoCreateTopicEnable=true</span><br><br><span class="hljs-comment">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£,</span><br><span class="hljs-comment">#listenPort = 10912</span><br><br><span class="hljs-comment">#Brokerè§’è‰²</span><br><span class="hljs-comment">#- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master</span><br><span class="hljs-comment">#- SYNC_MASTER åŒæ­¥åŒå†™Master</span><br><span class="hljs-comment">#- SLAVE</span><br>brokerRole = SLAVE<br><br><span class="hljs-comment">#åˆ·ç›˜æ–¹å¼</span><br><span class="hljs-comment">#- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜</span><br><span class="hljs-comment">#- SYNC_FLUSH åŒæ­¥åˆ·ç›˜</span><br>flushDiskType = ASYNC_FLUSH<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim  /app/rocketmq/conf/broker3/broker.conf<br><br>brokerClusterName = rocketmq-cluster<br>brokerName = broker-b<br><br><span class="hljs-comment"># 0è¡¨ç¤ºbroker master  é0è¡¨ç¤º broker slaver</span><br>brokerId = 0<br><br><span class="hljs-comment"># brokerIP1 å½“å‰brokerç›‘å¬çš„IPï¼Œä¸å†™å°†ä¼šä½¿ç”¨dockeré•œåƒip</span><br>brokerIP1 = rmqbroker-b<br><br><span class="hljs-comment"># brokerIP2 å­˜åœ¨brokerä¸»ä»æ—¶ï¼Œåœ¨brokerä¸»èŠ‚ç‚¹ä¸Šé…ç½®äº†brokerIP2çš„è¯,brokerä»èŠ‚ç‚¹ä¼šè¿æ¥ä¸»èŠ‚ç‚¹é…ç½®çš„brokerIP2æ¥åŒæ­¥</span><br><span class="hljs-comment"># brokerIP2 = 192.168.111.129</span><br><br>deleteWhen = 04<br>fileReservedTime = 48<br><br><br>namesrvAddr = rmqnamesrv-a:9876;rmqnamesrv-b:9876<br><br><span class="hljs-comment"># æ˜¯å¦èƒ½å¤Ÿè‡ªåŠ¨åˆ›å»ºtopic</span><br>autoCreateTopicEnable = <span class="hljs-literal">true</span><br><br><span class="hljs-comment">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£, é»˜è®¤10911</span><br><span class="hljs-comment"># listenPort = 10913</span><br><br><span class="hljs-comment">#Brokerè§’è‰²</span><br><span class="hljs-comment">#- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master</span><br><span class="hljs-comment">#- SYNC_MASTER åŒæ­¥åŒå†™Master</span><br><span class="hljs-comment">#- SLAVE</span><br>brokerRole = ASYNC_MASTER<br><br><span class="hljs-comment">#åˆ·ç›˜æ–¹å¼</span><br><span class="hljs-comment">#- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜</span><br><span class="hljs-comment">#- SYNC_FLUSH åŒæ­¥åˆ·ç›˜</span><br>flushDiskType = ASYNC_FLUSH<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /app/rocketmq/conf/broker4/broker.conf<br><br>brokerClusterName = rocketmq-cluster<br>brokerName = broker-b<br><br><span class="hljs-comment"># 0è¡¨ç¤ºbroker master  é0è¡¨ç¤º broker slaver</span><br>brokerId = 1<br><span class="hljs-comment"># brokerIP1 å½“å‰brokerç›‘å¬çš„IPï¼Œä¸å†™å°†ä¼šä½¿ç”¨dockeré•œåƒip</span><br>brokerIP1 = rmqbroker-b-s<br><br>deleteWhen = 04<br>fileReservedTime = 48<br><br><br>namesrvAddr = rmqnamesrv-a:9876;rmqnamesrv-b:9876<br><br><span class="hljs-comment"># æ˜¯å¦èƒ½å¤Ÿè‡ªåŠ¨åˆ›å»ºtopic</span><br>autoCreateTopicEnable = <span class="hljs-literal">true</span><br><br><span class="hljs-comment">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£,</span><br><span class="hljs-comment"># listenPort = 10914</span><br><br><span class="hljs-comment">#Brokerè§’è‰²</span><br><span class="hljs-comment">#- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master</span><br><span class="hljs-comment">#- SYNC_MASTER åŒæ­¥åŒå†™Master</span><br><span class="hljs-comment">#- SLAVE</span><br>brokerRole = SLAVE<br><br><span class="hljs-comment">#åˆ·ç›˜æ–¹å¼</span><br><span class="hljs-comment">#- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜</span><br><span class="hljs-comment">#- SYNC_FLUSH åŒæ­¥åˆ·ç›˜</span><br>flushDiskType = ASYNC_FLUSH<br></code></pre></td></tr></table></figure><h2 id="3-ç¼–å†™rocketmqé›†ç¾¤yamlæ–‡ä»¶ï¼š"><a href="#3-ç¼–å†™rocketmqé›†ç¾¤yamlæ–‡ä»¶ï¼š" class="headerlink" title="3.ç¼–å†™rocketmqé›†ç¾¤yamlæ–‡ä»¶ï¼š"></a>3.ç¼–å†™rocketmqé›†ç¾¤yamlæ–‡ä»¶ï¼š</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> rocketmq.yml<br><br>version: <span class="hljs-string">&#x27;3.5&#x27;</span><br>services:<br>  rmqnamesrv-a:<br>    image: rocketmqinc/rocketmq:latest<br>    container_name: rmqnamesrv-a<br>    ports:<br>      - 9876:9876<br>    volumes:<br>      - /app/rocketmq/logs/broker1:/root/logs<br>      - /app/rocketmq/store/broker1:/root/store<br>    <span class="hljs-built_in">command</span>: sh mqnamesrv<br>    networks:<br>      rmq:<br>        aliases:<br>          - rmqnamesrv-a<br><br>  rmqnamesrv-b:<br>    image: rocketmqinc/rocketmq:latest<br>    container_name: rmqnamesrv-b<br>    ports:<br>      - 9877:9876<br>    volumes:<br>      - /app/rocketmq/logs/broker1:/root/logs<br>      - /app/rocketmq/store/broker1:/root/store<br>    <span class="hljs-built_in">command</span>: sh mqnamesrv<br>    networks:<br>      rmq:<br>        aliases:<br>          - rmqnamesrv-b<br><br>  rmqbroker-a:<br>    image: rocketmqinc/rocketmq:latest<br>    container_name: rmqbroker-a<br>    ports:<br>      - 10911:10911<br>    volumes:<br>      - /app/rocketmq/logs/broker1:/root/logs<br>      - /app/rocketmq/store/broker1:/root/store<br>      - /app/rocketmq/conf/broker1/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf<br>    environment:<br>      TZ: Asia/Shanghai<br>      NAMESRV_ADDR: <span class="hljs-string">&quot;rmqnamesrv-a:9876&quot;</span><br>      JAVA_OPTS: <span class="hljs-string">&quot; -Duser.home=/opt&quot;</span><br>      JAVA_OPT_EXT: <span class="hljs-string">&quot;-server -Xms128m -Xmx128m -Xmn128m&quot;</span><br>    <span class="hljs-built_in">command</span>: sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf autoCreateTopicEnable=<span class="hljs-literal">true</span> &amp;<br>    links:<br>      - rmqnamesrv-a:rmqnamesrv-a<br>      - rmqnamesrv-b:rmqnamesrv-b<br>    networks:<br>      rmq:<br>        aliases:<br>          - rmqbroker-a<br><br>  rmqbroker-a-s:<br>    image: rocketmqinc/rocketmq:latest<br>    container_name: rmqbroker-a-s<br>    ports:<br>      - 10912:10911<br>    volumes:<br>      - /app/rocketmq/logs/broker2:/root/logs<br>      - /app/rocketmq/store/broker2:/root/store<br>      - /app/rocketmq/conf/broker2/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf<br>    environment:<br>      TZ: Asia/Shanghai<br>      NAMESRV_ADDR: <span class="hljs-string">&quot;rmqnamesrv-a:9876&quot;</span><br>      JAVA_OPTS: <span class="hljs-string">&quot; -Duser.home=/opt&quot;</span><br>      JAVA_OPT_EXT: <span class="hljs-string">&quot;-server -Xms128m -Xmx128m -Xmn128m&quot;</span><br>    <span class="hljs-built_in">command</span>: sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf autoCreateTopicEnable=<span class="hljs-literal">true</span> &amp;<br>    links:<br>      - rmqnamesrv-a:rmqnamesrv-a<br>      - rmqnamesrv-b:rmqnamesrv-b<br>    networks:<br>      rmq:<br>        aliases:<br>          - rmqbroker-a-s<br><br>  rmqbroker-b:<br>    image: rocketmqinc/rocketmq:latest<br>    container_name: rmqbroker-b<br>    ports:<br>      - 10913:10911<br>    volumes:<br>      - /app/rocketmq/logs/broker3:/root/logs<br>      - /app/rocketmq/store/broker3:/root/store<br>      - /app/rocketmq/conf/broker3/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf<br>    environment:<br>      TZ: Asia/Shanghai<br>      NAMESRV_ADDR: <span class="hljs-string">&quot;rmqnamesrv-a:9876&quot;</span><br>      JAVA_OPTS: <span class="hljs-string">&quot; -Duser.home=/opt&quot;</span><br>      JAVA_OPT_EXT: <span class="hljs-string">&quot;-server -Xms128m -Xmx128m -Xmn128m&quot;</span><br>    <span class="hljs-built_in">command</span>: sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf autoCreateTopicEnable=<span class="hljs-literal">true</span> &amp;<br>    links:<br>      - rmqnamesrv-a:rmqnamesrv-a<br>      - rmqnamesrv-b:rmqnamesrv-b<br>    networks:<br>      rmq:<br>        aliases:<br>          - rmqbroker-b<br><br>  rmqbroker-b-s:<br>    image: rocketmqinc/rocketmq:latest<br>    container_name: rmqbroker-b-s<br>    ports:<br>      - 10914:10911<br>    volumes:<br>      - /app/rocketmq/logs/broker4:/root/logs<br>      - /app/rocketmq/store/broker4:/root/store<br>      - /app/rocketmq/conf/broker4/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf<br>    environment:<br>      TZ: Asia/Shanghai<br>      NAMESRV_ADDR: <span class="hljs-string">&quot;rmqnamesrv-a:9876&quot;</span><br>      JAVA_OPTS: <span class="hljs-string">&quot; -Duser.home=/opt&quot;</span><br>      JAVA_OPT_EXT: <span class="hljs-string">&quot;-server -Xms128m -Xmx128m -Xmn128m&quot;</span><br>    <span class="hljs-built_in">command</span>: sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf autoCreateTopicEnable=<span class="hljs-literal">true</span> &amp;<br>    links:<br>      - rmqnamesrv-a:rmqnamesrv-a<br>      - rmqnamesrv-b:rmqnamesrv-b<br>    networks:<br>      rmq:<br>        aliases:<br>          - rmqbroker-b-s<br><br>  rmqconsole:<br>    image: styletang/rocketmq-console-ng:latest<br>    container_name: rmqconsole<br>    ports:<br>      - 8080:8080<br>    environment:<br>      JAVA_OPTS: -Drocketmq.namesrv.addr=rmqnamesrv-a:9876;rmqnamesrv-b:9877 -Dcom.rocketmq.sendMessageWithVIPChannel=<span class="hljs-literal">false</span><br>    networks:<br>      rmq:<br>        aliases:<br>          - rmqconsole<br><br><span class="hljs-comment"># è‡ªå®šä¹‰ç½‘ç»œ</span><br>networks:<br>  rmq:<br>    name: rmq<br>    driver: bridge<br></code></pre></td></tr></table></figure><h2 id="4-å¯åŠ¨é›†ç¾¤"><a href="#4-å¯åŠ¨é›†ç¾¤" class="headerlink" title="4.å¯åŠ¨é›†ç¾¤"></a>4.å¯åŠ¨é›†ç¾¤</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker-compose -f rocketmq.yml  up -d<br></code></pre></td></tr></table></figure><p>è®¿é—®æ§åˆ¶å°ï¼šhttp&#x2F;&#x2F;ip:8080</p><h2 id="5-æ“ä½œï¼š"><a href="#5-æ“ä½œï¼š" class="headerlink" title="5.æ“ä½œï¼š"></a>5.æ“ä½œï¼š</h2><p>ç‚¹å‡»å³ä¸Šè§’ï¼Œå¯ä»¥é€‰æ‹©ä¸­æ–‡ -&gt; åˆ‡æ¢ä¸­æ–‡åç‚¹å‡»é¡µé¢ä¸Šçš„é›†ç¾¤ -&gt; æŸ¥çœ‹æ˜¯å¦æœ‰æ˜¾ç¤º4è¡Œæ•°æ®</p>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>rocketmq</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rocketmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨dockerå®‰è£…rocketmq</title>
    <link href="/2023/04/04/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/%E4%BD%BF%E7%94%A8docker%E5%AE%89%E8%A3%85rocketmq/"/>
    <url>/2023/04/04/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/%E4%BD%BF%E7%94%A8docker%E5%AE%89%E8%A3%85rocketmq/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨dockerå®‰è£…rocketmq"><a href="#ä½¿ç”¨dockerå®‰è£…rocketmq" class="headerlink" title="ä½¿ç”¨dockerå®‰è£…rocketmq"></a>ä½¿ç”¨dockerå®‰è£…rocketmq</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">#å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/ming19951224/article/details/109063041<br></code></pre></td></tr></table></figure><h2 id="1-åˆ›å»ºnamesrvæœåŠ¡"><a href="#1-åˆ›å»ºnamesrvæœåŠ¡" class="headerlink" title="1.åˆ›å»ºnamesrvæœåŠ¡"></a>1.åˆ›å»ºnamesrvæœåŠ¡</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ‹‰å–é•œåƒï¼š</span><br>docker pull rocketmqinc/rocketmq<br><br><span class="hljs-comment">#åˆ›å»ºnamesrvæ•°æ®å­˜å‚¨è·¯å¾„</span><br><span class="hljs-built_in">mkdir</span> -p /app/rocketmq/data/namesrv/&#123;logs,store&#125;<br><br><span class="hljs-comment">## æ„å»ºnamesrvå®¹å™¨</span><br><br>docker run -d \<br>--restart=always \<br>--name rmqnamesrv \<br>-p 9876:9876 \<br>-v /app/rocketmq/data/namesrv/logs:/root/logs \<br>-v /app/rocketmq/data/namesrv/store:/root/store \<br>-e <span class="hljs-string">&quot;MAX_POSSIBLE_HEAP=100000000&quot;</span> \<br>rocketmqinc/rocketmq \<br>sh mqnamesrv <br><br>å‚æ•°è¯´æ˜ï¼š<br>-e <span class="hljs-string">&quot;MAX_POSSIBLE_HEAP=100000000&quot;</span> <span class="hljs-comment">#è®¾ç½®å®¹å™¨çš„æœ€å¤§å †å†…å­˜ä¸º100000000</span><br>sh mqnamesrv<span class="hljs-comment">#å¯åŠ¨namesrvæœåŠ¡</span><br></code></pre></td></tr></table></figure><h2 id="2-åˆ›å»ºbrokerèŠ‚ç‚¹"><a href="#2-åˆ›å»ºbrokerèŠ‚ç‚¹" class="headerlink" title="2.åˆ›å»ºbrokerèŠ‚ç‚¹"></a>2.åˆ›å»ºbrokerèŠ‚ç‚¹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ›å»ºbrokeræ•°æ®å­˜å‚¨è·¯å¾„</span><br><span class="hljs-built_in">mkdir</span> -p /app/rocketmq/data/broker/&#123;logs,store&#125; /app/rocketmq/conf<br><br><span class="hljs-comment">#åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š</span><br>vim /app/rocketmq/conf/broker.conf<br><span class="hljs-comment">#//æ‰€å±é›†ç¾¤åç§°ï¼Œå¦‚æœèŠ‚ç‚¹è¾ƒå¤šå¯ä»¥é…ç½®å¤šä¸ª</span><br>brokerClusterName = DefaultCluster<br><span class="hljs-comment">#//brokeråç§°ï¼Œmasterå’Œslaveä½¿ç”¨ç›¸åŒçš„åç§°ï¼Œè¡¨æ˜ä»–ä»¬çš„ä¸»ä»å…³ç³»</span><br>brokerName = broker-a<br><span class="hljs-comment">#//0è¡¨ç¤ºMasterï¼Œå¤§äº0è¡¨ç¤ºä¸åŒçš„slave</span><br>brokerId = 0<br><span class="hljs-comment">#//è¡¨ç¤ºå‡ ç‚¹åšæ¶ˆæ¯åˆ é™¤åŠ¨ä½œï¼Œé»˜è®¤æ˜¯å‡Œæ™¨4ç‚¹</span><br>deleteWhen = 04<br><span class="hljs-comment">#//åœ¨ç£ç›˜ä¸Šä¿ç•™æ¶ˆæ¯çš„æ—¶é•¿ï¼Œå•ä½æ˜¯å°æ—¶</span><br>fileReservedTime = 48<br><span class="hljs-comment">#//æœ‰ä¸‰ä¸ªå€¼ï¼šSYNC_MASTERï¼ŒASYNC_MASTERï¼ŒSLAVEï¼›åŒæ­¥å’Œå¼‚æ­¥è¡¨ç¤ºMasterå’ŒSlaveä¹‹é—´åŒæ­¥æ•°æ®çš„æœºåˆ¶ï¼›</span><br>brokerRole = ASYNC_MASTER<br><span class="hljs-comment">#//åˆ·ç›˜ç­–ç•¥ï¼Œå–å€¼ä¸ºï¼šASYNC_FLUSHï¼ŒSYNC_FLUSHè¡¨ç¤ºåŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜ï¼›SYNC_FLUSHæ¶ˆæ¯å†™å…¥ç£ç›˜åæ‰è¿”å›æˆåŠŸçŠ¶æ€ï¼ŒASYNC_FLUSHä¸éœ€è¦ï¼›</span><br>flushDiskType = ASYNC_FLUSH<br><span class="hljs-comment">#//è®¾ç½®brokerèŠ‚ç‚¹æ‰€åœ¨æœåŠ¡å™¨çš„ipåœ°å€</span><br>brokerIP1 = 192.168.5.112<br><span class="hljs-comment">#//ç£ç›˜ä½¿ç”¨è¾¾åˆ°95%ä¹‹å,ç”Ÿäº§è€…å†å†™å…¥æ¶ˆæ¯ä¼šæŠ¥é”™ CODE: 14 DESC: service not available now, maybe disk full</span><br>diskMaxUsedSpaceRatio=95<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ„å»ºbrokerå®¹å™¨</span><br>docker run -d  \<br>--restart=always \<br>--name rmqbroker \<br>--<span class="hljs-built_in">link</span> rmqnamesrv:namesrv \<br>-p 10911:10911 \<br>-p 10909:10909 \<br>-v  /app/rocketmq/data/broker/logs:/root/logs \<br>-v  /app/rocketmq/data/broker/store:/root/store \<br>-v /app/rocketmq/conf/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf \<br>-e <span class="hljs-string">&quot;NAMESRV_ADDR=namesrv:9876&quot;</span> \<br>-e <span class="hljs-string">&quot;MAX_POSSIBLE_HEAP=200000000&quot;</span> \<br>rocketmqinc/rocketmq \<br>sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf <br><br>å‚æ•°è¯´æ˜ï¼š<br>- --<span class="hljs-built_in">link</span> rmqnamesrv:namesrvå’Œrmqnamesrvå®¹å™¨é€šä¿¡<br>-p 10911:10911æŠŠå®¹å™¨çš„évipé€šé“ç«¯å£æŒ‚è½½åˆ°å®¿ä¸»æœº<br>-p 10909:10909æŠŠå®¹å™¨çš„vipé€šé“ç«¯å£æŒ‚è½½åˆ°å®¿ä¸»æœº<br>-e â€œNAMESRV_ADDR=namesrv:9876â€æŒ‡å®šnamesrvçš„åœ°å€ä¸ºæœ¬æœºnamesrvçš„ipåœ°å€:9876<br>-e â€œMAX_POSSIBLE_HEAP=200000000â€ rocketmqinc/rocketmq sh mqbrokeræŒ‡å®šbrokeræœåŠ¡çš„æœ€å¤§å †å†…å­˜<br>sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.confæŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨<br></code></pre></td></tr></table></figure><h2 id="3-åˆ›å»ºrockermq-consoleæœåŠ¡"><a href="#3-åˆ›å»ºrockermq-consoleæœåŠ¡" class="headerlink" title="3.åˆ›å»ºrockermq-consoleæœåŠ¡"></a>3.åˆ›å»ºrockermq-consoleæœåŠ¡</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ‹‰å–é•œåƒ</span><br>docker pull pangliang/rocketmq-console-ng<br><br><span class="hljs-comment">#æ„å»ºrockermq-consoleå®¹å™¨</span><br><span class="hljs-comment">#éœ€è¦æŠŠ192.168.5.112æ¢æˆéƒ¨ç½²namesrvæœºå™¨åœ°å€</span><br>docker run -d \<br>--restart=always \<br>--name rmqadmin \<br>-e <span class="hljs-string">&quot;JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.5.112:9876 \</span><br><span class="hljs-string">-Dcom.rocketmq.sendMessageWithVIPChannel=false&quot;</span> \<br>-p 9999:8080 \<br>pangliang/rocketmq-console-ng<br><br>å‚æ•°è¯´æ˜ï¼š<br>-e <span class="hljs-string">&quot;JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.52.136:9876è®¾ç½®namesrvæœåŠ¡çš„ipåœ°å€</span><br><span class="hljs-string">-Dcom.rocketmq.sendMessageWithVIPChannel=false&quot;</span>ä¸ä½¿ç”¨vipé€šé“å‘é€æ¶ˆæ¯<br>â€“p 9999:8080æŠŠå®¹å™¨å†…çš„ç«¯å£8080æŒ‚è½½åˆ°å®¿ä¸»æœºä¸Šçš„9999ç«¯å£<br></code></pre></td></tr></table></figure><h2 id="4-è®¿é—®æ§åˆ¶å°"><a href="#4-è®¿é—®æ§åˆ¶å°" class="headerlink" title="4.è®¿é—®æ§åˆ¶å°"></a>4.è®¿é—®æ§åˆ¶å°</h2><p>ç½‘é¡µè®¿é—®<a href="http://192.168.5.112:9999/%E6%9F%A5%E7%9C%8B%E6%8E%A7%E5%88%B6%E5%8F%B0%E4%BF%A1%E6%81%AF">http://192.168.5.112:9999/æŸ¥çœ‹æ§åˆ¶å°ä¿¡æ¯</a></p>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>rocketmq</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rocketmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äºŒè¿›åˆ¶æ­å»ºrocketmqå•MASTER</title>
    <link href="/2023/04/04/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%90%AD%E5%BB%BArocketmq%E5%8D%95%E8%8A%82%E7%82%B9/"/>
    <url>/2023/04/04/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%90%AD%E5%BB%BArocketmq%E5%8D%95%E8%8A%82%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="äºŒè¿›åˆ¶æ­å»ºrocketmqå•MASTER"><a href="#äºŒè¿›åˆ¶æ­å»ºrocketmqå•MASTER" class="headerlink" title="äºŒè¿›åˆ¶æ­å»ºrocketmqå•MASTER"></a>äºŒè¿›åˆ¶æ­å»ºrocketmqå•MASTER</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">å‚è€ƒæ–‡æ¡£ï¼šhttps:<span class="hljs-regexp">//</span>rocketmq.apache.org<span class="hljs-regexp">/zh/</span>docs<span class="hljs-regexp">/quickStart/</span><span class="hljs-number">02</span>quickstart<br></code></pre></td></tr></table></figure><p>RocketMQä¸­ä¸»è¦æ¶‰åŠåˆ°å››ç§è§’è‰²ï¼šNameServeræ³¨å†ŒæœåŠ¡å™¨ã€BrokeræœåŠ¡å™¨ã€Producerç”Ÿäº§è€…ã€Consumeræ¶ˆè´¹è€…ã€‚æ¯ç§è§’è‰²éƒ½å¯ä»¥å•ç‹¬æ­å»ºé›†ç¾¤</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs txt">(ä¸€)ã€NameServer<br>NameServer æ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œå¯é›†ç¾¤éƒ¨ç½²ï¼ŒèŠ‚ç‚¹éƒ½æ˜¯å„è‡ªç‹¬ç«‹çš„ï¼Œæ— ä»»ä½•ä¿¡æ¯åŒæ­¥ã€‚<br><br>(äºŒ)ã€ Broker é›†ç¾¤<br>â‘  Broker åˆ†ä¸º Master ä¸ Slaveï¼Œä¸€ä¸ª Master å¯ä»¥å¯¹åº”å¤šä¸ª Slaveï¼Œä½†ä¸€ä¸ª Slave åªèƒ½å¯¹åº”ä¸€ä¸ªMasterï¼›<br>â‘¡ Master ä¸ Slave çš„å¯¹åº”å…³ç³»é€šè¿‡æŒ‡å®šç›¸åŒçš„ BrokerNameï¼Œä¸åŒçš„ BrokerID æ¥å®šä¹‰ï¼Œid ä¸º 0 è¡¨ç¤º Masterï¼Œ é 0 è¡¨ç¤º Slaveï¼›<br>â‘¢ å¯ä»¥éƒ¨ç½²å¤šä¸ª Master å®ç° Broker é›†ç¾¤ï¼Œå³å¤šç»„ Master - Slave çš„ Broker èŠ‚ç‚¹ï¼›<br>â‘£ Master é€šå¸¸ç”¨äºå†™å…¥æ•°æ®ï¼ŒSlave ç”¨äºè¯»å–æ•°æ®ï¼›<br>â‘¤ æ¯ä¸ª Broker ä¸ NameServer é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæ—¶æ³¨å†Œ Topic ä¿¡æ¯åˆ°æ‰€æœ‰ NameServerï¼›<br><br>(ä¸‰)ã€Producer é›†ç¾¤<br>â‘  Producer ä¸ºæ¶ˆæ¯çš„ç”Ÿäº§è€…ï¼Œéƒ½æ˜¯å„è‡ªç‹¬ç«‹çš„æ— çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œå¯ä»¥è®¤ä¸ºåªè¦å‘ mq ä¸­æ¨é€æ¶ˆæ¯çš„èŠ‚ç‚¹éƒ½ç®—ä½œ Producer èŠ‚ç‚¹ã€‚<br>â‘¡ Producer èŠ‚ç‚¹ä¸ NameServer é›†ç¾¤ä¸­çš„éšæœºä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸä» NameServer å–å‡º Topic è·¯ç”±ä¿¡æ¯ï¼Œå¹¶å‘æä¾› Topic æœåŠ¡çš„ Master å»ºç«‹é•¿è¿æ¥ï¼Œä¸”å®šæ—¶å‘ Master å‘é€å¿ƒè·³ã€‚<br><br>(å››)ã€Customer é›†ç¾¤<br>â‘  Customer ä¸ºæ¶ˆæ¯çš„æ¶ˆè´¹è€…ï¼Œéƒ½æ˜¯å„è‡ªç‹¬ç«‹çš„æ— çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œå¯ä»¥è®¤ä¸ºåªè¦å‘ mq ä¸­è·å–æ¶ˆæ¯çš„èŠ‚ç‚¹éƒ½ç®—ä½œ Customer èŠ‚ç‚¹ï¼›<br>â‘¡ Customer èŠ‚ç‚¹ä¸ NameServer é›†ç¾¤ä¸­çš„éšæœºä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸä» NameServer å–å‡º Topic è·¯ç”±ä¿¡æ¯ï¼Œå¹¶å‘æä¾› Topic æœåŠ¡çš„ Masterã€Slave å»ºç«‹é•¿è¿æ¥ï¼Œä¸”å®šæ—¶å‘ Masterã€Slave å‘é€å¿ƒè·³ï¼›<br>â‘¢ Customer èŠ‚ç‚¹æ—¢å¯ä»¥ä» Master è®¢é˜…æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä» Slave è®¢é˜…æ¶ˆæ¯ï¼Œè®¢é˜…è§„åˆ™ç”± Broker é…ç½®å†³å®šï¼›<br></code></pre></td></tr></table></figure><h2 id="1ã€å®‰è£…JDK-1-8-ï¼ˆå·²ç•¥è¿‡ï¼‰"><a href="#1ã€å®‰è£…JDK-1-8-ï¼ˆå·²ç•¥è¿‡ï¼‰" class="headerlink" title="1ã€å®‰è£…JDK 1.8+ï¼ˆå·²ç•¥è¿‡ï¼‰"></a>1ã€å®‰è£…JDK 1.8+ï¼ˆå·²ç•¥è¿‡ï¼‰</h2><h2 id="2ã€ä¸‹è½½å®‰è£…Apache-RocketMQ"><a href="#2ã€ä¸‹è½½å®‰è£…Apache-RocketMQ" class="headerlink" title="2ã€ä¸‹è½½å®‰è£…Apache RocketMQ"></a>2ã€ä¸‹è½½å®‰è£…Apache RocketMQ</h2><p>äºŒè¿›åˆ¶åŒ…ä¸‹è½½åœ°å€ï¼š<code>https://dlcdn.apache.org/rocketmq</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://dlcdn.apache.org/rocketmq/5.0.0/rocketmq-all-5.0.0-bin-release.zip --no-check-certificate<br><br></code></pre></td></tr></table></figure><h2 id="3ã€è§£å‹å‹ç¼©æ–‡ä»¶"><a href="#3ã€è§£å‹å‹ç¼©æ–‡ä»¶" class="headerlink" title="3ã€è§£å‹å‹ç¼©æ–‡ä»¶"></a>3ã€è§£å‹å‹ç¼©æ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">unzip rocketmq-all-5.0.0-bin-release.zip<br><span class="hljs-built_in">cd</span> rocketmq-all-5.0.0-bin-release/<br></code></pre></td></tr></table></figure><h2 id="4ã€å¯åŠ¨NameServer"><a href="#4ã€å¯åŠ¨NameServer" class="headerlink" title="4ã€å¯åŠ¨NameServer"></a>4ã€å¯åŠ¨NameServer</h2><p>æ³¨æ„ï¼šrocketå®‰è£…åŒ…binç›®å½•ä¸‹çš„runserver.shå’Œrunbroker.shä¸­é…ç½®çš„æœ€å°å†…å­˜å ç”¨ä¸º4Gï¼Œé…ç½®è¿‡ä½å°†å¯åŠ¨ä¸äº†ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim bin/runserver.sh<br>JAVA_OPT=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;JAVA_OPT&#125;</span> -server -Xms128m -Xmx128m -Xmn128m -XX:MetaspaceSize=32m -XX:MaxMetaspaceSize=64m&quot;</span><br><span class="hljs-comment">#ä¿å­˜å¹¶é€€å‡º(æ­¤å‚æ•°é…ç½®æ ¹æ®å®é™…æœåŠ¡å™¨ç¡¬ä»¶æ¡ä»¶è°ƒå¤§æˆ–è°ƒå°)</span><br><br>vim bin/runbroker.sh<br>JAVA_OPT=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;JAVA_OPT&#125;</span> -server -Xms128m -Xmx128m -Xmn128m&quot;</span><br><span class="hljs-comment">#ä¿å­˜å¹¶é€€å‡º(æ­¤å‚æ•°é…ç½®æ ¹æ®å®é™…æœåŠ¡å™¨ç¡¬ä»¶æ¡ä»¶è°ƒå¤§æˆ–è°ƒå°)</span><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># å¯åŠ¨namesrv</span><br><span class="hljs-built_in">nohup</span> sh bin/mqnamesrv &amp;<br> <br><span class="hljs-comment"># éªŒè¯namesrvæ˜¯å¦å¯åŠ¨æˆåŠŸ</span><br><span class="hljs-built_in">tail</span> -f ~/logs/rocketmqlogs/namesrv.log<br><br>The Name Server boot success...<br></code></pre></td></tr></table></figure><h2 id="5ã€å¯åŠ¨Broker-Proxy"><a href="#5ã€å¯åŠ¨Broker-Proxy" class="headerlink" title="5ã€å¯åŠ¨Broker+Proxy"></a>5ã€å¯åŠ¨Broker+Proxy</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">nohup</span> sh bin/mqbroker -n localhost:9876 --enable-proxy &amp;<br><br><span class="hljs-comment"># éªŒè¯Name Server æ˜¯å¦å¯åŠ¨æˆåŠŸï¼Œä¾‹å¦‚Brokerçš„IPä¸ºï¼š192.168.1.2ï¼Œä¸”åç§°ä¸ºbroker-a</span><br><span class="hljs-built_in">tail</span> -f ~/logs/rocketmqlogs/broker_default.log <br>The broker[xxx, 192.169.1.2:10911] boot success...<br></code></pre></td></tr></table></figure><h2 id="6ã€å·¥å…·æµ‹è¯•æ¶ˆæ¯æ”¶å‘"><a href="#6ã€å·¥å…·æµ‹è¯•æ¶ˆæ¯æ”¶å‘" class="headerlink" title="6ã€å·¥å…·æµ‹è¯•æ¶ˆæ¯æ”¶å‘"></a>6ã€å·¥å…·æµ‹è¯•æ¶ˆæ¯æ”¶å‘</h2><p>åœ¨è¿›è¡Œå·¥å…·æµ‹è¯•æ¶ˆæ¯æ”¶å‘ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰å®¢æˆ·ç«¯NameServerçš„åœ°å€ï¼ŒRocketMQæœ‰å¤šç§æ–¹å¼åœ¨å®¢æˆ·ç«¯ä¸­è®¾ç½®NameServeråœ°å€ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ©ç”¨ç¯å¢ƒå˜é‡NAMESRV_ADDR</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> NAMESRV_ADDR=localhost:9876<br>sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer<br>&gt; SendResult [sendStatus=SEND_OK, msgId= ...<br><br>sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer<br>&gt; ConsumeMessageThread_%d Receive New Messages: [MessageExt...<br></code></pre></td></tr></table></figure><h2 id="7ã€å…³é—­æœåŠ¡å™¨"><a href="#7ã€å…³é—­æœåŠ¡å™¨" class="headerlink" title="7ã€å…³é—­æœåŠ¡å™¨"></a>7ã€å…³é—­æœåŠ¡å™¨</h2><p>å®Œæˆå®éªŒåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å…³é—­æœåŠ¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">sh bin/mqshutdown broker<br>&gt;The mqbroker(36695) is running...<br>&gt;Send shutdown request to mqbroker with proxy <span class="hljs-built_in">enable</span> OK(36695)<br><br><br>sh bin/mqshutdown namesrv<br>&gt;The mqnamesrv(36664) is running...<br>Send shutdown request to mqnamesrv(36664) OK<br></code></pre></td></tr></table></figure><h2 id="8ã€brocker-confæ–‡ä»¶è¯¦è§£"><a href="#8ã€brocker-confæ–‡ä»¶è¯¦è§£" class="headerlink" title="8ã€brocker.confæ–‡ä»¶è¯¦è§£"></a>8ã€brocker.confæ–‡ä»¶è¯¦è§£</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ‰€å±é›†ç¾¤åå­—</span><br>brokerClusterName=rocketmq_cluster<br><span class="hljs-comment">#é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šæœºå™¨çš„é›†ç¾¤å’Œbrokerå½’å±ï¼Œæ¯”å¦‚brokerNameä¸€æ ·çš„å±äºåŒä¸€ä¸ªbroker,ä¸€ä¸ªbrokeråªèƒ½æœ‰ä¸€ä¸ªmasterï¼Œå¯ä»¥æœ‰å¤šä¸ªslaveï¼ŒbrokerIdä¸º0çš„ä¸ºmasterï¼Œå…¶ä»–çš„ä¸ºslaveã€‚</span><br>brokerName=broker-a<br><span class="hljs-comment">#0è¡¨ç¤ºMasterï¼Œ&gt;0è¡¨ç¤ºSlave</span><br>brokerId=0<br><span class="hljs-comment">#åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹</span><br>deleteWhen=04<br><span class="hljs-comment">#æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶</span><br>fileReservedTime=48<br><span class="hljs-comment">#Broker çš„è§’è‰²</span><br>brokerRole=SYNC_MASTER<br><span class="hljs-comment">#å¼‚æ­¥åˆ·æ–°ASYNC_FLUSH /åŒæ­¥åˆ·æ–°SYNC_FLUSH</span><br>flushDiskType=SYNC_FLUSH<br><br><span class="hljs-comment">#nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²</span><br>namesrvAddr=192.168.5.57:9876;192.168.5.58:9876<br><span class="hljs-comment">#åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°</span><br>defaultTopicQueueNums=4<br><span class="hljs-comment">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­</span><br>autoCreateTopicEnable=<span class="hljs-literal">true</span><br><span class="hljs-comment">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­</span><br>autoCreateSubscriptionGroup=<span class="hljs-literal">true</span><br><span class="hljs-comment">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£</span><br>listenPort=10911<br><span class="hljs-comment">#commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G</span><br>mapedFileSizeCommitLog=1073741824<br><span class="hljs-comment">#ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´</span><br>mapedFileSizeConsumeQueue=300000<br><span class="hljs-comment">#æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´</span><br>diskMaxUsedSpaceRatio=88<br><span class="hljs-comment">#å­˜å‚¨è·¯å¾„</span><br>storePathRootDir=/data/rocketmq-m<br><span class="hljs-comment">#commitLog å­˜å‚¨è·¯å¾„</span><br>storePathCommitLog=/data/rocketmq-m/commitlog<br><span class="hljs-comment">#æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„</span><br>storePathConsumeQueue=/data/rocketmq-m/consumequeue<br><span class="hljs-comment">#æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„</span><br>storePathIndex=/data/rocketmq-m/index<br><span class="hljs-comment">#checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br>storeCheckpoint=/data/rocketmq-m/checkpoint<br><span class="hljs-comment">#abort æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br>abortFile=/data/rocketmq-m/abort<br><span class="hljs-comment">#é™åˆ¶çš„æ¶ˆæ¯å¤§å°</span><br>maxMessageSize=65536<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>rocketmq</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rocketmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨redis-shakeè¿›è¡Œæ•°æ®è¿ç§»ä»¥åŠåŒæ­¥</title>
    <link href="/2023/04/03/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/%E4%BD%BF%E7%94%A8redis-shake%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E4%BB%A5%E5%8F%8A%E5%90%8C%E6%AD%A5/"/>
    <url>/2023/04/03/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/%E4%BD%BF%E7%94%A8redis-shake%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E4%BB%A5%E5%8F%8A%E5%90%8C%E6%AD%A5/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨redis-shakeè¿›è¡Œæ•°æ®è¿ç§»ä»¥åŠåŒæ­¥"><a href="#ä½¿ç”¨redis-shakeè¿›è¡Œæ•°æ®è¿ç§»ä»¥åŠåŒæ­¥" class="headerlink" title="ä½¿ç”¨redis-shakeè¿›è¡Œæ•°æ®è¿ç§»ä»¥åŠåŒæ­¥"></a>ä½¿ç”¨redis-shakeè¿›è¡Œæ•°æ®è¿ç§»ä»¥åŠåŒæ­¥</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttp://www.ioo.cool/posts/ce1f9162def9/#cluster%E5%88%B0cluster%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB<br>å‚è€ƒæ–‡æ¡£ï¼šhttps://github.com/alibaba/RedisShake/wiki/%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B%EF%BC%9A%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB<br></code></pre></td></tr></table></figure><p><strong>å¤‡æ³¨ï¼šRedisShakeæ˜¯ä¸€æ¬¾å¼€æºçš„Redisè¿ç§»å·¥å…·ï¼Œæ”¯æŒClusteré›†ç¾¤çš„åœ¨çº¿è¿ç§»ä¸ç¦»çº¿è¿ç§»ï¼ˆå¤‡ä»½æ–‡ä»¶å¯¼å…¥ï¼‰ã€‚DCS Clusteré›†ç¾¤ä¸Redis Clusteré›†ç¾¤è®¾è®¡ä¸€è‡´ï¼Œæ•°æ®å¯å¹³æ»‘è¿ç§»ã€‚</strong><br>å®˜æ–¹GitHubåœ°å€ï¼š<a href="https://github.com/alibaba/RedisShake">https://github.com/alibaba/RedisShake</a></p><h2 id="1-å®‰è£…redis-shake"><a href="#1-å®‰è£…redis-shake" class="headerlink" title="1.å®‰è£…redis-shake"></a>1.å®‰è£…redis-shake</h2><h3 id="é‡‡ç”¨çš„æ˜¯v2ç‰ˆæœ¬ï¼Œv3ç‰ˆæœ¬ä½¿ç”¨æ—¶æœ‰ç¯å¢ƒå˜é‡å¯¼è‡´çš„é—®é¢˜"><a href="#é‡‡ç”¨çš„æ˜¯v2ç‰ˆæœ¬ï¼Œv3ç‰ˆæœ¬ä½¿ç”¨æ—¶æœ‰ç¯å¢ƒå˜é‡å¯¼è‡´çš„é—®é¢˜" class="headerlink" title="é‡‡ç”¨çš„æ˜¯v2ç‰ˆæœ¬ï¼Œv3ç‰ˆæœ¬ä½¿ç”¨æ—¶æœ‰ç¯å¢ƒå˜é‡å¯¼è‡´çš„é—®é¢˜"></a>é‡‡ç”¨çš„æ˜¯v2ç‰ˆæœ¬ï¼Œv3ç‰ˆæœ¬ä½¿ç”¨æ—¶æœ‰ç¯å¢ƒå˜é‡å¯¼è‡´çš„é—®é¢˜</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://oss.putianhui.cn/software/redis-shake.tar.gz<br><br>tar xzvf redis-shake.tar.gz<br><br>ll |grep redis-shake<br>-rwxr-xr-x 1 1320024 <span class="hljs-built_in">users</span> 10851553 5æœˆ  26 2019 redis-shake<br>-rw-r--r-- 1 1320024 <span class="hljs-built_in">users</span>     8541 2æœˆ  28 15:46 redis-shake.conf<br>-rw-r--r-- 1 root    root   3801776 2æœˆ  28 15:30 redis-shake.tar.gz<br><br></code></pre></td></tr></table></figure><h2 id="2-ä¿®æ”¹redis-shake-confé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ æºclusteråˆ°ç›®æ ‡clusterçš„é…ç½®ä¿¡æ¯ã€‚"><a href="#2-ä¿®æ”¹redis-shake-confé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ æºclusteråˆ°ç›®æ ‡clusterçš„é…ç½®ä¿¡æ¯ã€‚" class="headerlink" title="2.ä¿®æ”¹redis-shake.confé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ æºclusteråˆ°ç›®æ ‡clusterçš„é…ç½®ä¿¡æ¯ã€‚"></a>2.ä¿®æ”¹redis-shake.confé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ æºclusteråˆ°ç›®æ ‡clusterçš„é…ç½®ä¿¡æ¯ã€‚</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># æºredisç±»å‹</span><br>source.type = cluster<br><span class="hljs-comment"># æºredisçš„é›†ç¾¤masteråœ°å€</span><br>source.address = 192.168.99.62:7000;192.168.99.62:7001;192.168.99.62:7002<br><span class="hljs-comment"># æºredisé›†ç¾¤çš„è®¤è¯</span><br>source.password_raw = test-redis123<br>source.auth_type = auth<br>source.tls_enable = <span class="hljs-literal">false</span><br><span class="hljs-comment"># ç›®æ ‡redisç±»å‹</span><br>target.type = cluster<br><span class="hljs-comment"># ç›®æ ‡redisçš„é›†ç¾¤masteråœ°å€</span><br>target.address = 192.168.99.60:7000;192.168.99.60:7001;192.168.99.60:7002<br><span class="hljs-comment"># ç›®æ ‡redisé›†ç¾¤çš„è®¤è¯</span><br>target.password_raw =test123456<br>target.auth_type = auth<br><span class="hljs-comment"># ç›®æ ‡redisçš„æ•°æ®åº“ç¼–å·ï¼Œé›†ç¾¤æ¨¡å¼ç”¨-1,å•æœºå¯ä»¥æŒ‡å®šä½ çš„redisæ•°æ®åº“ç¼–å·</span><br>target.db = -1<br>target.tls_enable = <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h2 id="3-å¯åŠ¨redis-shake"><a href="#3-å¯åŠ¨redis-shake" class="headerlink" title="3.å¯åŠ¨redis-shake"></a>3.å¯åŠ¨redis-shake</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">./redis-shake -<span class="hljs-built_in">type</span> <span class="hljs-built_in">sync</span> -conf redis-shake.conf<br><br><span class="hljs-comment">#åå°è¿è¡Œ</span><br><span class="hljs-built_in">nohup</span> /data/back-redis/redis-shake -<span class="hljs-built_in">type</span> <span class="hljs-built_in">sync</span> -conf redis-shake.conf &amp;&gt; /data/back-redis/shake.log &amp; 2&gt;&amp;1<br><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br><span class="hljs-comment">##æ‰§è¡Œæ—¥å¿—ä¸­å‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼Œä»£è¡¨å…¨é‡æ•°æ®åŒæ­¥å®Œæˆï¼Œè¿›å…¥å¢é‡åŒæ­¥é˜¶æ®µï¼š</span><br><span class="hljs-built_in">sync</span> rdb <span class="hljs-keyword">done</span>.<br><br><br><br><span class="hljs-comment">##æ‰§è¡Œæ—¥å¿—å‡ºç°å¦‚ä¸‹ä¿¡æ¯æ—¶ï¼Œä»£è¡¨å¢é‡åŒæ­¥æ— æ–°å¢å†…å®¹ï¼Œå¯æ‰‹åŠ¨åœæ­¢åŒæ­¥ï¼ˆCtrl + Cï¼‰ï¼š</span><br><span class="hljs-built_in">sync</span>:  +forwardCommands=0  +filterCommands=0  +writeBytes=0<br><br><br></code></pre></td></tr></table></figure><p><strong>å¸¸è§é—®é¢˜ï¼š<code>https://github.com/alibaba/RedisShake/wiki/redis%E2%80%90shake-2.x-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98</code></strong></p>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerå®‰è£…redis</title>
    <link href="/2023/04/03/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/docker%E5%AE%89%E8%A3%85redis/"/>
    <url>/2023/04/03/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/docker%E5%AE%89%E8%A3%85redis/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="dockerå®‰è£…redis"><a href="#dockerå®‰è£…redis" class="headerlink" title="dockerå®‰è£…redis"></a>dockerå®‰è£…redis</h1><h2 id="1-æ–°å»ºç›®å½•"><a href="#1-æ–°å»ºç›®å½•" class="headerlink" title="1.æ–°å»ºç›®å½•"></a>1.æ–°å»ºç›®å½•</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /app/docker/redis/&#123;conf,data&#125; -p<br><br><span class="hljs-built_in">cd</span> /app/docker/redis<br></code></pre></td></tr></table></figure><h2 id="2-è·å–redisæ¨¡æ¿é…ç½®"><a href="#2-è·å–redisæ¨¡æ¿é…ç½®" class="headerlink" title="2.è·å–redisæ¨¡æ¿é…ç½®"></a>2.è·å–redisæ¨¡æ¿é…ç½®</h2><p><strong>å¯é€šè¿‡wget æˆ–è€…ä¸Šä¼ confæ–‡ä»¶</strong></p><p>è·å– redis çš„é»˜è®¤é…ç½®æ¨¡ç‰ˆ<br>è¿™é‡Œä¸»è¦æ˜¯æƒ³è®¾ç½®ä¸‹ redis çš„ log &#x2F; password &#x2F; appendonly<br>redis çš„ docker è¿è¡Œå‚æ•°æä¾›äº† â€“appendonly yes ä½†æ²¡ password</p><h3 id="åœ¨çº¿ä¸‹è½½confæ–‡ä»¶"><a href="#åœ¨çº¿ä¸‹è½½confæ–‡ä»¶" class="headerlink" title="åœ¨çº¿ä¸‹è½½confæ–‡ä»¶"></a>åœ¨çº¿ä¸‹è½½confæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://raw.githubusercontent.com/antirez/redis/4.0/redis.conf -O ./conf/redis.conf  <span class="hljs-comment">#å¯æœ¬åœ°ä¸Šä¼ </span><br><br><span class="hljs-comment"># ç›´æ¥æ›¿æ¢ç¼–è¾‘ï¼Œä¿®æ”¹confæ–‡ä»¶</span><br>sed -i <span class="hljs-string">&#x27;s/logfile &quot;&quot;/logfile &quot;access.log&quot;/g&#x27;</span> /app/docker/redis/conf/redis.conf<br>sed -i <span class="hljs-string">&#x27;s/# ã€ã€ foobared/requirepass 123456/g&#x27;</span> /app/docker/redis/conf/redis.conf<br>sed -i <span class="hljs-string">&#x27;s/appendonly no/appendonly yes/g&#x27;</span> /app/docker/redis/conf/redis.conf<br><br></code></pre></td></tr></table></figure><h3 id="ä¸Šä¼ confæ–‡ä»¶"><a href="#ä¸Šä¼ confæ–‡ä»¶" class="headerlink" title="ä¸Šä¼ confæ–‡ä»¶"></a>ä¸Šä¼ confæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /app/docker/conf/redis.conf<br><br>requirepass 123456   <span class="hljs-comment">#//æ‰¾åˆ°ï¼Œä¿®æ”¹å¯†ç </span><br><br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¯èƒ½è¿˜éœ€é…ç½®<code>bind</code>,<code> protected-mode</code></p><ul><li><p>protected-mode æ˜¯åœ¨æ²¡æœ‰æ˜¾ç¤ºå®šä¹‰ bind åœ°å€ï¼ˆå³ç›‘å¬å…¨ç½‘æ–­ï¼‰ï¼Œåˆæ²¡æœ‰è®¾ç½®å¯†ç  requirepassæ—¶ï¼Œprotected-mode åªå…è®¸æœ¬åœ°å›ç¯ 127.0.0.1 è®¿é—®ã€‚ä¹Ÿå°±æ˜¯è¯´å½“å¼€å¯äº† protected-mode æ—¶ï¼Œå¦‚æœä½ æ—¢æ²¡æœ‰æ˜¾ç¤ºçš„å®šä¹‰äº† bind ç›‘å¬çš„åœ°å€ï¼ŒåŒæ—¶åˆæ²¡æœ‰è®¾ç½® auth å¯†ç ã€‚é‚£ä½ åªèƒ½é€šè¿‡ 127.0.0.1 æ¥è®¿é—® redis æœåŠ¡ã€‚</p></li><li><p>å…³é—­ç»‘å®š[å…è®¸æ‰€æœ‰å¤–ç½‘è®¿é—®]ï¼š # bind 127.0.0.1  æˆ–è€… è§£é™¤åªæœ‰æœ¬åœ°èƒ½é“¾æ¥å®¢æˆ·ç«¯  0.0.0.0 -::1</p></li><li><p>å¼€å¯å¯†ç éªŒè¯ï¼š requirepass redispassword</p></li><li><p>å¼€å¯æ•°æ®æŒä¹…åŒ–[aof]ï¼šappendonly yes</p></li><li><p>é…ç½®æ—¥å¿—å­˜æ”¾ç›®å½•å’Œæ–‡ä»¶ï¼šlogfile &#x2F;logs&#x2F;redis.log</p></li></ul><h2 id="3-åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªåä¸º-myredis-çš„å®¹å™¨"><a href="#3-åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªåä¸º-myredis-çš„å®¹å™¨" class="headerlink" title="3.åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªåä¸º myredis çš„å®¹å™¨"></a>3.åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªåä¸º myredis çš„å®¹å™¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªåä¸º myredis çš„å®¹å™¨</span><br>docker run \<br>--restart=always \<br>-p 6379:6379 \<br>-v <span class="hljs-variable">$PWD</span>/data:/data \<br>-v <span class="hljs-variable">$PWD</span>/conf/redis.conf:/etc/redis/redis.conf \<br>--privileged=<span class="hljs-literal">true</span> \<br>--name myredis \<br>-d redis redis-server /etc/redis/redis.conf<br><br><span class="hljs-comment">#$PWDç­‰äºç›®å½•å˜é‡ ï¼Œä»¥ä¸Šä»£ç ç­‰äº</span><br>docker run -p 6379:6379 -v /app/docker/redis/data:/data -v /app/docker/redis/conf/redis.conf:/etc/redis/redis.conf --privileged=<span class="hljs-literal">true</span> --name myredis -d redis redis-server /etc/redis/redis.conf<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šå‘½ä»¤è§£æï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run \<br>--restart=always \ <span class="hljs-comment">#å½“ Docker é‡å¯æ—¶ï¼Œå®¹å™¨è‡ªåŠ¨å¯åŠ¨ã€‚</span><br>-p 6379:6379 \ <span class="hljs-comment"># ç«¯å£æ˜ å°„ å®¿ä¸»æœº:å®¹å™¨</span><br>-v <span class="hljs-variable">$PWD</span>/data:/data:rw \ <span class="hljs-comment"># æ˜ å°„æ•°æ®ç›®å½• rw ä¸ºè¯»å†™</span><br>-v <span class="hljs-variable">$PWD</span>/conf/redis.conf:/etc/redis/redis.conf:ro \ <span class="hljs-comment"># æŒ‚è½½é…ç½®æ–‡ä»¶ ro ä¸ºreadonly</span><br>--privileged=<span class="hljs-literal">true</span> \ <span class="hljs-comment"># ç»™ä¸ä¸€äº›æƒé™</span><br>--name myredis \ <span class="hljs-comment"># ç»™å®¹å™¨èµ·ä¸ªåå­—</span><br>-d redis redis-server /etc/redis/redis.conf <span class="hljs-comment"># deamon è¿è¡Œå®¹å™¨ å¹¶ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨å®¹å™¨å†…çš„ redis-server </span><br><br></code></pre></td></tr></table></figure><h2 id="4-å…¶ä»–æ“ä½œ"><a href="#4-å…¶ä»–æ“ä½œ" class="headerlink" title="4.å…¶ä»–æ“ä½œ"></a>4.å…¶ä»–æ“ä½œ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># æŸ¥çœ‹æ´»è·ƒçš„å®¹å™¨</span><br>docker ps<br><br><span class="hljs-comment"># å¦‚æœæ²¡æœ‰ myredis è¯´æ˜å¯åŠ¨å¤±è´¥ æŸ¥çœ‹é”™è¯¯æ—¥å¿—</span><br>docker logs myredis<br><br><span class="hljs-comment"># æŸ¥çœ‹ myredis çš„ ip æŒ‚è½½ ç«¯å£æ˜ å°„ç­‰ä¿¡æ¯</span><br>docker inspect myredis<br><br><span class="hljs-comment"># æŸ¥çœ‹ myredis çš„ç«¯å£æ˜ å°„</span><br>docker port myredis<br></code></pre></td></tr></table></figure><h2 id="5-redisç™»å½•"><a href="#5-redisç™»å½•" class="headerlink" title="5.redisç™»å½•"></a>5.redisç™»å½•</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker <span class="hljs-built_in">exec</span> -it redis bash<br><br>&gt; redis-cli <br>&gt; auth  å¯†ç  <br><br></code></pre></td></tr></table></figure><h2 id="6-redis-keyæ“ä½œ"><a href="#6-redis-keyæ“ä½œ" class="headerlink" title="6.redis-keyæ“ä½œ"></a>6.redis-keyæ“ä½œ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æŸ¥è¯¢key</span><br>keys +æŸ¥è¯¢çš„key<br><br><span class="hljs-comment">#åˆ é™¤key</span><br>del key +åˆ é™¤çš„keyåç§°<br><br><span class="hljs-comment">#æŸ¥çœ‹keyçš„ç±»å‹</span><br><span class="hljs-built_in">type</span> <span class="hljs-string">&quot;æŸ¥è¯¢çš„key&quot;</span><br><br><span class="hljs-comment">#æŸ¥çœ‹keyçš„å€¼</span><br>hkey <span class="hljs-string">&quot;keyçš„åç§°&quot;</span>  æŸ¥è¯¢å‡ºkeyçš„ç±»å‹æ˜¯bash  å¯ä»¥ç”¨hkeyæŸ¥çœ‹<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨docker-composeå¯åŠ¨rabbitmq</title>
    <link href="/2023/04/03/%E4%B8%AD%E9%97%B4%E4%BB%B6/rabbitmq/%E4%BD%BF%E7%94%A8docker-compose%E5%90%AF%E5%8A%A8rabbitmq/"/>
    <url>/2023/04/03/%E4%B8%AD%E9%97%B4%E4%BB%B6/rabbitmq/%E4%BD%BF%E7%94%A8docker-compose%E5%90%AF%E5%8A%A8rabbitmq/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨docker-composeå¯åŠ¨rabbitmq"><a href="#ä½¿ç”¨docker-composeå¯åŠ¨rabbitmq" class="headerlink" title="ä½¿ç”¨docker-composeå¯åŠ¨rabbitmq"></a>ä½¿ç”¨docker-composeå¯åŠ¨rabbitmq</h1><h2 id="1-å®‰è£…docker-compose"><a href="#1-å®‰è£…docker-compose" class="headerlink" title="1.å®‰è£…docker-compose"></a>1.å®‰è£…docker-compose</h2><h2 id="2-æ–°å»ºå·¥ä½œç›®å½•"><a href="#2-æ–°å»ºå·¥ä½œç›®å½•" class="headerlink" title="2.æ–°å»ºå·¥ä½œç›®å½•"></a>2.æ–°å»ºå·¥ä½œç›®å½•</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /app/rabbitmq<br></code></pre></td></tr></table></figure><h2 id="3-ç¼–å†™yamlæ–‡ä»¶"><a href="#3-ç¼–å†™yamlæ–‡ä»¶" class="headerlink" title="3.ç¼–å†™yamlæ–‡ä»¶"></a>3.ç¼–å†™yamlæ–‡ä»¶</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.7&quot;</span><br><span class="hljs-attr">services:</span><br> <br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">rabbitmq:3-management</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">rabbitmq</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;5672:5672&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;15672:15672&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/app/rabbitmq:/var/lib/rabbitmq</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">RABBITMQ_DEFAULT_USER=root</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">RABBITMQ_DEFAULT_PASS=root1234</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">TZ=Asia/Shanghai</span><br></code></pre></td></tr></table></figure><h2 id="4-å¯åŠ¨"><a href="#4-å¯åŠ¨" class="headerlink" title="4.å¯åŠ¨"></a>4.å¯åŠ¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker-compose  up -d <br><span class="hljs-comment">#-f æŒ‡å®šyamlæ–‡ä»¶</span><br><span class="hljs-comment">#docker-compose  -f rabbitmq.yaml up -d </span><br></code></pre></td></tr></table></figure><h2 id="é—®é¢˜å¤„ç†"><a href="#é—®é¢˜å¤„ç†" class="headerlink" title="é—®é¢˜å¤„ç†"></a>é—®é¢˜å¤„ç†</h2><h3 id="15672ç«¯å£æ˜¯rabbitmqçš„webè®¿é—®é¡µé¢ï¼Œå®‰è£…RabbitMQå¯åŠ¨åæ— æ³•è®¿é—®15672ç«¯å£"><a href="#15672ç«¯å£æ˜¯rabbitmqçš„webè®¿é—®é¡µé¢ï¼Œå®‰è£…RabbitMQå¯åŠ¨åæ— æ³•è®¿é—®15672ç«¯å£" class="headerlink" title="15672ç«¯å£æ˜¯rabbitmqçš„webè®¿é—®é¡µé¢ï¼Œå®‰è£…RabbitMQå¯åŠ¨åæ— æ³•è®¿é—®15672ç«¯å£"></a>15672ç«¯å£æ˜¯rabbitmqçš„webè®¿é—®é¡µé¢ï¼Œå®‰è£…RabbitMQå¯åŠ¨åæ— æ³•è®¿é—®15672ç«¯å£</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl localhost:15672 <span class="hljs-comment">#å‘ç°æ— é¡µé¢</span><br><span class="hljs-comment">##è¿›å…¥å®¹å™¨</span><br>docker <span class="hljs-built_in">exec</span> -it rabbitmq bash<br><br><span class="hljs-comment">#æŸ¥çœ‹ç«¯å£æ˜¯å¦å¯åŠ¨</span><br>netstat -lntup | grep 5672<br><br><span class="hljs-comment">#å‘ç°15672ç«¯å£æœªå¯åŠ¨ï¼Œæ‰§è¡Œå¯åŠ¨rabbitç®¡ç†æ’ä»¶</span><br>rabbitmq-plugins <span class="hljs-built_in">enable</span> rabbitmq_management<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>rabbitmq</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rabbitmq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nacosé›†ç¾¤æ­å»º</title>
    <link href="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/Nacos/Nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"/>
    <url>/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/Nacos/Nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Nacosé›†ç¾¤æ­å»º"><a href="#Nacosé›†ç¾¤æ­å»º" class="headerlink" title="Nacosé›†ç¾¤æ­å»º"></a>Nacosé›†ç¾¤æ­å»º</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://nacos.io/zh-cn/docs/cluster-mode-quick-start.html<br></code></pre></td></tr></table></figure><h2 id="1ã€Nacosé›†ç¾¤éƒ¨ç½²æ¶æ„"><a href="#1ã€Nacosé›†ç¾¤éƒ¨ç½²æ¶æ„" class="headerlink" title="1ã€Nacosé›†ç¾¤éƒ¨ç½²æ¶æ„"></a>1ã€Nacosé›†ç¾¤éƒ¨ç½²æ¶æ„</h2><p><strong>ç”Ÿäº§ç¯å¢ƒå¤§å¤šä½¿ç”¨é›†ç¾¤æ¨¡å¼ä»¥ç¡®ä¿é«˜å¯ç”¨ã€‚</strong></p><p>nacosé›†ç¾¤æ¶æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/Nacos/Nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/28cba1735c84ae4b24d3564c61f34dc4-1681290380221.png" alt="image-20220415183010933"></p><p>nacosæ”¯æŒä¸‰ç§éƒ¨ç½²æ¨¡å¼ï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">- å•å‡»æ¨¡å¼ï¼šç”¨äºæµ‹è¯•å’Œå•å‡»è¯•ç”¨ã€‚<br>- é›†ç¾¤æ¨¡å¼ï¼šç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿é«˜å¯ç”¨ã€‚<br>- å¤šé›†ç¾¤æ¨¡å¼ï¼šç”¨äºå¤šæ•°æ®ä¸­å¿ƒåœºæ™¯ã€‚<br></code></pre></td></tr></table></figure><p>  å®˜æ–¹æ¨èçš„é›†ç¾¤æ–¹æ¡ˆï¼Œé€šè¿‡åŸŸå + VIPæ¨¡å¼çš„æ–¹å¼æ¥å®ç°ï¼ŒVIPæ¨¡å¼å°±ç”¨ Nginx å°±è¡Œï¼Œç”¨å®ƒæ¥è´Ÿè½½å¤šä¸ª Nacos èŠ‚ç‚¹ IPï¼Œå¤–éƒ¨å®¢æˆ·ç«¯ç›´æ¥é€šè¿‡åŸŸåè®¿é—®å°±å¯ï¼Œä¸ä»…å¯è¯»æ€§å¥½ï¼Œè€Œä¸”æ›´æ¢ IP æ–¹ä¾¿ï¼Œæœ€ä¸ºæ¨èé‡‡ç”¨ï¼</p><h2 id="2ã€ç¯å¢ƒå‡†å¤‡"><a href="#2ã€ç¯å¢ƒå‡†å¤‡" class="headerlink" title="2ã€ç¯å¢ƒå‡†å¤‡"></a>2ã€ç¯å¢ƒå‡†å¤‡</h2><ul><li><strong>å®‰è£…å¥½ JDKï¼Œéœ€è¦ 1.8 åŠå…¶ä»¥ä¸Šç‰ˆæœ¬</strong></li><li>å»ºè®®: 2æ ¸ CPU &#x2F; 4G å†…å­˜ åŠå…¶ä»¥ä¸Š</li></ul><table><thead><tr><th>ä¸»æœºå</th><th>IPåœ°å€</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>nacos-1</td><td>192.168.62.128</td><td>ä½¿ç”¨é»˜è®¤çš„8848ç«¯å£ã€å®‰è£…dockerè¿è¡Œmysqlå•èŠ‚ç‚¹</td></tr><tr><td>nacos-2</td><td>192.168.62.129</td><td>ä½¿ç”¨é»˜è®¤çš„8848ç«¯å£</td></tr><tr><td>nacos-3</td><td>192.168.62.130</td><td>ä½¿ç”¨é»˜è®¤çš„8848ç«¯å£ã€å®‰è£…nginx</td></tr></tbody></table><h2 id="3ã€å¼€å§‹å®‰è£…"><a href="#3ã€å¼€å§‹å®‰è£…" class="headerlink" title="3ã€å¼€å§‹å®‰è£…"></a>3ã€å¼€å§‹å®‰è£…</h2><h3 id="1ã€åˆ›å»ºå·¥ä½œç›®å½•å¹¶ä¸‹è½½å®‰è£…åŒ…ï¼ˆnacos-1ã€nacos-2ã€nacos-3å‡éœ€è¦ä¸‹è½½ï¼‰"><a href="#1ã€åˆ›å»ºå·¥ä½œç›®å½•å¹¶ä¸‹è½½å®‰è£…åŒ…ï¼ˆnacos-1ã€nacos-2ã€nacos-3å‡éœ€è¦ä¸‹è½½ï¼‰" class="headerlink" title="1ã€åˆ›å»ºå·¥ä½œç›®å½•å¹¶ä¸‹è½½å®‰è£…åŒ…ï¼ˆnacos-1ã€nacos-2ã€nacos-3å‡éœ€è¦ä¸‹è½½ï¼‰"></a>1ã€åˆ›å»ºå·¥ä½œç›®å½•å¹¶ä¸‹è½½å®‰è£…åŒ…ï¼ˆnacos-1ã€nacos-2ã€nacos-3å‡éœ€è¦ä¸‹è½½ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ›å»ºå·¥ä½œç›®å½•</span><br><span class="hljs-built_in">mkdir</span> /app &amp;&amp; <span class="hljs-built_in">cd</span> /app<br><br><span class="hljs-comment">#ä¸‹è½½å®‰è£…åŒ…ï¼Œä¸‹è½½åœ°å€ï¼šhttps://github.com/alibaba/nacos/tags</span><br>wget https://github.com/alibaba/nacos/releases/download/1.3.0/nacos-server-1.3.0.tar.gz<br><br><span class="hljs-comment">#è§£å‹å¹¶è¿›å…¥ç›®å½•</span><br>tar -xnf nacos-server-1.3.0.tar.gz &amp;&amp; <span class="hljs-built_in">cd</span> nacos<br></code></pre></td></tr></table></figure><h3 id="2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆnacos-1ã€nacos-2ã€nacos-3å‡éœ€è¦åšä¿®æ”¹ï¼‰"><a href="#2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆnacos-1ã€nacos-2ã€nacos-3å‡éœ€è¦åšä¿®æ”¹ï¼‰" class="headerlink" title="2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆnacos-1ã€nacos-2ã€nacos-3å‡éœ€è¦åšä¿®æ”¹ï¼‰"></a>2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆnacos-1ã€nacos-2ã€nacos-3å‡éœ€è¦åšä¿®æ”¹ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#confæ–‡ä»¶å¤¹ä¸­æœ‰cluster.conf.exampleï¼Œå¤åˆ¶ä¸€ä»½å¹¶æ›´åæˆconfæ–‡ä»¶ï¼Œç›´æ¥ä½¿ç”¨å¦‚ä¸‹è¿½åŠ å‘½ä»¤ä¿®æ”¹é…ç½®æ–‡ä»¶åˆ™ä¸éœ€è¦æ‰§è¡Œè¯¥æ­¥éª¤</span><br><span class="hljs-comment">#cp conf/cluster.conf.example conf/cluster.conf</span><br><br><span class="hljs-comment">#ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="hljs-comment">##é…ç½®æˆip:port</span><br><span class="hljs-built_in">echo</span> 192.168.62.128:8848 &gt; conf/cluster.conf<br><span class="hljs-built_in">echo</span> 192.168.62.129:8848 &gt;&gt; conf/cluster.conf<br><span class="hljs-built_in">echo</span> 192.168.62.130:8848 &gt;&gt; conf/cluster.conf<br></code></pre></td></tr></table></figure><h3 id="3ã€é…ç½®MySQLæ•°æ®åº“ï¼ˆä½¿ç”¨å¤–ç½®æ•°æ®æºï¼‰ï¼ˆnacos-1æœºå™¨ä¸Šæ“ä½œï¼Œè¿è¡Œmysqlï¼‰"><a href="#3ã€é…ç½®MySQLæ•°æ®åº“ï¼ˆä½¿ç”¨å¤–ç½®æ•°æ®æºï¼‰ï¼ˆnacos-1æœºå™¨ä¸Šæ“ä½œï¼Œè¿è¡Œmysqlï¼‰" class="headerlink" title="3ã€é…ç½®MySQLæ•°æ®åº“ï¼ˆä½¿ç”¨å¤–ç½®æ•°æ®æºï¼‰ï¼ˆnacos-1æœºå™¨ä¸Šæ“ä½œï¼Œè¿è¡Œmysqlï¼‰"></a>3ã€é…ç½®MySQLæ•°æ®åº“ï¼ˆä½¿ç”¨å¤–ç½®æ•°æ®æºï¼‰ï¼ˆnacos-1æœºå™¨ä¸Šæ“ä½œï¼Œè¿è¡Œmysqlï¼‰</h3><p>ç”Ÿäº§ç¯å¢ƒä¸­æ•°æ®åº“ä½¿ç”¨å»ºè®®è‡³å°‘ä¸»å¤‡æ¨¡å¼ï¼Œæˆ–è€…é‡‡ç”¨é«˜å¯ç”¨æ•°æ®åº“ã€‚ä»¥ä¸‹ä¸ºäº†ç®€åŒ–ï¼Œä½¿ç”¨dockerè¿è¡Œä¸€ä¸ªmysqlå®¹å™¨å®ç°</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä½¿ç”¨dockerè¿è¡Œä¸€ä¸ªmysql</span><br>docker run -p 3306:3306 \<br>--name mysql -e TZ=Asia/Shanghai \<br>--restart=always \<br>-v /app/mysql/conf:/etc/mysql/conf.d \<br>-v /app/mysql/log:/logs \<br>-v /app/mysql/data:/var/lib/mysql \<br>-e MYSQL_ROOT_PASSWORD=123456 \<br>-d mysql:5.7<br></code></pre></td></tr></table></figure><p>è¿æ¥mysqlæ•°æ®åº“ï¼Œå¹¶åˆ›å»ºåä¸ºï¼šnacos_configçš„æ•°æ®åº“</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">create database nacos_config;<br></code></pre></td></tr></table></figure><p>å°†confæ–‡ä»¶å¤¹ä¸‹çš„nacos-mysql.sqlè„šæœ¬åœ¨mysqlä¸­æ‰§è¡Œï¼ˆå¤åˆ¶åˆ°å®¹å™¨æˆ–è€…å®‰è£…mysqlæ’ä»¶å®¿ä¸»æœºæ‰§è¡Œï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å®¿ä¸»æœºï¼ˆæœåŠ¡å™¨ï¼‰ä¸Šæ‰§è¡Œ</span><br>mysql -uroot -p123456 nacos_config &lt; conf/nacos-mysql.sql<br><br><span class="hljs-comment">#ä»¥ä¸‹ä¸ºå¤åˆ¶åˆ°å®¹å™¨å†…æ‰§è¡Œ</span><br>docker <span class="hljs-built_in">cp</span> conf/nacos-mysql.sql mysql:/<br>mysql -uroot -p123456 nacos_config &lt; /nacos-mysql.sql<br><br></code></pre></td></tr></table></figure><h3 id="4ã€ä¿®æ”¹application-propertiesï¼ˆnacos-1ã€nacos-2ã€nacos-3ä¸­éƒ½éœ€è¦ä¿®æ”¹ï¼‰"><a href="#4ã€ä¿®æ”¹application-propertiesï¼ˆnacos-1ã€nacos-2ã€nacos-3ä¸­éƒ½éœ€è¦ä¿®æ”¹ï¼‰" class="headerlink" title="4ã€ä¿®æ”¹application.propertiesï¼ˆnacos-1ã€nacos-2ã€nacos-3ä¸­éƒ½éœ€è¦ä¿®æ”¹ï¼‰"></a>4ã€ä¿®æ”¹application.propertiesï¼ˆnacos-1ã€nacos-2ã€nacos-3ä¸­éƒ½éœ€è¦ä¿®æ”¹ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim conf/application.properties<br><span class="hljs-comment">#----------ä¿®æ”¹ä»¥ä¸‹å†…å®¹--------------------</span><br>server.port=8848 <span class="hljs-comment">#ç«¯å£å·ï¼Œé»˜è®¤8848ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µæ›´æ”¹</span><br><br>spring.datasource.platform=mysql<br><br><span class="hljs-comment"># Count of DB:</span><br>db.num=1<br><br><span class="hljs-comment"># Connect URL of DB:</span><br>db.url.0=jdbc:mysql://192.168.62.128:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=<span class="hljs-literal">true</span>&amp;useUnicode=<span class="hljs-literal">true</span>&amp;useSSL=<span class="hljs-literal">false</span>&amp;serverTimezone=UTC ï¼ˆå¤åˆ¶é—®å·?å‰é¢å†…å®¹å³å¯ï¼‰<br>rue&amp;useUnicode=<span class="hljs-literal">true</span>&amp;useSSL=<span class="hljs-literal">false</span>&amp;serverTimezone=UTC<br>db.user=root<span class="hljs-comment">#æ•°æ®åº“è¿æ¥ç”¨æˆ·åï¼Œç”Ÿäº§ç¯å¢ƒå¯è®¾ç½®å…¶ä»–ç”¨æˆ·åå’Œå¯†ç </span><br>db.password=123456<span class="hljs-comment">#è¿æ¥å¯†ç </span><br><br></code></pre></td></tr></table></figure><h3 id="5ã€-å¯åŠ¨æœåŠ¡å™¨-nacos-1ã€nacos-2ã€nacos-3å¯åŠ¨ï¼‰"><a href="#5ã€-å¯åŠ¨æœåŠ¡å™¨-nacos-1ã€nacos-2ã€nacos-3å¯åŠ¨ï¼‰" class="headerlink" title="5ã€ å¯åŠ¨æœåŠ¡å™¨ (nacos-1ã€nacos-2ã€nacos-3å¯åŠ¨ï¼‰"></a>5ã€ å¯åŠ¨æœåŠ¡å™¨ (nacos-1ã€nacos-2ã€nacos-3å¯åŠ¨ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">sh bin/startup.sh<br><br><span class="hljs-comment">#å°†è¾“å‡ºä»¥é›†ç¾¤æ¨¡å¼(cluster)å¯åŠ¨çš„æ—¥å¿—æç¤ºï¼š</span><br>nacos is starting with cluster<br>nacos is startingï¼Œyou can check the /app/nacos/nacos/logs/start.out<br><br><span class="hljs-comment">#å¯ä½¿ç”¨jpså‘½ä»¤æŸ¥çœ‹æ˜¯å¦è¿è¡Œ</span><br><span class="hljs-comment">#å¤‡æ³¨ï¼šå½“æœåŠ¡å™¨é…ç½®è¿‡ä½æ—¶å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡èµ·ä¸æ¥ï¼Œå¯ä¿®æ”¹bin/startup.shä¸­çš„Xmsé…ç½®</span><br>JAVA_OPT=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;JAVA_OPT&#125;</span> -server -Xms512m -Xmx512m -Xmn256m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m&quot;</span><br></code></pre></td></tr></table></figure><h3 id="6ã€è®¿é—®ä¸‰å°èŠ‚ç‚¹çš„æ§åˆ¶å°æŸ¥çœ‹æ˜¯å¦æˆåŠŸ-ip-ç«¯å£-x2F-nacos"><a href="#6ã€è®¿é—®ä¸‰å°èŠ‚ç‚¹çš„æ§åˆ¶å°æŸ¥çœ‹æ˜¯å¦æˆåŠŸ-ip-ç«¯å£-x2F-nacos" class="headerlink" title="6ã€è®¿é—®ä¸‰å°èŠ‚ç‚¹çš„æ§åˆ¶å°æŸ¥çœ‹æ˜¯å¦æˆåŠŸ(ip+ç«¯å£&#x2F;nacos)"></a>6ã€è®¿é—®ä¸‰å°èŠ‚ç‚¹çš„æ§åˆ¶å°æŸ¥çœ‹æ˜¯å¦æˆåŠŸ(ip+ç«¯å£&#x2F;nacos)</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs txt">è®¿é—®åœ°å€ï¼š192.168.62.128:8848/nacosã€192.168.62.129:8848/nacosã€192.168.62.130:8848/nacos<br>åˆå§‹è´¦å·ï¼šnacos<br>åˆå§‹å¯†ç ï¼šnacos<br><br>#ç™»å½•è¿›å»åã€‚ç‚¹å‡»é›†ç¾¤ç®¡ç†&gt;-èŠ‚ç‚¹ç®¡ç†ï¼›å¯çœ‹åˆ°nacosé›†ç¾¤å­˜åœ¨<br></code></pre></td></tr></table></figure><h3 id="7ã€ä½¿ç”¨nginxåšè´Ÿè½½å‡è¡¡-nacos-3ä¸Šå®‰è£…äº†nginx"><a href="#7ã€ä½¿ç”¨nginxåšè´Ÿè½½å‡è¡¡-nacos-3ä¸Šå®‰è£…äº†nginx" class="headerlink" title="7ã€ä½¿ç”¨nginxåšè´Ÿè½½å‡è¡¡(nacos-3ä¸Šå®‰è£…äº†nginx)"></a>7ã€ä½¿ç”¨nginxåšè´Ÿè½½å‡è¡¡(nacos-3ä¸Šå®‰è£…äº†nginx)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¿®æ”¹nginxæ–‡ä»¶</span><br>vim default.conf<br><br>upstream nacos&#123;<br>        server 192.168.62.128:8848;<br>        server 192.168.62.129:8848;<br>        server 192.168.62.130:8848;<br>&#125;<br>server &#123;<br>        listen 8888;<br>        server_name localhost;<br>        location / &#123;<br>            proxy_set_header Host <span class="hljs-variable">$http_host</span>;<br>            proxy_set_header X-Forwarded-For <span class="hljs-variable">$remote_addr</span>;<br>            client_body_buffer_size 10M;<br>            client_max_body_size 10G;<br>            proxy_buffers 1024 4k;<br>            proxy_read_timeout 300;<br>            proxy_next_upstream error <span class="hljs-built_in">timeout</span> http_404;<br>            proxy_pass http://nacos;<br>        &#125;<br>&#125;<br><br><br><span class="hljs-comment">#ä¿®æ”¹åå¯åŠ¨nginx!</span><br><span class="hljs-comment">#å³å¯é€šè¿‡ï¼šhttp://192.168.62.130:8888/nacos è®¿é—®nacosé¡µé¢</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Nacos</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nacos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kafkaå®‰è£…éƒ¨ç½²åŠä½¿ç”¨(é›†ç¾¤)</title>
    <link href="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8(%E9%9B%86%E7%BE%A4)/"/>
    <url>/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8(%E9%9B%86%E7%BE%A4)/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Kafkaé›†ç¾¤æ­å»ºï¼ˆå¤šèŠ‚ç‚¹å¤šBrokerï¼‰"><a href="#Kafkaé›†ç¾¤æ­å»ºï¼ˆå¤šèŠ‚ç‚¹å¤šBrokerï¼‰" class="headerlink" title="Kafkaé›†ç¾¤æ­å»ºï¼ˆå¤šèŠ‚ç‚¹å¤šBrokerï¼‰"></a>Kafkaé›†ç¾¤æ­å»ºï¼ˆå¤šèŠ‚ç‚¹å¤šBrokerï¼‰</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒåšå®¢ï¼šhttps://blog.csdn.net/mengshicheng1992/article/details/119730753<br></code></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼šç”Ÿäº§ç¯å¢ƒä¸­ä¸ºç¡®ä¿é«˜å¯ç”¨æ—¶ï¼Œä¸€èˆ¬ä½¿ç”¨é›†ç¾¤éƒ¨ç½²ï¼ˆå³ï¼šå¤šèŠ‚ç‚¹å¤šBrokerï¼Œä»¥é›†ç¾¤çš„æ–¹å¼æ¥éƒ¨ç½²Kafkaï¼‰</p><p>æ³¨æ„ï¼šKafkaå¼ºä¾èµ–ZooKeeper(ä»¥ä¸‹ç®€ç§°ZKï¼‰ï¼Œéƒ¨ç½²Kafkaé›†ç¾¤ï¼Œéœ€è¦å…ˆå®‰è£…ZKé›†ç¾¤ã€‚</p><p><strong>ä»¥ä¸‹æ“ä½œå¦‚æœªæŒ‡å®šï¼Œåˆ™å‘½ä»¤åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼</strong></p><h2 id="ä¸€ã€ç³»ç»Ÿèµ„æºåŠç»„ä»¶è§„åˆ’"><a href="#ä¸€ã€ç³»ç»Ÿèµ„æºåŠç»„ä»¶è§„åˆ’" class="headerlink" title="ä¸€ã€ç³»ç»Ÿèµ„æºåŠç»„ä»¶è§„åˆ’"></a>ä¸€ã€ç³»ç»Ÿèµ„æºåŠç»„ä»¶è§„åˆ’</h2><table><thead><tr><th>èŠ‚ç‚¹åç§°</th><th>CPU&#x2F;å†…å­˜</th><th>IPåœ°å€</th><th>èŠ‚ç‚¹è§’è‰²</th></tr></thead><tbody><tr><td>Kafka1</td><td>2CPU&#x2F;4G&#x2F;40G</td><td>192.168.62.128</td><td>Kafkaã€ZooKeeper</td></tr><tr><td>Kafka2</td><td>2CPU&#x2F;4G&#x2F;40G</td><td>192.168.62.129</td><td>Kafkaã€ZooKeeper</td></tr><tr><td>Kafka3</td><td>2CPU&#x2F;4G&#x2F;40G</td><td>192.168.62.130</td><td>Kafkaã€ZooKeeper</td></tr></tbody></table><h2 id="äºŒã€ç³»ç»Ÿè½¯ä»¶å®‰è£…ä¸è®¾ç½®"><a href="#äºŒã€ç³»ç»Ÿè½¯ä»¶å®‰è£…ä¸è®¾ç½®" class="headerlink" title="äºŒã€ç³»ç»Ÿè½¯ä»¶å®‰è£…ä¸è®¾ç½®"></a>äºŒã€ç³»ç»Ÿè½¯ä»¶å®‰è£…ä¸è®¾ç½®</h2><h3 id="1ã€ç³»ç»Ÿåˆå§‹è®¾ç½®"><a href="#1ã€ç³»ç»Ÿåˆå§‹è®¾ç½®" class="headerlink" title="1ã€ç³»ç»Ÿåˆå§‹è®¾ç½®"></a>1ã€ç³»ç»Ÿåˆå§‹è®¾ç½®</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">1ï¼‰ä¿®æ”¹ä¸»æœºå<br><br>2ï¼‰å®‰è£…ä¾èµ–åŒ…<br>yum -y install vim lrzsz bash-completion<br><br>3)è®¾ç½®NTPæ—¶é—´åŒæ­¥<br>yum -y install chrony<br><br><span class="hljs-comment">#å¯åŠ¨chronyå¹¶è®¾ç½®è‡ªå¯åŠ¨</span><br>systemctl start chronyd<br>systemctl <span class="hljs-built_in">enable</span> chronyd<br>systemctl status chronyd<br><br>chronyc sources<br><br>4ï¼‰è®¾ç½®SELinuxã€å…³é—­é˜²ç«å¢™<br><br></code></pre></td></tr></table></figure><h3 id="2ã€è®¾ç½®åç§°è§£æ"><a href="#2ã€è®¾ç½®åç§°è§£æ" class="headerlink" title="2ã€è®¾ç½®åç§°è§£æ"></a>2ã€è®¾ç½®åç§°è§£æ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> 192.168.62.128 kafka1 &gt;&gt; /etc/hosts<br><span class="hljs-built_in">echo</span> 192.168.62.129 kafka2 &gt;&gt; /etc/hosts<br><span class="hljs-built_in">echo</span> 192.168.62.130 kafka3 &gt;&gt; /etc/hosts<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€æ­å»ºKafkaé«˜å¯ç”¨é›†ç¾¤"><a href="#ä¸‰ã€æ­å»ºKafkaé«˜å¯ç”¨é›†ç¾¤" class="headerlink" title="ä¸‰ã€æ­å»ºKafkaé«˜å¯ç”¨é›†ç¾¤"></a>ä¸‰ã€æ­å»ºKafkaé«˜å¯ç”¨é›†ç¾¤</h2><h3 id="1ã€å®‰è£…JDK"><a href="#1ã€å®‰è£…JDK" class="headerlink" title="1ã€å®‰è£…JDK"></a>1ã€å®‰è£…JDK</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å·²ç•¥è¿‡ï¼Œè¯¦æƒ…å¯å‚è€ƒã€Šé…ç½®javaç¯å¢ƒã€‹æ–‡æ¡£æˆ–æ‰§è¡Œã€Šjdkå®‰è£….shã€‹è„šæœ¬</span><br></code></pre></td></tr></table></figure><h3 id="2ã€å®‰è£…zookeeper"><a href="#2ã€å®‰è£…zookeeper" class="headerlink" title="2ã€å®‰è£…zookeeper"></a>2ã€å®‰è£…zookeeper</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å·²ç•¥è¿‡ï¼Œè¯¦æƒ…å¯å‚è€ƒã€ŠLinuxä¹‹Zookeeperé›†ç¾¤æ­å»ºã€‹æ–‡æ¡£</span><br></code></pre></td></tr></table></figure><h3 id="3ã€ä¸‹è½½å¹¶å®‰è£…Kafka"><a href="#3ã€ä¸‹è½½å¹¶å®‰è£…Kafka" class="headerlink" title="3ã€ä¸‹è½½å¹¶å®‰è£…Kafka"></a>3ã€ä¸‹è½½å¹¶å®‰è£…Kafka</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¸‹è½½Kafka</span><br><span class="hljs-comment">#ä¸‹è½½åœ°å€ï¼šhttp://kafka.apache.org/downloads</span><br>wget https://dlcdn.apache.org/kafka/3.3.1/kafka_2.13-3.3.1.tgz --no-check-certificate<br><br><span class="hljs-comment">#è§£å‹åˆ°æŒ‡å®šç›®å½•</span><br>tar -xnf kafka_2.13-3.3.1.tgz -C /app/<br><br><span class="hljs-comment">#æ›´åæˆ–è€…è®¾ç½®è½¯é“¾æ¥</span><br><span class="hljs-built_in">mv</span> /app/kafka_2.13-3.3.1 /app/kafka<br><br><span class="hljs-comment">#è®¾ç½®ç¯å¢ƒå˜é‡</span><br>vim /etc/profile<br><br><span class="hljs-built_in">export</span> KAFKA_HOME=/app/kafka<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$KAFKA_HOME</span>/bin<br><br><span class="hljs-comment">#ä½¿ä¹‹ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><h3 id="4ã€é…ç½®Kafkaé›†ç¾¤"><a href="#4ã€é…ç½®Kafkaé›†ç¾¤" class="headerlink" title="4ã€é…ç½®Kafkaé›†ç¾¤"></a>4ã€é…ç½®Kafkaé›†ç¾¤</h3><p>åœ¨æ‰€æœ‰KafkaèŠ‚ç‚¹ä¸Šä¿®æ”¹&#x2F;app&#x2F;kafka&#x2F;config&#x2F;server.propertiesæ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /app/kafka/config/server.properties &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br><span class="hljs-string">#brokerçš„å…¨å±€å”¯ä¸€ç¼–å·ï¼Œä¸èƒ½é‡å¤,å„ç¯èŠ‚ä¿®æ”¹ç¼–å·åˆ†åˆ«ä¸ºï¼š0,1,2</span><br><span class="hljs-string">broker.id=0</span><br><span class="hljs-string"># é…ç½®ç›‘å¬</span><br><span class="hljs-string">listeners=PLAINTEXT://192.168.62.129:9092</span><br><span class="hljs-string">advertised.listeners=PLAINTEXT://192.168.62.129:9092</span><br><span class="hljs-string"># å¤„ç†ç½‘ç»œè¯·æ±‚çš„çº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤</span><br><span class="hljs-string">num.network.threads=3</span><br><span class="hljs-string"># ç”¨æ¥å¤„ç†ç£ç›˜IOçš„çº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤</span><br><span class="hljs-string">num.io.threads=8</span><br><span class="hljs-string"># å‘é€å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤</span><br><span class="hljs-string">socket.send.buffer.bytes=102400</span><br><span class="hljs-string"># æ¥æ”¶å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤</span><br><span class="hljs-string">socket.receive.buffer.bytes=102400</span><br><span class="hljs-string"># è¯·æ±‚å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤</span><br><span class="hljs-string">socket.request.max.bytes=104857600</span><br><span class="hljs-string">#æ—¥å¿—æ–‡ä»¶å­˜æ”¾è·¯å¾„</span><br><span class="hljs-string">log.dirs=/tmp/kafka-logs</span><br><span class="hljs-string"># topic åœ¨å½“å‰brokerä¸Šçš„åˆ†ç‰‡ä¸ªæ•°ï¼Œé»˜è®¤ä¸º1</span><br><span class="hljs-string">num.partitions=1</span><br><span class="hljs-string"># ç”¨æ¥æ¢å¤å’Œæ¸…ç†dataä¸‹æ•°æ®çš„çº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤</span><br><span class="hljs-string">num.recovery.threads.per.data.dir=1</span><br><span class="hljs-string"></span><br><span class="hljs-string">offsets.topic.replication.factor=1</span><br><span class="hljs-string">transaction.state.log.replication.factor=1</span><br><span class="hljs-string">transaction.state.log.min.isr=1</span><br><span class="hljs-string"># segmentæ–‡ä»¶ä¿ç•™çš„æœ€é•¿æ—¶é—´ï¼Œè¶…æ—¶å°†è¢«åˆ é™¤ï¼Œé»˜è®¤</span><br><span class="hljs-string">log.retention.hours=168</span><br><span class="hljs-string"></span><br><span class="hljs-string">log.segment.bytes=1073741824</span><br><span class="hljs-string">log.retention.check.interval.ms=300000</span><br><span class="hljs-string"># æ»šåŠ¨ç”Ÿæˆæ–°çš„segmentæ–‡ä»¶çš„æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤</span><br><span class="hljs-string">log.roll.hours=168</span><br><span class="hljs-string"></span><br><span class="hljs-string">zookeeper.connect=kafka1:2181,kafka2:2181,kafka3:2181</span><br><span class="hljs-string">zookeeper.connection.timeout.ms=18000</span><br><span class="hljs-string">group.initial.rebalance.delay.ms=0</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h3 id="5ã€å¯åŠ¨Kafkaé›†ç¾¤"><a href="#5ã€å¯åŠ¨Kafkaé›†ç¾¤" class="headerlink" title="5ã€å¯åŠ¨Kafkaé›†ç¾¤"></a>5ã€å¯åŠ¨Kafkaé›†ç¾¤</h3><p>åœ¨æ‰€æœ‰KafkaèŠ‚ç‚¹ä¸Šå¯åŠ¨Kafka</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">kafka-server-start.sh -daemon /app/kafka/config/server.properties<br><br><span class="hljs-comment">#æŸ¥çœ‹Kafkaè¿›ç¨‹ï¼š</span><br>jps<br></code></pre></td></tr></table></figure><h3 id="6ã€æŸ¥çœ‹é›†ç¾¤æ˜¯å¦åŠ å…¥"><a href="#6ã€æŸ¥çœ‹é›†ç¾¤æ˜¯å¦åŠ å…¥" class="headerlink" title="6ã€æŸ¥çœ‹é›†ç¾¤æ˜¯å¦åŠ å…¥"></a>6ã€æŸ¥çœ‹é›†ç¾¤æ˜¯å¦åŠ å…¥</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿æ¥zookeeper</span><br>zkCli.sh -server localhost:2181<br><br><span class="hljs-built_in">ls</span> /brokers/ids<br><br>è¾“å‡ºï¼š[0, 1, 2]ä»£è¡¨å·²ç»æœ‰ä¸‰ä¸ªèŠ‚ç‚¹åŠ å…¥<br><br><br><span class="hljs-comment">#å®Œå…¨æ¸…ç†kafkaå’Œzookeeperæ•°æ®ï¼š</span><br><span class="hljs-comment">##åœæ­¢kafka</span><br>jps<br><br><span class="hljs-built_in">kill</span> -9 kafkaè¿›ç¨‹ID<br><br><span class="hljs-comment">##ç„¶ååˆ é™¤kafkaæ—¥å¿—ç›®å½•</span><br><span class="hljs-built_in">rm</span> -rf /tmp/kafka-logs<br><br><span class="hljs-comment">##è¿æ¥zookeeper</span><br>zkCli.sh -server localhost:2181<br><br><span class="hljs-comment">##æŸ¥çœ‹æ•°æ®</span><br><span class="hljs-built_in">ls</span> /<br><br><span class="hljs-comment">##åˆ é™¤/ä¸‹çš„æ•°æ®ï¼ˆé™¤zookeeperï¼‰</span><br>rmr /config<br><br></code></pre></td></tr></table></figure><h3 id="7ã€KafkaåŠŸèƒ½æ¼”ç¤º"><a href="#7ã€KafkaåŠŸèƒ½æ¼”ç¤º" class="headerlink" title="7ã€KafkaåŠŸèƒ½æ¼”ç¤º"></a>7ã€KafkaåŠŸèƒ½æ¼”ç¤º</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ›å»ºtopicï¼ˆæŒ‡å®šå‰¯æœ¬æ•°é‡ä¸º3ï¼‰</span><br>kafka-topics.sh --create --bootstrap-server kafka1:9092 --replication-factor 3 --partitions 2 --topic <span class="hljs-built_in">test</span><br><br><span class="hljs-comment">#æŸ¥çœ‹æ‰€æœ‰çš„topicä¿¡æ¯</span><br>kafka-topics.sh --list  --bootstrap-server kafka3:9092<br><br><span class="hljs-comment">#å¯åŠ¨ç”Ÿäº§è€…</span><br>kafka-console-producer.sh --broker-list kafka1:9092,kafka2:9092,kafka3:9092 --topic <span class="hljs-built_in">test</span><br><br><span class="hljs-comment">#å¯åŠ¨æ¶ˆè´¹è€…</span><br>kafka-console-consumer.sh --bootstrap-server kafka2:9092 --topic <span class="hljs-built_in">test</span> --from-beginning<br><br><span class="hljs-comment">#åˆ é™¤topic</span><br>kafka-topics.sh --alter --bootstrap-server kafka2:9092 --topic <span class="hljs-built_in">test</span> --delete-config flush.messages<br><br></code></pre></td></tr></table></figure><h2 id="å››ã€æŠŠzookeeperå’Œkafkaåšæˆç³»ç»ŸæœåŠ¡å¹¶å¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼ˆå¯ä»¥æŠŠä¹‹å‰åœ¨ç»ˆç«¯æ‰§è¡Œçš„å¯åŠ¨å‘½ä»¤å…³äº†ï¼Œä¸ç„¶èµ·ä¸æ¥ï¼‰"><a href="#å››ã€æŠŠzookeeperå’Œkafkaåšæˆç³»ç»ŸæœåŠ¡å¹¶å¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼ˆå¯ä»¥æŠŠä¹‹å‰åœ¨ç»ˆç«¯æ‰§è¡Œçš„å¯åŠ¨å‘½ä»¤å…³äº†ï¼Œä¸ç„¶èµ·ä¸æ¥ï¼‰" class="headerlink" title="å››ã€æŠŠzookeeperå’Œkafkaåšæˆç³»ç»ŸæœåŠ¡å¹¶å¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼ˆå¯ä»¥æŠŠä¹‹å‰åœ¨ç»ˆç«¯æ‰§è¡Œçš„å¯åŠ¨å‘½ä»¤å…³äº†ï¼Œä¸ç„¶èµ·ä¸æ¥ï¼‰"></a>å››ã€æŠŠzookeeperå’Œkafkaåšæˆç³»ç»ŸæœåŠ¡å¹¶å¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼ˆå¯ä»¥æŠŠä¹‹å‰åœ¨ç»ˆç«¯æ‰§è¡Œçš„å¯åŠ¨å‘½ä»¤å…³äº†ï¼Œä¸ç„¶èµ·ä¸æ¥ï¼‰</h2><h3 id="æŠŠzookeeperåšæˆç³»ç»ŸæœåŠ¡"><a href="#æŠŠzookeeperåšæˆç³»ç»ŸæœåŠ¡" class="headerlink" title="æŠŠzookeeperåšæˆç³»ç»ŸæœåŠ¡"></a>æŠŠzookeeperåšæˆç³»ç»ŸæœåŠ¡</h3><h4 id="1ã€è®¾ç½®zookeeperçš„ç¯å¢ƒå˜é‡"><a href="#1ã€è®¾ç½®zookeeperçš„ç¯å¢ƒå˜é‡" class="headerlink" title="1ã€è®¾ç½®zookeeperçš„ç¯å¢ƒå˜é‡"></a>1ã€è®¾ç½®zookeeperçš„ç¯å¢ƒå˜é‡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /home/zk/zookeeper/bin/zkEnv.sh<br><br><span class="hljs-comment">#æ·»åŠ javaç¯å¢ƒå˜é‡,æœåŠ¡å¯åŠ¨æ—¶ä¾èµ–javaç¯å¢ƒï¼Œä¸ç„¶ä¼šå¯åŠ¨ä¸äº†</span><br>JAVA_HOME=/opt/jdk<br><br></code></pre></td></tr></table></figure><h4 id="2ã€åˆ›å»ºzookeeperçš„serviceæ–‡ä»¶"><a href="#2ã€åˆ›å»ºzookeeperçš„serviceæ–‡ä»¶" class="headerlink" title="2ã€åˆ›å»ºzookeeperçš„serviceæ–‡ä»¶"></a>2ã€åˆ›å»ºzookeeperçš„serviceæ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /lib/systemd/system/zookeeper.service <br><br>[Unit]<br>Description=Zookeeper<br>After=network.target remote-fs.target nss-lookup.target<br> <br>[Service]<br>Type=forking<br>ExecStart=/home/zk/zookeeper/bin/zkServer.sh start /home/zk/zookeeper/conf/zoo.cfg<br>ExecReload=/bin/kill -s HUP <span class="hljs-variable">$MAINPID</span><br>ExecStop=/home/zk/zookeeper/bin/zkServer.sh stop<br> <br>[Install]<br>WantedBy=multi-user.target<br><br></code></pre></td></tr></table></figure><h4 id="3ã€å¯åŠ¨zookeeperæœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨"><a href="#3ã€å¯åŠ¨zookeeperæœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨" class="headerlink" title="3ã€å¯åŠ¨zookeeperæœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨"></a>3ã€å¯åŠ¨zookeeperæœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start zookeeper<br>systemctl <span class="hljs-built_in">enable</span> zookeeper<br></code></pre></td></tr></table></figure><h3 id="æŠŠkafkaåšæˆç³»ç»ŸæœåŠ¡"><a href="#æŠŠkafkaåšæˆç³»ç»ŸæœåŠ¡" class="headerlink" title="æŠŠkafkaåšæˆç³»ç»ŸæœåŠ¡"></a>æŠŠkafkaåšæˆç³»ç»ŸæœåŠ¡</h3><h4 id="1ã€åˆ›å»ºkafka-serviceæ–‡ä»¶"><a href="#1ã€åˆ›å»ºkafka-serviceæ–‡ä»¶" class="headerlink" title="1ã€åˆ›å»ºkafka.serviceæ–‡ä»¶"></a>1ã€åˆ›å»ºkafka.serviceæ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /lib/systemd/system/kafka.service<br><br>[Unit]<br>Description=kafka<br>After=network.target remote-fs.target nss-lookup.target zookeeper.service<br> <br>[Service]<br>Type=forking<br>Environment=<span class="hljs-string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/jdk/bin&quot;</span><br>ExecStart=/app/kafka/bin/kafka-server-start.sh -daemon /app/kafka/config/server.properties<br>ExecReload=/bin/kill -s HUP <span class="hljs-variable">$MAINPID</span><br>ExecStop=/app/kafka/bin/kafka-server-stop.sh<br><span class="hljs-comment">#PrivateTmp=true</span><br> <br>[Install]<br>WantedBy=multi-user.target<br><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">[service]<br>Type æœåŠ¡å¯åŠ¨ç±»å‹ï¼Œ forkingï¼šåå°å¯åŠ¨<br>Environment ä¸ºä¾èµ–çš„ç¯å¢ƒï¼Œâ€œ/opt/jdk/binâ€æ˜¯è‡ªå·±jdkçš„å®‰è£…è·¯å¾„<br>ExecStart å®šä¹‰å¯åŠ¨çš„å‘½ä»¤ï¼Œâ€œ/app/kafka/â€ ä¸ºè‡ªå·±çš„kafkaå®‰è£…è·¯å¾„ï¼Œâ€œ-daemonâ€ï¼šåå°å¯åŠ¨<br>ExecReload? å®šä¹‰é‡å¯å‘½ä»¤ï¼Œâ€œ/bin/kill -s HUP <span class="hljs-variable">$MAINPID</span>â€ é€šç”¨é‡å¯å‘½ä»¤<br>ExecStop å®šä¹‰åœæ­¢å‘½ä»¤<br>PrivateTmp æ˜¯å¦åˆ†é…ç‹¬ç«‹ç©ºé—´ï¼Œè‹¥åˆ†é…ï¼Œåˆ™jpså°†æŸ¥ä¸åˆ°ã€‚<br></code></pre></td></tr></table></figure><h4 id="2ã€å¯åŠ¨kafkaæœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨"><a href="#2ã€å¯åŠ¨kafkaæœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨" class="headerlink" title="2ã€å¯åŠ¨kafkaæœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨"></a>2ã€å¯åŠ¨kafkaæœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start kafka<br><br>systemctl <span class="hljs-built_in">enable</span> kafka<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">journalctl -u kafka -f<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Kafka</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kafka</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kafkaå®‰è£…éƒ¨ç½²åŠä½¿ç”¨(å•èŠ‚ç‚¹)</title>
    <link href="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8-%E5%8D%95%E8%8A%82%E7%82%B9/"/>
    <url>/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8-%E5%8D%95%E8%8A%82%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Kafkaå®‰è£…éƒ¨ç½²åŠä½¿ç”¨-å•èŠ‚ç‚¹"><a href="#Kafkaå®‰è£…éƒ¨ç½²åŠä½¿ç”¨-å•èŠ‚ç‚¹" class="headerlink" title="Kafkaå®‰è£…éƒ¨ç½²åŠä½¿ç”¨(å•èŠ‚ç‚¹)"></a>Kafkaå®‰è£…éƒ¨ç½²åŠä½¿ç”¨(å•èŠ‚ç‚¹)</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡çŒ®ï¼šhttps://blog.csdn.net/HG_Harvey/article/details/79174104<br></code></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼šå•èŠ‚ç‚¹å•Brokeréƒ¨ç½²ã€å•èŠ‚ç‚¹å¤šBrokeréƒ¨ç½²ã€é›†ç¾¤éƒ¨ç½²ï¼ˆå¤šèŠ‚ç‚¹å¤šBrokerï¼‰ã€‚å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨çš„æ˜¯ç¬¬ä¸‰ç§æ–¹å¼ï¼Œä»¥é›†ç¾¤çš„æ–¹å¼æ¥éƒ¨ç½²Kafkaã€‚</p><p>æ³¨æ„ï¼šKafkaå¼ºä¾èµ–ZooKeeper(ä»¥ä¸‹ç®€ç§°ZKï¼‰ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨Kafkaï¼Œå°±å¿…é¡»å®‰è£…ZKï¼ŒKafkaä¸­çš„æ¶ˆè´¹åç½®ä¿¡æ¯ã€kafkaé›†ç¾¤ã€topicä¿¡æ¯ä¼šè¢«å­˜å‚¨åœ¨ZKä¸­ã€‚æœ‰äººå¯èƒ½ä¼šè¯´æˆ‘åœ¨ä½¿ç”¨Kafkaçš„æ—¶å€™å°±æ²¡æœ‰å®‰è£…ZKï¼Œé‚£æ˜¯å› ä¸ºKafkaå†…ç½®äº†ä¸€ä¸ªZKï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸ä½¿ç”¨å®ƒ</p><p>Kafkaä¸­å•èŠ‚ç‚¹éƒ¨ç½²åˆåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§ä¸ºå•èŠ‚ç‚¹å•Brokeréƒ¨ç½²ï¼Œä¸€ç§ä¸ºå•èŠ‚ç‚¹å¤šBrokeréƒ¨ç½²ã€‚å› ä¸ºæ˜¯å•èŠ‚ç‚¹çš„Kafkaï¼Œæ‰€ä»¥åœ¨å®‰è£…ZKæ—¶ä¹Ÿåªéœ€è¦å•èŠ‚ç‚¹å³å¯ã€‚</p><p>ZooKeeperå®˜ç½‘ï¼š<a href="http://zookeeper.apache.org/">http://zookeeper.apache.org/</a></p><h2 id="1ã€å®‰è£…Zookeeper-ä¸‹åˆ—ä¸ºå•èŠ‚ç‚¹ï¼Œé›†ç¾¤æ¨¡å¼å¯å‚è€ƒæ–‡æ¡£-lt-Linuxæ­å»ºZookeeperé›†ç¾¤æ­å»º-gt"><a href="#1ã€å®‰è£…Zookeeper-ä¸‹åˆ—ä¸ºå•èŠ‚ç‚¹ï¼Œé›†ç¾¤æ¨¡å¼å¯å‚è€ƒæ–‡æ¡£-lt-Linuxæ­å»ºZookeeperé›†ç¾¤æ­å»º-gt" class="headerlink" title="1ã€å®‰è£…Zookeeper(ä¸‹åˆ—ä¸ºå•èŠ‚ç‚¹ï¼Œé›†ç¾¤æ¨¡å¼å¯å‚è€ƒæ–‡æ¡£&lt;Linuxæ­å»ºZookeeperé›†ç¾¤æ­å»º&gt;)"></a>1ã€å®‰è£…Zookeeper(ä¸‹åˆ—ä¸ºå•èŠ‚ç‚¹ï¼Œé›†ç¾¤æ¨¡å¼å¯å‚è€ƒæ–‡æ¡£&lt;Linuxæ­å»ºZookeeperé›†ç¾¤æ­å»º&gt;)</h2><h3 id="1-1ã€å®‰è£…JDK"><a href="#1-1ã€å®‰è£…JDK" class="headerlink" title="1.1ã€å®‰è£…JDK"></a>1.1ã€å®‰è£…JDK</h3><h3 id="1-2ã€åˆ›å»ºzookeeperç”¨æˆ·-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ"><a href="#1-2ã€åˆ›å»ºzookeeperç”¨æˆ·-é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ" class="headerlink" title="1.2ã€åˆ›å»ºzookeeperç”¨æˆ· (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)"></a>1.2ã€åˆ›å»ºzookeeperç”¨æˆ· (é›†ç¾¤å„èŠ‚ç‚¹å‚ç…§æ‰§è¡Œ)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">useradd zk<br>passwd zk<br>&gt;è¾“å…¥å¯†ç <br><br>su - zk<br></code></pre></td></tr></table></figure><h3 id="1-3ã€ä¸‹è½½Zookeeperæœ€æ–°ç¨³å®šç‰ˆ"><a href="#1-3ã€ä¸‹è½½Zookeeperæœ€æ–°ç¨³å®šç‰ˆ" class="headerlink" title="1.3ã€ä¸‹è½½Zookeeperæœ€æ–°ç¨³å®šç‰ˆ"></a>1.3ã€ä¸‹è½½Zookeeperæœ€æ–°ç¨³å®šç‰ˆ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://mirrors.bfsu.edu.cn/apache/zookeeper/zookeeper-3.5.10/apache-zookeeper-3.5.10-bin.tar.gz --no-check-certificate<br><span class="hljs-comment">#å…¶ä»–ç‰ˆæœ¬ï¼šhttps://mirrors.bfsu.edu.cn/apache/zookeeper</span><br></code></pre></td></tr></table></figure><h3 id="1-4ã€è§£å‹Zookeeperå‹ç¼©åŒ…"><a href="#1-4ã€è§£å‹Zookeeperå‹ç¼©åŒ…" class="headerlink" title="1.4ã€è§£å‹Zookeeperå‹ç¼©åŒ…"></a>1.4ã€è§£å‹Zookeeperå‹ç¼©åŒ…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -xnf apache-zookeeper-3.5.10-bin.tar.gz<br><br><span class="hljs-comment">#è®¾ç½®è½¯é“¾æ¥ï¼š</span><br><span class="hljs-built_in">ln</span> -s apache-zookeeper-3.5.10-bin zookeeper<br></code></pre></td></tr></table></figure><h3 id="1-5ã€ä¿®æ”¹é…ç½®æ–‡ä»¶zoo-cfg"><a href="#1-5ã€ä¿®æ”¹é…ç½®æ–‡ä»¶zoo-cfg" class="headerlink" title="1.5ã€ä¿®æ”¹é…ç½®æ–‡ä»¶zoo.cfg"></a>1.5ã€ä¿®æ”¹é…ç½®æ–‡ä»¶zoo.cfg</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> data<br><span class="hljs-built_in">cd</span> zookeeper/conf<br><span class="hljs-built_in">cp</span> zoo_sample.cfg zoo.cfg<br><br><span class="hljs-comment">#ç¼–è¾‘cfgæ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š</span><br>vim  zoo.cfg<br><br>tickTime=2000<br>initLimit=10<br>syncLimit=5<br>dataDir=/home/zk/data<br></code></pre></td></tr></table></figure><h3 id="1-6ã€å¯åŠ¨ZookeeperæœåŠ¡"><a href="#1-6ã€å¯åŠ¨ZookeeperæœåŠ¡" class="headerlink" title="1.6ã€å¯åŠ¨ZookeeperæœåŠ¡"></a>1.6ã€å¯åŠ¨ZookeeperæœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> ~/zookeeper/bin/<br>./zkServer.sh start<br></code></pre></td></tr></table></figure><h3 id="1-7ã€è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#1-7ã€è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="1.7ã€è®¾ç½®ç¯å¢ƒå˜é‡"></a>1.7ã€è®¾ç½®ç¯å¢ƒå˜é‡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#éœ€åˆ‡æ¢ä¸ºrootç”¨æˆ·</span><br>vim /etc/profile<br><br><span class="hljs-built_in">export</span> ZOOKEEPER_HOME=/home/zk/zookeeper<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ZOOKEEPER_HOME</span>/bin<br><br><span class="hljs-comment">#ä½¿ä¹‹ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> /etc/profile<br><br><span class="hljs-comment">#æµ‹è¯•æ˜¯å¦ç”Ÿæ•ˆ</span><br>zkServer.sh status<br></code></pre></td></tr></table></figure><h2 id="2ã€Kafka-å•èŠ‚ç‚¹å•Brokeréƒ¨ç½²åŠä½¿ç”¨"><a href="#2ã€Kafka-å•èŠ‚ç‚¹å•Brokeréƒ¨ç½²åŠä½¿ç”¨" class="headerlink" title="2ã€Kafka å•èŠ‚ç‚¹å•Brokeréƒ¨ç½²åŠä½¿ç”¨"></a>2ã€Kafka å•èŠ‚ç‚¹å•Brokeréƒ¨ç½²åŠä½¿ç”¨</h2><p>æ¶æ„å›¾ï¼š</p><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8-%E5%8D%95%E8%8A%82%E7%82%B9/image-20221020164316467.png" alt="img"></p><h3 id="2-1ã€ä¸‹è½½Kafka"><a href="#2-1ã€ä¸‹è½½Kafka" class="headerlink" title="2.1ã€ä¸‹è½½Kafka"></a>2.1ã€ä¸‹è½½Kafka</h3><p><code>å®˜ç½‘ä¸‹è½½åœ°å€ï¼šhttp://kafka.apache.org/downloads</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¸‹è½½kafkaå®‰è£…åŒ…</span><br>wget https://dlcdn.apache.org/kafka/3.3.1/kafka_2.13-3.3.1.tgz --no-check-certificate<br><br><span class="hljs-comment">#è§£å‹åˆ°æŒ‡å®šç›®å½•</span><br>tar -xnf kafka_2.13-3.3.1.tgz -C /app/<br><br><span class="hljs-comment">#æ›´åæˆ–è€…è®¾ç½®è½¯é“¾æ¥</span><br><span class="hljs-built_in">mv</span> /app/kafka_2.13-3.3.1 /app/kafka<br></code></pre></td></tr></table></figure><h3 id="2-2ã€é…ç½®kafka"><a href="#2-2ã€é…ç½®kafka" class="headerlink" title="2.2ã€é…ç½®kafka"></a>2.2ã€é…ç½®kafka</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿›å…¥kafkaçš„configç›®å½•ä¸‹ï¼Œå¹¶ä¿®æ”¹server.properties</span><br><span class="hljs-built_in">cd</span> /app/kafak/config/ &amp;&amp; vim server.properties <br><br><span class="hljs-comment"># brokerçš„å…¨å±€å”¯ä¸€ç¼–å·ï¼Œä¸èƒ½é‡å¤</span><br>broker.id=0<br><span class="hljs-comment"># ç›‘å¬ç«¯å£</span><br>listeners=PLAINTEXT://:9092<br><span class="hljs-comment"># æ—¥å¿—ç›®å½•</span><br>log.dirs=/tmp/kafka-logs<br><span class="hljs-comment"># é…ç½®zookeeperçš„è¿æ¥ï¼ˆå¦‚æœä¸æ˜¯æœ¬æœºï¼Œéœ€è¦è¯¥ä¸ºipæˆ–ä¸»æœºåï¼‰</span><br>zookeeper.connect=localhost:2181<br><br></code></pre></td></tr></table></figure><h3 id="2-3ã€å¯åŠ¨zookeeperå’Œkafka"><a href="#2-3ã€å¯åŠ¨zookeeperå’Œkafka" class="headerlink" title="2.3ã€å¯åŠ¨zookeeperå’Œkafka"></a>2.3ã€å¯åŠ¨zookeeperå’Œkafka</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¯åŠ¨zookeeper</span><br>zkServer.sh start<br><br><span class="hljs-comment">#å¯åŠ¨kafka</span><br>/app/kafka/bin/kafka-server-start.sh /app/kafka/config/server.properties<br><br><span class="hljs-comment"># åå°å¯åŠ¨æœåŠ¡ , è¿è¡Œçš„æ—¥å¿—æ‰“å°åœ¨ logs ç›®å½•é‡Œçš„server.log é‡Œï¼Œä¸ä¼šæ‰“å°æ—¥å¿—åˆ°æ§åˆ¶å°</span><br><span class="hljs-comment">#æ–¹æ³•1ï¼š</span><br>bin/kafka-server-start.sh -daemon config/server.properties<br><span class="hljs-comment">#æ–¹æ³•2ï¼š</span><br>bin/kafkaâ€serverâ€start.sh config/server.properties &amp;<br><br><span class="hljs-comment">#åœæ­¢kafka</span><br>bin/kafkaâ€serverâ€stop.sh<br><br><span class="hljs-comment">#è¾“å…¥jpsæŸ¥çœ‹è¿›ç¨‹ï¼Œå¦‚æœå¯ä»¥çœ‹åˆ°Kafkaè¿›ç¨‹ï¼Œè¡¨ç¤ºå¯åŠ¨æˆåŠŸ</span><br>jps<br></code></pre></td></tr></table></figure><h3 id="2-4ã€æµ‹è¯•"><a href="#2-4ã€æµ‹è¯•" class="headerlink" title="2.4ã€æµ‹è¯•"></a>2.4ã€æµ‹è¯•</h3><p><code>å‚è€ƒå®˜ç½‘ï¼šhttps://kafka.apache.org/30/documentation.html#quickstart</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /app/kafka<br><br><span class="hljs-comment">#åˆ›å»ºtopic</span><br>bin/kafka-topics.sh --create --topic test-topic --bootstrap-server localhost:9092 --replication-factor 1 --partitions 4<br><br><span class="hljs-comment">#å‚æ•°è¯¦è§£ï¼š</span><br>--bootstrap-server: æŒ‡å®škafkaè¿æ¥url<br>â€“-replication-factorï¼šæŒ‡å®šå‰¯æœ¬æ•°é‡<br>â€“-partitionsï¼šæŒ‡å®šåˆ†åŒºæ•°é‡<br>â€“-topicï¼šä¸»é¢˜åç§°<br><br><span class="hljs-comment">#æŸ¥çœ‹æ‰€æœ‰çš„topicä¿¡æ¯</span><br>bin/kafka-topics.sh --list  --bootstrap-server localhost:9092<br><span class="hljs-comment">#----------è¾“å‡ºå†…å®¹-------------</span><br>test-topic<br><br><span class="hljs-comment">#å¯åŠ¨ç”Ÿäº§è€…</span><br>bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test-topic<br>&gt;hello,word<br><br><br><span class="hljs-comment">#å¯åŠ¨æ¶ˆè´¹è€…</span><br>bin/kafka-console-consumer.sh  --topic test-topic --from-beginning --bootstrap-server localhost:9092<br><span class="hljs-comment">#----------è¾“å‡ºå†…å®¹-------------</span><br>hello,word<br><br><span class="hljs-comment">#å‚æ•°è¯¦è§£ï¼š</span><br>--from-beginningï¼šå‚æ•°å¦‚æœæœ‰è¡¨ç¤ºä»æœ€å¼€å§‹æ¶ˆè´¹æ•°æ®ï¼Œæ—§çš„å’Œæ–°çš„æ•°æ®éƒ½ä¼šè¢«æ¶ˆè´¹ï¼Œè€Œæ²¡æœ‰è¯¥å‚æ•°è¡¨ç¤ºåªä¼šæ¶ˆè´¹æ–°äº§ç”Ÿçš„æ•°æ®<br></code></pre></td></tr></table></figure><h2 id="3ã€Kafka-å•èŠ‚ç‚¹å¤šBrokeréƒ¨ç½²åŠä½¿ç”¨"><a href="#3ã€Kafka-å•èŠ‚ç‚¹å¤šBrokeréƒ¨ç½²åŠä½¿ç”¨" class="headerlink" title="3ã€Kafka å•èŠ‚ç‚¹å¤šBrokeréƒ¨ç½²åŠä½¿ç”¨"></a>3ã€Kafka å•èŠ‚ç‚¹å¤šBrokeréƒ¨ç½²åŠä½¿ç”¨</h2><p>éƒ¨ç½²æ¶æ„<br><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8-%E5%8D%95%E8%8A%82%E7%82%B9/image-20221020164810461.png" alt="image-20221020164810461"></p><h3 id="3-1ã€æŒ‰ç…§2-1æ­¥éª¤ä¸‹è½½å¹¶è§£å‹kafkaåï¼Œæ‹·è´server-propertiesä¸‰ä»½"><a href="#3-1ã€æŒ‰ç…§2-1æ­¥éª¤ä¸‹è½½å¹¶è§£å‹kafkaåï¼Œæ‹·è´server-propertiesä¸‰ä»½" class="headerlink" title="3.1ã€æŒ‰ç…§2.1æ­¥éª¤ä¸‹è½½å¹¶è§£å‹kafkaåï¼Œæ‹·è´server.propertiesä¸‰ä»½"></a>3.1ã€æŒ‰ç…§2.1æ­¥éª¤ä¸‹è½½å¹¶è§£å‹kafkaåï¼Œæ‹·è´server.propertiesä¸‰ä»½</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /app/kafka/config/<br><span class="hljs-built_in">cp</span> server.properties server-1.properties<br><span class="hljs-built_in">cp</span> server.properties server-2.properties<br><span class="hljs-built_in">cp</span> server.properties server-3.properties<br></code></pre></td></tr></table></figure><h3 id="3-2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#3-2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="3.2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>3.2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim server-1.properties<br><br><span class="hljs-comment"># brokerçš„å…¨å±€å”¯ä¸€ç¼–å·ï¼Œä¸èƒ½é‡å¤</span><br>broker.id=1<br><span class="hljs-comment"># ç›‘å¬</span><br>listeners=PLAINTEXT://:9093<br><span class="hljs-comment"># æ—¥å¿—ç›®å½•</span><br>log.dirs=/tmp/kafka-logs-1<br><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim server-2.properties<br><br><span class="hljs-comment"># brokerçš„å…¨å±€å”¯ä¸€ç¼–å·ï¼Œä¸èƒ½é‡å¤</span><br>broker.id=2<br><span class="hljs-comment"># ç›‘å¬</span><br>listeners=PLAINTEXT://:9094<br><span class="hljs-comment"># æ—¥å¿—ç›®å½•</span><br>log.dirs=/tmp/kafka-logs-2<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim server-3.properties<br><br><span class="hljs-comment"># brokerçš„å…¨å±€å”¯ä¸€ç¼–å·ï¼Œä¸èƒ½é‡å¤</span><br>broker.id=3<br><span class="hljs-comment"># ç›‘å¬</span><br>listeners=PLAINTEXT://:9095<br><span class="hljs-comment"># æ—¥å¿—ç›®å½•</span><br>log.dirs=/tmp/kafka-logs-3<br></code></pre></td></tr></table></figure><h3 id="3-3ã€å¯åŠ¨Zookeeper"><a href="#3-3ã€å¯åŠ¨Zookeeper" class="headerlink" title="3.3ã€å¯åŠ¨Zookeeper"></a>3.3ã€å¯åŠ¨Zookeeper</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">zkServer.sh start<br></code></pre></td></tr></table></figure><h3 id="3-4ã€å¯åŠ¨Kafkaï¼ˆåˆ†åˆ«å¯åŠ¨server1ã€2ã€3ï¼‰"><a href="#3-4ã€å¯åŠ¨Kafkaï¼ˆåˆ†åˆ«å¯åŠ¨server1ã€2ã€3ï¼‰" class="headerlink" title="3.4ã€å¯åŠ¨Kafkaï¼ˆåˆ†åˆ«å¯åŠ¨server1ã€2ã€3ï¼‰"></a>3.4ã€å¯åŠ¨Kafkaï¼ˆåˆ†åˆ«å¯åŠ¨server1ã€2ã€3ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /app/kafka<br><br>bin/kafka-server-start.sh -daemon config/server-1.properties<br>bin/kafka-server-start.sh -daemon config/server-2.properties<br>bin/kafka-server-start.sh -daemon config/server-3.properties<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æŸ¥çœ‹ç«¯å£æ˜¯å¦å ç”¨</span><br>netstat -lntup| grep java | grep 909<br><span class="hljs-comment">#å‡ºç°9003ã€9004ã€9005ç«¯å£</span><br><span class="hljs-comment">#æŸ¥çœ‹è¿›ç¨‹</span><br>jps -m<br></code></pre></td></tr></table></figure><h3 id="3-5ã€åˆ›å»ºtopicï¼ˆæŒ‡å®šå‰¯æœ¬æ•°é‡ä¸º3ï¼‰"><a href="#3-5ã€åˆ›å»ºtopicï¼ˆæŒ‡å®šå‰¯æœ¬æ•°é‡ä¸º3ï¼‰" class="headerlink" title="3.5ã€åˆ›å»ºtopicï¼ˆæŒ‡å®šå‰¯æœ¬æ•°é‡ä¸º3ï¼‰"></a>3.5ã€åˆ›å»ºtopicï¼ˆæŒ‡å®šå‰¯æœ¬æ•°é‡ä¸º3ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">bin/kafka-topics.sh --create --bootstrap-server localhost:9093 --replication-factor 3 --partitions 1 --topic my-replicated-topic<br><br><span class="hljs-comment">#è¾“å‡ºCreated topic my-replicated-topic.</span><br></code></pre></td></tr></table></figure><h3 id="3-6ã€æŸ¥çœ‹æ‰€æœ‰çš„topicä¿¡æ¯"><a href="#3-6ã€æŸ¥çœ‹æ‰€æœ‰çš„topicä¿¡æ¯" class="headerlink" title="3.6ã€æŸ¥çœ‹æ‰€æœ‰çš„topicä¿¡æ¯"></a>3.6ã€æŸ¥çœ‹æ‰€æœ‰çš„topicä¿¡æ¯</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">bin/kafka-topics.sh --list  --bootstrap-server localhost:9093<br><br><span class="hljs-comment">#æŸ¥çœ‹æŸä¸ªtopicçš„è¯¦ç»†ä¿¡æ¯</span><br><br>bin/kafka-topics.sh --describe --bootstrap-server localhost:9093 --topic my-replicated-topic<br></code></pre></td></tr></table></figure><h3 id="3-7ã€å¯åŠ¨ç”Ÿäº§è€…"><a href="#3-7ã€å¯åŠ¨ç”Ÿäº§è€…" class="headerlink" title="3.7ã€å¯åŠ¨ç”Ÿäº§è€…"></a>3.7ã€å¯åŠ¨ç”Ÿäº§è€…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">bin/kafka-console-producer.sh --broker-list localhost:9093,localhost:9094,localhost:9095 --topic my-replicated-topic<br></code></pre></td></tr></table></figure><h3 id="3-8ã€å¯åŠ¨æ¶ˆè´¹è€…"><a href="#3-8ã€å¯åŠ¨æ¶ˆè´¹è€…" class="headerlink" title="3.8ã€å¯åŠ¨æ¶ˆè´¹è€…"></a>3.8ã€å¯åŠ¨æ¶ˆè´¹è€…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">bin/kafka-console-consumer.sh --bootstrap-server localhost:9093 --topic my-replicated-topic --from-beginning<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">kafkaå…¨éƒ¨æ•°æ®æ¸…ç©ºä¸æŸä¸€topicæ•°æ®æ¸…ç©ºï¼šhttps://blog.csdn.net/wutongyuWxc/article/details/104546169<br>Kafkaå›¾å½¢åŒ–å·¥å…·Eagle:https://juejin.cn/post/6971224791793532941<br>kafkaå¯è§†åŒ–å®¢æˆ·ç«¯ https://www.studytime.xin/article/kafka-tool.html<br></code></pre></td></tr></table></figure><h3 id="3-9ã€å•èŠ‚ç‚¹å¤šborkerå®¹é”™æ€§æµ‹è¯•"><a href="#3-9ã€å•èŠ‚ç‚¹å¤šborkerå®¹é”™æ€§æµ‹è¯•" class="headerlink" title="3.9ã€å•èŠ‚ç‚¹å¤šborkerå®¹é”™æ€§æµ‹è¯•"></a>3.9ã€å•èŠ‚ç‚¹å¤šborkerå®¹é”™æ€§æµ‹è¯•</h3><p>Kafkaæ˜¯æ”¯æŒå®¹é”™çš„ï¼Œä¸Šé¢æˆ‘ä»¬å·²ç»å®Œæˆäº†Kafkaå•èŠ‚ç‚¹å¤šBlockerçš„éƒ¨ç½²ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å¯¹Kafkaçš„å®¹é”™æ€§è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•æ­¥éª¤å¦‚ä¸‹:</p><h4 id="éªŒè¯ä¸€ï¼škillæ‰çŠ¶æ€æ˜¯followerçš„borkeråï¼Œæµ‹è¯•ç”Ÿäº§å’Œæ¶ˆè´¹çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®"><a href="#éªŒè¯ä¸€ï¼škillæ‰çŠ¶æ€æ˜¯followerçš„borkeråï¼Œæµ‹è¯•ç”Ÿäº§å’Œæ¶ˆè´¹çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®" class="headerlink" title="éªŒè¯ä¸€ï¼škillæ‰çŠ¶æ€æ˜¯followerçš„borkeråï¼Œæµ‹è¯•ç”Ÿäº§å’Œæ¶ˆè´¹çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®"></a>éªŒè¯ä¸€ï¼škillæ‰çŠ¶æ€æ˜¯followerçš„borkeråï¼Œæµ‹è¯•ç”Ÿäº§å’Œæ¶ˆè´¹çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®</h4><h5 id="1-æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯"><a href="#1-æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯" class="headerlink" title="(1)æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯"></a>(1)æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">bin/kafka-topics.sh --describe --topic my-replicated-topic --bootstrap-server localhost:9093<br><br><span class="hljs-comment">#è¾“å‡ºä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°3ä¸ºleader, 1å’Œ2ä¸ºfollower</span><br></code></pre></td></tr></table></figure><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8-%E5%8D%95%E8%8A%82%E7%82%B9/image-20221020152107702.png" alt="image-20221020152107702"></p><h5 id="2-killæ‰çŠ¶æ€æ˜¯followerçš„borkerï¼ˆæˆ‘è¿™å°†followerä¸º1çš„è¿›ç¨‹killæ‰ï¼‰ï¼Œæµ‹è¯•ç”Ÿæˆå’Œæ¶ˆè´¹ä¿¡æ¯æ˜¯å¦æ­£ç¡®"><a href="#2-killæ‰çŠ¶æ€æ˜¯followerçš„borkerï¼ˆæˆ‘è¿™å°†followerä¸º1çš„è¿›ç¨‹killæ‰ï¼‰ï¼Œæµ‹è¯•ç”Ÿæˆå’Œæ¶ˆè´¹ä¿¡æ¯æ˜¯å¦æ­£ç¡®" class="headerlink" title="(2)killæ‰çŠ¶æ€æ˜¯followerçš„borkerï¼ˆæˆ‘è¿™å°†followerä¸º1çš„è¿›ç¨‹killæ‰ï¼‰ï¼Œæµ‹è¯•ç”Ÿæˆå’Œæ¶ˆè´¹ä¿¡æ¯æ˜¯å¦æ­£ç¡®"></a>(2)killæ‰çŠ¶æ€æ˜¯followerçš„borkerï¼ˆæˆ‘è¿™å°†followerä¸º1çš„è¿›ç¨‹killæ‰ï¼‰ï¼Œæµ‹è¯•ç”Ÿæˆå’Œæ¶ˆè´¹ä¿¡æ¯æ˜¯å¦æ­£ç¡®</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯</span><br>jps -m<br><br><span class="hljs-built_in">kill</span> -9 è¿›ç¨‹<span class="hljs-built_in">id</span><br></code></pre></td></tr></table></figure><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8-%E5%8D%95%E8%8A%82%E7%82%B9/image-20221020152801513.png" alt="image-20221020152801513"></p><h5 id="3-å¯åŠ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œæµ‹è¯•ä¿¡æ¯æ˜¯å¦æ­£ç¡®"><a href="#3-å¯åŠ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œæµ‹è¯•ä¿¡æ¯æ˜¯å¦æ­£ç¡®" class="headerlink" title="(3)å¯åŠ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œæµ‹è¯•ä¿¡æ¯æ˜¯å¦æ­£ç¡®"></a>(3)å¯åŠ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œæµ‹è¯•ä¿¡æ¯æ˜¯å¦æ­£ç¡®</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¯åŠ¨ç”Ÿäº§è€…</span><br>bin/kafka-console-producer.sh --broker-list localhost:9093,localhost:9094,localhost:9095 --topic my-replicated-topic<br></code></pre></td></tr></table></figure><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8-%E5%8D%95%E8%8A%82%E7%82%B9/image-20221020153446152.png" alt="image-20221020153446152"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¯åŠ¨æ¶ˆè´¹è€…</span><br>bin/kafka-console-consumer.sh --bootstrap-server localhost:9094 --topic my-replicated-topic --from-beginning<br></code></pre></td></tr></table></figure><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8-%E5%8D%95%E8%8A%82%E7%82%B9/image-20221020153601755.png" alt="image-20221020153601755"></p><p><strong>ç»“è®ºï¼škillæ‰ä»»æ„ä¸€ä¸ªçŠ¶æ€æ˜¯followerçš„brokerï¼Œç”Ÿæˆå’Œæ¶ˆè´¹ä¿¡æ¯æ­£ç¡®ï¼Œä¸å—ä»»ä½•å½±å“</strong></p><h4 id="éªŒè¯äºŒï¼škillæ‰çŠ¶æ€æ˜¯Leaderçš„borkeråï¼Œæµ‹è¯•ç”Ÿäº§å’Œæ¶ˆè´¹çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®"><a href="#éªŒè¯äºŒï¼škillæ‰çŠ¶æ€æ˜¯Leaderçš„borkeråï¼Œæµ‹è¯•ç”Ÿäº§å’Œæ¶ˆè´¹çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®" class="headerlink" title="éªŒè¯äºŒï¼škillæ‰çŠ¶æ€æ˜¯Leaderçš„borkeråï¼Œæµ‹è¯•ç”Ÿäº§å’Œæ¶ˆè´¹çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®"></a>éªŒè¯äºŒï¼škillæ‰çŠ¶æ€æ˜¯Leaderçš„borkeråï¼Œæµ‹è¯•ç”Ÿäº§å’Œæ¶ˆè´¹çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®</h4><h5 id="1-æŸ¥çœ‹topicè¯¦ç»†ä¿¡æ¯ï¼Œå¹¶killæ‰çŠ¶æ€ä¸ºleaderçš„borker"><a href="#1-æŸ¥çœ‹topicè¯¦ç»†ä¿¡æ¯ï¼Œå¹¶killæ‰çŠ¶æ€ä¸ºleaderçš„borker" class="headerlink" title="(1)æŸ¥çœ‹topicè¯¦ç»†ä¿¡æ¯ï¼Œå¹¶killæ‰çŠ¶æ€ä¸ºleaderçš„borker"></a>(1)æŸ¥çœ‹topicè¯¦ç»†ä¿¡æ¯ï¼Œå¹¶killæ‰çŠ¶æ€ä¸ºleaderçš„borker</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">bin/kafka-topics.sh --describe --topic my-replicated-topic --bootstrap-server localhost:9094<br></code></pre></td></tr></table></figure><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8-%E5%8D%95%E8%8A%82%E7%82%B9/image-20221020160243454.png" alt="image-20221020160243454"></p><h5 id="2-å¯åŠ¨ç”Ÿäº§å’Œæ¶ˆè´¹è€…æµ‹è¯•ä¿¡æ¯æ˜¯å¦æ­£ç¡®"><a href="#2-å¯åŠ¨ç”Ÿäº§å’Œæ¶ˆè´¹è€…æµ‹è¯•ä¿¡æ¯æ˜¯å¦æ­£ç¡®" class="headerlink" title="(2)å¯åŠ¨ç”Ÿäº§å’Œæ¶ˆè´¹è€…æµ‹è¯•ä¿¡æ¯æ˜¯å¦æ­£ç¡®"></a>(2)å¯åŠ¨ç”Ÿäº§å’Œæ¶ˆè´¹è€…æµ‹è¯•ä¿¡æ¯æ˜¯å¦æ­£ç¡®</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¯åŠ¨ç”Ÿäº§è€…</span><br>bin/kafka-console-producer.sh --broker-list localhost:9093,localhost:9094,localhost:9095 --topic my-replicated-topic<br></code></pre></td></tr></table></figure><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8-%E5%8D%95%E8%8A%82%E7%82%B9/image-20221020161457496.png" alt="image-20221020161457496"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¯åŠ¨æ¶ˆè´¹è€…</span><br>bin/kafka-console-consumer.sh --bootstrap-server localhost:9094 --topic my-replicated-topic --from-beginning<br></code></pre></td></tr></table></figure><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8-%E5%8D%95%E8%8A%82%E7%82%B9/image-20221020161607599.png" alt="image-20221020161607599"></p><p><strong>ç»“è®ºï¼škillæ‰çŠ¶æ€æ˜¯leaderçš„borkerï¼Œç”Ÿäº§å’Œæ¶ˆè´¹çš„ä¿¡æ¯æ­£ç¡®</strong></p><p><strong>æ ¹æ®éªŒè¯ä¸€å’ŒéªŒè¯äºŒç»“æœå¾—çŸ¥ï¼šä¸ç®¡å½“å‰çŠ¶æ€çš„borkeræ˜¯leaderè¿˜æ˜¯followerï¼Œå½“æˆ‘ä»¬killæ‰åï¼Œåªè¦æœ‰ä¸€ä¸ªborkerèƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ï¼Œåˆ™æ¶ˆæ¯ä»ç„¶èƒ½å¤Ÿæ­£å¸¸çš„ç”Ÿäº§å’Œå‘é€ã€‚å³Kafkaçš„å®¹é”™æ€§æ˜¯æœ‰ä¿è¯çš„ï¼</strong></p>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Kafka</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kafka</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerå¯åŠ¨elasticsearch.md</title>
    <link href="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/elasticsearch/docker%E5%90%AF%E5%8A%A8elasticsearch/"/>
    <url>/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/elasticsearch/docker%E5%90%AF%E5%8A%A8elasticsearch/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="dockerå¯åŠ¨elasticsearch-md"><a href="#dockerå¯åŠ¨elasticsearch-md" class="headerlink" title="dockerå¯åŠ¨elasticsearch.md"></a>dockerå¯åŠ¨elasticsearch.md</h1><h2 id="ä¸€ã€ä¿®æ”¹ä¸»æœºé…ç½®å‚æ•°"><a href="#ä¸€ã€ä¿®æ”¹ä¸»æœºé…ç½®å‚æ•°" class="headerlink" title="ä¸€ã€ä¿®æ”¹ä¸»æœºé…ç½®å‚æ•°"></a>ä¸€ã€ä¿®æ”¹ä¸»æœºé…ç½®å‚æ•°</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/sysctl.conf<br>vm.max_map_count=262144<br><br><span class="hljs-comment">#ç”Ÿæ•ˆ</span><br>sysctl -p<br><br>vim /etc/systemd/system.conf<br><br>DefaultLimitNOFILE=65536<br>DefaultLimitNPROC=32000<br>DefaultLimitMEMLOCK=infinity<br><br><span class="hljs-comment">#ç”Ÿæ•ˆ</span><br>systemctl daemon-reload<br><br>vim /etc/security/limits.conf<br><br>* soft nofile 65536<br>* hard nofile 65536<br>* soft <span class="hljs-built_in">nproc</span> 4096<br>* hard <span class="hljs-built_in">nproc</span> 4096<br>* hard memlock unlimited<br>* soft memlock unlimited<br><br></code></pre></td></tr></table></figure><h2 id="äºŒã€å¯åŠ¨-elasticsearch"><a href="#äºŒã€å¯åŠ¨-elasticsearch" class="headerlink" title="äºŒã€å¯åŠ¨ elasticsearch"></a>äºŒã€å¯åŠ¨ elasticsearch</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /data/elasticsearch/data<br><span class="hljs-built_in">mkdir</span> -p /data/elasticsearch/logs<br><span class="hljs-built_in">chmod</span> -R 777 /data/elasticsearch/data<br><span class="hljs-built_in">chmod</span> -R 777 /data/elasticsearch/logs<br>docker run -d --name=es7 \<br>  --restart=always \<br>  -p 9200:9200 -p 9300:9300 \<br>  -e <span class="hljs-string">&quot;discovery.type=single-node&quot;</span> \<br>  -v /data/elasticsearch/data:/usr/share/elasticsearch/data \<br>  -v /data/elasticsearch/logs:/usr/share/elasticsearch/logs \<br>elasticsearch:7.10.1<br><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d --name es_test \<br>-p 9200:9200 -p 9300:9300 \<br>-v /app/es/esdata:/data/elasticsearch/data \<br>-v /app/es/conf/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml \<br>-e ES_JAVA_OPTS=<span class="hljs-string">&quot;-Xms300m -Xmx300m&quot;</span> -e <span class="hljs-string">&quot;discovery.type=single-node&quot;</span>  ikpinyin:5.6.1<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>elasticsearch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>es</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ElasticSearchå®‰è£…å’Œè¾…åŠ©æ’ä»¶å®‰è£…</title>
    <link href="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/elasticsearch/ElasticSearch%E5%AE%89%E8%A3%85%E5%92%8C%E8%BE%85%E5%8A%A9%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/"/>
    <url>/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/elasticsearch/ElasticSearch%E5%AE%89%E8%A3%85%E5%92%8C%E8%BE%85%E5%8A%A9%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ElasticSearchå®‰è£…å’Œè¾…åŠ©æ’ä»¶å®‰è£…"><a href="#ElasticSearchå®‰è£…å’Œè¾…åŠ©æ’ä»¶å®‰è£…" class="headerlink" title="ElasticSearchå®‰è£…å’Œè¾…åŠ©æ’ä»¶å®‰è£…"></a>ElasticSearchå®‰è£…å’Œè¾…åŠ©æ’ä»¶å®‰è£…</h1><h2 id="ä¸€ã€ElasticSearch-å®‰è£…"><a href="#ä¸€ã€ElasticSearch-å®‰è£…" class="headerlink" title="ä¸€ã€ElasticSearch å®‰è£…"></a>ä¸€ã€ElasticSearch å®‰è£…</h2><h3 id="1ã€ä¸‹è½½ElasticSearchå®‰è£…åŒ…"><a href="#1ã€ä¸‹è½½ElasticSearchå®‰è£…åŒ…" class="headerlink" title="1ã€ä¸‹è½½ElasticSearchå®‰è£…åŒ…"></a>1ã€ä¸‹è½½ElasticSearchå®‰è£…åŒ…</h3><p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.elastic.co/cn/downloads/elasticsearch">https://www.elastic.co/cn/downloads/elasticsearch</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ä¸‹è½½eså®‰è£…åŒ…</span><br>wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.4.0-linux-x86_64.tar.gz<br></code></pre></td></tr></table></figure><h3 id="2ã€æ‰§è¡Œè§£å‹æ“ä½œ"><a href="#2ã€æ‰§è¡Œè§£å‹æ“ä½œ" class="headerlink" title="2ã€æ‰§è¡Œè§£å‹æ“ä½œ"></a>2ã€æ‰§è¡Œè§£å‹æ“ä½œ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># å°†elasticsearch-7.4.0-linux-x86_64.tar.gzè§£å‹åˆ°optæ–‡ä»¶å¤¹ä¸‹. -C å¤§å†™</span><br>tar -zxvf elasticsearch-7.4.0-linux-x86_64.tar.gz  -C /opt<br></code></pre></td></tr></table></figure><h3 id="3ã€åˆ›å»ºæ™®é€šç”¨æˆ·"><a href="#3ã€åˆ›å»ºæ™®é€šç”¨æˆ·" class="headerlink" title="3ã€åˆ›å»ºæ™®é€šç”¨æˆ·"></a>3ã€åˆ›å»ºæ™®é€šç”¨æˆ·</h3><p>å› ä¸ºå®‰å…¨é—®é¢˜ï¼ŒElasticsearch ä¸å…è®¸rootç”¨æˆ·ç›´æ¥è¿è¡Œï¼Œæ‰€ä»¥è¦åˆ›å»ºæ–°ç”¨æˆ·ï¼Œåœ¨rootç”¨æˆ·ä¸­åˆ›å»ºæ–°ç”¨æˆ·,æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">useradd itheima  <span class="hljs-comment"># æ–°å¢itheimaç”¨æˆ·</span><br>passwd  itheima  <span class="hljs-comment"># ä¸ºitheimaç”¨æˆ·è®¾ç½®å¯†ç </span><br></code></pre></td></tr></table></figure><h3 id="4ã€ä¸ºæ–°ç”¨æˆ·æˆæƒï¼Œå¦‚ä¸‹å›¾"><a href="#4ã€ä¸ºæ–°ç”¨æˆ·æˆæƒï¼Œå¦‚ä¸‹å›¾" class="headerlink" title="4ã€ä¸ºæ–°ç”¨æˆ·æˆæƒï¼Œå¦‚ä¸‹å›¾"></a>4ã€ä¸ºæ–°ç”¨æˆ·æˆæƒï¼Œå¦‚ä¸‹å›¾</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">chown</span> -R itheima:itheima /opt/elasticsearch-7.4.0 <span class="hljs-comment">#æ–‡ä»¶å¤¹æ‰€æœ‰è€…</span><br></code></pre></td></tr></table></figure><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/elasticsearch/ElasticSearch%E5%AE%89%E8%A3%85%E5%92%8C%E8%BE%85%E5%8A%A9%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/2226570-20210326181350582-2125565058.png" alt="img"></p><p>å°† &#x2F;opt&#x2F;elasticsearch-7.4.0æ–‡ä»¶å¤¹æˆæƒç»™itheimaç”¨æˆ·ï¼Œç”±ä¸Šå›¾å¯è§ï¼Œæˆ‘ä»¬çš„æ–‡ä»¶å¤¹æƒé™èµ‹ç»™äº†itheima</p><h3 id="5ã€ä¿®æ”¹elasticsearch-ymlæ–‡ä»¶"><a href="#5ã€ä¿®æ”¹elasticsearch-ymlæ–‡ä»¶" class="headerlink" title="5ã€ä¿®æ”¹elasticsearch.ymlæ–‡ä»¶"></a>5ã€ä¿®æ”¹elasticsearch.ymlæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /opt/elasticsearch-7.4.0/config/elasticsearch.yml <br><span class="hljs-comment"># ======================== Elasticsearch Configuration =========================</span><br>cluster.name: my-application<br>node.name: node-1<br>network.host: 0.0.0.0<br>http.port: 9200<br>cluster.initial_master_nodes: [<span class="hljs-string">&quot;node-1&quot;</span>]<br></code></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs txt">cluster.nameï¼šé…ç½®elasticsearchçš„é›†ç¾¤åç§°ï¼Œé»˜è®¤æ˜¯elasticsearchã€‚å»ºè®®ä¿®æ”¹æˆä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°<br>node.nameï¼šèŠ‚ç‚¹åï¼Œelasticsearchä¼šé»˜è®¤éšæœºæŒ‡å®šä¸€ä¸ªåå­—ï¼Œå»ºè®®æŒ‡å®šä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°ï¼Œæ–¹ä¾¿ç®¡ç†<br>network.hostï¼šè®¾ç½®ä¸º0.0.0.0å…è®¸å¤–ç½‘è®¿é—®<br>http.portï¼šElasticsearchçš„httpè®¿é—®ç«¯å£<br>cluster.initial_master_nodesï¼šåˆå§‹åŒ–æ–°çš„é›†ç¾¤æ—¶éœ€è¦æ­¤é…ç½®æ¥é€‰ä¸¾master<br></code></pre></td></tr></table></figure><h3 id="6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p>æ–°åˆ›å»ºçš„itheimaç”¨æˆ·æœ€å¤§å¯åˆ›å»ºæ–‡ä»¶æ•°å¤ªå°ï¼Œæœ€å¤§è™šæ‹Ÿå†…å­˜å¤ªå°ï¼Œåˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œç¼–è¾‘ä¸‹åˆ—é…ç½®æ–‡ä»¶ï¼Œ æ·»åŠ ç±»ä¼¼å¦‚ä¸‹å†…å®¹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># åˆ‡æ¢åˆ°rootç”¨æˆ·</span><br>su root <br><br><span class="hljs-comment">#1. ===æœ€å¤§å¯åˆ›å»ºæ–‡ä»¶æ•°å¤ªå°=======</span><br>vim /etc/security/limits.conf <br><span class="hljs-comment"># åœ¨æ–‡ä»¶æœ«å°¾ä¸­å¢åŠ ä¸‹é¢å†…å®¹</span><br>itheima soft nofile 65536<br>itheima hard nofile 65536<br><br>vim /etc/security/limits.d/20-nproc.conf<br><span class="hljs-comment"># åœ¨æ–‡ä»¶æœ«å°¾ä¸­å¢åŠ ä¸‹é¢å†…å®¹</span><br>itheima soft nofile 65536<br>itheima hard nofile 65536<br>*  hard    <span class="hljs-built_in">nproc</span>     4096<br><span class="hljs-comment"># æ³¨ï¼š* ä»£è¡¨Linuxæ‰€æœ‰ç”¨æˆ·åç§° </span><br><br><span class="hljs-comment">#2. ===æœ€å¤§è™šæ‹Ÿå†…å­˜å¤ªå°=======</span><br>vim /etc/sysctl.conf<br><span class="hljs-comment"># åœ¨æ–‡ä»¶ä¸­å¢åŠ ä¸‹é¢å†…å®¹</span><br>vm.max_map_count=655360<br><br><span class="hljs-comment"># é‡æ–°åŠ è½½ï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤ï¼š</span><br>sysctl -p<br></code></pre></td></tr></table></figure><h3 id="7ã€å¯åŠ¨elasticsearch"><a href="#7ã€å¯åŠ¨elasticsearch" class="headerlink" title="7ã€å¯åŠ¨elasticsearch"></a>7ã€å¯åŠ¨elasticsearch</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#switch user</span><br>su itheima  <span class="hljs-comment"># åˆ‡æ¢åˆ°itheimaç”¨æˆ·å¯åŠ¨</span><br><span class="hljs-built_in">cd</span> /opt/elasticsearch-7.4.0/bin<br>./elasticsearch <span class="hljs-comment">#å¯åŠ¨</span><br>./elasticsearch -d  <span class="hljs-comment">#åå°å¯åŠ¨</span><br></code></pre></td></tr></table></figure><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/elasticsearch/ElasticSearch%E5%AE%89%E8%A3%85%E5%92%8C%E8%BE%85%E5%8A%A9%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/2226570-20210326181404318-915148786.png" alt="img"></p><p>é€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°elasticsearchå·²ç»æˆåŠŸå¯åŠ¨</p><h3 id="8ã€è®¾ç½®elasticsearchä¸ºå¼€æœºè‡ªå¯åŠ¨æœåŠ¡"><a href="#8ã€è®¾ç½®elasticsearchä¸ºå¼€æœºè‡ªå¯åŠ¨æœåŠ¡" class="headerlink" title="8ã€è®¾ç½®elasticsearchä¸ºå¼€æœºè‡ªå¯åŠ¨æœåŠ¡"></a>8ã€è®¾ç½®elasticsearchä¸ºå¼€æœºè‡ªå¯åŠ¨æœåŠ¡</h3><h4 id="8-1ã€å…ˆæŸ¥çœ‹å½“å‰çš„å¼€æœºå¯åŠ¨æœåŠ¡"><a href="#8-1ã€å…ˆæŸ¥çœ‹å½“å‰çš„å¼€æœºå¯åŠ¨æœåŠ¡" class="headerlink" title="8.1ã€å…ˆæŸ¥çœ‹å½“å‰çš„å¼€æœºå¯åŠ¨æœåŠ¡"></a>8.1ã€å…ˆæŸ¥çœ‹å½“å‰çš„å¼€æœºå¯åŠ¨æœåŠ¡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">chkconfig --list<br></code></pre></td></tr></table></figure><h4 id="8-2ã€åˆ›å»ºes-çš„ç³»ç»Ÿå¯åŠ¨æœåŠ¡æ–‡ä»¶ï¼Œè¿›å…¥åˆ°-cd-x2F-etc-x2F-init-d-ç›®å½•ï¼Œç¼–å†™elasticsearchè„šæœ¬"><a href="#8-2ã€åˆ›å»ºes-çš„ç³»ç»Ÿå¯åŠ¨æœåŠ¡æ–‡ä»¶ï¼Œè¿›å…¥åˆ°-cd-x2F-etc-x2F-init-d-ç›®å½•ï¼Œç¼–å†™elasticsearchè„šæœ¬" class="headerlink" title="8.2ã€åˆ›å»ºes çš„ç³»ç»Ÿå¯åŠ¨æœåŠ¡æ–‡ä»¶ï¼Œè¿›å…¥åˆ° cd &#x2F;etc&#x2F;init.d ç›®å½•ï¼Œç¼–å†™elasticsearchè„šæœ¬"></a>8.2ã€åˆ›å»ºes çš„ç³»ç»Ÿå¯åŠ¨æœåŠ¡æ–‡ä»¶ï¼Œè¿›å…¥åˆ° cd &#x2F;etc&#x2F;init.d ç›®å½•ï¼Œç¼–å†™elasticsearchè„šæœ¬</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /etc/init.d    ã€€ã€€<span class="hljs-comment">#ã€è¿›å…¥åˆ°ç›®å½•ã€‘</span><br><br>vim elasticsearch ã€€ã€€ <span class="hljs-comment">#ã€åˆ›å»ºesç³»ç»Ÿå¯åŠ¨æœåŠ¡æ–‡ä»¶ã€‘</span><br><br><span class="hljs-comment">#!/bin/sh</span><br><span class="hljs-comment"># chkconfig: - 85 15</span><br><span class="hljs-comment">#description: elasticsearch</span><br><span class="hljs-built_in">export</span> ES_HOME=/opt/elasticsearch-7.4.0<br><br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-keyword">in</span><br>start)<br>    su es&lt;&lt;!<br>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$ES_HOME</span><br>    ./bin/elasticsearch -d -p pid<br>!<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;elasticsearch startup&quot;</span><br>    ;;  <br>stop)<br>    <span class="hljs-built_in">kill</span> -9 `<span class="hljs-built_in">cat</span> <span class="hljs-variable">$ES_HOME</span>/pid`<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;elasticsearch stopped&quot;</span><br>    ;;  <br>restart)<br>    <span class="hljs-built_in">kill</span> -9 `<span class="hljs-built_in">cat</span> <span class="hljs-variable">$ES_HOME</span>/pid`<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;elasticsearch stopped&quot;</span><br>    su es&lt;&lt;!<br>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$ES_HOME</span><br>    ./bin/elasticsearch -d -p pid<br>!<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;elasticsearch startup&quot;</span><br>    ;;  <br>*)<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;start|stop|restart&quot;</span><br>    ;;  <br><span class="hljs-keyword">esac</span><br><span class="hljs-built_in">exit</span> $?<br></code></pre></td></tr></table></figure><h4 id="8-3ã€ä¿®æ”¹æ–‡ä»¶æƒé™ï¼›"><a href="#8-3ã€ä¿®æ”¹æ–‡ä»¶æƒé™ï¼›" class="headerlink" title="8.3ã€ä¿®æ”¹æ–‡ä»¶æƒé™ï¼›"></a>8.3ã€ä¿®æ”¹æ–‡ä»¶æƒé™ï¼›</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">chmod</span> 777 elasticsearch<br></code></pre></td></tr></table></figure><h4 id="8-4ã€æ·»åŠ å’Œåˆ é™¤æœåŠ¡å¹¶è®¾ç½®å¯åŠ¨æ–¹å¼ï¼›"><a href="#8-4ã€æ·»åŠ å’Œåˆ é™¤æœåŠ¡å¹¶è®¾ç½®å¯åŠ¨æ–¹å¼ï¼›" class="headerlink" title="8.4ã€æ·»åŠ å’Œåˆ é™¤æœåŠ¡å¹¶è®¾ç½®å¯åŠ¨æ–¹å¼ï¼›"></a>8.4ã€æ·»åŠ å’Œåˆ é™¤æœåŠ¡å¹¶è®¾ç½®å¯åŠ¨æ–¹å¼ï¼›</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">chkconfig --add elasticsearchã€€ã€€ã€€ã€€<span class="hljs-comment"># ã€æ·»åŠ ç³»ç»ŸæœåŠ¡ã€‘</span><br>chkconfig --del elasticsearchã€€ã€€ã€€ã€€<span class="hljs-comment"># ã€åˆ é™¤ç³»ç»ŸæœåŠ¡ã€‘</span><br></code></pre></td></tr></table></figure><h4 id="8-5ã€å…³é—­å’Œå¯åŠ¨æœåŠ¡ï¼›"><a href="#8-5ã€å…³é—­å’Œå¯åŠ¨æœåŠ¡ï¼›" class="headerlink" title="8.5ã€å…³é—­å’Œå¯åŠ¨æœåŠ¡ï¼›"></a>8.5ã€å…³é—­å’Œå¯åŠ¨æœåŠ¡ï¼›</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start elasticsearch   ã€€ã€€ã€€<span class="hljs-comment"># ã€å¯åŠ¨æœåŠ¡ã€‘</span><br>systemctl stop elasticsearch ã€€ã€€ã€€ã€€ã€€ <span class="hljs-comment"># ã€åœæ­¢æœåŠ¡ã€‘</span><br>systemctl restart elasticsearch       <span class="hljs-comment"># ã€é‡å¯æœåŠ¡ã€‘</span><br></code></pre></td></tr></table></figure><h4 id="8-6ã€è®¾ç½®æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨ï¼›"><a href="#8-6ã€è®¾ç½®æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨ï¼›" class="headerlink" title="8.6ã€è®¾ç½®æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨ï¼›"></a>8.6ã€è®¾ç½®æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨ï¼›</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ã€å¼€å¯æœåŠ¡ã€‘</span><br>chkconfig elasticsearch onã€€ã€€ã€€ã€€ã€€<br>systemctl <span class="hljs-built_in">enable</span> elasticsearch <br><span class="hljs-comment"># ã€å…³é—­æœåŠ¡ã€‘</span><br>chkconfig elasticsearch offã€€ã€€   ã€€<br>systemctl <span class="hljs-built_in">disable</span> elasticsearch <br><br></code></pre></td></tr></table></figure><h3 id="9-è®¿é—®elasticsearch"><a href="#9-è®¿é—®elasticsearch" class="headerlink" title="9. è®¿é—®elasticsearch"></a>9. è®¿é—®elasticsearch</h3><h4 id="åœ¨è®¿é—®elasticsearchå‰ï¼Œè¯·ç¡®ä¿é˜²ç«å¢™æ˜¯å…³é—­çš„ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š"><a href="#åœ¨è®¿é—®elasticsearchå‰ï¼Œè¯·ç¡®ä¿é˜²ç«å¢™æ˜¯å…³é—­çš„ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š" class="headerlink" title="åœ¨è®¿é—®elasticsearchå‰ï¼Œè¯·ç¡®ä¿é˜²ç«å¢™æ˜¯å…³é—­çš„ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š"></a>åœ¨è®¿é—®elasticsearchå‰ï¼Œè¯·ç¡®ä¿é˜²ç«å¢™æ˜¯å…³é—­çš„ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æš‚æ—¶å…³é—­é˜²ç«å¢™</span><br>systemctl  stop  firewalld<br><br><span class="hljs-comment"># æˆ–è€…</span><br><span class="hljs-comment">#æ°¸ä¹…è®¾ç½®é˜²ç«å¢™çŠ¶æ€</span><br>systemctl <span class="hljs-built_in">enable</span> firewalld.service  <span class="hljs-comment">#æ‰“å¼€é˜²ç«å¢™æ°¸ä¹…æ€§ç”Ÿæ•ˆï¼Œé‡å¯åä¸ä¼šå¤åŸ </span><br>systemctl <span class="hljs-built_in">disable</span> firewalld.service <span class="hljs-comment">#å…³é—­é˜²ç«å¢™ï¼Œæ°¸ä¹…æ€§ç”Ÿæ•ˆï¼Œé‡å¯åä¸ä¼šå¤åŸ </span><br></code></pre></td></tr></table></figure><p>æµè§ˆå™¨è¾“å…¥<a href="http://192.168.52.128:9200/%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE">http://192.168.52.128:9200/ï¼Œå¦‚ä¸‹å›¾</a></p><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/elasticsearch/ElasticSearch%E5%AE%89%E8%A3%85%E5%92%8C%E8%BE%85%E5%8A%A9%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/2226570-20210326181413062-739940539.png" alt="img"></p><p>æ­¤æ—¶elasticsearchå·²æˆåŠŸå¯åŠ¨ï¼š</p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs d">é‡ç‚¹å‡ ä¸ªå…³æ³¨ä¸‹å³å¯:<br>numbe<span class="hljs-string">r&quot; : &quot;</span><span class="hljs-number">7.4</span><span class="hljs-number">.0</span><span class="hljs-string">&quot;   è¡¨ç¤ºelasticsearchç‰ˆæœ¬</span><br><span class="hljs-string">lucene_version&quot;</span> : <span class="hljs-string">&quot;8.2.0&quot;</span>  è¡¨ç¤ºluceneç‰ˆæœ¬<br>name ï¼š é»˜è®¤å¯åŠ¨çš„æ—¶å€™æŒ‡å®šäº† ES å®ä¾‹åç§°<br>cluster_name ï¼š é»˜è®¤åä¸º elasticsearch<br></code></pre></td></tr></table></figure><h2 id="äºŒã€-Elasticsearchè¾…åŠ©æ’ä»¶å®‰è£…"><a href="#äºŒã€-Elasticsearchè¾…åŠ©æ’ä»¶å®‰è£…" class="headerlink" title="äºŒã€ Elasticsearchè¾…åŠ©æ’ä»¶å®‰è£…"></a>äºŒã€ Elasticsearchè¾…åŠ©æ’ä»¶å®‰è£…</h2><h3 id="1-ã€Postmanå®‰è£…"><a href="#1-ã€Postmanå®‰è£…" class="headerlink" title="1 ã€Postmanå®‰è£…"></a>1 ã€Postmanå®‰è£…</h3><p>Postmanæ˜¯ä¸€ä¸ªhttpæ¨¡æ‹Ÿè¯·æ±‚çš„å·¥å…·ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸“é—¨æµ‹è¯• API çš„å·¥å…·ï¼ŒPostman æä¾›åŠŸèƒ½å¼ºå¤§çš„ Web API å’Œ HTTP è¯·æ±‚çš„è°ƒè¯•ï¼Œå®ƒèƒ½å¤Ÿå‘é€ä»»ä½•ç±»å‹çš„HTTP è¯·æ±‚ (GET, POST, PUT, DELETEâ€¦)ï¼Œå¹¶ä¸”èƒ½é™„å¸¦ä»»ä½•æ•°é‡çš„å‚æ•°å’Œ Headersã€‚ä¸ä»…å¦‚æ­¤ï¼Œå®ƒè¿˜æä¾›æµ‹è¯•æ•°æ®å’Œç¯å¢ƒé…ç½®æ•°æ®çš„å¯¼å…¥å¯¼å‡ºã€‚</p><p>è¿›å…¥å®˜ç½‘<a href="https://www.cnblogs.com/859630097com/p/www.getpostman.com">www.getpostman.com</a>ï¼Œä¸‹è½½</p><h3 id="2ã€-Kibanaå®‰è£…"><a href="#2ã€-Kibanaå®‰è£…" class="headerlink" title="2ã€ Kibanaå®‰è£…"></a>2ã€ Kibanaå®‰è£…</h3><p>Kibanaæ˜¯ä¸€ä¸ªé’ˆå¯¹Elasticsearchçš„å¼€æºåˆ†æåŠå¯è§†åŒ–å¹³å°ï¼Œç”¨æ¥æœç´¢ã€æŸ¥çœ‹äº¤äº’å­˜å‚¨åœ¨Elasticsearchç´¢å¼•ä¸­çš„æ•°æ®ã€‚ä½¿ç”¨Kibanaï¼Œå¯ä»¥é€šè¿‡å„ç§å›¾è¡¨è¿›è¡Œé«˜çº§æ•°æ®åˆ†æåŠå±•ç¤ºã€‚</p><p>Kibanaè®©æµ·é‡æ•°æ®æ›´å®¹æ˜“ç†è§£ã€‚å®ƒæ“ä½œç®€å•ï¼ŒåŸºäºæµè§ˆå™¨çš„ç”¨æˆ·ç•Œé¢å¯ä»¥å¿«é€Ÿåˆ›å»ºä»ªè¡¨æ¿ï¼ˆdashboardï¼‰å®æ—¶æ˜¾ç¤ºElasticsearchæŸ¥è¯¢åŠ¨æ€ã€‚</p><h4 id="2-1ã€ä¸Šä¼ å¹¶è§£å‹kibana"><a href="#2-1ã€ä¸Šä¼ å¹¶è§£å‹kibana" class="headerlink" title="2.1ã€ä¸Šä¼ å¹¶è§£å‹kibana"></a>2.1ã€ä¸Šä¼ å¹¶è§£å‹kibana</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è§£å‹åˆ°å½“å‰ç›®å½•ï¼ˆ/optï¼‰ä¸‹</span><br>tar -xzf kibana-7.4.0-linux-x86_64.tar.gz -C /opt<br></code></pre></td></tr></table></figure><h4 id="2-2ã€ä¿®æ”¹kibanaé…ç½®"><a href="#2-2ã€ä¿®æ”¹kibanaé…ç½®" class="headerlink" title="2.2ã€ä¿®æ”¹kibanaé…ç½®"></a>2.2ã€ä¿®æ”¹kibanaé…ç½®</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /opt/kibana-7.4.0-linux-x86_64/config/kibana.yml<br>server.port: 5601<br>server.host: <span class="hljs-string">&quot;0.0.0.0&quot;</span><br>server.name: <span class="hljs-string">&quot;kibana-itcast&quot;</span><br>elasticsearch.hosts: [<span class="hljs-string">&quot;http://127.0.0.1:9200&quot;</span>]<br>elasticsearch.requestTimeout: 99999<br><br><span class="hljs-comment">#å‚æ•°è§£é‡Šï¼š</span><br>server.portï¼šhttpè®¿é—®ç«¯å£<br>server.hostï¼šipåœ°å€ï¼Œ0.0.0.0è¡¨ç¤ºå¯è¿œç¨‹è®¿é—®<br>server.nameï¼škibanaæœåŠ¡å<br>elasticsearch.hostsï¼šelasticsearchåœ°å€<br>elasticsearch.requestTimeoutï¼šè¯·æ±‚elasticsearchè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º30000ï¼Œæ­¤å¤„å¯æ ¹æ®æƒ…å†µè®¾ç½®<br></code></pre></td></tr></table></figure><h4 id="2-3ã€å¯åŠ¨kibana"><a href="#2-3ã€å¯åŠ¨kibana" class="headerlink" title="2.3ã€å¯åŠ¨kibana"></a>2.3ã€å¯åŠ¨kibana</h4><p>ç”±äºkibanaä¸å»ºè®®ä½¿ç”¨rootç”¨æˆ·å¯åŠ¨ï¼Œå¦‚æœç”¨rootå¯åŠ¨ï¼Œéœ€è¦åŠ â€“allow-rootå‚æ•°</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># åˆ‡æ¢åˆ°kibanaçš„binç›®å½•</span><br><span class="hljs-built_in">cd</span> /opt/kibana-7.4.0-linux-x86_64/bin<br><span class="hljs-comment"># å¯åŠ¨</span><br>./kibana --allow-root<br></code></pre></td></tr></table></figure><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/elasticsearch/ElasticSearch%E5%AE%89%E8%A3%85%E5%92%8C%E8%BE%85%E5%8A%A9%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/2226570-20210326181435785-1459362013.png" alt="img"></p><p>å¯åŠ¨æˆåŠŸã€‚</p><h4 id="2-4ã€è®¿é—®kibana"><a href="#2-4ã€è®¿é—®kibana" class="headerlink" title="2.4ã€è®¿é—®kibana"></a>2.4ã€è®¿é—®kibana</h4><p>æµè§ˆå™¨è¾“å…¥http:&#x2F;&#x2F;æœåŠ¡å™¨IP:5601&#x2F;ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/elasticsearch/ElasticSearch%E5%AE%89%E8%A3%85%E5%92%8C%E8%BE%85%E5%8A%A9%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/2226570-20210326181443577-1850236452.png" alt="img"></p><p>çœ‹åˆ°è¿™ä¸ªç•Œé¢ï¼Œè¯´æ˜Kibananå·²æˆåŠŸå®‰è£…ï¼ã€‚</p><p><code>Discover</code>ï¼šå¯è§†åŒ–æŸ¥è¯¢åˆ†æå™¨ <code>Visualize</code>ï¼šç»Ÿè®¡åˆ†æå›¾è¡¨ <code>Dashboard</code>ï¼šè‡ªå®šä¹‰ä¸»é¢æ¿ï¼ˆæ·»åŠ å›¾è¡¨ï¼‰ <code>Timelion</code>ï¼šTimelionæ˜¯ä¸€ä¸ªkibanaæ—¶é—´åºåˆ—å±•ç¤ºç»„ä»¶ï¼ˆæš‚æ—¶ä¸ç”¨ï¼‰ <code>Dev Tools</code>ï¼šConsoleæ§åˆ¶å°ï¼ˆåŒCURL&#x2F;POSTERï¼Œæ“ä½œESä»£ç å·¥å…·ï¼Œä»£ç æç¤ºï¼Œå¾ˆæ–¹ä¾¿ï¼‰ <code>Management</code>ï¼šç®¡ç†ç´¢å¼•åº“(index)ã€å·²ä¿å­˜çš„æœç´¢å’Œå¯è§†åŒ–ç»“æœ(save objects)ã€è®¾ç½® kibana æœåŠ¡å™¨å±æ€§ã€‚</p><h3 id="3ã€headå®‰è£…"><a href="#3ã€headå®‰è£…" class="headerlink" title="3ã€headå®‰è£…"></a>3ã€headå®‰è£…</h3><p><strong>headç®€ä»‹</strong></p><p>headæ’ä»¶æ˜¯ESçš„ä¸€ä¸ªå¯è§†åŒ–ç®¡ç†æ’ä»¶ï¼Œç”¨æ¥ç›‘è§†ESçš„çŠ¶æ€ï¼Œå¹¶é€šè¿‡headå®¢æˆ·ç«¯å’ŒESæœåŠ¡è¿›è¡Œäº¤äº’ï¼Œæ¯”å¦‚åˆ›å»ºæ˜ å°„ã€åˆ›å»ºç´¢å¼•ç­‰ã€‚</p><p>åœ¨ç™»é™†å’Œè®¿é—®headæ’ä»¶åœ°å€å’ŒElasticSearchå‰éœ€è¦äº‹å…ˆåœ¨æœåŠ¡å™¨ä¸Šå®‰è£…å’Œé…ç½®å¥½ElasticSearchä»¥åŠheadæ’ä»¶ã€‚å®‰è£…å®Œåï¼Œé»˜è®¤headæ’ä»¶çš„webç«¯å£ä¸º9100ï¼ŒElasticSearchæœåŠ¡çš„ç«¯å£ä¸º9200ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®headåœ°å€ï¼Œå¦‚<a href="http://10.82.25.183:9100/">http://IPåœ°å€:9100/</a>ï¼Œæ¨èä½¿ç”¨Chromeæµè§ˆå™¨ï¼Œheadæ’ä»¶å¯¹Chromeæµè§ˆå™¨å…¼å®¹æ›´ä½³ã€‚è¿›å…¥headé¡µé¢åå°†ElasticSearchè¿æ¥è¾“å…¥æ¡†ä¸­å¡«å†™æ­£ç¡®çš„ElasticSearchæœåŠ¡åœ°å€ï¼Œå°±å¯ä»¥ç›‘æ§ElasticSearchè¿è¡Œä¿¡æ¯</p><h4 id="3-1-å®‰è£…headé¦–å…ˆéœ€è¦å®‰è£…Node"><a href="#3-1-å®‰è£…headé¦–å…ˆéœ€è¦å®‰è£…Node" class="headerlink" title="3.1 å®‰è£…headé¦–å…ˆéœ€è¦å®‰è£…Node"></a>3.1 å®‰è£…headé¦–å…ˆéœ€è¦å®‰è£…Node</h4><h5 id="3-1-1-ä»€ä¹ˆæ˜¯Node"><a href="#3-1-1-ä»€ä¹ˆæ˜¯Node" class="headerlink" title="3.1.1 ä»€ä¹ˆæ˜¯Node"></a>3.1.1 ä»€ä¹ˆæ˜¯Node</h5><p>ç®€å•çš„è¯´ Node.js å°±æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„ JavaScriptã€‚Node.js æ˜¯ä¸€ä¸ªåŸºäº <a href="https://developers.google.com/v8/">Chrome V8</a> å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚Node.js ä½¿ç”¨äº†ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ã€éé˜»å¡å¼ I&#x2F;O çš„æ¨¡å‹ï¼Œä½¿å…¶è½»é‡åˆé«˜æ•ˆã€‚Node.js çš„åŒ…ç®¡ç†å™¨ <a href="https://www.npmjs.com/">npm</a>ï¼Œæ˜¯å…¨çƒæœ€å¤§çš„å¼€æºåº“ç”Ÿæ€ç³»ç»Ÿã€‚</p><h5 id="3-1-2-ä¸‹è½½Node"><a href="#3-1-2-ä¸‹è½½Node" class="headerlink" title="3.1.2 ä¸‹è½½Node"></a>3.1.2 ä¸‹è½½Node</h5><p>ç”±äºelasticsearch-headæ’ä»¶æ˜¯ç”±nodejsè¯­è¨€ç¼–å†™ï¼Œæ‰€ä»¥å®‰è£…elasticsearch-headå‰éœ€è¦å…ˆå®‰è£…nodejsã€‚ é¦–å…ˆï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…nodejså’Œgrunt</p><p>æ‰“å¼€è™šæ‹Ÿæœºï¼Œæ‰§è¡Œwgetå‘½ä»¤ä¸‹è½½Nodeï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://nodejs.org/dist/v10.15.2/node-v10.15.2-linux-x64.tar.xz<br></code></pre></td></tr></table></figure><h5 id="3-1-3-è§£å‹NodeåŒ…"><a href="#3-1-3-è§£å‹NodeåŒ…" class="headerlink" title="3.1.3 è§£å‹NodeåŒ…"></a>3.1.3 è§£å‹NodeåŒ…</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar xvf node-v10.15.2-linux-x64.tar.xz<br></code></pre></td></tr></table></figure><h5 id="3-1-4-è®¾ç½®è½¯è¿æ¥"><a href="#3-1-4-è®¾ç½®è½¯è¿æ¥" class="headerlink" title="3.1.4 è®¾ç½®è½¯è¿æ¥"></a>3.1.4 è®¾ç½®è½¯è¿æ¥</h5><p>è§£å‹æ–‡ä»¶çš„ bin ç›®å½•åº•ä¸‹åŒ…å«äº† nodeã€npm ç­‰å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ln å‘½ä»¤æ¥è®¾ç½®è½¯è¿æ¥ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ln</span> -s bin/npm /usr/local/bin/<br><br><span class="hljs-built_in">ln</span> -s bin/node /usr/local/bin/<br></code></pre></td></tr></table></figure><p>åœ¨&#x2F;etc&#x2F;profileä¸­é…ç½®å¥½pathç¯å¢ƒå˜é‡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi ~/.bash_profile<br><br><span class="hljs-built_in">export</span> NODE_HOME=/opt/nodejs/node-v10.15.2-linux-x64<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$NODE_HOME</span>/bin<br><br><br><span class="hljs-comment">#ä¿å­˜é€€å‡ºï¼Œä½¿æ–‡ä»¶ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> ~/.bash_profile<br></code></pre></td></tr></table></figure><h5 id="3-1-5-éªŒè¯å®‰è£…"><a href="#3-1-5-éªŒè¯å®‰è£…" class="headerlink" title="3.1.5 éªŒè¯å®‰è£…"></a>3.1.5 éªŒè¯å®‰è£…</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">node -v<br></code></pre></td></tr></table></figure><h4 id="3-2-gruntå®‰è£…"><a href="#3-2-gruntå®‰è£…" class="headerlink" title="3.2 gruntå®‰è£…"></a>3.2 gruntå®‰è£…</h4><p>å®‰è£…gruntï¼ˆè¿è¡Œåœ¨Node.jsä¸Šé¢çš„ä»»åŠ¡ç®¡ç†å™¨ï¼ˆtask runnerï¼‰ï¼‰ï¼Œä¸ºäº†è·å¾—Gruntçš„æ›´å¤šäº§å“ç‰¹æ€§ï¼Œéœ€è¦å…¨å±€å®‰è£…Gruntâ€™s å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰ï¼Œä½¿ç”¨npmè¿›è¡Œå®‰è£…ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">npm install -g grunt-cli<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹gruntç‰ˆæœ¬</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">grunt --version<br><span class="hljs-comment">#è¾“å‡ºgruntç‰ˆæœ¬ä¿¡æ¯ï¼Œè¡¨ç¤ºå®‰è£…æˆåŠŸã€‚</span><br></code></pre></td></tr></table></figure><h4 id="3-3-headå®‰è£…"><a href="#3-3-headå®‰è£…" class="headerlink" title="3.3 headå®‰è£…"></a>3.3 headå®‰è£…</h4><h5 id="3-3-1-æ‰§è¡Œå‘½ä»¤å®‰è£…git"><a href="#3-3-1-æ‰§è¡Œå‘½ä»¤å®‰è£…git" class="headerlink" title="3.3.1 æ‰§è¡Œå‘½ä»¤å®‰è£…git"></a>3.3.1 æ‰§è¡Œå‘½ä»¤å®‰è£…git</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install git -y<br></code></pre></td></tr></table></figure><h5 id="3-3-2-åˆ‡æ¢åˆ°-x2F-optç›®å½•ä¸‹-æ‰§è¡Œä¸‹é¢çš„å…‹éš†å‘½ä»¤"><a href="#3-3-2-åˆ‡æ¢åˆ°-x2F-optç›®å½•ä¸‹-æ‰§è¡Œä¸‹é¢çš„å…‹éš†å‘½ä»¤" class="headerlink" title="3.3.2 åˆ‡æ¢åˆ°&#x2F;optç›®å½•ä¸‹,æ‰§è¡Œä¸‹é¢çš„å…‹éš†å‘½ä»¤"></a>3.3.2 åˆ‡æ¢åˆ°&#x2F;optç›®å½•ä¸‹,æ‰§è¡Œä¸‹é¢çš„å…‹éš†å‘½ä»¤</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> git://github.com/mobz/elasticsearch-head.git<br></code></pre></td></tr></table></figure><h5 id="3-3-3-è¿›å…¥åˆ°elasticsearch-headç›®å½•"><a href="#3-3-3-è¿›å…¥åˆ°elasticsearch-headç›®å½•" class="headerlink" title="3.3.3) è¿›å…¥åˆ°elasticsearch-headç›®å½•"></a>3.3.3) è¿›å…¥åˆ°elasticsearch-headç›®å½•</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> elasticsearch-head<br></code></pre></td></tr></table></figure><h5 id="3-3-4-è¿è¡Œ"><a href="#3-3-4-è¿è¡Œ" class="headerlink" title="3.3.4) è¿è¡Œ"></a>3.3.4) è¿è¡Œ</h5><p>åœ¨è¿è¡Œä¹‹å‰æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹elasticsearch.ymlï¼Œå› ä¸ºESé»˜è®¤ä¸å¼€å¯è·¨åŸŸè®¿é—®ï¼Œéœ€è¦æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¼€å¯corsè·¨åŸŸè®¿é—®æ”¯æŒï¼Œé»˜è®¤ä¸ºfalse </span><br>http.cors.enabled: <span class="hljs-literal">true</span><br><span class="hljs-comment">#è·¨åŸŸè®¿é—®å…è®¸çš„åŸŸååœ°å€ï¼Œ(å…è®¸æ‰€æœ‰åŸŸå)ä»¥ä¸Šä½¿ç”¨æ­£åˆ™</span><br>http.cors.allow-origin: <span class="hljs-string">&quot;*&quot;</span><br></code></pre></td></tr></table></figure><p>ç„¶åå¼€å§‹æ‰§è¡Œè¿è¡Œå‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">npm run start<br></code></pre></td></tr></table></figure><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/elasticsearch/ElasticSearch%E5%AE%89%E8%A3%85%E5%92%8C%E8%BE%85%E5%8A%A9%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/2226570-20210326181555123-864219776.png" alt="img"></p><h5 id="3-3-5-è®¿é—®head"><a href="#3-3-5-è®¿é—®head" class="headerlink" title="3.3.5) è®¿é—®head"></a>3.3.5) è®¿é—®head</h5><p>æµè§ˆå™¨è¾“å…¥ip:port:9100ï¼Œå¦‚ä¸‹å›¾</p><p><img src="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/elasticsearch/ElasticSearch%E5%AE%89%E8%A3%85%E5%92%8C%E8%BE%85%E5%8A%A9%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/2226570-20210326181602095-654760258.png" alt="img"></p><p>çœ‹åˆ°è¿™ä¸ªç•Œé¢è¯´æ˜æˆ‘ä»¬çš„headæ’ä»¶æˆåŠŸå®‰è£…å¹¶ä¸”æˆåŠŸè¿æ¥Elasticsearchã€‚</p><h3 id="4ã€IKåˆ†è¯å™¨å®‰è£…"><a href="#4ã€IKåˆ†è¯å™¨å®‰è£…" class="headerlink" title="4ã€IKåˆ†è¯å™¨å®‰è£…"></a>4ã€IKåˆ†è¯å™¨å®‰è£…</h3><h4 id="1ã€ç¯å¢ƒå‡†å¤‡"><a href="#1ã€ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1ã€ç¯å¢ƒå‡†å¤‡"></a>1ã€ç¯å¢ƒå‡†å¤‡</h4><p>Elasticsearch è¦ä½¿ç”¨ ikï¼Œå°±è¦å…ˆæ„å»º ik çš„ jaråŒ…ï¼Œè¿™é‡Œè¦ç”¨åˆ° maven åŒ…ç®¡ç†å·¥å…·ï¼Œè€Œ maven éœ€è¦java ç¯å¢ƒï¼Œè€Œ Elasticsearch å†…ç½®äº†jdkï¼Œ æ‰€ä»¥å¯ä»¥å°†JAVA_HOMEè®¾ç½®ä¸ºElasticsearch å†…ç½®çš„jdk</p><h5 id="1-1ï¼‰è®¾ç½®JAVA-HOME"><a href="#1-1ï¼‰è®¾ç½®JAVA-HOME" class="headerlink" title="1.1ï¼‰è®¾ç½®JAVA_HOME"></a>1.1ï¼‰è®¾ç½®JAVA_HOME</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/profile<br><span class="hljs-comment"># åœ¨profileæ–‡ä»¶æœ«å°¾æ·»åŠ </span><br><span class="hljs-comment">#java environment</span><br><span class="hljs-built_in">export</span> JAVA_HOME=/opt/elasticsearch-7.4.0/jdk<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$&#123;JAVA_HOME&#125;</span>/bin<br><br><span class="hljs-comment"># ä¿å­˜é€€å‡ºåï¼Œé‡æ–°åŠ è½½profile</span><br><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><h5 id="1-2ï¼‰ä¸‹è½½mavenå®‰è£…åŒ…"><a href="#1-2ï¼‰ä¸‹è½½mavenå®‰è£…åŒ…" class="headerlink" title="1.2ï¼‰ä¸‹è½½mavenå®‰è£…åŒ…"></a>1.2ï¼‰ä¸‹è½½mavenå®‰è£…åŒ…</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget http://mirror.cc.columbia.edu/pub/software/apache/maven/maven-3/3.1.1/binaries/apache-maven-3.1.1-bin.tar.gz  <br></code></pre></td></tr></table></figure><h5 id="1-3ï¼‰è§£å‹mavenå®‰è£…åŒ…"><a href="#1-3ï¼‰è§£å‹mavenå®‰è£…åŒ…" class="headerlink" title="1.3ï¼‰è§£å‹mavenå®‰è£…åŒ…"></a>1.3ï¼‰è§£å‹mavenå®‰è£…åŒ…</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar xzf apache-maven-3.1.1-bin.tar.gz <br></code></pre></td></tr></table></figure><h5 id="1-4ï¼‰è®¾ç½®è½¯è¿æ¥"><a href="#1-4ï¼‰è®¾ç½®è½¯è¿æ¥" class="headerlink" title="1.4ï¼‰è®¾ç½®è½¯è¿æ¥"></a>1.4ï¼‰è®¾ç½®è½¯è¿æ¥</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ln</span> -s apache-maven-3.1.1 maven <br></code></pre></td></tr></table></figure><h5 id="1-5ï¼‰è®¾ç½®path"><a href="#1-5ï¼‰è®¾ç½®path" class="headerlink" title="1.5ï¼‰è®¾ç½®path"></a>1.5ï¼‰è®¾ç½®path</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim  /etc/profile.d/maven.sh<br><br><span class="hljs-comment">#å°†ä¸‹é¢çš„å†…å®¹å¤åˆ¶åˆ°æ–‡ä»¶ï¼Œä¿å­˜</span><br><span class="hljs-built_in">export</span> MAVEN_HOME=/opt/maven  <br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$&#123;MAVEN_HOME&#125;</span>/bin:<span class="hljs-variable">$&#123;PATH&#125;</span> <br><br><span class="hljs-comment">#è®¾ç½®å¥½Mavençš„è·¯å¾„ä¹‹åï¼Œéœ€è¦è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä½¿å…¶ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> /etc/profile.d/maven.sh<br></code></pre></td></tr></table></figure><h5 id="1-6ï¼‰éªŒè¯mavenæ˜¯å¦å®‰è£…æˆåŠŸ"><a href="#1-6ï¼‰éªŒè¯mavenæ˜¯å¦å®‰è£…æˆåŠŸ" class="headerlink" title="1.6ï¼‰éªŒè¯mavenæ˜¯å¦å®‰è£…æˆåŠŸ"></a>1.6ï¼‰éªŒè¯mavenæ˜¯å¦å®‰è£…æˆåŠŸ</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mvn -v<br></code></pre></td></tr></table></figure><h4 id="2ã€å®‰è£…IKåˆ†è¯å™¨"><a href="#2ã€å®‰è£…IKåˆ†è¯å™¨" class="headerlink" title="2ã€å®‰è£…IKåˆ†è¯å™¨"></a>2ã€å®‰è£…IKåˆ†è¯å™¨</h4><h5 id="2-1ï¼‰ä¸‹è½½IK"><a href="#2-1ï¼‰ä¸‹è½½IK" class="headerlink" title="2.1ï¼‰ä¸‹è½½IK"></a>2.1ï¼‰ä¸‹è½½IK</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://github.com/medcl/elasticsearch-analysis-ik/archive/v7.4.0.zip<br></code></pre></td></tr></table></figure><h5 id="2-2ï¼‰è§£å‹IK"><a href="#2-2ï¼‰è§£å‹IK" class="headerlink" title="2.2ï¼‰è§£å‹IK"></a>2.2ï¼‰è§£å‹IK</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">unzip v7.4.0.zip<br></code></pre></td></tr></table></figure><h5 id="2-3ï¼‰ç¼–è¯‘jaråŒ…"><a href="#2-3ï¼‰ç¼–è¯‘jaråŒ…" class="headerlink" title="2.3ï¼‰ç¼–è¯‘jaråŒ…"></a>2.3ï¼‰ç¼–è¯‘jaråŒ…</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># åˆ‡æ¢åˆ° elasticsearch-analysis-ik-7.4.0ç›®å½•</span><br><span class="hljs-built_in">cd</span> elasticsearch-analysis-ik-7.4.0/<br><span class="hljs-comment">#æ‰“åŒ…</span><br>mvn package<br></code></pre></td></tr></table></figure><h5 id="2-4ï¼‰-jaråŒ…ç§»åŠ¨"><a href="#2-4ï¼‰-jaråŒ…ç§»åŠ¨" class="headerlink" title="2.4ï¼‰ jaråŒ…ç§»åŠ¨"></a>2.4ï¼‰ jaråŒ…ç§»åŠ¨</h5><p>packageæ‰§è¡Œå®Œæ¯•åä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆtarget&#x2F;releasesç›®å½•ï¼Œå°†å…¶ä¸­çš„elasticsearch-analysis-ik-7.4.0.zipæ‹·è´åˆ°elasticsearchç›®å½•ä¸‹çš„æ–°å»ºçš„ç›®å½•plugins&#x2F;analysis-ikï¼Œå¹¶è§£å‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ‡æ¢ç›®å½•</span><br><span class="hljs-built_in">cd</span> /opt/elasticsearch-7.4.0/plugins/<br><span class="hljs-comment">#æ–°å»ºç›®å½•</span><br><span class="hljs-built_in">mkdir</span> analysis-ik<br><span class="hljs-built_in">cd</span> analysis-ik<br><span class="hljs-comment">#æ‰§è¡Œæ‹·è´</span><br><span class="hljs-built_in">cp</span> -R /opt/elasticsearch-analysis-ik-7.4.0/target/releases/elasticsearch-analysis-ik-7.4.0.zip      /opt/elasticsearch-7.4.0/plugins/analysis-ik<br><span class="hljs-comment">#æ‰§è¡Œè§£å‹</span><br>unzip  /opt/elasticsearch-7.4.0/plugins/analysis-ik/elasticsearch-analysis-ik-7.4.0.zip<br></code></pre></td></tr></table></figure><h5 id="2-5ï¼‰æ‹·è´è¾å…¸"><a href="#2-5ï¼‰æ‹·è´è¾å…¸" class="headerlink" title="2.5ï¼‰æ‹·è´è¾å…¸"></a>2.5ï¼‰æ‹·è´è¾å…¸</h5><p>å°†elasticsearch-analysis-ik-7.4.0ç›®å½•ä¸‹çš„configç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ æ‹·è´åˆ°elasticsearchçš„configç›®å½•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> -R /opt/elasticsearch-analysis-ik-7.4.0/config/*   /opt/elasticsearch-7.4.0/config<br></code></pre></td></tr></table></figure><p><strong>è®°å¾—ä¸€å®šè¦é‡å¯Elasticsearchï¼ï¼ï¼</strong></p><h4 id="3ã€ä½¿ç”¨IKåˆ†è¯å™¨"><a href="#3ã€ä½¿ç”¨IKåˆ†è¯å™¨" class="headerlink" title="3ã€ä½¿ç”¨IKåˆ†è¯å™¨"></a>3ã€ä½¿ç”¨IKåˆ†è¯å™¨</h4><p>IKåˆ†è¯å™¨æœ‰ä¸¤ç§åˆ†è¯æ¨¡å¼ï¼šik_max_wordå’Œik_smartæ¨¡å¼ã€‚</p><h5 id="3-1ï¼‰ik-max-word"><a href="#3-1ï¼‰ik-max-word" class="headerlink" title="3.1ï¼‰ik_max_word"></a>3.1ï¼‰ik_max_word</h5><p>ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°†â€œä¹’ä¹“çƒæ˜å¹´æ€»å† å†›â€æ‹†åˆ†ä¸ºâ€œä¹’ä¹“çƒã€ä¹’ä¹“ã€çƒã€æ˜å¹´ã€æ€»å† å†›ã€å† å†›ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">GET /_analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;ä¹’ä¹“çƒæ˜å¹´æ€»å† å†›&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ik_max_wordåˆ†è¯å™¨æ‰§è¡Œå¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs sh">&#123;<br>  <span class="hljs-string">&quot;tokens&quot;</span> : [<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;ä¹’ä¹“çƒ&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 0,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 3,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;CN_WORD&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 0<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;ä¹’ä¹“&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 0,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 2,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;CN_WORD&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 1<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;çƒ&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 2,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 3,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;CN_CHAR&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 2<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;æ˜å¹´&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 3,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 5,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;CN_WORD&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 3<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;æ€»å† å†›&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 5,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 8,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;CN_WORD&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 4<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;å† å†›&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 6,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 8,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;CN_WORD&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 5<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="3-2ï¼‰ik-smart"><a href="#3-2ï¼‰ik-smart" class="headerlink" title="3.2ï¼‰ik_smart"></a>3.2ï¼‰ik_smart</h5><p>ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°†â€œä¹’ä¹“çƒæ˜å¹´æ€»å† å†›â€æ‹†åˆ†ä¸ºä¹’ä¹“çƒã€æ˜å¹´ã€æ€»å† å†›ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sh">GET /_analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_smart&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;ä¹’ä¹“çƒæ˜å¹´æ€»å† å†›&quot;</span><br>&#125;<br>ik_smartåˆ†è¯å™¨æ‰§è¡Œå¦‚ä¸‹ï¼š<br><br>&#123;<br>  <span class="hljs-string">&quot;tokens&quot;</span> : [<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;ä¹’ä¹“çƒ&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 0,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 3,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;CN_WORD&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 0<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;æ˜å¹´&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 3,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 5,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;CN_WORD&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 1<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;æ€»å† å†›&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 5,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 8,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;CN_WORD&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 2<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”±æ­¤å¯è§ ä½¿ç”¨ik_smartå¯ä»¥å°†æ–‡æœ¬â€textâ€: â€œä¹’ä¹“çƒæ˜å¹´æ€»å† å†›â€åˆ†æˆäº†ã€ä¹’ä¹“çƒã€‘ã€æ˜å¹´ã€‘ã€æ€»å† å†›ã€‘</p>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>elasticsearch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>es</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ElasticSearchçš„IKåˆ†è¯æ’ä»¶ã€pinyinæ’ä»¶å®‰è£…</title>
    <link href="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/elasticsearch/ElasticSearch%E5%8F%8AIK%E5%88%86%E8%AF%8D%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/"/>
    <url>/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/elasticsearch/ElasticSearch%E5%8F%8AIK%E5%88%86%E8%AF%8D%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ElasticSearchçš„IKåˆ†è¯æ’ä»¶ã€pinyinæ’ä»¶å®‰è£…"><a href="#ElasticSearchçš„IKåˆ†è¯æ’ä»¶ã€pinyinæ’ä»¶å®‰è£…" class="headerlink" title="ElasticSearchçš„IKåˆ†è¯æ’ä»¶ã€pinyinæ’ä»¶å®‰è£…"></a>ElasticSearchçš„IKåˆ†è¯æ’ä»¶ã€pinyinæ’ä»¶å®‰è£…</h1><p><strong>å®‰è£…æ—¶é‡‡ç”¨ElasticSearchç‰ˆæœ¬5.6.12</strong></p><h2 id="ä¸€ã€å®‰è£…ElasticSearch"><a href="#ä¸€ã€å®‰è£…ElasticSearch" class="headerlink" title="ä¸€ã€å®‰è£…ElasticSearch"></a>ä¸€ã€å®‰è£…ElasticSearch</h2><h3 id="1-å®‰è£…openjdkç¯å¢ƒ"><a href="#1-å®‰è£…openjdkç¯å¢ƒ" class="headerlink" title="1.å®‰è£…openjdkç¯å¢ƒ"></a>1.å®‰è£…openjdkç¯å¢ƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install java-1.8.0-openjdk-devel<br></code></pre></td></tr></table></figure><h3 id="2-ä½¿ç”¨yumå®‰è£…rpmåŒ…"><a href="#2-ä½¿ç”¨yumå®‰è£…rpmåŒ…" class="headerlink" title="2.ä½¿ç”¨yumå®‰è£…rpmåŒ…"></a>2.ä½¿ç”¨yumå®‰è£…rpmåŒ…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.6.12.rpm<br>yum install elasticsearch-5.6.12.rpm<br></code></pre></td></tr></table></figure><h3 id="3-æŸ¥çœ‹å®‰è£…çš„elasticsearchç›¸å…³æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•"><a href="#3-æŸ¥çœ‹å®‰è£…çš„elasticsearchç›¸å…³æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•" class="headerlink" title="3.æŸ¥çœ‹å®‰è£…çš„elasticsearchç›¸å…³æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•"></a>3.æŸ¥çœ‹å®‰è£…çš„elasticsearchç›¸å…³æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">whereis elasticsearch<br><br><span class="hljs-comment">#è¾“å‡º:</span><br>elasticsearch: /etc/elasticsearch /usr/share/elasticsearch<br><br></code></pre></td></tr></table></figure><h3 id="4-ä¿®æ”¹ymlæ–‡ä»¶"><a href="#4-ä¿®æ”¹ymlæ–‡ä»¶" class="headerlink" title="4.ä¿®æ”¹ymlæ–‡ä»¶"></a>4.ä¿®æ”¹ymlæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/elasticsearch/elasticsearch.yml <br><br><span class="hljs-comment">#----------ä»¥ä¸‹ä¸ºè§£é™¤æ³¨é‡Šçš„å†…å®¹------------------#</span><br>cluster.name: my-application  <span class="hljs-comment">#è¯¥nameå¯è‡ªå·±å®šä¹‰</span><br>node.name: node-1<br>network.host: 0.0.0.0  <span class="hljs-comment">#å¯è®¾ç½®ä¸ºæœ¬åœ°åœ°å€ï¼Œæ­£å¼ç¯å¢ƒå»ºè®®è®¾ç½®ä¸ºæœ¬æœº</span><br>http.port: 9200<br><br><span class="hljs-comment">#path.data: /path/to/data  #ä¿®æ”¹è·¯å¾„åœ°å€æ—¶ï¼Œè¯·å…ˆç¡®ä¿æ­£å¸¸å¯åŠ¨åå†ä¿®æ”¹,ç³»ç»Ÿé»˜è®¤å¯åŠ¨åçš„é»˜è®¤æ—¥å¿—å­˜æ”¾è·¯å¾„åœ¨/var/log/elasticsearch/</span><br><span class="hljs-comment">#path.logs: /path/to/logs  #ä¿®æ”¹è·¯å¾„åœ°å€æ—¶ï¼Œè¯·å…ˆç¡®ä¿æ­£å¸¸å¯åŠ¨åå†ä¿®æ”¹,ç³»ç»Ÿé»˜è®¤å¯åŠ¨åçš„é»˜è®¤æ—¥å¿—å­˜æ”¾è·¯å¾„åœ¨/var/log/elasticsearch/</span><br></code></pre></td></tr></table></figure><h3 id="5-å¯åŠ¨elasticsearch"><a href="#5-å¯åŠ¨elasticsearch" class="headerlink" title="5.å¯åŠ¨elasticsearch"></a>5.å¯åŠ¨elasticsearch</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start elasticsearch.service &amp;&amp; systemctl status elasticsearch.service<br></code></pre></td></tr></table></figure><p><strong>æ³¨ï¼šå¯åŠ¨ä¸æˆåŠŸæ—¶ï¼Œè¯·vim &#x2F;etc&#x2F;elasticsearch&#x2F;jvm.options  æŸ¥çœ‹-Xms2g -Xmx2g å†…å­˜æ˜¯å¦æ˜¯æœåŠ¡å™¨çš„50%</strong></p><h2 id="äºŒã€å®‰è£…IKåˆ†è¯æ’ä»¶"><a href="#äºŒã€å®‰è£…IKåˆ†è¯æ’ä»¶" class="headerlink" title="äºŒã€å®‰è£…IKåˆ†è¯æ’ä»¶"></a>äºŒã€å®‰è£…IKåˆ†è¯æ’ä»¶</h2><h3 id="1-å°†ç›¸å…³çš„æ’ä»¶åŒ…ä¸Šä¼ åˆ°-x2F-usr-x2F-share-x2F-elasticsearch-x2F-pluginsç›®å½•ä¸‹ï¼Œå¹¶è§£å‹"><a href="#1-å°†ç›¸å…³çš„æ’ä»¶åŒ…ä¸Šä¼ åˆ°-x2F-usr-x2F-share-x2F-elasticsearch-x2F-pluginsç›®å½•ä¸‹ï¼Œå¹¶è§£å‹" class="headerlink" title="1.å°†ç›¸å…³çš„æ’ä»¶åŒ…ä¸Šä¼ åˆ°&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;pluginsç›®å½•ä¸‹ï¼Œå¹¶è§£å‹"></a>1.å°†ç›¸å…³çš„æ’ä»¶åŒ…ä¸Šä¼ åˆ°&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;pluginsç›®å½•ä¸‹ï¼Œå¹¶è§£å‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /usr/share/elasticsearch/plugins<br><br>unzip elasticsearch-analysis-ik-5.6.12.zip <br><br><span class="hljs-comment">#æ›´å</span><br><span class="hljs-built_in">mv</span> elasticsearch analysis-ik  <br><br><span class="hljs-comment">#è§£å‹åéœ€åˆ é™¤è¯¥ç›®å½•ä¸‹çš„zipæ–‡ä»¶</span><br><span class="hljs-built_in">rm</span> -rf elasticsearch-analysis-ik-5.6.12.zip <br></code></pre></td></tr></table></figure><h3 id="2-ä¿®æ”¹æ–‡ä»¶çš„æƒé™"><a href="#2-ä¿®æ”¹æ–‡ä»¶çš„æƒé™" class="headerlink" title="2.ä¿®æ”¹æ–‡ä»¶çš„æƒé™"></a>2.ä¿®æ”¹æ–‡ä»¶çš„æƒé™</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">chmod</span> 755 analysis-ik<br><span class="hljs-built_in">chown</span> -R elasticsearch:elasticsearch analysis-ik<br></code></pre></td></tr></table></figure><h3 id="3-æ‹·è´è¾å…¸ï¼Œå°†ç›®å½•ä¸‹çš„configç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶-æ‹·è´åˆ°elasticsearchçš„configç›®å½•"><a href="#3-æ‹·è´è¾å…¸ï¼Œå°†ç›®å½•ä¸‹çš„configç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶-æ‹·è´åˆ°elasticsearchçš„configç›®å½•" class="headerlink" title="3.æ‹·è´è¾å…¸ï¼Œå°†ç›®å½•ä¸‹çš„configç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ æ‹·è´åˆ°elasticsearchçš„configç›®å½•"></a>3.æ‹·è´è¾å…¸ï¼Œå°†ç›®å½•ä¸‹çš„configç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ æ‹·è´åˆ°elasticsearchçš„configç›®å½•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> -R /usr/share/elasticsearch/plugins/analysis-ik/config/* /etc/elasticsearch/<br></code></pre></td></tr></table></figure><h3 id="4-é‡å¯elasticsearchæœåŠ¡-å¹¶å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼Œè·¯å¾„æœ‰åœ¨"><a href="#4-é‡å¯elasticsearchæœåŠ¡-å¹¶å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼Œè·¯å¾„æœ‰åœ¨" class="headerlink" title="4.é‡å¯elasticsearchæœåŠ¡,å¹¶å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼Œè·¯å¾„æœ‰åœ¨"></a>4.é‡å¯elasticsearchæœåŠ¡,å¹¶å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼Œè·¯å¾„æœ‰åœ¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart elasticsearch.service &amp;&amp; <span class="hljs-built_in">tail</span> -f /var/log/elasticsearch/elasticsearch.log<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€å®‰è£…pinyinæ’ä»¶"><a href="#ä¸‰ã€å®‰è£…pinyinæ’ä»¶" class="headerlink" title="ä¸‰ã€å®‰è£…pinyinæ’ä»¶"></a>ä¸‰ã€å®‰è£…pinyinæ’ä»¶</h2><h3 id="1-å°†ç›¸å…³çš„æ’ä»¶åŒ…ä¸Šä¼ åˆ°-x2F-usr-x2F-share-x2F-elasticsearch-x2F-pluginsç›®å½•ä¸‹ï¼Œå¹¶è§£å‹-1"><a href="#1-å°†ç›¸å…³çš„æ’ä»¶åŒ…ä¸Šä¼ åˆ°-x2F-usr-x2F-share-x2F-elasticsearch-x2F-pluginsç›®å½•ä¸‹ï¼Œå¹¶è§£å‹-1" class="headerlink" title="1.å°†ç›¸å…³çš„æ’ä»¶åŒ…ä¸Šä¼ åˆ°&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;pluginsç›®å½•ä¸‹ï¼Œå¹¶è§£å‹"></a>1.å°†ç›¸å…³çš„æ’ä»¶åŒ…ä¸Šä¼ åˆ°&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;pluginsç›®å½•ä¸‹ï¼Œå¹¶è§£å‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /usr/share/elasticsearch/plugins<br><br>unzip elasticsearch-analysis-pinyin-5.6.12.zip<br><br><span class="hljs-built_in">mv</span> elasticsearch/ analysis-pinyin <span class="hljs-comment">#æ›´å</span><br><br><span class="hljs-built_in">rm</span> -rf elasticsearch-analysis-pinyin-5.6.12.zip <span class="hljs-comment">#è§£å‹ååˆ é™¤è¯¥ç›®å½•ä¸‹zipæ–‡ä»¶</span><br></code></pre></td></tr></table></figure><h3 id="2-ä¿®æ”¹æ–‡ä»¶çš„æƒé™-1"><a href="#2-ä¿®æ”¹æ–‡ä»¶çš„æƒé™-1" class="headerlink" title="2.ä¿®æ”¹æ–‡ä»¶çš„æƒé™"></a>2.ä¿®æ”¹æ–‡ä»¶çš„æƒé™</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">chmod</span> 755 analysis-pinyin/<br><span class="hljs-built_in">chown</span> -R elasticsearch:elasticsearch analysis-pinyin/<br></code></pre></td></tr></table></figure><h3 id="3-é‡å¯elasticsearchæœåŠ¡"><a href="#3-é‡å¯elasticsearchæœåŠ¡" class="headerlink" title="3.é‡å¯elasticsearchæœåŠ¡"></a>3.é‡å¯elasticsearchæœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart elasticsearch.service <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>elasticsearch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>es</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨docker-composeå®‰è£…consul</title>
    <link href="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/consul/%E4%BD%BF%E7%94%A8docker-compose%E5%AE%89%E8%A3%85consul/"/>
    <url>/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/consul/%E4%BD%BF%E7%94%A8docker-compose%E5%AE%89%E8%A3%85consul/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨docker-composeå®‰è£…consul"><a href="#ä½¿ç”¨docker-composeå®‰è£…consul" class="headerlink" title="ä½¿ç”¨docker-composeå®‰è£…consul"></a>ä½¿ç”¨docker-composeå®‰è£…consul</h1><h2 id="1-åˆ›å»ºå·¥ä½œç›®å½•å¹¶æ‹‰å–consulé•œåƒ"><a href="#1-åˆ›å»ºå·¥ä½œç›®å½•å¹¶æ‹‰å–consulé•œåƒ" class="headerlink" title="1.åˆ›å»ºå·¥ä½œç›®å½•å¹¶æ‹‰å–consulé•œåƒ"></a>1.åˆ›å»ºå·¥ä½œç›®å½•å¹¶æ‹‰å–consulé•œåƒ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /app/consul &amp;&amp; <span class="hljs-built_in">cd</span> /app/consul<br><br>docker pull consul<br></code></pre></td></tr></table></figure><h2 id="2-ä¿®æ”¹dockerçš„jsoné…ç½®"><a href="#2-ä¿®æ”¹dockerçš„jsoné…ç½®" class="headerlink" title="2.ä¿®æ”¹dockerçš„jsoné…ç½®"></a>2.ä¿®æ”¹dockerçš„jsoné…ç½®</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/docker/daemon.json<br><br>&#123;<br>  <span class="hljs-string">&quot;exec-opts&quot;</span>: [<span class="hljs-string">&quot;native.cgroupdriver=systemd&quot;</span>],<br>  <span class="hljs-string">&quot;log-driver&quot;</span>: <span class="hljs-string">&quot;json-file&quot;</span>,<br>  <span class="hljs-string">&quot;log-opts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;max-size&quot;</span>: <span class="hljs-string">&quot;100m&quot;</span>,<br>    <span class="hljs-string">&quot;max-file&quot;</span>: <span class="hljs-string">&quot;5&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;storage-driver&quot;</span>: <span class="hljs-string">&quot;overlay2&quot;</span>,<br>  <span class="hljs-string">&quot;storage-opts&quot;</span>: [<br>    <span class="hljs-string">&quot;overlay2.override_kernel_check=true&quot;</span><br>  ],<br>  <span class="hljs-string">&quot;registry-mirrors&quot;</span>:[<span class="hljs-string">&quot;https://r2hd8p9u.mirror.aliyuncs.com&quot;</span>],<br>  <span class="hljs-string">&quot;insecure-registries&quot;</span>:[<span class="hljs-string">&quot;120.77.159.14:5000&quot;</span>],<br>  <span class="hljs-string">&quot;graph&quot;</span>: <span class="hljs-string">&quot;/app/docker&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-ç¼–è¾‘consul-compose-yamlæ–‡ä»¶"><a href="#3-ç¼–è¾‘consul-compose-yamlæ–‡ä»¶" class="headerlink" title="3.ç¼–è¾‘consul-compose.yamlæ–‡ä»¶"></a>3.ç¼–è¾‘consul-compose.yamlæ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> consul-compose.yaml:<br><br>services:<br><br>  consul1:<br>    image: consul:latest<br>    container_name: consul_server_1<br>    restart: always<br>    volumes:<br>      - /app/consul/server1/data:/consul/data<br>      - /app/consul/server1/config:/consul/config<br>    environment:<br>      - data-dir:/consul/data<br>      - config-dir:/consul/config<br>    <span class="hljs-built_in">command</span>:<br>      - agent<br>      - -server<br>      - -bootstrap-expect=3<br>      - -node=10.10.0.2<br>      - -client=0.0.0.0<br>      - -datacenter=dc1<br>    networks:<br>      consul:<br>        ipv4_address: 10.10.0.2<br><br>  consul2:<br>    image: consul:latest<br>    container_name: consul_server_2<br>    restart: always<br>    depends_on:<br>      - consul1<br>    volumes:<br>      - /app/consul/server2/data:/consul/data<br>      - /app/consul/server2/config:/consul/config<br>    environment:<br>      - data-dir:/consul/data<br>      - config-dir:/consul/config<br>    <span class="hljs-built_in">command</span>:<br>      - agent<br>      - -server<br>      - -node=10.10.0.3<br>      - -client=0.0.0.0<br>      - -datacenter=dc1<br>      - -retry-join=10.10.0.2<br>    networks:<br>      consul:<br>        ipv4_address: 10.10.0.3<br><br>  consul3:<br>    image: consul:latest<br>    container_name: consul_server_3<br>    restart: always<br>    depends_on:<br>      - consul1<br>    volumes:<br>      - /app/consul/server3/data:/consul/data<br>      - /app/consul/server3/config:/consul/config<br>    environment:<br>      - data-dir:/consul/data<br>      - config-dir:/consul/config<br>    <span class="hljs-built_in">command</span>:<br>      - agent<br>      - -server<br>      - -node=10.10.0.4<br>      - -client=0.0.0.0<br>      - -datacenter=dc1<br>      - -retry-join=10.10.0.2<br>    networks:<br>      consul:<br>        ipv4_address: 10.10.0.4<br><br>  consul_agent:<br>    image: consul:latest<br>    container_name: consul_agent<br>    restart: always<br>    depends_on:<br>      - consul1<br>    ports:<br>      - <span class="hljs-string">&quot;8500:8500&quot;</span><br>    volumes:<br>      - /app/consul/agent/data:/consul/data<br>      - /app/consul/agent/config:/consul/config<br>    environment:<br>      - data-dir:/consul/data<br>      - config-dir:/consul/config<br>    <span class="hljs-built_in">command</span>:<br>      - agent<br>      - -ui<br>      - -node=10.10.0.5<br>      - -client=0.0.0.0<br>      - -datacenter=dc1<br>      - -retry-join=10.10.0.2<br>    networks:<br>      consul:<br>        ipv4_address: 10.10.0.5<br><br>networks:<br>  consul:<br>    ipam:<br>      driver: default<br>      config:<br>        - subnet: <span class="hljs-string">&quot;10.10.0.0/24&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æŸ¥çœ‹yamlæ–‡ä»¶volumesæ•°æ®å·æ–‡ä»¶ï¼Œåœ¨è¯¥ç›®å½•ä¸‹æ–°å»º</span><br><br><span class="hljs-built_in">mkdir</span> /app/consul/agent/&#123;config,data&#125;<br></code></pre></td></tr></table></figure><h2 id="4-å¯åŠ¨"><a href="#4-å¯åŠ¨" class="headerlink" title="4.å¯åŠ¨"></a>4.å¯åŠ¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker-compose -f consul-compose.yaml up -d<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>consul</category>
      
    </categories>
    
    
    <tags>
      
      <tag>consul</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨dockerå®‰è£…consulæœåŠ¡</title>
    <link href="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/consul/%E4%BD%BF%E7%94%A8docker%E5%AE%89%E8%A3%85consul/"/>
    <url>/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/consul/%E4%BD%BF%E7%94%A8docker%E5%AE%89%E8%A3%85consul/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨dockerå®‰è£…consulæœåŠ¡"><a href="#ä½¿ç”¨dockerå®‰è£…consulæœåŠ¡" class="headerlink" title="ä½¿ç”¨dockerå®‰è£…consulæœåŠ¡"></a>ä½¿ç”¨dockerå®‰è£…consulæœåŠ¡</h1><h2 id="ä¸€ã€ä½¿ç”¨dockeræ­å»ºconsulå•èŠ‚ç‚¹"><a href="#ä¸€ã€ä½¿ç”¨dockeræ­å»ºconsulå•èŠ‚ç‚¹" class="headerlink" title="ä¸€ã€ä½¿ç”¨dockeræ­å»ºconsulå•èŠ‚ç‚¹"></a>ä¸€ã€ä½¿ç”¨dockeræ­å»ºconsulå•èŠ‚ç‚¹</h2><h3 id="1ã€åˆ›å»ºå·¥ä½œç›®å½•"><a href="#1ã€åˆ›å»ºå·¥ä½œç›®å½•" class="headerlink" title="1ã€åˆ›å»ºå·¥ä½œç›®å½•"></a>1ã€åˆ›å»ºå·¥ä½œç›®å½•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /consul/node1/config<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d --restart=always --name consul \<br>-p 8500:8500 \<br>-v /consul/node1:/consul \<br>consul:latest agent -server -ui -bootstrap-expect=1 -node=node1 -client=0.0.0.0<br><br>å‚æ•°è§£é‡Šï¼š<br>-serverï¼šè¡¨ç¤ºå¯åŠ¨çš„èŠ‚ç‚¹ç±»å‹ä¸ºserverç±»å‹<br>-bootstrap-expectï¼šç”¨äºserverèŠ‚ç‚¹é€‰ä¸¾leaderçš„å‚æ•°,è¡¨ç¤ºè¾¾åˆ°å‡ ä¸ªserverèŠ‚ç‚¹æ—¶å¼€å§‹é€‰ä¸¾<br>-bootstrapï¼šè¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹æ˜¯ Server-Leader ï¼Œæ¯ä¸ªæ•°æ®ä¸­å¿ƒåªèƒ½è¿è¡Œä¸€å°æœåŠ¡å™¨<br>-nodeï¼šèŠ‚ç‚¹çš„åç§°ï¼Œé›†ç¾¤ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„<br></code></pre></td></tr></table></figure><h2 id="äºŒã€ä½¿ç”¨dockeræ­å»ºconsulé›†ç¾¤"><a href="#äºŒã€ä½¿ç”¨dockeræ­å»ºconsulé›†ç¾¤" class="headerlink" title="äºŒã€ä½¿ç”¨dockeræ­å»ºconsulé›†ç¾¤"></a>äºŒã€ä½¿ç”¨dockeræ­å»ºconsulé›†ç¾¤</h2><h3 id="1ã€åˆ›å»ºdockerç½‘ç»œå’Œå·¥ä½œç›®å½•"><a href="#1ã€åˆ›å»ºdockerç½‘ç»œå’Œå·¥ä½œç›®å½•" class="headerlink" title="1ã€åˆ›å»ºdockerç½‘ç»œå’Œå·¥ä½œç›®å½•"></a>1ã€åˆ›å»ºdockerç½‘ç»œå’Œå·¥ä½œç›®å½•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker network create --subnet=172.25.2.2/16 consulnet<br><span class="hljs-built_in">mkdir</span> -p /consul/node&#123;0,1,2&#125;/config<br></code></pre></td></tr></table></figure><h3 id="2ã€dockerè¿è¡ŒconsulæœåŠ¡ï¼ˆé›†ç¾¤æ¨¡å¼ï¼‰"><a href="#2ã€dockerè¿è¡ŒconsulæœåŠ¡ï¼ˆé›†ç¾¤æ¨¡å¼ï¼‰" class="headerlink" title="2ã€dockerè¿è¡ŒconsulæœåŠ¡ï¼ˆé›†ç¾¤æ¨¡å¼ï¼‰"></a>2ã€dockerè¿è¡ŒconsulæœåŠ¡ï¼ˆé›†ç¾¤æ¨¡å¼ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d --restart=always \<br>--name node1 \<br>--net consulnet \<br>--ip 172.25.0.2 \<br>-e <span class="hljs-string">&#x27;CONSUL_LOCAL_CONFIG=&#123;&quot;skip_leave_on_interrupt&quot;: true&#125;&#x27;</span> \<br>-v /consul/node1:/consul \<br>consul:1.4.3 agent -server -node=node1 -bootstrap-expect=2<br><br>docker run -d --restart=always \<br>--name node2 \<br>--net consulnet \<br>--ip 172.25.0.3 \<br>-e <span class="hljs-string">&#x27;CONSUL_LOCAL_CONFIG=&#123;&quot;skip_leave_on_interrupt&quot;: true&#125;&#x27;</span> \<br>-v /consul/node2:/consul \<br>consul:1.4.3 agent -server -node=node2 \<br>-<span class="hljs-built_in">join</span> 172.25.0.2<br><br><br>docker run -d --restart=always \<br>--name node0 \<br>--net consulnet \<br>--ip 172.25.0.100 \<br>-p 8400:8400 -p 8500:8500 -p 8600:53/udp \<br>-e <span class="hljs-string">&#x27;CONSUL_LOCAL_CONFIG=&#123;&quot;skip_leave_on_interrupt&quot;: true&#125;&#x27;</span> \<br>-v /consul/node0:/consul \<br>consul:1.4.3 agent -ui -node=node0 \<br>-client=0.0.0.0 \<br>-<span class="hljs-built_in">join</span> 172.25.0.2<br><br><span class="hljs-comment">#å‚æ•°è¯¦è§£ï¼š</span><br>agentï¼šè¡¨ç¤ºå¯åŠ¨ Agent è¿›ç¨‹ã€‚<br>-clientï¼šæŒ‡å®šå®¢æˆ·ç«¯è®¿é—®consulé›†ç¾¤ï¼ˆæ¯”å¦‚consulé›†ç¾¤æä¾›çš„webç•Œé¢ï¼ŒDNSæœåŠ¡ç­‰ï¼‰,è¡¨ç¤ºå¯åŠ¨ Consul Cilent æ¨¡å¼ã€‚<br>-serverï¼šè¡¨ç¤ºè¯¥consulèŠ‚ç‚¹å·¥ä½œåœ¨serveræ¨¡å¼,è¡¨ç¤ºå¯åŠ¨ Consul Server æ¨¡å¼<br>-<span class="hljs-built_in">join</span> 172.17.0.1ï¼šä¸172.17.0.1è¿™ä¸ªåœ°å€çš„èŠ‚ç‚¹é€šä¿¡ï¼Œä»¥åŠ å…¥é›†ç¾¤<br>-nodeï¼šèŠ‚ç‚¹çš„åç§°ï¼Œé›†ç¾¤ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„<br>-uiï¼šè¡¨ç¤ºå¯åŠ¨ Web UI ç®¡ç†å™¨ï¼Œé»˜è®¤å¼€æ”¾ç«¯å£ 8500<br>-bootstrap-expectï¼šç”¨äºserverèŠ‚ç‚¹é€‰ä¸¾leaderçš„å‚æ•°,è¡¨ç¤ºè¾¾åˆ°å‡ ä¸ªserverèŠ‚ç‚¹æ—¶å¼€å§‹é€‰ä¸¾<br></code></pre></td></tr></table></figure><h4 id="å¤‡ä»½"><a href="#å¤‡ä»½" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">å‘½ä»¤è¡Œå¤‡ä»½ï¼š<br>consul snapshot save backup.snap<br><br>å‘½ä»¤è¡Œæ¢å¤ï¼š<br>consul snapshot restore backup.snap<br></code></pre></td></tr></table></figure><h3 id="consulæŸ¥çœ‹å¤±æ•ˆæœåŠ¡ï¼š"><a href="#consulæŸ¥çœ‹å¤±æ•ˆæœåŠ¡ï¼š" class="headerlink" title="consulæŸ¥çœ‹å¤±æ•ˆæœåŠ¡ï¼š"></a>consulæŸ¥çœ‹å¤±æ•ˆæœåŠ¡ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl http://192.168.4.157:8500/v1/health/state/critical<br></code></pre></td></tr></table></figure><h3 id="consulåˆ é™¤å¤±æ•ˆæœåŠ¡ï¼š"><a href="#consulåˆ é™¤å¤±æ•ˆæœåŠ¡ï¼š" class="headerlink" title="consulåˆ é™¤å¤±æ•ˆæœåŠ¡ï¼š"></a>consulåˆ é™¤å¤±æ•ˆæœåŠ¡ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl -request PUT http://192.168.4.157:8500/v1/agent/service/deregister/æœåŠ¡å<br><br>ä¸€æ¡å‘½ä»¤åˆ é™¤å¤±æ•ˆæœåŠ¡ï¼š<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `curl http://192.168.4.157:8500/v1/health/state/critical | <span class="hljs-built_in">tr</span> <span class="hljs-string">&quot;,&quot;</span> <span class="hljs-string">&quot;\n&quot;</span>|grep ServiceID| awk -F <span class="hljs-string">&#x27;:|&quot;&#x27;</span> <span class="hljs-string">&#x27;&#123;print $5&#125;&#x27;</span>` ; <span class="hljs-keyword">do</span> curl -request PUT http://192.168.4.157:8500/v1/agent/service/deregister/<span class="hljs-variable">$i</span> ;<span class="hljs-keyword">done</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>consul</category>
      
    </categories>
    
    
    <tags>
      
      <tag>consul</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äºŒè¿›åˆ¶å®‰è£…consul</title>
    <link href="/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/consul/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85consul/"/>
    <url>/2023/03/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/consul/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85consul/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="äºŒè¿›åˆ¶å®‰è£…consul"><a href="#äºŒè¿›åˆ¶å®‰è£…consul" class="headerlink" title="äºŒè¿›åˆ¶å®‰è£…consul"></a>äºŒè¿›åˆ¶å®‰è£…consul</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Consul æ˜¯ HashiCorp å…¬å¸æ¨å‡ºçš„å¼€æºå·¥å…·ï¼Œç”¨äºå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿçš„æœåŠ¡å‘ç°ä¸é…ç½®ã€‚Consul ä½¿ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå› æ­¤å…·æœ‰å¤©ç„¶å¯ç§»æ¤æ€§ï¼ˆæ”¯æŒLinuxã€windowså’ŒMac OS Xï¼‰ã€‚</p><p>Consul å†…ç½®äº†æœåŠ¡æ³¨å†Œä¸å‘ç°æ¡†æ¶ã€åˆ†å¸ƒä¸€è‡´æ€§åè®®å®ç°ã€å¥åº·æ£€æŸ¥ã€Key&#x2F;Value å­˜å‚¨ã€å¤šæ•°æ®ä¸­å¿ƒæ–¹æ¡ˆï¼Œä¸å†éœ€è¦ä¾èµ–å…¶ä»–å·¥å…·ï¼ˆæ¯”å¦‚ ZooKeeper ç­‰ï¼‰ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿè¾ƒä¸ºç®€å•ã€‚</p><p>Consul éµå¾ªCAPåŸç†ä¸­çš„CPåŸåˆ™ï¼Œä¿è¯äº†å¼ºä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼Œä¸”ä½¿ç”¨çš„æ˜¯Raftç®—æ³•ï¼Œæ¯”zookeeperä½¿ç”¨çš„Paxosç®—æ³•æ›´åŠ ç®€å•ã€‚è™½ç„¶ä¿è¯äº†å¼ºä¸€è‡´æ€§ï¼Œä½†æ˜¯å¯ç”¨æ€§å°±ç›¸åº”ä¸‹é™äº†ï¼Œä¾‹å¦‚æœåŠ¡æ³¨å†Œçš„æ—¶é—´ä¼šç¨é•¿ä¸€äº›ï¼Œå› ä¸º Consul çš„ raft åè®®è¦æ±‚å¿…é¡»è¿‡åŠæ•°çš„èŠ‚ç‚¹éƒ½å†™å…¥æˆåŠŸæ‰è®¤ä¸ºæ³¨å†ŒæˆåŠŸ ï¼›åœ¨leaderæŒ‚æ‰äº†ä¹‹åï¼Œé‡æ–°é€‰ä¸¾å‡ºleaderä¹‹å‰ä¼šå¯¼è‡´Consul æœåŠ¡ä¸å¯ç”¨ã€‚</p><h2 id="ä¸€ã€consulå•æœºå®‰è£…"><a href="#ä¸€ã€consulå•æœºå®‰è£…" class="headerlink" title="ä¸€ã€consulå•æœºå®‰è£…"></a>ä¸€ã€consulå•æœºå®‰è£…</h2><h3 id="1-ä¸‹è½½å¹¶è§£å‹consul"><a href="#1-ä¸‹è½½å¹¶è§£å‹consul" class="headerlink" title="1.ä¸‹è½½å¹¶è§£å‹consul"></a>1.ä¸‹è½½å¹¶è§£å‹consul</h3><p>consulä¸‹è½½åœ°å€ï¼š<a href="https://releases.hashicorp.com/consul/">https://releases.hashicorp.com/consul/</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://releases.hashicorp.com/consul/1.12.7/consul_1.12.7_linux_amd64.zip<br><br>unzip consul_1.12.7_linux_amd64.zip<br><br><span class="hljs-built_in">mv</span> consul /usr/local/bin<br><br><span class="hljs-comment">#æµ‹è¯•æ˜¯å¦æˆåŠŸå®‰è£…</span><br>consul version<br><br><br><span class="hljs-comment">#ä½¿ç”¨å¼€å‘æ¨¡å¼å¯åŠ¨æµ‹è¯•</span><br>consul agent  -ui -node=consul-dev -client=0.0.0.0<br><br>å¯åŠ¨åå¯ä½¿ç”¨ip+8500è®¿é—®consulçš„webé¡µé¢ï¼<br></code></pre></td></tr></table></figure><h3 id="2-è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"><a href="#2-è®¾ç½®å¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="2.è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"></a>2.è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</h3><h4 id="2-1ã€æ–°å»ºä¸€ä¸ªåä¸ºconsul-serviceçš„serviceæœåŠ¡"><a href="#2-1ã€æ–°å»ºä¸€ä¸ªåä¸ºconsul-serviceçš„serviceæœåŠ¡" class="headerlink" title="2.1ã€æ–°å»ºä¸€ä¸ªåä¸ºconsul.serviceçš„serviceæœåŠ¡"></a>2.1ã€æ–°å»ºä¸€ä¸ªåä¸º<code>consul.service</code>çš„serviceæœåŠ¡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /usr/lib/systemd/system/consul.service &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Unit]</span><br><span class="hljs-string">Description=consul</span><br><span class="hljs-string">After=network.target</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">ExecStart=/usr/local/consul/start.sh</span><br><span class="hljs-string">KillSignal=SIGTERM</span><br><span class="hljs-string">    </span><br><span class="hljs-string">[Install]</span><br><span class="hljs-string">WantedBy=multi-user.target</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h4 id="2-2ã€æ–°å»ºconsulå¯åŠ¨è„šæœ¬ï¼Œä»¥ä¾¿ä¸Šè¯‰serviceæœåŠ¡è°ƒç”¨è¯¥è„šæœ¬"><a href="#2-2ã€æ–°å»ºconsulå¯åŠ¨è„šæœ¬ï¼Œä»¥ä¾¿ä¸Šè¯‰serviceæœåŠ¡è°ƒç”¨è¯¥è„šæœ¬" class="headerlink" title="2.2ã€æ–°å»ºconsulå¯åŠ¨è„šæœ¬ï¼Œä»¥ä¾¿ä¸Šè¯‰serviceæœåŠ¡è°ƒç”¨è¯¥è„šæœ¬"></a>2.2ã€æ–°å»ºconsulå¯åŠ¨è„šæœ¬ï¼Œä»¥ä¾¿ä¸Šè¯‰serviceæœåŠ¡è°ƒç”¨è¯¥è„šæœ¬</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /usr/local/consul/start.sh <br><br><span class="hljs-comment">#!/bin/bash</span><br>consul agent -server -ui -bootstrap-expect=1 -data-dir=/app/consul/data -node=agent-1 -client=0.0.0.0 -log-file=/app/consul/log/consul_log-$(<span class="hljs-built_in">date</span> +%Y-%m-%d--%H-%M) -<span class="hljs-built_in">bind</span>=192.168.62.130<br><br><span class="hljs-built_in">mkdir</span> -p /app/consul/&#123;data,<span class="hljs-built_in">log</span>&#125;<br><span class="hljs-comment">#ç»™è„šæœ¬èµ‹æƒ</span><br><span class="hljs-built_in">chmod</span> 777 /usr/local/consul/start.sh <br></code></pre></td></tr></table></figure><h3 id="3-å¯åŠ¨æœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯"><a href="#3-å¯åŠ¨æœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯" class="headerlink" title="3.å¯åŠ¨æœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯"></a>3.å¯åŠ¨æœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start consul<br>systemctl <span class="hljs-built_in">enable</span> consul <br>systemctl status consul<br></code></pre></td></tr></table></figure><h2 id="äºŒã€æ­å»ºconsulé›†ç¾¤"><a href="#äºŒã€æ­å»ºconsulé›†ç¾¤" class="headerlink" title="äºŒã€æ­å»ºconsulé›†ç¾¤"></a>äºŒã€æ­å»ºconsulé›†ç¾¤</h2><p>consul æ¶æ„:<br>Serverè´Ÿè´£ç»„æˆ cluster çš„å¤æ‚å·¥ä½œï¼ˆé€‰ä¸¾ã€çŠ¶æ€ç»´æŠ¤ã€è½¬å‘è¯·æ±‚åˆ° leadï¼‰ï¼Œä»¥åŠ consul æä¾›çš„æœåŠ¡ï¼ˆå“åº” RCP è¯·æ±‚ï¼‰ã€‚è€ƒè™‘åˆ°å®¹é”™å’Œæ”¶æ•›ï¼Œä¸€èˆ¬éƒ¨ç½² 3 ~ 5 ä¸ªæ¯”è¾ƒåˆé€‚ï¼Œè€Œclientæ•°é‡ä¸åšé™åˆ¶</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">å¯å‚è€ƒæ–‡æ¡£ï¼šhttps://littlefxc.github.io/<span class="hljs-number">2021</span>/<span class="hljs-number">01</span>/<span class="hljs-number">11</span>/Consul-<span class="hljs-variable">%E5</span><span class="hljs-variable">%8</span>D<span class="hljs-variable">%95</span><span class="hljs-variable">%E6</span><span class="hljs-variable">%9</span>C<span class="hljs-variable">%BA</span><span class="hljs-variable">%E9</span><span class="hljs-variable">%9</span>B<span class="hljs-variable">%86</span><span class="hljs-variable">%E7</span><span class="hljs-variable">%BE</span><span class="hljs-variable">%A4</span><span class="hljs-variable">%E6</span><span class="hljs-variable">%90</span><span class="hljs-variable">%AD</span><span class="hljs-variable">%E5</span><span class="hljs-variable">%BB</span><span class="hljs-variable">%BA</span>/<br></code></pre></td></tr></table></figure><h3 id="1ã€å‡†å¤‡ç¯å¢ƒ"><a href="#1ã€å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="1ã€å‡†å¤‡ç¯å¢ƒ"></a>1ã€å‡†å¤‡ç¯å¢ƒ</h3><table><thead><tr><th>IPåœ°å€</th><th>èŠ‚ç‚¹å</th></tr></thead><tbody><tr><td>192.168.62.128</td><td>consul-1</td></tr><tr><td>192.168.62.129</td><td>consul-2</td></tr><tr><td>192.168.62.130</td><td>consul-3</td></tr></tbody></table><p>å¤‡æ³¨ï¼šæœºå™¨å‡å·²ç»å…³é—­é˜²ç«å¢™ï¼Œseliunx</p><h3 id="2ã€ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…"><a href="#2ã€ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…" class="headerlink" title="2ã€ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…"></a>2ã€ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…</h3><p>consulä¸‹è½½åœ°å€ï¼š<a href="https://releases.hashicorp.com/consul/">https://releases.hashicorp.com/consul/</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://releases.hashicorp.com/consul/1.12.7/consul_1.12.7_linux_amd64.zip<br><br>unzip consul_1.12.7_linux_amd64.zip<br><br><span class="hljs-built_in">mv</span> consul /usr/local/bin<br><br><span class="hljs-comment">#æµ‹è¯•æ˜¯å¦æˆåŠŸå®‰è£…</span><br>consul version<br><br></code></pre></td></tr></table></figure><h3 id="3ã€é›†ç¾¤å¯åŠ¨"><a href="#3ã€é›†ç¾¤å¯åŠ¨" class="headerlink" title="3ã€é›†ç¾¤å¯åŠ¨"></a>3ã€é›†ç¾¤å¯åŠ¨</h3><p>consulé›†ç¾¤:å½“ä¸€ä¸ªconsul agentå¯åŠ¨åï¼Œå®ƒä¸çŸ¥é“ä»»ä½•å…¶ä»–èŠ‚ç‚¹,è¦å­¦ä¹ åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹ï¼Œagentå¿…é¡»åŠ å…¥ä¸€ä¸ªå·²ç»å­˜åœ¨çš„é›†ç¾¤(cluster)ã€‚è¦åŠ å…¥è¿™æ ·çš„é›†ç¾¤ï¼Œå®ƒåªéœ€è¦çŸ¥é“è¿™ä¸ªé›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹å³å¯ã€‚å®ƒåŠ å…¥åï¼Œå°†ä¼šå’Œè¿™ä¸ªmember gossipï¼ˆäº¤è°ˆï¼‰å¹¶è¿…é€Ÿå‘ç°é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹ã€‚ä¸€ä¸ªconsul agentå¯ä»¥åŠ å…¥ä»»ä½•ç±»å‹çš„å…¶ä»–agentï¼Œè€Œä¸åªæ˜¯é‚£äº›è¿è¡Œäºserver modeçš„agentã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /app/consul/&#123;data,<span class="hljs-built_in">log</span>&#125;<br><br><br>consul agent -server -ui -bootstrap-expect=3 -data-dir=/app/consul/data -log-file=/app/consul/log/consul_log-$(<span class="hljs-built_in">date</span> +%Y-%m-%d--%H-%M) -node=consul-1 -<span class="hljs-built_in">bind</span>=192.168.62.128 -client=0.0.0.0 -datacenter=dc1  <br><br>consul agent -server -ui -bootstrap-expect=3 -data-dir=/app/consul/data -log-file=/app/consul/log/consul_log-$(<span class="hljs-built_in">date</span> +%Y-%m-%d--%H-%M) -node=consul-2 -<span class="hljs-built_in">bind</span>=192.168.62.129 -client=0.0.0.0 -datacenter=dc1  -<span class="hljs-built_in">join</span> 192.168.62.128<br><br>consul agent -server -ui -bootstrap-expect=3 -data-dir=/app/consul/data -log-file=/app/consul/log/consul_log-$(<span class="hljs-built_in">date</span> +%Y-%m-%d--%H-%M) -node=consul-3 -<span class="hljs-built_in">bind</span>=192.168.62.130 -client=0.0.0.0 -datacenter=dc1  -<span class="hljs-built_in">join</span> 192.168.62.128<br></code></pre></td></tr></table></figure><p>Agentå„ç§å„æ ·çš„é…ç½®é€‰é¡¹ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæˆ–è€…é…ç½®æ–‡ä»¶æŒ‡å®šã€‚<br>é…ç½®ä¼˜å…ˆçº§ä¸º å‘½ä»¤è¡Œ -&gt; é…ç½®æ–‡ä»¶<br>åŠ è½½é…ç½®æ—¶ï¼Œå°†æŒ‰ç…§è¯æ³•é¡ºåºä»ç›®å½•ä¸­è¯»å–é…ç½®ã€‚ é…ç½®æ ¼å¼å¯ä»¥ä¸º HCLï¼ˆ.hclï¼‰ æˆ– JSON(.json)æ ¼å¼ã€‚</p><h3 id="4ã€æŸ¥çœ‹å¯åŠ¨ç»“æœ"><a href="#4ã€æŸ¥çœ‹å¯åŠ¨ç»“æœ" class="headerlink" title="4ã€æŸ¥çœ‹å¯åŠ¨ç»“æœ"></a>4ã€æŸ¥çœ‹å¯åŠ¨ç»“æœ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">consul members<br><br>Node           Address             Status  Type    Build  Protocol  DC   Segment<br>consul-1  192.168.62.128:8301      alive   server  1.12.7  2        dc1  &lt;all&gt;<br>consul-2  192.168.62.129:8301      alive   server  1.12.7  2        dc1  &lt;all&gt;<br>consul-3  192.168.62.130:8301      alive   server  1.12.7  2        dc1  &lt;all&gt;<br><br><br></code></pre></td></tr></table></figure><h3 id="5ã€é›†ç¾¤é‡å¯æˆ–kill-consulæ—¶-éœ€è¦åˆ é™¤-data-dirä¸‹æ‰€æœ‰æ–‡ä»¶"><a href="#5ã€é›†ç¾¤é‡å¯æˆ–kill-consulæ—¶-éœ€è¦åˆ é™¤-data-dirä¸‹æ‰€æœ‰æ–‡ä»¶" class="headerlink" title="5ã€é›†ç¾¤é‡å¯æˆ–kill consulæ—¶ éœ€è¦åˆ é™¤-data-dirä¸‹æ‰€æœ‰æ–‡ä»¶"></a>5ã€é›†ç¾¤é‡å¯æˆ–kill consulæ—¶ éœ€è¦åˆ é™¤-data-dirä¸‹æ‰€æœ‰æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">rm</span> -rf /app/consul/data/*<br></code></pre></td></tr></table></figure><h2 id="é™„ä¸Šç›¸å…³å‚æ•°å«ä¹‰"><a href="#é™„ä¸Šç›¸å…³å‚æ•°å«ä¹‰" class="headerlink" title="é™„ä¸Šç›¸å…³å‚æ•°å«ä¹‰"></a>é™„ä¸Šç›¸å…³å‚æ•°å«ä¹‰</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sh">advertise: å¹¿æ’­ç»™é›†ç¾¤ä¸­å¾—å…¶ä»–èŠ‚ç‚¹å¾—åœ°å€ï¼Œ<span class="hljs-built_in">bind</span>å‚æ•°å¯èƒ½æ— æ³•ç»‘å®šæ—¶ï¼Œä½¿ç”¨æ­¤å‚æ•°ã€‚<br><br><span class="hljs-built_in">bind</span>: ç»‘å®šé›†ç¾¤é€šä¿¡å¾—åœ°å€ï¼Œè¿™ä¸ªipåœ°å€åº”è¯¥æ˜¯å°±é›†ç¾¤å†…å¾—å…¶ä»–èŠ‚ç‚¹å¯è¾¾ï¼Œå¯æ‰¾åˆ°å¾—ã€‚ é»˜è®¤ 0.0.0.0,å°†ç»‘å®šæœºå™¨å¾—æ‰€æœ‰åœ°å€ï¼ŒåŒæ—¶æŠŠ ipv4åœ°å€å‘Šè¯‰é›†ç¾¤å¾—å…¶ä»–äººã€‚å¦‚æœæŒ‡å®š[::],å°†å¹¿æ’­IPV6åœ°å€ã€‚ å¦‚æœå­˜åœ¨å¤šä¸ªIPV4/IPV6åœ°å€ï¼Œå¯åŠ¨åˆ™æŠ¥é”™ã€‚<br><br>domain: æŒ‡å®šäº¤ç”± Consul å¤„ç†çš„DNSåŸŸï¼Œ é»˜è®¤consul, æ¯”å¦‚æ‰§è¡Œ xxx.consulæ—¶ï¼Œç”± Consul è¿›è¡ŒåŸŸåè§£æã€‚<br><br>node: èŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­çš„åç§°ã€‚ åœ¨é›†ç¾¤ä¸­ä¸€å®šæ˜¯å”¯ä¸€çš„ï¼Œé»˜è®¤ä¸ºæœºå™¨çš„HostName(ä¸»æœºå)ã€‚<br><br><span class="hljs-built_in">join</span>: åŠ å…¥ServerèŠ‚ç‚¹ï¼Œç»„æˆé›†ç¾¤ï¼Œæ— æ³•åŠ å…¥,å°†å¯åŠ¨å¤±è´¥ï¼Œ æ³¨æ„é›†ç¾¤éƒ¨ç½²æ—¶ï¼Œæ¨èä½¿ç”¨ retry-join, å°†è‡ªåŠ¨é‡è¯•Joinåˆ—è¡¨ï¼Œç›´åˆ°æˆåŠŸã€‚<br><br>retry-join: è‡ªåŠ¨åŠ å…¥å­˜åœ¨ServerèŠ‚ç‚¹ï¼Œç»„å»ºæ•°æ®ä¸­å¿ƒ, å¦‚ï¼š -retry-join<br>â€œconsul.domain.internalâ€ -retry-join â€œ10.0.4.67â€<br><br>bootstrap: ä¸æ¨èä½¿ç”¨, æ˜¯å¦å¼€å¯bootstrap æ¨¡å¼, å¦‚æœä¸€ä¸ªæ•°æ®ä¸­å¿ƒåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œ ä½¿ç”¨æ­¤æ¨¡å¼ï¼Œå…è®¸é€‰ä¸¾è‡ªå·±ä¸º<br>Leader.<br><br>bootstrap-expect: Consulå°†ä¼šç­‰åˆ°SeverèŠ‚ç‚¹æ•°è¾¾åˆ°æŒ‡å®šæ•°å€¼æ—¶ï¼Œæ‰ä¼šå¯åŠ¨é›†ç¾¤ï¼ˆè‡ªåŠ¨é€‰ä¸¾Leaderï¼‰ã€‚<br>ä»…Serveræœ‰æ­¤å‚æ•°, æ³¨æ„è¿™ä¸ªå€¼é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹è¦ä¸€è‡´ï¼Œ æˆ–ç€ä»…æŒ‡å®šä¸€ä¸ªèŠ‚ç‚¹ã€‚<br><br>client: å®¢æˆ·ç«¯è¿æ¥Serverçš„åœ°å€ï¼Œé»˜è®¤127.0.0.1ï¼Œå¯ç»‘å®šå¤šä¸ªã€‚<br><br>ui: å¯ç”¨å†…ç½® Web UI å’Œå¿…è¦çš„ HTTPè·¯ç”±ã€‚<br><br>config-fileï¼š<br>æŒ‡å®šè¦åŠ è½½çš„é…ç½®æ–‡ä»¶ï¼Œå¯å¤šæ¬¡æŒ‡å®šã€‚åé¢çš„é…ç½®å°†ä¸å‰é¢çš„é…ç½®è¿›è¡ŒMergeã€‚å•ä¸ªKVå°†ç›´æ¥ä»£æ›¿ï¼Œåˆ—è¡¨ç±»å‹å°†è¿›è¡Œè¿½åŠ ã€‚<br><br>config-dir: é…ç½®ç›®å½•ï¼Œå°†åŠ è½½ç›®å½•ä¸­çš„ .hcl æˆ– .json æ ¼å¼é…ç½®ã€‚ æ³¨æ„å­è·¯å¾„ä¸ä¼šåŠ è½½ã€‚<br><br>data-dir: Agentå­˜å‚¨çŠ¶æ€çš„çš„æ•°æ®ç›®å½•ã€‚<br><br>dev: Consulå¼€å‘æ¨¡å¼ï¼Œå¿«é€Ÿå¯åŠ¨ä¸€ä¸ªConsul Agentã€‚ ï¼ˆæ­¤æ¨¡å¼ä¸‹ï¼Œ æ‰€ä»¥æŒä¹…åŒ–å°†å…³é—­ï¼Œé€‚ç”¨å†…å­˜ï¼‰<br>æ­¤æ¨¡å¼é€‚ç”¨äºå¼€å‘é˜¶æ®µ, åœ¨æ­¤æ¨¡å¼ä¸‹Connectä¹Ÿæ˜¯å¯ç”¨çš„ï¼Œæ­¤æ¨¡å¼ä¸è¦ç”¨äºç”Ÿäº§çº§åœºæ™¯ã€‚<br><br>hcl: é…ç½®ç‰‡æ®µï¼Œå¯æŒ‡å®šå¤šæ¬¡ã€‚<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>consul</category>
      
    </categories>
    
    
    <tags>
      
      <tag>consul</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jenkinsä½¿ç”¨æ—¶é‡åˆ°çš„é—®é¢˜è®°å½•å’Œå¤„ç†</title>
    <link href="/2023/03/30/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8%E6%97%B6%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95%E5%92%8C%E5%A4%84%E7%90%86/"/>
    <url>/2023/03/30/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8%E6%97%B6%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95%E5%92%8C%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="jenkinsä½¿ç”¨æ—¶é‡åˆ°çš„é—®é¢˜è®°å½•å’Œå¤„ç†"><a href="#jenkinsä½¿ç”¨æ—¶é‡åˆ°çš„é—®é¢˜è®°å½•å’Œå¤„ç†" class="headerlink" title="jenkinsä½¿ç”¨æ—¶é‡åˆ°çš„é—®é¢˜è®°å½•å’Œå¤„ç†"></a>jenkinsä½¿ç”¨æ—¶é‡åˆ°çš„é—®é¢˜è®°å½•å’Œå¤„ç†</h1><h2 id="ä¸€ã€ç¦»çº¿å¯¼å…¥ç›¸å…³æ’ä»¶ï¼š"><a href="#ä¸€ã€ç¦»çº¿å¯¼å…¥ç›¸å…³æ’ä»¶ï¼š" class="headerlink" title="ä¸€ã€ç¦»çº¿å¯¼å…¥ç›¸å…³æ’ä»¶ï¼š"></a>ä¸€ã€ç¦»çº¿å¯¼å…¥ç›¸å…³æ’ä»¶ï¼š</h2><p>åœ¨æœ‰æ’ä»¶çš„æœºå™¨ä¸Šï¼Œå…ˆåœæ‰jkæœåŠ¡ï¼Œsystemctl stop jenkins ç„¶åè¿›å…¥åˆ°&#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;plugins&#x2F;ä¸‹ å°†é‡Œé¢çš„å†…å®¹å¤åˆ¶åˆ°ç¦»çº¿çš„æœºå™¨&#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;plugins&#x2F;ä¸‹</p><h2 id="äºŒã€jenkinsé…ç½®æ–‡ä»¶ä¸ç”Ÿæ•ˆ-åœ¨æ„å»ºä»»åŠ¡æ—¶ï¼Œä½¿ç”¨çš„æ˜¯jenkinsè´¦æˆ·ï¼Œå¯¼è‡´å‘½ä»¤æ— æƒé™æ‰§è¡Œã€‚"><a href="#äºŒã€jenkinsé…ç½®æ–‡ä»¶ä¸ç”Ÿæ•ˆ-åœ¨æ„å»ºä»»åŠ¡æ—¶ï¼Œä½¿ç”¨çš„æ˜¯jenkinsè´¦æˆ·ï¼Œå¯¼è‡´å‘½ä»¤æ— æƒé™æ‰§è¡Œã€‚" class="headerlink" title="äºŒã€jenkinsé…ç½®æ–‡ä»¶ä¸ç”Ÿæ•ˆ,åœ¨æ„å»ºä»»åŠ¡æ—¶ï¼Œä½¿ç”¨çš„æ˜¯jenkinsè´¦æˆ·ï¼Œå¯¼è‡´å‘½ä»¤æ— æƒé™æ‰§è¡Œã€‚"></a>äºŒã€jenkinsé…ç½®æ–‡ä»¶ä¸ç”Ÿæ•ˆ,åœ¨æ„å»ºä»»åŠ¡æ—¶ï¼Œä½¿ç”¨çš„æ˜¯jenkinsè´¦æˆ·ï¼Œå¯¼è‡´å‘½ä»¤æ— æƒé™æ‰§è¡Œã€‚</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">#å‚è€ƒæ–‡çŒ®ï¼šhttps://blog.csdn.net/C343500263/article/details/123400385<br></code></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ vim &#x2F;etc&#x2F;sysconfig&#x2F;jenkins ä¸ç”Ÿæ•ˆï¼Œps -ef | grep jenkins å‘ç°å¯åŠ¨çš„ç”¨æˆ·è¿˜æ˜¯ä¸ºjenkins<br>åŸå› ï¼š å¯åŠ¨å‘½ä»¤ä½¿ç”¨ systemctl start jenkins ã€‚ systemdçš„èµ„æºUnit ï¼Œåœ¨ç›®å½•&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system(Centos)æˆ–&#x2F;etc&#x2F;systemd&#x2F;system(Ubuntu)</p><p>å¯åŠ¨æœªåŠ è½½&#x2F;etc&#x2F;sysconfig&#x2F;jenkins é…ç½®ã€‚ï¼ˆä»¥ä¸‹ä¸ºcentos)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /usr/lib/systemd/system/jenkins.service <br><span class="hljs-comment">#....</span><br><span class="hljs-comment">#ä¿®æ”¹ç”¨æˆ·å’Œç»„</span><br>User=root<br>Group=root<br><span class="hljs-comment">#...</span><br><span class="hljs-comment">##ä¿®æ”¹ç«¯å£</span><br>Environment=<span class="hljs-string">&quot;JENKINS_PORT=8080&quot;</span><br><br><span class="hljs-comment">#ä¿®æ”¹åé‡å¯jenkins</span><br>systemctl restart jenkins<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€é€šè¿‡-SSH-è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œç„¶ååœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œå‘½ä»¤æ—¶"><a href="#ä¸‰ã€é€šè¿‡-SSH-è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œç„¶ååœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œå‘½ä»¤æ—¶" class="headerlink" title="ä¸‰ã€é€šè¿‡ SSH è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œç„¶ååœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œå‘½ä»¤æ—¶"></a>ä¸‰ã€é€šè¿‡ SSH è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œç„¶ååœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œå‘½ä»¤æ—¶</h2><p>ssh 192.168.94.155 #æç¤ºå¦‚ä¸‹é”™è¯¯<br>Pseudo-terminal will not be allocated because stdin is not a terminal</p><p>å› ä¸ºï¼šSSH ä¸ä¼šåˆ›å»ºäº¤äº’å¼ä¼šè¯ï¼Œå› æ­¤å®ƒä¸åœ¨äº¤äº’å¼ç»ˆç«¯ä¸­æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤å¹¶ä¸å®Œå…¨ç›¸åŒã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¦é€šè¿‡ SSH ä¼šè¯è¿è¡Œç‰¹å®šå‘½ä»¤ï¼Œéœ€è¦ä½¿ç”¨ï¼š</span><br>ssh root@192.168.94.155 <span class="hljs-string">&#x27;uname -a&#x27;</span><br><span class="hljs-comment">#æˆ–è€…ä½¿ç”¨ï¼š</span><br>ssh root@192.168.94.155 &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">pwd &amp;&amp; ip add</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h2 id="å››ã€jenkins-å…³é—­ï¼Œå¼€å¯tomcatæ—¶-æç¤ºï¼š"><a href="#å››ã€jenkins-å…³é—­ï¼Œå¼€å¯tomcatæ—¶-æç¤ºï¼š" class="headerlink" title="å››ã€jenkins å…³é—­ï¼Œå¼€å¯tomcatæ—¶ æç¤ºï¼š"></a>å››ã€jenkins å…³é—­ï¼Œå¼€å¯tomcatæ—¶ æç¤ºï¼š</h2><p>Neither the JAVA_HOME nor the JRE_HOME environment variable is defined At least one of these environment variable is needed to run this program</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ç”¨vimæ‰“å¼€tomcatçš„binç›®å½•ä¸‹çš„setclasspath.sh</span><br>vim /usr/local/tomcat/bin/setclasspath.sh<br><span class="hljs-comment"># -----------------------------------------------------------------------------</span><br><span class="hljs-comment">#  Set JAVA_HOME or JRE_HOME if not already set, ensure any provided settings</span><br><span class="hljs-comment">#  are valid and consistent with the selected start-up options and set up the</span><br><span class="hljs-comment">#  endorsed directory.</span><br><span class="hljs-comment"># -----------------------------------------------------------------------------</span><br><span class="hljs-comment"># æ·»åŠ JAVA_HOMEå’ŒJRE_HOMEä¸¤ä¸ªç¯å¢ƒå˜é‡</span><br><span class="hljs-built_in">export</span> JAVA_HOME=/usr/local/jdk1.8.0<br><span class="hljs-built_in">export</span> JRE_HOME=/usr/local/jdk1.8.0<br><span class="hljs-comment"># Make sure prerequisite environment variables are set</span><br><span class="hljs-comment">#.....</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
      <category>Jenkins</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¿œç¨‹è§¦å‘jenkinsä»»åŠ¡</title>
    <link href="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E8%BF%9C%E7%A8%8B%E8%A7%A6%E5%8F%91jenkins%E4%BB%BB%E5%8A%A1/"/>
    <url>/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E8%BF%9C%E7%A8%8B%E8%A7%A6%E5%8F%91jenkins%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="è¿œç¨‹è§¦å‘jenkinsä»»åŠ¡"><a href="#è¿œç¨‹è§¦å‘jenkinsä»»åŠ¡" class="headerlink" title="è¿œç¨‹è§¦å‘jenkinsä»»åŠ¡"></a>è¿œç¨‹è§¦å‘jenkinsä»»åŠ¡</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/u013511989/article/details/113995842<br></code></pre></td></tr></table></figure><h2 id="1ã€ç³»ç»Ÿé…ç½®ï¼šå›åˆ°é¦–é¡µï¼Œç‚¹å‡»ç”¨æˆ·åˆ—è¡¨-gt-é€‰æ‹©ç”¨æˆ·"><a href="#1ã€ç³»ç»Ÿé…ç½®ï¼šå›åˆ°é¦–é¡µï¼Œç‚¹å‡»ç”¨æˆ·åˆ—è¡¨-gt-é€‰æ‹©ç”¨æˆ·" class="headerlink" title="1ã€ç³»ç»Ÿé…ç½®ï¼šå›åˆ°é¦–é¡µï¼Œç‚¹å‡»ç”¨æˆ·åˆ—è¡¨&gt;é€‰æ‹©ç”¨æˆ·"></a><strong>1ã€ç³»ç»Ÿé…ç½®ï¼šå›åˆ°é¦–é¡µï¼Œç‚¹å‡»ç”¨æˆ·åˆ—è¡¨&gt;é€‰æ‹©ç”¨æˆ·</strong></h2><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E8%BF%9C%E7%A8%8B%E8%A7%A6%E5%8F%91jenkins%E4%BB%BB%E5%8A%A1/image-20221114135805904.png" alt="image-20221114135805904.png"></p><p>  è®¾ç½®&gt;æ·»åŠ tokenï¼Œè¾“å…¥tokenåç§°ï¼Œç”Ÿäº§tokenï¼ˆtokenéœ€è¦å¤åˆ¶ä¿å­˜ï¼‰</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E8%BF%9C%E7%A8%8B%E8%A7%A6%E5%8F%91jenkins%E4%BB%BB%E5%8A%A1/image-20221114135928703.png" alt="image-20221114135928703"></p><h2 id="2ã€ä»»åŠ¡è®¾ç½®ï¼šè¿›å…¥jobä»»åŠ¡ï¼Œé€‰æ‹©è§¦å‘è¿œç¨‹æ„å»ºï¼ˆå¯è‡ªå®šä¹‰è¿œç¨‹èº«ä»½éªŒè¯ä»¤ç‰Œï¼‰"><a href="#2ã€ä»»åŠ¡è®¾ç½®ï¼šè¿›å…¥jobä»»åŠ¡ï¼Œé€‰æ‹©è§¦å‘è¿œç¨‹æ„å»ºï¼ˆå¯è‡ªå®šä¹‰è¿œç¨‹èº«ä»½éªŒè¯ä»¤ç‰Œï¼‰" class="headerlink" title="2ã€ä»»åŠ¡è®¾ç½®ï¼šè¿›å…¥jobä»»åŠ¡ï¼Œé€‰æ‹©è§¦å‘è¿œç¨‹æ„å»ºï¼ˆå¯è‡ªå®šä¹‰è¿œç¨‹èº«ä»½éªŒè¯ä»¤ç‰Œï¼‰"></a><strong>2ã€ä»»åŠ¡è®¾ç½®ï¼šè¿›å…¥jobä»»åŠ¡ï¼Œé€‰æ‹©è§¦å‘è¿œç¨‹æ„å»ºï¼ˆå¯è‡ªå®šä¹‰è¿œç¨‹èº«ä»½éªŒè¯ä»¤ç‰Œï¼‰</strong></h2><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E8%BF%9C%E7%A8%8B%E8%A7%A6%E5%8F%91jenkins%E4%BB%BB%E5%8A%A1/image-20221114140118138.png" alt="image-20221114140118138"></p><h2 id="3ã€ä½¿ç”¨postmanè§¦å‘"><a href="#3ã€ä½¿ç”¨postmanè§¦å‘" class="headerlink" title="3ã€ä½¿ç”¨postmanè§¦å‘"></a><strong>3ã€ä½¿ç”¨<a href="https://so.csdn.net/so/search?q=postman&spm=1001.2101.3001.7020">postman</a>è§¦å‘</strong></h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#ä¸å¸¦å‚æ•°è§¦å‘ï¼š</span><br>http:<span class="hljs-regexp">//</span>admin:<span class="hljs-number">1145917</span>aeee2706f88711601f5b769deec@<span class="hljs-number">192.168</span>.<span class="hljs-number">0.196</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/job/</span>test/build?token=remotoToken<br><br><span class="hljs-comment">#å¸¦å‚æ•°è§¦å‘ï¼š</span><br>http:<span class="hljs-regexp">//</span>admin:<span class="hljs-number">1145917</span>aeee2706f88711601f5b769deec@<span class="hljs-number">192.168</span>.<span class="hljs-number">0.196</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/job/</span>test/buildWithParameters?token=test123456&amp;tag=<span class="hljs-number">0.0</span>.<span class="hljs-number">2</span><br><br><br></code></pre></td></tr></table></figure><h2 id="4ã€ä½¿ç”¨curlè§¦å‘"><a href="#4ã€ä½¿ç”¨curlè§¦å‘" class="headerlink" title="4ã€ä½¿ç”¨curlè§¦å‘"></a><strong>4ã€ä½¿ç”¨curlè§¦å‘</strong></h2><h3 id="4-1-é€šè¿‡buildè§¦å‘æ— å‚æ•°job"><a href="#4-1-é€šè¿‡buildè§¦å‘æ— å‚æ•°job" class="headerlink" title="4.1 é€šè¿‡buildè§¦å‘æ— å‚æ•°job"></a>4.1 é€šè¿‡buildè§¦å‘æ— å‚æ•°job</h3><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl -X post <span class="hljs-string">&quot;http://tokenåç§°:tokenå¯†ç @jenkinsåœ°å€/job/testforremote/build?token=remotoToken&quot;</span><br></code></pre></td></tr></table></figure><h3 id="4-2-é€šè¿‡buildWithParametersè§¦å‘æœ‰å‚æ•°job"><a href="#4-2-é€šè¿‡buildWithParametersè§¦å‘æœ‰å‚æ•°job" class="headerlink" title="4.2 é€šè¿‡buildWithParametersè§¦å‘æœ‰å‚æ•°job"></a>4.2 é€šè¿‡buildWithParametersè§¦å‘æœ‰å‚æ•°job</h3><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl -X post <span class="hljs-string">&quot;http://tokenåç§°:tokenå¯†ç @jenkinsåœ°å€/job/testforremote/build?token=remotoToken&amp;test=1&quot;</span><br><br><span class="hljs-comment">##ä¸¾ä¾‹ï¼š</span><br>curl -s -u admin:1145917aeee2706f88711601f5b769deec -X POST http://192.168.0.196:8080/job/test/buildWithParameters?token=test123456&amp;tag=0.0.1<br></code></pre></td></tr></table></figure><h3 id="4-3-é€šè¿‡ä¼ è¾“jsonè§¦å‘æœ‰å‚æ•°job"><a href="#4-3-é€šè¿‡ä¼ è¾“jsonè§¦å‘æœ‰å‚æ•°job" class="headerlink" title="4.3 é€šè¿‡ä¼ è¾“jsonè§¦å‘æœ‰å‚æ•°job"></a>4.3 é€šè¿‡ä¼ è¾“jsonè§¦å‘æœ‰å‚æ•°job</h3><p>å½“å‚æ•°æ¯”è¾ƒé•¿æ—¶ä½¿ç”¨4.2çš„æ–¹æ³•å°±ä¸è¡Œäº†ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨jsonä¼ å‚ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl -u tokenåç§°:tokenå¯†ç  -X POST -F <span class="hljs-string">&quot;token=remotoToken&quot;</span> -F json=<span class="hljs-string">&#x27;&#123;&quot;parameter&quot;:[&#123;&quot;name&quot;:&quot;test&quot;,&quot;value&quot;:&quot;1&quot;&#125;]&#125;&#x27;</span> http://jenkinsåœ°å€/job/testforremote/build<br></code></pre></td></tr></table></figure><h3 id="4-4-ä¼ è¾“æ–‡ä»¶"><a href="#4-4-ä¼ è¾“æ–‡ä»¶" class="headerlink" title="4.4 ä¼ è¾“æ–‡ä»¶"></a>4.4 ä¼ è¾“æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl -u tokenåç§°:tokenå¯†ç  -X POST -F <span class="hljs-string">&quot;token=remotoToken&quot;</span> -F json=<span class="hljs-string">&#x27;&#123;&quot;parameter&quot;:[&#123;&quot;name&quot;:&quot;test&quot;,&quot;value&quot;:&quot;1&quot;&#125;,</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
      <category>Jenkins</category>
      
      <category>Jenkinsä½¿ç”¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jenkinsé€‰æ‹©åˆ†æ”¯å’Œtagæ„å»º</title>
    <link href="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E9%80%89%E6%8B%A9%E5%88%86%E6%94%AF%E6%9E%84%E5%BB%BA/"/>
    <url>/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E9%80%89%E6%8B%A9%E5%88%86%E6%94%AF%E6%9E%84%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="jenkinsé€‰æ‹©åˆ†æ”¯å’Œtagæ„å»º"><a href="#jenkinsé€‰æ‹©åˆ†æ”¯å’Œtagæ„å»º" class="headerlink" title="jenkinsé€‰æ‹©åˆ†æ”¯å’Œtagæ„å»º"></a>jenkinsé€‰æ‹©åˆ†æ”¯å’Œtagæ„å»º</h1><h2 id="ä¸€ã€Jenkinsé€‰æ‹©åˆ†æ”¯å‘å¸ƒGitlabé¡¹ç›®"><a href="#ä¸€ã€Jenkinsé€‰æ‹©åˆ†æ”¯å‘å¸ƒGitlabé¡¹ç›®" class="headerlink" title="ä¸€ã€Jenkinsé€‰æ‹©åˆ†æ”¯å‘å¸ƒGitlabé¡¹ç›®"></a>ä¸€ã€Jenkinsé€‰æ‹©åˆ†æ”¯å‘å¸ƒGitlabé¡¹ç›®</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">å®˜æ–¹æ–‡æ¡£ï¼šhttps://plugins.jenkins.io/git-parameter/<br><br>å¯å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/yucongblog/p/12993498.html<br></code></pre></td></tr></table></figure><h3 id="1ã€éœ€è¦çš„æ’ä»¶"><a href="#1ã€éœ€è¦çš„æ’ä»¶" class="headerlink" title="1ã€éœ€è¦çš„æ’ä»¶"></a>1ã€éœ€è¦çš„æ’ä»¶</h3><ul><li>Git plugin</li><li>Git Parameter Plugin</li><li>Gitlab Plugin</li></ul><h3 id="2ã€è¿‡ç¨‹"><a href="#2ã€è¿‡ç¨‹" class="headerlink" title="2ã€è¿‡ç¨‹"></a>2ã€è¿‡ç¨‹</h3><ul><li><p>åˆ›å»ºteståˆ†æ”¯</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E9%80%89%E6%8B%A9%E5%88%86%E6%94%AF%E6%9E%84%E5%BB%BA/image-20220914161045429.png" alt="image-20220914161045429"></p></li><li><p>åˆ›å»ºä¸€ä¸ªæµæ°´çº¿é¡¹ç›®ï¼Œé€‰æ‹©å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹-&gt;é€‰æ‹©Git å‚æ•°ï¼Œè¾“å…¥åç§°(ä¸‹é¢å°†ä¼šç”¨åˆ°è¯¥å‚æ•°)ï¼Œå‚æ•°ç±»å‹é€‰æ‹©-&gt; åˆ†æ”¯ï¼Œè¾“å…¥é»˜è®¤åˆ†æ”¯åç§°ï¼ˆç›´æ¥ä½¿ç”¨å¦‚ä¸‹çš„æµæ°´çº¿è¯­æ³•ä¿å­˜ï¼Œå°†ä¼šè‡ªåŠ¨é€‰æ‹©ï¼‰</p></li></ul><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E9%80%89%E6%8B%A9%E5%88%86%E6%94%AF%E6%9E%84%E5%BB%BA/image-20220913114139787.png" alt="image-20220913114139787"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E9%80%89%E6%8B%A9%E5%88%86%E6%94%AF%E6%9E%84%E5%BB%BA/image-20220913114327388.png" alt="image-20220913114327388"></p><ul><li>ç¼–å†™æµæ°´çº¿</li></ul><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E9%80%89%E6%8B%A9%E5%88%86%E6%94%AF%E6%9E%84%E5%BB%BA/image-20220913145126454.png" alt="image-20220913145126454"></p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs gams">pipeline &#123;<br>  agent any<br>  <span class="hljs-keyword">parameters</span> &#123;<br>    gitParameter <span class="hljs-comment">branchFilter:</span> <span class="hljs-comment">&#x27;origin/(.*)&#x27;</span><span class="hljs-comment">, defaultValue:</span> <span class="hljs-comment">&#x27;main&#x27;</span><span class="hljs-comment">, name:</span> <span class="hljs-comment">&#x27;BRANCH&#x27;</span><span class="hljs-comment">, type:</span> <span class="hljs-comment">&#x27;PT_BRANCH&#x27;</span><br>  &#125;<br>  stages <span class="hljs-comment">&#123;</span><br>    stage(<span class="hljs-string">&#x27;æµ‹è¯•&#x27;</span>) &#123;<br>      steps <span class="hljs-comment">&#123;</span><br>        git <span class="hljs-comment">branch:</span> <span class="hljs-comment">&quot;$&#123;params.BRANCH&#125;&quot;</span><span class="hljs-comment">, credentialsId:</span> <span class="hljs-comment">&#x27;gitlab-root-http&#x27;</span><span class="hljs-comment">, url:</span> <span class="hljs-comment">&#x27;http://192.168.5.111:8188/root/java-fuwu.git&#x27;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E9%80%89%E6%8B%A9%E5%88%86%E6%94%AF%E6%9E%84%E5%BB%BA/image-20220913145404722.png" alt="image-20220913145404722"></p><h2 id="äºŒã€jenkinsé€‰æ‹©tagæ ‡ç­¾æ„å»º"><a href="#äºŒã€jenkinsé€‰æ‹©tagæ ‡ç­¾æ„å»º" class="headerlink" title="äºŒã€jenkinsé€‰æ‹©tagæ ‡ç­¾æ„å»º"></a>äºŒã€jenkinsé€‰æ‹©tagæ ‡ç­¾æ„å»º</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php">pipeline &#123;<br>    agent any<br>    parameters &#123;<br>        gitParameter name: <span class="hljs-string">&#x27;TAG&#x27;</span>,<br>                     type: <span class="hljs-string">&#x27;PT_TAG&#x27;</span>,<br>                     defaultValue: <span class="hljs-string">&#x27;master&#x27;</span><br>    &#125;<br>    stages &#123;<br>        <span class="hljs-title function_ invoke__">stage</span>(<span class="hljs-string">&#x27;å…‹éš†&#x27;</span>) &#123;<br>            steps &#123;<br>                <span class="hljs-title function_ invoke__">checkout</span>([<span class="hljs-variable">$class</span>: <span class="hljs-string">&#x27;GitSCM&#x27;</span>,<br>                          <span class="hljs-attr">branches</span>: [[<span class="hljs-attr">name</span>: <span class="hljs-string">&quot;$&#123;params.TAG&#125;&quot;</span>]],<br>                          <span class="hljs-attr">doGenerateSubmoduleConfigurations</span>: <span class="hljs-literal">false</span>,<br>                          <span class="hljs-attr">extensions</span>: [],<br>                          <span class="hljs-attr">gitTool</span>: <span class="hljs-string">&#x27;Default&#x27;</span>,<br>                          <span class="hljs-attr">submoduleCfg</span>: [],<br>                          //<span class="hljs-attr">userRemoteConfigs</span>:çš„<span class="hljs-attr">credentialsId</span>:<span class="hljs-number">1</span>ä¸ºjenkinsèº«ä»½ä»¤ç‰Œçš„idï¼Œåé¢ä¸ºä»£ç ä»“åº“åœ°å€<br>                          <span class="hljs-attr">userRemoteConfigs</span>: [[<span class="hljs-attr">credentialsId</span>: <span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;http://192.168.5.111:8188/root/java-fuwu.git&#x27;</span>]]<br>                        ])<br>            &#125;<br>        &#125;<br>        <span class="hljs-title function_ invoke__">stage</span>(<span class="hljs-string">&#x27;æ‰“åŒ…é¡¹ç›®&#x27;</span>) &#123;<br>            steps &#123;<br>              sh <span class="hljs-string">&quot;/usr/local/go/bin/go build -o $&#123;params.tag&#125; main.go&quot;</span><br>            &#125;<br>         &#125;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
      <category>Jenkins</category>
      
      <category>Jenkinsä½¿ç”¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JenkinsåŸºäºshellå®ç°ç®€å•çš„ä»£ç éƒ¨ç½²ï¼Œä¸gitlabçš„ä½¿ç”¨</title>
    <link href="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="JenkinsåŸºäºshellå®ç°ç®€å•çš„ä»£ç éƒ¨ç½²ï¼Œä¸gitlabçš„ä½¿ç”¨"><a href="#JenkinsåŸºäºshellå®ç°ç®€å•çš„ä»£ç éƒ¨ç½²ï¼Œä¸gitlabçš„ä½¿ç”¨" class="headerlink" title="JenkinsåŸºäºshellå®ç°ç®€å•çš„ä»£ç éƒ¨ç½²ï¼Œä¸gitlabçš„ä½¿ç”¨"></a>JenkinsåŸºäºshellå®ç°ç®€å•çš„ä»£ç éƒ¨ç½²ï¼Œä¸gitlabçš„ä½¿ç”¨</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">#å‚è€ƒè§†é¢‘ï¼šhttps://www.bilibili.com/video/BV16v411V7CQ?p=4<br>#å…¨æ–‡æ¡£ï¼šhttps://github.com/pipiguai0123/Jenkinsdoc<br></code></pre></td></tr></table></figure><h2 id="å…ˆæµ‹è¯•ä½¿ç”¨sshè¿›è¡Œä»£ç å…‹éš†ï¼š"><a href="#å…ˆæµ‹è¯•ä½¿ç”¨sshè¿›è¡Œä»£ç å…‹éš†ï¼š" class="headerlink" title="å…ˆæµ‹è¯•ä½¿ç”¨sshè¿›è¡Œä»£ç å…‹éš†ï¼š"></a>å…ˆæµ‹è¯•ä½¿ç”¨sshè¿›è¡Œä»£ç å…‹éš†ï¼š</h2><p>é¦–å…ˆåœ¨JenkinsæœåŠ¡å™¨ä¸Šç”Ÿæˆsshç§˜é’¥ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ssh-keygen -t rsa -P <span class="hljs-string">&quot;&quot;</span> -f ~/.ssh/id_rsa<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆäº†å…¬é’¥ï¼ˆid_rsa.pubï¼‰å’Œç§é’¥ï¼ˆid_rsa)</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211221112220027.png" alt="image-20211221112220027"></p><p>å°†ç”Ÿæˆçš„å…¬é’¥ï¼ˆid_rsa.pubï¼‰å¤åˆ¶åˆ°gitlabçš„SSHç§˜é’¥å†…</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211221113051193.png" alt="image-20211221113051193"></p><p>åœ¨JenkinsæœåŠ¡å™¨ä¸Šä½¿ç”¨gitå‘½ä»¤æµ‹è¯•æ˜¯å¦èƒ½è¿œç¨‹æ‹·è´gitlabä»£ç ä»“åº“å†…æ•°æ®</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211223154834727.png" alt="image-20211223154834727"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> ssh://git@192.168.94.188:2222/jiangzhenzhou/devops.git<br></code></pre></td></tr></table></figure><p><strong>æˆ‘è¿™é‡Œgitä½¿ç”¨çš„2222ç«¯å£ï¼šé‡‡ç”¨çš„æ˜¯dockerè¿è¡Œçš„gitlabï¼Œ2222ç«¯å£æ˜ å°„çš„æ˜¯gitlabå®¹å™¨22ç«¯å£</strong></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211221172045756.png" alt="image-20211221172045756"></p><p>æ‰§è¡Œå‘½ä»¤åï¼Œå‘ç°å·²ç»æ‹‰å–æˆåŠŸï¼ŒæˆåŠŸæ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211223155001524.png" alt="image-20211223155001524"></p><h2 id="ä¸€ã€é€šè¿‡jenkinsè‡ªåŠ¨åŒ–cloneä»£ç ï¼š"><a href="#ä¸€ã€é€šè¿‡jenkinsè‡ªåŠ¨åŒ–cloneä»£ç ï¼š" class="headerlink" title="ä¸€ã€é€šè¿‡jenkinsè‡ªåŠ¨åŒ–cloneä»£ç ï¼š"></a>ä¸€ã€é€šè¿‡jenkinsè‡ªåŠ¨åŒ–cloneä»£ç ï¼š</h2><h3 id="1-1ã€ç™»å½•åˆ°Jenkinsï¼Œæ–°å»ºä¸€ä¸ªä»»åŠ¡ï¼šæˆ‘è¿™é‡Œç”¨teståç§°"><a href="#1-1ã€ç™»å½•åˆ°Jenkinsï¼Œæ–°å»ºä¸€ä¸ªä»»åŠ¡ï¼šæˆ‘è¿™é‡Œç”¨teståç§°" class="headerlink" title="1.1ã€ç™»å½•åˆ°Jenkinsï¼Œæ–°å»ºä¸€ä¸ªä»»åŠ¡ï¼šæˆ‘è¿™é‡Œç”¨teståç§°"></a>1.1ã€ç™»å½•åˆ°Jenkinsï¼Œæ–°å»ºä¸€ä¸ªä»»åŠ¡ï¼šæˆ‘è¿™é‡Œç”¨teståç§°</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211223112134104.png" alt="image-20211223112134104"></p><h3 id="1-2ã€æºç ç®¡ç†-gt-gt-Git-gt-gt-æ·»åŠ URL-gt-gt-æ·»åŠ å‡­æ®"><a href="#1-2ã€æºç ç®¡ç†-gt-gt-Git-gt-gt-æ·»åŠ URL-gt-gt-æ·»åŠ å‡­æ®" class="headerlink" title="1.2ã€æºç ç®¡ç†&gt;&gt;Git&gt;&gt;æ·»åŠ URL&gt;&gt;æ·»åŠ å‡­æ®"></a>1.2ã€æºç ç®¡ç†&gt;&gt;Git&gt;&gt;æ·»åŠ URL&gt;&gt;æ·»åŠ å‡­æ®</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211223154138145.png" alt="image-20211223154138145"></p><h3 id="1-3ã€å‡­æ®ç±»å‹é€‰æ‹©-gt-gt-SSH-Username-with-private-key-gt-gt-æ·»åŠ ç§é’¥"><a href="#1-3ã€å‡­æ®ç±»å‹é€‰æ‹©-gt-gt-SSH-Username-with-private-key-gt-gt-æ·»åŠ ç§é’¥" class="headerlink" title="1.3ã€å‡­æ®ç±»å‹é€‰æ‹©&gt;&gt;SSH Username with private key &gt;&gt;æ·»åŠ ç§é’¥"></a>1.3ã€å‡­æ®ç±»å‹é€‰æ‹©&gt;&gt;SSH Username with private key &gt;&gt;æ·»åŠ ç§é’¥</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211223142334979.png" alt="image-20211223142334979"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211223142825593.png" alt="image-20211223142825593"></p><h3 id="1-4ã€å¤åˆ¶ç§é’¥ï¼š"><a href="#1-4ã€å¤åˆ¶ç§é’¥ï¼š" class="headerlink" title="1.4ã€å¤åˆ¶ç§é’¥ï¼š"></a>1.4ã€å¤åˆ¶ç§é’¥ï¼š</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cat <span class="hljs-regexp">/root/</span>.ssh/id_rsa<br></code></pre></td></tr></table></figure><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220512150151024.png" alt="image-20220512150151024"></p><h3 id="1-5ã€æ·»åŠ ç§é’¥ä»¥åï¼Œé€‰æ‹©rootã€‚å¹¶æŒ‡å®šä»£ç æ‹‰å–çš„åˆ†æ”¯"><a href="#1-5ã€æ·»åŠ ç§é’¥ä»¥åï¼Œé€‰æ‹©rootã€‚å¹¶æŒ‡å®šä»£ç æ‹‰å–çš„åˆ†æ”¯" class="headerlink" title="1.5ã€æ·»åŠ ç§é’¥ä»¥åï¼Œé€‰æ‹©rootã€‚å¹¶æŒ‡å®šä»£ç æ‹‰å–çš„åˆ†æ”¯"></a>1.5ã€æ·»åŠ ç§é’¥ä»¥åï¼Œé€‰æ‹©rootã€‚å¹¶æŒ‡å®šä»£ç æ‹‰å–çš„åˆ†æ”¯</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211223151906344.png" alt="image-20211223151906344"></p><h3 id="1-6ã€åº”ç”¨å¹¶ä¿å­˜å-gt-gt-ç‚¹å‡»â€œç«‹å³æ„å»ºâ€å³å¯å®Œæˆ"><a href="#1-6ã€åº”ç”¨å¹¶ä¿å­˜å-gt-gt-ç‚¹å‡»â€œç«‹å³æ„å»ºâ€å³å¯å®Œæˆ" class="headerlink" title="1.6ã€åº”ç”¨å¹¶ä¿å­˜å&gt;&gt;ç‚¹å‡»â€œç«‹å³æ„å»ºâ€å³å¯å®Œæˆ"></a>1.6ã€åº”ç”¨å¹¶ä¿å­˜å&gt;&gt;ç‚¹å‡»â€œç«‹å³æ„å»ºâ€å³å¯å®Œæˆ</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211223154552810.png" alt="image-20211223154552810"></p><h3 id="1-7ã€ä»¥ä¸Šæ­¥éª¤å³å¯ä½¿ç”¨Jenkinsç³»ç»Ÿæ‹‰å–gitlabä»£ç ä»“åº“ä»£ç "><a href="#1-7ã€ä»¥ä¸Šæ­¥éª¤å³å¯ä½¿ç”¨Jenkinsç³»ç»Ÿæ‹‰å–gitlabä»£ç ä»“åº“ä»£ç " class="headerlink" title="1.7ã€ä»¥ä¸Šæ­¥éª¤å³å¯ä½¿ç”¨Jenkinsç³»ç»Ÿæ‹‰å–gitlabä»£ç ä»“åº“ä»£ç "></a>1.7ã€ä»¥ä¸Šæ­¥éª¤å³å¯ä½¿ç”¨Jenkinsç³»ç»Ÿæ‹‰å–gitlabä»£ç ä»“åº“ä»£ç </h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211223160446723.png" alt="image-20211223160446723"></p><h3 id="1-8ã€æ„å»º-gt-gt-é€‰æ‹©æ‰§è¡Œshell-gt-gt-å³å¯æ·»åŠ æºshellå‘½ä»¤ï¼Œæˆ‘æ·»åŠ å‘½ä»¤ï¼š-ip-add-åšæµ‹è¯•"><a href="#1-8ã€æ„å»º-gt-gt-é€‰æ‹©æ‰§è¡Œshell-gt-gt-å³å¯æ·»åŠ æºshellå‘½ä»¤ï¼Œæˆ‘æ·»åŠ å‘½ä»¤ï¼š-ip-add-åšæµ‹è¯•" class="headerlink" title="1.8ã€æ„å»º&gt;&gt;é€‰æ‹©æ‰§è¡Œshell&gt;&gt;å³å¯æ·»åŠ æºshellå‘½ä»¤ï¼Œæˆ‘æ·»åŠ å‘½ä»¤ï¼š ip add åšæµ‹è¯•"></a>1.8ã€æ„å»º&gt;&gt;é€‰æ‹©æ‰§è¡Œshell&gt;&gt;å³å¯æ·»åŠ æºshellå‘½ä»¤ï¼Œæˆ‘æ·»åŠ å‘½ä»¤ï¼š ip add åšæµ‹è¯•</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211223160621391.png" alt="image-20211223160621391"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20211223162022256.png" alt="image-20211223162022256"></p><h3 id="1-9ã€ç‚¹å‡»â€œç«‹å³æ„å»ºâ€ä»¥åï¼Œå³å¯åœ¨æ—¥å¿—å†…çœ‹åˆ°æ‰§è¡Œçš„å‘½ä»¤ï¼Œåœ¨è¾“å‡ºçš„æ—¥å¿—ä¸­è¿›å…¥å·¥ä½œç©ºé—´ï¼Œèƒ½çœ‹åˆ°ä»£ç å·²ç»è¢«å…‹éš†"><a href="#1-9ã€ç‚¹å‡»â€œç«‹å³æ„å»ºâ€ä»¥åï¼Œå³å¯åœ¨æ—¥å¿—å†…çœ‹åˆ°æ‰§è¡Œçš„å‘½ä»¤ï¼Œåœ¨è¾“å‡ºçš„æ—¥å¿—ä¸­è¿›å…¥å·¥ä½œç©ºé—´ï¼Œèƒ½çœ‹åˆ°ä»£ç å·²ç»è¢«å…‹éš†" class="headerlink" title="1.9ã€ç‚¹å‡»â€œç«‹å³æ„å»ºâ€ä»¥åï¼Œå³å¯åœ¨æ—¥å¿—å†…çœ‹åˆ°æ‰§è¡Œçš„å‘½ä»¤ï¼Œåœ¨è¾“å‡ºçš„æ—¥å¿—ä¸­è¿›å…¥å·¥ä½œç©ºé—´ï¼Œèƒ½çœ‹åˆ°ä»£ç å·²ç»è¢«å…‹éš†"></a>1.9ã€ç‚¹å‡»â€œç«‹å³æ„å»ºâ€ä»¥åï¼Œå³å¯åœ¨æ—¥å¿—å†…çœ‹åˆ°æ‰§è¡Œçš„å‘½ä»¤ï¼Œåœ¨è¾“å‡ºçš„æ—¥å¿—ä¸­è¿›å…¥å·¥ä½œç©ºé—´ï¼Œèƒ½çœ‹åˆ°ä»£ç å·²ç»è¢«å…‹éš†</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220512151250724.png" alt="image-20220512151250724"></p><h2 id="äºŒã€é€šè¿‡shellå‘½ä»¤cloneä»£ç å¹¶éƒ¨ç½²Tomcaté¡¹ç›®"><a href="#äºŒã€é€šè¿‡shellå‘½ä»¤cloneä»£ç å¹¶éƒ¨ç½²Tomcaté¡¹ç›®" class="headerlink" title="äºŒã€é€šè¿‡shellå‘½ä»¤cloneä»£ç å¹¶éƒ¨ç½²Tomcaté¡¹ç›®"></a>äºŒã€é€šè¿‡shellå‘½ä»¤cloneä»£ç å¹¶éƒ¨ç½²Tomcaté¡¹ç›®</h2><h3 id="2-1ã€tomcatæœåŠ¡å™¨ä¿¡æ¯ï¼š"><a href="#2-1ã€tomcatæœåŠ¡å™¨ä¿¡æ¯ï¼š" class="headerlink" title="2.1ã€tomcatæœåŠ¡å™¨ä¿¡æ¯ï¼š"></a>2.1ã€tomcatæœåŠ¡å™¨ä¿¡æ¯ï¼š</h3><p>æœåŠ¡å™¨ipï¼š192.168.94.155<br>æµè§ˆå™¨é¡µé¢è®¿é—®ï¼š192.168.94.155:8080<br>htmlæ”¾ç½®è·¯å¾„ï¼š&#x2F;app&#x2F;html&#x2F;www&#x2F;<br>tomcatå®‰è£…è·¯å¾„ï¼š&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;</p><h3 id="2-2ã€åœ¨jenkinsä¸Šæ ¹æ®ä¹‹å‰çš„é…ç½®å®Œæˆåï¼Œç¼–å†™æ‰§è¡Œçš„ä»£ç "><a href="#2-2ã€åœ¨jenkinsä¸Šæ ¹æ®ä¹‹å‰çš„é…ç½®å®Œæˆåï¼Œç¼–å†™æ‰§è¡Œçš„ä»£ç " class="headerlink" title="2.2ã€åœ¨jenkinsä¸Šæ ¹æ®ä¹‹å‰çš„é…ç½®å®Œæˆåï¼Œç¼–å†™æ‰§è¡Œçš„ä»£ç "></a>2.2ã€åœ¨jenkinsä¸Šæ ¹æ®ä¹‹å‰çš„é…ç½®å®Œæˆåï¼Œç¼–å†™æ‰§è¡Œçš„ä»£ç </h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å°†ä»gitlabå…‹éš†çš„webé¡¹ç›®æ‰“åŒ…</span><br>tar -acvf web.tar.gz ./*<br><span class="hljs-comment">#åœæ­¢tomcatæœåŠ¡</span><br>ssh root@192.168.94.155 &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">/usr/local/tomcat/bin/shutdown.sh</span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment">#å°†å‹ç¼©åŒ…åˆ†å‘</span><br>scp web.tar.gz 192.168.94.155:/app/html/www<br><span class="hljs-comment">#è§£å‹æ–‡ä»¶,å¹¶å¯åŠ¨tomcat</span><br>ssh root@192.168.94.155 &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">tar -xnf /app/html/www/web.tar.gz  -C /app/html/www/</span><br><span class="hljs-string">ls -l /app/html/www</span><br><span class="hljs-string">/usr/local/tomcat/bin/startup.sh</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220513113508025.png" alt="image-20220513113508025"></p><h3 id="2-3ã€ç‚¹å‡»ç«‹å³æ„å»ºï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºã€‚æ˜¾ç¤ºSUCCESSï¼Œä»£è¡¨å·²ç»éƒ¨ç½²æˆåŠŸï¼"><a href="#2-3ã€ç‚¹å‡»ç«‹å³æ„å»ºï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºã€‚æ˜¾ç¤ºSUCCESSï¼Œä»£è¡¨å·²ç»éƒ¨ç½²æˆåŠŸï¼" class="headerlink" title="2.3ã€ç‚¹å‡»ç«‹å³æ„å»ºï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºã€‚æ˜¾ç¤ºSUCCESSï¼Œä»£è¡¨å·²ç»éƒ¨ç½²æˆåŠŸï¼"></a>2.3ã€ç‚¹å‡»ç«‹å³æ„å»ºï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºã€‚æ˜¾ç¤ºSUCCESSï¼Œä»£è¡¨å·²ç»éƒ¨ç½²æˆåŠŸï¼</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220513113626357.png" alt="image-20220513113626357"></p><h3 id="2-4ã€è®¿é—®tomcatç½‘é¡µï¼Œå‘ç°é¡¹ç›®å·²ç»éƒ¨ç½²ï¼"><a href="#2-4ã€è®¿é—®tomcatç½‘é¡µï¼Œå‘ç°é¡¹ç›®å·²ç»éƒ¨ç½²ï¼" class="headerlink" title="2.4ã€è®¿é—®tomcatç½‘é¡µï¼Œå‘ç°é¡¹ç›®å·²ç»éƒ¨ç½²ï¼"></a>2.4ã€è®¿é—®tomcatç½‘é¡µï¼Œå‘ç°é¡¹ç›®å·²ç»éƒ¨ç½²ï¼</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220513114401449.png" alt="image-20220513114401449"></p><h2 id="ä¸‰ã€jenkinsæ–°å¢èŠ‚ç‚¹"><a href="#ä¸‰ã€jenkinsæ–°å¢èŠ‚ç‚¹" class="headerlink" title="ä¸‰ã€jenkinsæ–°å¢èŠ‚ç‚¹"></a>ä¸‰ã€jenkinsæ–°å¢èŠ‚ç‚¹</h2><p>æ–°èŠ‚ç‚¹å‡†å¤‡å·¥ä½œï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>ã€å®‰è£…ç‰¹å®šçš„jdkç‰ˆæœ¬<br><span class="hljs-number">2</span>ã€åˆ›å»ºä¸masteræœºå™¨ä¸€æ ·çš„å·¥ä½œç›®å½•ï¼Œä¸€èˆ¬é»˜è®¤ä¸ºï¼š<span class="hljs-regexp">/var/</span>lib/jenkins<br>mkdir -p <span class="hljs-regexp">/var/</span>lib/jenkins<br><span class="hljs-number">3</span>ã€å®‰è£…git<br>yum install git -y<br></code></pre></td></tr></table></figure><h3 id="3-1ã€ç‚¹å‡»ç³»ç»Ÿç®¡ç†-gt-gt-èŠ‚ç‚¹ç®¡ç†-gt-gt-æ–°å»ºèŠ‚ç‚¹-gt-gt-è¾“å…¥èŠ‚ç‚¹åç§°ï¼Œå¹¶å‹¾é€‰å›ºå®šèŠ‚ç‚¹-gt-gt-create"><a href="#3-1ã€ç‚¹å‡»ç³»ç»Ÿç®¡ç†-gt-gt-èŠ‚ç‚¹ç®¡ç†-gt-gt-æ–°å»ºèŠ‚ç‚¹-gt-gt-è¾“å…¥èŠ‚ç‚¹åç§°ï¼Œå¹¶å‹¾é€‰å›ºå®šèŠ‚ç‚¹-gt-gt-create" class="headerlink" title="3.1ã€ç‚¹å‡»ç³»ç»Ÿç®¡ç†&gt;&gt;èŠ‚ç‚¹ç®¡ç†&gt;&gt;æ–°å»ºèŠ‚ç‚¹&gt;&gt;è¾“å…¥èŠ‚ç‚¹åç§°ï¼Œå¹¶å‹¾é€‰å›ºå®šèŠ‚ç‚¹&gt;&gt;create"></a>3.1ã€ç‚¹å‡»ç³»ç»Ÿç®¡ç†&gt;&gt;èŠ‚ç‚¹ç®¡ç†&gt;&gt;æ–°å»ºèŠ‚ç‚¹&gt;&gt;è¾“å…¥èŠ‚ç‚¹åç§°ï¼Œå¹¶å‹¾é€‰å›ºå®šèŠ‚ç‚¹&gt;&gt;create</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220513151121013.png" alt="image-20220513151121013"></p><h3 id="3-2ã€å¡«å†™ç›¸å…³çš„ä¿¡æ¯"><a href="#3-2ã€å¡«å†™ç›¸å…³çš„ä¿¡æ¯" class="headerlink" title="3.2ã€å¡«å†™ç›¸å…³çš„ä¿¡æ¯"></a>3.2ã€å¡«å†™ç›¸å…³çš„ä¿¡æ¯</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220513152026055.png" alt="image-20220513152026055"></p><p> #å¤‡æ³¨ï¼šé€‰æ‹©åªè¿è¡Œç»‘å®šåˆ°è¿™ä¸ªæœºå™¨çš„jobï¼šå¯ä»¥å®ç°ï¼šæ ¹æ®é¡¹ç›®æ¥è¿›è¡Œéƒ¨ç½²ï¼Œè¯¥èŠ‚ç‚¹æœºå™¨è®¾ç½®å…å¯†è®¤è¯ç­‰ã€‚å®ç°é¡¹ç›®ç®¡æ§ã€‚</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220513160011024.png" alt="image-20220513160011024"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220513154954595.png" alt="image-20220513154954595"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220513160257439.png" alt="image-20220513160257439"></p><p><strong>å¤‡æ³¨ï¼šèŠ‚ç‚¹å±æ€§æ ¹æ®ç”¨é€”å’Œå®é™…æƒ…å†µè¿›è¡Œæ·»åŠ </strong></p><h3 id="3-3ã€ç‚¹å‡»ä¿å­˜åï¼Œåˆ·æ–°çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°jenkins-agent1å·²ç»æ·»åŠ æˆåŠŸ"><a href="#3-3ã€ç‚¹å‡»ä¿å­˜åï¼Œåˆ·æ–°çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°jenkins-agent1å·²ç»æ·»åŠ æˆåŠŸ" class="headerlink" title="3.3ã€ç‚¹å‡»ä¿å­˜åï¼Œåˆ·æ–°çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°jenkins-agent1å·²ç»æ·»åŠ æˆåŠŸ"></a>3.3ã€ç‚¹å‡»ä¿å­˜åï¼Œåˆ·æ–°çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°jenkins-agent1å·²ç»æ·»åŠ æˆåŠŸ</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220513160856924.png" alt="image-20220513160856924"></p><p><strong>å¤‡æ³¨ï¼šå¦‚æœæœ‰æŠ¥é”™å’Œæ•…éšœæç¤ºï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹æ‰§è¡Œçš„æ—¥å¿—è¿›è¡Œé—®é¢˜æ’æŸ¥</strong></p><h2 id="å››ã€ä½¿ç”¨Jenkins-Piplineå®ç°éƒ¨ç½²Tomcaté¡¹ç›®"><a href="#å››ã€ä½¿ç”¨Jenkins-Piplineå®ç°éƒ¨ç½²Tomcaté¡¹ç›®" class="headerlink" title="å››ã€ä½¿ç”¨Jenkins Piplineå®ç°éƒ¨ç½²Tomcaté¡¹ç›®"></a>å››ã€ä½¿ç”¨Jenkins Piplineå®ç°éƒ¨ç½²Tomcaté¡¹ç›®</h2><p>å®˜ç½‘ï¼š<a href="https://www.jenkins.io/zh/doc/book/pipeline/">https://www.jenkins.io/zh/doc/book/pipeline/</a></p><h3 id="4-1ã€æ–°å»ºä»»åŠ¡-gt-gt-è¾“å…¥ä»»åŠ¡åç§°-gt-gt-é€‰æ‹©æµæ°´çº¿"><a href="#4-1ã€æ–°å»ºä»»åŠ¡-gt-gt-è¾“å…¥ä»»åŠ¡åç§°-gt-gt-é€‰æ‹©æµæ°´çº¿" class="headerlink" title="4.1ã€æ–°å»ºä»»åŠ¡&gt;&gt;è¾“å…¥ä»»åŠ¡åç§°&gt;&gt;é€‰æ‹©æµæ°´çº¿"></a>4.1ã€æ–°å»ºä»»åŠ¡&gt;&gt;è¾“å…¥ä»»åŠ¡åç§°&gt;&gt;é€‰æ‹©æµæ°´çº¿</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220513163848298.png" alt="image-20220513163848298"></p><h3 id="4-2ã€é€‰æ‹©æµæ°´çº¿"><a href="#4-2ã€é€‰æ‹©æµæ°´çº¿" class="headerlink" title="4.2ã€é€‰æ‹©æµæ°´çº¿"></a>4.2ã€é€‰æ‹©æµæ°´çº¿</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220516163449538.png" alt="image-20220516163449538"></p><h3 id="4-3ã€å†™å¥½Piplineè¯­å¥ï¼ˆPiplineçš„è¯­æ³•ä½¿ç”¨ï¼Œå’Œç”Ÿæˆï¼Œè¯·é˜…è¯»ã€Šäº”ã€æµæ°´çº¿è¯­æ³•çš„ä½¿ç”¨ã€‹ï¼‰"><a href="#4-3ã€å†™å¥½Piplineè¯­å¥ï¼ˆPiplineçš„è¯­æ³•ä½¿ç”¨ï¼Œå’Œç”Ÿæˆï¼Œè¯·é˜…è¯»ã€Šäº”ã€æµæ°´çº¿è¯­æ³•çš„ä½¿ç”¨ã€‹ï¼‰" class="headerlink" title="4.3ã€å†™å¥½Piplineè¯­å¥ï¼ˆPiplineçš„è¯­æ³•ä½¿ç”¨ï¼Œå’Œç”Ÿæˆï¼Œè¯·é˜…è¯»ã€Šäº”ã€æµæ°´çº¿è¯­æ³•çš„ä½¿ç”¨ã€‹ï¼‰"></a>4.3ã€å†™å¥½Piplineè¯­å¥ï¼ˆPiplineçš„è¯­æ³•ä½¿ç”¨ï¼Œå’Œç”Ÿæˆï¼Œè¯·é˜…è¯»ã€Šäº”ã€æµæ°´çº¿è¯­æ³•çš„ä½¿ç”¨ã€‹ï¼‰</h3><p>ä»¥ä¸‹ä»£ç å®ç°ï¼Œæµæ°´çº¿cloneä»£ç å¹¶éƒ¨ç½²Tomcaté¡¹ç›®ï¼ˆè„šæœ¬å¼ï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#é‡‡ç”¨è„šæœ¬å¼æ ¼å¼ç¼–å†™ï¼š</span><br>node&#123;<br>    stage(<span class="hljs-string">&quot;å…‹éš†ä»£ç &quot;</span>) &#123;<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;å…‹éš†ä»£ç &quot;</span><br>sh <span class="hljs-string">&quot;cd /var/lib/jenkins/workspace/test-web &amp;&amp; rm -rf ./*&quot;</span><br>        git branch: <span class="hljs-string">&#x27;main&#x27;</span>, credentialsId: <span class="hljs-string">&#x27;81fe0c81-01bd-4d7e-8e08-a5d22d8fd6a9&#x27;</span>, url: <span class="hljs-string">&#x27;ssh://git@192.168.31.194:2222/root/web.git&#x27;</span><br>      &#125;<br>stage(<span class="hljs-string">&quot;æ‰“åŒ…é¡¹ç›®&quot;</span>) &#123;<br>        sh <span class="hljs-string">&quot;tar -acvf web.tar.gz ./* &quot;</span><br>      &#125;<br>    stage(<span class="hljs-string">&quot;å…³é—­æœåŠ¡&quot;</span>) &#123;<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;å…³é—­æœåŠ¡&quot;</span><br>sh <span class="hljs-string">&#x27;ssh root@192.168.94.155 &quot;/bin/bash /usr/local/tomcat/bin/shutdown.sh &amp;&amp; rm -rf /app/html/www/*&quot;&#x27;</span><br>      &#125;<br>    stage(<span class="hljs-string">&quot;ä»£ç éƒ¨ç½²&quot;</span>) &#123;<br>        sh <span class="hljs-string">&#x27;scp web.tar.gz 192.168.94.155:/app/html/www&#x27;</span><br>    sh <span class="hljs-string">&#x27;ssh root@192.168.94.155 &quot;tar -xnf /app/html/www/web.tar.gz  -C /app/html/www/ &amp;&amp; ls -l /app/html/www&quot;&#x27;</span><br>      &#125;<br>    stage(<span class="hljs-string">&quot;å¼€å¯æœåŠ¡&quot;</span>) &#123;<br>    sh <span class="hljs-string">&#x27;ssh root@192.168.94.155 &quot;/usr/local/tomcat/bin/startup.sh&quot;&#x27;</span><br>      &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›´æ¥ç‚¹å‡»æ„å»ºå³å¯ï¼š</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220516163808779.png" alt="image-20220516163808779"></p><h2 id="äº”ã€æµæ°´çº¿è¯­æ³•çš„ä½¿ç”¨ï¼š"><a href="#äº”ã€æµæ°´çº¿è¯­æ³•çš„ä½¿ç”¨ï¼š" class="headerlink" title="äº”ã€æµæ°´çº¿è¯­æ³•çš„ä½¿ç”¨ï¼š"></a>äº”ã€æµæ°´çº¿è¯­æ³•çš„ä½¿ç”¨ï¼š</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">piplineè¯­æ³•:<br>Stage:é˜¶æ®µ,ä¸€ä¸ªpiplineå¯ä»¥åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªstageï¼Œæ¯ä¸ªstageéƒ½æ˜¯ä¸€ä¸ªæ“ä½œæ­¥éª¤ï¼Œæ¯”å¦‚ <span class="hljs-built_in">clone</span>ä»£ç ã€ä»£ç ç¼–è¯‘ã€ä»£ç æµ‹è¯•å’Œä»£ç éƒ¨ç½²ï¼Œé˜¶æ®µæ˜¯ä¸€ä¸ªé€»è¾‘åˆ†ç»„ï¼Œå¯ä»¥è·¨å¤šä¸ªnodeæ‰§è¡Œ<br>Node:èŠ‚ç‚¹ï¼Œæ¯ä¸ªnodeéƒ½æ˜¯ä¸€ä¸ªjenkinsèŠ‚ç‚¹ï¼Œå¯ä»¥æ˜¯jenkins masterä¹Ÿå¯ä»¥æ˜¯jenkins agentï¼Œnodeæ˜¯æ‰§è¡Œstepçš„å…·ä½“æœåŠ¡å™¨ã€‚<br>    Step:æ­¥éª¤ï¼Œstepæ˜¯jenkins piplineæœ€åŸºæœ¬çš„æ“ä½œå•å…ƒï¼Œä»åœ¨æœåŠ¡å™¨åˆ›å»ºç›®å½•åˆ°æ„å»ºå®¹å™¨é•œåƒï¼Œç”±å„ç±»Jenkins æ’ä»¶æä¾›å®ç°ï¼Œä¸€ä¸ªstageä¸­å¯ä»¥æœ‰å¤šä¸ªstepï¼Œä¾‹å¦‚: shâ€œmake<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="5-1ã€jenkinsè‡ªå¸¦äº†æµæ°´çº¿çš„è¯­æ³•ç”Ÿæˆï¼š"><a href="#5-1ã€jenkinsè‡ªå¸¦äº†æµæ°´çº¿çš„è¯­æ³•ç”Ÿæˆï¼š" class="headerlink" title="5.1ã€jenkinsè‡ªå¸¦äº†æµæ°´çº¿çš„è¯­æ³•ç”Ÿæˆï¼š"></a>5.1ã€jenkinsè‡ªå¸¦äº†æµæ°´çº¿çš„è¯­æ³•ç”Ÿæˆï¼š</h3><p>ä¾‹å¦‚ï¼šè‡ªåŠ¨ç”Ÿæˆgitçš„è¿æ¥ä¸²</p><p>é€‰æ‹©æµæ°´çº¿è¯­æ³•&gt;&gt;é€‰æ‹©ç¤ºä¾‹æ­¥éª¤&gt;&gt;é€‰æ‹©git&gt;&gt;å¡«å†™ä¿¡æ¯åï¼Œç”Ÿæˆæµæ°´çº¿è„šæœ¬</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220516163648835.png" alt="image-20220516163648835"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220516170143369.png" alt="image-20220516170143369"></p><h3 id="5-2ã€piplineè„šæœ¬å¼æµæ°´çº¿ä¸å£°æ˜å¼æµæ°´çº¿"><a href="#5-2ã€piplineè„šæœ¬å¼æµæ°´çº¿ä¸å£°æ˜å¼æµæ°´çº¿" class="headerlink" title="5.2ã€piplineè„šæœ¬å¼æµæ°´çº¿ä¸å£°æ˜å¼æµæ°´çº¿"></a>5.2ã€piplineè„šæœ¬å¼æµæ°´çº¿ä¸å£°æ˜å¼æµæ°´çº¿</h3><p>ä»¥ä¸‹ä¸ºè„šæœ¬å¼æµæ°´çº¿ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">//nodeçš„jenkins-agent1:æŒ‡åœ¨ä»£ç†jenkins-agent1ä¸Šæ‰§è¡Œ<br>node(<span class="hljs-string">&quot;jenkins-agent1&quot;</span>)&#123; <br>      stage(<span class="hljs-string">&quot;å…‹éš†ä»£ç &quot;</span>) &#123;  // å®šä¹‰ <span class="hljs-string">&quot;å…‹éš†ä»£ç &quot;</span> é˜¶æ®µã€‚<br>           <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;å…‹éš†ä»£ç &quot;</span><br>  sh <span class="hljs-string">&quot;cd /var/lib/jenkins/workspace/test-web &amp;&amp; rm -rf ./*&quot;</span><br>           git branch: <span class="hljs-string">&#x27;main&#x27;</span>, credentialsId: <span class="hljs-string">&#x27;81fe0c81-01bd-4d7e-8e08-a5d22d8fd6a9&#x27;</span>, url: <span class="hljs-string">&#x27;ssh://git@192.168.31.194:2222/root/web.git&#x27;</span><br>        &#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ä¸ºå£°æ˜å¼æµæ°´çº¿ :</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs sh"> pipeline &#123;<br>    agent any //åœ¨ä»»ä½•å¯ç”¨çš„ä»£ç†ä¸Šï¼Œæ‰§è¡Œæµæ°´çº¿æˆ–å®ƒçš„ä»»ä½•é˜¶æ®µ<br>    //agent &#123; node &#123; label <span class="hljs-string">&#x27;jenkins-agent1&#x27;</span>   //åœ¨ä»£ç†jenkins-agent1ä¸Šæ‰§è¡Œ<br>    //  customWorkspace <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;workspace&#125;</span>&quot;</span> //æŒ‡å®šè¿è¡Œçš„å·¥ä½œç›®å½•ï¼ˆä¸å†™ä¸ºé»˜è®¤è·¯å¾„ï¼‰<br>    //      &#125;    &#125; <br>    options &#123;<br>        timestamps()          //æ—¥å¿—ä¼šæœ‰æ—¶é—´<br>        skipDefaultCheckout() //åˆ é™¤éšå¼checkout scmè¯­å¥<br>        disableConcurrentBuilds() //ç¦æ­¢å¹¶è¡Œ<br>        <span class="hljs-built_in">timeout</span>(time: 1, unit: <span class="hljs-string">&#x27;HOURS&#x27;</span> )  //æµæ°´çº¿è¶…æ—¶è®¾ç½®1hï¼Œè¶…æ—¶è‡ªåŠ¨ç»“æŸ<br>    &#125;<br>    stages &#123;<br>        stage(<span class="hljs-string">&#x27;Build&#x27;</span>) &#123;  // å®šä¹‰ <span class="hljs-string">&quot;Build&quot;</span> é˜¶æ®µã€‚<br>            steps &#123;<br>              //agent &#123; label <span class="hljs-string">&#x27;master1&#x27;</span>&#125;  è¯¥æ­¥éª¤åœ¨master1ä¸Šæ‰§è¡Œ<br>              <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;å…‹éš†ä»£ç &quot;</span><br>              sh <span class="hljs-string">&quot;cd /var/lib/jenkins/workspace/test-web &amp;&amp; rm -rf ./*&quot;</span>  /<br>              //æ‰§è¡Œä¸ <span class="hljs-string">&quot;Build&quot;</span> é˜¶æ®µç›¸å…³çš„æ­¥éª¤ã€‚<br>            &#125;<br>        &#125;<br>        stage(<span class="hljs-string">&#x27;Test&#x27;</span>) &#123; <br>            steps &#123;<br>                // <br>            &#125;<br>        &#125;<br>    &#125;<br>    //æ„å»ºåæ“ä½œ<br>    post &#123;<br>       always &#123;<br>           script&#123;<br>               println(<span class="hljs-string">&quot;always&quot;</span>)<br>           &#125;<br>       &#125;<br>       success &#123; //æˆåŠŸåæ‰§è¡Œ<br>           script&#123;<br>           currentBuild.description = <span class="hljs-string">&quot;\n æ„å»ºæˆåŠŸï¼&quot;</span><br>           &#125;<br>       &#125;<br>       failure &#123; //å¤±è´¥åæ‰§è¡Œ<br>           script&#123;<br>           currentBuild.description = <span class="hljs-string">&quot;\n æ„å»ºå¤±è´¥ï¼&quot;</span><br>           &#125;<br>       &#125;<br>       aborted &#123; //å–æ¶ˆåæ‰§è¡Œ<br>       script&#123;<br>           currentBuild.description = <span class="hljs-string">&quot;\n æ„å»ºå–æ¶ˆï¼&quot;</span>  //å…¨å±€æ„å»ºæè¿°<br>           &#125;<br>       &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5-3ã€å®æˆ˜ï¼š"><a href="#5-3ã€å®æˆ˜ï¼š" class="headerlink" title="5.3ã€å®æˆ˜ï¼š"></a>5.3ã€å®æˆ˜ï¼š</h3><p>æ ¹æ®ã€Šå››ã€ä½¿ç”¨Jenkins Piplineå®ç°éƒ¨ç½²Tomcaté¡¹ç›®ã€‹4.3 ä¸­ç¼–å†™æµæ°´çº¿</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs sh">pipeline &#123;<br>agent &#123;<br>    label <span class="hljs-string">&#x27;master&#x27;</span><br>&#125;<br>options &#123;<br>    timestamps()<br>    <span class="hljs-built_in">timeout</span>(time: 1, unit: <span class="hljs-string">&#x27;HOURS&#x27;</span> )<br>&#125;<br>stages &#123;<br>stage(<span class="hljs-string">&#x27;å…‹éš†ä»£ç &#x27;</span>) &#123;<br>steps &#123;<br>sh <span class="hljs-string">&quot;cd /var/lib/jenkins/workspace/test-web &amp;&amp; rm -rf ./*&quot;</span><br>git branch: <span class="hljs-string">&#x27;main&#x27;</span>, credentialsId: <span class="hljs-string">&#x27;81fe0c81-01bd-4d7e-8e08-a5d22d8fd6a9&#x27;</span>, url: <span class="hljs-string">&#x27;ssh://git@192.168.31.194:2222/root/web.git&#x27;</span><br>              &#125;<br>&#125;<br>stage(<span class="hljs-string">&#x27;æ‰“åŒ…é¡¹ç›®&#x27;</span>) &#123;<br>steps &#123;<br>sh <span class="hljs-string">&quot;tar -acvf web.tar.gz ./* &quot;</span><br><br>&#125;<br>&#125;<br>stage(<span class="hljs-string">&#x27;å…³é—­æœåŠ¡&#x27;</span>) &#123;<br>steps &#123;<br>sh <span class="hljs-string">&#x27;ssh root@192.168.94.155 &quot;/bin/bash /usr/local/tomcat/bin/shutdown.sh &amp;&amp; rm -rf /app/html/www/*&quot;&#x27;</span><br>&#125;<br>&#125;<br>stage(<span class="hljs-string">&#x27;ä»£ç éƒ¨ç½²&#x27;</span>) &#123;<br>steps &#123;<br>sh <span class="hljs-string">&#x27;scp web.tar.gz 192.168.94.155:/app/html/www&#x27;</span><br>sh <span class="hljs-string">&#x27;ssh root@192.168.94.155 &quot;tar -xnf /app/html/www/web.tar.gz  -C /app/html/www/ &amp;&amp; ls -l /app/html/www&quot;&#x27;</span><br>&#125;<br>&#125;<br>stage(<span class="hljs-string">&#x27;å¼€å¯æœåŠ¡&#x27;</span>) &#123;<br>steps &#123;<br>sh <span class="hljs-string">&#x27;ssh root@192.168.94.155 &quot;/usr/local/tomcat/bin/startup.sh&quot;&#x27;</span><br><br>&#125;<br>&#125;<br>&#125;<br>post &#123;<br>failure &#123; //å¤±è´¥åæ‰§è¡Œ<br>script&#123;<br>currentBuild.description = <span class="hljs-string">&quot;\n æ„å»ºå¤±è´¥ï¼&quot;</span><br>&#125;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ„å»ºåï¼Œè¾“å‡ºç»“æœï¼š</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220520145838621.png" alt="image-20220520145838621"></p><h3 id="5-4ã€è®¾ç½®æµæ°´çº¿è¯­æ³•çš„ç‰ˆæœ¬æ§åˆ¶ã€‚"><a href="#5-4ã€è®¾ç½®æµæ°´çº¿è¯­æ³•çš„ç‰ˆæœ¬æ§åˆ¶ã€‚" class="headerlink" title="5.4ã€è®¾ç½®æµæ°´çº¿è¯­æ³•çš„ç‰ˆæœ¬æ§åˆ¶ã€‚"></a>5.4ã€è®¾ç½®æµæ°´çº¿è¯­æ³•çš„ç‰ˆæœ¬æ§åˆ¶ã€‚</h3><p>åˆ›å»ºJenkinsfileå­˜æ”¾æµæ°´çº¿pipelineè¯­æ³•ï¼Œå¹¶å°†Jenkinsflieæ¨é€åˆ°gitlabä»“åº“</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220519100701675.png" alt="image-20220519100701675"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220519100309698.png" alt="image-20220519100309698"></p><p>ä¿®æ”¹æµæ°´çº¿é…ç½®</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220519101520819.png" alt="image-20220519101520819"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220519101704757.png" alt="image-20220519101704757"></p><p>##å¤‡æ³¨ï¼šè„šæœ¬è·¯å¾„ä¸ºä¸Šä¼ åˆ°gitlabçš„ä»“åº“è·¯å¾„ï¼Œæˆ‘çš„ä¸ºä¸»é¡µï¼Œæ‰€ä»¥è·¯å¾„ä¸ºï¼šJenkinsï¼Œå¦‚æœæ˜¯åœ¨scriptsä¸‹,å°±å†™:scripts&#x2F;Jenkinsfile</p><p>ä¿å­˜åç‚¹æ„å»ºå³å¯ï¼</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220520143652198.png" alt="image-20220520143652198"></p><h3 id="5-5ã€jenkinså…±äº«åº“"><a href="#5-5ã€jenkinså…±äº«åº“" class="headerlink" title="5.5ã€jenkinså…±äº«åº“"></a>5.5ã€jenkinså…±äº«åº“</h3><p>æœ¬äººgithubä¸Šå…±äº«åº“åœ°å€ä¸ºï¼š<a href="https://github.com/pipiguai0123/JenkinsShareLibrary">https://github.com/pipiguai0123/JenkinsShareLibrary</a></p><h3 id="5-5-1ã€jenkinsè®¾ç½®ï¼š"><a href="#5-5-1ã€jenkinsè®¾ç½®ï¼š" class="headerlink" title="5.5.1ã€jenkinsè®¾ç½®ï¼š"></a>5.5.1ã€jenkinsè®¾ç½®ï¼š</h3><p>ç³»ç»Ÿç®¡ç†&gt;ç³»ç»Ÿé…ç½®&gt;Global Pipeline Libraries</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220609165726963.png" alt="image-20220609165726963"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220609165811130.png" alt="image-20220609165811130"></p><p>å¤‡æ³¨ï¼šå› ä¸ºæˆ‘è¿™è¾¹ä½¿ç”¨çš„æ˜¯githubä¸Šçš„ï¼Œæ‰€ä»¥ä»“åº“ä½¿ç”¨çš„æ˜¯githubä¸Šçš„ï¼Œå…¬å¸å†…éƒ¨ä½¿ç”¨gitlabçš„è¯ï¼Œä»¥ä¸‹ä¸ºä¸¾ä¾‹ï¼Œé‡‡ç”¨gitlabåœ°å€ï¼š</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220609165914728.png" alt="image-20220609165914728"></p><p>jenkinså…±äº«åº“çš„æ–‡ä»¶ç»“æ„ä¸ºï¼š</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220609160829641.png" alt="image-20220609160829641"></p><h3 id="5-5-2ã€ä½¿ç”¨githubå…±äº«åº“å®ç°ã€Šä½¿ç”¨Jenkins-Piplineå®ç°éƒ¨ç½²Tomcaté¡¹ç›®ï¼Œæ„å»ºçš„çŠ¶æ€å‘é€é‚®ä»¶ã€‹ï¼š"><a href="#5-5-2ã€ä½¿ç”¨githubå…±äº«åº“å®ç°ã€Šä½¿ç”¨Jenkins-Piplineå®ç°éƒ¨ç½²Tomcaté¡¹ç›®ï¼Œæ„å»ºçš„çŠ¶æ€å‘é€é‚®ä»¶ã€‹ï¼š" class="headerlink" title="5.5.2ã€ä½¿ç”¨githubå…±äº«åº“å®ç°ã€Šä½¿ç”¨Jenkins Piplineå®ç°éƒ¨ç½²Tomcaté¡¹ç›®ï¼Œæ„å»ºçš„çŠ¶æ€å‘é€é‚®ä»¶ã€‹ï¼š"></a>5.5.2ã€ä½¿ç”¨githubå…±äº«åº“å®ç°ã€Šä½¿ç”¨Jenkins Piplineå®ç°éƒ¨ç½²Tomcaté¡¹ç›®ï¼Œæ„å»ºçš„çŠ¶æ€å‘é€é‚®ä»¶ã€‹ï¼š</h3><p>éœ€è¦å…ˆå°†jenkinsè®¾ç½®é‚®ä»¶å‘é€ï¼Œå…·ä½“å¯å‚è€ƒã€Šjenkinsä½¿ç”¨â€“jenkinsè®¾ç½®é‚®ä»¶å‘é€ã€‹æ–‡æ¡£ã€‚</p><p>æˆ‘è¿™è¾¹å·²å°†Piplineä»£ç ä¸Šä¼ åˆ°äº†githubä¸Šçš„test.jenkinsfilesï¼Œä»¥ä¸‹ä¸ºtest.jenkinsè¯¦è§£</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#!groovy</span><br><br>@Library(<span class="hljs-string">&#x27;jenkinslibrary@main&#x27;</span>) _ <br>//è¡¨ç¤ºè°ƒç”¨ä¸Šè¾¹é…ç½®å…±äº«åº“æ­¥éª¤é…ç½®çš„åå­—ï¼Œè¿™é‡Œè¿˜å¯ä»¥é€šè¿‡è·Ÿä¸Šä¸åŒåç¼€æ ‡è¯†é€‰æ‹©ä¸åŒåˆ†æ”¯ã€‚ é»˜è®¤æ˜¯ master åˆ†æ”¯ï¼Œè¿™é‡Œå› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯ main åˆ†æ”¯ï¼Œæ‰€ä»¥éœ€è¦æ˜¾å¼æŒ‡å®š<br><br>def toemail = new org.devops.toemail()<br>//ä½¿ç”¨/src/org/devopsä¸‹çš„toemailç±»<br>userEmail = <span class="hljs-string">&quot;1962821461@qq.com&quot;</span><br>//å®šä¹‰å‘é€çš„é‚®ç®±åœ°å€<br>pipeline&#123;<br>    agent &#123; label <span class="hljs-string">&#x27;master&#x27;</span> &#125;<br>    <br>    stages&#123;<br>            //<span class="hljs-comment">#çœç•¥å†…å®¹</span><br>        &#125;<br><br>    post &#123;<br>        always&#123;<br>            script&#123;<br>                println(<span class="hljs-string">&quot;always&quot;</span>)<br>            &#125;<br>        &#125;<br>        <br>        success&#123;<br>            script&#123;<br>                println(<span class="hljs-string">&quot;success&quot;</span>)<br>                //å¯¹åº”/src/org/devopsä¸‹ç±»ä¼ é€’çš„å˜é‡ï¼Œä¼ é€’â€œæµæ°´çº¿æˆåŠŸâ€å’Œâ€œé‚®ç®±åœ°å€â€<br>                toemail.Email(<span class="hljs-string">&quot;æµæ°´çº¿æˆåŠŸï¼&quot;</span>,userEmail)<br>            <br>            &#125;<br>        <br>        &#125;<br><span class="hljs-comment">#....çœç•¥....</span><br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>æ–°å¢æµæ°´çº¿ï¼Œè®¾ç½®æµæ°´çº¿é…ç½®ï¼Œé‡‡ç”¨ç™»å½•è·å–è®¾ç½®</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220609164938179.png" alt="image-20220609164938179"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220609165143255.png" alt="image-20220609165143255"></p><p>#ä¿å­˜åæ„å»ºï¼š</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220609170329170.png" alt="image-20220609170329170"></p><p>æ„å»ºåï¼Œå°†ä¼šæ”¶åˆ°ç›¸å…³é‚®ä»¶é€šçŸ¥ï¼š</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E5%AE%9E%E8%B7%B5/Jenkins%E5%9F%BA%E4%BA%8Eshell%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%EF%BC%8C%E4%B8%8Egitlab%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220609170426188.png" alt="image-20220609170426188"></p><p>å…·ä½“æ›´åŠ å¤æ‚çš„å¯å‚è€ƒæ–‡æ¡£ï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs txt"><br>å­¦ä¹ å¯å‚è€ƒæ–‡æ¡£ï¼šhttps://wiki.eryajf.net/pages/2415.html#_1-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%E3%80%82<br><br>æ–‡æ¡£åœ°å€ï¼šhttps://github.com/pipiguai0123/Jenkinsdoc<br><br>å­¦ä¹ è§†é¢‘ï¼šhttps://www.bilibili.com/video/BV1YJ411G7Yz?spm_id_from=333.337.search-card.all.click<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Devops</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jenkinsè®¾ç½®å‘é€é‚®ä»¶é€šçŸ¥</title>
    <link href="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/"/>
    <url>/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Jenkinsè®¾ç½®å‘é€é‚®ä»¶é€šçŸ¥"><a href="#Jenkinsè®¾ç½®å‘é€é‚®ä»¶é€šçŸ¥" class="headerlink" title="Jenkinsè®¾ç½®å‘é€é‚®ä»¶é€šçŸ¥"></a>Jenkinsè®¾ç½®å‘é€é‚®ä»¶é€šçŸ¥</h1><p>Jenkinsä¸­é…ç½®é‚®ä»¶å‘é€æœ‰2ä¸­å½¢å¼ï¼Œä¸€ç§æ˜¯åœ¨piplineé¡¹ç›®ä¸­ï¼Œå¦ä¸€ç§æ˜¯åœ¨è‡ªç”±é£æ ¼é¡¹ç›®ä¸­ï¼ˆæ­¤å¤„ç§°ä¸ºshellæ¨¡å¼ï¼‰</p><p><strong>Jenkinsæµæ°´çº¿æ‰§è¡Œå®Œæˆåå‘é€é‚®ä»¶é€šçŸ¥ï¼š</strong></p><h2 id="1ã€Jenkinséœ€è¦å…ˆé…ç½®é‚®ä»¶é€šçŸ¥ã€ä½¿ç”¨QQé‚®ç®±ï¼Œè®¾ç½®SMTPæœåŠ¡å™¨åœ°å€ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚å¯ä»¥é€šè¿‡å‘é€æµ‹è¯•é‚®ä»¶æµ‹è¯•æ˜¯å¦é…ç½®å®Œæˆï¼"><a href="#1ã€Jenkinséœ€è¦å…ˆé…ç½®é‚®ä»¶é€šçŸ¥ã€ä½¿ç”¨QQé‚®ç®±ï¼Œè®¾ç½®SMTPæœåŠ¡å™¨åœ°å€ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚å¯ä»¥é€šè¿‡å‘é€æµ‹è¯•é‚®ä»¶æµ‹è¯•æ˜¯å¦é…ç½®å®Œæˆï¼" class="headerlink" title="1ã€Jenkinséœ€è¦å…ˆé…ç½®é‚®ä»¶é€šçŸ¥ã€ä½¿ç”¨QQé‚®ç®±ï¼Œè®¾ç½®SMTPæœåŠ¡å™¨åœ°å€ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚å¯ä»¥é€šè¿‡å‘é€æµ‹è¯•é‚®ä»¶æµ‹è¯•æ˜¯å¦é…ç½®å®Œæˆï¼"></a>1ã€Jenkinséœ€è¦å…ˆé…ç½®é‚®ä»¶é€šçŸ¥ã€ä½¿ç”¨QQé‚®ç®±ï¼Œè®¾ç½®SMTP<a href="https://cloud.tencent.com/product/cvm?from=10680">æœåŠ¡å™¨</a>åœ°å€ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚å¯ä»¥é€šè¿‡å‘é€æµ‹è¯•é‚®ä»¶æµ‹è¯•æ˜¯å¦é…ç½®å®Œæˆï¼</h2><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/image-20220609104228187.png" alt="image-20220609104228187"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/image-20220609104309635.png" alt="image-20220609104309635"></p><h2 id="2ã€å®‰è£…æ’ä»¶Email-Extensionï¼Œç„¶åè¿›å…¥ç³»ç»Ÿç®¡ç†-gt-ç³»ç»Ÿè®¾ç½®-gt-Extended-E-email-Notificationã€‚ä¾æ—§ä½¿ç”¨çš„æ˜¯QQé‚®ç®±ï¼Œå¡«å†™SMTPæœåŠ¡å™¨åœ°å€smtp-qq-com-å’Œç«¯å£-465æ³¨æ„è¦å¼€å¯SSLï¼Œå¯†ç ä¸ºæˆæƒç ã€‚"><a href="#2ã€å®‰è£…æ’ä»¶Email-Extensionï¼Œç„¶åè¿›å…¥ç³»ç»Ÿç®¡ç†-gt-ç³»ç»Ÿè®¾ç½®-gt-Extended-E-email-Notificationã€‚ä¾æ—§ä½¿ç”¨çš„æ˜¯QQé‚®ç®±ï¼Œå¡«å†™SMTPæœåŠ¡å™¨åœ°å€smtp-qq-com-å’Œç«¯å£-465æ³¨æ„è¦å¼€å¯SSLï¼Œå¯†ç ä¸ºæˆæƒç ã€‚" class="headerlink" title="2ã€å®‰è£…æ’ä»¶Email Extensionï¼Œç„¶åè¿›å…¥ç³»ç»Ÿç®¡ç†-&gt; ç³»ç»Ÿè®¾ç½® -&gt;Extended E-email Notificationã€‚ä¾æ—§ä½¿ç”¨çš„æ˜¯QQé‚®ç®±ï¼Œå¡«å†™SMTPæœåŠ¡å™¨åœ°å€smtp.qq.com å’Œç«¯å£ 465æ³¨æ„è¦å¼€å¯SSLï¼Œå¯†ç ä¸ºæˆæƒç ã€‚"></a>2ã€å®‰è£…æ’ä»¶<code>Email Extension</code>ï¼Œç„¶åè¿›å…¥ç³»ç»Ÿç®¡ç†-&gt; <code>ç³»ç»Ÿè®¾ç½®</code> -&gt;<code>Extended E-email Notification</code>ã€‚ä¾æ—§ä½¿ç”¨çš„æ˜¯QQé‚®ç®±ï¼Œå¡«å†™SMTP<a href="https://cloud.tencent.com/product/cvm?from=10680">æœåŠ¡å™¨</a>åœ°å€<code>smtp.qq.com</code> å’Œç«¯å£ <code>465</code>æ³¨æ„è¦å¼€å¯SSLï¼Œå¯†ç ä¸ºæˆæƒç ã€‚</h2><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/image-20220609102329749.png" alt="image-20220609102329749"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/image-20220609102443096.png" alt="image-20220609102443096"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/image-20220609102544398.png" alt="image-20220609102544398"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/image-20220609102730225.png" alt="image-20220609102730225"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/image-20220609102631627.png" alt="image-20220609102631627"></p><p><strong>åŸä½ç‰ˆæœ¬Jenkinsæ„å»ºåå‘é€é‚®ä»¶ï¼ŒåŠé…ç½®å˜é‡ï¼ˆæš‚æœªéªŒè¯ï¼‰</strong>ï¼š</p><p>åœ¨é¡¹ç›®ä¸­é…ç½®å˜é‡ï¼Œæ­¤å¤„ç”¨åˆ°çš„ä¿¡æ¯æ¥è‡ªgitä»“åº“æ¨é€è§¦å‘æ„å»ºæ—¶ä¼ è¿‡æ¥çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ç›¸å¯¹åº”çš„å–å€¼å¦‚å›¾</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/5e58bad5402fe.png" alt="img"></p><p>${JOB_NAME} ${BUILD_STATUS} ${BUILD_DISPLAY_NAME} ${BUILD_URL}å±äºJenkinsåŒ…å«çš„ç¯å¢ƒå˜é‡ï¼Œ å¯ä»¥ä¸éœ€è¦é¢å¤–å–å€¼</p><p>${message} ${updatetime} ${account} æ˜¯è‡ªå®šä¹‰å˜é‡ï¼Œå®šä¹‰æ–¹å¼éœ€è¦æ ¹æ®æ¨é€ä¿¡æ¯æ¥å®š</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/5e58badd606ee.png" alt="img"></p><p>${message}å˜é‡åæœ€ç»ˆæ ¼å¼ä¸º $.commits[0].message<br><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/5e58bae6c3aa2.png" alt="img"></p><p>${updatetime} å˜é‡åæœ€ç»ˆæ ¼å¼ä¸º $.repository.updated_at</p><p>åŒç†ï¼Œå…¶ä»–å˜é‡ä¹Ÿæ˜¯è¿™ä¹ˆè®¾ç½®ï¼Œæœ€ç»ˆè®¾ç½®å¦‚ä¸‹</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/5e58baecc996f.png" alt="img"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/5e58baf2e8412.png" alt="img"></p><p>ä»¥ä¸Šè¿™äº›æ˜¯å…±åŒè®¾ç½®ã€‚</p><p>åœ¨piplineé¡¹ç›®ä¸­ï¼Œè¦å‘é‚®ä»¶ï¼Œéœ€è¦ç”¨å¦‚ä¸‹è®¾ç½®</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/5e58baf81cb7c.png" alt="img"></p><p>ä¸Šå›¾è¡¨ç¤ºæ„å»ºæˆåŠŸæ—¶å‘é‚®ä»¶ï¼Œè¿™åªæ˜¯ä¸ªç¤ºä¾‹ï¼Œé€šå¸¸æ—¶å¤±è´¥æˆ–è€…abortçš„æ—¶å€™æ‰å‘</p><p>åœ¨shellé¡¹ç›®ä¸­ï¼Œåˆ™è¦å¤šäº›è®¾ç½®</p><p>é¦–å…ˆåˆ° æ„å»ºåæ“ä½œ çš„éƒ¨åˆ†</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/5e58bb01ab8ed.png" alt="img"></p><p>é€‰æ‹© Editable Email Notification</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/5e58bb0538ec9.png" alt="img"></p><p>å¡«å†™ä¿¡æ¯</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/5e58bb099430b.png" alt="img"></p><p>ç‚¹å‡»é«˜çº§å®šä¹‰è§¦å‘æ–¹å¼ï¼Œå¦‚å›¾</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%AE%BE%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81/5e58bb0e6a357.png" alt="img"></p>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
      <category>Jenkins</category>
      
      <category>Jenkinsä½¿ç”¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jenkinsè‡ªåŠ¨å¤‡ä»½</title>
    <link href="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD/"/>
    <url>/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Jenkinsè‡ªåŠ¨å¤‡ä»½"><a href="#Jenkinsè‡ªåŠ¨å¤‡ä»½" class="headerlink" title="Jenkinsè‡ªåŠ¨å¤‡ä»½"></a>Jenkinsè‡ªåŠ¨å¤‡ä»½</h1><h6 id="ç™»å½•Jenkinsï¼Œé€‰æ‹©å·¦ä¾§èœå•çš„ç³»ç»Ÿç®¡ç†ï¼Œç„¶åé€‰æ‹©ThinBackupï¼Œå¦‚ä¸‹å›¾ç•Œé¢ï¼šç™»å½•Jenkinsï¼Œé€‰æ‹©å·¦ä¾§èœå•çš„ç³»ç»Ÿç®¡ç†ï¼Œç„¶åé€‰æ‹©ThinBackupï¼Œå¦‚ä¸‹å›¾ç•Œé¢ï¼š"><a href="#ç™»å½•Jenkinsï¼Œé€‰æ‹©å·¦ä¾§èœå•çš„ç³»ç»Ÿç®¡ç†ï¼Œç„¶åé€‰æ‹©ThinBackupï¼Œå¦‚ä¸‹å›¾ç•Œé¢ï¼šç™»å½•Jenkinsï¼Œé€‰æ‹©å·¦ä¾§èœå•çš„ç³»ç»Ÿç®¡ç†ï¼Œç„¶åé€‰æ‹©ThinBackupï¼Œå¦‚ä¸‹å›¾ç•Œé¢ï¼š" class="headerlink" title="ç™»å½•Jenkinsï¼Œé€‰æ‹©å·¦ä¾§èœå•çš„ç³»ç»Ÿç®¡ç†ï¼Œç„¶åé€‰æ‹©ThinBackupï¼Œå¦‚ä¸‹å›¾ç•Œé¢ï¼šç™»å½•Jenkinsï¼Œé€‰æ‹©å·¦ä¾§èœå•çš„ç³»ç»Ÿç®¡ç†ï¼Œç„¶åé€‰æ‹©ThinBackupï¼Œå¦‚ä¸‹å›¾ç•Œé¢ï¼š"></a>ç™»å½•Jenkinsï¼Œé€‰æ‹©å·¦ä¾§èœå•çš„<strong>ç³»ç»Ÿç®¡ç†</strong>ï¼Œç„¶åé€‰æ‹©<strong>ThinBackup</strong>ï¼Œå¦‚ä¸‹å›¾ç•Œé¢ï¼šç™»å½•Jenkinsï¼Œé€‰æ‹©å·¦ä¾§èœå•çš„<strong>ç³»ç»Ÿç®¡ç†</strong>ï¼Œç„¶åé€‰æ‹©<strong>ThinBackup</strong>ï¼Œå¦‚ä¸‹å›¾ç•Œé¢ï¼š</h6><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD/image-20230330104619475.png" alt="image-20230330104619475"></p><hr><p>é€‰æ‹©<strong>Settings</strong>ï¼Œç•Œé¢å¦‚ä¸‹å›¾:</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD/image-20230330104654310.png" alt="image-20230330104654310"></p><ul><li>Backup directory: è®¾ç½®å¤‡ä»½çš„ç›®å½•ï¼Œæ³¨æ„è¿è¡Œ jenkins çš„ç›®å½•è¦å¯¹å®ƒæœ‰å†™çš„æƒé™ã€‚</li><li>Backup schedule for full backups: è®¾ç½®å®Œæ•´å®šæ—¶ä»»åŠ¡ï¼ŒExample:<br><em>0 12</em> <em>1-5 Executes on 12:00 every weekday (Mo-Fr)</em></li><li>Backup schedule for differential backups è®¾ç½®å¢é‡å¤‡ä»½çš„è®¡åˆ’ï¼Œä»…ä»…å­˜å‚¨ä¸Šä¸€æ¬¡å®Œæ•´å¤‡ä»½çš„ä¹‹åçš„æ›´æ”¹éƒ¨åˆ†ã€‚ å¯¹äºå¢é‡å¤‡ä»½ï¼Œæˆ‘ä»¬å¿…é¡»è¦æœ‰ä¸€ä¸ªå®Œæ•´å¤‡ä»½ã€‚</li><li>Max number of backup setsï¼š å¤‡ä»½çš„æœ€å¤§æ•°é‡æ•°ï¼Œé»˜è®¤ä¸º -1.è¡¨ç¤ºæ— é™åˆ¶ã€‚</li><li>Files excluded from backup (regular expression)ï¼š å¤‡ä»½éœ€è¦æ’é™¤çš„ç›®å½•ã€‚</li><li>Wait until Jenkins&#x2F;Hudson is idle to perform a backupï¼š ç­‰å¾… jenkins è¿›å…¥â€œQuiet Modeâ€(å®‰é™æ¨¡å¼)çš„æ—¶å€™å»è¿›è¡Œå¤‡ä»½ã€‚å®‰é™æ¨¡å¼æœŸé—´ä¸å¤„ç†ä»»ä½•ä»»åŠ¡ã€‚ å»ºè®®å‹¾é€‰ã€‚</li><li>Force Jenkins to quiet mode after specified minutes ï¼š æœ€é•¿ç­‰å¾…è¿›å…¥å®‰é™æ¨¡å¼çš„æ—¶é—´ï¼Œå½“è¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œå°±ä¼šå¼ºåˆ¶è¿›å…¥ å®‰é™æ¨¡å¼ã€‚</li><li>Backup build resultsï¼š å¤‡ä»½æ„å»ºçš„ç»“æœï¼Œè¿™ä¸ªå¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„æ•°æ®ã€‚å ç”¨ç£ç›˜ä¼šæ¯”è¾ƒå¤§ã€‚</li><li>Backup build archiveï¼š åªæœ‰å‹¾é€‰äº† Backup build results æ‰ä¼šå‡ºç°è¿™ä¸ªé€‰é¡¹ã€‚å¤‡ä»½å­˜æ¡£ï¼Œ</li><li>Backup only builds marked to keepï¼š å¦‚æœå‹¾é€‰æ­¤é¡¹ï¼Œåªå¤‡ä»½è¢«æ ‡è®°ä¸º <code>Keep this build forever</code> çš„ä¸Šçš„æ„å»ºç»“æœã€‚åªæœ‰å‹¾é€‰äº† Backup build results æ‰ä¼šå‡ºç°è¿™ä¸ªé€‰é¡¹ã€‚</li><li>Backup â€˜userContentâ€™ folderï¼š å¦‚æœå¯ç”¨è¯¥å¤‡ä»½ï¼ŒuserContent ç›®å½•($JENKINS_HOME&#x2F;userContent)å°†ä¼šå¤‡ä»½ã€‚ å¦‚æœæœ‰è½¯é“¾æ¥éƒ¨åˆ†ï¼Œä¸èƒ½å¤‡ä»½è¯¥å†…å®¹ã€‚</li><li>Backup next build number fileï¼š å¦‚æœå¯ç”¨è¯¥é¡¹ï¼Œåˆ™ nextBuildNumber ä¹Ÿä¼šè¿›è¡Œå¤‡ä»½ã€‚</li><li>Backup plugins archivesï¼š å¯ç”¨è¯¥é¡¹çš„è¯ï¼Œä¼šè¿›è¡Œå¤‡ä»½æ’ä»¶å­˜æ¡£ã€‚</li><li>Backup additional filesï¼š å¤‡ä»½ç‰¹å®šçš„æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ­£åˆ™è¿›è¡ŒåŒ¹é…ã€‚</li><li>Clean up differential backupsï¼š å¦‚æœå¯ç”¨äº†è¯¥é€‰é¡¹çš„è¯ï¼Œåœ¨æ‰§è¡Œå®Œæ•´å¤‡ä»½çš„æ—¶å€™ï¼Œä¼šåˆ é™¤å·®å¼‚åŒ–å¤‡ä»½ã€‚</li><li>Move old backups to ZIP filesï¼š å°†è€çš„å¤‡ä»½æ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚</li></ul><hr><p>å¦‚æœç‚¹å‡»<strong>Backup Now</strong>ï¼Œä¼šç«‹å³æ‰§è¡Œå¤‡ä»½ï¼Œæ ¹æ®éœ€è¦å¤‡ä»½çš„æ•°æ®å¤§å°ï¼Œä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚</p><hr><p>ç‚¹å‡»<strong>Restore</strong>ä¼šè¿›è¡Œå¤‡ä»½æ¢å¤ï¼Œç•Œé¢å¦‚ä¸‹å›¾;</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/jenkins%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD/image-20230330104712908.png" alt="image-20230330104712908"></p><p>é€‰æ‹©æƒ³æ¢å¤çš„æ—¶é—´èŠ‚ç‚¹ç„¶åç‚¹å‡»<strong>Restore</strong>ï¼Œç¨ç­‰ä¸€ä¼šå„¿å°±æ¢å¤äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
      <category>Jenkins</category>
      
      <category>Jenkinsä½¿ç”¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é…ç½®Jenkinsç”¨æˆ·å’Œæƒé™</title>
    <link href="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/"/>
    <url>/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="é…ç½®Jenkinsç”¨æˆ·å’Œæƒé™"><a href="#é…ç½®Jenkinsç”¨æˆ·å’Œæƒé™" class="headerlink" title="é…ç½®Jenkinsç”¨æˆ·å’Œæƒé™"></a>é…ç½®Jenkinsç”¨æˆ·å’Œæƒé™</h1><h2 id="ä¸€ã€æ–°å»ºjenkinsç”¨æˆ·"><a href="#ä¸€ã€æ–°å»ºjenkinsç”¨æˆ·" class="headerlink" title="ä¸€ã€æ–°å»ºjenkinsç”¨æˆ·"></a>ä¸€ã€æ–°å»ºjenkinsç”¨æˆ·</h2><h3 id="1ã€ç³»ç»Ÿç®¡ç†-gt-gt-ç®¡ç†ç”¨æˆ·"><a href="#1ã€ç³»ç»Ÿç®¡ç†-gt-gt-ç®¡ç†ç”¨æˆ·" class="headerlink" title="1ã€ç³»ç»Ÿç®¡ç†&gt;&gt;ç®¡ç†ç”¨æˆ·"></a>1ã€ç³»ç»Ÿç®¡ç†&gt;&gt;ç®¡ç†ç”¨æˆ·</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/image-20220506164349547.png" alt="image-20220506164349547"></p><h3 id="2ã€æ–°å»ºç”¨æˆ·ï¼Œå¡«å†™ç”¨æˆ·ä¿¡æ¯"><a href="#2ã€æ–°å»ºç”¨æˆ·ï¼Œå¡«å†™ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="2ã€æ–°å»ºç”¨æˆ·ï¼Œå¡«å†™ç”¨æˆ·ä¿¡æ¯"></a>2ã€æ–°å»ºç”¨æˆ·ï¼Œå¡«å†™ç”¨æˆ·ä¿¡æ¯</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/image-20220506164322659.png" alt="image-20220506164322659"></p><h2 id="äºŒã€ç”¨æˆ·æˆæƒ"><a href="#äºŒã€ç”¨æˆ·æˆæƒ" class="headerlink" title="äºŒã€ç”¨æˆ·æˆæƒ"></a>äºŒã€ç”¨æˆ·æˆæƒ</h2><h3 id="æˆæƒæ–¹æ³•ä¸€ï¼šï¼ˆé€‚ç”¨äºç”¨æˆ·é‡å°‘ï¼Œå¯¹ç”¨æˆ·æƒé™ä¸éœ€è¦è¿‡å¤šçš„åˆ†é…ï¼‰"><a href="#æˆæƒæ–¹æ³•ä¸€ï¼šï¼ˆé€‚ç”¨äºç”¨æˆ·é‡å°‘ï¼Œå¯¹ç”¨æˆ·æƒé™ä¸éœ€è¦è¿‡å¤šçš„åˆ†é…ï¼‰" class="headerlink" title="æˆæƒæ–¹æ³•ä¸€ï¼šï¼ˆé€‚ç”¨äºç”¨æˆ·é‡å°‘ï¼Œå¯¹ç”¨æˆ·æƒé™ä¸éœ€è¦è¿‡å¤šçš„åˆ†é…ï¼‰"></a>æˆæƒæ–¹æ³•ä¸€ï¼šï¼ˆé€‚ç”¨äºç”¨æˆ·é‡å°‘ï¼Œå¯¹ç”¨æˆ·æƒé™ä¸éœ€è¦è¿‡å¤šçš„åˆ†é…ï¼‰</h3><h3 id="1ã€ç³»ç»Ÿç®¡ç†-gt-gt-å…¨å±€å®‰å…¨é…ç½®"><a href="#1ã€ç³»ç»Ÿç®¡ç†-gt-gt-å…¨å±€å®‰å…¨é…ç½®" class="headerlink" title="1ã€ç³»ç»Ÿç®¡ç†&gt;&gt; å…¨å±€å®‰å…¨é…ç½®"></a>1ã€ç³»ç»Ÿç®¡ç†&gt;&gt; å…¨å±€å®‰å…¨é…ç½®</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/image-20220510113937813.png" alt="image-20220510113937813"></p><h3 id="2ã€å®‰å…¨åŸŸé€‰æ‹©ã€Šä¸“æœ‰ç”¨æˆ·æ•°æ®åº“ã€‹ï¼Œæˆæƒç­–ç•¥é€‰æ‹©ã€Šå®‰å…¨çŸ©é˜µã€‹"><a href="#2ã€å®‰å…¨åŸŸé€‰æ‹©ã€Šä¸“æœ‰ç”¨æˆ·æ•°æ®åº“ã€‹ï¼Œæˆæƒç­–ç•¥é€‰æ‹©ã€Šå®‰å…¨çŸ©é˜µã€‹" class="headerlink" title="2ã€å®‰å…¨åŸŸé€‰æ‹©ã€Šä¸“æœ‰ç”¨æˆ·æ•°æ®åº“ã€‹ï¼Œæˆæƒç­–ç•¥é€‰æ‹©ã€Šå®‰å…¨çŸ©é˜µã€‹"></a>2ã€å®‰å…¨åŸŸé€‰æ‹©ã€Šä¸“æœ‰ç”¨æˆ·æ•°æ®åº“ã€‹ï¼Œæˆæƒç­–ç•¥é€‰æ‹©ã€Šå®‰å…¨çŸ©é˜µã€‹</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/image-20220510114017088.png" alt="image-20220510114017088"></p><h3 id="3ã€åˆ›å»ºç”¨æˆ·çŸ©é˜µï¼Œæ·»åŠ ç”¨æˆ·"><a href="#3ã€åˆ›å»ºç”¨æˆ·çŸ©é˜µï¼Œæ·»åŠ ç”¨æˆ·" class="headerlink" title="3ã€åˆ›å»ºç”¨æˆ·çŸ©é˜µï¼Œæ·»åŠ ç”¨æˆ·"></a>3ã€åˆ›å»ºç”¨æˆ·çŸ©é˜µï¼Œæ·»åŠ ç”¨æˆ·</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/image-20220510114119758.png" alt="image-20220510114119758"></p><h3 id="4ã€æ ¹æ®éœ€æ±‚è®¾ç½®å®‰å…¨çŸ©é˜µï¼Œä»»ä½•ç”¨æˆ·åœ¨ï¼šå…¨éƒ¨ä¸€æ éƒ½éœ€è¦é€‰æ‹©Readï¼Œåªè¯»"><a href="#4ã€æ ¹æ®éœ€æ±‚è®¾ç½®å®‰å…¨çŸ©é˜µï¼Œä»»ä½•ç”¨æˆ·åœ¨ï¼šå…¨éƒ¨ä¸€æ éƒ½éœ€è¦é€‰æ‹©Readï¼Œåªè¯»" class="headerlink" title="4ã€æ ¹æ®éœ€æ±‚è®¾ç½®å®‰å…¨çŸ©é˜µï¼Œä»»ä½•ç”¨æˆ·åœ¨ï¼šå…¨éƒ¨ä¸€æ éƒ½éœ€è¦é€‰æ‹©Readï¼Œåªè¯»"></a>4ã€æ ¹æ®éœ€æ±‚è®¾ç½®å®‰å…¨çŸ©é˜µï¼Œä»»ä½•ç”¨æˆ·åœ¨ï¼šå…¨éƒ¨ä¸€æ éƒ½éœ€è¦é€‰æ‹©Readï¼Œåªè¯»</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/image-20220510114231574.png" alt="image-20220510114231574"></p><h2 id="æˆæƒæ–¹æ³•äºŒï¼šï¼ˆé€‚ç”¨äºé¡¹ç›®å¤šï¼Œåˆ’åˆ†è§’è‰²å’Œæƒé™å¤šï¼‰"><a href="#æˆæƒæ–¹æ³•äºŒï¼šï¼ˆé€‚ç”¨äºé¡¹ç›®å¤šï¼Œåˆ’åˆ†è§’è‰²å’Œæƒé™å¤šï¼‰" class="headerlink" title="æˆæƒæ–¹æ³•äºŒï¼šï¼ˆé€‚ç”¨äºé¡¹ç›®å¤šï¼Œåˆ’åˆ†è§’è‰²å’Œæƒé™å¤šï¼‰"></a>æˆæƒæ–¹æ³•äºŒï¼šï¼ˆé€‚ç”¨äºé¡¹ç›®å¤šï¼Œåˆ’åˆ†è§’è‰²å’Œæƒé™å¤šï¼‰</h2><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://www.cnblogs.com/qican/p/15533972.html">https://www.cnblogs.com/qican/p/15533972.html</a></p><h3 id="1ã€å®‰è£…æ’ä»¶ï¼š"><a href="#1ã€å®‰è£…æ’ä»¶ï¼š" class="headerlink" title="1ã€å®‰è£…æ’ä»¶ï¼š"></a>1ã€å®‰è£…æ’ä»¶ï¼š</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">Role</span>-based <span class="hljs-keyword">Authorization</span> Strategy<br></code></pre></td></tr></table></figure><h3 id="2ã€ç³»ç»Ÿç®¡ç†-gt-gt-å…¨å±€å®‰å…¨é…ç½®"><a href="#2ã€ç³»ç»Ÿç®¡ç†-gt-gt-å…¨å±€å®‰å…¨é…ç½®" class="headerlink" title="2ã€ç³»ç»Ÿç®¡ç†&gt;&gt; å…¨å±€å®‰å…¨é…ç½®"></a>2ã€ç³»ç»Ÿç®¡ç†&gt;&gt; å…¨å±€å®‰å…¨é…ç½®</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/image-20220510113937813.png" alt="image-20220510113937813"></p><h3 id="3ã€é€‰æ‹©Role-basedã€å¹¶ä¿å­˜åº”ç”¨"><a href="#3ã€é€‰æ‹©Role-basedã€å¹¶ä¿å­˜åº”ç”¨" class="headerlink" title="3ã€é€‰æ‹©Role-basedã€å¹¶ä¿å­˜åº”ç”¨"></a>3ã€é€‰æ‹©Role-basedã€å¹¶ä¿å­˜åº”ç”¨</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/1171635-20211116103911633-2008125869.png" alt="img"></p><h3 id="4ã€åœ¨ç³»ç»Ÿç®¡ç†é¡µé¢æ‰¾åˆ°Manage-and-Assign-Rolesç‚¹å‡»è¿›å…¥é¡µé¢ä¸­"><a href="#4ã€åœ¨ç³»ç»Ÿç®¡ç†é¡µé¢æ‰¾åˆ°Manage-and-Assign-Rolesç‚¹å‡»è¿›å…¥é¡µé¢ä¸­" class="headerlink" title="4ã€åœ¨ç³»ç»Ÿç®¡ç†é¡µé¢æ‰¾åˆ°Manage and Assign Rolesç‚¹å‡»è¿›å…¥é¡µé¢ä¸­"></a>4ã€åœ¨ç³»ç»Ÿç®¡ç†é¡µé¢æ‰¾åˆ°Manage and Assign Rolesç‚¹å‡»è¿›å…¥é¡µé¢ä¸­</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/image-20230406112155920.png" alt="image-20230406112155920"></p><h3 id="5ã€ç®¡ç†è§’è‰²å†…ã€‹è®¾ç½®å…¨å±€è§’è‰²"><a href="#5ã€ç®¡ç†è§’è‰²å†…ã€‹è®¾ç½®å…¨å±€è§’è‰²" class="headerlink" title="5ã€ç®¡ç†è§’è‰²å†…ã€‹è®¾ç½®å…¨å±€è§’è‰²"></a>5ã€ç®¡ç†è§’è‰²å†…ã€‹è®¾ç½®å…¨å±€è§’è‰²</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/image-20230406114627026.png" alt="image-20230406114627026"></p><h3 id="6ã€ç®¡ç†è§’è‰²å†…ã€‹è®¾ç½®åŒ¹é…è§’è‰²"><a href="#6ã€ç®¡ç†è§’è‰²å†…ã€‹è®¾ç½®åŒ¹é…è§’è‰²" class="headerlink" title="6ã€ç®¡ç†è§’è‰²å†…ã€‹è®¾ç½®åŒ¹é…è§’è‰²"></a>6ã€ç®¡ç†è§’è‰²å†…ã€‹è®¾ç½®åŒ¹é…è§’è‰²</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/image-20230406113929081.png" alt="image-20230406113929081"></p><p> å¤‡æ³¨ï¼š**patternä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¾‹å¦‚è¦åŒ¹é…ä»¥testå¼€å¤´å’Œgoå¼€å¤´çš„ä»»åŠ¡åï¼š<code>test.|go.</code>**ä¸¾ä¾‹ï¼šå¦‚ä¸Šdevelopç»„ä»¥testç»“å°¾ï¼Œåé¢çš„ç”¨æˆ·å…³è”äº†è¯¥ç»„çš„ï¼Œèƒ½å¼€åˆ°ä»¥testç»“å°¾çš„ä»»åŠ¡</p><h3 id="7ã€åˆ†é…è§’è‰²å†…"><a href="#7ã€åˆ†é…è§’è‰²å†…" class="headerlink" title="7ã€åˆ†é…è§’è‰²å†…"></a>7ã€åˆ†é…è§’è‰²å†…</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/%E9%85%8D%E7%BD%AEJenkins%E7%94%A8%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90/image-20230406114502470.png" alt="image-20230406114502470"></p><h3 id="8ã€å½“æˆ‘ä»¬ç™»å½•developè´¦æˆ·æ—¶åªèƒ½çœ‹åˆ°ä»¥testç»“å°¾çš„é¡¹ç›®ï¼Œformalè´¦æˆ·æ—¶åªèƒ½çœ‹åˆ°ä»¥formalç»“å°¾çš„é¡¹ç›®ï¼ˆè¿™å—åœ¨è®¾ç½®æµæ°´çº¿ä»»åŠ¡æ—¶å°±å¾—è§„èŒƒæ„å»ºä»»åŠ¡çš„å‘½åè§„åˆ™ï¼‰"><a href="#8ã€å½“æˆ‘ä»¬ç™»å½•developè´¦æˆ·æ—¶åªèƒ½çœ‹åˆ°ä»¥testç»“å°¾çš„é¡¹ç›®ï¼Œformalè´¦æˆ·æ—¶åªèƒ½çœ‹åˆ°ä»¥formalç»“å°¾çš„é¡¹ç›®ï¼ˆè¿™å—åœ¨è®¾ç½®æµæ°´çº¿ä»»åŠ¡æ—¶å°±å¾—è§„èŒƒæ„å»ºä»»åŠ¡çš„å‘½åè§„åˆ™ï¼‰" class="headerlink" title="8ã€å½“æˆ‘ä»¬ç™»å½•developè´¦æˆ·æ—¶åªèƒ½çœ‹åˆ°ä»¥testç»“å°¾çš„é¡¹ç›®ï¼Œformalè´¦æˆ·æ—¶åªèƒ½çœ‹åˆ°ä»¥formalç»“å°¾çš„é¡¹ç›®ï¼ˆè¿™å—åœ¨è®¾ç½®æµæ°´çº¿ä»»åŠ¡æ—¶å°±å¾—è§„èŒƒæ„å»ºä»»åŠ¡çš„å‘½åè§„åˆ™ï¼‰"></a>8ã€å½“æˆ‘ä»¬ç™»å½•developè´¦æˆ·æ—¶åªèƒ½çœ‹åˆ°ä»¥testç»“å°¾çš„é¡¹ç›®ï¼Œformalè´¦æˆ·æ—¶åªèƒ½çœ‹åˆ°ä»¥formalç»“å°¾çš„é¡¹ç›®ï¼ˆè¿™å—åœ¨è®¾ç½®æµæ°´çº¿ä»»åŠ¡æ—¶å°±å¾—è§„èŒƒæ„å»ºä»»åŠ¡çš„å‘½åè§„åˆ™ï¼‰</h3><h2 id="é—®é¢˜å¤„ç†ï¼š"><a href="#é—®é¢˜å¤„ç†ï¼š" class="headerlink" title="é—®é¢˜å¤„ç†ï¼š"></a>é—®é¢˜å¤„ç†ï¼š</h2><h3 id="Jenkinsæƒé™é…ç½®é”™è¯¯ï¼Œå¯¼è‡´æ— æ³•ç™»å½•ï¼š"><a href="#Jenkinsæƒé™é…ç½®é”™è¯¯ï¼Œå¯¼è‡´æ— æ³•ç™»å½•ï¼š" class="headerlink" title="Jenkinsæƒé™é…ç½®é”™è¯¯ï¼Œå¯¼è‡´æ— æ³•ç™»å½•ï¼š"></a>Jenkinsæƒé™é…ç½®é”™è¯¯ï¼Œå¯¼è‡´æ— æ³•ç™»å½•ï¼š</h3><p>1.åœæ­¢jenkins</p><p>2ã€é…ç½®config.xml</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /var/lib/jenkins/config.xml<br>&lt;useSecurity&gt;<span class="hljs-literal">true</span>&lt;/useSecurity&gt; <span class="hljs-comment">#true ä¿®æ”¹ä¸º:false</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
      <category>Jenkins</category>
      
      <category>Jenkinsä½¿ç”¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jenkins-æ„å»ºè§¦å‘å™¨-webhook</title>
    <link href="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/"/>
    <url>/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Jenkins-æ„å»ºè§¦å‘å™¨-webhook"><a href="#Jenkins-æ„å»ºè§¦å‘å™¨-webhook" class="headerlink" title="Jenkins-æ„å»ºè§¦å‘å™¨-webhook"></a>Jenkins-æ„å»ºè§¦å‘å™¨-webhook</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/byhh/p/15624146.html<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€å†™åœ¨å‰é¢"><a href="#ä¸€ã€å†™åœ¨å‰é¢" class="headerlink" title="ä¸€ã€å†™åœ¨å‰é¢"></a>ä¸€ã€å†™åœ¨å‰é¢</h2><p>æˆ‘ä»¬å·²ç»äº†è§£åˆ°äº†ï¼ŒJenkins æœ¬èº«å†…ç½®äº†4ç§æ„å»ºè§¦å‘å™¨ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li><strong>è§¦å‘è¿œç¨‹æ„å»º</strong></li><li><strong>å…¶ä»–é¡¹ç›®å·¥ç¨‹æ„å»ºåè§¦å‘ Build after other projects are built</strong></li><li><strong>å®šæ—¶æ„å»º Build periodically</strong></li><li><strong>è½®å¾ªæ„å»º Poll SCM</strong></li></ul><p>è¿™å››ç§æ„å»ºè§¦å‘å™¨ï¼ŒåŸºæœ¬å¯ä»¥æ»¡è¶³æˆ‘ä»¬æ—¥å¸¸å·¥ä½œçš„å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œä½†ä¹Ÿæœ‰å…¶ä¸è¶³çš„åœ°æ–¹ï¼š</p><p>1ã€è§¦å‘è¿œç¨‹æ„å»ºï¼šéœ€è¦é¢å¤–è°ƒç”¨url é€šçŸ¥Jenkins å»è§¦å‘æ„å»º</p><p>2ã€å‰ç½®å·¥ç¨‹æ„å»ºåè§¦å‘ï¼šå¯ä»¥é…åˆå…¶ä»–æ„å»ºè§¦å‘å™¨ä¸€èµ·ä½¿ç”¨ï¼Œä½†æ˜¯æ²¡æœ‰è§£å†³ä¸»è¦å·¥ç¨‹æ„å»ºçš„é—®é¢˜</p><p>3ã€å®šæ—¶æ„å»ºï¼šä¼šå­˜åœ¨å³ä½¿ï¼Œè¿œç¨‹ä»“åº“ä»£ç æ²¡æœ‰ä»»ä½•å˜åŠ¨ï¼Œä¹Ÿä¼šè§¦å‘æ„å»ºï¼Œå¯¼è‡´èµ„æºæµªè´¹</p><p>4ã€è½®å¾ªæ„å»º:ç›¸æ¯”äºå®šæ—¶æ„å»ºï¼Œè½®å¾ªæ„å»ºåªæœ‰åœ¨ä»£ç å˜åŠ¨çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šè§¦å‘æ„å»ºï¼Œå‡å°‘äº†ä¸€éƒ¨åˆ†èµ„æºçš„æµªè´¹ï¼Œä½†æ˜¯ä¾èµ–äºè½®è¯¢ï¼Œå…¶å®šæ—¶è½®è¯¢æœºåˆ¶æœ¬èº«ä¼šæ¶ˆè€—Jenkins æœåŠ¡å™¨çš„èµ„æºï¼Œå¯¼è‡´ä¸€äº›èµ„æºä¸Šçš„æµªè´¹ã€‚</p><p>ç»¼åˆä»¥ä¸Šé—®é¢˜ï¼šwebhook åº”è¿è€Œç”Ÿ ï¼ˆè¿™é‡Œä»¥ gitlab ä¸ºä¾‹ï¼‰</p><p>webhook æ‹¦æˆªç‰¹å®šäº‹ä»¶ï¼ˆå¦‚ push ä»£ç å ï¼Œè‡ªåŠ¨è§¦å‘è¿œç¨‹æ„å»ºï¼‰ï¼Œäº‹ä»¶ä»¥ http çš„æ–¹å¼é€šçŸ¥ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œå¦‚è§¦å‘æŒç»­é›†æˆJenkinsã€‚</p><h2 id="äºŒã€gitlab-åˆ©ç”¨-webhook-å®ç°push-ä»£ç å-Jenkins-è‡ªåŠ¨æ„å»º"><a href="#äºŒã€gitlab-åˆ©ç”¨-webhook-å®ç°push-ä»£ç å-Jenkins-è‡ªåŠ¨æ„å»º" class="headerlink" title="äºŒã€gitlab åˆ©ç”¨ webhook å®ç°push ä»£ç å Jenkins è‡ªåŠ¨æ„å»º"></a>äºŒã€gitlab åˆ©ç”¨ webhook å®ç°push ä»£ç å Jenkins è‡ªåŠ¨æ„å»º</h2><h3 id="1ã€Jenkins-å®‰è£…-gitlab-ç›¸å…³æ’ä»¶"><a href="#1ã€Jenkins-å®‰è£…-gitlab-ç›¸å…³æ’ä»¶" class="headerlink" title="1ã€Jenkins å®‰è£… gitlab ç›¸å…³æ’ä»¶"></a>1ã€Jenkins å®‰è£… gitlab ç›¸å…³æ’ä»¶</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/2560969-20211130141452458-1117825345.png" alt="img"></p><h3 id="2ã€æ’ä»¶å®‰è£…å®Œæ¯•åï¼Œé¡¹ç›®é…ç½®ç›®å½•ä¸‹-æ„å»ºè§¦å‘å™¨å™¨ä¼šæ–°å¢-ä¸€ä¸ª-è§¦å‘å™¨é€‰é¡¹ï¼Œé€‰æ‹©å¹¶è®¾ç½®å¯¹åº”è§¦å‘æ„å»ºäº‹ä»¶ï¼Œä¿å­˜æ®·å‹‡å³å¯"><a href="#2ã€æ’ä»¶å®‰è£…å®Œæ¯•åï¼Œé¡¹ç›®é…ç½®ç›®å½•ä¸‹-æ„å»ºè§¦å‘å™¨å™¨ä¼šæ–°å¢-ä¸€ä¸ª-è§¦å‘å™¨é€‰é¡¹ï¼Œé€‰æ‹©å¹¶è®¾ç½®å¯¹åº”è§¦å‘æ„å»ºäº‹ä»¶ï¼Œä¿å­˜æ®·å‹‡å³å¯" class="headerlink" title="2ã€æ’ä»¶å®‰è£…å®Œæ¯•åï¼Œé¡¹ç›®é…ç½®ç›®å½•ä¸‹ æ„å»ºè§¦å‘å™¨å™¨ä¼šæ–°å¢ ä¸€ä¸ª è§¦å‘å™¨é€‰é¡¹ï¼Œé€‰æ‹©å¹¶è®¾ç½®å¯¹åº”è§¦å‘æ„å»ºäº‹ä»¶ï¼Œä¿å­˜æ®·å‹‡å³å¯"></a>2ã€æ’ä»¶å®‰è£…å®Œæ¯•åï¼Œé¡¹ç›®é…ç½®ç›®å½•ä¸‹ æ„å»ºè§¦å‘å™¨å™¨ä¼šæ–°å¢ ä¸€ä¸ª è§¦å‘å™¨é€‰é¡¹ï¼Œé€‰æ‹©å¹¶è®¾ç½®å¯¹åº”è§¦å‘æ„å»ºäº‹ä»¶ï¼Œä¿å­˜æ®·å‹‡å³å¯</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/2560969-20211130141629398-1998578973.png" alt="img"></p><h3 id="3ã€gitlab-ä¸Šè®¾ç½®webhook"><a href="#3ã€gitlab-ä¸Šè®¾ç½®webhook" class="headerlink" title="3ã€gitlab ä¸Šè®¾ç½®webhook"></a>3ã€gitlab ä¸Šè®¾ç½®webhook</h3><p>ç®¡ç†å‘˜ç™»å½• gitlab è¿œç¨‹ä»“åº“ï¼Œè¿›å…¥æŒ‡å®šé¡¹ç›®ï¼Œè®¾ç½®å…¥å£ ç‚¹å‡»è¿›å…¥webhook é…ç½®é¡µé¢</p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/2560969-20211130141845535-890314326.png" alt="img"></p><h3 id="4ã€é…ç½®gitlab-webhookï¼Œé…ç½®å®Œæˆåç‚¹å‡»-add-webhook"><a href="#4ã€é…ç½®gitlab-webhookï¼Œé…ç½®å®Œæˆåç‚¹å‡»-add-webhook" class="headerlink" title="4ã€é…ç½®gitlab webhookï¼Œé…ç½®å®Œæˆåç‚¹å‡» add webhook"></a>4ã€é…ç½®gitlab webhookï¼Œé…ç½®å®Œæˆåç‚¹å‡» add webhook</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/2560969-20211130142549536-752996834.png" alt="img"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/2560969-20211130142703276-241677714.png" alt="img"></p><p>ç»æµ‹è¯•webhook å·²ç»ç”Ÿæ•ˆï¼Œæ¥ä¸‹æ¥å¯ä»¥è¯•è¯• æœ¬åœ°push ä»£ç  æ£€æµ‹ æ˜¯å¦ç”Ÿæ•ˆäº†ï¼</p><h2 id="ä¸‰ã€giteaåˆ©ç”¨-webhook-å®ç°push-ä»£ç å-Jenkins-è‡ªåŠ¨æ„å»º"><a href="#ä¸‰ã€giteaåˆ©ç”¨-webhook-å®ç°push-ä»£ç å-Jenkins-è‡ªåŠ¨æ„å»º" class="headerlink" title="ä¸‰ã€giteaåˆ©ç”¨ webhook å®ç°push ä»£ç å Jenkins è‡ªåŠ¨æ„å»º"></a>ä¸‰ã€giteaåˆ©ç”¨ webhook å®ç°push ä»£ç å Jenkins è‡ªåŠ¨æ„å»º</h2><h3 id="1ã€jenkinså®‰è£…æ’ä»¶ï¼šGeneric-Webhook-Trigger-Plugin"><a href="#1ã€jenkinså®‰è£…æ’ä»¶ï¼šGeneric-Webhook-Trigger-Plugin" class="headerlink" title="1ã€jenkinså®‰è£…æ’ä»¶ï¼šGeneric Webhook Trigger Plugin "></a>1ã€jenkinså®‰è£…æ’ä»¶ï¼š<code>Generic Webhook Trigger Plugin </code></h3><h3 id="2ã€åœ¨åˆ›å»ºå¥½é¡¹ç›®ä¹‹åé…ç½®Jenkinså¦‚ä¸‹"><a href="#2ã€åœ¨åˆ›å»ºå¥½é¡¹ç›®ä¹‹åé…ç½®Jenkinså¦‚ä¸‹" class="headerlink" title="2ã€åœ¨åˆ›å»ºå¥½é¡¹ç›®ä¹‹åé…ç½®Jenkinså¦‚ä¸‹:"></a>2ã€åœ¨åˆ›å»ºå¥½é¡¹ç›®ä¹‹åé…ç½®Jenkinså¦‚ä¸‹:</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/image-20230201175748145.png" alt="image-20230201175748145"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/image-20230201175803197.png" alt="image-20230201175803197"></p><p>ä¿å­˜å³å¯ï¼ŒJenkinsé…ç½®å®Œæˆæ¥ä¸‹æ¥åˆ°giteaé…ç½®ï¼</p><h3 id="3ã€giteaåˆ›å»ºå¥½ä»£ç åº“-è¿›å…¥ä»£ç åº“å¦‚ä¸‹é…ç½®"><a href="#3ã€giteaåˆ›å»ºå¥½ä»£ç åº“-è¿›å…¥ä»£ç åº“å¦‚ä¸‹é…ç½®" class="headerlink" title="3ã€giteaåˆ›å»ºå¥½ä»£ç åº“ è¿›å…¥ä»£ç åº“å¦‚ä¸‹é…ç½®"></a>3ã€giteaåˆ›å»ºå¥½ä»£ç åº“ è¿›å…¥ä»£ç åº“å¦‚ä¸‹é…ç½®</h3><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/20210307002010978.png" alt="img"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/20210307002052516.png" alt="img"></p><p><strong>ç„¶åæ³¨æ„ç›®æ ‡urlåªå†™ä¸Šjenkinsåœ°å€å’Œä½ çš„è‡ªå®šä¹‰tokenå³å¯</strong></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/image-20230201180003191.png" alt="image-20230201180003191"></p><p><strong>ä¿å­˜åç‚¹å‡»é“¾æ¥ï¼Œæµ‹è¯•æ¨é€</strong></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/image-20230201180256740.png" alt="image-20230201180256740"></p><p><img src="/2023/03/29/devops/jenkins/jenkins%E4%BD%BF%E7%94%A8/Jenkins-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8-webhook/image-20230201180113450.png" alt="image-20230201180113450"></p>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
      <category>Jenkins</category>
      
      <category>Jenkinsä½¿ç”¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SonarQubeå®‰è£…éƒ¨ç½²</title>
    <link href="/2023/03/29/devops/sonarQube/sonarQube%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"/>
    <url>/2023/03/29/devops/sonarQube/sonarQube%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="SonarQubeå®‰è£…éƒ¨ç½²"><a href="#SonarQubeå®‰è£…éƒ¨ç½²" class="headerlink" title="SonarQubeå®‰è£…éƒ¨ç½²"></a>SonarQubeå®‰è£…éƒ¨ç½²</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">å®˜æ–¹æ–‡æ¡£ï¼šhttps:<span class="hljs-regexp">//</span>docs.sonarqube.org<span class="hljs-regexp">/latest/</span>setup<span class="hljs-regexp">/install-server/</span><br><br>å‚è€ƒæ–‡æ¡£ï¼šhttps:<span class="hljs-regexp">//</span>cloud.tencent.com<span class="hljs-regexp">/developer/</span>article/<span class="hljs-number">1600167</span><br><br>SonarQube+SonarScanner æœ€å…¨å®‰è£…æ­¥éª¤ï¼šhttps:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/xiaozi/</span>p/<span class="hljs-number">15503311</span>.html<br><br>k8så®‰è£…ï¼šhttps:<span class="hljs-regexp">//</span>wqblogs.com<span class="hljs-regexp">/2021/</span><span class="hljs-number">08</span><span class="hljs-regexp">/09/</span>sonarqube%E9%<span class="hljs-number">83</span>%A8%E7%BD%B2%E5%AE%<span class="hljs-number">89</span>%E8%A3%<span class="hljs-number">85</span>/<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€ç®€ä»‹ï¼š"><a href="#ä¸€ã€ç®€ä»‹ï¼š" class="headerlink" title="ä¸€ã€ç®€ä»‹ï¼š"></a>ä¸€ã€ç®€ä»‹ï¼š</h2><p><strong>Sonar (SonarQube)æ˜¯ä¸€ä¸ªå¼€æºå¹³å°ï¼Œç”¨äºç®¡ç†æºä»£ç çš„è´¨é‡ã€‚</strong><br><strong>Sonar ä¸åªæ˜¯ä¸€ä¸ªè´¨é‡æ•°æ®æŠ¥å‘Šå·¥å…·ï¼Œæ›´æ˜¯ä»£ç è´¨é‡ç®¡ç†å¹³å°ã€‚</strong><br>æ”¯æŒJava, C#, C&#x2F;C++, PL&#x2F;SQL, Cobol, JavaScrip, Groovy ç­‰ç­‰äºŒåå‡ ç§ç¼–ç¨‹è¯­è¨€çš„ä»£ç è´¨é‡ç®¡ç†ä¸æ£€æµ‹ã€‚</p><p>Sonarå¯ä»¥ä»ä»¥ä¸‹ä¸ƒä¸ªç»´åº¦æ£€æµ‹ä»£ç è´¨é‡ï¼Œè€Œä½œä¸ºå¼€å‘äººå‘˜è‡³å°‘éœ€è¦å¤„ç†å‰5ç§ä»£ç è´¨é‡é—®é¢˜ã€‚</p><ol><li>ä¸éµå¾ªä»£ç æ ‡å‡†<br>sonarå¯ä»¥é€šè¿‡PMD,CheckStyle,Findbugsç­‰ç­‰ä»£ç è§„åˆ™æ£€æµ‹å·¥å…·è§„èŒƒä»£ç ç¼–å†™ã€‚</li><li>æ½œåœ¨çš„ç¼ºé™·<br>sonarå¯ä»¥é€šè¿‡PMD,CheckStyle,Findbugsç­‰ç­‰ä»£ç è§„åˆ™æ£€æµ‹å·¥å…·æ£€ æµ‹å‡ºæ½œåœ¨çš„ç¼ºé™·ã€‚</li><li>ç³Ÿç³•çš„å¤æ‚åº¦åˆ†å¸ƒ<br>æ–‡ä»¶ã€ç±»ã€æ–¹æ³•ç­‰ï¼Œå¦‚æœå¤æ‚åº¦è¿‡é«˜å°†éš¾ä»¥æ”¹å˜ï¼Œè¿™ä¼šä½¿å¾—å¼€å‘äººå‘˜ éš¾ä»¥ç†è§£å®ƒä»¬, ä¸”å¦‚æœæ²¡æœ‰è‡ªåŠ¨åŒ–çš„å•å…ƒæµ‹è¯•ï¼Œå¯¹äºç¨‹åºä¸­çš„ä»»ä½•ç»„ä»¶çš„æ”¹å˜éƒ½å°†å¯èƒ½å¯¼è‡´éœ€è¦å…¨é¢çš„å›å½’æµ‹è¯•ã€‚</li><li>é‡å¤<br>æ˜¾ç„¶ç¨‹åºä¸­åŒ…å«å¤§é‡å¤åˆ¶ç²˜è´´çš„ä»£ç æ˜¯è´¨é‡ä½ä¸‹çš„ï¼Œsonarå¯ä»¥å±•ç¤º æºç ä¸­é‡å¤ä¸¥é‡çš„åœ°æ–¹ã€‚</li><li>æ³¨é‡Šä¸è¶³æˆ–è€…è¿‡å¤š<br>æ²¡æœ‰æ³¨é‡Šå°†ä½¿ä»£ç å¯è¯»æ€§å˜å·®ï¼Œç‰¹åˆ«æ˜¯å½“ä¸å¯é¿å…åœ°å‡ºç°äººå‘˜å˜åŠ¨ æ—¶ï¼Œç¨‹åºçš„å¯è¯»æ€§å°†å¤§å¹…ä¸‹é™ è€Œè¿‡å¤šçš„æ³¨é‡Šåˆä¼šä½¿å¾—å¼€å‘äººå‘˜å°†ç²¾åŠ›è¿‡å¤šåœ°èŠ±è´¹åœ¨é˜…è¯»æ³¨é‡Šä¸Šï¼Œäº¦è¿èƒŒåˆè¡·ã€‚</li><li>ç¼ºä¹å•å…ƒæµ‹è¯•<br>sonarå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç»Ÿè®¡å¹¶å±•ç¤ºå•å…ƒæµ‹è¯•è¦†ç›–ç‡ã€‚</li><li>ç³Ÿç³•çš„è®¾è®¡<br>é€šè¿‡sonarå¯ä»¥æ‰¾å‡ºå¾ªç¯ï¼Œå±•ç¤ºåŒ…ä¸åŒ…ã€ç±»ä¸ç±»ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»ï¼Œå¯ä»¥æ£€æµ‹è‡ªå®šä¹‰çš„æ¶æ„è§„åˆ™ é€šè¿‡sonarå¯ä»¥ç®¡ç†ç¬¬ä¸‰æ–¹çš„jaråŒ…ï¼Œå¯ä»¥åˆ©ç”¨LCOM4æ£€æµ‹å•ä¸ªä»»åŠ¡è§„åˆ™çš„åº”ç”¨æƒ…å†µï¼Œ æ£€æµ‹è—•åˆã€‚</li></ol><h2 id="äºŒã€å®‰è£…å‰å‡†å¤‡ä»¥åŠæ³¨æ„äº‹é¡¹ï¼š"><a href="#äºŒã€å®‰è£…å‰å‡†å¤‡ä»¥åŠæ³¨æ„äº‹é¡¹ï¼š" class="headerlink" title="äºŒã€å®‰è£…å‰å‡†å¤‡ä»¥åŠæ³¨æ„äº‹é¡¹ï¼š"></a>äºŒã€å®‰è£…å‰å‡†å¤‡ä»¥åŠæ³¨æ„äº‹é¡¹ï¼š</h2><p><strong>å®‰è£…å‰å‡†å¤‡ç¯å¢ƒï¼š</strong></p><table><thead><tr><th>ç¯å¢ƒ&#x2F;å·¥å…·&#x2F;æœåŠ¡å™¨</th><th>ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>192.168.94.154</td><td>centos7.9</td></tr><tr><td>jdk</td><td>11.0.14</td></tr><tr><td>sonarqube</td><td>9.6.1</td></tr><tr><td><strong>ç¯å¢ƒ&#x2F;å·¥å…·&#x2F;æœåŠ¡å™¨</strong></td><td><strong>ç‰ˆæœ¬</strong></td></tr><tr><td>192.168.94.155</td><td>centos7.9</td></tr><tr><td>postgres</td><td>dockerå®‰è£…</td></tr></tbody></table><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">ä¸‹è½½å¯¹åº”æ“ä½œç³»ç»Ÿçš„å®‰è£…åŒ…ï¼Œå®˜ç½‘ä¸‹è½½é“¾æ¥ï¼šhttps://www.sonarqube.org/downloads/<br>sonarqube7.9åŠä»¥ä¸Šä½¿ç”¨postgresä¸ºæ•°æ®åº“ä½¿ç”¨<br>sonarqube7.8ç‰ˆæœ¬ä½¿ç”¨mysql `https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-7.8.zip`<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs txt">1.SonarQubeå®‰è£…ä½¿ç”¨ä¾èµ–JDKï¼Œéœ€æå‰å®‰è£…é…ç½®å¥½JDKç›¸å…³ä¿¡æ¯<br><br>2.ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼ŒSonarQube æœåŠ¡å™¨å’Œæ•°æ®åº“åº”è¯¥å®‰è£…åœ¨ä¸åŒçš„ä¸»æœºä¸Šï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¸»æœºåº”è¯¥æ˜¯ä¸“ç”¨çš„ã€‚æœåŠ¡å™¨å’Œæ•°æ®åº“ä¸»æœºåº”ä½äºåŒä¸€ç½‘ç»œä¸­ã€‚<br><br>3.æ‰€æœ‰ä¸»æœºå¿…é¡»æ˜¯æ—¶é—´åŒæ­¥çš„ã€‚<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€å®‰è£…è¿‡ç¨‹ï¼š"><a href="#ä¸‰ã€å®‰è£…è¿‡ç¨‹ï¼š" class="headerlink" title="ä¸‰ã€å®‰è£…è¿‡ç¨‹ï¼š"></a>ä¸‰ã€å®‰è£…è¿‡ç¨‹ï¼š</h2><h3 id="1-ä¸‹è½½sonarqubeå®‰è£…åŒ…"><a href="#1-ä¸‹è½½sonarqubeå®‰è£…åŒ…" class="headerlink" title="1.ä¸‹è½½sonarqubeå®‰è£…åŒ…"></a>1.ä¸‹è½½sonarqubeå®‰è£…åŒ…</h3><p>ä¸‹è½½å®‰è£…åŒ…åï¼Œä¸Šä¼ åˆ°&#x2F;appç›®å½•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">unzip sonarqube-9.6.1.59531.zip<br><span class="hljs-built_in">cd</span> sonarqube-9.6.1.59531/<br></code></pre></td></tr></table></figure><h3 id="2-æ·»åŠ sonarç³»ç»Ÿç”¨æˆ·"><a href="#2-æ·»åŠ sonarç³»ç»Ÿç”¨æˆ·" class="headerlink" title="2.æ·»åŠ sonarç³»ç»Ÿç”¨æˆ·"></a>2.æ·»åŠ sonarç³»ç»Ÿç”¨æˆ·</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">groupadd sonar<br><br><span class="hljs-comment">#åˆ›å»ºsonarç”¨æˆ·ï¼Œè®¾ç½®æ— æ³•ç™»å½•(æ— æ³•ç™»å½•å¯å»æ‰)</span><br>useradd -g sonar -s /sbin/nologin sonar<br><br><span class="hljs-comment"># è®¾ç½®æƒé™</span><br><span class="hljs-built_in">chown</span> sonar:sonar -R /app/sonarqube/<br><br>su -s /bin/bash - sonar<br><br>æ³¨ï¼šSonarQubeå¿…é¡»ä»¥æ™®é€šç”¨æˆ·è¿è¡Œï¼Œä¸èƒ½ä½¿ç”¨rootç”¨æˆ·<br></code></pre></td></tr></table></figure><h3 id="3-æ›´æ”¹é…ç½®æ–‡ä»¶"><a href="#3-æ›´æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="3.æ›´æ”¹é…ç½®æ–‡ä»¶"></a>3.æ›´æ”¹é…ç½®æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /app/sonarqube/sonarqube-9.6.1.59531/conf/sonar.properties<br><br><span class="hljs-comment">#å·²ä½¿ç”¨dockeråœ¨192.168.94.155æœºå™¨ä¸Šå®‰è£…postgresï¼Œå®‰è£…postgreså¯å‚è€ƒæ–‡æ¡£</span><br>sonar.jdbc.username=postgres<br>sonar.jdbc.password=123456<br>sonar.jdbc.url=jdbc:postgresql://192.168.94.155:5432/sonar<br></code></pre></td></tr></table></figure><h3 id="4-å¯åŠ¨SonarQube"><a href="#4-å¯åŠ¨SonarQube" class="headerlink" title="4.å¯åŠ¨SonarQube"></a>4.å¯åŠ¨SonarQube</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">##ç¬¬ä¸€æ¬¡æœåŠ¡å¯åŠ¨æ—¶ï¼Œä½¿ç”¨è¯¥å‘½ä»¤ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜</span><br>/app/sonarqube/sonarqube-9.6.1.59531/bin/linux-x86-64/sonar.sh console<br><br><span class="hljs-comment">#æ— é—®é¢˜å</span><br>/app/sonarqube/sonarqube-9.6.1.59531/bin/linux-x86-64/sonar.sh start<br></code></pre></td></tr></table></figure><h4 id="å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜å¤„ç†ï¼š"><a href="#å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜å¤„ç†ï¼š" class="headerlink" title="å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜å¤„ç†ï¼š"></a>å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜å¤„ç†ï¼š</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs smali">é—®é¢˜ï¼š<br>ERROR: [1] bootstrap checks failed. You must address the points described in the following [1] lines before starting Elasticsearch.<br>bootstrap<span class="hljs-built_in"> check </span>failure [1] of [1]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]<br><br>å¤„ç†æ–¹æ³•ï¼š<br>vim /etc/sysctl.conf<br><br><span class="hljs-comment">#æœ€åä¸€è¡Œæ·»åŠ ,å¹¶ä¿å­˜é€€å‡º</span><br>vm.max_map_count=262144<br><br><span class="hljs-comment">#åŠ è½½ä½¿å…¶ç”Ÿæ•ˆ</span><br>sysctl -p<br></code></pre></td></tr></table></figure><h3 id="5-ç™»å½•é…ç½®"><a href="#5-ç™»å½•é…ç½®" class="headerlink" title="5.ç™»å½•é…ç½®"></a>5.ç™»å½•é…ç½®</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs txt">å¯åŠ¨æˆåŠŸï¼šè®¿é—®ï¼š192.168.94.154:9000<br>ï¼ˆ1ï¼‰é»˜è®¤è´¦æˆ·admin/adminï¼Œé¦–æ¬¡ç™»å½•ï¼Œå¼ºåˆ¶ä¿®æ”¹å¯†ç <br><br>ï¼ˆ2ï¼‰å®‰è£…æ±‰åŒ–æ’ä»¶ï¼šé€‰æ‹© Administration -&gt; Marketplace -&gt; Plugins ä¸­æœç´¢ Chinese pack ï¼Œç„¶åInstall.<br><br>![image-20220907102018599](sonarQubeå®‰è£…éƒ¨ç½²/image-20220907102018599.png)<br><br>æ³¨æ„ï¼šå¦‚é‡åˆ°Chinese pack æ’ä»¶ä¸èƒ½ç›´æ¥åœ¨Marketplaceä¸­ç›´æ¥å®‰è£…ï¼Œå¯é‡‡ç”¨ä»¥ä¸‹æ–¹å¼ï¼š<br><br>- è®¿é—®æ’ä»¶GitHubé¡¹ç›®åº“ï¼š<br>https://github.com/xuhuisheng/sonar-l10n-zh/releases/tag/sonar-l10n-zh-plugin-9.4<br>- ä¸‹è½½Chinese pack jaråŒ…<br>- æŠŠjaråŒ…æ”¾åœ¨SonarQubeæœåŠ¡æ–‡ä»¶å¤¹ä¸‹çš„extensions/pluginsä¸­<br>ä¸¾ä¾‹ï¼šå°†jaråŒ…æ”¾ç½®/app/sonarqube/sonarqube-9.6.1.59531/extensions/plugins<br>- ç„¶åé‡å¯å³å¯ï¼š ./sonar.sh restart<br></code></pre></td></tr></table></figure><h2 id="SonarScanneræ‰«æ"><a href="#SonarScanneræ‰«æ" class="headerlink" title="SonarScanneræ‰«æ"></a><strong>SonarScanneræ‰«æ</strong></h2><h3 id="1ã€ä¸‹è½½åœ°å€ï¼šhttps-docs-sonarqube-org-latest-analysis-scan-sonarscanner"><a href="#1ã€ä¸‹è½½åœ°å€ï¼šhttps-docs-sonarqube-org-latest-analysis-scan-sonarscanner" class="headerlink" title="1ã€ä¸‹è½½åœ°å€ï¼šhttps://docs.sonarqube.org/latest/analysis/scan/sonarscanner/"></a>1ã€ä¸‹è½½åœ°å€ï¼š<code>https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/</code></h3><p><img src="/2023/03/29/devops/sonarQube/sonarQube%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/image-20220908145251627.png" alt="image-20220908145251627"></p><h3 id="2ã€è§£å‹æ–‡ä»¶å¹¶é…ç½®ç¯å¢ƒå˜é‡"><a href="#2ã€è§£å‹æ–‡ä»¶å¹¶é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="2ã€è§£å‹æ–‡ä»¶å¹¶é…ç½®ç¯å¢ƒå˜é‡"></a>2ã€è§£å‹æ–‡ä»¶å¹¶é…ç½®ç¯å¢ƒå˜é‡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è§£å‹æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•</span><br>unzip sonar-scanner-cli-4.7.0.2747-linux.zip -d /opt/Sonar-scanner<br><br><span class="hljs-comment">#é…ç½®ç¯å¢ƒå˜é‡</span><br>vim /etc/profile<br><span class="hljs-comment">#æŒ‰GGåˆ°æœ€åä¸€è¡Œï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹</span><br><span class="hljs-comment"># sonar-scanner</span><br><span class="hljs-built_in">export</span> Sonar_Home=/opt/Sonar-scanner<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$Sonar_Home</span>/bin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment">#ä½¿é…ç½®ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><p>æ‰«ææ–¹å¼ï¼šå¯å‚è€ƒä¸Šé¢ã€ŠSonarQube+SonarScanner æœ€å…¨å®‰è£…æ­¥éª¤ã€‹æ–‡çŒ®</p><h3 id="3ã€å¦‚æœåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ— æ³•åˆ›å»º-sonar-project-properties-æ–‡ä»¶ï¼Œæœ‰å‡ ç§æ›¿ä»£æ–¹æ³•ï¼š"><a href="#3ã€å¦‚æœåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ— æ³•åˆ›å»º-sonar-project-properties-æ–‡ä»¶ï¼Œæœ‰å‡ ç§æ›¿ä»£æ–¹æ³•ï¼š" class="headerlink" title="3ã€å¦‚æœåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ— æ³•åˆ›å»º sonar-project.properties æ–‡ä»¶ï¼Œæœ‰å‡ ç§æ›¿ä»£æ–¹æ³•ï¼š"></a>3ã€å¦‚æœåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ— æ³•åˆ›å»º sonar-project.properties æ–‡ä»¶ï¼Œæœ‰å‡ ç§æ›¿ä»£æ–¹æ³•ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œç›´æ¥æŒ‡å®šå±æ€§ï¼š<br>sonar-scanner -Dsonar.projectKey=myproject -Dsonar.sources=src1<br><br>å±æ€§ project.settings å¯ç”¨äºæŒ‡å®šé¡¹ç›®é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼ˆè¯¥é€‰é¡¹ä¸è¯¥sonar.projectBaseDirå±æ€§ä¸å…¼å®¹ï¼‰ï¼š<br>sonar-scanner -Dproject.settings=../myproject.properties<br><br>sonar.projectBaseDirä» SonarScanner 2.4 å¼€å§‹ï¼Œå¯ä»¥é€šè¿‡å±æ€§è®¾ç½®è¦åˆ†æçš„é¡¹ç›®çš„æ ¹æ–‡ä»¶å¤¹ã€‚\<br>sonar-project.propertieså¦‚æœsonar.projectKeyæœªåœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šï¼Œæ­¤æ–‡ä»¶å¤¹å¿…é¡»åŒ…å«æ–‡ä»¶ã€‚å¯ä»¥åœ¨æ­¤é¡¹ç›®é…ç½®æ–‡ä»¶ä¸­æˆ–é€šè¿‡å‘½ä»¤è¡Œå‚æ•°å®šä¹‰å…¶ä»–åˆ†æå‚æ•°ã€‚<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
      <category>SonarQube</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SonarQube</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨dockerè¿è¡ŒNexusæ­å»ºMavenç§æœ</title>
    <link href="/2023/03/29/devops/nexus/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8CNexus%E6%90%AD%E5%BB%BAMaven%E7%A7%81%E6%9C%8D/"/>
    <url>/2023/03/29/devops/nexus/%E4%BD%BF%E7%94%A8docker%E8%BF%90%E8%A1%8CNexus%E6%90%AD%E5%BB%BAMaven%E7%A7%81%E6%9C%8D/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨dockerè¿è¡ŒNexusæ­å»ºMavenç§æœ"><a href="#ä½¿ç”¨dockerè¿è¡ŒNexusæ­å»ºMavenç§æœ" class="headerlink" title="ä½¿ç”¨dockerè¿è¡ŒNexusæ­å»ºMavenç§æœ"></a>ä½¿ç”¨dockerè¿è¡ŒNexusæ­å»ºMavenç§æœ</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://www.hangge.com/blog/cache/detail_2844.html<br></code></pre></td></tr></table></figure><h2 id="dockeræ–¹å¼è¿è¡ŒNexus"><a href="#dockeræ–¹å¼è¿è¡ŒNexus" class="headerlink" title="dockeræ–¹å¼è¿è¡ŒNexus"></a>dockeræ–¹å¼è¿è¡ŒNexus</h2><h3 id="1ï¼‰æ‹‰å–Nexus3-é•œåƒï¼š"><a href="#1ï¼‰æ‹‰å–Nexus3-é•œåƒï¼š" class="headerlink" title="1ï¼‰æ‹‰å–Nexus3 é•œåƒï¼š"></a>1ï¼‰æ‹‰å–Nexus3 é•œåƒï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull sonatype/nexus3<br></code></pre></td></tr></table></figure><h3 id="2ï¼‰æ¥ç€æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºå®¿ä¸»æœºæŒ‚è½½ç›®å½•ï¼š"><a href="#2ï¼‰æ¥ç€æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºå®¿ä¸»æœºæŒ‚è½½ç›®å½•ï¼š" class="headerlink" title="2ï¼‰æ¥ç€æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºå®¿ä¸»æœºæŒ‚è½½ç›®å½•ï¼š"></a>2ï¼‰æ¥ç€æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºå®¿ä¸»æœºæŒ‚è½½ç›®å½•ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> â€“p /app/nexus-data<br><span class="hljs-built_in">chown</span> -R 200 /app/nexus-data<br><span class="hljs-comment">#chmod 777 /app/nexus-data</span><br></code></pre></td></tr></table></figure><h3 id="3ï¼‰æœ€åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿è¡Œ-Nexus3-å®¹å™¨å³å¯ï¼š"><a href="#3ï¼‰æœ€åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿è¡Œ-Nexus3-å®¹å™¨å³å¯ï¼š" class="headerlink" title="3ï¼‰æœ€åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿è¡Œ Nexus3 å®¹å™¨å³å¯ï¼š"></a>3ï¼‰æœ€åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿è¡Œ Nexus3 å®¹å™¨å³å¯ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d -e TZ=Asia/Shanghai \<br>--restart=always \<br>--name nexus3 \<br>-p 8081:8081 \<br>-v /app/nexus-data:/nexus-data \<br>sonatype/nexus3<br></code></pre></td></tr></table></figure><h2 id="nexus3-docker-æ•°æ®è¿ç§»"><a href="#nexus3-docker-æ•°æ®è¿ç§»" class="headerlink" title="nexus3 docker æ•°æ®è¿ç§»"></a>nexus3 docker æ•°æ®è¿ç§»</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">å‚è€ƒæ–‡æ¡£ï¼šhttps:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/allenjsl/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">119829495</span><br></code></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼šæ•°æ®è¿ç§»æ—¶ï¼šå¤åˆ¶è¿‡å»çš„æ•°æ®ç›®å½•éœ€è¦ç»™æƒé™,æœ‰äº›å¯åŠ¨ä¸äº†çš„æƒ…å†µä¹Ÿéœ€è¦èµ‹äºˆæƒé™</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">chown</span> -R 200<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
      <category>Nexus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nexus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mavençš„ä½¿ç”¨</title>
    <link href="/2023/03/29/devops/maven/maven%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/03/29/devops/maven/maven%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Mavençš„ä½¿ç”¨"><a href="#Mavençš„ä½¿ç”¨" class="headerlink" title="Mavençš„ä½¿ç”¨"></a>Mavençš„ä½¿ç”¨</h1><p>è¯¦ç»†æ–‡æ¡£ï¼š<a href="https://blog.csdn.net/lovequanquqn/article/details/81627807">https://blog.csdn.net/lovequanquqn/article/details/81627807</a></p><h2 id="Mavenè§„å®šçš„ç›®å½•ç»“æ„"><a href="#Mavenè§„å®šçš„ç›®å½•ç»“æ„" class="headerlink" title="Mavenè§„å®šçš„ç›®å½•ç»“æ„"></a>Mavenè§„å®šçš„ç›®å½•ç»“æ„</h2><p>è‹¥è¦ä½¿ç”¨Mavenï¼Œé‚£ä¹ˆé¡¹ç›®çš„ç›®å½•ç»“æ„å¿…é¡»ç¬¦åˆMavençš„è§„èŒƒï¼Œå…¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/2023/03/29/devops/maven/maven%E7%9A%84%E4%BD%BF%E7%94%A8/201808131239225" alt="img"></p><h2 id="MavenåŸºæœ¬å‘½ä»¤"><a href="#MavenåŸºæœ¬å‘½ä»¤" class="headerlink" title="MavenåŸºæœ¬å‘½ä»¤"></a>MavenåŸºæœ¬å‘½ä»¤</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">-v:æŸ¥è¯¢Mavenç‰ˆæœ¬<br>æœ¬å‘½ä»¤ç”¨äºæ£€æŸ¥mavenæ˜¯å¦å®‰è£…æˆåŠŸã€‚<br>Mavenå®‰è£…å®Œæˆä¹‹åï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥mvn -vï¼Œè‹¥å‡ºç°mavenä¿¡æ¯ï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚<br><br>compileï¼šç¼–è¯‘<br>å°†javaæºæ–‡ä»¶ç¼–è¯‘æˆclassæ–‡ä»¶<br><br><span class="hljs-built_in">test</span>:æµ‹è¯•é¡¹ç›®<br>æ‰§è¡Œ<span class="hljs-built_in">test</span>ç›®å½•ä¸‹çš„æµ‹è¯•ç”¨ä¾‹<br><br>package:æ‰“åŒ…<br>å°†é¡¹ç›®æ‰“æˆjaråŒ…<br><br>clean:åˆ é™¤targetæ–‡ä»¶å¤¹<br><br>install:å®‰è£…<br>å°†å½“å‰é¡¹ç›®æ”¾åˆ°Mavençš„æœ¬åœ°ä»“åº“ä¸­ï¼Œä¾›å…¶ä»–é¡¹ç›®ä½¿ç”¨ã€‚<br></code></pre></td></tr></table></figure><h2 id="ä»€ä¹ˆæ˜¯Mavenä»“åº“ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Mavenä»“åº“ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Mavenä»“åº“ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯Mavenä»“åº“ï¼Ÿ</h2><p>Mavenä»“åº“ç”¨æ¥å­˜æ”¾Mavenç®¡ç†çš„æ‰€æœ‰JaråŒ…ã€‚åˆ†ä¸ºï¼šæœ¬åœ°ä»“åº“ å’Œ ä¸­å¤®ä»“åº“ã€‚<br>æœ¬åœ°ä»“åº“ï¼šMavenæœ¬åœ°çš„JaråŒ…ä»“åº“ã€‚<br>ä¸­å¤®ä»“åº“ï¼š Mavenå®˜æ–¹æä¾›çš„è¿œç¨‹ä»“åº“ã€‚<br>å½“é¡¹ç›®ç¼–è¯‘æ—¶ï¼ŒMavené¦–å…ˆä»æœ¬åœ°ä»“åº“ä¸­å¯»æ‰¾é¡¹ç›®æ‰€éœ€çš„JaråŒ…ï¼Œè‹¥æœ¬åœ°ä»“åº“æ²¡æœ‰ï¼Œå†åˆ°Mavençš„ä¸­å¤®ä»“åº“ä¸‹è½½æ‰€éœ€JaråŒ…ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯â€œåæ ‡â€ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯â€œåæ ‡â€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯â€œåæ ‡â€ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯â€œåæ ‡â€ï¼Ÿ</h2><p>åœ¨Mavenä¸­ï¼Œåæ ‡æ˜¯JaråŒ…çš„å”¯ä¸€æ ‡è¯†ï¼ŒMavené€šè¿‡åæ ‡åœ¨ä»“åº“ä¸­æ‰¾åˆ°é¡¹ç›®æ‰€éœ€çš„JaråŒ…ã€‚</p><p>å¦‚ä¸‹ä»£ç ä¸­ï¼ŒgroupIdå’ŒartifactIdæ„æˆäº†ä¸€ä¸ªJaråŒ…çš„åæ ‡ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;dependency&gt;<br>   &lt;groupId&gt;cn.missbe.web.search&lt;/groupId&gt;<br>   &lt;artifactId&gt;resource-search&lt;/artifactId&gt;<br>   &lt;packaging&gt;jar&lt;/packaging&gt;<br>   &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><ul><li>groupIdï¼šæ‰€éœ€JaråŒ…çš„é¡¹ç›®å</li><li>artifactIdï¼šæ‰€éœ€JaråŒ…çš„æ¨¡å—å</li><li>versionï¼šæ‰€éœ€JaråŒ…çš„ç‰ˆæœ¬å·</li></ul><h2 id="ä¼ é€’ä¾èµ–-ä¸-æ’é™¤ä¾èµ–"><a href="#ä¼ é€’ä¾èµ–-ä¸-æ’é™¤ä¾èµ–" class="headerlink" title="ä¼ é€’ä¾èµ– ä¸ æ’é™¤ä¾èµ–"></a>ä¼ é€’ä¾èµ– ä¸ æ’é™¤ä¾èµ–</h2><p>ä¼ é€’ä¾èµ–ï¼šå¦‚æœæˆ‘ä»¬çš„é¡¹ç›®å¼•ç”¨äº†ä¸€ä¸ªJaråŒ…ï¼Œè€Œè¯¥JaråŒ…åˆå¼•ç”¨äº†å…¶ä»–JaråŒ…ï¼Œé‚£ä¹ˆåœ¨é»˜è®¤æƒ…å†µä¸‹é¡¹ç›®ç¼–è¯‘æ—¶ï¼ŒMavenä¼šæŠŠç›´æ¥å¼•ç”¨å’Œé—´æ¥å¼•ç”¨çš„JaråŒ…éƒ½ä¸‹è½½åˆ°æœ¬åœ°ã€‚<br>æ’é™¤ä¾èµ–ï¼šå¦‚æœæˆ‘ä»¬åªæƒ³ä¸‹è½½ç›´æ¥å¼•ç”¨çš„JaråŒ…ï¼Œé‚£ä¹ˆéœ€è¦åœ¨pom.xmlä¸­åšå¦‚ä¸‹é…ç½®ï¼š(å°†éœ€è¦æ’é™¤çš„JaråŒ…çš„åæ ‡å†™åœ¨ä¸­)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;exclusions&gt;<br>   &lt;exclusion&gt;<br>      &lt;groupId&gt;cn.missbe.web.search&lt;/groupId&gt;<br>      &lt;artifactId&gt;resource-search&lt;/artifactId&gt;<br>      &lt;packaging&gt;pom&lt;/packaging&gt;<br>      &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;<br>   &lt;/exclusion&gt;<br>&lt;/exclusions&gt;<br></code></pre></td></tr></table></figure><h2 id="ä¾èµ–èŒƒå›´scope"><a href="#ä¾èµ–èŒƒå›´scope" class="headerlink" title="ä¾èµ–èŒƒå›´scope"></a>ä¾èµ–èŒƒå›´scope</h2><p>åœ¨é¡¹ç›®å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œå¸®åŠ©å†³å®šå“ªäº›æ„ä»¶è¢«åŒ…æ‹¬è¿›æ¥ã€‚æ¬²çŸ¥è¯¦æƒ…è¯·å‚è€ƒä¾èµ–æœºåˆ¶ã€‚        </p><ul><li>compile ï¼šé»˜è®¤èŒƒå›´ï¼Œç”¨äºç¼–è¯‘      </li><li>providedï¼šç±»ä¼¼äºç¼–è¯‘ï¼Œä½†æ”¯æŒä½ æœŸå¾…jdkæˆ–è€…å®¹å™¨æä¾›ï¼Œç±»ä¼¼äºclasspath      </li><li>runtime: åœ¨æ‰§è¡Œæ—¶éœ€è¦ä½¿ç”¨      </li><li>test:    ç”¨äºtestä»»åŠ¡æ—¶ä½¿ç”¨      </li><li>system: éœ€è¦å¤–åœ¨æä¾›ç›¸åº”çš„å…ƒç´ ã€‚é€šè¿‡systemPathæ¥å–å¾—      </li><li>systemPath: ä»…ç”¨äºèŒƒå›´ä¸ºsystemã€‚æä¾›ç›¸åº”çš„è·¯å¾„      </li><li>optional:   å½“é¡¹ç›®è‡ªèº«è¢«ä¾èµ–æ—¶ï¼Œæ ‡æ³¨ä¾èµ–æ˜¯å¦ä¼ é€’ã€‚ç”¨äºè¿ç»­ä¾èµ–æ—¶ä½¿ç”¨</li></ul><h2 id="ä¾èµ–å†²çª"><a href="#ä¾èµ–å†²çª" class="headerlink" title="ä¾èµ–å†²çª"></a>ä¾èµ–å†²çª</h2><p>è‹¥é¡¹ç›®ä¸­å¤šä¸ªJaråŒæ—¶å¼•ç”¨äº†ç›¸åŒçš„Jaræ—¶ï¼Œä¼šäº§ç”Ÿä¾èµ–å†²çªï¼Œä½†Mavené‡‡ç”¨äº†ä¸¤ç§é¿å…å†²çªçš„ç­–ç•¥ï¼Œå› æ­¤åœ¨Mavenä¸­æ˜¯ä¸å­˜åœ¨ä¾èµ–å†²çªçš„ã€‚</p><h3 id="1-çŸ­è·¯ä¼˜å…ˆ"><a href="#1-çŸ­è·¯ä¼˜å…ˆ" class="headerlink" title="1.çŸ­è·¯ä¼˜å…ˆ"></a>1.çŸ­è·¯ä¼˜å…ˆ</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">æœ¬é¡¹ç›®â€”â€”&gt;<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">A</span>.</span></span>jarâ€”â€”&gt;<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">B</span>.</span></span>jarâ€”â€”&gt;<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">X</span>.</span></span>jar<br>æœ¬é¡¹ç›®â€”â€”&gt;<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">C</span>.</span></span>jarâ€”â€”&gt;<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">X</span>.</span></span>jar<br></code></pre></td></tr></table></figure><p>è‹¥æœ¬é¡¹ç›®å¼•ç”¨äº†A.jarï¼ŒA.jaråˆå¼•ç”¨äº†B.jarï¼ŒB.jaråˆå¼•ç”¨äº†X.jarï¼Œå¹¶ä¸”C.jarä¹Ÿå¼•ç”¨äº†X.jarã€‚<br>åœ¨æ­¤æ—¶ï¼ŒMavenåªä¼šå¼•ç”¨å¼•ç”¨è·¯å¾„æœ€çŸ­çš„Jarã€‚</p><h3 id="2-å£°æ˜ä¼˜å…ˆ"><a href="#2-å£°æ˜ä¼˜å…ˆ" class="headerlink" title="2.å£°æ˜ä¼˜å…ˆ"></a>2.å£°æ˜ä¼˜å…ˆ</h3><p>è‹¥å¼•ç”¨è·¯å¾„é•¿åº¦ç›¸åŒæ—¶ï¼Œåœ¨pom.xmlä¸­è°å…ˆè¢«å£°æ˜ï¼Œå°±ä½¿ç”¨è°ã€‚</p><h2 id="èšåˆ"><a href="#èšåˆ" class="headerlink" title="èšåˆ"></a>èšåˆ</h2><h3 id="1-ä»€ä¹ˆæ˜¯èšåˆï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯èšåˆï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯èšåˆï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯èšåˆï¼Ÿ</h3><p>å°†å¤šä¸ªé¡¹ç›®åŒæ—¶è¿è¡Œå°±ç§°ä¸ºèšåˆã€‚</p><h3 id="2-å¦‚ä½•å®ç°èšåˆï¼Ÿ"><a href="#2-å¦‚ä½•å®ç°èšåˆï¼Ÿ" class="headerlink" title="2.å¦‚ä½•å®ç°èšåˆï¼Ÿ"></a>2.å¦‚ä½•å®ç°èšåˆï¼Ÿ</h3><p>åªéœ€åœ¨pomä¸­ä½œå¦‚ä¸‹é…ç½®å³å¯å®ç°èšåˆï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;modules&gt;<br>    &lt;module&gt;web-connection-pool&lt;/module&gt;<br>    &lt;module&gt;web-java-crawler&lt;/module&gt;<br>&lt;/modules&gt;<br></code></pre></td></tr></table></figure><h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><h3 id="1-ä»€ä¹ˆæ˜¯ç»§æ‰¿ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯ç»§æ‰¿ï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯ç»§æ‰¿ï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯ç»§æ‰¿ï¼Ÿ</h3><p>åœ¨èšåˆå¤šä¸ªé¡¹ç›®æ—¶ï¼Œå¦‚æœè¿™äº›è¢«èšåˆçš„é¡¹ç›®ä¸­éœ€è¦å¼•å…¥ç›¸åŒçš„Jarï¼Œé‚£ä¹ˆå¯ä»¥å°†è¿™äº›Jarå†™å…¥çˆ¶pomä¸­ï¼Œå„ä¸ªå­é¡¹ç›®ç»§æ‰¿è¯¥pomå³å¯ã€‚</p><h3 id="2-å¦‚ä½•å®ç°ç»§æ‰¿ï¼Ÿ"><a href="#2-å¦‚ä½•å®ç°ç»§æ‰¿ï¼Ÿ" class="headerlink" title="2.å¦‚ä½•å®ç°ç»§æ‰¿ï¼Ÿ"></a>2.å¦‚ä½•å®ç°ç»§æ‰¿ï¼Ÿ</h3><p>çˆ¶pomé…ç½®ï¼šå°†éœ€è¦ç»§æ‰¿çš„JaråŒ…çš„åæ ‡æ”¾å…¥æ ‡ç­¾å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;dependencyManagement&gt;<br>    &lt;dependencies&gt;<br>          &lt;dependency&gt;<br>            &lt;groupId&gt;cn.missbe.web.search&lt;/groupId&gt;<br>            &lt;artifactId&gt;resource-search&lt;/artifactId&gt;<br>            &lt;packaging&gt;pom&lt;/packaging&gt;<br>            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;<br>          &lt;/dependency&gt; <br>    &lt;/dependencies&gt;<br>&lt;/dependencyManagement&gt;<br></code></pre></td></tr></table></figure><p>å­pomé…ç½®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;parent&gt;<br>      &lt;groupId&gt;çˆ¶pomæ‰€åœ¨é¡¹ç›®çš„groupId&lt;/groupId&gt;<br>      &lt;artifactId&gt;çˆ¶pomæ‰€åœ¨é¡¹ç›®çš„artifactId&lt;/artifactId&gt;<br>      &lt;version&gt;çˆ¶pomæ‰€åœ¨é¡¹ç›®çš„ç‰ˆæœ¬å·&lt;/version&gt;<br>&lt;/parent&gt;<br> &lt;parent&gt;<br>      &lt;artifactId&gt;resource-search&lt;/artifactId&gt;<br>      &lt;groupId&gt;cn.missbe.web.search&lt;/groupId&gt;<br>      &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;<br>&lt;/parent&gt;<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨Mavenæ„å»ºWebé¡¹ç›®"><a href="#ä½¿ç”¨Mavenæ„å»ºWebé¡¹ç›®" class="headerlink" title="ä½¿ç”¨Mavenæ„å»ºWebé¡¹ç›®"></a>ä½¿ç”¨Mavenæ„å»ºWebé¡¹ç›®</h2><h3 id="1-New-Mavené¡¹ç›®ï¼šé€‰æ‹©WebApp"><a href="#1-New-Mavené¡¹ç›®ï¼šé€‰æ‹©WebApp" class="headerlink" title="1.New Mavené¡¹ç›®ï¼šé€‰æ‹©WebApp"></a>1.New Mavené¡¹ç›®ï¼šé€‰æ‹©WebApp</h3><h3 id="2-è‹¥ä½¿ç”¨JSPï¼Œéœ€æ·»åŠ Servletä¾èµ–"><a href="#2-è‹¥ä½¿ç”¨JSPï¼Œéœ€æ·»åŠ Servletä¾èµ–" class="headerlink" title="2.è‹¥ä½¿ç”¨JSPï¼Œéœ€æ·»åŠ Servletä¾èµ–"></a>2.è‹¥ä½¿ç”¨JSPï¼Œéœ€æ·»åŠ Servletä¾èµ–</h3><p>æ³¨ï¼šServletä¾èµ–åªåœ¨ç¼–è¯‘å’Œæµ‹è¯•æ—¶ä½¿ç”¨ï¼</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;dependency&gt;<br>    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;<br>    &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;<br>    &lt;version&gt;3.0.1&lt;/version&gt;<br>    &lt;!-- åªåœ¨ç¼–è¯‘å’Œæµ‹è¯•æ—¶è¿è¡Œ --&gt;<br>    &lt;scope&gt;provided&lt;/scope&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>1.åœ¨Bulid Pathä¸­è®¾ç½®resourceè¾“å‡ºç›®å½•<br>2.å‹¾é€‰ï¼šDynamic Web Module<br>3.åˆ æ‰æµ‹è¯•ç›®å½•<br>4.åœ¨pomä¸­åŠ å…¥jettyçš„æ’ä»¶ï¼Œå¹¶è®¾ç½®JDKç‰ˆæœ¬</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;plugins&gt; <br>  &lt;plugin&gt; <br>    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;  <br>    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;  <br>    &lt;configuration&gt; <br>      &lt;<span class="hljs-built_in">source</span>&gt;1.8&lt;/source&gt;  <br>      &lt;target&gt;1.8&lt;/target&gt; <br>    &lt;/configuration&gt; <br>  &lt;/plugin&gt;  <br>  &lt;plugin&gt; <br>    &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;  <br>    &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;  <br>    &lt;version&gt;9.3.10.v20160621&lt;/version&gt;  <br>    &lt;executions&gt; <br>      &lt;execution&gt; <br>        &lt;phase&gt;package&lt;/phase&gt; <br>      &lt;/execution&gt; <br>    &lt;/executions&gt; <br>  &lt;/plugin&gt; <br>&lt;/plugins&gt;<br></code></pre></td></tr></table></figure><p>è¿è¡Œé¡¹ç›®ï¼š</p><p>è¾“å…¥ï¼šjetty:run</p><p>è®¿é—®127.0.0.1:8080</p><p>è‹¥å‡ºç°å¦‚ä¸‹ç•Œé¢ï¼Œè¡¨ç¤ºæˆåŠŸï¼</p><h2 id="pom-xmlè¯¦è§£"><a href="#pom-xmlè¯¦è§£" class="headerlink" title="pom.xmlè¯¦è§£"></a>pom.xmlè¯¦è§£</h2><p>pom.xmlæ˜¯Mavençš„æ ¸å¿ƒï¼Œä½ çš„é¡¹ç›®éœ€è¦ä»€ä¹ˆJaråŒ…å°±åœ¨pom.xmlé‡Œé¢é…ç½®ã€‚å½“ç¼–è¯‘é¡¹ç›®æ—¶Mavenè¯»å–è¯¥æ–‡ä»¶ï¼Œå¹¶ä»ä»“åº“ä¸­ä¸‹è½½ç›¸åº”çš„JaråŒ…ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;<br> <br>&lt;project xmlns=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xsi:schemaLocation=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;  <br>  &lt;!--çˆ¶é¡¹ç›®çš„åæ ‡ã€‚å¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰è§„å®šæŸä¸ªå…ƒç´ çš„å€¼ï¼Œ<br>é‚£ä¹ˆçˆ¶é¡¹ç›®ä¸­çš„å¯¹åº”å€¼å³ä¸ºé¡¹ç›®çš„é»˜è®¤å€¼ã€‚ <br>åæ ‡åŒ…æ‹¬group IDï¼Œartifact IDå’Œ versionã€‚--&gt;  <br>  &lt;parent&gt; <br>    &lt;!--è¢«ç»§æ‰¿çš„çˆ¶é¡¹ç›®çš„æ„ä»¶æ ‡è¯†ç¬¦--&gt;  <br>    &lt;artifactId/&gt;  <br>    &lt;!--è¢«ç»§æ‰¿çš„çˆ¶é¡¹ç›®çš„å…¨çƒå”¯ä¸€æ ‡è¯†ç¬¦--&gt;  <br>    &lt;groupId/&gt;  <br>    &lt;!--è¢«ç»§æ‰¿çš„çˆ¶é¡¹ç›®çš„ç‰ˆæœ¬--&gt;  <br>    &lt;version/&gt; <br>  &lt;/parent&gt;  <br>  &lt;!--å£°æ˜é¡¹ç›®æè¿°ç¬¦éµå¾ªå“ªä¸€ä¸ªPOMæ¨¡å‹ç‰ˆæœ¬ã€‚æ¨¡å‹æœ¬èº«çš„ç‰ˆæœ¬å¾ˆå°‘æ”¹å˜ï¼Œè™½ç„¶å¦‚æ­¤ï¼Œ<br>ä½†å®ƒä»ç„¶æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œè¿™æ˜¯ä¸ºäº†å½“Mavenå¼•å…¥äº†æ–°çš„ç‰¹æ€§æˆ–è€…å…¶ä»–æ¨¡å‹å˜æ›´çš„æ—¶å€™ï¼Œ<br>ç¡®ä¿ç¨³å®šæ€§ã€‚--&gt;  <br>  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;  <br>  &lt;!--é¡¹ç›®çš„å…¨çƒå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé€šå¸¸ä½¿ç”¨å…¨é™å®šçš„åŒ…ååŒºåˆ†è¯¥é¡¹ç›®å’Œå…¶ä»–é¡¹ç›®ã€‚<br>å¹¶ä¸”æ„å»ºæ—¶ç”Ÿæˆçš„è·¯å¾„ä¹Ÿæ˜¯ç”±æ­¤ç”Ÿæˆï¼Œ å¦‚com.mycompany.appç”Ÿæˆçš„ç›¸å¯¹è·¯å¾„ä¸ºï¼š<br>/com/mycompany/app--&gt;  <br>  &lt;groupId&gt;cn.missbe.web&lt;/groupId&gt;  <br>  &lt;!-- æ„ä»¶çš„æ ‡è¯†ç¬¦ï¼Œå®ƒå’Œgroup IDä¸€èµ·å”¯ä¸€æ ‡è¯†ä¸€ä¸ªæ„ä»¶ã€‚æ¢å¥è¯è¯´ï¼Œ<br>ä½ ä¸èƒ½æœ‰ä¸¤ä¸ªä¸åŒçš„é¡¹ç›®æ‹¥æœ‰åŒæ ·çš„artifact IDå’ŒgroupIDï¼›åœ¨æŸä¸ª <br>ç‰¹å®šçš„group IDä¸‹ï¼Œartifact IDä¹Ÿå¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚æ„ä»¶æ˜¯é¡¹ç›®äº§ç”Ÿçš„æˆ–ä½¿ç”¨çš„ä¸€ä¸ªä¸œè¥¿ï¼Œ<br>Mavenä¸ºé¡¹ç›®äº§ç”Ÿçš„æ„ä»¶åŒ…æ‹¬ï¼šJARsï¼Œæºç ï¼ŒäºŒè¿›åˆ¶å‘å¸ƒå’ŒWARsç­‰ã€‚--&gt;  <br>  &lt;artifactId&gt;search-resources&lt;/artifactId&gt;  <br>  &lt;!--é¡¹ç›®äº§ç”Ÿçš„æ„ä»¶ç±»å‹ï¼Œä¾‹å¦‚jarã€warã€earã€pomã€‚æ’ä»¶å¯ä»¥åˆ›å»º<br>ä»–ä»¬è‡ªå·±çš„æ„ä»¶ç±»å‹ï¼Œæ‰€ä»¥å‰é¢åˆ—çš„ä¸æ˜¯å…¨éƒ¨æ„ä»¶ç±»å‹--&gt;  <br>  &lt;packaging&gt;war&lt;/packaging&gt;  <br>  &lt;!--é¡¹ç›®å½“å‰ç‰ˆæœ¬ï¼Œæ ¼å¼ä¸º:ä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.å¢é‡ç‰ˆæœ¬-é™å®šç‰ˆæœ¬å·--&gt;  <br>  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;  <br>  &lt;!--é¡¹ç›®çš„åç§°, Mavenäº§ç”Ÿçš„æ–‡æ¡£ç”¨--&gt;  <br>  &lt;name&gt;search-resources&lt;/name&gt;  <br>  &lt;!--é¡¹ç›®ä¸»é¡µçš„URL, Mavenäº§ç”Ÿçš„æ–‡æ¡£ç”¨--&gt;  <br>  &lt;url&gt;http://www.missbe.cn&lt;/url&gt;  <br>  &lt;!-- é¡¹ç›®çš„è¯¦ç»†æè¿°, Maven äº§ç”Ÿçš„æ–‡æ¡£ç”¨ã€‚  å½“è¿™ä¸ªå…ƒç´ èƒ½å¤Ÿç”¨HTMLæ ¼å¼æè¿°æ—¶<br>ï¼ˆä¾‹å¦‚ï¼ŒCDATAä¸­çš„æ–‡æœ¬ä¼šè¢«è§£æå™¨å¿½ç•¥ï¼Œå°±å¯ä»¥åŒ…å«HTMLæ ‡ ç­¾ï¼‰ï¼Œ <br>ä¸é¼“åŠ±ä½¿ç”¨çº¯æ–‡æœ¬æè¿°ã€‚å¦‚æœä½ éœ€è¦ä¿®æ”¹äº§ç”Ÿçš„webç«™ç‚¹çš„ç´¢å¼•é¡µé¢ï¼Œ<br>ä½ åº”è¯¥ä¿®æ”¹ä½ è‡ªå·±çš„ç´¢å¼•é¡µæ–‡ä»¶ï¼Œè€Œä¸æ˜¯è°ƒæ•´è¿™é‡Œçš„æ–‡æ¡£ã€‚--&gt;  <br>  &lt;description&gt;A maven project to study maven.&lt;/description&gt;  <br>  &lt;!--æè¿°äº†è¿™ä¸ªé¡¹ç›®æ„å»ºç¯å¢ƒä¸­çš„å‰ææ¡ä»¶ã€‚--&gt;  <br>  &lt;prerequisites&gt; <br>    &lt;!--æ„å»ºè¯¥é¡¹ç›®æˆ–ä½¿ç”¨è¯¥æ’ä»¶æ‰€éœ€è¦çš„Mavençš„æœ€ä½ç‰ˆæœ¬--&gt;  <br>    &lt;maven/&gt; <br>  &lt;/prerequisites&gt;  <br>  &lt;!--æ„å»ºé¡¹ç›®éœ€è¦çš„ä¿¡æ¯--&gt;  <br>  &lt;build&gt; <br>    &lt;!--è¯¥å…ƒç´ è®¾ç½®äº†é¡¹ç›®æºç ç›®å½•ï¼Œå½“æ„å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œ<br>æ„å»ºç³»ç»Ÿä¼šç¼–è¯‘ç›®å½•é‡Œçš„æºç ã€‚è¯¥è·¯å¾„æ˜¯ç›¸å¯¹äºpom.xmlçš„ç›¸å¯¹è·¯å¾„ã€‚--&gt;  <br>    &lt;sourceDirectory/&gt;  <br>    &lt;!--è¯¥å…ƒç´ è®¾ç½®äº†é¡¹ç›®è„šæœ¬æºç ç›®å½•ï¼Œè¯¥ç›®å½•å’Œæºç ç›®å½•ä¸åŒï¼š<br>ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯¥ç›®å½•ä¸‹çš„å†…å®¹ ä¼šè¢«æ‹·è´åˆ°è¾“å‡ºç›®å½•(å› ä¸ºè„šæœ¬æ˜¯è¢«è§£é‡Šçš„ï¼Œè€Œä¸æ˜¯è¢«ç¼–è¯‘çš„)ã€‚--&gt;  <br>    &lt;scriptSourceDirectory/&gt;  <br>    &lt;!--è¯¥å…ƒç´ è®¾ç½®äº†é¡¹ç›®å•å…ƒæµ‹è¯•ä½¿ç”¨çš„æºç ç›®å½•ï¼Œå½“æµ‹è¯•é¡¹ç›®çš„æ—¶å€™ï¼Œ<br>æ„å»ºç³»ç»Ÿä¼šç¼–è¯‘ç›®å½•é‡Œçš„æºç ã€‚è¯¥è·¯å¾„æ˜¯ç›¸å¯¹äºpom.xmlçš„ç›¸å¯¹è·¯å¾„ã€‚--&gt;  <br>    &lt;testSourceDirectory/&gt;  <br>    &lt;!--è¢«ç¼–è¯‘è¿‡çš„åº”ç”¨ç¨‹åºclassæ–‡ä»¶å­˜æ”¾çš„ç›®å½•ã€‚--&gt;  <br>    &lt;outputDirectory/&gt;  <br>    &lt;!--è¢«ç¼–è¯‘è¿‡çš„æµ‹è¯•classæ–‡ä»¶å­˜æ”¾çš„ç›®å½•ã€‚--&gt;  <br>    &lt;testOutputDirectory/&gt;  <br>    &lt;!--ä½¿ç”¨æ¥è‡ªè¯¥é¡¹ç›®çš„ä¸€ç³»åˆ—æ„å»ºæ‰©å±•--&gt;  <br>    &lt;extensions&gt; <br>      &lt;!--æè¿°ä½¿ç”¨åˆ°çš„æ„å»ºæ‰©å±•ã€‚--&gt;  <br>      &lt;extension&gt; <br>        &lt;!--æ„å»ºæ‰©å±•çš„groupId--&gt;  <br>        &lt;groupId/&gt;  <br>        &lt;!--æ„å»ºæ‰©å±•çš„artifactId--&gt;  <br>        &lt;artifactId/&gt;  <br>        &lt;!--æ„å»ºæ‰©å±•çš„ç‰ˆæœ¬--&gt;  <br>        &lt;version/&gt; <br>      &lt;/extension&gt; <br>    &lt;/extensions&gt;  <br>    &lt;!--è¿™ä¸ªå…ƒç´ æè¿°äº†é¡¹ç›®ç›¸å…³çš„æ‰€æœ‰èµ„æºè·¯å¾„åˆ—è¡¨ï¼Œä¾‹å¦‚å’Œé¡¹ç›®ç›¸å…³çš„å±æ€§æ–‡ä»¶ï¼Œ<br>è¿™äº›èµ„æºè¢«åŒ…å«åœ¨æœ€ç»ˆçš„æ‰“åŒ…æ–‡ä»¶é‡Œã€‚--&gt;  <br>    &lt;resources&gt; <br>      &lt;!--è¿™ä¸ªå…ƒç´ æè¿°äº†é¡¹ç›®ç›¸å…³æˆ–æµ‹è¯•ç›¸å…³çš„æ‰€æœ‰èµ„æºè·¯å¾„--&gt;  <br>      &lt;resource&gt; <br>        &lt;!-- æè¿°äº†èµ„æºçš„ç›®æ ‡è·¯å¾„ã€‚è¯¥è·¯å¾„ç›¸å¯¹target/classesç›®å½•ï¼ˆä¾‹å¦‚<span class="hljs-variable">$&#123;project.build.outputDirectory&#125;</span>ï¼‰ã€‚ä¸¾ä¸ªä¾‹ å­ï¼Œå¦‚æœä½ æƒ³èµ„æºåœ¨ç‰¹å®šçš„åŒ…é‡Œ(org.apache.maven.messages)ï¼Œä½ å°±å¿…é¡»è¯¥å…ƒç´ è®¾ç½®ä¸ºorg/apache/maven /messagesã€‚<br>ç„¶è€Œï¼Œå¦‚æœä½ åªæ˜¯æƒ³æŠŠèµ„æºæ”¾åˆ°æºç ç›®å½•ç»“æ„é‡Œï¼Œå°±ä¸éœ€è¦è¯¥é…ç½®ã€‚--&gt;  <br>        &lt;targetPath/&gt;  <br>        &lt;!--æ˜¯å¦ä½¿ç”¨å‚æ•°å€¼ä»£æ›¿å‚æ•°åã€‚å‚æ•°å€¼å–è‡ªpropertieså…ƒç´ æˆ–è€…æ–‡ä»¶é‡Œé…ç½®çš„å±æ€§ï¼Œ<br>æ–‡ä»¶åœ¨filterså…ƒç´ é‡Œåˆ—å‡ºã€‚--&gt;  <br>        &lt;filtering/&gt;  <br>        &lt;!--æè¿°å­˜æ”¾èµ„æºçš„ç›®å½•ï¼Œè¯¥è·¯å¾„ç›¸å¯¹POMè·¯å¾„--&gt;  <br>        &lt;directory/&gt;  <br>        &lt;!--åŒ…å«çš„æ¨¡å¼åˆ—è¡¨ï¼Œä¾‹å¦‚**/*.xml.--&gt;  <br>        &lt;includes/&gt;  <br>        &lt;!--æ’é™¤çš„æ¨¡å¼åˆ—è¡¨ï¼Œä¾‹å¦‚**/*.xml--&gt;  <br>        &lt;excludes/&gt; <br>      &lt;/resource&gt; <br>    &lt;/resources&gt;  <br>    &lt;!--è¿™ä¸ªå…ƒç´ æè¿°äº†å•å…ƒæµ‹è¯•ç›¸å…³çš„æ‰€æœ‰èµ„æºè·¯å¾„ï¼Œä¾‹å¦‚å’Œå•å…ƒæµ‹è¯•ç›¸å…³çš„å±æ€§æ–‡ä»¶ã€‚--&gt;  <br>    &lt;testResources&gt; <br>      &lt;!--è¿™ä¸ªå…ƒç´ æè¿°äº†æµ‹è¯•ç›¸å…³çš„æ‰€æœ‰èµ„æºè·¯å¾„ï¼Œå‚è§build/resources/resourceå…ƒç´ çš„è¯´æ˜--&gt;  <br>      &lt;testResource&gt; <br>        &lt;targetPath/&gt;<br>        &lt;filtering/&gt;<br>        &lt;directory/&gt;<br>        &lt;includes/&gt;<br>        &lt;excludes/&gt; <br>      &lt;/testResource&gt; <br>    &lt;/testResources&gt;  <br>    &lt;!--æ„å»ºäº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶å­˜æ”¾çš„ç›®å½•--&gt;  <br>    &lt;directory/&gt;  <br>    &lt;!--äº§ç”Ÿçš„æ„ä»¶çš„æ–‡ä»¶åï¼Œé»˜è®¤å€¼æ˜¯<span class="hljs-variable">$&#123;artifactId&#125;</span>-<span class="hljs-variable">$&#123;version&#125;</span>ã€‚--&gt;  <br>    &lt;finalName/&gt;  <br>    &lt;!--å½“filteringå¼€å…³æ‰“å¼€æ—¶ï¼Œä½¿ç”¨åˆ°çš„è¿‡æ»¤å™¨å±æ€§æ–‡ä»¶åˆ—è¡¨--&gt;  <br>    &lt;filters/&gt;  <br>    &lt;!--å­é¡¹ç›®å¯ä»¥å¼•ç”¨çš„é»˜è®¤æ’ä»¶ä¿¡æ¯ã€‚è¯¥æ’ä»¶é…ç½®é¡¹ç›´åˆ°è¢«å¼•ç”¨æ—¶æ‰ä¼šè¢«è§£ææˆ–ç»‘å®šåˆ°ç”Ÿå‘½å‘¨æœŸã€‚<br>ç»™å®šæ’ä»¶çš„ä»»ä½•æœ¬åœ°é…ç½®éƒ½ä¼šè¦†ç›–è¿™é‡Œçš„é…ç½®--&gt;  <br>    &lt;pluginManagement&gt; <br>      &lt;!--ä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨ ã€‚--&gt;  <br>      &lt;plugins&gt; <br>        &lt;!--pluginå…ƒç´ åŒ…å«æè¿°æ’ä»¶æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚--&gt;  <br>        &lt;plugin&gt; <br>          &lt;!--æ’ä»¶åœ¨ä»“åº“é‡Œçš„group ID--&gt;  <br>          &lt;groupId/&gt;  <br>          &lt;!--æ’ä»¶åœ¨ä»“åº“é‡Œçš„artifact ID--&gt;  <br>          &lt;artifactId/&gt;  <br>          &lt;!--è¢«ä½¿ç”¨çš„æ’ä»¶çš„ç‰ˆæœ¬ï¼ˆæˆ–ç‰ˆæœ¬èŒƒå›´ï¼‰--&gt;  <br>          &lt;version/&gt;  <br>          &lt;!--æ˜¯å¦ä»è¯¥æ’ä»¶ä¸‹è½½Mavenæ‰©å±•ï¼ˆä¾‹å¦‚æ‰“åŒ…å’Œç±»å‹å¤„ç†å™¨ï¼‰ï¼Œç”±äºæ€§èƒ½åŸå› ï¼Œ<br>åªæœ‰åœ¨çœŸéœ€è¦ä¸‹è½½æ—¶ï¼Œè¯¥å…ƒç´ æ‰è¢«è®¾ç½®æˆenabledã€‚--&gt;  <br>          &lt;extensions/&gt;  <br>          &lt;!--åœ¨æ„å»ºç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œä¸€ç»„ç›®æ ‡çš„é…ç½®ã€‚æ¯ä¸ªç›®æ ‡å¯èƒ½æœ‰ä¸åŒçš„é…ç½®ã€‚--&gt;  <br>          &lt;executions&gt; <br>            &lt;!--executionå…ƒç´ åŒ…å«äº†æ’ä»¶æ‰§è¡Œéœ€è¦çš„ä¿¡æ¯--&gt;  <br>            &lt;execution&gt; <br>              &lt;!--æ‰§è¡Œç›®æ ‡çš„æ ‡è¯†ç¬¦ï¼Œç”¨äºæ ‡è¯†æ„å»ºè¿‡ç¨‹ä¸­çš„ç›®æ ‡ï¼Œæˆ–è€…åŒ¹é…ç»§æ‰¿è¿‡ç¨‹ä¸­éœ€è¦åˆå¹¶çš„æ‰§è¡Œç›®æ ‡--&gt;  <br>              &lt;<span class="hljs-built_in">id</span>/&gt;  <br>              &lt;!--ç»‘å®šäº†ç›®æ ‡çš„æ„å»ºç”Ÿå‘½å‘¨æœŸé˜¶æ®µï¼Œå¦‚æœçœç•¥ï¼Œç›®æ ‡ä¼šè¢«ç»‘å®šåˆ°æºæ•°æ®é‡Œé…ç½®çš„é»˜è®¤é˜¶æ®µ--&gt;  <br>              &lt;phase/&gt;  <br>              &lt;!--é…ç½®çš„æ‰§è¡Œç›®æ ‡--&gt;  <br>              &lt;goals/&gt;  <br>              &lt;!--é…ç½®æ˜¯å¦è¢«ä¼ æ’­åˆ°å­POM--&gt;  <br>              &lt;inherited/&gt;  <br>              &lt;!--ä½œä¸ºDOMå¯¹è±¡çš„é…ç½®--&gt;  <br>              &lt;configuration/&gt; <br>            &lt;/execution&gt; <br>          &lt;/executions&gt;  <br>          &lt;!--é¡¹ç›®å¼•å…¥æ’ä»¶æ‰€éœ€è¦çš„é¢å¤–ä¾èµ–--&gt;  <br>          &lt;dependencies&gt; <br>            &lt;!--å‚è§dependencies/dependencyå…ƒç´ --&gt;  <br>            &lt;dependency&gt;......&lt;/dependency&gt; <br>          &lt;/dependencies&gt;  <br>          &lt;!--ä»»ä½•é…ç½®æ˜¯å¦è¢«ä¼ æ’­åˆ°å­é¡¹ç›®--&gt;  <br>          &lt;inherited/&gt;  <br>          &lt;!--ä½œä¸ºDOMå¯¹è±¡çš„é…ç½®--&gt;  <br>          &lt;configuration/&gt; <br>        &lt;/plugin&gt; <br>      &lt;/plugins&gt; <br>    &lt;/pluginManagement&gt;  <br>    &lt;!--ä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨--&gt;  <br>    &lt;plugins&gt; <br>      &lt;!--å‚è§build/pluginManagement/plugins/pluginå…ƒç´ --&gt;  <br>      &lt;plugin&gt; <br>        &lt;groupId/&gt;<br>        &lt;artifactId/&gt;<br>        &lt;version/&gt;<br>        &lt;extensions/&gt;  <br>        &lt;executions&gt; <br>          &lt;execution&gt; <br>            &lt;<span class="hljs-built_in">id</span>/&gt;<br>            &lt;phase/&gt;<br>            &lt;goals/&gt;<br>            &lt;inherited/&gt;<br>            &lt;configuration/&gt; <br>          &lt;/execution&gt; <br>        &lt;/executions&gt;  <br>        &lt;dependencies&gt; <br>          &lt;!--å‚è§dependencies/dependencyå…ƒç´ --&gt;  <br>          &lt;dependency&gt;......&lt;/dependency&gt; <br>        &lt;/dependencies&gt;  <br>        &lt;goals/&gt;<br>        &lt;inherited/&gt;<br>        &lt;configuration/&gt; <br>      &lt;/plugin&gt; <br>    &lt;/plugins&gt; <br>  &lt;/build&gt;  <br>  &lt;!--æ¨¡å—ï¼ˆæœ‰æ—¶ç§°ä½œå­é¡¹ç›®ï¼‰ è¢«æ„å»ºæˆé¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚<br>åˆ—å‡ºçš„æ¯ä¸ªæ¨¡å—å…ƒç´ æ˜¯æŒ‡å‘è¯¥æ¨¡å—çš„ç›®å½•çš„ç›¸å¯¹è·¯å¾„--&gt;  <br>  &lt;modules/&gt;  <br>  &lt;!--å‘ç°ä¾èµ–å’Œæ‰©å±•çš„è¿œç¨‹ä»“åº“åˆ—è¡¨ã€‚--&gt;  <br>  &lt;repositories&gt; <br>    &lt;!--åŒ…å«éœ€è¦è¿æ¥åˆ°è¿œç¨‹ä»“åº“çš„ä¿¡æ¯--&gt;  <br>    &lt;repository&gt; <br>      &lt;!--å¦‚ä½•å¤„ç†è¿œç¨‹ä»“åº“é‡Œå‘å¸ƒç‰ˆæœ¬çš„ä¸‹è½½--&gt;  <br>      &lt;releases&gt; <br>        &lt;!--<span class="hljs-literal">true</span>æˆ–è€…<span class="hljs-literal">false</span>è¡¨ç¤ºè¯¥ä»“åº“æ˜¯å¦ä¸ºä¸‹è½½æŸç§ç±»å‹æ„ä»¶ï¼ˆå‘å¸ƒç‰ˆï¼Œå¿«ç…§ç‰ˆï¼‰å¼€å¯ã€‚ --&gt;  <br>        &lt;enabled/&gt;  <br>        &lt;!--è¯¥å…ƒç´ æŒ‡å®šæ›´æ–°å‘ç”Ÿçš„é¢‘ç‡ã€‚Mavenä¼šæ¯”è¾ƒæœ¬åœ°POMå’Œè¿œç¨‹POMçš„æ—¶é—´æˆ³ã€‚è¿™é‡Œçš„é€‰é¡¹æ˜¯ï¼šalwaysï¼ˆä¸€ç›´ï¼‰ï¼Œdailyï¼ˆé»˜è®¤ï¼Œæ¯æ—¥ï¼‰ï¼Œintervalï¼šXï¼ˆè¿™é‡ŒXæ˜¯ä»¥åˆ†é’Ÿä¸ºå•ä½çš„æ—¶é—´é—´éš”ï¼‰ï¼Œæˆ–è€…neverï¼ˆä»ä¸ï¼‰ã€‚--&gt;  <br>        &lt;updatePolicy/&gt;  <br>        &lt;!--å½“MavenéªŒè¯æ„ä»¶æ ¡éªŒæ–‡ä»¶å¤±è´¥æ—¶è¯¥æ€ä¹ˆåšï¼šignoreï¼ˆå¿½ç•¥ï¼‰ï¼Œfailï¼ˆå¤±è´¥ï¼‰ï¼Œæˆ–è€…warnï¼ˆè­¦å‘Šï¼‰ã€‚--&gt;  <br>        &lt;checksumPolicy/&gt; <br>      &lt;/releases&gt;  <br>      &lt;!-- å¦‚ä½•å¤„ç†è¿œç¨‹ä»“åº“é‡Œå¿«ç…§ç‰ˆæœ¬çš„ä¸‹è½½ã€‚æœ‰äº†releaseså’Œsnapshotsè¿™ä¸¤ç»„é…ç½®ï¼Œ<br>POMå°±å¯ä»¥åœ¨æ¯ä¸ªå•ç‹¬çš„ä»“åº“ä¸­ï¼Œä¸ºæ¯ç§ç±»å‹çš„æ„ä»¶é‡‡å–ä¸åŒçš„ ç­–ç•¥ã€‚<br>ä¾‹å¦‚ï¼Œå¯èƒ½æœ‰äººä¼šå†³å®šåªä¸ºå¼€å‘ç›®çš„å¼€å¯å¯¹å¿«ç…§ç‰ˆæœ¬ä¸‹è½½çš„æ”¯æŒã€‚<br>å‚è§repositories/repository/releaseså…ƒç´  --&gt;  <br>      &lt;snapshots&gt; <br>        &lt;enabled/&gt;<br>        &lt;updatePolicy/&gt;<br>        &lt;checksumPolicy/&gt; <br>      &lt;/snapshots&gt;  <br>      &lt;!--è¿œç¨‹ä»“åº“å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å¯ä»¥ç”¨æ¥åŒ¹é…åœ¨settings.xmlæ–‡ä»¶é‡Œé…ç½®çš„è¿œç¨‹ä»“åº“--&gt;  <br>      &lt;<span class="hljs-built_in">id</span>&gt;banseon-repository-proxy&lt;/id&gt;  <br>      &lt;!--è¿œç¨‹ä»“åº“åç§°--&gt;  <br>      &lt;name&gt;banseon-repository-proxy&lt;/name&gt;  <br>      &lt;!--è¿œç¨‹ä»“åº“URLï¼ŒæŒ‰protocol://hostname/pathå½¢å¼--&gt;  <br>      &lt;url&gt;http://192.168.1.169:9999/repository/&lt;/url&gt;  <br>      &lt;!-- ç”¨äºå®šä½å’Œæ’åºæ„ä»¶çš„ä»“åº“å¸ƒå±€ç±»å‹-å¯ä»¥æ˜¯defaultï¼ˆé»˜è®¤ï¼‰æˆ–è€…legacyï¼ˆé—ç•™ï¼‰ã€‚Maven 2ä¸ºå…¶ä»“åº“æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„å¸ƒå±€ï¼›ç„¶ è€Œï¼ŒMaven 1.xæœ‰ä¸€ç§ä¸åŒçš„å¸ƒå±€ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥å…ƒç´ æŒ‡å®šå¸ƒå±€æ˜¯defaultï¼ˆé»˜è®¤ï¼‰è¿˜æ˜¯legacyï¼ˆé—ç•™ï¼‰ã€‚--&gt;  <br>      &lt;layout&gt;default&lt;/layout&gt; <br>    &lt;/repository&gt; <br>  &lt;/repositories&gt;  <br>  &lt;!--å‘ç°æ’ä»¶çš„è¿œç¨‹ä»“åº“åˆ—è¡¨ï¼Œè¿™äº›æ’ä»¶ç”¨äºæ„å»ºå’ŒæŠ¥è¡¨--&gt;  <br>  &lt;pluginRepositories&gt; <br>    &lt;!--åŒ…å«éœ€è¦è¿æ¥åˆ°è¿œç¨‹æ’ä»¶ä»“åº“çš„ä¿¡æ¯.å‚è§repositories/repositoryå…ƒç´ --&gt;  <br>    &lt;pluginRepository&gt;......&lt;/pluginRepository&gt; <br>  &lt;/pluginRepositories&gt;  <br>  &lt;!--è¯¥å…ƒç´ æè¿°äº†é¡¹ç›®ç›¸å…³çš„æ‰€æœ‰ä¾èµ–ã€‚ è¿™äº›ä¾èµ–ç»„æˆäº†é¡¹ç›®æ„å»ºè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªä¸ªç¯èŠ‚ã€‚<br>å®ƒä»¬è‡ªåŠ¨ä»é¡¹ç›®å®šä¹‰çš„ä»“åº“ä¸­ä¸‹è½½ã€‚è¦è·å–æ›´å¤šä¿¡æ¯ï¼Œè¯·çœ‹é¡¹ç›®ä¾èµ–æœºåˆ¶ã€‚--&gt;  <br>  &lt;dependencies&gt; <br>    &lt;dependency&gt; <br>      &lt;!--ä¾èµ–çš„group ID--&gt;  <br>      &lt;groupId&gt;org.apache.maven&lt;/groupId&gt;  <br>      &lt;!--ä¾èµ–çš„artifact ID--&gt;  <br>      &lt;artifactId&gt;maven-artifact&lt;/artifactId&gt;  <br>      &lt;!--ä¾èµ–çš„ç‰ˆæœ¬å·ã€‚ åœ¨Maven 2é‡Œ, ä¹Ÿå¯ä»¥é…ç½®æˆç‰ˆæœ¬å·çš„èŒƒå›´ã€‚--&gt;  <br>      &lt;version&gt;3.8.1&lt;/version&gt;  <br>      &lt;!-- ä¾èµ–ç±»å‹ï¼Œé»˜è®¤ç±»å‹æ˜¯jarã€‚å®ƒé€šå¸¸è¡¨ç¤ºä¾èµ–çš„æ–‡ä»¶çš„æ‰©å±•åï¼Œä½†ä¹Ÿæœ‰ä¾‹å¤–<br>ã€‚ä¸€ä¸ªç±»å‹å¯ä»¥è¢«æ˜ å°„æˆå¦å¤–ä¸€ä¸ªæ‰©å±•åæˆ–åˆ†ç±»å™¨ã€‚ç±»å‹ç»å¸¸å’Œä½¿ç”¨çš„æ‰“åŒ…æ–¹å¼å¯¹åº”ï¼Œ<br> å°½ç®¡è¿™ä¹Ÿæœ‰ä¾‹å¤–ã€‚ä¸€äº›ç±»å‹çš„ä¾‹å­ï¼šjarï¼Œwarï¼Œejb-clientå’Œtest-jarã€‚<br>å¦‚æœè®¾ç½®extensionsä¸º <span class="hljs-literal">true</span>ï¼Œå°±å¯ä»¥åœ¨ pluginé‡Œå®šä¹‰æ–°çš„ç±»å‹ã€‚æ‰€ä»¥å‰é¢çš„ç±»å‹çš„ä¾‹å­ä¸å®Œæ•´ã€‚--&gt;  <br>      &lt;<span class="hljs-built_in">type</span>&gt;jar&lt;/type&gt;  <br>      &lt;!-- ä¾èµ–çš„åˆ†ç±»å™¨ã€‚åˆ†ç±»å™¨å¯ä»¥åŒºåˆ†å±äºåŒä¸€ä¸ªPOMï¼Œä½†ä¸åŒæ„å»ºæ–¹å¼çš„æ„ä»¶ã€‚<br>åˆ†ç±»å™¨åè¢«é™„åŠ åˆ°æ–‡ä»¶åçš„ç‰ˆæœ¬å·åé¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦æ„å»ºä¸¤ä¸ªå•ç‹¬çš„æ„ä»¶æˆ JARï¼Œ<br>ä¸€ä¸ªä½¿ç”¨Java 1.4ç¼–è¯‘å™¨ï¼Œå¦ä¸€ä¸ªä½¿ç”¨Java 6ç¼–è¯‘å™¨ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨åˆ†ç±»å™¨æ¥ç”Ÿæˆä¸¤ä¸ªå•ç‹¬çš„JARæ„ä»¶ã€‚--&gt;  <br>      &lt;classifier/&gt;  <br>      &lt;!--ä¾èµ–èŒƒå›´ã€‚åœ¨é¡¹ç›®å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œå¸®åŠ©å†³å®šå“ªäº›æ„ä»¶è¢«åŒ…æ‹¬è¿›æ¥ã€‚æ¬²çŸ¥è¯¦æƒ…è¯·å‚è€ƒä¾èµ–æœºåˆ¶ã€‚    <br>                - compile ï¼šé»˜è®¤èŒƒå›´ï¼Œç”¨äºç¼–è¯‘      <br>                - providedï¼šç±»ä¼¼äºç¼–è¯‘ï¼Œä½†æ”¯æŒä½ æœŸå¾…jdkæˆ–è€…å®¹å™¨æä¾›ï¼Œç±»ä¼¼äºclasspath      <br>                - runtime: åœ¨æ‰§è¡Œæ—¶éœ€è¦ä½¿ç”¨      <br>                - <span class="hljs-built_in">test</span>:    ç”¨äº<span class="hljs-built_in">test</span>ä»»åŠ¡æ—¶ä½¿ç”¨      <br>                - system: éœ€è¦å¤–åœ¨æä¾›ç›¸åº”çš„å…ƒç´ ã€‚é€šè¿‡systemPathæ¥å–å¾—      <br>                - systemPath: ä»…ç”¨äºèŒƒå›´ä¸ºsystemã€‚æä¾›ç›¸åº”çš„è·¯å¾„      <br>                - optional:   å½“é¡¹ç›®è‡ªèº«è¢«ä¾èµ–æ—¶ï¼Œæ ‡æ³¨ä¾èµ–æ˜¯å¦ä¼ é€’ã€‚ç”¨äºè¿ç»­ä¾èµ–æ—¶ä½¿ç”¨--&gt;  <br>      &lt;scope&gt;<span class="hljs-built_in">test</span>&lt;/scope&gt;  <br>      &lt;!--ä»…ä¾›systemèŒƒå›´ä½¿ç”¨ã€‚æ³¨æ„ï¼Œä¸é¼“åŠ±ä½¿ç”¨è¿™ä¸ªå…ƒç´ ï¼Œ<br>å¹¶ä¸”åœ¨æ–°çš„ç‰ˆæœ¬ä¸­è¯¥å…ƒç´ å¯èƒ½è¢«è¦†ç›–æ‰ã€‚è¯¥å…ƒç´ ä¸ºä¾èµ–è§„å®šäº†æ–‡ä»¶ç³»ç»Ÿä¸Šçš„è·¯å¾„ã€‚<br>éœ€è¦ç»å¯¹è·¯å¾„è€Œä¸æ˜¯ç›¸å¯¹è·¯å¾„ã€‚æ¨èä½¿ç”¨å±æ€§åŒ¹é…ç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚<span class="hljs-variable">$&#123;java.home&#125;</span>ã€‚--&gt;  <br>      &lt;systemPath/&gt;  <br>      &lt;!--å½“è®¡ç®—ä¼ é€’ä¾èµ–æ—¶ï¼Œ ä»ä¾èµ–æ„ä»¶åˆ—è¡¨é‡Œï¼Œåˆ—å‡ºè¢«æ’é™¤çš„ä¾èµ–æ„ä»¶é›†ã€‚<br>å³å‘Šè¯‰mavenä½ åªä¾èµ–æŒ‡å®šçš„é¡¹ç›®ï¼Œä¸ä¾èµ–é¡¹ç›®çš„ä¾èµ–ã€‚æ­¤å…ƒç´ ä¸»è¦ç”¨äºè§£å†³ç‰ˆæœ¬å†²çªé—®é¢˜--&gt;  <br>      &lt;exclusions&gt; <br>        &lt;exclusion&gt; <br>          &lt;artifactId&gt;spring-core&lt;/artifactId&gt;  <br>          &lt;groupId&gt;org.springframework&lt;/groupId&gt; <br>        &lt;/exclusion&gt; <br>      &lt;/exclusions&gt;  <br>      &lt;!--å¯é€‰ä¾èµ–ï¼Œå¦‚æœä½ åœ¨é¡¹ç›®Bä¸­æŠŠCä¾èµ–å£°æ˜ä¸ºå¯é€‰ï¼Œä½ å°±éœ€è¦åœ¨ä¾èµ–äºBçš„é¡¹ç›®ï¼ˆä¾‹å¦‚é¡¹ç›®Aï¼‰ä¸­æ˜¾å¼çš„å¼•ç”¨å¯¹Cçš„ä¾èµ–ã€‚å¯é€‰ä¾èµ–é˜»æ–­ä¾èµ–çš„ä¼ é€’æ€§ã€‚--&gt;  <br>      &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt; <br>    &lt;/dependency&gt; <br>  &lt;/dependencies&gt;  <br>  &lt;!-- ç»§æ‰¿è‡ªè¯¥é¡¹ç›®çš„æ‰€æœ‰å­é¡¹ç›®çš„é»˜è®¤ä¾èµ–ä¿¡æ¯ã€‚è¿™éƒ¨åˆ†çš„ä¾èµ–ä¿¡æ¯ä¸ä¼šè¢«ç«‹å³è§£æ,<br>è€Œæ˜¯å½“å­é¡¹ç›®å£°æ˜ä¸€ä¸ªä¾èµ–ï¼ˆå¿…é¡»æè¿°group IDå’Œ artifact IDä¿¡æ¯ï¼‰ï¼Œ<br>å¦‚æœgroup IDå’Œartifact IDä»¥å¤–çš„ä¸€äº›ä¿¡æ¯æ²¡æœ‰æè¿°ï¼Œ<br>åˆ™é€šè¿‡group IDå’Œartifact ID åŒ¹é…åˆ°è¿™é‡Œçš„ä¾èµ–ï¼Œå¹¶ä½¿ç”¨è¿™é‡Œçš„ä¾èµ–ä¿¡æ¯ã€‚--&gt;  <br>  &lt;dependencyManagement&gt; <br>    &lt;dependencies&gt; <br>      &lt;!--å‚è§dependencies/dependencyå…ƒç´ --&gt;  <br>      &lt;dependency&gt;......&lt;/dependency&gt; <br>    &lt;/dependencies&gt; <br>  &lt;/dependencyManagement&gt;  <br>  &lt;!--é¡¹ç›®åˆ†å‘ä¿¡æ¯ï¼Œåœ¨æ‰§è¡Œmvn deployåè¡¨ç¤ºè¦å‘å¸ƒçš„ä½ç½®ã€‚<br>æœ‰äº†è¿™äº›ä¿¡æ¯å°±å¯ä»¥æŠŠç½‘ç«™éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨æˆ–è€…æŠŠæ„ä»¶éƒ¨ç½²åˆ°è¿œç¨‹ä»“åº“ã€‚--&gt;  <br>  &lt;distributionManagement&gt; <br>    &lt;!--éƒ¨ç½²é¡¹ç›®äº§ç”Ÿçš„æ„ä»¶åˆ°è¿œç¨‹ä»“åº“éœ€è¦çš„ä¿¡æ¯--&gt;  <br>    &lt;repository&gt; <br>      &lt;!--æ˜¯åˆ†é…ç»™å¿«ç…§ä¸€ä¸ªå”¯ä¸€çš„ç‰ˆæœ¬å·ï¼ˆç”±æ—¶é—´æˆ³å’Œæ„å»ºæµæ°´å·ï¼‰ï¼Ÿ<br>è¿˜æ˜¯æ¯æ¬¡éƒ½ä½¿ç”¨ç›¸åŒçš„ç‰ˆæœ¬å·ï¼Ÿå‚è§repositories/repositoryå…ƒç´ --&gt;  <br>      &lt;uniqueVersion/&gt;  <br>      &lt;<span class="hljs-built_in">id</span>&gt;banseon-maven2&lt;/id&gt;  <br>      &lt;name&gt;banseon maven2&lt;/name&gt;  <br>      &lt;url&gt;file://<span class="hljs-variable">$&#123;basedir&#125;</span>/target/deploy&lt;/url&gt;  <br>      &lt;layout/&gt; <br>    &lt;/repository&gt;  <br>    &lt;!--æ„ä»¶çš„å¿«ç…§éƒ¨ç½²åˆ°å“ªé‡Œï¼Ÿå¦‚æœæ²¡æœ‰é…ç½®è¯¥å…ƒç´ ï¼Œé»˜è®¤éƒ¨ç½²åˆ°repositoryå…ƒç´ é…ç½®çš„ä»“åº“ï¼Œ<br>å‚è§distributionManagement/repositoryå…ƒç´ --&gt;  <br>    &lt;snapshotRepository&gt; <br>      &lt;uniqueVersion/&gt;  <br>      &lt;<span class="hljs-built_in">id</span>&gt;banseon-maven2&lt;/id&gt;  <br>      &lt;name&gt;Banseon-maven2 Snapshot Repository&lt;/name&gt;  <br>      &lt;url&gt;scp://svn.baidu.com/banseon:/usr/local/maven-snapshot&lt;/url&gt;  <br>      &lt;layout/&gt; <br>    &lt;/snapshotRepository&gt;  <br>    &lt;!--éƒ¨ç½²é¡¹ç›®çš„ç½‘ç«™éœ€è¦çš„ä¿¡æ¯--&gt;  <br>    &lt;site&gt; <br>      &lt;!--éƒ¨ç½²ä½ç½®çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨æ¥åŒ¹é…ç«™ç‚¹å’Œsettings.xmlæ–‡ä»¶é‡Œçš„é…ç½®--&gt;  <br>      &lt;<span class="hljs-built_in">id</span>&gt;banseon-site&lt;/id&gt;  <br>      &lt;!--éƒ¨ç½²ä½ç½®çš„åç§°--&gt;  <br>      &lt;name&gt;business api website&lt;/name&gt;  <br>      &lt;!--éƒ¨ç½²ä½ç½®çš„URLï¼ŒæŒ‰protocol://hostname/pathå½¢å¼--&gt;  <br>      &lt;url&gt;scp://svn.baidu.com/banseon:/var/www/localhost/banseon-web&lt;/url&gt; <br>    &lt;/site&gt;  <br>    &lt;!--é¡¹ç›®ä¸‹è½½é¡µé¢çš„URLã€‚å¦‚æœæ²¡æœ‰è¯¥å…ƒç´ ï¼Œç”¨æˆ·åº”è¯¥å‚è€ƒä¸»é¡µã€‚<br>ä½¿ç”¨è¯¥å…ƒç´ çš„åŸå› æ˜¯ï¼šå¸®åŠ©å®šä½é‚£äº›ä¸åœ¨ä»“åº“é‡Œçš„æ„ä»¶ï¼ˆç”±äºlicenseé™åˆ¶ï¼‰ã€‚--&gt;  <br>    &lt;downloadUrl/&gt;  <br>    &lt;!-- ç»™å‡ºè¯¥æ„ä»¶åœ¨è¿œç¨‹ä»“åº“çš„çŠ¶æ€ã€‚ä¸å¾—åœ¨æœ¬åœ°é¡¹ç›®ä¸­è®¾ç½®è¯¥å…ƒç´ ï¼Œ<br>å› ä¸ºè¿™æ˜¯å·¥å…·è‡ªåŠ¨æ›´æ–°çš„ã€‚æœ‰æ•ˆçš„å€¼æœ‰ï¼šnoneï¼ˆé»˜è®¤ï¼‰ï¼Œ<br>convertedï¼ˆä»“åº“ç®¡ç†å‘˜ä» Maven 1 POMè½¬æ¢è¿‡æ¥ï¼‰ï¼Œpartnerï¼ˆç›´æ¥ä»ä¼™ä¼´Maven 2ä»“åº“åŒæ­¥è¿‡æ¥ï¼‰ï¼Œdeployedï¼ˆä»Maven 2å®ä¾‹éƒ¨ ç½²ï¼‰ï¼Œverifiedï¼ˆè¢«æ ¸å®æ—¶æ­£ç¡®çš„å’Œæœ€ç»ˆçš„ï¼‰ã€‚--&gt;  <br>    &lt;status/&gt; <br>  &lt;/distributionManagement&gt;  <br>  &lt;!--ä»¥å€¼æ›¿ä»£åç§°ï¼ŒPropertieså¯ä»¥åœ¨æ•´ä¸ªPOMä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè§¦å‘æ¡ä»¶ï¼ˆè§settings.xmlé…ç½®æ–‡ä»¶é‡Œactivationå…ƒç´ çš„è¯´æ˜ï¼‰ã€‚æ ¼å¼æ˜¯&lt;name&gt;value&lt;/name&gt;ã€‚--&gt;  <br>  &lt;properties/&gt; <br>&lt;/project&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
      <category>maven</category>
      
    </categories>
    
    
    <tags>
      
      <tag>maven</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mavenå®‰è£…éƒ¨ç½²</title>
    <link href="/2023/03/29/devops/maven/maven%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"/>
    <url>/2023/03/29/devops/maven/maven%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="mavenå®‰è£…éƒ¨ç½²"><a href="#mavenå®‰è£…éƒ¨ç½²" class="headerlink" title="mavenå®‰è£…éƒ¨ç½²"></a>mavenå®‰è£…éƒ¨ç½²</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/leoshi/p/16493867.html<br>https://blog.csdn.net/m0_69287945/article/details/124560052<br></code></pre></td></tr></table></figure><p>Mavenæ˜¯ä¸€ä¸ªJAVAæºç çš„ç¼–è¯‘æ‰“åŒ…å·¥å…·ï¼ŒJAVAå¼€å‘äººå‘˜ç¼–å†™å¥½æºä»£ç ä»¥åï¼Œè¦åœ¨JVMè™šæ‹Ÿæœºä¸Šè¿è¡Œå¿…é¡»å…ˆç¼–è¯‘å’Œæ‰“åŒ…ï¼Œç„¶åå†æŠŠæ‰“åŒ…å¥½çš„WARåŒ…æˆ–è€…JARåŒ…æ”¾åˆ°Tomcatä¸Šè¿è¡Œï¼Œé‚£ä¹ˆä»æºä»£ç åˆ°WARæˆ–JARåŒ…çš„è¿‡ç¨‹å°±æ˜¯Mavenåšçš„äº‹ã€‚</p><p>ä»€ä¹ˆæ˜¯Mavenï¼Ÿ<br>å¦‚ä»Šæˆ‘ä»¬æ„å»ºä¸€ä¸ªé¡¹ç›®éœ€è¦ç”¨åˆ°å¾ˆå¤šç¬¬ä¸‰æ–¹çš„ç±»åº“ï¼Œå¦‚å†™ä¸€ä¸ªä½¿ç”¨Springçš„Webé¡¹ç›®å°±éœ€è¦å¼•å…¥å¤§é‡çš„jaråŒ…ã€‚ä¸€ä¸ªé¡¹ç›®JaråŒ…çš„æ•°é‡ä¹‹å¤šå¾€å¾€è®©æˆ‘ä»¬ç ç›®ç»“èˆŒï¼Œå¹¶ä¸”JaråŒ…ä¹‹é—´çš„å…³ç³»é”™ç»¼å¤æ‚ï¼Œä¸€ä¸ªJaråŒ…å¾€å¾€åˆä¼šå¼•ç”¨å…¶ä»–JaråŒ…ï¼Œç¼ºå°‘ä»»ä½•ä¸€ä¸ªJaråŒ…éƒ½ä¼šå¯¼è‡´é¡¹ç›®ç¼–è¯‘å¤±è´¥ã€‚</p><p>ä»¥å¾€å¼€å‘é¡¹ç›®æ—¶ï¼Œç¨‹åºå‘˜å¾€å¾€éœ€è¦èŠ±è¾ƒå¤šçš„ç²¾åŠ›åœ¨å¼•ç”¨JaråŒ…æ­å»ºé¡¹ç›®ç¯å¢ƒä¸Šï¼Œè€Œè¿™ä¸€é¡¹å·¥ä½œå°¤ä¸ºè‰°éš¾ï¼Œå°‘ä¸€ä¸ªJaråŒ…ã€å¤šä¸€ä¸ªJaråŒ…å¾€å¾€ä¼šæŠ¥ä¸€äº›è®©äººæ‘¸ä¸ç€å¤´è„‘çš„å¼‚å¸¸ã€‚</p><p>è€ŒMavenå°±æ˜¯ä¸€æ¬¾å¸®åŠ©ç¨‹åºå‘˜æ„å»ºé¡¹ç›®çš„å·¥å…·ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰Mavenéœ€è¦å“ªäº›Jar åŒ…ï¼Œå®ƒä¼šå¸®åŠ©æˆ‘ä»¬ä¸‹è½½æ‰€æœ‰çš„Jarï¼Œæå¤§æå‡å¼€å‘æ•ˆç‡ã€‚</p><h2 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h2><p>mavenéœ€è¦ä¾èµ–javaç¯å¢ƒï¼Œç³»ç»Ÿå¿…é¡»è¦å®‰è£…JAVA</p><h2 id="å®‰è£…è¿‡ç¨‹"><a href="#å®‰è£…è¿‡ç¨‹" class="headerlink" title="å®‰è£…è¿‡ç¨‹"></a>å®‰è£…è¿‡ç¨‹</h2><h3 id="1-ä¸‹è½½maven"><a href="#1-ä¸‹è½½maven" class="headerlink" title="1. ä¸‹è½½maven"></a>1. ä¸‹è½½maven</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl -O https://dlcdn.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.zip<br></code></pre></td></tr></table></figure><h3 id="2-è§£å‹å‹ç¼©åŒ…"><a href="#2-è§£å‹å‹ç¼©åŒ…" class="headerlink" title="2. è§£å‹å‹ç¼©åŒ…"></a>2. è§£å‹å‹ç¼©åŒ…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">unzip apache-maven-3.8.6-bin.zip<br></code></pre></td></tr></table></figure><h3 id="3-ç§»åŠ¨ç›®å½•"><a href="#3-ç§»åŠ¨ç›®å½•" class="headerlink" title="3. ç§»åŠ¨ç›®å½•"></a>3. ç§»åŠ¨ç›®å½•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mv</span> apache-maven-3.8.6 /usr/local/bin/<br></code></pre></td></tr></table></figure><h3 id="4-åˆ›å»ºè½¯é“¾æ¥"><a href="#4-åˆ›å»ºè½¯é“¾æ¥" class="headerlink" title="4. åˆ›å»ºè½¯é“¾æ¥"></a>4. åˆ›å»ºè½¯é“¾æ¥</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ln</span> -sv /usr/local/bin/apache-maven-3.8.6/bin/mvn /bin/<br></code></pre></td></tr></table></figure><h3 id="5-åˆ›å»ºç¯å¢ƒå˜é‡"><a href="#5-åˆ›å»ºç¯å¢ƒå˜é‡" class="headerlink" title="5. åˆ›å»ºç¯å¢ƒå˜é‡"></a>5. åˆ›å»ºç¯å¢ƒå˜é‡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/profile &lt;&lt;<span class="hljs-string">&#x27;EOF&#x27;</span><br><span class="hljs-comment"># Maven 3.6.3</span><br><span class="hljs-built_in">export</span> M2_HOME=/usr/local/bin/apache-maven-3.8.6<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$M2_HOME</span>/bin<br>EOF<br></code></pre></td></tr></table></figure><h3 id="6-é…ç½®ç”Ÿæ•ˆ"><a href="#6-é…ç½®ç”Ÿæ•ˆ" class="headerlink" title="6. é…ç½®ç”Ÿæ•ˆ"></a>6. é…ç½®ç”Ÿæ•ˆ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><h3 id="7-éªŒè¯maven"><a href="#7-éªŒè¯maven" class="headerlink" title="7. éªŒè¯maven"></a>7. éªŒè¯maven</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@localhost app]<span class="hljs-comment"># mvn -v</span><br>Apache Maven 3.8.6 (84538c9988a25aec085021c365c560670ad80f63)<br>Maven home: /usr/local/bin/apache-maven-3.8.6<br>Java version: 1.8.0_202, vendor: Oracle Corporation, runtime: /usr/java/jdk1.8.0_202-amd64/jre<br>Default locale: en_US, platform encoding: UTF-8<br>OS name: <span class="hljs-string">&quot;linux&quot;</span>, version: <span class="hljs-string">&quot;3.10.0-693.el7.x86_64&quot;</span>, <span class="hljs-built_in">arch</span>: <span class="hljs-string">&quot;amd64&quot;</span>, family: <span class="hljs-string">&quot;unix&quot;</span><br></code></pre></td></tr></table></figure><h3 id="8-ä¿®æ”¹mavenæº"><a href="#8-ä¿®æ”¹mavenæº" class="headerlink" title="8. ä¿®æ”¹mavenæº"></a>8. ä¿®æ”¹mavenæº</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /app/maven/repo<br><br>vim /usr/local/bin/apache-maven-3.8.6/conf/settings.xml<br><span class="hljs-comment">#æ’ä»¶æœ¬åœ°ç¼“å­˜è·¯å¾„</span><br>&lt;localRepository&gt;/app/maven/repo&lt;/localRepository&gt;<br><span class="hljs-comment">#...</span><br>&lt;mirrors&gt;<br>    &lt;mirror&gt;<br>      &lt;<span class="hljs-built_in">id</span>&gt;alimaven&lt;/id&gt;<br>      &lt;name&gt;aliyun maven&lt;/name&gt;<br>      &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;<br>      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;        <br>    &lt;/mirror&gt;<br>&lt;/mirrors&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
      <category>maven</category>
      
    </categories>
    
    
    <tags>
      
      <tag>maven</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨k8sæ­å»ºjenkins</title>
    <link href="/2023/03/29/devops/jenkins/jenkins%E6%90%AD%E5%BB%BA/%E4%BD%BF%E7%94%A8k8s%E6%90%AD%E5%BB%BAjenkins/"/>
    <url>/2023/03/29/devops/jenkins/jenkins%E6%90%AD%E5%BB%BA/%E4%BD%BF%E7%94%A8k8s%E6%90%AD%E5%BB%BAjenkins/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨k8sæ­å»ºjenkins"><a href="#ä½¿ç”¨k8sæ­å»ºjenkins" class="headerlink" title="ä½¿ç”¨k8sæ­å»ºjenkins"></a>ä½¿ç”¨k8sæ­å»ºjenkins</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">#å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.jenkins.io/doc/book/installing/kubernetes/<br>#å‚è€ƒæ–‡æ¡£ï¼šhttps://www.jianshu.com/p/2c20efbd5855<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€å‡†å¤‡ç¯å¢ƒï¼š"><a href="#ä¸€ã€å‡†å¤‡ç¯å¢ƒï¼š" class="headerlink" title="ä¸€ã€å‡†å¤‡ç¯å¢ƒï¼š"></a>ä¸€ã€å‡†å¤‡ç¯å¢ƒï¼š</h2><p>æ­å»ºk8så·²ç•¥è¿‡ï¼Œé˜²ç«å¢™å·²ç»å…³é—­</p><table><thead><tr><th>IPåœ°å€</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>192.168.5.111</td><td>masterèŠ‚ç‚¹ #å®‰è£…nfsï¼Œåˆ›å»ºæŒä¹…å·</td></tr><tr><td>192.168.5.112</td><td>nodeèŠ‚ç‚¹</td></tr></tbody></table><h2 id="äºŒã€åˆ›å»ºæŒä¹…å·ï¼š"><a href="#äºŒã€åˆ›å»ºæŒä¹…å·ï¼š" class="headerlink" title="äºŒã€åˆ›å»ºæŒä¹…å·ï¼š"></a>äºŒã€åˆ›å»ºæŒä¹…å·ï¼š</h2><p>å®‰è£…Jenkinsæ—¶éœ€è¦æŠŠJenkinsçš„é…ç½®ç›®å½•æŒ‚è½½å‡ºæ¥ï¼Œå¤šèŠ‚ç‚¹ Kubernetes é›†ç¾¤ä¸­ï¼Œéœ€è¦ä¸€äº›åƒ NFS è¿™æ ·çš„è§£å†³æ–¹æ¡ˆæ¥ä½¿æŒ‚è½½ç›®å½•åœ¨æ•´ä¸ªé›†ç¾¤ä¸­å¯ç”¨ã€‚é˜²æ­¢æˆ‘ä»¬åœ¨é‡æ–°å¯åŠ¨k8sæ—¶ä¸¢å¤± Jenkins æ§åˆ¶å™¨çš„æ•´ä¸ªé…ç½®å’Œå·¥ä½œã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ‰€æœ‰èŠ‚ç‚¹å®‰è£…nfsï¼š</span><br>yum -y install rpcbind nfs-utils<br><br><span class="hljs-comment">#å®‰è£…nfsèŠ‚ç‚¹ä¸Šæ“ä½œï¼š</span><br><span class="hljs-comment">#åˆ›å»ºå…±äº«ç›®å½•ï¼Œå¹¶è®¾ç½®æƒé™ã€‚</span><br><span class="hljs-built_in">mkdir</span> -p /data/k8s/<br><span class="hljs-built_in">chmod</span> 777 -R /data/k8s/<br><br><span class="hljs-comment">#é…ç½®NFS </span><br><span class="hljs-comment">#nfsçš„é…ç½®æ–‡ä»¶æ˜¯ /etc/exports ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ä¸€è¡Œï¼š</span><br>/data/k8s *(rw,<span class="hljs-built_in">sync</span>,no_root_squash,no_subtree_check)<br><br><span class="hljs-comment">#å„èŠ‚ç‚¹å¯åŠ¨æœåŠ¡å¹¶åŠ å…¥å¼€æœºå¯åŠ¨</span><br>systemctl start rpcbind<br>systemctl start nfs<br>systemctl <span class="hljs-built_in">enable</span> rpcbind <br>systemctl <span class="hljs-built_in">enable</span> nfs<br><br><span class="hljs-comment">#ä½¿ç”¨ showmount å‘½ä»¤æ¥æŸ¥çœ‹æ˜¯å¦å¯è¿æ¥ï¼š</span><br>showmount -e localhost<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€éƒ¨ç½²Jenkinsï¼ˆé€šè¿‡yamlæ–‡ä»¶æ–¹å¼ï¼‰"><a href="#ä¸‰ã€éƒ¨ç½²Jenkinsï¼ˆé€šè¿‡yamlæ–‡ä»¶æ–¹å¼ï¼‰" class="headerlink" title="ä¸‰ã€éƒ¨ç½²Jenkinsï¼ˆé€šè¿‡yamlæ–‡ä»¶æ–¹å¼ï¼‰"></a>ä¸‰ã€éƒ¨ç½²Jenkinsï¼ˆé€šè¿‡yamlæ–‡ä»¶æ–¹å¼ï¼‰</h2><h3 id="1-åˆ›å»ºå‘½åç©ºé—´"><a href="#1-åˆ›å»ºå‘½åç©ºé—´" class="headerlink" title="1.åˆ›å»ºå‘½åç©ºé—´"></a>1.åˆ›å»ºå‘½åç©ºé—´</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">#ä¸åŒçš„å‘½åç©ºé—´æä¾›äº†é¢å¤–çš„éš”ç¦»å±‚å’Œå¯¹æŒç»­é›†æˆç¯å¢ƒçš„æ›´å¤šæ§åˆ¶ã€‚é€šè¿‡åœ¨ç»ˆç«¯ä¸Šé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œä¸º Jenkins éƒ¨ç½²åˆ›å»ºå‘½åç©ºé—´ï¼š<br>kubectl create <span class="hljs-keyword">namespace</span> <span class="hljs-symbol">jenkins</span><br><span class="hljs-symbol">kubectl</span> <span class="hljs-symbol">get</span> <span class="hljs-symbol">namespaces</span><br></code></pre></td></tr></table></figure><h3 id="2-åˆ›å»ºæŒä¹…å·"><a href="#2-åˆ›å»ºæŒä¹…å·" class="headerlink" title="2.åˆ›å»ºæŒä¹…å·"></a>2.åˆ›å»ºæŒä¹…å·</h3><p>åˆ›å»ºä¸€ä¸ªç”±ç‰©ç†å­˜å‚¨æ”¯æŒçš„PVï¼ŒPVç›¸å¯¹é›†ç¾¤è€Œè¨€ï¼Œä¸ä¸ä»»ä½•podç›¸å…³è”ã€‚åˆ›å»ºçš„PVCä¼šè‡ªåŠ¨ç»‘å®šåˆ°åˆé€‚çš„PVã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> jenkins-volume.yaml<br><br>apiVersion: v1<br>kind: PersistentVolume<br>metadata:<br>  name: jenkins-pv<br>spec:<br>  storageClassName: nfs-jenkins-pv<br>  accessModes:<br>  - ReadWriteMany<br>  capacity:<br>    storage: 50Gi<br>  persistentVolumeReclaimPolicy: Retain<br>  nfs:<br>    server: 192.168.5.111<br>    path: /data/k8s/<br><br>---<br>kind: PersistentVolumeClaim<br>apiVersion: v1<br>metadata:<br>  name: jenkins-pvc<br>  namespace: jenkins<br>spec:<br>  storageClassName: nfs-jenkins-pv<br>  accessModes:<br>    - ReadWriteMany<br>  resources:<br>    requests:<br>      storage: 50Gi<br><br><span class="hljs-comment">#éƒ¨ç½²volume</span><br>kubectl apply -f jenkins-volume.yaml<br></code></pre></td></tr></table></figure><h3 id="3-åˆ›å»ºservice-account"><a href="#3-åˆ›å»ºservice-account" class="headerlink" title="3.åˆ›å»ºservice account"></a>3.åˆ›å»ºservice account</h3><p>åˆ›å»ºpodæ—¶ï¼Œå¦‚æœä¸æŒ‡å®šæœåŠ¡è´¦æˆ·ï¼Œåˆ™ä¼šè‡ªåŠ¨ä¸ºå…¶åˆ†é…ä¸€ä¸ªåä¸ºdefaultçš„åŒä¸€namespaceä¸­çš„æœåŠ¡è´¦æˆ·ã€‚ä½†æ˜¯é€šå¸¸åº”ç”¨ç¨‹åºæ—¶å­˜åœ¨æƒé™ä¸è¶³çš„æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬è‡ªå·±åˆ›å»ºä¸€ä¸ªæœåŠ¡è´¦æˆ·ã€‚</p><p>æ‰“å¼€ç½‘å€ï¼š<a href="https://raw.githubusercontent.com/jenkins-infra/jenkins.io/master/content/doc/tutorials/kubernetes/installing-jenkins-on-kubernetes/jenkins-sa.yaml">https://raw.githubusercontent.com/jenkins-infra/jenkins.io/master/content/doc/tutorials/kubernetes/installing-jenkins-on-kubernetes/jenkins-sa.yaml</a></p><p>å°†å†…å®¹ç²˜è´´åˆ°ä¸º jenkins-sa.yamlï¼Œä»¥ä¸‹ä¸ºè¯¥ç½‘å€çš„å†…å®¹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> jenkins-sa.yaml<br>---<br>apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>  name: jenkins<br>  namespace: jenkins<br>---<br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRole<br>metadata:<br>  annotations:<br>    rbac.authorization.kubernetes.io/autoupdate: <span class="hljs-string">&quot;true&quot;</span><br>  labels:<br>    kubernetes.io/bootstrapping: rbac-defaults<br>  name: jenkins<br>rules:<br>- apiGroups:<br>  - <span class="hljs-string">&#x27;*&#x27;</span><br>  resources:<br>  - statefulsets<br>  - services<br>  - replicationcontrollers<br>  - replicasets<br>  - podtemplates<br>  - podsecuritypolicies<br>  - pods<br>  - pods/log<br>  - pods/exec<br>  - podpreset<br>  - poddisruptionbudget<br>  - persistentvolumes<br>  - persistentvolumeclaims<br>  - <span class="hljs-built_in">jobs</span><br>  - endpoints<br>  - deployments<br>  - deployments/scale<br>  - daemonsets<br>  - cronjobs<br>  - configmaps<br>  - namespaces<br>  - events<br>  - secrets<br>  verbs:<br>  - create<br>  - get<br>  - watch<br>  - delete<br>  - list<br>  - patch<br>  - update<br>- apiGroups:<br>  - <span class="hljs-string">&quot;&quot;</span><br>  resources:<br>  - nodes<br>  verbs:<br>  - get<br>  - list<br>  - watch<br>  - update<br>---<br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRoleBinding<br>metadata:<br>  annotations:<br>    rbac.authorization.kubernetes.io/autoupdate: <span class="hljs-string">&quot;true&quot;</span><br>  labels:<br>    kubernetes.io/bootstrapping: rbac-defaults<br>  name: jenkins<br>roleRef:<br>  apiGroup: rbac.authorization.k8s.io<br>  kind: ClusterRole<br>  name: jenkins<br>subjects:<br>- apiGroup: rbac.authorization.k8s.io<br>  kind: Group<br>  name: system:serviceaccounts:jenkins<br><br><span class="hljs-comment">#éƒ¨ç½²jenkins-sa.yaml</span><br>kubectl apply -f jenkins-sa.yaml<br></code></pre></td></tr></table></figure><h3 id="4-å®‰è£…Jenkins"><a href="#4-å®‰è£…Jenkins" class="headerlink" title="4.å®‰è£…Jenkins"></a>4.å®‰è£…Jenkins</h3><p>åˆ›å»ºjenkins-deployment-service.yaml</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> jenkins-deployment-service.yaml<br><br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: jenkins<br>  namespace: jenkins<br>  labels:<br>    release: <span class="hljs-string">&quot;jenkins&quot;</span><br>    component: <span class="hljs-string">&quot;jenkins-master&quot;</span><br>spec:<br>  replicas: 1<br>  selector:<br>    matchLabels:<br>      app: jenkins<br>  template:<br>    metadata:<br>      labels:<br>        app: jenkins<br>    spec:<br>      securityContext:<br>        runAsUser: 0<br>      serviceAccountName: jenkins  <span class="hljs-comment">#æŒ‡å®šæˆ‘ä»¬å‰é¢åˆ›å»ºçš„æœåŠ¡è´¦å·</span><br>      containers:<br>      - name: jenkins<br>        image: jenkins/jenkins:lts<br>        ports:<br>        - containerPort: 8080<br>        - containerPort: 50000<br>        volumeMounts:<br>        - name: jenkins-home<br>          mountPath: /var/jenkins_home<br>      volumes:<br>      - name: jenkins-home<br>        persistentVolumeClaim:<br>          claimName: jenkins-pvc  <span class="hljs-comment">#æŒ‡å®šå‰é¢åˆ›å»ºçš„PVC</span><br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  name: jenkins<br>  namespace: jenkins<br>spec:<br>  <span class="hljs-built_in">type</span>: NodePort<br>  ports:<br>  - name: http<br>    port: 8080<br>    targetPort: 8080<br>    nodePort: 31400  <span class="hljs-comment">#å°†31400å®šä¹‰ä¸º8080çš„æ˜ å°„ç«¯å£</span><br>  - name: agent<br>    port: 50000<br>    targetPort: 50000<br>    nodePort: 31401<br>  selector:<br>    app: jenkins<br></code></pre></td></tr></table></figure><h3 id="5-ç™»å½•jenkins"><a href="#5-ç™»å½•jenkins" class="headerlink" title="5.ç™»å½•jenkins"></a>5.ç™»å½•jenkins</h3><p>æ‰“å¼€æµè§ˆå™¨è®¿é—®192.168.5.111:31400&#x2F;</p><h4 id="5-1-è·å–åˆå§‹åŒ–çš„å¯†ç "><a href="#5-1-è·å–åˆå§‹åŒ–çš„å¯†ç " class="headerlink" title="5.1 è·å–åˆå§‹åŒ–çš„å¯†ç "></a>5.1 è·å–åˆå§‹åŒ–çš„å¯†ç </h4><p>æŸ¥çœ‹æ—¥å¿—å†…ä¿¡æ¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">kubectl -n jenkins logs jenkins-xxx <br></code></pre></td></tr></table></figure><p>æ‰¾åˆ°ä¿¡æ¯ï¼šPlease use the following password<br><strong>å¤åˆ¶å¯†ç åˆ°ç™»å½•é¡µé¢å³å¯</strong></p>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
      <category>Jenkins</category>
      
      <category>Jenkinsæ­å»º</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­å»ºJenkins</title>
    <link href="/2023/03/29/devops/jenkins/jenkins%E6%90%AD%E5%BB%BA/%E6%90%AD%E5%BB%BAJenkins/"/>
    <url>/2023/03/29/devops/jenkins/jenkins%E6%90%AD%E5%BB%BA/%E6%90%AD%E5%BB%BAJenkins/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="æ­å»ºJenkins"><a href="#æ­å»ºJenkins" class="headerlink" title="æ­å»ºJenkins"></a>æ­å»ºJenkins</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">ä½¿ç”¨è¯·å‚è€ƒå­¦ä¹ æ–‡æ¡£ï¼šhttps://www.kancloud.cn/louis1986/jenkins/492045<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€ä½¿ç”¨äºŒè¿›åˆ¶rpmåŒ…æ–¹å¼å®‰è£…"><a href="#ä¸€ã€ä½¿ç”¨äºŒè¿›åˆ¶rpmåŒ…æ–¹å¼å®‰è£…" class="headerlink" title="ä¸€ã€ä½¿ç”¨äºŒè¿›åˆ¶rpmåŒ…æ–¹å¼å®‰è£…"></a>ä¸€ã€ä½¿ç”¨äºŒè¿›åˆ¶rpmåŒ…æ–¹å¼å®‰è£…</h2><p>æ“ä½œç³»ç»Ÿï¼šlinux</p><h3 id="1ã€å®‰è£…jdk"><a href="#1ã€å®‰è£…jdk" class="headerlink" title="1ã€å®‰è£…jdk"></a>1ã€å®‰è£…jdk</h3><p><strong>ç”±äºJenkinsæ˜¯åŸºäºJavaå¼€å‘çš„ï¼Œå®‰è£…å‰ç¡®è®¤æ“ä½œç³»ç»Ÿå·²ç»å®‰è£…äº†jdk</strong></p><h4 id="1-1ã€yum-ç›´æ¥å®‰è£…jdk"><a href="#1-1ã€yum-ç›´æ¥å®‰è£…jdk" class="headerlink" title="1.1ã€yum ç›´æ¥å®‰è£…jdk"></a>1.1ã€yum ç›´æ¥å®‰è£…jdk</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install fontconfig java-11-openjdk -y<br></code></pre></td></tr></table></figure><h4 id="1-2ã€äºŒè¿›åˆ¶å®‰è£…jdkï¼ˆæ— ç½‘çš„æƒ…å†µä¸‹ï¼‰"><a href="#1-2ã€äºŒè¿›åˆ¶å®‰è£…jdkï¼ˆæ— ç½‘çš„æƒ…å†µä¸‹ï¼‰" class="headerlink" title="1.2ã€äºŒè¿›åˆ¶å®‰è£…jdkï¼ˆæ— ç½‘çš„æƒ…å†µä¸‹ï¼‰"></a>1.2ã€äºŒè¿›åˆ¶å®‰è£…jdkï¼ˆæ— ç½‘çš„æƒ…å†µä¸‹ï¼‰</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#https://www.oracle.com/java/technologies/downloads/#java8</span><br><span class="hljs-comment">#å®‰è£…jdkï¼š</span><br>wget --no-check-certificate --no-cookies --header <span class="hljs-string">&quot;Cookie: oraclelicense=accept-securebackup-cookie&quot;</span> http://download.oracle.com/otn-pub/java/jdk/8u131-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk-8u131-linux-x64.tar.gz<br><br><span class="hljs-comment">#è§£å‹åˆ°/usr/localç›®å½•ä¸‹</span><br>tar zxvf jdk-7u51-linux-x64.tar.gz -C /usr/local/<br><br><span class="hljs-built_in">ls</span> /usr/local  <span class="hljs-comment">#æŸ¥çœ‹ç›®å½•ä¸‹çš„jdkæ–‡ä»¶æ˜¯å¤šå°‘ï¼Œæ³¨æ„ï¼šéœ€è¦ç¡®ä¿ä¸ä¸‹é¢çš„æ‰€ç”¨åˆ°çš„è·¯å¾„éœ€ä¸€è‡´ï¼ï¼ï¼</span><br><br><br><span class="hljs-comment"># é…ç½®ç¯å¢ƒå˜é‡çš„é…ç½®æ–‡ä»¶ ##vim /etc/profile</span><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/profile &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">JAVA_HOME=/usr/local/jdk1.8.0 #æ–‡ä»¶åï¼ˆè®°åˆ é™¤æ³¨é‡Šï¼‰</span><br><span class="hljs-string">PATH=$PATH:$JAVA_HOME/bin</span><br><span class="hljs-string">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="hljs-string">export JAVA_HOME PATH CLASSPATH</span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment">#ä½¿è®¾ç½®ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> /etc/profile<br><span class="hljs-comment">#æŸ¥çœ‹å®‰è£…ç‰ˆæœ¬</span><br>java  -version<br></code></pre></td></tr></table></figure><h3 id="2ã€å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰è‡ªå¸¦gitï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦å®‰è£…ä¸€ä¸ª"><a href="#2ã€å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰è‡ªå¸¦gitï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦å®‰è£…ä¸€ä¸ª" class="headerlink" title="2ã€å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰è‡ªå¸¦gitï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦å®‰è£…ä¸€ä¸ª"></a>2ã€å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰è‡ªå¸¦gitï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦å®‰è£…ä¸€ä¸ª</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install git -y<br></code></pre></td></tr></table></figure><h3 id="3ã€rpmåŒ…ç¦»çº¿å®‰è£…"><a href="#3ã€rpmåŒ…ç¦»çº¿å®‰è£…" class="headerlink" title="3ã€rpmåŒ…ç¦»çº¿å®‰è£…"></a>3ã€rpmåŒ…ç¦»çº¿å®‰è£…</h3><p>æ¸…åæºrpmåŒ…ä¸‹è½½ï¼š<code>https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat/</code></p><h4 id="3-1ã€å°†rpmåŒ…ä¸Šä¼ è‡³centosä¸­"><a href="#3-1ã€å°†rpmåŒ…ä¸Šä¼ è‡³centosä¸­" class="headerlink" title="3.1ã€å°†rpmåŒ…ä¸Šä¼ è‡³centosä¸­:"></a>3.1ã€å°†rpmåŒ…ä¸Šä¼ è‡³centosä¸­:</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#wget https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat/jenkins-2.380-1.1.noarch.rpm --no-check-certificate</span><br>rpm -ivh jenkins-2.380-1.1.noarch.rpm<br><span class="hljs-comment">#å¤‡æ³¨ï¼šæœ‰äº›ç‰ˆæœ¬å®‰è£…æ—¶æŠ¥é”™ï¼Œéœ€è¦å®‰è£…ä¾èµ–ã€‚yum install -y daemonize</span><br></code></pre></td></tr></table></figure><h4 id="3-2ã€ä¿®æ”¹jenkinsé…ç½®"><a href="#3-2ã€ä¿®æ”¹jenkinsé…ç½®" class="headerlink" title="3.2ã€ä¿®æ”¹jenkinsé…ç½®:"></a>3.2ã€ä¿®æ”¹jenkinsé…ç½®:</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/sysconfig/jenkins<br><br><span class="hljs-comment">#ç›‘å¬ç«¯å£</span><br>JENKINS_PORT=<span class="hljs-string">&quot;8080&quot;</span><br><span class="hljs-comment">#ä¸ºäº†ä¸å› ä¸ºæƒé™å‡ºç°å„ç§é—®é¢˜ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨rootã€ä¿®æ”¹ç”¨æˆ·ä¸ºroot</span><br><span class="hljs-comment">#ä¿®æ”¹é…ç½®</span><br>JENKINS_USER=<span class="hljs-string">&quot;root&quot;</span><br><br><span class="hljs-comment">#æˆ–è€…ä½¿ç”¨æ›¿æ¢çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼š</span><br>sed -i <span class="hljs-string">&#x27;s#JENKINS_PORT.*#JENKINS_PORT=&quot;8080&quot;#g&#x27;</span> /etc/sysconfig/jenkins<br>sed -i <span class="hljs-string">&#x27;s#JENKINS_USER.*#JENKINS_USER=&quot;root&quot;#g&#x27;</span> /etc/sysconfig/jenkins<br></code></pre></td></tr></table></figure><h4 id="3-3ã€é…ç½®jdkè·¯å¾„"><a href="#3-3ã€é…ç½®jdkè·¯å¾„" class="headerlink" title="3.3ã€é…ç½®jdkè·¯å¾„"></a>3.3ã€é…ç½®jdkè·¯å¾„</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br>vim /etc/init.d/jenkins<br><span class="hljs-comment">#åœ¨ candidates åè¿½åŠ jdk å®‰è£…è·¯å¾„</span><br>/usr/local/jdk1.8.0/bin/java <span class="hljs-comment">#ï¼ˆä¸€ç›´åˆ°jdkå®‰è£…è·¯å¾„ä¸‹çš„bin/java  å¯ä»¥é€šè¿‡whereis javaæŸ¥çœ‹ï¼‰</span><br><br>systemctl daemon-reload <br>systemctl start jenkins<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åœ¨æµè§ˆå™¨è®¿é—®ip:port å³å¯ï¼ˆåœ¨æ­¤ä¹‹å‰éœ€å¼€æ”¾ç«¯å£ï¼Œå¦‚æœæ˜¯å­¦ä¹ ä¹‹ç”¨å¯å…³é—­é˜²ç«å¢™ï¼‰ï¼Œå¦‚æœæ­¤æ—¶æç¤º Please wait while Jenkins is getting ready to workï¼Œé•¿æ—¶é—´æ²¡ååº”åˆ™\</span><br>vim /var/lib/jenkins/hudson.model.UpdateCenter.xml<br><span class="hljs-comment">#å°† https://updates.jenkins.io/update-center.json&quot; ä¿®æ”¹ä¸º &quot;http://mirror.xmission.com/jenkins/updates/update-center.json&quot;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#å¹¶é‡å¯æœåŠ¡</span><br>systemctl daemon-reload <br>systemctl restart jenkins<br></code></pre></td></tr></table></figure><h3 id="4ã€ç™»å½•Jenkins"><a href="#4ã€ç™»å½•Jenkins" class="headerlink" title="4ã€ç™»å½•Jenkins"></a>4ã€ç™»å½•Jenkins</h3><p>ip+è®¾ç½®çš„ç«¯å£    #æ ¹æ®æç¤ºè·å–å¯†ç ç™»å½•ã€‚</p><p>æˆ‘è¿™è¾¹è®¾ç½®çš„è´¦å·ä¸ºï¼šroot å¯†ç ï¼š12345678</p><p><strong>è®¾ç½®ä¸­æ–‡æ±‰åŒ–ï¼š</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">ä¸‹è½½å¹¶å¯ç”¨ä¸­æ–‡æ±‰åŒ–ç‰ˆæ’ä»¶ï¼šlocalization-zh-cn<br><span class="hljs-comment">#åœ¨jenkinsçš„æ’ä»¶ç®¡ç†é¡µé¢ï¼Œåœ¨å¯ç”¨æ’ä»¶æœç´¢ï¼šlocalization ã€‚å°±å¯ä»¥å®‰è£…è¿™ä¸ªæ’ä»¶ï¼Œç„¶åé‡å¯jenkinsæœåŠ¡</span><br></code></pre></td></tr></table></figure><h3 id="5ã€rpmå®‰è£…æ–¹å¼å¸è½½jenkinsæ–¹æ³•ï¼š"><a href="#5ã€rpmå®‰è£…æ–¹å¼å¸è½½jenkinsæ–¹æ³•ï¼š" class="headerlink" title="5ã€rpmå®‰è£…æ–¹å¼å¸è½½jenkinsæ–¹æ³•ï¼š"></a>5ã€rpmå®‰è£…æ–¹å¼å¸è½½jenkinsæ–¹æ³•ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">rpm -e --nodeps jenkins Â  Â  <span class="hljs-comment">#å¸è½½</span><br>rpm -ql jenkinsÂ  Â  Â <span class="hljs-comment">#æ£€æŸ¥æ˜¯å¦å¸è½½æˆåŠŸÂ </span><br>find / -iname jenkins | xargs -n 1000 <span class="hljs-built_in">rm</span> -rfÂ Â <span class="hljs-comment">#å½»åº•åˆ é™¤æ®‹ç•™æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><h2 id="äºŒã€ä½¿ç”¨dockeræ–¹å¼å®‰è£…jenkins"><a href="#äºŒã€ä½¿ç”¨dockeræ–¹å¼å®‰è£…jenkins" class="headerlink" title="äºŒã€ä½¿ç”¨dockeræ–¹å¼å®‰è£…jenkins"></a>äºŒã€ä½¿ç”¨dockeræ–¹å¼å®‰è£…jenkins</h2><p>æ“ä½œç³»ç»Ÿï¼šlinux</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">å®˜æ–¹æ–‡æ¡£ï¼šhttps:<span class="hljs-regexp">//</span>www.jenkins.io<span class="hljs-regexp">/zh/</span>doc<span class="hljs-regexp">/book/i</span>nstalling/<br></code></pre></td></tr></table></figure><h3 id="ç¯å¢ƒï¼š"><a href="#ç¯å¢ƒï¼š" class="headerlink" title="ç¯å¢ƒï¼š"></a>ç¯å¢ƒï¼š</h3><p>dockerç¯å¢ƒ<br>JDKç¯å¢ƒ</p><h3 id="1ã€dockeræ‹‰å–é•œåƒ"><a href="#1ã€dockeræ‹‰å–é•œåƒ" class="headerlink" title="1ã€dockeræ‹‰å–é•œåƒ"></a>1ã€dockeræ‹‰å–é•œåƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull jenkinsci/blueocean<br><span class="hljs-comment">#docker pull jenkinszh/jenkins-zh</span><br></code></pre></td></tr></table></figure><h3 id="2ã€åˆ›å»ºJenkinsæŒ‚è½½ç›®å½•å¹¶æˆæƒæƒé™"><a href="#2ã€åˆ›å»ºJenkinsæŒ‚è½½ç›®å½•å¹¶æˆæƒæƒé™" class="headerlink" title="2ã€åˆ›å»ºJenkinsæŒ‚è½½ç›®å½•å¹¶æˆæƒæƒé™"></a>2ã€åˆ›å»ºJenkinsæŒ‚è½½ç›®å½•å¹¶æˆæƒæƒé™</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /app/jenkins<br><span class="hljs-built_in">chmod</span> 777 /app/jenkins<br></code></pre></td></tr></table></figure><h3 id="3ã€åˆ›å»ºå¹¶å¯åŠ¨Jenkinså®¹å™¨"><a href="#3ã€åˆ›å»ºå¹¶å¯åŠ¨Jenkinså®¹å™¨" class="headerlink" title="3ã€åˆ›å»ºå¹¶å¯åŠ¨Jenkinså®¹å™¨"></a>3ã€åˆ›å»ºå¹¶å¯åŠ¨Jenkinså®¹å™¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d \<br>-p 8080:8080 \<br>-p 50000:50000 \<br>-v /app/jenkins:/var/jenkins_home \<br><span class="hljs-comment">#-v  /root/apache-maven-3.6.3:/usr/local/maven \</span><br>-v /etc/localtime:/etc/localtime \<br>--name jenkins \<br>jenkinsci/blueocean<br><br><span class="hljs-comment">#å‘½ä»¤è¯¦ç»†è§£é‡Š</span><br><span class="hljs-comment">#-v /var/jenkins_mount:/var/jenkins_mount æ„ä¹‰ï¼š /var/jenkins_homeç›®å½•ä¸ºå®¹å™¨jenkinså·¥ä½œç›®å½•ï¼Œ</span><br><span class="hljs-comment">#-v /etc/localtime:/etc/localtime æ„ä¹‰ï¼šè®©å®¹å™¨ä½¿ç”¨å’ŒæœåŠ¡å™¨åŒæ ·çš„æ—¶é—´è®¾ç½®ã€‚</span><br><span class="hljs-comment">#-v /root/apache-maven-3.6.3:/usr/local/maven æ„ä¹‰ï¼šæŒ‚è½½æœ¬åœ°mavenï¼Œå‰é¢æ˜¯æœåŠ¡å™¨ä¸Šçš„ï¼Œåé¢æ˜¯æŒ‚è½½åˆ°å®¹å™¨ä¸Šçš„ç›®å½•</span><br></code></pre></td></tr></table></figure><h3 id="4ã€é…ç½®é•œåƒåŠ é€Ÿ"><a href="#4ã€é…ç½®é•œåƒåŠ é€Ÿ" class="headerlink" title="4ã€é…ç½®é•œåƒåŠ é€Ÿ"></a>4ã€é…ç½®é•œåƒåŠ é€Ÿ</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/app/</span>jenkins/hudson.model.UpdateCenter.xml<br><span class="hljs-comment">#å°† url ä¿®æ”¹ä¸ºæ¸…åå¤§å­¦å®˜æ–¹é•œåƒï¼š</span><br>https:<span class="hljs-regexp">//mi</span>rrors.tuna.tsinghua.edu.cn<span class="hljs-regexp">/jenkins/u</span>pdates/update-center.json<br><br></code></pre></td></tr></table></figure><h3 id="5ã€ç™»å½•Jenkins"><a href="#5ã€ç™»å½•Jenkins" class="headerlink" title="5ã€ç™»å½•Jenkins"></a>5ã€ç™»å½•Jenkins</h3><p>è®¿é—®:ip+è®¾ç½®çš„ç«¯å£ï¼Œæç¤ºå°†æœ¬æœºçš„å¯†ç å¤åˆ¶å¹¶ç²˜è´´</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å› ä¸ºæˆ‘ä»¬çš„è·¯å¾„æ˜¯å·²ç»æ˜ å°„å‡ºæ¥äº†ï¼Œæ‰€ä»¥ç›´æ¥å¯ä»¥é€šè¿‡catå‘½ä»¤æŸ¥çœ‹å®¿ä¸»æœºçš„</span><br><span class="hljs-built_in">cat</span> /app/jenkins/secrets/initialAdminPassword<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€jenkinså®‰è£…æ’ä»¶æé€Ÿï¼š"><a href="#ä¸‰ã€jenkinså®‰è£…æ’ä»¶æé€Ÿï¼š" class="headerlink" title="ä¸‰ã€jenkinså®‰è£…æ’ä»¶æé€Ÿï¼š"></a>ä¸‰ã€jenkinså®‰è£…æ’ä»¶æé€Ÿï¼š</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å¯å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/hellxz/p/jenkins_install_plugins_faster.html<br></code></pre></td></tr></table></figure><p>å°†Jenkinsä½¿ç”¨çš„å›½å¤–åœ°å€ä¸‹è½½æ’ä»¶è§£æåˆ°æ¸…åå¤§å­¦é•œåƒç«™çš„æ’ä»¶åœ°å€:<br>æœ¬æ¥çš„è®¿é—®åœ°å€ä¸ºï¼š<a href="https://updates.jenkins.org/download/plugins/">https://updates.jenkins.org/download/plugins/</a>â€¦â€¦<br>ç°åœ¨æ›¿æ¢çš„è®¿é—®åœ°å€ä¸ºï¼š<a href="http://mirrors.tuna.tsinghua.edu.cn/jenkins/plugins/">http://mirrors.tuna.tsinghua.edu.cn/jenkins/plugins/</a>â€¦â€¦</p><h3 id="1-å…ˆåœ¨è¯¥æœºå™¨ä¸Šå®‰è£…nginx"><a href="#1-å…ˆåœ¨è¯¥æœºå™¨ä¸Šå®‰è£…nginx" class="headerlink" title="1.å…ˆåœ¨è¯¥æœºå™¨ä¸Šå®‰è£…nginx"></a>1.å…ˆåœ¨è¯¥æœºå™¨ä¸Šå®‰è£…nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm<br><span class="hljs-comment">#é€šè¿‡yum search nginxçœ‹çœ‹æ˜¯å¦å·²ç»æ·»åŠ æºæˆåŠŸã€‚å¦‚æœæˆåŠŸåˆ™æ‰§è¡Œä¸‹åˆ—å‘½ä»¤å®‰è£…Nginxã€‚</span><br>sudo yum install -y nginx<br><span class="hljs-comment">#å¯åŠ¨Nginxå¹¶è®¾ç½®å¼€æœºè‡ªåŠ¨è¿è¡Œ</span><br>sudo systemctl start nginx.service<br>sudo systemctl <span class="hljs-built_in">enable</span> nginx.service<br></code></pre></td></tr></table></figure><h3 id="2-å°†è¯¥å›½å¤–åœ°å€çš„åŸŸåè§£æåˆ°æœ¬æœºï¼š"><a href="#2-å°†è¯¥å›½å¤–åœ°å€çš„åŸŸåè§£æåˆ°æœ¬æœºï¼š" class="headerlink" title="2.å°†è¯¥å›½å¤–åœ°å€çš„åŸŸåè§£æåˆ°æœ¬æœºï¼š"></a>2.å°†è¯¥å›½å¤–åœ°å€çš„åŸŸåè§£æåˆ°æœ¬æœºï¼š</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">cat &gt;&gt; /etc/hosts &lt;&lt;EOF<br><span class="hljs-number">127.0.0.1</span> updates.jenkins.org<br>EOF<br></code></pre></td></tr></table></figure><h3 id="3-ä¿®æ”¹nginxçš„confæ–‡ä»¶"><a href="#3-ä¿®æ”¹nginxçš„confæ–‡ä»¶" class="headerlink" title="3.ä¿®æ”¹nginxçš„confæ–‡ä»¶"></a>3.ä¿®æ”¹nginxçš„confæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/nginx/conf.d/default.conf<br><span class="hljs-comment">#...</span><br> server_name  updates.jenkins.org;<br><span class="hljs-comment">#...</span><br>    location /download/plugins &#123;<br>        proxy_set_header Host mirrors.tuna.tsinghua.edu.cn; <br>        proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;   <span class="hljs-comment">#$remote_addrå˜é‡çš„å€¼æ˜¯å®¢æˆ·ç«¯çš„IP</span><br>        proxy_set_header X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>; <span class="hljs-comment">#X-Forwarded-Forå¤´åŸŸæ˜¯ä¸ºäº†è¯´æ˜è¯·æ±‚ç»è¿‡äº†å“ªäº›æœåŠ¡å™¨ã€‚</span><br>        rewrite /download/plugins(.*) /jenkins/plugins/<span class="hljs-variable">$1</span> <span class="hljs-built_in">break</span>;  <span class="hljs-comment">#é‡å†™è®¿é—®çš„åœ°å€</span><br>        proxy_pass http://mirrors.tuna.tsinghua.edu.cn;  <span class="hljs-comment">#å°†è¯·æ±‚è½¬å‘åˆ°æ¸…åå¤§å­¦é•œåƒç«™åœ°å€</span><br>    &#125;<br><span class="hljs-comment">#...</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
      <category>Jenkins</category>
      
      <category>Jenkinsæ­å»º</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨jenkinsæŒç»­é›†æˆï¼›ç¼–è¯‘ï¼Œæ‰“åŒ…éƒ¨ç½²å¾®æœåŠ¡</title>
    <link href="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    <url>/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨jenkinsæŒç»­é›†æˆï¼›ç¼–è¯‘ï¼Œæ‰“åŒ…éƒ¨ç½²å¾®æœåŠ¡"><a href="#ä½¿ç”¨jenkinsæŒç»­é›†æˆï¼›ç¼–è¯‘ï¼Œæ‰“åŒ…éƒ¨ç½²å¾®æœåŠ¡" class="headerlink" title="ä½¿ç”¨jenkinsæŒç»­é›†æˆï¼›ç¼–è¯‘ï¼Œæ‰“åŒ…éƒ¨ç½²å¾®æœåŠ¡"></a>ä½¿ç”¨jenkinsæŒç»­é›†æˆï¼›ç¼–è¯‘ï¼Œæ‰“åŒ…éƒ¨ç½²å¾®æœåŠ¡</h1><h2 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h2><h3 id="éƒ¨ç½²æœåŠ¡æœºå™¨ï¼š"><a href="#éƒ¨ç½²æœåŠ¡æœºå™¨ï¼š" class="headerlink" title="éƒ¨ç½²æœåŠ¡æœºå™¨ï¼š"></a>éƒ¨ç½²æœåŠ¡æœºå™¨ï¼š</h3><table><thead><tr><th align="center">éƒ¨ç½²å¹³å°</th><th align="center">IPåœ°å€ï¼šç«¯å£</th><th align="center">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="center">gitlabå¹³å°</td><td align="center">192.168.5.111:8188</td><td align="center">ä»£ç ä»“åº“åœ°å€</td></tr><tr><td align="center">harborå¹³å°</td><td align="center">192.168.5.133:8080</td><td align="center">ç”¨æ¥å­˜æ”¾æ‰“åŒ…çš„é•œåƒ</td></tr><tr><td align="center">jenkinså¹³å°</td><td align="center">192.168.94.154:8080</td><td align="center">jenkinsæµæ°´çº¿</td></tr><tr><td align="center">maven</td><td align="center">192.168.94.154</td><td align="center">ç¼–è¯‘jaråŒ…</td></tr><tr><td align="center">sonarqube</td><td align="center">192.168.94.154:9000</td><td align="center">ä»£ç è´¨é‡æ‰«æ</td></tr><tr><td align="center">postgresql</td><td align="center">192.168.94.155:5432</td><td align="center">æ•°æ®åº“ï¼Œä½¿ç”¨dockerè¿è¡Œï¼Œå…·ä½“å®‰è£…æŸ¥çœ‹å®‰è£…æ‰‹å†Œ</td></tr><tr><td align="center">sonar-scanner</td><td align="center">192.168.94.154</td><td align="center">è·¯å¾„ä¸º&#x2F;opt&#x2F;sonar-scanner&#x2F;bin&#x2F;sonar-scanner</td></tr></tbody></table><h3 id="ç›¸å…³æœåŠ¡æˆªå›¾ï¼š"><a href="#ç›¸å…³æœåŠ¡æˆªå›¾ï¼š" class="headerlink" title="ç›¸å…³æœåŠ¡æˆªå›¾ï¼š"></a>ç›¸å…³æœåŠ¡æˆªå›¾ï¼š</h3><h4 id="1ã€ä½¿ç”¨gitlabçš„é¡¹ç›®åº“ï¼š192-168-5-111-8188-x2F-root-x2F-java-fuwu"><a href="#1ã€ä½¿ç”¨gitlabçš„é¡¹ç›®åº“ï¼š192-168-5-111-8188-x2F-root-x2F-java-fuwu" class="headerlink" title="1ã€ä½¿ç”¨gitlabçš„é¡¹ç›®åº“ï¼š192.168.5.111:8188&#x2F;root&#x2F;java-fuwu"></a>1ã€ä½¿ç”¨gitlabçš„é¡¹ç›®åº“ï¼š192.168.5.111:8188&#x2F;root&#x2F;java-fuwu</h4><p>è¯¥demoåŒ…ä»githubä¸Šæ‹‰å–å¹¶ä¸Šä¼ åˆ°æœ¬åœ°gitlabä¸Šï¼š<a href="https://github.com/pipiguai0123/simple-java-maven-app">https://github.com/pipiguai0123/simple-java-maven-app</a></p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220905150648167.png" alt="image-20220905150648167"></p><h4 id="2ã€ä½¿ç”¨çš„harborä»“åº“åœ°å€ï¼š192-168-5-133-8080-x2F-harbor-x2F-projects"><a href="#2ã€ä½¿ç”¨çš„harborä»“åº“åœ°å€ï¼š192-168-5-133-8080-x2F-harbor-x2F-projects" class="headerlink" title="2ã€ä½¿ç”¨çš„harborä»“åº“åœ°å€ï¼š192.168.5.133:8080&#x2F;harbor&#x2F;projects"></a>2ã€ä½¿ç”¨çš„harborä»“åº“åœ°å€ï¼š192.168.5.133:8080&#x2F;harbor&#x2F;projects</h4><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220905150825471.png" alt="image-20220905150825471"></p><h4 id="3ã€ä½¿ç”¨çš„jenkinsåœ°å€ï¼š192-168-94-154-8080-x2F-view-x2F-weifuwu-x2F"><a href="#3ã€ä½¿ç”¨çš„jenkinsåœ°å€ï¼š192-168-94-154-8080-x2F-view-x2F-weifuwu-x2F" class="headerlink" title="3ã€ä½¿ç”¨çš„jenkinsåœ°å€ï¼š192.168.94.154:8080&#x2F;view&#x2F;weifuwu&#x2F;"></a>3ã€ä½¿ç”¨çš„jenkinsåœ°å€ï¼š192.168.94.154:8080&#x2F;view&#x2F;weifuwu&#x2F;</h4><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220905150955622.png" alt="image-20220905150955622"></p><h4 id="4ã€SonarQubeç®¡ç†é¡µé¢ï¼š192-168-94-154-9000"><a href="#4ã€SonarQubeç®¡ç†é¡µé¢ï¼š192-168-94-154-9000" class="headerlink" title="4ã€SonarQubeç®¡ç†é¡µé¢ï¼š192.168.94.154:9000"></a>4ã€SonarQubeç®¡ç†é¡µé¢ï¼š192.168.94.154:9000</h4><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220907170244292.png" alt="image-20220907170244292"></p><h2 id="ä¸€ã€ä½¿ç”¨jenkins-mavenç¼–è¯‘"><a href="#ä¸€ã€ä½¿ç”¨jenkins-mavenç¼–è¯‘" class="headerlink" title="ä¸€ã€ä½¿ç”¨jenkins+mavenç¼–è¯‘"></a>ä¸€ã€ä½¿ç”¨jenkins+mavenç¼–è¯‘</h2><h3 id="1ã€ç›´æ¥æ–°å¢é¡¹ç›®-æµæ°´çº¿ï¼Œç„¶åè®¾ç½®ä»gitlabä»£ç ä»“åº“å†…æ‹¿åˆ°ç¼–å†™çš„jenkinsfile"><a href="#1ã€ç›´æ¥æ–°å¢é¡¹ç›®-æµæ°´çº¿ï¼Œç„¶åè®¾ç½®ä»gitlabä»£ç ä»“åº“å†…æ‹¿åˆ°ç¼–å†™çš„jenkinsfile" class="headerlink" title="1ã€ç›´æ¥æ–°å¢é¡¹ç›®-æµæ°´çº¿ï¼Œç„¶åè®¾ç½®ä»gitlabä»£ç ä»“åº“å†…æ‹¿åˆ°ç¼–å†™çš„jenkinsfile"></a>1ã€ç›´æ¥æ–°å¢é¡¹ç›®-æµæ°´çº¿ï¼Œç„¶åè®¾ç½®ä»gitlabä»£ç ä»“åº“å†…æ‹¿åˆ°ç¼–å†™çš„jenkinsfile</h3><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220907171507295.png" alt="image-20220907171507295"></p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220907171746577.png" alt="image-20220907171746577"></p><h3 id="2ã€åº”ç”¨ä¿å­˜åè¾“å‡ºå¦‚ä¸‹ï¼š"><a href="#2ã€åº”ç”¨ä¿å­˜åè¾“å‡ºå¦‚ä¸‹ï¼š" class="headerlink" title="2ã€åº”ç”¨ä¿å­˜åè¾“å‡ºå¦‚ä¸‹ï¼š"></a>2ã€åº”ç”¨ä¿å­˜åè¾“å‡ºå¦‚ä¸‹ï¼š</h3><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220907171821055.png" alt="image-20220907171821055"></p><h2 id="äºŒã€ä½¿ç”¨jenkins-sonarqubeè´¨é‡æ‰«æ"><a href="#äºŒã€ä½¿ç”¨jenkins-sonarqubeè´¨é‡æ‰«æ" class="headerlink" title="äºŒã€ä½¿ç”¨jenkins+sonarqubeè´¨é‡æ‰«æ"></a>äºŒã€ä½¿ç”¨jenkins+sonarqubeè´¨é‡æ‰«æ</h2><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220907173032352.png" alt="image-20220907173032352"></p><h3 id="1ã€è®¿é—®sonarqubeé¡µé¢ï¼š192-168-94-154-9000ï¼Œç™»å½•åï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªsonarqubeçš„tokenï¼Œæ‹¥æœ‰-Token-å°±å¾—åˆ°äº†-Token-æŒæœ‰äººçš„èº«ä»½åŠå‡ ä¹æ‰€æœ‰æƒé™"><a href="#1ã€è®¿é—®sonarqubeé¡µé¢ï¼š192-168-94-154-9000ï¼Œç™»å½•åï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªsonarqubeçš„tokenï¼Œæ‹¥æœ‰-Token-å°±å¾—åˆ°äº†-Token-æŒæœ‰äººçš„èº«ä»½åŠå‡ ä¹æ‰€æœ‰æƒé™" class="headerlink" title="1ã€è®¿é—®sonarqubeé¡µé¢ï¼š192.168.94.154:9000ï¼Œç™»å½•åï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªsonarqubeçš„tokenï¼Œæ‹¥æœ‰ Token å°±å¾—åˆ°äº† Token æŒæœ‰äººçš„èº«ä»½åŠå‡ ä¹æ‰€æœ‰æƒé™"></a>1ã€è®¿é—®sonarqubeé¡µé¢ï¼š192.168.94.154:9000ï¼Œç™»å½•åï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªsonarqubeçš„tokenï¼Œæ‹¥æœ‰ Token å°±å¾—åˆ°äº† Token æŒæœ‰äººçš„èº«ä»½åŠå‡ ä¹æ‰€æœ‰æƒé™</h3><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220907172154561.png" alt="image-20220907172154561"></p><h3 id="2ã€è¾“å…¥ä»¤ç‰Œåç§°ï¼Œç„¶åé€‰æ‹©ä»¤ç‰Œçš„è¿‡æœŸæ—¶é—´ï¼Œï¼ˆæˆ‘è¿™è¾¹é€‰æ‹©çš„æ˜¯æ°¸ä¹…ï¼‰ç„¶åç”Ÿæˆtokenï¼Œåˆ‡è®°å¤åˆ¶tokenåˆ°æœ¬åœ°"><a href="#2ã€è¾“å…¥ä»¤ç‰Œåç§°ï¼Œç„¶åé€‰æ‹©ä»¤ç‰Œçš„è¿‡æœŸæ—¶é—´ï¼Œï¼ˆæˆ‘è¿™è¾¹é€‰æ‹©çš„æ˜¯æ°¸ä¹…ï¼‰ç„¶åç”Ÿæˆtokenï¼Œåˆ‡è®°å¤åˆ¶tokenåˆ°æœ¬åœ°" class="headerlink" title="2ã€è¾“å…¥ä»¤ç‰Œåç§°ï¼Œç„¶åé€‰æ‹©ä»¤ç‰Œçš„è¿‡æœŸæ—¶é—´ï¼Œï¼ˆæˆ‘è¿™è¾¹é€‰æ‹©çš„æ˜¯æ°¸ä¹…ï¼‰ç„¶åç”Ÿæˆtokenï¼Œåˆ‡è®°å¤åˆ¶tokenåˆ°æœ¬åœ°"></a>2ã€è¾“å…¥ä»¤ç‰Œåç§°ï¼Œç„¶åé€‰æ‹©ä»¤ç‰Œçš„è¿‡æœŸæ—¶é—´ï¼Œï¼ˆæˆ‘è¿™è¾¹é€‰æ‹©çš„æ˜¯æ°¸ä¹…ï¼‰ç„¶åç”Ÿæˆtokenï¼Œåˆ‡è®°å¤åˆ¶tokenåˆ°æœ¬åœ°</h3><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220907172333440.png" alt="image-20220907172333440"></p><p>æ³¨æ„ï¼šæœ¬äººåé¢ä½¿ç”¨çš„æ˜¯sonarqube-jenkins-pinjuåç§°çš„tokenï¼Œä¸Šè¿°çš„teståç§°çš„tokenæœªä½¿ç”¨</p><p><code>sonarqube-jenkins-pinjuçš„tokenä¸ºï¼šsqu_47a6a36a2b62fb57ac27317c7805df4003026434</code></p><p><strong>æœªæ‰“å¼€SCMçš„éœ€è¦æ‰“å¼€ï¼š</strong></p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220908111059008.png" alt="image-20220908111059008"></p><h3 id="3ã€jenkinså®‰è£…SonarQube-Scanneræ’ä»¶"><a href="#3ã€jenkinså®‰è£…SonarQube-Scanneræ’ä»¶" class="headerlink" title="3ã€jenkinså®‰è£…SonarQube Scanneræ’ä»¶"></a>3ã€jenkinså®‰è£…SonarQube Scanneræ’ä»¶</h3><p>Manage <a href="https://so.csdn.net/so/search?q=Jenkins&spm=1001.2101.3001.7020">Jenkins</a>ï¼ˆè®¾ç½®ï¼‰â€“&gt;Manage Pluginsï¼ˆæ’ä»¶ç®¡ç†ï¼‰â€“&gt;filterï¼ˆç­›é€‰ï¼‰</p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220908094235641.png" alt="image-20220908094235641"></p><h3 id="4ã€æ·»åŠ -server-authentication-token"><a href="#4ã€æ·»åŠ -server-authentication-token" class="headerlink" title="4ã€æ·»åŠ  server authentication token"></a>4ã€æ·»åŠ  server authentication token</h3><p>å‡­æ®â€“&gt;æ·»åŠ å‡­æ®â€“&gt;å¡«å†™sonarqubeç”Ÿæˆçš„token -&gt;ä¿å­˜</p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220908094931973.png" alt="image-20220908094931973"></p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220908094956432.png" alt="image-20220908094956432"></p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220908110330350.png" alt="image-20220908110330350"></p><h3 id="5ã€Manage-Jenkinsï¼ˆç³»ç»Ÿç®¡ç†ï¼‰â€“-gt-Configure-Systemï¼ˆç³»ç»Ÿé…ç½®ï¼‰"><a href="#5ã€Manage-Jenkinsï¼ˆç³»ç»Ÿç®¡ç†ï¼‰â€“-gt-Configure-Systemï¼ˆç³»ç»Ÿé…ç½®ï¼‰" class="headerlink" title="5ã€Manage Jenkinsï¼ˆç³»ç»Ÿç®¡ç†ï¼‰â€“&gt;Configure Systemï¼ˆç³»ç»Ÿé…ç½®ï¼‰"></a>5ã€Manage Jenkinsï¼ˆç³»ç»Ÿç®¡ç†ï¼‰â€“&gt;Configure Systemï¼ˆç³»ç»Ÿé…ç½®ï¼‰</h3><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220908113017696.png" alt="image-20220908113017696"></p><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://blog.csdn.net/jiatong151/article/details/111995890">https://blog.csdn.net/jiatong151/article/details/111995890</a></p><h3 id="6ã€ç¼–å†™sonar-project-propertiesæ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„ç›´æ¥åœ¨é¡¹ç›®ä¸‹"><a href="#6ã€ç¼–å†™sonar-project-propertiesæ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„ç›´æ¥åœ¨é¡¹ç›®ä¸‹" class="headerlink" title="6ã€ç¼–å†™sonar-project.propertiesæ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„ç›´æ¥åœ¨é¡¹ç›®ä¸‹"></a>6ã€ç¼–å†™<strong>sonar-project.properties</strong>æ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„ç›´æ¥åœ¨é¡¹ç›®ä¸‹</h3><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220908144624891.png" alt="image-20220908144624891"></p><p>sonar-project.propertiesæ–‡ä»¶è¯¦è§£ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># é¡¹ç›®çš„keyå”¯ä¸€ä¸é‡å¤å³å¯ </span><br>sonar.<span class="hljs-attribute">projectKey</span>=java-demo<br><span class="hljs-comment"># é¡¹ç›®çš„åå­—</span><br>sonar.<span class="hljs-attribute">projectName</span>=java-demo<br><span class="hljs-comment"># é¡¹ç›®çš„ç‰ˆæœ¬</span><br>sonar.<span class="hljs-attribute">projectVersion</span>=1.0<br><span class="hljs-comment"># éœ€è¦åˆ†æçš„æºç çš„ç›®å½•ï¼Œå¤šä¸ªç›®å½•ç”¨è‹±æ–‡é€—å·éš”å¼€</span><br>sonar.<span class="hljs-attribute">sources</span>=.<br><span class="hljs-comment"># sonarQubeæ‰«æçš„å¯¹è±¡</span><br>sonar.java.<span class="hljs-attribute">binaries</span>=.<br><span class="hljs-comment"># ç¼–ç æ ¼å¼ </span><br>sonar.<span class="hljs-attribute">sourceEncoding</span>=UTF-8<br><span class="hljs-comment"># å…·æœ‰é¡¹ç›®æ‰§è¡Œåˆ†ææƒé™çš„ SonarQube ç”¨æˆ·çš„èº«ä»½éªŒè¯ä»¤ç‰Œæˆ–ç™»å½•å</span><br>sonar.<span class="hljs-attribute">login</span>=squ_47a6a36a2b62fb57ac27317c7805df4003026434<br><span class="hljs-comment"># å¦‚æœä½¿ç”¨èº«ä»½éªŒè¯ä»¤ç‰Œï¼Œè¯·è®¾ç½®ä¸ºç©ºã€‚å¦‚æœä½¿ç”¨çš„æ˜¯ç™»å½•åï¼Œåˆ™å¡«å†™ç”¨æˆ·åçš„å¯†ç ã€‚</span><br>sonar.password=<br></code></pre></td></tr></table></figure><p>å¦‚ä½•é…ç½®sonar-project.propertiesæ–‡ä»¶ï¼š<a href="https://blog.csdn.net/weixin_44410537/article/details/113770515">https://blog.csdn.net/weixin_44410537/article/details/113770515</a></p><h3 id="7ã€jenkinsæ–°å¢æµæ°´çº¿ï¼Œè®¾ç½®æµæ°´çº¿pipiline"><a href="#7ã€jenkinsæ–°å¢æµæ°´çº¿ï¼Œè®¾ç½®æµæ°´çº¿pipiline" class="headerlink" title="7ã€jenkinsæ–°å¢æµæ°´çº¿ï¼Œè®¾ç½®æµæ°´çº¿pipiline"></a>7ã€jenkinsæ–°å¢æµæ°´çº¿ï¼Œè®¾ç½®æµæ°´çº¿pipiline</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs stylus">pipeline &#123;<br>    agent any<br>     options &#123;<br>        <span class="hljs-built_in">timestamps</span>()          <span class="hljs-comment">//æ—¥å¿—ä¼šæœ‰æ—¶é—´</span><br>        <span class="hljs-built_in">skipDefaultCheckout</span>() <span class="hljs-comment">//åˆ é™¤éšå¼checkout scmè¯­å¥</span><br>        <span class="hljs-built_in">timeout</span>(<span class="hljs-selector-tag">time</span>: <span class="hljs-number">1</span>, unit: <span class="hljs-string">&#x27;HOURS&#x27;</span> ) <span class="hljs-comment">//è¶…æ—¶æ—¶é—´ç»ˆæ­¢</span><br>    &#125;<br>    stages &#123;<br>        <span class="hljs-built_in">stage</span>(<span class="hljs-string">&#x27;æ‹‰å–ä»£ç &#x27;</span>) &#123;<br>            steps &#123;<br>                git branch: <span class="hljs-string">&#x27;main&#x27;</span>, credentialsId: <span class="hljs-string">&#x27;gitlab-root-http&#x27;</span>, url: <span class="hljs-string">&#x27;http://192.168.5.111:8188/root/java-fuwu.git&#x27;</span><br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">stage</span>(<span class="hljs-string">&#x27;è´¨é‡æ‰«æ&#x27;</span>) &#123;<br>        steps &#123;<br>            echo <span class="hljs-string">&#x27;SonarQube analysis å¼€å§‹&#x27;</span><br>                 sh <span class="hljs-string">&quot;/opt/Sonar-scanner/bin/sonar-scanner&quot;</span> <span class="hljs-comment">//Sonar-scannerè·¯å¾„</span><br>     echo <span class="hljs-string">&#x27;SonarQube analysis ç»“æŸ&#x27;</span><br><br>      &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>æ„å»ºæˆåŠŸåï¼Œè®¿é—®sonarqubeï¼Œå¯ä»¥æŸ¥çœ‹åˆ°é¡¹ç›®ä»£ç è´¨é‡ä»¥åŠè¯¦æƒ…ï¼š</strong></p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220908161956686.png" alt="image-20220908161956686"></p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220908164206483.png" alt="image-20220908164206483"></p><h2 id="ä¸‰ã€jenkins-maven-sonarqube-harbor-éƒ¨ç½²è¿è¡Œ"><a href="#ä¸‰ã€jenkins-maven-sonarqube-harbor-éƒ¨ç½²è¿è¡Œ" class="headerlink" title="ä¸‰ã€jenkins+maven+sonarqube+harbor+éƒ¨ç½²è¿è¡Œ"></a>ä¸‰ã€jenkins+maven+sonarqube+harbor+éƒ¨ç½²è¿è¡Œ</h2><h3 id="1ã€ç™»å½•jenkinsï¼Œå¹¶å®‰è£…æ’ä»¶ï¼šGit-Parameter"><a href="#1ã€ç™»å½•jenkinsï¼Œå¹¶å®‰è£…æ’ä»¶ï¼šGit-Parameter" class="headerlink" title="1ã€ç™»å½•jenkinsï¼Œå¹¶å®‰è£…æ’ä»¶ï¼šGit Parameter"></a>1ã€ç™»å½•jenkinsï¼Œå¹¶å®‰è£…æ’ä»¶ï¼šGit Parameter</h3><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220913220001586.png" alt="image-20220913220001586"></p><h3 id="2ã€åœ¨gitlabä»“åº“å†…ä¸Šæ–°å¢dockeræ–‡ä»¶å¤¹ï¼Œå¹¶ç¼–å†™dockerfileæ–‡ä»¶"><a href="#2ã€åœ¨gitlabä»“åº“å†…ä¸Šæ–°å¢dockeræ–‡ä»¶å¤¹ï¼Œå¹¶ç¼–å†™dockerfileæ–‡ä»¶" class="headerlink" title="2ã€åœ¨gitlabä»“åº“å†…ä¸Šæ–°å¢dockeræ–‡ä»¶å¤¹ï¼Œå¹¶ç¼–å†™dockerfileæ–‡ä»¶"></a>2ã€åœ¨gitlabä»“åº“å†…ä¸Šæ–°å¢dockeræ–‡ä»¶å¤¹ï¼Œå¹¶ç¼–å†™dockerfileæ–‡ä»¶</h3><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220913215743288.png" alt="image-20220913215743288"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">FROM openjdk:8-jdk-alpine <span class="hljs-comment">##ä¾èµ–é•œåƒ</span><br>VOLUME /tmp<br>ADD my-app-1.0-SNAPSHOT.jar my-app.jar<br>EXPOSE 9350  <span class="hljs-comment">#å®šä¹‰æœåŠ¡ä½¿ç”¨çš„ç«¯å£</span><br>RUN <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span> &gt;/etc/timezone<br>ENTRYPOINT [<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;-jar&quot;</span>,<span class="hljs-string">&quot;/my-app.jar&quot;</span>]<br></code></pre></td></tr></table></figure><h3 id="3ã€åœ¨jenkinsæœåŠ¡å™¨ä¸Šä¿®æ”¹dockerçš„daemon-jsonæ–‡ä»¶ï¼Œæ·»åŠ harboré•œåƒåœ°å€ï¼šhttp-192-168-5-133-8080ï¼Œå¹¶ç™»å½•haborä»“åº“"><a href="#3ã€åœ¨jenkinsæœåŠ¡å™¨ä¸Šä¿®æ”¹dockerçš„daemon-jsonæ–‡ä»¶ï¼Œæ·»åŠ harboré•œåƒåœ°å€ï¼šhttp-192-168-5-133-8080ï¼Œå¹¶ç™»å½•haborä»“åº“" class="headerlink" title="3ã€åœ¨jenkinsæœåŠ¡å™¨ä¸Šä¿®æ”¹dockerçš„daemon.jsonæ–‡ä»¶ï¼Œæ·»åŠ harboré•œåƒåœ°å€ï¼šhttp://192.168.5.133:8080ï¼Œå¹¶ç™»å½•haborä»“åº“"></a>3ã€åœ¨jenkinsæœåŠ¡å™¨ä¸Šä¿®æ”¹dockerçš„daemon.jsonæ–‡ä»¶ï¼Œæ·»åŠ harboré•œåƒåœ°å€ï¼š<a href="http://192.168.5.133:8080ï¼Œå¹¶ç™»å½•haborä»“åº“">http://192.168.5.133:8080ï¼Œå¹¶ç™»å½•haborä»“åº“</a></h3><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220913220157333.png" alt="image-20220913220157333"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker login 192.168.5.133:8080<br><span class="hljs-comment">#è¾“å…¥è´¦å·å¯†ç ï¼Œæ˜¾ç¤ºæˆåŠŸå³å¯</span><br></code></pre></td></tr></table></figure><h3 id="4ã€éƒ¨ç½²å‡†å¤‡ï¼ˆé¢„è®¡å°†æœåŠ¡éƒ¨ç½²åœ¨192-168-94-155æœåŠ¡å™¨ä¸Šï¼ŒæŒ‰ç…§æ­¥éª¤3ï¼ˆä¿®æ”¹daemon-jsonå¹¶ç™»å½•harborä»“åº“ï¼‰"><a href="#4ã€éƒ¨ç½²å‡†å¤‡ï¼ˆé¢„è®¡å°†æœåŠ¡éƒ¨ç½²åœ¨192-168-94-155æœåŠ¡å™¨ä¸Šï¼ŒæŒ‰ç…§æ­¥éª¤3ï¼ˆä¿®æ”¹daemon-jsonå¹¶ç™»å½•harborä»“åº“ï¼‰" class="headerlink" title="4ã€éƒ¨ç½²å‡†å¤‡ï¼ˆé¢„è®¡å°†æœåŠ¡éƒ¨ç½²åœ¨192.168.94.155æœåŠ¡å™¨ä¸Šï¼ŒæŒ‰ç…§æ­¥éª¤3ï¼ˆä¿®æ”¹daemon.jsonå¹¶ç™»å½•harborä»“åº“ï¼‰"></a>4ã€éƒ¨ç½²å‡†å¤‡ï¼ˆé¢„è®¡å°†æœåŠ¡éƒ¨ç½²åœ¨192.168.94.155æœåŠ¡å™¨ä¸Šï¼ŒæŒ‰ç…§æ­¥éª¤3ï¼ˆä¿®æ”¹daemon.jsonå¹¶ç™»å½•harborä»“åº“ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">ç¼–å†™è¿è¡Œè¯¥å®¹å™¨çš„è„šæœ¬ï¼šå› ä¸ºæµæ°´çº¿éƒ¨ç½²æ—¶æ‰§è¡Œäº†<br><span class="hljs-built_in">cat</span> /srv/dockerrun/java-maven-sonarqube-docker.sh<br><span class="hljs-comment">#!/bin/bash</span><br>docker <span class="hljs-built_in">rm</span> -f java-demo<br><span class="hljs-comment">##åªä¿ç•™ä¸‰ä¸ªç‰ˆæœ¬çš„é•œåƒåœ¨æœ¬åœ°</span><br>docker images | grep <span class="hljs-string">&quot;java-demo&quot;</span>  | awk <span class="hljs-string">&#x27;(NR&gt;3)&#123;print&#125;&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs docker rmi<br><span class="hljs-comment">##è¿è¡Œé•œåƒ</span><br>docker run -d -p 9350:9350  --restart=always  --name java-demo \<br>-e TZ=<span class="hljs-string">&quot;Asia/Shanghai&quot;</span> \<br>-e JAVA_OPTS=<span class="hljs-string">&#x27;-server -Xms512m -Xmx512m&#x27;</span> \<br>-m 2048m --cpus 1 \<br>192.168.5.133:8080/weifuwu/java-damo <span class="hljs-comment">#ä½¿ç”¨ç¼–è¯‘çš„é•œåƒï¼Œåˆå§‹å¦‚æœæ²¡æœ‰çš„æƒ…å†µä¸‹ï¼Œå¯å®šä¹‰192.168.5.133:8080/weifuwu/java-damo</span><br></code></pre></td></tr></table></figure><p>ä»jenkinsæœåŠ¡å™¨ä¸Šè®¾ç½®å…å¯†è®¤è¯åˆ°192.168.94.155ä¸Šå’Œå¹¶ä½¿ç”¨node1å‘½åè§£æï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> /etc/hosts<br>192.168.94.155 node1<br></code></pre></td></tr></table></figure><h3 id="5ã€æ–°å¢æµæ°´çº¿"><a href="#5ã€æ–°å¢æµæ°´çº¿" class="headerlink" title="5ã€æ–°å¢æµæ°´çº¿"></a>5ã€æ–°å¢æµæ°´çº¿</h3><p>å°†æ‰€æœ‰æ“ä½œæ•´åˆï¼Œåªéœ€å°†ä»¥ä¸‹æµæ°´çº¿è¯­æ³•ç²˜è´´åˆ°jenkinsæµæ°´çº¿å†…å¹¶æ„å»ºå³å¯ï¼</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs sh">pipeline &#123;<br>  agent any<br>  options &#123;<br>        timestamps()          //æ—¥å¿—ä¼šæœ‰æ—¶é—´<br>        skipDefaultCheckout() //åˆ é™¤éšå¼checkout scmè¯­å¥<br>        <span class="hljs-built_in">timeout</span>(time: 1, unit: <span class="hljs-string">&#x27;HOURS&#x27;</span> )<br>  &#125;<br>  parameters &#123;<br>    //jenkinsé€‰æ‹©åˆ†æ”¯æ„å»ºï¼Œé»˜è®¤ä¸ºmain<br>    gitParameter branchFilter: <span class="hljs-string">&#x27;origin/(.*)&#x27;</span>, defaultValue: <span class="hljs-string">&#x27;main&#x27;</span>, name: <span class="hljs-string">&#x27;BRANCH&#x27;</span>, <span class="hljs-built_in">type</span>: <span class="hljs-string">&#x27;PT_BRANCH&#x27;</span><br>  &#125;<br>  environment&#123;<br>        //å®šä¹‰æ¨é€çš„é•œåƒåç§°<br>        image_tag=<span class="hljs-string">&quot;192.168.5.133:8080/weifuwu/java-damo:<span class="hljs-variable">$&#123;BUILD_ID&#125;</span>&quot;</span><br>        //é•œåƒå­˜æ”¾è·¯å¾„<br>        dest_dir=<span class="hljs-string">&quot;/srv/dockerrun&quot;</span><br>  &#125;<br>  stages &#123;<br>    stage(<span class="hljs-string">&#x27;æ‹‰å–ä»£ç &#x27;</span>) &#123;<br>      steps &#123;<br>        git branch: <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;params.BRANCH&#125;</span>&quot;</span>, credentialsId: <span class="hljs-string">&#x27;gitlab-root-http&#x27;</span>, url: <span class="hljs-string">&#x27;http://192.168.5.111:8188/root/java-fuwu.git&#x27;</span><br>      &#125;<br>    &#125;<br>    stage(<span class="hljs-string">&#x27;è´¨é‡æ‰«æ&#x27;</span>) &#123;<br>        steps &#123;<br>            <span class="hljs-built_in">timeout</span>(time:10, unit:<span class="hljs-string">&#x27;MINUTES&#x27;</span>) &#123; //æŒ‡å®šæ­¥éª¤çš„è¶…æ—¶æ—¶é—´<br>             script &#123; // æŒ‡å®šè¿è¡Œçš„è„šæœ¬<br>                <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;SonarQube analysis å¼€å§‹&#x27;</span><br>                sh <span class="hljs-string">&quot;/opt/sonar-scanner/bin/sonar-scanner&quot;</span><br>                <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;SonarQube analysis ç»“æŸ&#x27;</span><br>            &#125;<br>          &#125;<br>      &#125;<br>    &#125;<br>    stage(<span class="hljs-string">&#x27;mavenç¼–è¯‘&#x27;</span>) &#123;<br>        steps &#123;<br>             sh <span class="hljs-string">&#x27;mvn -B -DskipTests clean package&#x27;</span><br>        &#125;<br>    &#125;<br>    stage(<span class="hljs-string">&#x27;ç¼–è¯‘é•œåƒ&#x27;</span>) &#123;<br>        steps &#123;<br>              //è¿›åˆ°å­˜æ”¾dockerfileæ–‡ä»¶çš„ç›®å½•ä¸‹ï¼Œå°†ç¼–è¯‘åçš„jaråŒ…å¤åˆ¶è¿‡æ¥<br>             sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">                cd docker/ &amp;&amp; cp ../target/my-app*.jar ./</span><br><span class="hljs-string">                docker build -t $&#123;image_tag&#125; .</span><br><span class="hljs-string">                &#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>                //æ¨é€é•œåƒ<br>              sh <span class="hljs-string">&#x27;docker push $&#123;image_tag&#125;&#x27;</span><br>               // input message: <span class="hljs-string">&#x27;Finished using the web site? (Click &quot;Proceed&quot; to continue)&#x27;</span>, ok: <span class="hljs-string">&#x27;å‘å¸ƒé•œåƒ&#x27;</span><br>               &#125;<br>        &#125;<br>    stage(<span class="hljs-string">&#x27;éƒ¨ç½²æœåŠ¡&#x27;</span>) &#123;<br>        steps &#123;<br>              //<span class="hljs-variable">$JOB_NAME</span>ï¼šä»»åŠ¡çš„åç§°ï¼Œä¹Ÿå°±æ˜¯æµæ°´çº¿åˆ›å»ºçš„åç§°<br>              //<span class="hljs-variable">$dest_dir</span>:éƒ¨ç½²æœåŠ¡æ‰€åœ¨è·¯å¾„<br>              //æ›¿æ¢è„šæœ¬å†…çš„é•œåƒï¼Œå¹¶æ‰§è¡Œè„šæœ¬<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">                echo &quot;sed -i &#x27;</span>s<span class="hljs-comment">#192.168.5.133:8080.*#$&#123;image_tag&#125;#g&#x27; $&#123;dest_dir&#125;/$&#123;JOB_NAME&#125;.sh &amp;&amp; bash $&#123;dest_dir&#125;/$&#123;JOB_NAME&#125;.sh&quot; |ssh node1</span><br>                <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="6ã€æ·»åŠ æ„å»ºæˆåŠŸåå‘é€é‚®ä»¶åŠŸèƒ½ï¼ï¼ˆè„šæœ¬å¦‚ä¸‹ï¼‰"><a href="#6ã€æ·»åŠ æ„å»ºæˆåŠŸåå‘é€é‚®ä»¶åŠŸèƒ½ï¼ï¼ˆè„šæœ¬å¦‚ä¸‹ï¼‰" class="headerlink" title="6ã€æ·»åŠ æ„å»ºæˆåŠŸåå‘é€é‚®ä»¶åŠŸèƒ½ï¼ï¼ˆè„šæœ¬å¦‚ä¸‹ï¼‰"></a>6ã€æ·»åŠ æ„å»ºæˆåŠŸåå‘é€é‚®ä»¶åŠŸèƒ½ï¼ï¼ˆè„šæœ¬å¦‚ä¸‹ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs sh">pipeline &#123;<br>  agent any<br>  options &#123;<br>        timestamps()          //æ—¥å¿—ä¼šæœ‰æ—¶é—´<br>        skipDefaultCheckout() //åˆ é™¤éšå¼checkout scmè¯­å¥<br>        <span class="hljs-built_in">timeout</span>(time: 1, unit: <span class="hljs-string">&#x27;HOURS&#x27;</span> )<br>  &#125;<br>  parameters &#123;<br>    //jenkinsé€‰æ‹©åˆ†æ”¯æ„å»ºï¼Œé»˜è®¤ä¸ºmain<br>    gitParameter branchFilter: <span class="hljs-string">&#x27;origin/(.*)&#x27;</span>, defaultValue: <span class="hljs-string">&#x27;main&#x27;</span>, name: <span class="hljs-string">&#x27;BRANCH&#x27;</span>, <span class="hljs-built_in">type</span>: <span class="hljs-string">&#x27;PT_BRANCH&#x27;</span><br>  &#125;<br>  environment&#123;<br>        //å®šä¹‰æ¨é€çš„é•œåƒåç§°<br>        image_tag=<span class="hljs-string">&quot;192.168.5.133:8080/weifuwu/java-damo:<span class="hljs-variable">$&#123;BUILD_ID&#125;</span>&quot;</span><br>        //é•œåƒå­˜æ”¾è·¯å¾„<br>        dest_dir=<span class="hljs-string">&quot;/srv/dockerrun&quot;</span><br>        //é‚®ä»¶æ¥æ”¶äºº<br>        emailUser=<span class="hljs-string">&quot;1962821461@qq.com&quot;</span><br>        //æ„å»ºçŠ¶æ€<br>        BUILD_STATUS=<span class="hljs-string">&quot;æˆåŠŸï¼&quot;</span><br><br>  &#125;<br>  stages &#123;<br>    stage(<span class="hljs-string">&#x27;æ‹‰å–ä»£ç &#x27;</span>) &#123;<br>      steps &#123;<br>        git branch: <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;params.BRANCH&#125;</span>&quot;</span>, credentialsId: <span class="hljs-string">&#x27;gitlab-root-http&#x27;</span>, url: <span class="hljs-string">&#x27;http://192.168.5.111:8188/root/java-fuwu.git&#x27;</span><br>      &#125;<br>    &#125;<br>    stage(<span class="hljs-string">&#x27;è´¨é‡æ‰«æ&#x27;</span>) &#123;<br>        steps &#123;<br>            <span class="hljs-built_in">timeout</span>(time:10, unit:<span class="hljs-string">&#x27;MINUTES&#x27;</span>) &#123; //æŒ‡å®šæ­¥éª¤çš„è¶…æ—¶æ—¶é—´<br>             script &#123; // æŒ‡å®šè¿è¡Œçš„è„šæœ¬<br>                <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;SonarQube analysis å¼€å§‹&#x27;</span><br>                sh <span class="hljs-string">&quot;/opt/sonar-scanner/bin/sonar-scanner&quot;</span><br>                <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;SonarQube analysis ç»“æŸ&#x27;</span><br>            &#125;<br>          &#125;<br>      &#125;<br>    &#125;<br>    stage(<span class="hljs-string">&#x27;mavenç¼–è¯‘&#x27;</span>) &#123;<br>        steps &#123;<br>             sh <span class="hljs-string">&#x27;mvn -B -DskipTests clean package&#x27;</span><br>        &#125;<br>    &#125;<br>    stage(<span class="hljs-string">&#x27;ç¼–è¯‘é•œåƒ&#x27;</span>) &#123;<br>        steps &#123;<br>              //è¿›åˆ°å­˜æ”¾dockerfileæ–‡ä»¶çš„ç›®å½•ä¸‹ï¼Œå°†ç¼–è¯‘åçš„jaråŒ…å¤åˆ¶è¿‡æ¥<br>             sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">                cd docker/ &amp;&amp; cp ../target/my-app*.jar ./</span><br><span class="hljs-string">                docker build -t $&#123;image_tag&#125; .</span><br><span class="hljs-string">                &#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>                //æ¨é€é•œåƒ<br>              sh <span class="hljs-string">&#x27;docker push $&#123;image_tag&#125;&#x27;</span><br>               // input message: <span class="hljs-string">&#x27;Finished using the web site? (Click &quot;Proceed&quot; to continue)&#x27;</span>, ok: <span class="hljs-string">&#x27;å‘å¸ƒé•œåƒ&#x27;</span><br>               &#125;<br>        &#125;<br>    stage(<span class="hljs-string">&#x27;éƒ¨ç½²æœåŠ¡&#x27;</span>) &#123;<br>        steps &#123;<br>              //<span class="hljs-variable">$JOB_NAME</span><br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">                echo &quot;sed -i &#x27;</span>s<span class="hljs-comment">#192.168.5.133/.*#$&#123;image_tag&#125;#g&#x27; $&#123;dest_dir&#125;/$&#123;JOB_NAME&#125;.sh &amp;&amp; bash $&#123;dest_dir&#125;/$&#123;JOB_NAME&#125;.sh&quot; |ssh node1</span><br>                <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    post &#123;</span><br><span class="hljs-string">    //failure:å¤±è´¥åæ‰§è¡Œï¼Œä¸ºäº†æµ‹è¯•æ­£å¸¸ï¼Œæˆ‘å·²ç»æ”¹æˆä¸ºæˆåŠŸåå‘é€</span><br><span class="hljs-string">    //    failure &#123; </span><br><span class="hljs-string">        success &#123;</span><br><span class="hljs-string">           script &#123;</span><br><span class="hljs-string">               emailext body: &quot;&quot;&quot;</span><br><span class="hljs-string">            &lt;!DOCTYPE html&gt; </span><br><span class="hljs-string">            &lt;html&gt; </span><br><span class="hljs-string">            &lt;head&gt; </span><br><span class="hljs-string">            &lt;meta charset=&quot;UTF-8&quot;&gt; </span><br><span class="hljs-string">            &lt;/head&gt; </span><br><span class="hljs-string">            &lt;body leftmargin=&quot;8&quot; marginwidth=&quot;0&quot; topmargin=&quot;8&quot; marginheight=&quot;4&quot; offset=&quot;0&quot;&gt; </span><br><span class="hljs-string">                &lt;img src=&quot;https://raw.githubusercontent.com/pipiguai0123/JenkinsShareLibrary/main/docs/Jenkins%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E9%9B%86%E6%88%90.png&quot;&gt;</span><br><span class="hljs-string">                &lt;table width=&quot;95%&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif&quot;&gt;   </span><br><span class="hljs-string">                    &lt;tr&gt; </span><br><span class="hljs-string">                        &lt;td&gt;&lt;br /&gt; </span><br><span class="hljs-string">                            &lt;b&gt;&lt;font color=&quot;#0B610B&quot;&gt;æ„å»ºä¿¡æ¯&lt;/font&gt;&lt;/b&gt; </span><br><span class="hljs-string">                        &lt;/td&gt; </span><br><span class="hljs-string">                    &lt;/tr&gt; </span><br><span class="hljs-string">                    &lt;tr&gt; </span><br><span class="hljs-string">                        &lt;td&gt; </span><br><span class="hljs-string">                            &lt;ul&gt; </span><br><span class="hljs-string">                                &lt;li&gt;é¡¹ç›®åç§°ï¼š$&#123;JOB_NAME&#125;&lt;/li&gt;         </span><br><span class="hljs-string">                                &lt;li&gt;æ„å»ºç¼–å·ï¼š$&#123;BUILD_ID&#125;&lt;/li&gt; </span><br><span class="hljs-string">                                &lt;li&gt;æ„å»ºç»“æœï¼š&lt;span style=&quot;color:red&quot;&gt; $&#123;BUILD_STATUS&#125;&lt;/span&gt; &lt;/li&gt;                 </span><br><span class="hljs-string">                                &lt;li&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=&quot;$&#123;BUILD_URL&#125;&quot;&gt;$&#123;BUILD_URL&#125;&lt;/a&gt;&lt;/li&gt;    </span><br><span class="hljs-string">                                &lt;li&gt;æ„å»ºæ—¥å¿—ï¼š&lt;a href=&quot;$&#123;BUILD_URL&#125;console&quot;&gt;$&#123;BUILD_URL&#125;console&lt;/a&gt;&lt;/li&gt; </span><br><span class="hljs-string">                            &lt;/ul&gt; </span><br><span class="hljs-string">                        &lt;/td&gt; </span><br><span class="hljs-string">                    &lt;/tr&gt; </span><br><span class="hljs-string">                    &lt;tr&gt;  </span><br><span class="hljs-string">                &lt;/table&gt; </span><br><span class="hljs-string">            &lt;/body&gt; </span><br><span class="hljs-string">            &lt;/html&gt;  &quot;&quot;&quot;,</span><br><span class="hljs-string">            subject: &quot;Jenkins-$&#123;JOB_NAME&#125;é¡¹ç›®æ„å»ºä¿¡æ¯ &quot;,</span><br><span class="hljs-string">            to: &quot;$emailUser&quot;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="7ã€å®Œæˆåæˆªå›¾ï¼š"><a href="#7ã€å®Œæˆåæˆªå›¾ï¼š" class="headerlink" title="7ã€å®Œæˆåæˆªå›¾ï¼š"></a>7ã€å®Œæˆåæˆªå›¾ï¼š</h3><p>å†™å…¥æµæ°´çº¿è¯­æ³•</p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220914160659411.png" alt="image-20220914160659411"></p><p>gitlabä¸Šæ–°å¢äº†teståˆ†æ”¯ï¼Œjenkinsè´´å…¥è¯­æ³•åï¼Œjenkinsæ„å»ºæ—¶å¯ä»¥é€‰æ‹©åˆ†æ”¯ï¼š</p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220914160848816.png" alt="image-20220914160848816"></p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220914161113131.png" alt="image-20220914161113131"></p><p>é€‰æ‹©åˆ†æ”¯æ„å»ºåï¼Œç¼–è¯‘å®Œæˆï¼Œharborä»“åº“æ¨é€é•œåƒï¼Œå¹¶ä¼šå‘é€é‚®ä»¶ï¼š</p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220914170126609.png" alt="image-20220914170126609"></p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220914161149196.png" alt="image-20220914161149196"></p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220914161644205.png" alt="image-20220914161644205"></p><p>ç¼–è¯‘éƒ¨ç½²å®Œæˆåï¼Œåœ¨192.168.94.155æœåŠ¡å™¨ä¸Šå¯ä»¥çœ‹åˆ°è¯¥dockeré•œåƒå·²è¿è¡Œï¼Œä½†å› ä¸ºæ˜¯demoï¼Œä¼šä¸€ç›´é‡å¯ï¼Œæ—¥å¿—å¯ä»¥çœ‹åˆ°ä¿¡æ¯</p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220914161444375.png" alt="image-20220914161444375"></p><p><img src="/2023/03/29/devops/%E4%BD%BF%E7%94%A8jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%8C%E7%BC%96%E8%AF%91%EF%BC%8C%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20220914161539752.png" alt="image-20220914161539752"></p>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Devops</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDBå…¨é‡å¤‡ä»½å’Œå¢é‡å¤‡ä»½</title>
    <link href="/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/MongoDB%E5%85%A8%E9%87%8F%E5%A4%87%E4%BB%BD%E5%92%8C%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD/"/>
    <url>/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/MongoDB%E5%85%A8%E9%87%8F%E5%A4%87%E4%BB%BD%E5%92%8C%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="MongoDBå…¨é‡å¤‡ä»½å’Œå¢é‡å¤‡ä»½"><a href="#MongoDBå…¨é‡å¤‡ä»½å’Œå¢é‡å¤‡ä»½" class="headerlink" title="MongoDBå…¨é‡å¤‡ä»½å’Œå¢é‡å¤‡ä»½"></a>MongoDBå…¨é‡å¤‡ä»½å’Œå¢é‡å¤‡ä»½</h1><h2 id="ä¸€ã€å‡†å¤‡å·¥ä½œï¼šæ„å»ºmongodb-å‰¯æœ¬é›†æµ‹è¯•ç¯å¢ƒ"><a href="#ä¸€ã€å‡†å¤‡å·¥ä½œï¼šæ„å»ºmongodb-å‰¯æœ¬é›†æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="ä¸€ã€å‡†å¤‡å·¥ä½œï¼šæ„å»ºmongodb å‰¯æœ¬é›†æµ‹è¯•ç¯å¢ƒ"></a>ä¸€ã€å‡†å¤‡å·¥ä½œï¼šæ„å»ºmongodb å‰¯æœ¬é›†æµ‹è¯•ç¯å¢ƒ</h2><p><strong>ä»¥ä¸‹ä¸ºæœºå™¨ipï¼š</strong></p><table><thead><tr><th>æœºå™¨å</th><th>IPåœ°å€</th></tr></thead><tbody><tr><td>node0</td><td>192.168.94.154 <PRIMARY></PRIMARY></td></tr><tr><td>node1</td><td>192.168.94.155</td></tr><tr><td>node2</td><td>192.168.94.156</td></tr></tbody></table><h3 id="å‰¯æœ¬é›†ï¼š"><a href="#å‰¯æœ¬é›†ï¼š" class="headerlink" title="å‰¯æœ¬é›†ï¼š"></a>å‰¯æœ¬é›†ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">node0&gt;:rs.isMaster();<br>&#123;<br>    <span class="hljs-string">&quot;hosts&quot;</span> : [<br>        <span class="hljs-string">&quot;192.168.94.154:9009&quot;</span>,<br>        <span class="hljs-string">&quot;192.168.94.155:9009&quot;</span>,<br>        <span class="hljs-string">&quot;192.168.94.156:9009&quot;</span><br>    ]<br>&#125;<br>...<br></code></pre></td></tr></table></figure><h3 id="æ¥ä¸‹æ¥å¾€é›†ç¾¤é‡Œå†™å…¥æµ‹è¯•æ•°æ®ï¼š"><a href="#æ¥ä¸‹æ¥å¾€é›†ç¾¤é‡Œå†™å…¥æµ‹è¯•æ•°æ®ï¼š" class="headerlink" title="æ¥ä¸‹æ¥å¾€é›†ç¾¤é‡Œå†™å…¥æµ‹è¯•æ•°æ®ï¼š"></a>æ¥ä¸‹æ¥å¾€é›†ç¾¤é‡Œå†™å…¥æµ‹è¯•æ•°æ®ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">node0:PRIMARY&gt; <span class="hljs-keyword">for</span>(var i=1;i&lt;=10000;i++) db.users.insert(&#123;<span class="hljs-built_in">id</span>:i, name:<span class="hljs-string">&quot;helloï¼Œworld~&quot;</span>,city:<span class="hljs-string">&quot;bei&#x27;jing&quot;</span>&#125;);<br>WriteResult(&#123; <span class="hljs-string">&quot;nInserted&quot;</span> : 1 &#125;)<br><br>node0:PRIMARY&gt; show dbs;<br>admin   0.000GB<br>config  0.000GB<br><span class="hljs-built_in">local</span>   0.000GB<br><span class="hljs-built_in">test</span>    0.000GB<br><br>node0:PRIMARY&gt; use <span class="hljs-built_in">test</span><br>switched to db <span class="hljs-built_in">test</span><br><br>node0:PRIMARY&gt; db.users.count();<br>10000<br></code></pre></td></tr></table></figure><p><em><strong>ä»¥ä¸Šå°±æ˜¯å‡†å¤‡å·¥ä½œï¼</strong></em></p><h2 id="äºŒã€mongodb-å…¨é‡å¤‡ä»½åŠæ¢å¤"><a href="#äºŒã€mongodb-å…¨é‡å¤‡ä»½åŠæ¢å¤" class="headerlink" title="äºŒã€mongodb å…¨é‡å¤‡ä»½åŠæ¢å¤"></a>äºŒã€mongodb å…¨é‡å¤‡ä»½åŠæ¢å¤</h2><h3 id="1ã€å…¨å¤‡è„šæœ¬-mongodb-back-all-sh-å¦‚ä¸‹ï¼š"><a href="#1ã€å…¨å¤‡è„šæœ¬-mongodb-back-all-sh-å¦‚ä¸‹ï¼š" class="headerlink" title="1ã€å…¨å¤‡è„šæœ¬ [ mongodb_back_all.sh ] å¦‚ä¸‹ï¼š"></a>1ã€å…¨å¤‡è„šæœ¬ [ mongodb_back_all.sh ] å¦‚ä¸‹ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment"># </span><br><span class="hljs-comment"># ä¸»èŠ‚ç‚¹ipã€ç«¯å£</span><br>host=<span class="hljs-string">&#x27;192.168.94.154&#x27;</span><br>port=<span class="hljs-string">&#x27;9009&#x27;</span><br><br><span class="hljs-comment">#å¯åŠ¨æ–‡ä»¶æ‰€åœ¨ç›®å½•</span><br>sourcepath=<span class="hljs-string">&#x27;/app/mongodb/mongodb/bin&#x27;</span><br><span class="hljs-comment">#å¤‡ä»½æ–‡ä»¶å­˜æ”¾è·¯å¾„</span><br>targetpath=<span class="hljs-string">&#x27;/app/mongodb/backup&#x27;</span><br><span class="hljs-comment">#æ—¶é—´</span><br>nowtime=$(<span class="hljs-built_in">date</span> <span class="hljs-string">&quot;+%Y%m%d&quot;</span>)<br> <br> <br><span class="hljs-function"><span class="hljs-title">start</span></span>()&#123;<br>    <span class="hljs-variable">$sourcepath</span>/mongodump --host <span class="hljs-variable">$host</span> --port <span class="hljs-variable">$port</span> --oplog --gzip --out <span class="hljs-variable">$&#123;targetpath&#125;</span>/<span class="hljs-variable">$&#123;nowtime&#125;</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;mongodump is ok&quot;</span><br>&#125;<br> <br><span class="hljs-function"><span class="hljs-title">execute</span></span>()&#123;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=========================<span class="hljs-subst">$(date)</span> backup all mongodb back start  <span class="hljs-variable">$&#123;nowtime&#125;</span>=========&quot;</span><br>start<br><span class="hljs-comment">#if [ $? -eq 0 ]ä»£è¡¨å¦‚æœä¸Šä¸€æ¡å‘½ä»¤ç»“æŸçŠ¶æ€æ˜¯0çš„è¯å°±æ‰§è¡Œthenåé¢çš„è¯­å¥ã€‚æˆåŠŸå°±æ˜¯0ï¼Œå¤±è´¥ä¸º1</span><br><span class="hljs-keyword">if</span> [ $? -eq 0 ];<span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;The MongoDB BackUp Successfully!&quot;</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;The MongoDB BackUp Failure&quot;</span><br><span class="hljs-keyword">fi</span><br>&#125;<br><span class="hljs-comment">#å¦‚æœæ²¡æœ‰è¿™æ–‡ä»¶ï¼Œå°±åˆ›å»º</span><br><span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;targetpath&#125;</span>/<span class="hljs-variable">$&#123;nowtime&#125;</span>&quot;</span> ];<span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;targetpath&#125;</span>/<span class="hljs-variable">$&#123;nowtime&#125;</span>&quot;</span><br><span class="hljs-keyword">fi</span><br> <br>execute<br><br><span class="hljs-comment">#åˆ é™¤7å¤©å‰çš„å¤‡ä»½</span><br>backtime=$(<span class="hljs-built_in">date</span> -d <span class="hljs-string">&#x27;-7 days&#x27;</span> <span class="hljs-string">&quot;+%Y%m%d&quot;</span>)<br><span class="hljs-keyword">if</span> [ -d <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;targetpath&#125;</span>/<span class="hljs-variable">$&#123;backtime&#125;</span>/&quot;</span> ];<span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">rm</span> -rf <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;targetpath&#125;</span>/<span class="hljs-variable">$&#123;backtime&#125;</span>/&quot;</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;=======<span class="hljs-variable">$&#123;targetpath&#125;</span>/<span class="hljs-variable">$&#123;backtime&#125;</span>/===åˆ é™¤å®Œæ¯•==&quot;</span><br><span class="hljs-keyword">fi</span><br> <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;========================= <span class="hljs-subst">$(date)</span> backup all mongodb back end <span class="hljs-variable">$&#123;nowtime&#125;</span>=========&quot;</span><br></code></pre></td></tr></table></figure><h3 id="2ã€å…¨åº“è¿˜åŸè„šæœ¬-mongodb-restore-all-sh-å¦‚ä¸‹ï¼š"><a href="#2ã€å…¨åº“è¿˜åŸè„šæœ¬-mongodb-restore-all-sh-å¦‚ä¸‹ï¼š" class="headerlink" title="2ã€å…¨åº“è¿˜åŸè„šæœ¬ [ mongodb_restore_all.sh ] å¦‚ä¸‹ï¼š"></a>2ã€å…¨åº“è¿˜åŸè„šæœ¬ [ mongodb_restore_all.sh ] å¦‚ä¸‹ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#</span><br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[31;1m*****[ Mongodb ] å…¨åº“æ¢å¤è„šæœ¬*****\033[0m&quot;</span><br><span class="hljs-comment">#å®šä¹‰æ¢å¤èŠ‚ç‚¹çš„ipã€ç«¯å£</span><br>host=192.168.94.154<br>port=<span class="hljs-string">&#x27;9009&#x27;</span><br><span class="hljs-comment">#å¯åŠ¨æ–‡ä»¶æ‰€åœ¨ç›®å½•</span><br>mongo_bin=/app/mongodb/mongodb/bin<br><span class="hljs-comment">#å¤‡ä»½çš„æ–‡ä»¶æ‰€åœ¨ç›®å½•</span><br>backpath=<span class="hljs-string">&#x27;/app/mongodb/backup&#x27;</span><br> <br><span class="hljs-comment">#è·å–å¤‡ä»½æ–‡ä»¶å¤¹å¤‡ä»½çš„æ–‡ä»¶å</span><br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[32;1m[ é€‰æ‹©è¦æ¢å¤å…¨åº“çš„æ—¥æœŸ ] \033[0m&quot;</span><br><span class="hljs-keyword">for</span> backfile <span class="hljs-keyword">in</span> `<span class="hljs-built_in">ls</span> <span class="hljs-variable">$backpath</span>`; <span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$backfile</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment">#è·å–è¾“å…¥çš„å…¨åº“æ—¥æœŸ</span><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;&gt;&gt;&gt;&quot;</span> date_bak<br><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$date_bak</span> == <span class="hljs-string">&quot;&quot;</span> ]] || [[ <span class="hljs-variable">$date_bak</span> == <span class="hljs-string">&#x27;.&#x27;</span> ]] || [[ <span class="hljs-variable">$date_bak</span> == <span class="hljs-string">&#x27;..&#x27;</span> ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[31;1mè¾“å…¥ä¸èƒ½ä¸ºç‰¹æ®Šå­—ç¬¦.\033[0m&quot;</span><br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [ -d <span class="hljs-variable">$backpath</span>/<span class="hljs-variable">$date_bak</span> ];<span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;è¯·ç¡®è®¤æ˜¯å¦æ¢å¤å…¨åº“å¤‡ä»½[y/n]:&quot;</span> choice<br> <br>    <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$choice</span>&quot;</span> == <span class="hljs-string">&quot;y&quot;</span> ];<span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[32;1mæ­£åœ¨æ¢å¤å…¨åº“å¤‡ä»½ï¼Œè¯·ç¨å...\033[0m&quot;</span><br>        <span class="hljs-variable">$mongo_bin</span>/mongorestore --host <span class="hljs-variable">$host</span> --port <span class="hljs-variable">$port</span> --oplogReplay --gzip <span class="hljs-variable">$backpath</span>/<span class="hljs-variable">$date_bak</span>/<br>        <span class="hljs-comment">#if [ $? -eq 0 ]ä»£è¡¨å¦‚æœä¸Šä¸€æ¡å‘½ä»¤ç»“æŸçŠ¶æ€æ˜¯0çš„è¯å°±æ‰§è¡Œthenåé¢çš„è¯­å¥ã€‚æˆåŠŸå°±æ˜¯0ï¼Œå¤±è´¥ä¸º1</span><br>        <span class="hljs-keyword">if</span> [ $? -eq 0 ];<span class="hljs-keyword">then</span><br>            <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[32;1m--------å…¨åº“æ¢å¤æˆåŠŸ.--------\033[0m&quot;</span><br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[31;1mæ¢å¤å¤±è´¥,è¯·æ‰‹åŠ¨æ£€æŸ¥!\033[0m&quot;</span><br>            <span class="hljs-built_in">exit</span> 3<br>        <span class="hljs-keyword">fi</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">exit</span> 2<br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[31;1mè¾“å…¥ä¿¡æ¯é”™è¯¯ã€‚\033[0m&quot;</span><br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h3 id="æµ‹è¯•å…¨åº“å¤‡ä»½ä»¥åŠæ¢å¤è„šæœ¬ï¼š"><a href="#æµ‹è¯•å…¨åº“å¤‡ä»½ä»¥åŠæ¢å¤è„šæœ¬ï¼š" class="headerlink" title="æµ‹è¯•å…¨åº“å¤‡ä»½ä»¥åŠæ¢å¤è„šæœ¬ï¼š"></a>æµ‹è¯•å…¨åº“å¤‡ä»½ä»¥åŠæ¢å¤è„šæœ¬ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#é¦–å…ˆæ‰§è¡Œå…¨åº“å¤‡ä»½è„šæœ¬</span><br>sh mongodb_back_all.sh<br><br><span class="hljs-comment">#ç„¶åè¿›å…¥ä¸»çš„mongodèŠ‚ç‚¹æœºå™¨ï¼Œåˆ é™¤ä¹‹å‰çš„ä¸€ä¸‡è¡Œæ•°æ®</span><br>node0:PRIMARY&gt; use <span class="hljs-built_in">test</span>;<br>switched to db <span class="hljs-built_in">test</span><br>node0:PRIMARY&gt; db.users.count();<br>10000<br>node0:PRIMARY&gt; db.dropDatabase();<br>node0:PRIMARY&gt; show dbs<br>admin   0.000GB<br>config  0.000GB<br><span class="hljs-built_in">local</span>   0.001GB<br><br><span class="hljs-comment">#å†æ‰§è¡Œå…¨åº“æ¢å¤è„šæœ¬</span><br>sh mongodb_restore_all.sh<br><br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€mongodb-å¢é‡å¤‡ä»½åŠæ¢å¤"><a href="#ä¸‰ã€mongodb-å¢é‡å¤‡ä»½åŠæ¢å¤" class="headerlink" title="ä¸‰ã€mongodb å¢é‡å¤‡ä»½åŠæ¢å¤"></a>ä¸‰ã€mongodb å¢é‡å¤‡ä»½åŠæ¢å¤</h2><p><strong>å¢é‡å¤‡ä»½çš„æ€è·¯æ˜¯é€šè¿‡ oplog æ¥å®ç°çš„ï¼ŒOplog æ˜¯ç”¨äºå­˜å‚¨ MongoDB æ•°æ®åº“æ‰€æœ‰æ•°æ®çš„æ“ä½œè®°å½•çš„(å®é™…åªè®°å½•å¢åˆ æ”¹å’Œä¸€äº›ç³»ç»Ÿå‘½ä»¤æ“ä½œï¼ŒæŸ¥æ˜¯ä¸ä¼šè®°å½•çš„)ï¼Œæœ‰ç‚¹ç±»ä¼¼äº mysql çš„ binlog æ—¥å¿—ã€‚</strong></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">#äº†è§£Oplogå¯ä»¥å‚è€ƒï¼šhttps://www.cnblogs.com/operationhome/p/10688798.html<br>#å¢é‡å¤‡ä»½è¯¦è§£ï¼šhttps://www.cnblogs.com/xuliuzai/p/9917137.html<br></code></pre></td></tr></table></figure><h3 id="1ã€å¢é‡å¤‡ä»½-mongodb-backup-incremental-sh-è„šæœ¬"><a href="#1ã€å¢é‡å¤‡ä»½-mongodb-backup-incremental-sh-è„šæœ¬" class="headerlink" title="1ã€å¢é‡å¤‡ä»½ [ mongodb_backup_incremental.sh ] è„šæœ¬"></a>1ã€å¢é‡å¤‡ä»½ [ mongodb_backup_incremental.sh ] è„šæœ¬</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#å®šä¹‰mongdbæ‰§è¡Œå‘½ä»¤è·¯å¾„</span><br>command_linebin=<span class="hljs-string">&#x27;/app/mongodb/mongodb/bin/mongo&#x27;</span><br><span class="hljs-comment">#å®šä¹‰å¯åŠ¨æ–‡ä»¶è·¯å¾„</span><br>sourcepath=<span class="hljs-string">&#x27;/app/mongodb/mongodb/bin&#x27;</span><br><span class="hljs-comment">#å®šä¹‰å­˜æ”¾backçš„å­˜æ”¾è·¯å¾„</span><br>peichern=<span class="hljs-string">&#x27;/app/mongodb/backup/mongodbOplog_bak&#x27;</span><br><span class="hljs-comment">#å®šä¹‰ç«¯å£å’Œip</span><br>host=192.168.94.154<br>port=9009<br><br><span class="hljs-comment">#æ–°å»ºæ–‡ä»¶å­˜æ”¾è·¯å¾„</span><br><span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">&quot;<span class="hljs-variable">$peichern</span>/mongo-<span class="hljs-variable">$port</span>&quot;</span> ];<span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$peichern</span>/mongo-<span class="hljs-variable">$port</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">&quot;<span class="hljs-variable">$peichern</span>/log-<span class="hljs-variable">$port</span>&quot;</span> ];<span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$peichern</span>/log-<span class="hljs-variable">$port</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-comment">#å¤‡ä»½æ–‡ä»¶å­˜æ”¾çš„è·¯å¾„</span><br>bkdatapath=<span class="hljs-variable">$peichern</span>/mongo-<span class="hljs-variable">$port</span><br><span class="hljs-comment">#å¤‡ä»½è®°å½•çš„logæ—¥å¿—</span><br>bklogpath=<span class="hljs-variable">$peichern</span>/log-<span class="hljs-variable">$port</span><br><span class="hljs-comment">#æ‰§è¡Œè¿‡ç¨‹çš„logæ—¥å¿—åç§°</span><br>logfilename=$(<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%Y%m%d&quot;</span>)<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===MongoDB ç«¯å£ä¸º&quot;</span> <span class="hljs-variable">$port</span> <span class="hljs-string">&quot;çš„å·®å¼‚å¤‡ä»½å¼€å§‹ï¼Œå¼€å§‹æ—¶é—´ä¸ºï¼š&quot;</span> $(<span class="hljs-built_in">date</span> -d today +<span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>) &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><br><span class="hljs-comment">#å®šä¹‰å¯¼å‡ºå¤‡ä»½æ–‡ä»¶oplogä¸­å‚æ•°çš„ç»“æŸæ—¶é—´</span><br>paramBakEndDate=$(<span class="hljs-built_in">date</span> +%s)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===æœ¬æ¬¡å¤‡ä»½æ—¶é—´å‚æ•°ä¸­çš„ç»“æŸæ—¶é—´ä¸ºï¼š&quot;</span> <span class="hljs-variable">$paramBakEndDate</span> &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><br><span class="hljs-comment">#è®¾ç½®å¤‡ä»½çš„é—´éš”æ—¶é—´</span><br>diffTime=$(<span class="hljs-built_in">expr</span> 65 \* 60)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===å¤‡ä»½è®¾ç½®çš„é—´éš”æ—¶é—´ä¸ºï¼š&quot;</span> <span class="hljs-variable">$diffTime</span> &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><br><span class="hljs-comment">#å®šä¹‰å¯¼å‡ºçš„å¤‡ä»½æ–‡ä»¶oplogä¸­å‚æ•°çš„å¼€å§‹æ—¶é—´</span><br>paramBakStartDate=$(<span class="hljs-built_in">expr</span> <span class="hljs-variable">$paramBakEndDate</span> - <span class="hljs-variable">$diffTime</span>)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===æœ¬æ¬¡å¤‡ä»½æ—¶é—´å‚æ•°ä¸­çš„å¼€å§‹æ—¶é—´ä¸ºï¼š&quot;</span> <span class="hljs-variable">$paramBakStartDate</span> &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><br><span class="hljs-comment">#å®šä¹‰mongoå‘½ä»¤è·¯å¾„</span><br>command_linebin=<span class="hljs-variable">$sourcepath</span>/mongo <br><span class="hljs-comment">#å®šä¹‰è¿æ¥mongdbå‚æ•°</span><br>command_line=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;command_linebin&#125;</span> <span class="hljs-variable">$host</span>:<span class="hljs-variable">$port</span>&quot;</span><br><span class="hljs-comment">#command_line=&quot;$sourcepath/mongo $host:$port&quot;</span><br><br><span class="hljs-comment">#è·å–mongodbå†…db.printReplicationInfo()çš„ä¿¡æ¯</span><br>opmes=$(/bin/echo <span class="hljs-string">&quot;db.printReplicationInfo()&quot;</span> | <span class="hljs-variable">$command_line</span> --quiet)<br><span class="hljs-comment">#å°†è·å–çš„ä¿¡æ¯è¾“å‡ºåˆ°tmpå†…</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$opmes</span> &gt; /tmp/opdoctime<span class="hljs-variable">$port</span>.tmplog<br>opbktmplogfile=/tmp/opdoctime<span class="hljs-variable">$port</span>.tmplog<br><span class="hljs-comment">#è·å–æ–‡ä»¶å¤¹å†…çš„ï¼šoplog first event time</span><br>opstartmes=$(grep <span class="hljs-string">&quot;oplog first event time&quot;</span> <span class="hljs-variable">$opbktmplogfile</span> | awk -F <span class="hljs-string">&#x27;CST&#x27;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> | awk -F <span class="hljs-string">&#x27;oplog first event time: &#x27;</span>  <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F <span class="hljs-string">&#x27; GMT&#x27;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>  )<br><span class="hljs-comment">#å°†è·å–çš„æ—¶é—´è½¬æ¢ä¸ºç§’</span><br>oplogRecordFirst=$(<span class="hljs-built_in">date</span> -d <span class="hljs-string">&quot;<span class="hljs-variable">$opstartmes</span>&quot;</span>  +%s)<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===oplogé›†åˆè®°å½•çš„å¼€å§‹æ—¶é—´ä¸º[æ ¼å¼åŒ–]ï¼š&quot;</span> <span class="hljs-variable">$oplogRecordFirst</span> &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><br><span class="hljs-comment">#å¦‚æœè·å–çš„æ—¶é—´å°äºæˆ–ç­‰äºå¤‡ä»½å¼€å§‹çš„æ—¶é—´ï¼ˆç›®çš„æ˜¯ä¸ºäº†è®°å½•çªç„¶å¾€mongodbå†…å†™å…¥äº†å¤§é‡çš„æ•°æ®ï¼Œoplogçš„sizeå¦‚æœå¤ªå°äº†ï¼Œå†™å…¥oplogé‡Œé¢å¯¼è‡´ä¹‹å‰çš„æ—¶é—´è¢«è¦†ç›–ï¼Œåšä¸€ä¸ªåˆ¤æ–­ï¼‰</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$oplogRecordFirst</span> -le <span class="hljs-variable">$paramBakStartDate</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Message --æ£€æŸ¥è®¾ç½®å¤‡ä»½æ—¶é—´åˆç†ã€‚å¤‡ä»½å‚æ•°çš„å¼€å§‹æ—¶é—´åœ¨oplogè®°å½•çš„æ—¶é—´èŒƒå›´å†…ã€‚&quot;</span> &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Fatal Error --æ£€æŸ¥è®¾ç½®çš„å¤‡ä»½æ—¶é—´ä¸åˆç†åˆç†ã€‚å¤‡ä»½å‚æ•°çš„å¼€å§‹æ—¶é—´ä¸åœ¨oplogè®°å½•çš„æ—¶é—´èŒƒå›´å†…ã€‚è¯·è°ƒæ•´oplog sizeæˆ–è°ƒæ•´å¤‡ä»½é¢‘ç‡ã€‚æœ¬æ¬¡å¤‡ä»½å¯ä»¥æŒç»­è¿›è¡Œï¼Œä½†è¿˜åŸæ—¶æ•°æ®å®Œæ•´æ€§ä¸¢å¤±ã€‚&quot;</span> &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-comment">#å®šä¹‰å¤‡ä»½æ–‡ä»¶åç§°</span><br>bkfilename=$(<span class="hljs-built_in">date</span> -d today +<span class="hljs-string">&quot;%Y%m%d%H%M%S&quot;</span>)<br><span class="hljs-comment">#è·å–è®¾å®šçš„æ—¶é—´åŒºé—´çš„oplogæ–‡ä»¶æ•°æ®ï¼Œå¹¶è¿›è¡Œå¤‡ä»½</span><br><span class="hljs-variable">$sourcepath</span>/mongodump -h <span class="hljs-variable">$host</span> --port <span class="hljs-variable">$port</span>  -d <span class="hljs-built_in">local</span> -c oplog.rs  --query <span class="hljs-string">&#x27;&#123;&quot;ts&quot;:&#123;&quot;$gt&quot;: &#123;&quot;$timestamp&quot;:&#123;&quot;t&quot;:&#x27;</span><span class="hljs-variable">$paramBakStartDate</span><span class="hljs-string">&#x27;, &quot;i&quot;:1&#125;&#125;,&quot;$lte&quot;:&#123;&quot;$timestamp&quot;:&#123;&quot;t&quot;:&#x27;</span><span class="hljs-variable">$paramBakEndDate</span><span class="hljs-string">&#x27;, &quot;i&quot;:9999&#125;&#125;&#125;&#125;&#x27;</span> -o <span class="hljs-variable">$bkdatapath</span>/mongodboplog<span class="hljs-variable">$bkfilename</span> &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><span class="hljs-comment">#/mongodb/bin/mongodump -h $host --port $port  -d local -c oplog.rs  --query &#x27;&#123;ts:&#123;$gte:Timestamp(&#x27;$paramBakStartDate&#x27;,1),$lte:Timestamp(&#x27;$paramBakEndDate&#x27;,9999)&#125;&#125;&#x27; -o $bkdatapath/mongodboplog$bkfilename</span><br><br><span class="hljs-comment">##å†æ¬¡æ£€æŸ¥ï¼Œé˜²æ­¢å¯¼å‡ºoplogæ•°æ®è¿‡ç¨‹è€—æ—¶è¿‡é•¿ï¼Œå› oplogæ˜¯å›ºå®šé›†åˆï¼Œå¦‚æœæ“ä½œæœŸé—´æœ‰å¤§é‡çš„æ“ä½œï¼Œåˆ™oplogä¸­æ–°çš„æ•°æ®ä¼šè¦†ç›–æ‰æ—§çš„æ•°æ®ï¼Œå°±å¯èƒ½å¯¼è‡´å¯¼å‡ºçš„æ•°æ®ä¸å®Œæ•´ï¼Œæ— æ³•ä¿è¯å¢é‡æ–‡ä»¶é—´çš„æ—¶é—´è¿ç»­æ€§ã€‚å› æ­¤å¤‡ä»½åå†æ¬¡æ£€æŸ¥</span><br>opmes=$(/bin/echo <span class="hljs-string">&quot;db.printReplicationInfo()&quot;</span> | <span class="hljs-variable">$command_line</span> --quiet)<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$opmes</span> &gt; /tmp/opdoctime<span class="hljs-variable">$port</span>.tmplog<br>opbktmplogfile=/tmp/opdoctime<span class="hljs-variable">$port</span>.tmplog<br>opstartmes=$(grep <span class="hljs-string">&quot;oplog first event time&quot;</span> <span class="hljs-variable">$opbktmplogfile</span> | awk -F <span class="hljs-string">&#x27;CST&#x27;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> | awk -F <span class="hljs-string">&#x27;oplog first event time: &#x27;</span>  <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F <span class="hljs-string">&#x27; GMT&#x27;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>  )<br>oplogRecordFirst=$(<span class="hljs-built_in">date</span> -d <span class="hljs-string">&quot;<span class="hljs-variable">$opstartmes</span>&quot;</span>  +%s)<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===æ‰§è¡Œå¤‡ä»½å,oplogé›†åˆè®°å½•çš„å¼€å§‹æ—¶é—´ä¸º[æ—¶é—´æ ¼å¼åŒ–]:&quot;</span> <span class="hljs-variable">$oplogRecordFirst</span> <br><br><br><span class="hljs-comment">#ä¸ºäº†é¿å…æ•°æ®å¢é•¿è¿‡å¿«ï¼Œè¦†ç›–äº†è¿˜æœªå¤‡ä»½çš„æ•°æ®çš„ï¼Œæ¯”è¾ƒçš„ä¾æ®æ˜¯ mongodbå†…db.printReplicationInfo(); çš„ oplog first event time æ—¶é—´ã€‚ä¸‹é¢è®¾å®šçš„æ˜¯61åˆ†é’Ÿ</span><br>diffTime=$(<span class="hljs-built_in">expr</span> 61 \* 60)<br>paramAfterBakRequestStartDate=$(<span class="hljs-built_in">expr</span> <span class="hljs-variable">$paramBakEndDate</span> - <span class="hljs-variable">$diffTime</span>)<br><span class="hljs-comment">#è½¬ä¹‰æˆæ—¶é—´</span><br>zhuanhuandate=$( <span class="hljs-built_in">date</span> -d <span class="hljs-variable">$paramAfterBakRequestStartDate</span> +<span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span> )<br><span class="hljs-comment">#echo &quot;===ä¸ºä¿è¯å¤‡ä»½çš„è¿ç»­æ€§,æœ¬æ¬¡å¤‡ä»½å,oplogä¸­çš„å¼€å§‹æ—¶é—´éœ€å°äºï¼š&quot; $paramAfterBakRequestStartDate</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===ä¸ºä¿è¯å¤‡ä»½çš„è¿ç»­æ€§,æœ¬æ¬¡å¤‡ä»½å,oplogä¸­çš„å¼€å§‹æ—¶é—´éœ€å°äºï¼š&quot;</span> <span class="hljs-variable">$zhuanhuandate</span> &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><br><br><span class="hljs-comment">#å¦‚æœdb.printReplicationInfo()çš„oplog first event timeå°äºæˆ–ç­‰äºè®¾å®šçš„é—´éš”æ—¶é—´</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$oplogRecordFirst</span> -le <span class="hljs-variable">$paramAfterBakRequestStartDate</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Message --å¤‡ä»½åï¼Œæ£€æŸ¥oplogé›†åˆä¸­æ•°æ®çš„å¼€å§‹æ—¶é—´ï¼Œå³é›†åˆä¸­æœ€æ—©çš„ä¸€ç¬”æ•°æ®ï¼Œæ—¶é—´ä¸å°äº61åˆ†é’Ÿçš„æ—¶é—´ï¼ˆå³å‚æ•° paramAfterBakRequestStartDateï¼‰ã€‚è¿™æ ·å¯ä»¥ä¿è¯æ¯ä¸ªå¢é‡å¤‡ä»½å«æœ‰æœ€è¿‘ä¸€ä¸ªå°æ—¶çš„å…¨éƒ¨opæ“ä½œï¼Œæ»¡è¶³æ–‡ä»¶çš„æŒç»­å®Œæ•´æ€§ï¼Œé€ä¸ªè¿˜åŸæ— ä¸¢å¤±æ•°æ®é£é™©ã€‚&quot;</span> &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Fatal Error --å¤‡ä»½åï¼Œæ£€æŸ¥oplogé›†åˆçš„æ¶µç›–çš„æ—¶é—´èŒƒå›´è¿‡å°ï¼ˆå°äº61minï¼‰ã€‚è®¾ç½®çš„å¤‡ä»½æ—¶é—´ä¸åˆç†åˆç†ï¼Œå¤‡ä»½åçš„æ–‡ä»¶ä¸èƒ½å®Œå…¨æ¶µç›–æœ€è¿‘60åˆ†é’Ÿçš„æ•°æ®ã€‚è¯·è°ƒæ•´oplog sizeæˆ–è°ƒæ•´å¤‡ä»½é¢‘ç‡ã€‚æœ¬æ¬¡å¤‡ä»½å¯ä»¥æŒç»­è¿›è¡Œï¼Œä½†è¿˜åŸæ—¶æ•°æ®å®Œæ•´æ€§ä¸¢å¤±ã€‚&quot;</span> &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><span class="hljs-keyword">fi</span><br><br><br><span class="hljs-comment">#åˆ¤æ–­æ˜¯å¦å¤‡ä»½äº†è¿™ä¸ªæ–‡ä»¶</span><br><span class="hljs-keyword">if</span> [ -d <span class="hljs-string">&quot;<span class="hljs-variable">$bkdatapath</span>/mongodboplog<span class="hljs-variable">$bkfilename</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Message --æ£€æŸ¥æ­¤æ¬¡å¤‡ä»½æ–‡ä»¶å·²ç»äº§ç”Ÿ.æ–‡ä»¶ä¿¡æ¯ä¸º:&quot;</span> <span class="hljs-variable">$bkdatapath</span>/mongodboplog<span class="hljs-variable">$bkfilename</span> &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Fatal Error --å¤‡ä»½è¿‡ç¨‹å·²æ‰§è¡Œï¼Œä½†æ˜¯æœªæ£€æµ‹åˆ°å¤‡ä»½äº§ç”Ÿçš„æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥ï¼&quot;</span> &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">#åˆ é™¤ä¸‰å¤©å‰çš„æ•°æ®</span><br>keepbaktime=$(<span class="hljs-built_in">date</span> -d <span class="hljs-string">&#x27;-3 days&#x27;</span> <span class="hljs-string">&quot;+%Y%m%d%H&quot;</span>)*<br><span class="hljs-keyword">if</span> [ -d <span class="hljs-variable">$bkdatapath</span>/mongodboplog<span class="hljs-variable">$keepbaktime</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$bkdatapath</span>/mongodboplog<span class="hljs-variable">$keepbaktime</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Message -- <span class="hljs-variable">$bkdatapath</span>/mongodboplog<span class="hljs-variable">$keepbaktime</span> åˆ é™¤å®Œæ¯•&quot;</span> &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br><span class="hljs-keyword">fi</span><br> <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;===MongoDB ç«¯å£ä¸º&quot;</span> <span class="hljs-variable">$port</span> <span class="hljs-string">&quot;çš„å·®å¼‚å¤‡ä»½ç»“æŸï¼Œç»“æŸæ—¶é—´ä¸ºï¼š&quot;</span> $(<span class="hljs-built_in">date</span> -d today +<span class="hljs-string">&quot;%Y%m%d%H%M%S&quot;</span>) &gt;&gt; <span class="hljs-variable">$bklogpath</span>/<span class="hljs-variable">$logfilename</span>.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><h2 id="2-å¢é‡å¤‡ä»½è¿˜åŸ-mongodb-backup-incremental-sh-è„šæœ¬"><a href="#2-å¢é‡å¤‡ä»½è¿˜åŸ-mongodb-backup-incremental-sh-è„šæœ¬" class="headerlink" title="2.å¢é‡å¤‡ä»½è¿˜åŸ [ mongodb_backup_incremental.sh ] è„šæœ¬"></a>2.å¢é‡å¤‡ä»½è¿˜åŸ [ mongodb_backup_incremental.sh ] è„šæœ¬</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#</span><br>host=192.168.94.154<br>port=9009<br><span class="hljs-comment">#å¯åŠ¨æ–‡ä»¶æ‰€åœ¨è·¯å¾„</span><br>mongo_bin=/app/mongodb/mongodb/bin/<br><span class="hljs-comment">#å¤‡ä»½å­˜æ”¾è„šæœ¬</span><br>backpath=<span class="hljs-string">&#x27;/app/mongodb/backup/mongodbOplog_bak/mongo-$port&#x27;</span><br> <br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[31;1m*****[ Mongodb ] å¢é‡æ¢å¤è„šæœ¬*****\033[0m&quot;</span><br> <br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[32;1m[ é€‰æ‹©è¦æ¢å¤å¢é‡çš„æ—¥æœŸ(æ ¼å¼ï¼šå¹´æœˆæ—¥æ—¶åˆ†ç§’) ] \033[0m&quot;</span><br><span class="hljs-keyword">for</span> time_file <span class="hljs-keyword">in</span> `<span class="hljs-built_in">ls</span> <span class="hljs-variable">$backpath</span>`; <span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$time_file</span><br><span class="hljs-keyword">done</span><br> <br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;&gt;&gt;&gt;&quot;</span> date_bak<br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$date_bak</span> == <span class="hljs-string">&quot;&quot;</span> ]] || [[ <span class="hljs-variable">$date_bak</span> == <span class="hljs-string">&#x27;.&#x27;</span> ]] || [[ <span class="hljs-variable">$date_bak</span> == <span class="hljs-string">&#x27;..&#x27;</span> ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[31;1mè¾“å…¥ä¸èƒ½ä¸ºç‰¹æ®Šå­—ç¬¦.\033[0m&quot;</span><br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ -d <span class="hljs-variable">$backpath</span>/<span class="hljs-variable">$date_bak</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;è¯·ç¡®è®¤æ˜¯å¦æ¢å¤[<span class="hljs-variable">$date_bak</span>]å¢é‡å¤‡ä»½[y/n]:&quot;</span> choice<br>    <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$choice</span>&quot;</span> == <span class="hljs-string">&quot;y&quot;</span> ];<span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">mkdir</span> -p /tmp/mongodb/ &amp;&amp; <span class="hljs-built_in">cp</span> -a <span class="hljs-variable">$backpath</span>/<span class="hljs-variable">$date_bak</span>/local/oplog.rs.bson /tmp/mongodb/oplog.bson<br>        <span class="hljs-variable">$mongo_bin</span>/mongorestore --host <span class="hljs-variable">$host</span> --port <span class="hljs-variable">$port</span> --oplogReplay /tmp/mongodb/ &amp;&amp; <span class="hljs-built_in">rm</span> -rf /tmp/mongodb/<br>        <span class="hljs-keyword">if</span> [ $? -eq 0 ];<span class="hljs-keyword">then</span><br>            <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[32;1m--------[<span class="hljs-variable">$date_bak</span>]å¢é‡æ¢å¤æˆåŠŸ.--------\033[0m&quot;</span><br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[31;1mæ¢å¤å¤±è´¥,è¯·æ‰‹åŠ¨æ£€æŸ¥!\033[0m&quot;</span><br>            <span class="hljs-built_in">exit</span> 3<br>        <span class="hljs-keyword">fi</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">exit</span> 2<br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\033[31;1mè¾“å…¥ä¿¡æ¯é”™è¯¯.\033[0m&quot;</span><br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">#å¢é‡å¤‡ä»½çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥ä¸ºï¼šæ¯å¤©æ‰§è¡Œä¸€æ¬¡å…¨é‡å¤‡ä»½ï¼Œå†æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡å¢é‡å¤‡ä»½è„šæœ¬</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MongoDB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MongoDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDBå…¨é‡å¤‡ä»½å’Œå¢é‡å¤‡ä»½</title>
    <link href="/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/MongoDB%E5%89%AF%E6%9C%AC%E9%9B%86%E6%90%AD%E5%BB%BA%E5%8F%8A%E6%B5%8B%E8%AF%95/"/>
    <url>/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/MongoDB%E5%89%AF%E6%9C%AC%E9%9B%86%E6%90%AD%E5%BB%BA%E5%8F%8A%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="MongoDBå‰¯æœ¬é›†æ­å»ºåŠæµ‹è¯•"><a href="#MongoDBå‰¯æœ¬é›†æ­å»ºåŠæµ‹è¯•" class="headerlink" title="MongoDBå‰¯æœ¬é›†æ­å»ºåŠæµ‹è¯•"></a>MongoDBå‰¯æœ¬é›†æ­å»ºåŠæµ‹è¯•</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡ä»¶ï¼šhttps://www.cnblogs.com/hukey/p/5769548.html<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€æ­å»ºç¯å¢ƒ"><a href="#ä¸€ã€æ­å»ºç¯å¢ƒ" class="headerlink" title="ä¸€ã€æ­å»ºç¯å¢ƒ"></a>ä¸€ã€æ­å»ºç¯å¢ƒ</h2><p>é€‰æ‹©ä¸‰å°æœºå™¨è¿›è¡Œæ­å»º</p><p><strong>ä»¥ä¸‹ä¸ºæœºå™¨ipï¼š</strong></p><table><thead><tr><th>æœºå™¨å</th><th>IPåœ°å€</th></tr></thead><tbody><tr><td>node0</td><td>192.168.94.154</td></tr><tr><td>node1</td><td>192.168.94.155</td></tr><tr><td>node2</td><td>192.168.94.156</td></tr></tbody></table><h2 id="äºŒã€å®‰è£…mongod-å¹¶å¯åŠ¨ï¼Œå¦‚ä¸‹æ˜¯node0æœºå™¨mongdbçš„confæ–‡ä»¶ï¼š"><a href="#äºŒã€å®‰è£…mongod-å¹¶å¯åŠ¨ï¼Œå¦‚ä¸‹æ˜¯node0æœºå™¨mongdbçš„confæ–‡ä»¶ï¼š" class="headerlink" title="äºŒã€å®‰è£…mongod,å¹¶å¯åŠ¨ï¼Œå¦‚ä¸‹æ˜¯node0æœºå™¨mongdbçš„confæ–‡ä»¶ï¼š"></a>äºŒã€å®‰è£…mongod,å¹¶å¯åŠ¨ï¼Œå¦‚ä¸‹æ˜¯node0æœºå™¨mongdbçš„confæ–‡ä»¶ï¼š</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> mongodb.conf<br><span class="hljs-comment">#----</span><br>systemLog:<br>   destination: file<br>   path: <span class="hljs-string">&quot;/app/mongodb/mongodb/log/mongod.log&quot;</span><br>   logAppend: <span class="hljs-literal">true</span><br>processManagement:<br>   fork: <span class="hljs-literal">true</span><br>   pidFilePath: /app/mongodb/mongodb/mongod.pid<br>storage:<br>   journal:<br>      enabled: <span class="hljs-literal">true</span><br>   dbPath: <span class="hljs-string">&quot;/app/mongodb/mongodb/data&quot;</span><br>   directoryPerDB: <span class="hljs-literal">true</span><br>   engine: wiredTiger<br>   wiredTiger:<br>      engineConfig:<br>         cacheSizeGB: 1<br>         directoryForIndexes: <span class="hljs-literal">true</span><br>      collectionConfig:<br>         blockCompressor: zlib<br>      indexConfig:<br>         prefixCompression: <span class="hljs-literal">true</span><br>net:   <br>   port: 9009<br>   bindIp: 192.168.94.154<br>replication:<br>   oplogSizeMB: 2048<br>   replSetName: mongo-node0 <br><span class="hljs-comment">#security:</span><br><span class="hljs-comment">#   authorization: enabled</span><br><br></code></pre></td></tr></table></figure><h2 id="äºŒã€è¿æ¥mongo-åˆå§‹åŒ–å‰¯æœ¬é›†ï¼Œæ·»åŠ node1å’Œnode2åˆ°node0"><a href="#äºŒã€è¿æ¥mongo-åˆå§‹åŒ–å‰¯æœ¬é›†ï¼Œæ·»åŠ node1å’Œnode2åˆ°node0" class="headerlink" title="äºŒã€è¿æ¥mongo,åˆå§‹åŒ–å‰¯æœ¬é›†ï¼Œæ·»åŠ node1å’Œnode2åˆ°node0"></a>äºŒã€è¿æ¥mongo,åˆå§‹åŒ–å‰¯æœ¬é›†ï¼Œæ·»åŠ node1å’Œnode2åˆ°node0</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿æ¥node0æœºå™¨çš„mongdbåº“ï¼Œå¹¶åœ¨node0ä¸Šè¿›è¡Œé…ç½®</span><br>mongo --host 192.168.94.154 --port 9009 --authenticationDatabase admin<br><br><span class="hljs-comment">#æŸ¥çœ‹çŠ¶æ€</span><br>rs.status()<br><br><span class="hljs-comment">#åˆå§‹åŒ–å‰¯æœ¬é›†</span><br>rs.initiate()<br><br><span class="hljs-comment">#æ·»åŠ node1ã€node2æˆå‘˜</span><br>node0:PRIMARY&gt; rs.add(<span class="hljs-string">&#x27;192.168.94.155:9009&#x27;</span>)<br><span class="hljs-comment">#è¾“å‡º&#123;&quot;OK&quot; : 1 &#125;</span><br><br>node0:PRIMARY&gt; rs.add(<span class="hljs-string">&#x27;192.168.94.156:9009&#x27;</span>)<br><span class="hljs-comment">#è¾“å‡º&#123;&quot;OK&quot; : 1 &#125;</span><br><br><span class="hljs-comment">#æŸ¥çœ‹æ˜¯å¦åŠ å…¥æˆåŠŸ</span><br>rs.status()<br><br>rs.isMaster()  <span class="hljs-comment">#è¾“å‡ºçš„å†…å®¹ï¼Œprimaryï¼šåé¢æ˜¯æŒ‡ä¸»è¦çš„èŠ‚ç‚¹æ˜¯192.168.94.154ï¼› me : åé¢æŒ‡å½“å‰æ‰€åœ¨çš„èŠ‚ç‚¹æ˜¯</span><br></code></pre></td></tr></table></figure><h3 id="ä¸‰ã€æµ‹è¯•æ˜¯å¦å®ç°MongoDBå‰¯æœ¬é›†çš„é«˜å¯ç”¨"><a href="#ä¸‰ã€æµ‹è¯•æ˜¯å¦å®ç°MongoDBå‰¯æœ¬é›†çš„é«˜å¯ç”¨" class="headerlink" title="ä¸‰ã€æµ‹è¯•æ˜¯å¦å®ç°MongoDBå‰¯æœ¬é›†çš„é«˜å¯ç”¨"></a>ä¸‰ã€æµ‹è¯•æ˜¯å¦å®ç°MongoDBå‰¯æœ¬é›†çš„é«˜å¯ç”¨</h3><h4 id="1ã€é€šè¿‡å¯¹primaryèŠ‚ç‚¹æ·»åŠ 1ä¸‡æ¡æ•°æ®ï¼Œçœ‹å…¶ä»–ä¸¤ä¸ªSECONDARYèŠ‚ç‚¹æ˜¯å¦åŒæ­¥"><a href="#1ã€é€šè¿‡å¯¹primaryèŠ‚ç‚¹æ·»åŠ 1ä¸‡æ¡æ•°æ®ï¼Œçœ‹å…¶ä»–ä¸¤ä¸ªSECONDARYèŠ‚ç‚¹æ˜¯å¦åŒæ­¥" class="headerlink" title="1ã€é€šè¿‡å¯¹primaryèŠ‚ç‚¹æ·»åŠ 1ä¸‡æ¡æ•°æ®ï¼Œçœ‹å…¶ä»–ä¸¤ä¸ªSECONDARYèŠ‚ç‚¹æ˜¯å¦åŒæ­¥"></a>1ã€é€šè¿‡å¯¹primaryèŠ‚ç‚¹æ·»åŠ 1ä¸‡æ¡æ•°æ®ï¼Œçœ‹å…¶ä»–ä¸¤ä¸ªSECONDARYèŠ‚ç‚¹æ˜¯å¦åŒæ­¥</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿æ¥primaryèŠ‚ç‚¹mongdbæ•°æ®åº“</span><br>mongo --host 192.168.94.154 --port 9009 --authenticationDatabase admin<br><br><span class="hljs-comment">#æ’å…¥æµ‹è¯•æ•°æ®</span><br><span class="hljs-keyword">for</span>(var i=1;i&lt;=10000;i++) db.users.insert(&#123;<span class="hljs-built_in">id</span>:i,addr_1:<span class="hljs-string">&quot;Beijing&quot;</span>,addr_2:<span class="hljs-string">&quot;Shanghai&quot;</span>&#125;);<br><span class="hljs-comment">#è¾“å‡ºï¼šWriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><br>show dbs<br><span class="hljs-comment">#è¾“å‡ºï¼š===============</span><br><span class="hljs-built_in">local</span>  0.001GB<br><span class="hljs-built_in">test</span>   0.000GB<br><br><span class="hljs-comment">#ä½¿ç”¨teståº“</span><br>use <span class="hljs-built_in">test</span><br><span class="hljs-comment">#æŸ¥çœ‹è¡¨</span><br>show collections<br><br><span class="hljs-comment">#æŸ¥çœ‹è¡¨æ•°æ®</span><br>db.users.find()<br></code></pre></td></tr></table></figure><h3 id="2ã€æŸ¥çœ‹SECONDARY-èŠ‚ç‚¹"><a href="#2ã€æŸ¥çœ‹SECONDARY-èŠ‚ç‚¹" class="headerlink" title="2ã€æŸ¥çœ‹SECONDARY èŠ‚ç‚¹"></a>2ã€æŸ¥çœ‹SECONDARY èŠ‚ç‚¹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿æ¥SECONDARY èŠ‚ç‚¹mongdbæ•°æ®åº“</span><br>mongo --host 192.168.94.155 --port 9009 --authenticationDatabase admin<br><br>show dbs<br><span class="hljs-comment">#å°†ä¼šè¾“å‡ºä»¥ä¸‹å†…å®¹ï¼š</span><br>2021-10-20T14:59:13.896+0800 E  QUERY    [js] uncaught exception: Error: listDatabases failed:&#123;<br>......çœç•¥äº†éƒ¨åˆ†é”™è¯¯è¯¦æƒ…......<br>shellHelper@src/mongo/shell/utils.js:790:15<br>@(shellhelp2):1:1<br><span class="hljs-comment">#================================================</span><br>ä»¥ä¸Šé”™è¯¯ä¿¡æ¯æ˜¯å› ä¸ºé¦–æ¬¡åœ¨SECONDARYè®¿é—®é›†åˆçš„æ—¶å€™æ˜¯ä¸å…è®¸çš„<br><br><span class="hljs-comment"># é¦–æ¬¡è®¿é—®é›†åˆéœ€è¦æ‰§è¡Œrs.slaveOk()</span><br>rs.slaveOk()     <br><br><span class="hljs-comment">#æŸ¥çœ‹æ•°æ®åº“</span><br>show dbs<br><span class="hljs-comment">#è¾“å‡ºï¼š===============</span><br><span class="hljs-built_in">local</span>  0.001GB<br><span class="hljs-built_in">test</span>   0.000GB<br><br><span class="hljs-comment">#ä½¿ç”¨teståº“</span><br>use <span class="hljs-built_in">test</span><br><br><span class="hljs-comment">#æŸ¥çœ‹è¡¨</span><br>show collections<br><br><span class="hljs-comment">#æŸ¥çœ‹è¡¨æ•°æ®</span><br>db.users.find()<br><br></code></pre></td></tr></table></figure><p><em><strong>è¾“å‡ºç»“æœä¸primaryèŠ‚ç‚¹ä¸€è‡´æ—¶ï¼Œè¯´æ˜å·²ç»åŒæ­¥æˆåŠŸï¼</strong></em></p><p>*<strong>Downæ‰primaryèŠ‚ç‚¹ï¼Œæµ‹è¯•æ˜¯å¦è°ƒåº¦primary</strong></p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MongoDB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MongoDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDBä¸»-ä»-ä»²è£èŠ‚ç‚¹æ­å»º</title>
    <link href="/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/MongoDB%E4%B8%BB-%E4%BB%8E-%E4%BB%B2%E8%A3%81%E8%8A%82%E7%82%B9%E6%90%AD%E5%BB%BA/"/>
    <url>/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/MongoDB%E4%B8%BB-%E4%BB%8E-%E4%BB%B2%E8%A3%81%E8%8A%82%E7%82%B9%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="MongoDBä¸»-ä»-ä»²è£èŠ‚ç‚¹æ­å»ºï¼ˆéƒ¨ç½²å¸¦è®¤è¯æ¨¡å¼ï¼‰"><a href="#MongoDBä¸»-ä»-ä»²è£èŠ‚ç‚¹æ­å»ºï¼ˆéƒ¨ç½²å¸¦è®¤è¯æ¨¡å¼ï¼‰" class="headerlink" title="MongoDBä¸»-ä»-ä»²è£èŠ‚ç‚¹æ­å»ºï¼ˆéƒ¨ç½²å¸¦è®¤è¯æ¨¡å¼ï¼‰"></a>MongoDBä¸»-ä»-ä»²è£èŠ‚ç‚¹æ­å»ºï¼ˆéƒ¨ç½²å¸¦è®¤è¯æ¨¡å¼ï¼‰</h1><h2 id="å‡†å¤‡ç¯å¢ƒ"><a href="#å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="å‡†å¤‡ç¯å¢ƒ:"></a>å‡†å¤‡ç¯å¢ƒ:</h2><table><thead><tr><th>IPåœ°å€</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>192.168.94.179:9009</td><td>ä¸»</td></tr><tr><td>192.168.94.178:9009</td><td>ä»</td></tr><tr><td>192.168.94.178:9019</td><td>ä»²è£èŠ‚ç‚¹</td></tr></tbody></table><h2 id="ä¸€ã€å‰è¨€ï¼š"><a href="#ä¸€ã€å‰è¨€ï¼š" class="headerlink" title="ä¸€ã€å‰è¨€ï¼š"></a>ä¸€ã€å‰è¨€ï¼š</h2><p><em><strong>å…ˆå®‰è£…ä¸»èŠ‚ç‚¹mongoDBï¼Œé‡‡ç”¨äºŒè¿›åˆ¶å®‰è£…çš„mongo,å¯ä½¿ç”¨mongodbå®‰è£…è„šæœ¬è¿›è¡ŒäºŒè¿›åˆ¶å®‰è£…ï¼Œå¯åŠ¨åè®¾ç½®å®Œæˆadminå¯†ç </strong></em></p><p><em><strong>è¯·æ³¨æ„ï¼šä¸‹ä¸ºmongodbé›†ç¾¤æ­£å¸¸å¯åŠ¨åçš„confæ–‡ä»¶ï¼Œéå¯åŠ¨æ—¶çš„mongodb.confæ–‡ä»¶ï¼ŒæŒ‰ç…§æ­£å¸¸mongoå®‰è£…è„šæœ¬å†…çš„mongodb.confæ–‡ä»¶å¯åŠ¨åï¼Œå†å¯¹æ¯”ä¿®æ”¹</strong></em></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> /app/mongodb/conf/mongo.conf<br><br>systemLog:<br>   destination: file<br>   path: <span class="hljs-string">&quot;/app/mongodb/log/mongod.log&quot;</span><br>   logAppend: <span class="hljs-literal">true</span><br>processManagement:<br>   fork: <span class="hljs-literal">true</span><br>   pidFilePath: /app/mongodb/mongod.pid<br>storage:<br>   journal:<br>      enabled: <span class="hljs-literal">true</span><br>   dbPath: <span class="hljs-string">&quot;/app/mongodb/data&quot;</span><br>   directoryPerDB: <span class="hljs-literal">true</span><br>   <span class="hljs-comment">#engine: wiredTiger</span><br>   wiredTiger:<br>      engineConfig:<br>         cacheSizeGB: 10 <br>         directoryForIndexes: <span class="hljs-literal">true</span><br>      collectionConfig:<br>         blockCompressor: zlib<br>      indexConfig:<br>         prefixCompression: <span class="hljs-literal">true</span><br>net:   <br>   port: 9009<br>   bindIp: 192.168.94.179   <span class="hljs-comment">#ä¿®æ”¹æœºå™¨ip</span><br><br>replication:<br>   oplogSizeMB: 20480<br>   replSetName: mongo-cluster  <span class="hljs-comment">#åç§°å¯ä»¥è‡ªå®šä¹‰ï¼Œä½†æ˜¯å¿…é¡»ä¿è¯ä¸»èŠ‚ç‚¹ã€ä»èŠ‚ç‚¹ã€ä»²è£èŠ‚ç‚¹ç»Ÿä¸€å¤åˆ¶ä»£</span><br><br>security: <span class="hljs-comment">#åˆšå¯åŠ¨æ—¶è¯·å…ˆæ³¨é‡Šä¸‹é¢å†…å®¹</span><br>   keyFile: /app/mongodb/conf/mongo_keyfile  <span class="hljs-comment">#ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶å…ˆæ³¨é‡Š</span><br>   authorization: enabled <br>   javascriptEnabled: <span class="hljs-literal">false</span><br><br><span class="hljs-comment">## /app/mongodb/conf ##è®¤è¯æ–‡ä»¶ç›®å½•</span><br></code></pre></td></tr></table></figure><h2 id="äºŒã€ç”Ÿæˆç§˜é’¥ï¼Œå¹¶èµ‹æƒ"><a href="#äºŒã€ç”Ÿæˆç§˜é’¥ï¼Œå¹¶èµ‹æƒ" class="headerlink" title="äºŒã€ç”Ÿæˆç§˜é’¥ï¼Œå¹¶èµ‹æƒ"></a>äºŒã€ç”Ÿæˆç§˜é’¥ï¼Œå¹¶èµ‹æƒ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl rand -<span class="hljs-built_in">base64</span> 741 &gt;&gt; /app/mongodb/conf/mongo_keyfile<br><span class="hljs-built_in">chmod</span> 700 /app/mongodb/conf/mongo_keyfile<br></code></pre></td></tr></table></figure><p><strong>ç”Ÿæˆkeyfileæ–‡ä»¶åï¼Œæ ¹æ®ä¸Šé¢çš„confæ–‡ä»¶ä¿®æ”¹mongo.confï¼Œå°†æ–‡ä»¶å†…çš„securityçš„æ³¨é‡Šå–æ¶ˆï¼Œå†é‡æ–°å¯åŠ¨mongo</strong></p><h2 id="ä¸‰ã€è¿æ¥mongo-192-168-94-179-9009ä¸»åº“"><a href="#ä¸‰ã€è¿æ¥mongo-192-168-94-179-9009ä¸»åº“" class="headerlink" title="ä¸‰ã€è¿æ¥mongo 192.168.94.179:9009ä¸»åº“"></a>ä¸‰ã€è¿æ¥mongo 192.168.94.179:9009ä¸»åº“</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">&gt; use admin<br>&gt; config=&#123;_id:<span class="hljs-string">&#x27;mongo-cluster&#x27;</span>,members:[&#123;_id:0,host:<span class="hljs-string">&#x27;192.168.94.179:9009&#x27;</span>,priority:2&#125;,&#123;_id:1,host:<span class="hljs-string">&#x27;192.168.94.178:9009&#x27;</span>,priority:1&#125;,&#123;_id:2,host:<span class="hljs-string">&#x27;192.168.94.178:9019&#x27;</span>, arbiterOnly:<span class="hljs-literal">true</span>&#125;]&#125;<br><br><span class="hljs-comment">#mongo-clusterï¼šè¯¥åç§°å–è‡ªmongoçš„confæ–‡ä»¶å†…replSetName</span><br><span class="hljs-comment">#priorityçš„å€¼è¶Šé«˜ï¼Œåˆå§‹åŒ–å®Œåï¼Œè¯¥èŠ‚ç‚¹å°±ä¼šæˆä¸ºä¸»èŠ‚ç‚¹</span><br><span class="hljs-comment">#arbiterOnly:true ä»£è¡¨è¯¥èŠ‚ç‚¹ä¸ºä»²è£èŠ‚ç‚¹ã€‚</span><br><br><br><br><span class="hljs-comment">#ä½¿ç”¨é…ç½®æ–‡ä»¶configåˆå§‹åŒ–å‰¯æœ¬é›†</span><br>&gt; rs.initiate(config)<br><br>&gt; rs.isMaster()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MongoDB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MongoDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨dockerå¯åŠ¨MongoDB</title>
    <link href="/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/docker%E5%90%AF%E5%8A%A8mongodb%E5%91%BD%E4%BB%A4/"/>
    <url>/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/docker%E5%90%AF%E5%8A%A8mongodb%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨dockerå¯åŠ¨MongoDB"><a href="#ä½¿ç”¨dockerå¯åŠ¨MongoDB" class="headerlink" title="ä½¿ç”¨dockerå¯åŠ¨MongoDB"></a>ä½¿ç”¨dockerå¯åŠ¨MongoDB</h1><h2 id="å®¹å™¨å¯åŠ¨mongodbå‘½ä»¤ï¼š"><a href="#å®¹å™¨å¯åŠ¨mongodbå‘½ä»¤ï¼š" class="headerlink" title="å®¹å™¨å¯åŠ¨mongodbå‘½ä»¤ï¼š"></a>å®¹å™¨å¯åŠ¨mongodbå‘½ä»¤ï¼š</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d --name mongodb_docker\<br> -v /root/mongodb_docker/db:/data/db \<br> -p 27017:27017  \<br> -e MONGO_INITDB_ROOT_USERNAME=admin \<br> -e MONGO_INITDB_ROOT_PASSWORD=admin \<br> mongo --auth<br><span class="hljs-comment">#--authï¼šéœ€è¦å¯†ç æ‰èƒ½è®¿é—®å®¹å™¨æœåŠ¡</span><br></code></pre></td></tr></table></figure><h2 id="å®¹å™¨è¿æ¥mongodbå‘½ä»¤ï¼š"><a href="#å®¹å™¨è¿æ¥mongodbå‘½ä»¤ï¼š" class="headerlink" title="å®¹å™¨è¿æ¥mongodbå‘½ä»¤ï¼š"></a>å®¹å™¨è¿æ¥mongodbå‘½ä»¤ï¼š</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -it --<span class="hljs-built_in">rm</span> --<span class="hljs-built_in">link</span> mongodb_docker:mongo \<br>mongo mongo --host mongo -u admin -p admin --authenticationDatabase admin<br><span class="hljs-comment">#--link åé¢æ¥çš„æ˜¯è¦è¿æ¥çš„å®¹å™¨ä¸ç°æœ‰çš„å®¹å™¨é€šä¿¡ï¼Œmongodb_dockerï¼ˆå®¹å™¨åï¼‰ï¼šmongodï¼ˆå®¹å™¨åˆ«åï¼‰</span><br></code></pre></td></tr></table></figure><h2 id="mongoéƒ¨åˆ†ä½¿ç”¨çš„å‘½ä»¤"><a href="#mongoéƒ¨åˆ†ä½¿ç”¨çš„å‘½ä»¤" class="headerlink" title="mongoéƒ¨åˆ†ä½¿ç”¨çš„å‘½ä»¤"></a>mongoéƒ¨åˆ†ä½¿ç”¨çš„å‘½ä»¤</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sh">åˆ›å»ºæ•°æ®åº“ ï¼š<br>&gt;use weaselï¼›<br><br>åˆ›å»ºç”¨æˆ· ï¼š<br>&gt; db.createUser(&#123;user: <span class="hljs-string">&quot;weasel&quot;</span>,<span class="hljs-built_in">pwd</span>: <span class="hljs-string">&quot;123456&quot;</span>,roles: [ &#123; role: <span class="hljs-string">&quot;readWrite&quot;</span>, db: <span class="hljs-string">&quot;weasel&quot;</span> &#125; ]&#125;)<br><br>ä½¿ç”¨æ–°ç”¨æˆ·è¿æ¥ï¼šã€€<br>docker run -it --<span class="hljs-built_in">rm</span> --<span class="hljs-built_in">link</span> mongodb_docker:mongo mongo mongo --host mongo -u weasel -p 123456 --authenticationDatabase weaselã€€<br><br>ä½¿ç”¨ï¼š<br>use weasel;<br><br>&gt; db.test2.insert(&#123;<span class="hljs-string">&quot;cc&quot;</span>:<span class="hljs-string">&quot;123&quot;</span>, <span class="hljs-string">&quot;das&quot;</span>:<span class="hljs-string">&#x27;123444444&#x27;</span>&#125;);<br>WriteResult(&#123; <span class="hljs-string">&quot;nInserted&quot;</span> : 1 &#125;)<br><br>&gt; db.test2.count()<br>1<br> <br>&gt; db.test2<br>db.test2<br><br>&gt; db.test2.find(&#123;<span class="hljs-string">&quot;cc&quot;</span>:<span class="hljs-string">&#x27;123&#x27;</span>&#125;);<br>&#123; <span class="hljs-string">&quot;_id&quot;</span> : ObjectId(<span class="hljs-string">&quot;5b4c3b24099d1b0ef30cc0fb&quot;</span>), <span class="hljs-string">&quot;cc&quot;</span> : <span class="hljs-string">&quot;123&quot;</span>, <span class="hljs-string">&quot;das&quot;</span> : <span class="hljs-string">&quot;123444444&quot;</span> &#125;<br><br></code></pre></td></tr></table></figure><h2 id="åªå®‰è£…å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®åº“è¿æ¥ï¼Œå¯ä½¿ç”¨æºæ–‡ä»¶æ–¹å¼å®‰è£…mongodb-client"><a href="#åªå®‰è£…å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®åº“è¿æ¥ï¼Œå¯ä½¿ç”¨æºæ–‡ä»¶æ–¹å¼å®‰è£…mongodb-client" class="headerlink" title="åªå®‰è£…å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®åº“è¿æ¥ï¼Œå¯ä½¿ç”¨æºæ–‡ä»¶æ–¹å¼å®‰è£…mongodb client"></a>åªå®‰è£…å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®åº“è¿æ¥ï¼Œå¯ä½¿ç”¨æºæ–‡ä»¶æ–¹å¼å®‰è£…mongodb client</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br>ç³»ç»Ÿä¸º CentOS 7ï¼Œæ¶æ„ä¸º x86_64 ï¼Œå°±å¯ä»¥å» `https://repo.mongodb.org/yum/redhat/7/mongodb-org/ `è·¯å¾„ä¸‹å¯»æ‰¾å¯¹åº”çš„åŒ…<br>rpm -i mongodb-org-shell-4.4.4-1.el7.x86_64.rpm<br><br>å¦‚æœç³»ç»Ÿä¸º Ubuntu æˆ–è€… Debain åˆ™å¯ä»¥å» `https://repo.mongodb.org/apt/ `è·¯å¾„ä¸‹å¯»æ‰¾å¯¹åº”çš„åŒ…<br><span class="hljs-comment">#https://repo.mongodb.org/apt/ubuntu/dists/bionic/mongodb-org/5.0/multiverse/binary-amd64/</span><br>dpkg -i mongodb-org-shell_5.0.0_amd64.deb<br></code></pre></td></tr></table></figure><h2 id="mongoshellå¿«é€Ÿä¸‹è½½å®‰è£…"><a href="#mongoshellå¿«é€Ÿä¸‹è½½å®‰è£…" class="headerlink" title="mongoshellå¿«é€Ÿä¸‹è½½å®‰è£…"></a>mongoshellå¿«é€Ÿä¸‹è½½å®‰è£…</h2><p>ä¸‹è½½åœ°å€: <a href="https://www.csdn.net/tags/OtTacg2sOTY4OS1ibG9n.html">https://www.csdn.net/tags/OtTacg2sOTY4OS1ibG9n.html</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">centos:<br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;[mongodb-org-3.6] \nname=MongoDB Repository\nbaseurl=https://repo.mongodb.org/yum/amazon/2013.03/mongodb-org/3.6/x86_64/\ngpgcheck=1 \nenabled=1 \ngpgkey=https://www.mongodb.org/static/pgp/server-3.6.asc&quot;</span> | sudo <span class="hljs-built_in">tee</span> /etc/yum.repos.d/mongodb-org-3.6.repo<br>sudo yum install -y mongodb-org-shell<br><br>ubuntu :<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.4 multiverse&quot;</span> | sudo <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/mongodb-org-3.4.list<br>apt-get install -y mongodb-org-shell --allow-unauthenticated<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MongoDB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MongoDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDBäºŒè¿›åˆ¶å®‰è£…</title>
    <link href="/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/MongoDB%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/"/>
    <url>/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/MongoDB%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="MongoDBäºŒè¿›åˆ¶å®‰è£…"><a href="#MongoDBäºŒè¿›åˆ¶å®‰è£…" class="headerlink" title="MongoDBäºŒè¿›åˆ¶å®‰è£…"></a>MongoDBäºŒè¿›åˆ¶å®‰è£…</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mongoå„ä¸ªç‰ˆæœ¬ä¸‹è½½åœ°å€:https:<span class="hljs-regexp">//</span>www.mongodb.org<span class="hljs-regexp">/dl/</span>linux<br></code></pre></td></tr></table></figure><h2 id="1-ä¸Šä¼ å®‰è£…åŒ…ï¼Œå¹¶è§£å‹"><a href="#1-ä¸Šä¼ å®‰è£…åŒ…ï¼Œå¹¶è§£å‹" class="headerlink" title="1.ä¸Šä¼ å®‰è£…åŒ…ï¼Œå¹¶è§£å‹"></a>1.ä¸Šä¼ å®‰è£…åŒ…ï¼Œå¹¶è§£å‹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /app<br><span class="hljs-built_in">cd</span> /app<br>tar -zxnf mongodb-4.2.11<br></code></pre></td></tr></table></figure><h2 id="2-è®¾ç½®è½¯é“¾æ¥"><a href="#2-è®¾ç½®è½¯é“¾æ¥" class="headerlink" title="2.è®¾ç½®è½¯é“¾æ¥"></a>2.è®¾ç½®è½¯é“¾æ¥</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ln</span> -s /app/mongodb-4.2.11 /app/mongodb<br></code></pre></td></tr></table></figure><h2 id="3-æ–°å»ºmongodbç”¨æˆ·ç»„"><a href="#3-æ–°å»ºmongodbç”¨æˆ·ç»„" class="headerlink" title="3.æ–°å»ºmongodbç”¨æˆ·ç»„"></a>3.æ–°å»ºmongodbç”¨æˆ·ç»„</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">useradd -u 1201 -s /bin/false mongod<br><br><span class="hljs-built_in">mkdir</span> -p /app/mongodb/&#123;data,conf,<span class="hljs-built_in">log</span>&#125;<br><br><span class="hljs-built_in">chown</span> -R mongod:mongod /app/mongodb<br></code></pre></td></tr></table></figure><h2 id="4-ç¼–è¾‘rc-localæ–‡ä»¶"><a href="#4-ç¼–è¾‘rc-localæ–‡ä»¶" class="headerlink" title="4.ç¼–è¾‘rc.localæ–‡ä»¶"></a>4.ç¼–è¾‘rc.localæ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt;&gt;/etc/rc.local&lt;&lt;-<span class="hljs-string">EOF</span><br><span class="hljs-string">if test -f /sys/kernel/mm/transparent_hugepage/enabled; then</span><br><span class="hljs-string">    echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="hljs-string">fi</span><br><span class="hljs-string">if test -f /sys/kernel/mm/transparent_hugepage/defrag; then</span><br><span class="hljs-string">    echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="hljs-string">fi</span><br><span class="hljs-string">ulimit -u 65535</span><br><span class="hljs-string">/app/mongodb/bin/mongod -f /app/mongodb/conf/mongodb.conf</span><br><span class="hljs-string">EOF</span><br><br><br><span class="hljs-built_in">chmod</span> +x /etc/rc.d/rc.local<br></code></pre></td></tr></table></figure><h2 id="5-ç¼–è¾‘limits-confæ–‡ä»¶"><a href="#5-ç¼–è¾‘limits-confæ–‡ä»¶" class="headerlink" title="5.ç¼–è¾‘limits.confæ–‡ä»¶"></a>5.ç¼–è¾‘limits.confæ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/security/limits.conf<br><span class="hljs-comment">#---</span><br>    * soft nofile 65535<br>    * hard nofile 65535<br>    * soft <span class="hljs-built_in">nproc</span> 32000<br>    * hard <span class="hljs-built_in">nproc</span> 32000<br><span class="hljs-comment">#---</span><br></code></pre></td></tr></table></figure><h2 id="6-ç¼–è¾‘MongoDB-conf-æ–‡ä»¶"><a href="#6-ç¼–è¾‘MongoDB-conf-æ–‡ä»¶" class="headerlink" title="6.ç¼–è¾‘MongoDB.conf æ–‡ä»¶"></a>6.ç¼–è¾‘MongoDB.conf æ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt;/app/mongodb/conf/mongodb.conf&lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>systemLog:<br>   destination: file<br>   path: <span class="hljs-string">&quot;/app/mongodb/log/mongod.log&quot;</span><br>   logAppend: <span class="hljs-literal">true</span><br>processManagement:<br>   fork: <span class="hljs-literal">true</span><br>   pidFilePath: /app/mongodb/mongod.pid<br>storage:<br>   journal:<br>      enabled: <span class="hljs-literal">true</span><br>   dbPath: <span class="hljs-string">&quot;/app/mongodb/data&quot;</span><br>   directoryPerDB: <span class="hljs-literal">true</span><br>   <span class="hljs-comment">#engine: wiredTiger</span><br>   wiredTiger:<br>      engineConfig:<br>         cacheSizeGB: 1<br>         directoryForIndexes: <span class="hljs-literal">true</span><br>      collectionConfig:<br>         blockCompressor: zlib<br>      indexConfig:<br>         prefixCompression: <span class="hljs-literal">true</span><br>net:   <br>   port: 9009<br><span class="hljs-comment">#security:</span><br><span class="hljs-comment">#   authorization: enabled    </span><br>EOF<br></code></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶è¯¦è§£ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt;/app/mongodb/conf/mongodb.conf&lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>systemLog:<br>   destination: file<br>   path: <span class="hljs-string">&quot;/app/mongodb/log/mongod.log&quot;</span> <span class="hljs-comment">##æ—¥å¿—å­˜å‚¨ä½ç½®</span><br>   logAppend: <span class="hljs-literal">true</span><br>processManagement:<br>   fork: <span class="hljs-literal">true</span><br>   pidFilePath: /app/mongodb/mongod.pid<br>storage:<br>   journal: <span class="hljs-comment">##journalé…ç½®</span><br>      enabled: <span class="hljs-literal">true</span><br>   dbPath: <span class="hljs-string">&quot;/app/mongodb/data&quot;</span> <span class="hljs-comment">##æ•°æ®æ–‡ä»¶å­˜å‚¨ä½ç½®</span><br>   directoryPerDB: <span class="hljs-literal">true</span>   <span class="hljs-comment">##æ˜¯å¦ä¸€ä¸ªåº“ä¸€ä¸ªæ–‡ä»¶å¤¹</span><br>   <span class="hljs-comment">#engine: wiredTiger ##æ•°æ®å¼•æ“</span><br>   wiredTiger: <span class="hljs-comment">##WTå¼•æ“é…ç½®</span><br>      engineConfig:<br>         cacheSizeGB: 1 <span class="hljs-comment">##WTæœ€å¤§ä½¿ç”¨cacheï¼ˆæ ¹æ®æœåŠ¡å™¨å®é™…æƒ…å†µè°ƒèŠ‚ï¼‰</span><br>         directoryForIndexes: <span class="hljs-literal">true</span> <span class="hljs-comment">##æ˜¯å¦å°†ç´¢å¼•ä¹ŸæŒ‰æ•°æ®åº“åå•ç‹¬å­˜å‚¨</span><br>      collectionConfig: <span class="hljs-comment">##è¡¨å‹ç¼©é…ç½®</span><br>         blockCompressor: zlib<br>      indexConfig: <span class="hljs-comment">##ç´¢å¼•é…ç½®</span><br>         prefixCompression: <span class="hljs-literal">true</span><br>net:   <br>   port: 9009<br>   bindIp: 192.168.94.205  <span class="hljs-comment">#mongodbæ‰€åœ¨æœºå™¨åœ°å€</span><br><span class="hljs-comment">#replication:   #é…ç½®å‰¯æœ¬é›†é‡è¦å‚æ•°</span><br><span class="hljs-comment">#   oplogSizeMB: 2048  #oplogçš„å¤§å°å•ä½MB</span><br><span class="hljs-comment">#   replSetName: mongo-cluster  #å‰¯æœ¬é›†åç§°ï¼ŒåŒä¸€ä¸ªå‰¯æœ¬é›†ï¼Œåç§°å¿…é¡»ä¸€è‡´ </span><br>security:  <span class="hljs-comment">#é…ç½®å®‰å…¨é€‰é¡¹</span><br>   keyFile: /app/mongodb/conf/KeyFile.file <span class="hljs-comment">##é›†ç¾¤éœ€è¦åŠ keyfile</span><br>   authorization: enabled    <span class="hljs-comment">#å¼€å¯æ³¨é‡Šä¸ºå¯åŠ¨å®‰å…¨é€‰é¡¹ï¼Œå»ºè®®å¯åŠ¨mongodbæ—¶å…ˆæ³¨é‡Šï¼Œè®¾ç½®å®Œç”¨æˆ·åå’Œå¯†ç åå†å–æ¶ˆæ³¨é‡Š</span><br>EOF<br></code></pre></td></tr></table></figure><h2 id="7-æ·»åŠ ç¯å¢ƒå˜é‡"><a href="#7-æ·»åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="7.æ·»åŠ ç¯å¢ƒå˜é‡"></a>7.æ·»åŠ ç¯å¢ƒå˜é‡</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt; /etc/profile.d/mongod.sh&lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br><span class="hljs-built_in">export</span> PATH=/app/mongodb/bin/:<span class="hljs-variable">$PATH</span><br>EOF<br><br><span class="hljs-built_in">source</span> /etc/profile.d/mongod.sh<br></code></pre></td></tr></table></figure><h2 id="8-å¯åŠ¨MongoDB"><a href="#8-å¯åŠ¨MongoDB" class="headerlink" title="8.å¯åŠ¨MongoDB"></a>8.å¯åŠ¨MongoDB</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#rootè´¦æˆ·æ—¶æ‰§è¡Œï¼š</span><br>/app/mongodb/bin/mongod -f /app/mongodb/conf/mongodb.conf<br><br><span class="hljs-comment">#érootç”¨æˆ·æ‰§è¡Œï¼š</span><br><span class="hljs-comment">#su - mongod -c &quot;/app/mongodb/bin/mongod -f /app/mongodb/conf/mongodb.conf&quot;</span><br><br></code></pre></td></tr></table></figure><h2 id="9-è¿æ¥MongoDB"><a href="#9-è¿æ¥MongoDB" class="headerlink" title="9.è¿æ¥MongoDB"></a>9.è¿æ¥MongoDB</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mongo --host 192.168.94.205  --port 9009<br></code></pre></td></tr></table></figure><h2 id="10-è¿æ¥mongodb-åˆ›å»ºuser"><a href="#10-è¿æ¥mongodb-åˆ›å»ºuser" class="headerlink" title="10.è¿æ¥mongodb åˆ›å»ºuser"></a>10.è¿æ¥mongodb åˆ›å»ºuser</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">&gt; use admin<br>&gt; db.createUser( &#123;user: <span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-built_in">pwd</span>: <span class="hljs-string">&quot;123456&quot;</span>,roles: [ &#123; role: <span class="hljs-string">&quot;root&quot;</span>, db: <span class="hljs-string">&quot;admin&quot;</span> &#125; ]&#125;)<br><br><span class="hljs-comment">#åˆ›å»ºpipiguaiæ•°æ®åº“ç™»å½•ç”¨æˆ·rootï¼Œå¹¶é…ç½®å¯†ç </span><br><span class="hljs-comment">#&gt;use pipiguai</span><br><span class="hljs-comment">#&gt;db.createUser(&#123;user: &quot;root&quot;,pwd: &quot;123456&quot;,roles: [ &#123; role: &quot;readWrite&quot;, db: &quot;pipiguai&quot; &#125; ]&#125;)</span><br></code></pre></td></tr></table></figure><h2 id="11-å…³é—­mong"><a href="#11-å…³é—­mong" class="headerlink" title="11.å…³é—­mong"></a>11.å…³é—­mong</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">/app/mongodb/bin/mongod --shutdown  -f /app/mongodb/conf/mongodb.conf<br>æˆ–è€…è¿æ¥mongodçš„æ—¶å€™:<br>&gt; db.shutdownServer()<br></code></pre></td></tr></table></figure><h2 id="12-å¼€å¯æ•°æ®åº“è®¤è¯ç™»å½•"><a href="#12-å¼€å¯æ•°æ®åº“è®¤è¯ç™»å½•" class="headerlink" title="12.å¼€å¯æ•°æ®åº“è®¤è¯ç™»å½•"></a>12.å¼€å¯æ•°æ®åº“è®¤è¯ç™»å½•</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /app/mongodb/conf/mongodb.conf<br><span class="hljs-comment">#å–æ¶ˆå¦‚ä¸‹ä¸¤è¡Œæ³¨é‡Š</span><br>security:<br>   authorization: enabled<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿æ¥æ•°æ®åº“</span><br>mongo --host 192.168.94.205  --port 9009 -u admin  <span class="hljs-comment">#//mongodb.confè®¾ç½®äº†bindipçš„è¯åŠ hostæµ‹è¯•è¿æ¥</span><br><br></code></pre></td></tr></table></figure><p>mongodbå¯åŠ¨å‚æ•°è¯´æ˜ï¼š<a href="https://www.jb51.net/article/95310.htm">https://www.jb51.net/article/95310.htm</a></p><h2 id="13-å®‰è£…å®¢æˆ·ç«¯è¿æ¥"><a href="#13-å®‰è£…å®¢æˆ·ç«¯è¿æ¥" class="headerlink" title="13.å®‰è£…å®¢æˆ·ç«¯è¿æ¥"></a>13.å®‰è£…å®¢æˆ·ç«¯è¿æ¥</h2><h3 id="åªå®‰è£…å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®åº“è¿æ¥ï¼Œå¯ä½¿ç”¨æºæ–‡ä»¶æ–¹å¼å®‰è£…mongodb-client"><a href="#åªå®‰è£…å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®åº“è¿æ¥ï¼Œå¯ä½¿ç”¨æºæ–‡ä»¶æ–¹å¼å®‰è£…mongodb-client" class="headerlink" title="åªå®‰è£…å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®åº“è¿æ¥ï¼Œå¯ä½¿ç”¨æºæ–‡ä»¶æ–¹å¼å®‰è£…mongodb client"></a>åªå®‰è£…å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®åº“è¿æ¥ï¼Œå¯ä½¿ç”¨æºæ–‡ä»¶æ–¹å¼å®‰è£…mongodb client</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">ç³»ç»Ÿä¸º CentOS 7ï¼Œæ¶æ„ä¸º x86_64 ï¼Œå°±å¯ä»¥å» `https://repo.mongodb.org/yum/redhat/7/mongodb-org/`è·¯å¾„ä¸‹å¯»æ‰¾å¯¹åº”çš„åŒ…<br>rpm -i mongodb-org-shell-4.4.4-1.el7.x86_64.rpm<br><br>å¦‚æœç³»ç»Ÿä¸º Ubuntu æˆ–è€… Debain åˆ™å¯ä»¥å» `https://repo.mongodb.org/apt/` è·¯å¾„ä¸‹å¯»æ‰¾å¯¹åº”çš„åŒ…<br><span class="hljs-comment">#https://repo.mongodb.org/apt/ubuntu/dists/bionic/mongodb-org/5.0/multiverse/binary-amd64/</span><br>dpkg -i mongodb-org-shell_5.0.0_amd64.deb<br><br></code></pre></td></tr></table></figure><h3 id="mongoshellå¿«é€Ÿä¸‹è½½å®‰è£…-https-www-csdn-net-tags-OtTacg2sOTY4OS1ibG9n-html"><a href="#mongoshellå¿«é€Ÿä¸‹è½½å®‰è£…-https-www-csdn-net-tags-OtTacg2sOTY4OS1ibG9n-html" class="headerlink" title="mongoshellå¿«é€Ÿä¸‹è½½å®‰è£…:https://www.csdn.net/tags/OtTacg2sOTY4OS1ibG9n.html"></a>mongoshellå¿«é€Ÿä¸‹è½½å®‰è£…:<a href="https://www.csdn.net/tags/OtTacg2sOTY4OS1ibG9n.html">https://www.csdn.net/tags/OtTacg2sOTY4OS1ibG9n.html</a></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br>centos:<br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;[mongodb-org-3.6] \nname=MongoDB Repository\nbaseurl=https://repo.mongodb.org/yum/amazon/2013.03/mongodb-org/3.6/x86_64/\ngpgcheck=1 \nenabled=1 \ngpgkey=https://www.mongodb.org/static/pgp/server-3.6.asc&quot;</span> | sudo <span class="hljs-built_in">tee</span> /etc/yum.repos.d/mongodb-org-3.6.repo<br>sudo yum install -y mongodb-org-shell<br><br>ubuntu :<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.4 multiverse&quot;</span> | sudo <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/mongodb-org-3.4.list<br>apt-get install -y mongodb-org-shell --allow-unauthenticated<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MongoDB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MongoDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨keepaliveå®ç°postgresqlé«˜å¯ç”¨ä¸»ä»åˆ‡æ¢</title>
    <link href="/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/%E4%BD%BF%E7%94%A8keepalive%E5%AE%9E%E7%8E%B0PostgreSQL%E9%AB%98%E5%8F%AF%E7%94%A8%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2/"/>
    <url>/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/%E4%BD%BF%E7%94%A8keepalive%E5%AE%9E%E7%8E%B0PostgreSQL%E9%AB%98%E5%8F%AF%E7%94%A8%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨keepaliveå®ç°postgresqlé«˜å¯ç”¨ä¸»ä»åˆ‡æ¢"><a href="#ä½¿ç”¨keepaliveå®ç°postgresqlé«˜å¯ç”¨ä¸»ä»åˆ‡æ¢" class="headerlink" title="ä½¿ç”¨keepaliveå®ç°postgresqlé«˜å¯ç”¨ä¸»ä»åˆ‡æ¢"></a>ä½¿ç”¨keepaliveå®ç°postgresqlé«˜å¯ç”¨ä¸»ä»åˆ‡æ¢</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://cloud.tencent.com/developer/article/1894340<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€æœºå™¨è§„åˆ’ã€ç¯å¢ƒå‡†å¤‡"><a href="#ä¸€ã€æœºå™¨è§„åˆ’ã€ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ä¸€ã€æœºå™¨è§„åˆ’ã€ç¯å¢ƒå‡†å¤‡"></a>ä¸€ã€æœºå™¨è§„åˆ’ã€ç¯å¢ƒå‡†å¤‡</h2><p>åŸºäºkeepalivedå®ç°postgresqlé«˜å¯ç”¨ï¼Œè¿™é‡Œç”¨ä¸¤å°æœåŠ¡å™¨ä½œä¸€ä¸»ä¸€ä»ç¤ºä¾‹</p><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>pgsql-1</td><td>192.168.62.129</td><td>ä¸»åº“</td></tr><tr><td>pgsql-2</td><td>192.168.62.130</td><td>ä»åº“</td></tr><tr><td>VIP</td><td>192.168.62.123</td><td>VIPï¼ˆè™šæ‹Ÿipï¼‰</td></tr></tbody></table><p>å¤‡æ³¨ï¼šæœºå™¨å‡æ—¶é—´åŒæ­¥ã€å…³é—­äº†é˜²ç«å¢™å’Œselinux</p><h2 id="äºŒã€æ•´ä½“æ¶æ„"><a href="#äºŒã€æ•´ä½“æ¶æ„" class="headerlink" title="äºŒã€æ•´ä½“æ¶æ„"></a>äºŒã€æ•´ä½“æ¶æ„</h2><p><img src="/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/%E4%BD%BF%E7%94%A8keepalive%E5%AE%9E%E7%8E%B0PostgreSQL%E9%AB%98%E5%8F%AF%E7%94%A8%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2/image-20230329110234099.png" alt="image-20230329110234099"></p><h2 id="ä¸‰ã€å®‰è£…Keepalived"><a href="#ä¸‰ã€å®‰è£…Keepalived" class="headerlink" title="ä¸‰ã€å®‰è£…Keepalived"></a>ä¸‰ã€å®‰è£…Keepalived</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å®‰è£…ä¾èµ–</span><br>yum install gcc openssl opensslâ€devel libnl libnlâ€devel ipvsadm -y<br><br><span class="hljs-comment">#åœ¨çº¿å®‰è£…</span><br>yum install -y keepalived<br></code></pre></td></tr></table></figure><h2 id="å››ã€å®‰è£…postgresql"><a href="#å››ã€å®‰è£…postgresql" class="headerlink" title="å››ã€å®‰è£…postgresql"></a>å››ã€å®‰è£…postgresql</h2><h3 id="å®‰è£…postgresql-14"><a href="#å®‰è£…postgresql-14" class="headerlink" title="å®‰è£…postgresql-14"></a>å®‰è£…postgresql-14</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm<br><br><span class="hljs-comment"># å®‰è£… PostgreSQLï¼š</span><br>sudo yum install -y postgresql14-server<br><br><span class="hljs-comment"># å®‰è£…æ ¸å¿ƒæ•°æ®åº“æœåŠ¡å™¨</span><br>yum install postgresql14-server postgresql14-contrib -y<br><br><span class="hljs-comment"># å¯é€‰æ‹©åˆå§‹åŒ–æ•°æ®åº“å¹¶å¯ç”¨è‡ªåŠ¨å¯åŠ¨ï¼š</span><br>sudo /usr/pgsql-14/bin/postgresql-14-setup initdb<br>sudo systemctl <span class="hljs-built_in">enable</span> postgresql-14<br>sudo systemctl start postgresql-14<br><br><span class="hljs-comment">#postgresqlç›¸å…³è·¯å¾„</span><br>/var/lib/pgsql/14/data/  <span class="hljs-comment">#confæ–‡ä»¶è·¯å¾„</span><br>/usr/pgsql-14/bin/      <span class="hljs-comment">#pgç›¸å…³å·¥å…·è·¯å¾„</span><br><br><span class="hljs-comment">#æµ‹è¯•æ˜¯å¦èƒ½æ­£å¸¸è¿æ¥</span><br>su - postgres<br>psql<br></code></pre></td></tr></table></figure><h2 id="äº”ã€æ­å»ºä¸»ä»ç¯å¢ƒ"><a href="#äº”ã€æ­å»ºä¸»ä»ç¯å¢ƒ" class="headerlink" title="äº”ã€æ­å»ºä¸»ä»ç¯å¢ƒ"></a>äº”ã€æ­å»ºä¸»ä»ç¯å¢ƒ</h2><h3 id="5-1ã€ä¸»èŠ‚ç‚¹é…ç½®"><a href="#5-1ã€ä¸»èŠ‚ç‚¹é…ç½®" class="headerlink" title="5.1ã€ä¸»èŠ‚ç‚¹é…ç½®"></a>5.1ã€ä¸»èŠ‚ç‚¹é…ç½®</h3><h4 id="5-1-1ï¼‰åˆ›å»ºç”¨äºä¸»ä»è®¿é—®çš„ç”¨æˆ·ï¼Œ-ä¿®æ”¹postgresç”¨æˆ·çš„å¯†ç ï¼Œç”¨äºè¿œç¨‹ç™»å½•ã€‚-åˆ‡æ¢åˆ°postgresç”¨æˆ·æ“ä½œ"><a href="#5-1-1ï¼‰åˆ›å»ºç”¨äºä¸»ä»è®¿é—®çš„ç”¨æˆ·ï¼Œ-ä¿®æ”¹postgresç”¨æˆ·çš„å¯†ç ï¼Œç”¨äºè¿œç¨‹ç™»å½•ã€‚-åˆ‡æ¢åˆ°postgresç”¨æˆ·æ“ä½œ" class="headerlink" title="5.1.1ï¼‰åˆ›å»ºç”¨äºä¸»ä»è®¿é—®çš„ç”¨æˆ·ï¼Œ ä¿®æ”¹postgresç”¨æˆ·çš„å¯†ç ï¼Œç”¨äºè¿œç¨‹ç™»å½•ã€‚(åˆ‡æ¢åˆ°postgresç”¨æˆ·æ“ä½œ)"></a>5.1.1ï¼‰åˆ›å»ºç”¨äºä¸»ä»è®¿é—®çš„ç”¨æˆ·ï¼Œ ä¿®æ”¹postgresç”¨æˆ·çš„å¯†ç ï¼Œç”¨äºè¿œç¨‹ç™»å½•ã€‚(åˆ‡æ¢åˆ°postgresç”¨æˆ·æ“ä½œ)</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ‡æ¢åˆ°postgresç”¨æˆ·æ“ä½œ</span><br>su - postgres<br>psql<br><br><span class="hljs-comment">#åˆ›å»ºç”¨äºä¸»ä»è®¿é—®çš„ç”¨æˆ·</span><br><span class="hljs-comment">#åˆ›å»ºæ•°æ®åº“è´¦å·replicaå¹¶è®¾ç½®å¯†ç åŠç™»å½•æƒé™å’Œå¤‡ä»½æƒé™</span><br>create role replica login replication encrypted password <span class="hljs-string">&#x27;replica123&#x27;</span>;<br><br><span class="hljs-comment">#ä¿®æ”¹postgresç”¨æˆ·çš„å¯†ç ï¼Œç”¨äºè¿œç¨‹ç™»å½•</span><br>alter USER postgres with password <span class="hljs-string">&#x27;postgres&#x27;</span>;<br></code></pre></td></tr></table></figure><h4 id="5-1-2ï¼‰ä¿®æ”¹pg-hba-confå’Œpostgresql-confé…ç½®ï¼š"><a href="#5-1-2ï¼‰ä¿®æ”¹pg-hba-confå’Œpostgresql-confé…ç½®ï¼š" class="headerlink" title="5.1.2ï¼‰ä¿®æ”¹pg_hba.confå’Œpostgresql.confé…ç½®ï¼š"></a>5.1.2ï¼‰ä¿®æ”¹pg_hba.confå’Œpostgresql.confé…ç½®ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‰“å¼€pg_hba.confæ–‡ä»¶ï¼Œè®¾ç½®replicaç”¨æˆ·ç™½åå•</span><br>vim /var/lib/pgsql/14/data/pg_hba.conf<br><span class="hljs-comment">##æ·»åŠ ä»¥ä¸‹æ•°æ®ï¼š</span><br><br><span class="hljs-comment">#------------------------æ³¨é‡ŠåŸæœ‰çš„ï¼Œæ›¿æ¢å¦‚ä¸‹çš„----------------------</span><br><br><span class="hljs-built_in">local</span>   all             all                                     trust<br><span class="hljs-comment">#å…è®¸ä»»æ„ipåœ°å€çš„ç”¨æˆ·ä½¿ç”¨md5åŠ å¯†æ–¹å¼è®¤è¯è¿æ¥</span><br>host    all             all            0.0.0.0/0                md5<br>host    all             all             ::1/128                 md5<br><span class="hljs-comment">#å…è®¸æ‰€æœ‰ç”¨æˆ·ä½¿ç”¨localæ–¹å¼è¿æ¥replication</span><br><span class="hljs-built_in">local</span>   replication     all                                     trust<br><span class="hljs-comment">#å…è®¸æ‰€æœ‰çš„ç”¨æˆ·ä½¿ç”¨md5åŠ å¯†æ–¹å¼è¿æ¥replicationæ•°æ®åº“</span><br>host    replication     all             0.0.0.0/0               md5<br>host    replication     all             ::1/128                 md5<br><br>å¤‡æ³¨ï¼špg_hba.confå‚ç…§å¦‚ä¸‹æ ¼å¼è®¾ç½®ï¼š<br><span class="hljs-comment">#è¯¦è§£æ–‡æ¡£ï¼šhttps://blog.csdn.net/hmxz2nn/article/details/83717663</span><br>è¿æ¥æ–¹å¼  è¿æ¥çš„æ•°æ®åº“  è¿æ¥çš„ç”¨æˆ· è¿æ¥çš„ä¸»æœºIP è®¤è¯æ–¹å¼<br>ä¾‹å¦‚ï¼š<br><span class="hljs-comment">#å…è®¸å›ºå®šipåœ°å€çš„replicaç”¨æˆ·ä»replicationæ•°æ®åº“è¿›è¡Œæ•°æ®åŒæ­¥</span><br>host replication replica 192.168.62.129/24 trust<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‰“å¼€postgresql.confæ–‡ä»¶</span><br>vim /var/lib/pgsql/14/data/postgresql.conf<br><br>listen_addresses = <span class="hljs-string">&#x27;*&#x27;</span>     <span class="hljs-comment">#ç›‘å¬çš„IPåœ°å€</span><br>max_connections = 1000      <span class="hljs-comment">#æœ€å¤§è¿æ¥æ•°ï¼Œä»åº“çš„max_connectionså¿…é¡»è¦å¤§äºä¸»åº“çš„</span><br>archive_mode = on      <span class="hljs-comment"># å…è®¸å½’æ¡£</span><br>archive_command = <span class="hljs-string">&#x27;cp %p /var/lib/pgsql/14/data/pg_archive/%f&#x27;</span> <span class="hljs-comment">## é€šè¿‡å‘½ä»¤æŒ‡å®šå½’æ¡£è·¯å¾„/  è·¯å¾„éœ€è¦å­˜åœ¨ï¼Œä¸å­˜åœ¨æ—¥å¿—å°†æŠ¥é”™</span><br>wal_level = replica    <span class="hljs-comment">#å†™å…¥WALçš„çº§åˆ«(minimal:ä¸èƒ½é€šè¿‡åŸºç¡€å¤‡ä»½å’Œwalæ—¥å¿—æ¢å¤æ•°æ®åº“; replica: æ”¯æŒwalå½’æ¡£å’Œå¤åˆ¶; logical: åœ¨replicaçº§åˆ«æ·»åŠ äº†é€»è¾‘è§£ç æ‰€éœ€çš„ä¿¡æ¯)</span><br>wal_log_hints = on <br>max_wal_senders = 32       <span class="hljs-comment"># å…è®¸æœ€å¤šçš„æµå¤åˆ¶è¿æ¥å‘é€æ•°é‡ï¼Œ æ ¹æ®ä»èŠ‚ç‚¹æ•°é‡æ¥è®¾å®š</span><br>hot_standby = on           <span class="hljs-comment">#çƒ­å¤‡æ¨¡å¼</span><br>archive_timeout = 3600  <span class="hljs-comment">#åœ¨æ­¤ä¹‹åå¼ºåˆ¶è¿›è¡Œæ—¥å¿—æ–‡ä»¶æ®µåˆ‡æ¢</span><br><br><span class="hljs-comment">#synchronous_commit = on    #å¼€å¯åŒæ­¥å¤åˆ¶</span><br><span class="hljs-comment">#wal_sender_timeout = 60s   #æµå¤åˆ¶ä¸»æœºå‘é€æ•°æ®çš„è¶…æ—¶æ—¶é—´</span><br><span class="hljs-comment">#å¦‚æœpostgresql.confä¸­çš„hot_standbyå‚æ•°è®¾ç½®ä¸ºonï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œå¹¶ä¸”æ•°æ®ç›®å½•ä¸­å­˜åœ¨Standby.signalæ–‡ä»¶ï¼Œåˆ™replication slaveå°†åœ¨â€œçƒ­å¤‡â€æ¨¡å¼ä¸‹è¿è¡Œã€‚</span><br></code></pre></td></tr></table></figure><h4 id="5-1-3ï¼‰é‡å¯ä¸»èŠ‚ç‚¹æœåŠ¡"><a href="#5-1-3ï¼‰é‡å¯ä¸»èŠ‚ç‚¹æœåŠ¡" class="headerlink" title="5.1.3ï¼‰é‡å¯ä¸»èŠ‚ç‚¹æœåŠ¡"></a>5.1.3ï¼‰é‡å¯ä¸»èŠ‚ç‚¹æœåŠ¡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart postgresql-14.service<br></code></pre></td></tr></table></figure><h3 id="5-2ã€é…ç½®PostgreSQLä»èŠ‚ç‚¹ï¼ˆä»èŠ‚ç‚¹çš„æ“ä½œå»ºè®®å…¨éƒ¨åœ¨postgresç”¨æˆ·ä¸‹è¿›è¡Œã€‚ï¼‰"><a href="#5-2ã€é…ç½®PostgreSQLä»èŠ‚ç‚¹ï¼ˆä»èŠ‚ç‚¹çš„æ“ä½œå»ºè®®å…¨éƒ¨åœ¨postgresç”¨æˆ·ä¸‹è¿›è¡Œã€‚ï¼‰" class="headerlink" title="5.2ã€é…ç½®PostgreSQLä»èŠ‚ç‚¹ï¼ˆä»èŠ‚ç‚¹çš„æ“ä½œå»ºè®®å…¨éƒ¨åœ¨postgresç”¨æˆ·ä¸‹è¿›è¡Œã€‚ï¼‰"></a>5.2ã€é…ç½®PostgreSQLä»èŠ‚ç‚¹ï¼ˆä»èŠ‚ç‚¹çš„æ“ä½œå»ºè®®å…¨éƒ¨åœ¨postgresç”¨æˆ·ä¸‹è¿›è¡Œã€‚ï¼‰</h3><h4 id="5-2-1ï¼‰åˆ‡æ¢postgresç”¨æˆ·"><a href="#5-2-1ï¼‰åˆ‡æ¢postgresç”¨æˆ·" class="headerlink" title="5.2.1ï¼‰åˆ‡æ¢postgresç”¨æˆ·"></a>5.2.1ï¼‰åˆ‡æ¢postgresç”¨æˆ·</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">su - postgres<br></code></pre></td></tr></table></figure><h4 id="5-2-2-å°†ä¸»èŠ‚ç‚¹çš„æ•°æ®è¿›è¡Œå¤‡ä»½åˆ°ä»èŠ‚ç‚¹"><a href="#5-2-2-å°†ä¸»èŠ‚ç‚¹çš„æ•°æ®è¿›è¡Œå¤‡ä»½åˆ°ä»èŠ‚ç‚¹" class="headerlink" title="5.2.2) å°†ä¸»èŠ‚ç‚¹çš„æ•°æ®è¿›è¡Œå¤‡ä»½åˆ°ä»èŠ‚ç‚¹"></a>5.2.2) å°†ä¸»èŠ‚ç‚¹çš„æ•°æ®è¿›è¡Œå¤‡ä»½åˆ°ä»èŠ‚ç‚¹</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">rm</span> -rf /var/lib/pgsql/14/data/*<br><br><span class="hljs-comment">#å¤åˆ¶åä»èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ä¼šå’Œä¸»èŠ‚ç‚¹çš„ä¸€æ ·ï¼Œå¹¶ä¸”ä¸€å¹¶å¤åˆ¶çš„è¿˜æœ‰æ•°æ®åº“æ–‡ä»¶ï¼Œé‡Œé¢çš„æ•°æ®ä¹Ÿä¸€æ ·ï¼Œæ„å‘³ç€ä¸»èŠ‚ç‚¹æœ‰ä»€ä¹ˆç”¨æˆ·æ•°æ®ä»èŠ‚ç‚¹ä¹Ÿæœ‰</span><br>pg_basebackup -h 192.168.62.129 -D /var/lib/pgsql/14/data -U replica -P -v  -R -X stream -C -S pgstandby1 <br><br>passwd&gt;replica123<br>å‚æ•°è¯¦è§£ï¼š<br>-h â€“æŒ‡å®šä½œä¸ºä¸»æœåŠ¡å™¨çš„ä¸»æœºã€‚<br>-D â€“æŒ‡å®šæ•°æ®ç›®å½•ã€‚<br>-U â€“æŒ‡å®šè¿æ¥ç”¨æˆ·ã€‚<br>-P â€“å¯ç”¨è¿›åº¦æŠ¥å‘Šã€‚<br>-v â€“å¯ç”¨è¯¦ç»†æ¨¡å¼ã€‚<br>-R â€“å¯ç”¨æ¢å¤é…ç½®çš„åˆ›å»ºï¼šåˆ›å»ºä¸€ä¸ªstandby.signalæ–‡ä»¶ï¼Œå¹¶å°†è¿æ¥è®¾ç½®é™„åŠ åˆ°æ•°æ®ç›®å½•ä¸‹çš„postgresql.auto.confã€‚<br>-X â€“ç”¨äºåœ¨å¤‡ä»½ä¸­åŒ…æ‹¬æ‰€éœ€çš„é¢„å†™æ—¥å¿—æ–‡ä»¶ï¼ˆWALæ–‡ä»¶ï¼‰ã€‚æµçš„å€¼è¡¨ç¤ºåœ¨åˆ›å»ºå¤‡ä»½æ—¶æµå¼ä¼ è¾“WALã€‚<br>-C â€“åœ¨å¼€å§‹å¤‡ä»½ä¹‹å‰ï¼Œå…è®¸åˆ›å»ºç”±-Sé€‰é¡¹å‘½åçš„å¤åˆ¶æ’æ§½ã€‚<br>-S â€“æŒ‡å®šå¤åˆ¶æ’æ§½åç§°ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¤‡ä»½è¿‡ç¨‹å®Œæˆåï¼Œä¼šåœ¨dataç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªstandby.signalï¼Œå¹¶å°†primary_conninfoå†™å…¥postgresql.auto.conf</span><br><span class="hljs-built_in">cat</span> /var/lib/pgsql/14/data/postgresql.auto.conf <br><span class="hljs-comment">#è¾“å‡ºä¿¡æ¯ï¼š</span><br><span class="hljs-comment"># Do not edit this file manually!</span><br><span class="hljs-comment"># It will be overwritten by the ALTER SYSTEM command.</span><br>primary_conninfo = <span class="hljs-string">&#x27;user=replica passfile=&#x27;</span><span class="hljs-string">&#x27;/var/lib/pgsql/.pgpass&#x27;</span><span class="hljs-string">&#x27; channel_binding=prefer host=192.168.62.129 port=5432 sslmode=prefer sslcompression=0 sslsni=1 ssl_min_protocol_version=TLSv1.2 gssencmode=prefer krbsrvname=postgres target_session_attrs=any&#x27;</span><br>primary_slot_name = <span class="hljs-string">&#x27;pgstandby1&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="5-2-3ï¼‰å¯åŠ¨ä»èŠ‚ç‚¹"><a href="#5-2-3ï¼‰å¯åŠ¨ä»èŠ‚ç‚¹" class="headerlink" title="5.2.3ï¼‰å¯åŠ¨ä»èŠ‚ç‚¹"></a>5.2.3ï¼‰å¯åŠ¨ä»èŠ‚ç‚¹</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start postgresql-14<br></code></pre></td></tr></table></figure><h3 id="5-3ã€æŸ¥çœ‹ä¸»ä»ä¿¡æ¯"><a href="#5-3ã€æŸ¥çœ‹ä¸»ä»ä¿¡æ¯" class="headerlink" title="5.3ã€æŸ¥çœ‹ä¸»ä»ä¿¡æ¯"></a>5.3ã€æŸ¥çœ‹ä¸»ä»ä¿¡æ¯</h3><h4 id="5-3-1ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å¤åˆ¶æ’æ§½-ä¸»èŠ‚ç‚¹æ‰§è¡Œ"><a href="#5-3-1ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å¤åˆ¶æ’æ§½-ä¸»èŠ‚ç‚¹æ‰§è¡Œ" class="headerlink" title="5.3.1ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å¤åˆ¶æ’æ§½(ä¸»èŠ‚ç‚¹æ‰§è¡Œ)"></a>5.3.1ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å¤åˆ¶æ’æ§½(ä¸»èŠ‚ç‚¹æ‰§è¡Œ)</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">su - postgres<br>psql -c <span class="hljs-string">&quot;SELECT * FROM pg_replication_slots;&quot;</span><br>psql -c <span class="hljs-string">&#x27;select client_addr,sync_state from pg_stat_replication;&#x27;</span><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><h4 id="5-3-2ï¼‰æŸ¥çœ‹ä»èŠ‚ç‚¹æ¥æ”¶çŠ¶æ€ï¼š-æ­¤ä¿¡æ¯åªæœ‰ä»èŠ‚ç‚¹æ‰ä¼šæœ‰"><a href="#5-3-2ï¼‰æŸ¥çœ‹ä»èŠ‚ç‚¹æ¥æ”¶çŠ¶æ€ï¼š-æ­¤ä¿¡æ¯åªæœ‰ä»èŠ‚ç‚¹æ‰ä¼šæœ‰" class="headerlink" title="5.3.2ï¼‰æŸ¥çœ‹ä»èŠ‚ç‚¹æ¥æ”¶çŠ¶æ€ï¼š(#æ­¤ä¿¡æ¯åªæœ‰ä»èŠ‚ç‚¹æ‰ä¼šæœ‰)"></a>5.3.2ï¼‰æŸ¥çœ‹ä»èŠ‚ç‚¹æ¥æ”¶çŠ¶æ€ï¼š(#æ­¤ä¿¡æ¯åªæœ‰ä»èŠ‚ç‚¹æ‰ä¼šæœ‰)</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">su - postgres<br>psql -c <span class="hljs-string">&quot;\x&quot;</span> -c <span class="hljs-string">&quot;SELECT * FROM pg_stat_wal_receiver;&quot;</span><br><br></code></pre></td></tr></table></figure><h4 id="5-3-3ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å‘é€çŠ¶æ€ï¼š-æ­¤ä¿¡æ¯åªæœ‰ä¸»èŠ‚ç‚¹æ‰ä¼šæœ‰"><a href="#5-3-3ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å‘é€çŠ¶æ€ï¼š-æ­¤ä¿¡æ¯åªæœ‰ä¸»èŠ‚ç‚¹æ‰ä¼šæœ‰" class="headerlink" title="5.3.3ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å‘é€çŠ¶æ€ï¼š(æ­¤ä¿¡æ¯åªæœ‰ä¸»èŠ‚ç‚¹æ‰ä¼šæœ‰)"></a>5.3.3ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å‘é€çŠ¶æ€ï¼š(æ­¤ä¿¡æ¯åªæœ‰ä¸»èŠ‚ç‚¹æ‰ä¼šæœ‰)</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">su - postgres<br>psql -c <span class="hljs-string">&quot;\x&quot;</span> -c <span class="hljs-string">&quot;SELECT * FROM pg_stat_replication;&quot;</span><br></code></pre></td></tr></table></figure><h3 id="5-4ã€è¯»å†™æµ‹è¯•"><a href="#5-4ã€è¯»å†™æµ‹è¯•" class="headerlink" title="5.4ã€è¯»å†™æµ‹è¯•"></a>5.4ã€è¯»å†™æµ‹è¯•</h3><h4 id="5-4-1ï¼‰åœ¨ä¸»èŠ‚ç‚¹å†™æ•°æ®ï¼Œä»èŠ‚ç‚¹è¯»æ•°æ®ã€‚"><a href="#5-4-1ï¼‰åœ¨ä¸»èŠ‚ç‚¹å†™æ•°æ®ï¼Œä»èŠ‚ç‚¹è¯»æ•°æ®ã€‚" class="headerlink" title="5.4.1ï¼‰åœ¨ä¸»èŠ‚ç‚¹å†™æ•°æ®ï¼Œä»èŠ‚ç‚¹è¯»æ•°æ®ã€‚"></a>5.4.1ï¼‰åœ¨ä¸»èŠ‚ç‚¹å†™æ•°æ®ï¼Œä»èŠ‚ç‚¹è¯»æ•°æ®ã€‚</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">create database <span class="hljs-built_in">test</span>;<br>\l<br></code></pre></td></tr></table></figure><h4 id="5-4-2ï¼‰åœ¨ä»èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹åˆ›å»ºä¹‹åçš„æ•°æ®åº“ã€‚å¯ä»¥çœ‹è§ï¼Œæ•°æ®åº“åŒæ­¥äº†ã€‚"><a href="#5-4-2ï¼‰åœ¨ä»èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹åˆ›å»ºä¹‹åçš„æ•°æ®åº“ã€‚å¯ä»¥çœ‹è§ï¼Œæ•°æ®åº“åŒæ­¥äº†ã€‚" class="headerlink" title="5.4.2ï¼‰åœ¨ä»èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹åˆ›å»ºä¹‹åçš„æ•°æ®åº“ã€‚å¯ä»¥çœ‹è§ï¼Œæ•°æ®åº“åŒæ­¥äº†ã€‚"></a>5.4.2ï¼‰åœ¨ä»èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹åˆ›å»ºä¹‹åçš„æ•°æ®åº“ã€‚å¯ä»¥çœ‹è§ï¼Œæ•°æ®åº“åŒæ­¥äº†ã€‚</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">\l<br></code></pre></td></tr></table></figure><h2 id="å…­ã€åˆ›å»ºæ•°æ®åº“Keepalived"><a href="#å…­ã€åˆ›å»ºæ•°æ®åº“Keepalived" class="headerlink" title="å…­ã€åˆ›å»ºæ•°æ®åº“Keepalived"></a>å…­ã€åˆ›å»ºæ•°æ®åº“Keepalived</h2><p><strong>åˆ›å»ºæ•°æ®åº“Keepalivedï¼Œå¹¶ä¸”åˆ›å»ºè¡¨æ¢æµ‹è¡¨sr_delayï¼Œåç»­Keepalivedæ¢æµ‹ï¼Œåˆ·æ–°sr_delayè¡¨çš„last_aliveå­—æ®µä¸ºå½“å‰æ¢æµ‹æ—¶é—´ã€‚è¿™å¼ è¡¨ç”¨æ¥åˆ¤æ–­ä¸»å¤‡å»¶è¿Ÿæƒ…å†µï¼Œæ•°æ®åº“æ•…éšœåˆ‡æ¢æ—¶ä¼šç”¨åˆ°è¿™å¼ è¡¨ã€‚</strong></p><h3 id="6-1ã€åˆ›å»ºkeepalivedæ•°æ®åº“ã€è¡¨ã€è´¦å·å¯†ç ã€‚ï¼ˆä¸»èŠ‚ç‚¹ä¸Šæ“ä½œï¼Œä¼šåŒæ­¥ï¼‰"><a href="#6-1ã€åˆ›å»ºkeepalivedæ•°æ®åº“ã€è¡¨ã€è´¦å·å¯†ç ã€‚ï¼ˆä¸»èŠ‚ç‚¹ä¸Šæ“ä½œï¼Œä¼šåŒæ­¥ï¼‰" class="headerlink" title="6.1ã€åˆ›å»ºkeepalivedæ•°æ®åº“ã€è¡¨ã€è´¦å·å¯†ç ã€‚ï¼ˆä¸»èŠ‚ç‚¹ä¸Šæ“ä½œï¼Œä¼šåŒæ­¥ï¼‰"></a>6.1ã€åˆ›å»ºkeepalivedæ•°æ®åº“ã€è¡¨ã€è´¦å·å¯†ç ã€‚ï¼ˆä¸»èŠ‚ç‚¹ä¸Šæ“ä½œï¼Œä¼šåŒæ­¥ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ›å»ºç”¨æˆ·å¹¶è®¾ç½®å¯†ç </span><br>create user keepalived password <span class="hljs-string">&#x27;123qwert&#x27;</span> CONNECTION LIMIT 4 ;<br><br><span class="hljs-comment">#åˆ›å»ºæ•°æ®åº“</span><br>create database keepalived owner keepalived;<br><br><span class="hljs-comment">#è¿æ¥åˆ°keepalivedæ•°æ®åº“</span><br>\c keepalived keepalived<br><br><span class="hljs-comment">#åˆ›å»ºæ¢æµ‹è¡¨sr_delay</span><br>create table sr_delay(<span class="hljs-built_in">id</span> int4, last_alive timestamp(0) without time zone);<br></code></pre></td></tr></table></figure><h3 id="6-2ã€è®¾ç½®sr-delayè¡¨"><a href="#6-2ã€è®¾ç½®sr-delayè¡¨" class="headerlink" title="6.2ã€è®¾ç½®sr_delayè¡¨"></a>6.2ã€è®¾ç½®sr_delayè¡¨</h3><p><strong>åªå…è®¸å†™å…¥ä¸€æ¡è®°å½•å¹¶ä¸”ä¸å…è®¸åˆ é™¤æ­¤è¡¨æ•°æ®ï¼Œé€šè¿‡è§¦å‘å™¨å®ç°ã€‚åˆ›å»ºè§¦å‘å™¨å‡½æ•°</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è®¾ç½®è§„åˆ™</span><br>CREATE FUNCTION cannt_delete () <br>RETURNS trigger <br>LANGUAGE plpgsql AS $$ <br>BEGIN <br>RAISE EXCEPTION <span class="hljs-string">&#x27;Table sr_delay can not delete !&#x27;</span>;<br>END; <br>$$;<br><br><span class="hljs-comment">#åˆ›å»ºè§¦å‘å™¨å‡½æ•°</span><br>CREATE TRIGGER trigger_sr_delay_del <br>BEFORE DELETE ON sr_delay <br>FOR EACH ROW EXECUTE PROCEDURE cannt_delete() ; <br>CREATE TRIGGER trigger_sr_delay_tru BEFORE TRUNCATE ON sr_delay FOR STATEMENT EXECUTE PROCEDURE cannt_delete() ;<br><br>æ’å…¥æ•°æ®<br>INSERT INTO sr_delay VALUES(1,now()) ;<br><br></code></pre></td></tr></table></figure><h2 id="ä¸ƒã€é…ç½®Keepalived"><a href="#ä¸ƒã€é…ç½®Keepalived" class="headerlink" title="ä¸ƒã€é…ç½®Keepalived"></a>ä¸ƒã€é…ç½®Keepalived</h2><p>åˆ›å»ºæ‰€ä¼šç”¨åˆ°çš„ç›®å½•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#keepaliveæ‰€ç”¨çš„çš„è„šæœ¬å­˜æ”¾è·¯å¾„</span><br><span class="hljs-built_in">mkdir</span> -p /etc/keepalived/scripts<br><br><span class="hljs-comment">#åæ–‡æ‰§è¡Œè„šæœ¬è¿‡ç¨‹ä¸­è®°å½•çš„æ—¥å¿—æ–‡ä»¶å­˜æ”¾è·¯å¾„</span><br><span class="hljs-built_in">mkdir</span> -p /etc/keepalived/log<br><br><span class="hljs-comment">#åˆ›å»ºå½’æ¡£æ–‡ä»¶å¤¹</span><br><span class="hljs-built_in">mkdir</span> -p /var/lib/pgsql/14/data/pg_archive<br><span class="hljs-built_in">chown</span> postgres:postgres /var/lib/pgsql/14/data/pg_archive<br></code></pre></td></tr></table></figure><h3 id="7-1ã€é…ç½®keepalive-confæ–‡ä»¶"><a href="#7-1ã€é…ç½®keepalive-confæ–‡ä»¶" class="headerlink" title="7.1ã€é…ç½®keepalive.confæ–‡ä»¶"></a>7.1ã€é…ç½®keepalive.confæ–‡ä»¶</h3><p>ä»¥ä¸‹æ˜¯Keepalivedä¸»èŠ‚ç‚¹çš„é…ç½®</p><p>å¤‡æ³¨ï¼šKeepalivedå¤‡èŠ‚ç‚¹åªéœ€è¦priorityå‚æ•°ä¸º99ï¼Œrouter_idæ”¹æˆä¸»æœºåï¼ˆpg-2)å…¶ä½™å‚æ•°é…ç½®ä¸€æ ·ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/keepalived/keepalived.conf<br><br>! Configuration File <span class="hljs-keyword">for</span> keepalived<br>global_defs &#123;<br><span class="hljs-comment">## é‚®ä»¶é€šçŸ¥ä¿¡æ¯</span><br><span class="hljs-comment">#  notification_email &#123;</span><br><span class="hljs-comment">#    # å®šä¹‰æ”¶ä»¶äºº</span><br><span class="hljs-comment">#    1962821461@qq.com</span><br><span class="hljs-comment">#  &#125;</span><br><span class="hljs-comment">#  # SMTPæœåŠ¡å™¨åœ°å€</span><br><span class="hljs-comment">#  smtp_server 192.168.62.129</span><br><span class="hljs-comment">#  smtp_connect_timeout 30</span><br>    <span class="hljs-comment">#è·¯ç”±å™¨æ ‡è¯†ï¼Œä¸€èˆ¬ä¸ç”¨æ”¹ï¼Œä¹Ÿå¯ä»¥å†™æˆæ¯ä¸ªä¸»æœºè‡ªå·±çš„ä¸»æœºå</span><br>   router_id pg-1<br>&#125;<br><br><span class="hljs-comment"># å®šä¹‰ç”¨äºå®ä¾‹æ‰§è¡Œçš„è„šæœ¬å†…å®¹ï¼Œæ¯”å¦‚å¯ä»¥åœ¨çº¿é™ä½ä¼˜å…ˆçº§ï¼Œç”¨äºå¼ºåˆ¶åˆ‡æ¢</span><br>vrrp_script check_pg_alived &#123;<br>        script <span class="hljs-string">&quot;/etc/keepalived/scripts/check_pg.sh&quot;</span><br>        interval 5<br>        fall 3 <span class="hljs-comment"># require 3 failures for KO</span><br>&#125;<br><br><span class="hljs-comment">#virtual_server 192.168.62.123 5432 &#123;</span><br><span class="hljs-comment">#    delay_loop 6 # æ¯ä¸ª6ç§’æŸ¥è¯¢RealserverçŠ¶æ€</span><br><span class="hljs-comment">#    lb_algo rr   # lvsç®—æ³•</span><br><span class="hljs-comment">#    lb_kind DR   # Direct Route</span><br><span class="hljs-comment">#    persistence_timeout 0 # åŒä¸€IPé“¾æ¥60ç§’å†…è¢«åˆ†é…åˆ°åŒä¸€å°realserver</span><br><span class="hljs-comment">#    protocol TCP            #ç”¨tcpåè®®æ£€æŸ¥realserverçŠ¶æ€</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    real_server 192.168.62.129 5432&#123;</span><br><span class="hljs-comment">#        weight 100</span><br><span class="hljs-comment">#        TCP_CHECK &#123;</span><br><span class="hljs-comment">#            connect_timeout 5 #10ç§’é’Ÿæ— å“åº”è¶…æ—¶</span><br><span class="hljs-comment">#            nb_get_retry 3</span><br><span class="hljs-comment">#            delay_before_retry 3</span><br><span class="hljs-comment">#            connect_port 5432</span><br><span class="hljs-comment">#        &#125;</span><br><span class="hljs-comment">#    &#125;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    real_server 192.168.62.130 5432&#123;</span><br><span class="hljs-comment">#        weight 100</span><br><span class="hljs-comment">#        TCP_CHECK &#123;</span><br><span class="hljs-comment">#            connect_timeout 5 #10ç§’é’Ÿæ— å“åº”è¶…æ—¶</span><br><span class="hljs-comment">#            nb_get_retry 3</span><br><span class="hljs-comment">#            delay_before_retry 3</span><br><span class="hljs-comment">#            connect_port 5432</span><br><span class="hljs-comment">#        &#125;</span><br><span class="hljs-comment">#    &#125;</span><br><span class="hljs-comment">#&#125;</span><br><br><span class="hljs-comment"># ä¸€ä¸ªvrrp_instanceå°±æ˜¯å®šä¹‰ä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨çš„ï¼Œå®ä¾‹åç§°</span><br>vrrp_instance VI_1 &#123;<br>  <span class="hljs-comment"># å®šä¹‰åˆå§‹çŠ¶æ€</span><br>    state BACKUP<br>    <span class="hljs-comment">#éæŠ¢å æ¨¡å¼</span><br>    nopreempt<br>    <span class="hljs-comment"># å·¥ä½œæ¥å£ï¼ˆç½‘å¡åï¼‰ï¼Œé€šå‘Šé€‰ä¸¾ä½¿ç”¨å“ªä¸ªæ¥å£è¿›è¡Œ</span><br>    interface ens33<br>    <span class="hljs-comment"># è™šæ‹Ÿè·¯ç”±IDï¼Œå¦‚æœæ˜¯ä¸€ç»„è™šæ‹Ÿè·¯ç”±å°±å®šä¹‰ä¸€ä¸ªIDï¼Œå¦‚æœæ˜¯å¤šç»„å°±è¦å®šä¹‰å¤šä¸ªï¼Œè€Œä¸”è¿™ä¸ªè™šæ‹Ÿ</span><br>    <span class="hljs-comment"># IDè¿˜æ˜¯è™šæ‹ŸMACæœ€åä¸€æ®µåœ°å€çš„ä¿¡æ¯ï¼Œå–å€¼èŒƒå›´0-255</span><br>    virtual_router_id 51<br>    <span class="hljs-comment">#æƒé‡ å¤‡åº“çš„priorityå°äºä¸»åº“çš„ï¼ŒåŒæ—¶å¤§äºä¸»åº“priority + weight çš„å€¼</span><br>    priority 100<br>    <span class="hljs-comment"># é€šä¿¡è®¤è¯æœºåˆ¶ï¼Œè¿™é‡Œæ˜¯æ˜æ–‡è®¤è¯è¿˜æœ‰ä¸€ç§æ˜¯åŠ å¯†è®¤è¯</span><br>    advert_int 1<br>    authentication &#123;<br>        auth_type PASS<br>        auth_pass abcdefgh<br>    &#125;<br>    <span class="hljs-comment"># è¿½è¸ªè„šæœ¬ï¼Œé€šå¸¸ç”¨äºå»æ‰§è¡Œä¸Šé¢çš„vrrp_scriptå®šä¹‰çš„è„šæœ¬å†…å®¹</span><br>    track_script &#123;<br>        check_pg_alived<br>    &#125;<br>  <span class="hljs-comment"># è®¾ç½®è™šæ‹ŸVIPåœ°å€</span><br>    virtual_ipaddress &#123;<br>        192.168.62.123<br>    &#125;<br>   smtp_alert<br>   <span class="hljs-comment"># å¦‚æœä¸»æœºçŠ¶æ€å˜æˆMaster|Backup|Faultä¹‹åä¼šå»æ‰§è¡Œçš„é€šçŸ¥è„šæœ¬ï¼Œè„šæœ¬è¦è‡ªå·±å†™</span><br>      notify_master <span class="hljs-string">&quot;/etc/keepalived/scripts/failover.sh&quot;</span><br>      notify_fault <span class="hljs-string">&quot;/etc/keepalived/scripts/fault.sh&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="7-2ã€-æ•°æ®åº“ç›‘æ§è„šæœ¬ï¼ˆcheck-pg-shï¼‰"><a href="#7-2ã€-æ•°æ®åº“ç›‘æ§è„šæœ¬ï¼ˆcheck-pg-shï¼‰" class="headerlink" title="7.2ã€ æ•°æ®åº“ç›‘æ§è„šæœ¬ï¼ˆcheck_pg.shï¼‰"></a>7.2ã€ æ•°æ®åº“ç›‘æ§è„šæœ¬ï¼ˆcheck_pg.shï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/keepalived/scripts/check_pg.sh<br><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#æ•°æ®åº“ã€ç«¯å£ã€ç”¨æˆ·åã€æ•°æ®åº“å¯†ç ã€æ—¥å¿—æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-built_in">export</span> PGDATABASE=keepalived<br><span class="hljs-built_in">export</span> PGPORT=5432<br><span class="hljs-built_in">export</span> PGUSER=keepalived<br><span class="hljs-built_in">export</span> PGHOME=/usr/pgsql-14/bin<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$PGHOME</span><br>pgpwd=<span class="hljs-string">&#x27;123qwert&#x27;</span><br><span class="hljs-built_in">export</span> PGPASSWORD=<span class="hljs-variable">$pgpwd</span><br><span class="hljs-built_in">export</span> PGMIP=127.0.0.1<br>LOGFILE=/etc/keepalived/log/pg_status.log<br>keeplognums=30000<br><br>SQL1=<span class="hljs-string">&#x27;SELECT pg_is_in_recovery from pg_is_in_recovery();&#x27;</span><br><span class="hljs-comment">#SQL2=&#x27;update sr_delay set sr_date = now() where id =1;&#x27;</span><br>SQL2=<span class="hljs-string">&#x27;UPDATE sr_delay SET last_alive= now();&#x27;</span><br>SQL3=<span class="hljs-string">&#x27;SELECT 1;&#x27;</span><br><br><span class="hljs-comment">#pg_port_status=`lsof -i :$PGPORT | grep LISTEN | wc -l`</span><br><span class="hljs-comment">#pg_port_status=`ps -ef | grep LISTEN | wc -l`</span><br><span class="hljs-comment">#if [ $pg_port_status -lt 1 ];then</span><br><span class="hljs-comment">#    echo -e `date +&quot;%F %T&quot;` &quot;ERRORï¼špostgreSQL æ²¡æœ‰è¿è¡Œï¼Œè¯·æ£€æŸ¥ postgreSQL æœåŠ¡å™¨çŠ¶æ€ï¼&quot; &gt;&gt; $LOGFILE</span><br><span class="hljs-comment">#    exit 1</span><br><span class="hljs-comment">#fi</span><br><br><span class="hljs-comment"># å¤‡åº“ä¸æ£€æŸ¥å­˜æ´»,ä¸»åº“æ›´æ–°çŠ¶æ€</span><br>db_role=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$SQL1</span>  | <span class="hljs-variable">$PGHOME</span>/psql  -d <span class="hljs-variable">$PGDATABASE</span> -U <span class="hljs-variable">$PGUSER</span> -At -w`<br><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$db_role</span> == <span class="hljs-string">&#x27;t&#x27;</span> ];<span class="hljs-keyword">then</span><br>   <span class="hljs-built_in">echo</span> -e `<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%F %T&quot;</span>` <span class="hljs-string">&quot;æ³¨æ„ï¼šå½“å‰æ•°æ®åº“ä¸ºstandby DBï¼&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGFILE</span><br>   <span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">#åˆ¤æ–­ä¸»åº“æ˜¯å¦å¯ç”¨</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$SQL3</span> | psql -p <span class="hljs-variable">$PGPORT</span> -d <span class="hljs-variable">$PGDATABASE</span> -U <span class="hljs-variable">$PGUSER</span> -At -w<br><span class="hljs-keyword">if</span> [ $? -eq 0 ] ;<span class="hljs-keyword">then</span><br>   <span class="hljs-comment">#å½“ä¸»åº“å¯ç”¨æ—¶ï¼Œä¸»åº“æ›´æ–°sr_delay è¡¨</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-variable">$SQL2</span> | psql -p <span class="hljs-variable">$PGPORT</span> -d <span class="hljs-variable">$PGDATABASE</span> -U <span class="hljs-variable">$PGUSER</span> -At -w<br>   <span class="hljs-built_in">echo</span> -e `<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%F %T&quot;</span>` <span class="hljs-string">&quot;Successï¼šæ›´æ–°master sr_delayæˆåŠŸï¼&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGFILE</span><br>   <span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">else</span><br>   <span class="hljs-built_in">echo</span> -e `<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%F %T&quot;</span>` <span class="hljs-string">&quot;Error:æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Ÿ&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGFILE</span><br>   <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">#æ—¥å¿—ä¿ç•™ keeplognums è¡Œ</span><br><span class="hljs-keyword">if</span> [ ! -f <span class="hljs-variable">$&#123;MONITOR_LOG&#125;</span> ] ;<span class="hljs-keyword">then</span> <span class="hljs-built_in">touch</span> <span class="hljs-variable">$&#123;MONITOR_LOG&#125;</span>;<span class="hljs-keyword">fi</span> <br>lognums=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$&#123;MONITOR_LOG&#125;</span> |<span class="hljs-built_in">wc</span> -l`<br>catnum=$((<span class="hljs-variable">$&#123;lognums&#125;</span> -<span class="hljs-variable">$&#123;keeplognums&#125;</span>))<br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$lognums</span> -gt <span class="hljs-variable">$&#123;keeplognums&#125;</span> ]] ; <span class="hljs-keyword">then</span> sed -i <span class="hljs-string">&quot;1,<span class="hljs-variable">$&#123;catnum&#125;</span>d&quot;</span> <span class="hljs-variable">$&#123;MONITOR_LOG&#125;</span>; <span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h3 id="7-3ã€å½“ä¸»åº“æŒ‚æ‰åï¼Œåˆ‡æ¢è„šæœ¬-failover-sh"><a href="#7-3ã€å½“ä¸»åº“æŒ‚æ‰åï¼Œåˆ‡æ¢è„šæœ¬-failover-sh" class="headerlink" title="7.3ã€å½“ä¸»åº“æŒ‚æ‰åï¼Œåˆ‡æ¢è„šæœ¬ failover.sh"></a>7.3ã€å½“ä¸»åº“æŒ‚æ‰åï¼Œåˆ‡æ¢è„šæœ¬ failover.sh</h3><p>æ­¤è„šæœ¬æ¯éš”10ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œé¢‘ç‡ç”±keepalived.confé…ç½®æ–‡ä»¶ä¸­intervalå‚æ•°è®¾ç½®ï¼Œ è„šæœ¬ä¸»è¦ä½œç”¨ä¸ºï¼šæ£€æµ‹ä¸»åº“æ˜¯å¦å­˜æ´»ã€æ›´æ–°sr_delayè¡¨last_aliveå­—æ®µä¸ºå½“å‰æ¢æµ‹æ—¶é—´ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/keepalived/scripts/failover.sh<br><br><span class="hljs-comment">#!/bin/bash </span><br><span class="hljs-built_in">export</span> PGPORT=5432 <br><span class="hljs-built_in">export</span> PGUSER=keepalived <br><span class="hljs-built_in">export</span> PG_OS_USER=postgres <br><span class="hljs-built_in">export</span> PGDBNAME=keepalived <br><span class="hljs-built_in">export</span> LANG=en_US.UTF-8<br><span class="hljs-built_in">export</span> PGPATH=/usr/pgsql-14/bin/ <br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$PGPATH</span> <br><span class="hljs-built_in">export</span> PGMIP=127.0.0.1 <br>LOGFILE=<span class="hljs-string">&#x27;/etc/keepalived/log/failover.log&#x27;</span><br><span class="hljs-comment"># ä¸»å¤‡æ•°æ®åº“åŒæ­¥æ—¶å»¶ï¼Œå•ä½ä¸ºç§’ </span><br>sr_allowed_delay_time=100<br><br>SQL1=<span class="hljs-string">&#x27;select pg_is_in_recovery from pg_is_in_recovery();&#x27;</span> <br>SQL2=<span class="hljs-string">&quot;select count(1) as delay_time from sr_delay where now()&lt;(last_alive + interval &#x27;<span class="hljs-variable">$&#123;sr_allowed_delay_time&#125;</span> seconds&#x27;);&quot;</span><br><span class="hljs-comment">#SQL2=&quot;select count(1) as delay_time from sr_delay where now()&lt;(last_alive + interval &#x27;100 seconds&#x27;);&quot; </span><br><span class="hljs-built_in">sleep</span> <span class="hljs-variable">$sr_allowed_delay_time</span><br>db_role=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$SQL1</span> | psql -At -p <span class="hljs-variable">$PGPORT</span> -U <span class="hljs-variable">$PGUSER</span> -d <span class="hljs-variable">$PGDBNAME</span> -w` <br>db_sr_delaytime=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$SQL2</span> | psql -p <span class="hljs-variable">$PGPORT</span> -d <span class="hljs-variable">$PGDBNAME</span> -U <span class="hljs-variable">$PGUSER</span> -At -w` <br><span class="hljs-comment">#æ‰§è¡Œå‘½ä»¤ pg_ctl promote æ¿€æ´»å¤‡åº“</span><br>SWITCH_COMMAND=<span class="hljs-string">&#x27;/usr/pgsql-14/bin/pg_ctl promote -D /var/lib/pgsql/14/data/&#x27;</span> <br><span class="hljs-comment"># å¦‚æœä¸ºå¤‡åº“ï¼Œä¸”å»¶è¿Ÿå¤§äºæŒ‡å®šæ—¶é—´åˆ™åˆ‡æ¢ä¸ºä¸»åº“</span><br>f è¡¨ç¤ºä¸ºä¸»åº“<br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$&#123;db_role&#125;</span> == <span class="hljs-string">&#x27;f&#x27;</span> ];<br><span class="hljs-keyword">then</span> <br>  <span class="hljs-built_in">echo</span> -e `<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%F %T&quot;</span>` <span class="hljs-string">&quot;æ³¨æ„ï¼šå½“å‰postgreSQL DBä¸ºmasteræ•°æ®åº“ï¼Œä¸èƒ½åˆ‡æ¢ï¼&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGFILE</span> <br>  <span class="hljs-built_in">exit</span> 0 <br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$db_sr_delaytime</span> -gt 0 ];<br><span class="hljs-keyword">then</span> <br>  <span class="hljs-built_in">echo</span> -e `<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%F %T&quot;</span>` <span class="hljs-string">&quot;æ³¨æ„ï¼šå½“å‰ä¸»æ•°æ®åº“å¥åº·ï¼Œå¤‡ç”¨æ•°æ®åº“ä¸èƒ½åˆ‡æ¢ï¼&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGFILE</span> <br>  <span class="hljs-built_in">exit</span> 0 <br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [ !<span class="hljs-variable">$db_sr_delaytime</span> ];<br><span class="hljs-keyword">then</span> <br>  <span class="hljs-built_in">echo</span> -e `<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%F %T&quot;</span>` <span class="hljs-string">&quot;æ³¨æ„ï¼šå½“å‰æ•°æ®åº“ä¸ºstatndbyï¼Œå‡†å¤‡åˆ‡æ¢masteræ•°æ®åº“ï¼&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGFILE</span> <br>  su - <span class="hljs-variable">$PG_OS_USER</span> -c <span class="hljs-string">&quot;<span class="hljs-variable">$SWITCH_COMMAND</span>&quot;</span> <br><span class="hljs-keyword">elif</span> [ $? -eq 0 ];<br><span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> -e `<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%F %T&quot;</span>` <span class="hljs-string">&quot;successï¼šå½“å‰å¤‡åº“åˆ‡æ¢ä¸»PGåº“æˆåŠŸï¼&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGFILE</span> <br>  <span class="hljs-built_in">exit</span> 0 <br><span class="hljs-keyword">else</span> <br>  <span class="hljs-built_in">echo</span> -e `<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%F %T&quot;</span>` <span class="hljs-string">&quot;errorï¼šå¤‡åº“åˆ‡æ¢ä¸»PGåº“å¤±è´¥ï¼ï¼Œè¯·æŸ¥æ”¶ï¼&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGFILE</span> <br>  <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br></code></pre></td></tr></table></figure><h3 id="7-4ã€keepalived-è¿›å…¥é”™è¯¯çŠ¶æ€æ—¶æ‰§è¡Œçš„è„šæœ¬-fault-sh"><a href="#7-4ã€keepalived-è¿›å…¥é”™è¯¯çŠ¶æ€æ—¶æ‰§è¡Œçš„è„šæœ¬-fault-sh" class="headerlink" title="7.4ã€keepalived è¿›å…¥é”™è¯¯çŠ¶æ€æ—¶æ‰§è¡Œçš„è„šæœ¬ fault.sh"></a>7.4ã€keepalived è¿›å…¥é”™è¯¯çŠ¶æ€æ—¶æ‰§è¡Œçš„è„šæœ¬ fault.sh</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/keepalived/scripts/fault.sh<br><br><span class="hljs-comment">#!/bin/bash</span><br>LOGGFILE=/etc/keepalived/log/pg_db_fault.log<br>PGPORT=5432<br>PGMIP=192.168.62.129<br><span class="hljs-built_in">echo</span> -e `<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%F %T&quot;</span>` <span class="hljs-string">&quot;é”™è¯¯ï¼šç”±äºä¸»æ•°æ®åº“å‘ç”Ÿäº†ä¸€äº›æœªçŸ¥é—®é¢˜ï¼Œæ‰€ä»¥å…³é—­PostgreSQLæ•°æ®åº“ï¼&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGFILE</span><br><br><span class="hljs-comment">#PGCOUNT=`ps -ef|grep &#x27;/usr/pgsql-14/bin/postgres -D /var/lib/pgsql/14/data&#x27; |wc -l`</span><br><br><span class="hljs-comment">#if [ $PGCOUNT -gt 1 ];then</span><br><span class="hljs-comment">#  PGPID=&quot;`netstat -anp|grep $PGPORT |awk &#x27;&#123;printf $7&#125;&#x27;|cut -d/ -f1`&quot;</span><br><span class="hljs-comment">#  kill -9 $PGPID</span><br><span class="hljs-comment">#  echo -e `date +&quot;%F %T&quot;` &quot;ERRORï¼šç”±äºä¸»æ•°æ®åº“å‘ç”Ÿäº†ä¸€äº›æœªçŸ¥é—®é¢˜ï¼Œæ‰€ä»¥å…³é—­PostgreSQLæ•°æ®åº“ï¼&quot; &gt;&gt; $LOGFILE</span><br><span class="hljs-comment">#  exit 1</span><br><span class="hljs-comment">#fi</span><br><br>PGPID=<span class="hljs-string">&quot;`netstat -anp|grep <span class="hljs-variable">$PGPORT</span> |awk &#x27;&#123;printf <span class="hljs-variable">$7</span>&#125;&#x27;|cut -d/ -f1`&quot;</span><br>systemctl stop keepalived<br><br><span class="hljs-built_in">kill</span> -9 <span class="hljs-variable">$PGPID</span><br><span class="hljs-keyword">if</span> [ $? -eq 0 ];<span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> -e `<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%F %T&quot;</span>` <span class="hljs-string">&quot;ERRORï¼šç”±äºä¸»æ•°æ®åº“å‘ç”Ÿäº†ä¸€äº›æœªçŸ¥é—®é¢˜ï¼Œæ‰€ä»¥å…³é—­PostgreSQLæ•°æ®åº“ï¼&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGFILE</span><br>  systemctl stop keepalived <br>  <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h3 id="7-5ã€é…ç½®æƒé™å¹¶åˆ†å‘åˆ°å¤‡èŠ‚ç‚¹"><a href="#7-5ã€é…ç½®æƒé™å¹¶åˆ†å‘åˆ°å¤‡èŠ‚ç‚¹" class="headerlink" title="7.5ã€é…ç½®æƒé™å¹¶åˆ†å‘åˆ°å¤‡èŠ‚ç‚¹"></a>7.5ã€é…ç½®æƒé™å¹¶åˆ†å‘åˆ°å¤‡èŠ‚ç‚¹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">chmod</span> 755 /etc/keepalived/scripts/*<br><br>scp /etc/keepalived/scripts/* root@192.168.62.130:/etc/keepalived/scripts/<br></code></pre></td></tr></table></figure><h3 id="7-6ã€å¯åŠ¨keepalived"><a href="#7-6ã€å¯åŠ¨keepalived" class="headerlink" title="7.6ã€å¯åŠ¨keepalived"></a>7.6ã€å¯åŠ¨keepalived</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start keepalived<br>systemctl <span class="hljs-built_in">enable</span> keepalived<br>systemctl status keepalived<br></code></pre></td></tr></table></figure><h2 id="å…«ã€æµ‹è¯•ä¸»å¤‡æ˜¯å¦åˆ‡æ¢"><a href="#å…«ã€æµ‹è¯•ä¸»å¤‡æ˜¯å¦åˆ‡æ¢" class="headerlink" title="å…«ã€æµ‹è¯•ä¸»å¤‡æ˜¯å¦åˆ‡æ¢"></a>å…«ã€æµ‹è¯•ä¸»å¤‡æ˜¯å¦åˆ‡æ¢</h2><p><strong>æµ‹è¯•downæ‰ä¸»æœºåï¼ŒæŸ¥çœ‹å¤‡åº“æ˜¯å¦èƒ½å¤Ÿå†™å…¥æ•°æ®</strong></p><h3 id="8-1ã€åœ¨192-168-62-129ä¸Šåœæ‰æ•°æ®åº“"><a href="#8-1ã€åœ¨192-168-62-129ä¸Šåœæ‰æ•°æ®åº“" class="headerlink" title="8.1ã€åœ¨192.168.62.129ä¸Šåœæ‰æ•°æ®åº“"></a>8.1ã€åœ¨192.168.62.129ä¸Šåœæ‰æ•°æ®åº“</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl stop postgresql-14<br></code></pre></td></tr></table></figure><h3 id="8-2ã€æµ‹è¯•å¤‡åº“æ˜¯å¦èƒ½å¤Ÿå†™å…¥æ•°æ®"><a href="#8-2ã€æµ‹è¯•å¤‡åº“æ˜¯å¦èƒ½å¤Ÿå†™å…¥æ•°æ®" class="headerlink" title="8.2ã€æµ‹è¯•å¤‡åº“æ˜¯å¦èƒ½å¤Ÿå†™å…¥æ•°æ®"></a>8.2ã€æµ‹è¯•å¤‡åº“æ˜¯å¦èƒ½å¤Ÿå†™å…¥æ•°æ®</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æŸ¥çœ‹ipæ˜¯å¦åˆ‡æ¢</span><br>ip add | grep 192.128.62.123<br><br><span class="hljs-comment">#å¦‚æœæœ‰Navicatè¿æ¥å·¥å…·å¯ç›´æ¥æµ‹è¯•æ˜¯å¦èƒ½å¤Ÿè¿æ¥å¹¶å†™å…¥æ•°æ®ï¼Œæ²¡æœ‰çš„è¯æŒ‰ç…§ä¸‹è¿°æ­¥éª¤æµ‹è¯•æ˜¯å¦èƒ½å†™å…¥æ•°æ®ï¼ï¼ˆå› ä¸ºæ‰§è¡Œåˆ‡æ¢æ—¶éœ€è¦æ—¶é—´ï¼Œæ‰€ä»¥è¯·åœ¨downæœºåä¸‰åˆ†é’Ÿæµ‹è¯•æ˜¯å¦èƒ½å†™å…¥æ•°æ®ï¼‰</span><br><span class="hljs-comment">#å¯é€šè¿‡æŸ¥çœ‹/etc/keepalived/log/failover.logæ—¥å¿—åˆ¤æ–­æ˜¯å¦åˆ‡æ¢æˆåŠŸï¼</span><br><br><span class="hljs-comment">#æ— å·¥å…·æµ‹è¯•ï¼š</span><br><span class="hljs-comment">##åˆ‡æ¢å®Œæˆååœ¨130æœºå™¨ä¸Šï¼Œè¿æ¥æ•°æ®åº“</span><br><span class="hljs-comment">##åˆ›å»ºæµ‹è¯•è¡¨</span><br>CREATE TABLE <span class="hljs-built_in">test</span>(ID VARCHAR(20));<br><span class="hljs-comment">##æ’å…¥æµ‹è¯•æ•°æ®</span><br>INSERT INTO <span class="hljs-built_in">test</span>(ID) VALUES (<span class="hljs-string">&#x27;1234554321&#x27;</span>);<br><span class="hljs-comment">##æŸ¥è¯¢æ•°æ®æ˜¯å¦å†™å…¥</span><br>SELECT * from <span class="hljs-built_in">test</span>;<br><span class="hljs-comment">##åˆ é™¤æµ‹è¯•è¡¨</span><br>DROP TABLE IF EXISTS <span class="hljs-built_in">test</span>;<br><br></code></pre></td></tr></table></figure><h3 id="8-3ã€ä¿®å¤192-168-62-129"><a href="#8-3ã€ä¿®å¤192-168-62-129" class="headerlink" title="8.3ã€ä¿®å¤192.168.62.129"></a>8.3ã€ä¿®å¤192.168.62.129</h3><p>ä½¿ç”¨pg_rewind åŒæ­¥æ–°ä¸»åº“çš„æ•°æ®åˆ°åŸä¸»åº“ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">su - postgres<br><br>/usr/pgsql-14/bin/pg_rewind -R --target-pgdata <span class="hljs-string">&#x27;/var/lib/pgsql/14/data/&#x27;</span> --source-server <span class="hljs-string">&#x27;host=192.168.62.130 port=5432 user=postgres password=postgres dbname=postgres&#x27;</span><br><br></code></pre></td></tr></table></figure><p>å¦‚æœè¿™ä¸ªåœ°æ–¹å’±ä»¬çš„walæ—¥å¿—å·²ç»è¢«è¦†ç›–äº†äº†å¾ˆå¤šï¼Œé‚£ä¹ˆå°±éœ€è¦å°†æˆ‘ä»¬çš„å½’æ¡£å¤‡ä»½æ—¥å¿—&#x2F;pg_archive&#x2F;ç»™scpè¿‡æ¥<br>æ³¨æ„ï¼šéœ€è¦æ³¨æ„æ–°ä¸»å’Œå¤‡ä¸Šé¢TimeLineIDçš„å·®å¼‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">scp postgres@192.168.62.130:/var/lib/pgsql/14/data/pg_archive/00000002*  /var/lib/pgsql/14/data/pg_archive/<br></code></pre></td></tr></table></figure><p>å¯åŠ¨æ•°æ®åº“ï¼Œç„¶åæ£€æŸ¥ä¸»å¤‡æ˜¯å¦æ­£å¸¸</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start postgresql-14<br><br><span class="hljs-comment">#æ£€æŸ¥ä¸»å¤‡wal senderå’Œreceiveræ˜¯å¦æ­£å¸¸</span><br>ps axu |grep walreceiver<br><br>æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£å¸¸ï¼šæ ¹æ®5.3æ­¥éª¤æ¥è¿›è¡ŒæŸ¥çœ‹<br></code></pre></td></tr></table></figure><p>å¯åŠ¨Keepalivedï¼ŒæŸ¥çœ‹KeepalivedçŠ¶æ€</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl  start keepalived<br>systemctl status keepalived<br></code></pre></td></tr></table></figure><p><em><strong>å†æ¬¡åˆ‡æ¢æµ‹è¯•æ•°æ®æ˜¯å¦æ­£å¸¸</strong></em></p><h3 id="8-4ã€å†æ¬¡åˆ‡æ¢æµ‹è¯•"><a href="#8-4ã€å†æ¬¡åˆ‡æ¢æµ‹è¯•" class="headerlink" title="8.4ã€å†æ¬¡åˆ‡æ¢æµ‹è¯•"></a>8.4ã€å†æ¬¡åˆ‡æ¢æµ‹è¯•</h3><p>åœ¨åšåˆ‡æ¢å‰ï¼Œå…ˆè¦æ£€æŸ¥192.168.62.129å’Œ192.168.62.130ä¸Šé¢çš„Keepalivedæ­£å¸¸ä»¥åŠvipå’Œä¸»ä»æ­£å¸¸ï¼Œåœ¨192.168.62.130ä¸Šåœæ‰æ•°æ®åº“:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">192.168.62.130ä¸Šåœæ‰æ•°æ®åº“:<br><br>systemctl stop postgresql-14<br></code></pre></td></tr></table></figure><h3 id="8-5ã€æŸ¥çœ‹æ˜¯å¦åˆ‡æ¢æˆåŠŸï¼Œæµ‹è¯•æ˜¯å¦èƒ½å¤Ÿå†™å…¥æ•°æ®"><a href="#8-5ã€æŸ¥çœ‹æ˜¯å¦åˆ‡æ¢æˆåŠŸï¼Œæµ‹è¯•æ˜¯å¦èƒ½å¤Ÿå†™å…¥æ•°æ®" class="headerlink" title="8.5ã€æŸ¥çœ‹æ˜¯å¦åˆ‡æ¢æˆåŠŸï¼Œæµ‹è¯•æ˜¯å¦èƒ½å¤Ÿå†™å…¥æ•°æ®"></a>8.5ã€æŸ¥çœ‹æ˜¯å¦åˆ‡æ¢æˆåŠŸï¼Œæµ‹è¯•æ˜¯å¦èƒ½å¤Ÿå†™å…¥æ•°æ®</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æŸ¥çœ‹ipæ˜¯å¦åˆ‡æ¢</span><br>ip add | grep 192.128.62.123<br><br><span class="hljs-comment">#å¦‚æœæœ‰Navicatè¿æ¥å·¥å…·å¯ç›´æ¥æµ‹è¯•æ˜¯å¦èƒ½å¤Ÿè¿æ¥å¹¶å†™å…¥æ•°æ®ï¼Œæ²¡æœ‰çš„è¯æŒ‰ç…§ä¸‹è¿°æ­¥éª¤æµ‹è¯•æ˜¯å¦èƒ½å†™å…¥æ•°æ®ï¼ï¼ˆå› ä¸ºæ‰§è¡Œåˆ‡æ¢æ—¶éœ€è¦æ—¶é—´ï¼Œæ‰€ä»¥è¯·åœ¨downæœºåä¸‰åˆ†é’Ÿæµ‹è¯•æ˜¯å¦èƒ½å†™å…¥æ•°æ®ï¼‰</span><br><span class="hljs-comment">#å¯é€šè¿‡æŸ¥çœ‹/etc/keepalived/log/failover.logæ—¥å¿—åˆ¤æ–­æ˜¯å¦åˆ‡æ¢æˆåŠŸï¼</span><br><br><span class="hljs-comment">#æ— å·¥å…·æµ‹è¯•ï¼š</span><br><span class="hljs-comment">##åˆ‡æ¢å®Œæˆååœ¨129æœºå™¨ä¸Šï¼Œè¿æ¥æ•°æ®åº“</span><br><span class="hljs-comment">##åˆ›å»ºæµ‹è¯•è¡¨</span><br>CREATE TABLE <span class="hljs-built_in">test</span>(ID VARCHAR(20));<br><span class="hljs-comment">##æ’å…¥æµ‹è¯•æ•°æ®</span><br>INSERT INTO <span class="hljs-built_in">test</span>(ID) VALUES (<span class="hljs-string">&#x27;1234554321&#x27;</span>);<br><span class="hljs-comment">##æŸ¥è¯¢æ•°æ®æ˜¯å¦å†™å…¥</span><br>SELECT * from <span class="hljs-built_in">test</span>;<br><span class="hljs-comment">##åˆ é™¤æµ‹è¯•è¡¨</span><br>DROP TABLE IF EXISTS <span class="hljs-built_in">test</span>;<br><br></code></pre></td></tr></table></figure><h3 id="8-6ã€ä¿®å¤192-168-62-130"><a href="#8-6ã€ä¿®å¤192-168-62-130" class="headerlink" title="8.6ã€ä¿®å¤192.168.62.130"></a>8.6ã€ä¿®å¤192.168.62.130</h3><p>ä½¿ç”¨pg_rewind åŒæ­¥æ–°ä¸»åº“çš„æ•°æ®åˆ°åŸä¸»åº“ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">su - postgres<br><br>/usr/pgsql-14/bin/pg_rewind -R --target-pgdata <span class="hljs-string">&#x27;/var/lib/pgsql/14/data/&#x27;</span> --source-server <span class="hljs-string">&#x27;host=192.168.62.129 port=5432 user=postgres password=postgres dbname=postgres&#x27;</span><br><br></code></pre></td></tr></table></figure><p>å¦‚æœè¿™ä¸ªåœ°æ–¹å’±ä»¬çš„walæ—¥å¿—å·²ç»è¢«è¦†ç›–äº†äº†å¾ˆå¤šï¼Œé‚£ä¹ˆå°±éœ€è¦å°†æˆ‘ä»¬çš„å½’æ¡£å¤‡ä»½æ—¥å¿—&#x2F;pg_archive&#x2F;ç»™scpè¿‡æ¥<br>æ³¨æ„ï¼šéœ€è¦æ³¨æ„æ–°ä¸»å’Œå¤‡ä¸Šé¢TimeLineIDçš„å·®å¼‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">scp postgres@192.168.62.129:/var/lib/pgsql/14/data/pg_archive/00000002*  /var/lib/pgsql/14/data/pg_archive/<br></code></pre></td></tr></table></figure><p>å¯åŠ¨æ•°æ®åº“ï¼Œç„¶åæ£€æŸ¥ä¸»å¤‡æ˜¯å¦æ­£å¸¸</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start postgresql-14<br><br><span class="hljs-comment">#æ£€æŸ¥ä¸»å¤‡wal senderå’Œreceiveræ˜¯å¦æ­£å¸¸</span><br>ps axu |grep walreceiver<br><br>æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£å¸¸ï¼šæ ¹æ®5.3æ­¥éª¤æ¥è¿›è¡ŒæŸ¥çœ‹<br></code></pre></td></tr></table></figure><p>å¯åŠ¨Keepalivedï¼ŒæŸ¥çœ‹KeepalivedçŠ¶æ€</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl  start keepalived<br>systemctl status keepalived<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>PostgreSQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PostgreSQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PostgreSQLå•èŠ‚ç‚¹æ­å»º</title>
    <link href="/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/PostgreSQL%E5%8D%95%E8%8A%82%E7%82%B9%E6%90%AD%E5%BB%BA/"/>
    <url>/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/PostgreSQL%E5%8D%95%E8%8A%82%E7%82%B9%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="PostgreSQLå•èŠ‚ç‚¹æ­å»º"><a href="#PostgreSQLå•èŠ‚ç‚¹æ­å»º" class="headerlink" title="PostgreSQLå•èŠ‚ç‚¹æ­å»º"></a>PostgreSQLå•èŠ‚ç‚¹æ­å»º</h1><p>PostgreSQLæ˜¯ä¸€ç§ç‰¹æ€§éå¸¸é½å…¨çš„è‡ªç”±è½¯ä»¶çš„å¯¹è±¡-å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ(ORDBMS)ï¼Œç¨³å®šæ€§æ¯”MySQLè¦å¼ºï¼Œé«˜å¹¶å‘æƒ…å†µä¸‹è¯»å†™æ€§èƒ½å¥½ã€‚</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å®˜ç½‘åœ°å€ï¼šhttps://www.postgresql.org/<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€åœ¨çº¿å®‰è£…"><a href="#ä¸€ã€åœ¨çº¿å®‰è£…" class="headerlink" title="ä¸€ã€åœ¨çº¿å®‰è£…"></a>ä¸€ã€åœ¨çº¿å®‰è£…</h2><p>åœ¨çº¿å®‰è£…åœ°å€ï¼š<a href="https://www.postgresql.org/download/linux/redhat/">https://www.postgresql.org/download/linux/redhat/</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># å®‰è£…å­˜å‚¨åº“ RPMï¼š</span><br>sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm<br><br><span class="hljs-comment"># å®‰è£… PostgreSQLï¼š</span><br>sudo yum install -y postgresql14-server<br><br><span class="hljs-comment"># å¯é€‰æ‹©åˆå§‹åŒ–æ•°æ®åº“å¹¶å¯ç”¨è‡ªåŠ¨å¯åŠ¨ï¼š</span><br>sudo /usr/pgsql-14/bin/postgresql-14-setup initdb<br>sudo systemctl <span class="hljs-built_in">enable</span> postgresql-14<br>sudo systemctl start postgresql-14<br><br><span class="hljs-comment"># å®‰è£…æ ¸å¿ƒæ•°æ®åº“æœåŠ¡å™¨</span><br>yum install postgresql14-server postgresql14-contrib -y<br><br><span class="hljs-comment">#postgresqlç›¸å…³è·¯å¾„</span><br>/var/lib/pgsql/14/data/  <span class="hljs-comment">#confæ–‡ä»¶è·¯å¾„</span><br><br><span class="hljs-comment">#æµ‹è¯•æ˜¯å¦èƒ½æ­£å¸¸è¿æ¥</span><br>su - postgres<br>psql<br></code></pre></td></tr></table></figure><h2 id="äºŒã€ç¦»çº¿å®‰è£…ï¼ˆä¸‹è½½å®‰è£…åŒ…æ–¹å¼å®‰è£…ï¼‰"><a href="#äºŒã€ç¦»çº¿å®‰è£…ï¼ˆä¸‹è½½å®‰è£…åŒ…æ–¹å¼å®‰è£…ï¼‰" class="headerlink" title="äºŒã€ç¦»çº¿å®‰è£…ï¼ˆä¸‹è½½å®‰è£…åŒ…æ–¹å¼å®‰è£…ï¼‰"></a>äºŒã€ç¦»çº¿å®‰è£…ï¼ˆä¸‹è½½å®‰è£…åŒ…æ–¹å¼å®‰è£…ï¼‰</h2><p>å‚è€ƒåšä¸»æ–‡æ¡£ï¼š<a href="https://blog.csdn.net/weixin_47980221/article/details/121124658">https://blog.csdn.net/weixin_47980221/article/details/121124658</a><br>ç¦»çº¿å®‰è£…åŒ…ä¸‹è½½åœ°å€ï¼š<a href="https://ftp.postgresql.org/pub/source/">https://ftp.postgresql.org/pub/source/</a></p><h3 id="1ã€ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…"><a href="#1ã€ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…" class="headerlink" title="1ã€ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…"></a>1ã€ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /app &amp;&amp; <span class="hljs-built_in">cd</span> /app<br><br>wget https://ftp.postgresql.org/pub/source/v14.5/postgresql-14.5.tar.gz --no-check-certificate<br><br>tar -xnf postgresql-14.5.tar.gz &amp;&amp; <span class="hljs-built_in">cd</span> postgresql-14.5<br><br><span class="hljs-comment">#æ·»åŠ è½¯é“¾æ¥</span><br><span class="hljs-built_in">ln</span> -s /app/postgresql-14.5/ /usr/local/pgsql/<br></code></pre></td></tr></table></figure><h3 id="2ã€åˆ›å»ºpostgresqlç”¨æˆ·ï¼Œå¹¶è®¾ç½®å¯†ç "><a href="#2ã€åˆ›å»ºpostgresqlç”¨æˆ·ï¼Œå¹¶è®¾ç½®å¯†ç " class="headerlink" title="2ã€åˆ›å»ºpostgresqlç”¨æˆ·ï¼Œå¹¶è®¾ç½®å¯†ç "></a>2ã€åˆ›å»ºpostgresqlç”¨æˆ·ï¼Œå¹¶è®¾ç½®å¯†ç </h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">useradd postgres<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;123123&quot;</span> |passwd<br><br></code></pre></td></tr></table></figure><h3 id="3ã€ç¼–è¯‘å®‰è£…"><a href="#3ã€ç¼–è¯‘å®‰è£…" class="headerlink" title="3ã€ç¼–è¯‘å®‰è£…"></a>3ã€ç¼–è¯‘å®‰è£…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å®‰è£…å¿…è¦ä¾èµ–</span><br>yum install -y bison flex readline-devel zlib-devel<br>yum install docbook-dtds docbook-style-xsl fop libxslt -y<br>yum install -y gcc<br><br><span class="hljs-comment">#åˆ›å»ºæ•°æ®ç›®å½•</span><br><span class="hljs-built_in">mkdir</span>  -p /usr/local/pgsql/data<br><br><span class="hljs-comment">#è®¾ç½®ç”¨æˆ·ç»„</span><br><span class="hljs-built_in">chown</span> -R postgres.postgres /usr/local/pgsql/<br><br><span class="hljs-comment">#é…ç½®ç¼–è¯‘</span><br><span class="hljs-built_in">cd</span> /usr/local/pgsql/<br>./configure<br>make &amp;&amp; make install<br><br></code></pre></td></tr></table></figure><h3 id="4ã€åˆå§‹åŒ–æ•°æ®åº“"><a href="#4ã€åˆå§‹åŒ–æ•°æ®åº“" class="headerlink" title="4ã€åˆå§‹åŒ–æ•°æ®åº“"></a>4ã€åˆå§‹åŒ–æ•°æ®åº“</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ‡æ¢ä¸ºpostgresç”¨æˆ·</span><br>su - postgres<br><br><span class="hljs-comment">#åˆå§‹åŒ–æ•°æ®åº“</span><br>/usr/local/pgsql/bin/initdb -D /usr/local/pgsql/data/ã€€ã€€<br></code></pre></td></tr></table></figure><h3 id="5ã€å¯åŠ¨æ•°æ®åº“"><a href="#5ã€å¯åŠ¨æ•°æ®åº“" class="headerlink" title="5ã€å¯åŠ¨æ•°æ®åº“"></a>5ã€å¯åŠ¨æ•°æ®åº“</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¯åŠ¨æ•°æ®åº“</span><br>/usr/local/pgsql/bin/pg_ctl -D /usr/local/pgsql/data/ -l ./logfile start<br><span class="hljs-comment">#-lï¼šæŒ‡å®šæ—¥å¿—æ–‡ä»¶ä½ç½®ï¼Œç›´æ¥è¾“å‡ºå½“å‰ç›®å½•ä¸‹çš„logfileï¼Œå¯ä»¥è‡ªå·±æŒ‡å®š</span><br><span class="hljs-comment">#-Dï¼šæŒ‡å®šæ•°æ®ç›®å½•ï¼Œé»˜è®¤å¦‚æœä¸åŠ æ•°æ®ç›®å½•æŠ¥é”™ä¼šæ‰¾ä¸åˆ°</span><br><br>åœæ­¢æ•°æ®åº“<br>/usr/local/pgsql/bin/pg_ctl -D /usr/local/pgsql/data/ stop<br><br>é‡å¯æ•°æ®åº“<br>/usr/local/pgsql/bin/pg_ctl restart -D /usr/local/pgsql/data/ -m fast<br></code></pre></td></tr></table></figure><h3 id="6ã€ç¯å¢ƒå˜é‡ä¿®æ”¹"><a href="#6ã€ç¯å¢ƒå˜é‡ä¿®æ”¹" class="headerlink" title="6ã€ç¯å¢ƒå˜é‡ä¿®æ”¹"></a>6ã€ç¯å¢ƒå˜é‡ä¿®æ”¹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi ~/.bash_profile<br><span class="hljs-comment">#å¢åŠ </span><br><span class="hljs-built_in">export</span> PGHOME=/usr/local/pgsql<br><span class="hljs-built_in">export</span> PGDATA=/usr/local/pgsql/data<br>PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$HOME</span>/bin:<span class="hljs-variable">$PGHOME</span>/bin<br><br><span class="hljs-comment">#ç”Ÿæ•ˆ </span><br><span class="hljs-built_in">source</span> ~/.bash_profile<br></code></pre></td></tr></table></figure><h3 id="7ã€é…ç½®æ–‡ä»¶ä¿®æ”¹"><a href="#7ã€é…ç½®æ–‡ä»¶ä¿®æ”¹" class="headerlink" title="7ã€é…ç½®æ–‡ä»¶ä¿®æ”¹"></a>7ã€é…ç½®æ–‡ä»¶ä¿®æ”¹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /usr/local/pgsql/data<br><br><span class="hljs-comment">#å¤‡ä»½æ–‡ä»¶</span><br><span class="hljs-built_in">cp</span> postgresql.conf&#123;,.bak&#125;<br><br><span class="hljs-comment">#ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br>vim postgresql.conf<br><br>listen_addresses  <span class="hljs-string">&#x27;*&#x27;</span> <span class="hljs-comment">#é»˜è®¤æœ¬æœº</span><br>max_connections   1000 <span class="hljs-comment">#é»˜è®¤100</span><br><br><span class="hljs-comment">##å…¶ä»–ç›¸å…³å†…å­˜å‚æ•°ä¼˜åŒ–è¿™é‡Œä¸åšè¿‡å¤šé…ç½®</span><br><br><span class="hljs-comment">#æ·»åŠ IPç½‘æ®µæˆæƒï¼ˆå¯é€‰ï¼‰</span><br>vim /usr/local/pgsql/data/pg_hba.conf<br><span class="hljs-comment">#...</span><br>host    all             all             192.168.62.0/24         trustã€€ã€€ã€€ã€€æŒ‡å®šç½‘æ®µå¯è¿æ¥<br>host    all             all             0.0.0.0/0               trustã€€ã€€ã€€ã€€æ‰€æœ‰ç½‘æ®µå¯è¿æ¥<br></code></pre></td></tr></table></figure><h3 id="8ã€ç®€å•æ“ä½œ"><a href="#8ã€ç®€å•æ“ä½œ" class="headerlink" title="8ã€ç®€å•æ“ä½œ"></a>8ã€ç®€å•æ“ä½œ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿æ¥æ•°æ®åº“</span><br>psql -h 127.0.0.1 -U postgres -p 5432<br><span class="hljs-comment">## -dæŒ‡å®šè¿æ¥åé€‰ä¸­çš„æ•°æ®åº“ï¼Œé»˜è®¤æ˜¯postgres</span><br><br><span class="hljs-comment">##å‘½ä»¤æç¤ºç¬¦å‰é¢ä¸ºå½“å‰æ•°æ®åº“ï¼Œä½¿ç”¨ \l (åæ–œæ +l)æŸ¥çœ‹å½“å‰æ•°æ®åº“åˆ—è¡¨</span><br><br><span class="hljs-comment">#ä¸ºç”¨æˆ·postgresè®¾ç½®å¯†ç ï¼Œå¢å¼ºå®‰å…¨æ€§:</span><br>ALTER USER postgres WITH PASSWORD <span class="hljs-string">&#x27;YourPassWord&#x27;</span>;<br><br><span class="hljs-comment">#æŸ¥è¯¢è´¦å·</span><br>SELECT usename from pg_user;<br><br>CREATE DATABASE <span class="hljs-built_in">test</span> WITH OWNER=postgres ENCODING=<span class="hljs-string">&#x27;UTF-8&#x27;</span>; <span class="hljs-comment">#åˆ›å»ºæ–°çš„æ•°æ®åº“ </span><br>create table è¡¨å(å­—æ®µ å±æ€§(),.....)  åˆ›å»ºè¡¨ <br>\c <span class="hljs-built_in">test</span>   <span class="hljs-comment">#åˆ‡æ¢å½“å‰æ•°æ®åº“ä¸ºtest</span><br>\d        <span class="hljs-comment">#æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸‹æ‰€æœ‰è¡¨</span><br>\d è¡¨å   <span class="hljs-comment">#æŸ¥çœ‹è¡¨ç»“æ„è¯¦ç»†ä¿¡æ¯</span><br>\qã€€ã€€    <span class="hljs-comment">#é€€å‡ºäº¤äº’ç•Œé¢</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>PostgreSQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PostgreSQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>postgresqlä¸»ä»æ­å»º</title>
    <link href="/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/PostgreSQL%E4%B8%BB%E4%BB%8E%E6%90%AD%E5%BB%BA/"/>
    <url>/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/PostgreSQL%E4%B8%BB%E4%BB%8E%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="PostgreSQLä¸»ä»æ­å»º"><a href="#PostgreSQLä¸»ä»æ­å»º" class="headerlink" title="PostgreSQLä¸»ä»æ­å»º"></a>PostgreSQLä¸»ä»æ­å»º</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/guapitomjoy/p/15330079.html<br>å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/ezgod/p/15843221.html<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€æœºå™¨è§„åˆ’"><a href="#ä¸€ã€æœºå™¨è§„åˆ’" class="headerlink" title="ä¸€ã€æœºå™¨è§„åˆ’"></a>ä¸€ã€æœºå™¨è§„åˆ’</h2><p>åŸºäºpgpoolä¸­é—´ä»¶å®ç°postgresqlä¸€ä¸»å¤šä»é›†ç¾¤éƒ¨ç½²ï¼Œè¿™é‡Œç”¨ä¸¤å°æœåŠ¡å™¨ä½œä¸€ä¸»ä¸€ä»ç¤ºä¾‹</p><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>ä¸»ä»åˆ’åˆ†</th></tr></thead><tbody><tr><td>pgsql-1</td><td>192.168.62.129</td><td>ä¸»åº“</td></tr><tr><td>pgsql-2</td><td>192.168.62.130</td><td>ä»åº“</td></tr></tbody></table><h2 id="äºŒã€æ•´ä½“æ¶æ„"><a href="#äºŒã€æ•´ä½“æ¶æ„" class="headerlink" title="äºŒã€æ•´ä½“æ¶æ„"></a>äºŒã€æ•´ä½“æ¶æ„</h2><p><img src="/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/PostgreSQL%E4%B8%BB%E4%BB%8E%E6%90%AD%E5%BB%BA/image-20221028174953304.png" alt="image-20221028174953304"></p><h2 id="ä¸‰ã€å®‰è£…postgresql"><a href="#ä¸‰ã€å®‰è£…postgresql" class="headerlink" title="ä¸‰ã€å®‰è£…postgresql"></a>ä¸‰ã€å®‰è£…postgresql</h2><h3 id="3-1ã€å®‰è£…postgresql-14"><a href="#3-1ã€å®‰è£…postgresql-14" class="headerlink" title="3.1ã€å®‰è£…postgresql-14"></a>3.1ã€å®‰è£…postgresql-14</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm<br><br><span class="hljs-comment"># å®‰è£… PostgreSQLï¼š</span><br>sudo yum install -y postgresql14-server<br><br><span class="hljs-comment"># å¯é€‰æ‹©åˆå§‹åŒ–æ•°æ®åº“å¹¶å¯ç”¨è‡ªåŠ¨å¯åŠ¨ï¼š</span><br>sudo /usr/pgsql-14/bin/postgresql-14-setup initdb<br>sudo systemctl <span class="hljs-built_in">enable</span> postgresql-14<br>sudo systemctl start postgresql-14<br><br><span class="hljs-comment"># å®‰è£…æ ¸å¿ƒæ•°æ®åº“æœåŠ¡å™¨</span><br>yum install postgresql14-server postgresql14-contrib -y<br><br><span class="hljs-comment">#postgresqlç›¸å…³è·¯å¾„</span><br>/var/lib/pgsql/14/data/  <span class="hljs-comment">#confæ–‡ä»¶è·¯å¾„</span><br><br><span class="hljs-comment">#æµ‹è¯•æ˜¯å¦èƒ½æ­£å¸¸è¿æ¥</span><br>su - postgres<br>psql<br></code></pre></td></tr></table></figure><h3 id="3-2ã€ä¸»èŠ‚ç‚¹é…ç½®"><a href="#3-2ã€ä¸»èŠ‚ç‚¹é…ç½®" class="headerlink" title="3.2ã€ä¸»èŠ‚ç‚¹é…ç½®"></a>3.2ã€ä¸»èŠ‚ç‚¹é…ç½®</h3><h4 id="3-2-1ï¼‰åˆ›å»ºç”¨äºä¸»ä»è®¿é—®çš„ç”¨æˆ·ï¼Œ-ä¿®æ”¹postgresç”¨æˆ·çš„å¯†ç ï¼Œç”¨äºè¿œç¨‹ç™»å½•ã€‚-åˆ‡æ¢åˆ°postgresç”¨æˆ·æ“ä½œ"><a href="#3-2-1ï¼‰åˆ›å»ºç”¨äºä¸»ä»è®¿é—®çš„ç”¨æˆ·ï¼Œ-ä¿®æ”¹postgresç”¨æˆ·çš„å¯†ç ï¼Œç”¨äºè¿œç¨‹ç™»å½•ã€‚-åˆ‡æ¢åˆ°postgresç”¨æˆ·æ“ä½œ" class="headerlink" title="3.2.1ï¼‰åˆ›å»ºç”¨äºä¸»ä»è®¿é—®çš„ç”¨æˆ·ï¼Œ ä¿®æ”¹postgresç”¨æˆ·çš„å¯†ç ï¼Œç”¨äºè¿œç¨‹ç™»å½•ã€‚(åˆ‡æ¢åˆ°postgresç”¨æˆ·æ“ä½œ)"></a>3.2.1ï¼‰åˆ›å»ºç”¨äºä¸»ä»è®¿é—®çš„ç”¨æˆ·ï¼Œ ä¿®æ”¹postgresç”¨æˆ·çš„å¯†ç ï¼Œç”¨äºè¿œç¨‹ç™»å½•ã€‚(åˆ‡æ¢åˆ°postgresç”¨æˆ·æ“ä½œ)</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ‡æ¢åˆ°postgresç”¨æˆ·æ“ä½œ</span><br>su - postgres<br>psql<br><br><span class="hljs-comment">#åˆ›å»ºç”¨äºä¸»ä»è®¿é—®çš„ç”¨æˆ·</span><br><span class="hljs-comment">#åˆ›å»ºæ•°æ®åº“è´¦å·replicaå¹¶è®¾ç½®å¯†ç åŠç™»å½•æƒé™å’Œå¤‡ä»½æƒé™</span><br>create role replica login replication encrypted password <span class="hljs-string">&#x27;replica123&#x27;</span>;<br><br><span class="hljs-comment">#ä¿®æ”¹postgresç”¨æˆ·çš„å¯†ç ï¼Œç”¨äºè¿œç¨‹ç™»å½•</span><br>alter USER postgres with password <span class="hljs-string">&#x27;postgres&#x27;</span>;<br></code></pre></td></tr></table></figure><h4 id="3-2-2ï¼‰ä¿®æ”¹pg-hba-confå’Œpostgresql-confé…ç½®ï¼š"><a href="#3-2-2ï¼‰ä¿®æ”¹pg-hba-confå’Œpostgresql-confé…ç½®ï¼š" class="headerlink" title="3.2.2ï¼‰ä¿®æ”¹pg_hba.confå’Œpostgresql.confé…ç½®ï¼š"></a>3.2.2ï¼‰ä¿®æ”¹pg_hba.confå’Œpostgresql.confé…ç½®ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‰“å¼€pg_hba.confæ–‡ä»¶ï¼Œè®¾ç½®replicaç”¨æˆ·ç™½åå•</span><br>vim /var/lib/pgsql/14/data/pg_hba.conf<br><br><span class="hljs-comment">##æ·»åŠ ä»¥ä¸‹æ•°æ®</span><br><span class="hljs-comment">##å…è®¸replicaç”¨æˆ·ä»replicationæ•°æ®åº“è¿›è¡Œæ•°æ®åŒæ­¥</span><br>host replication replica 192.168.62.129/24 trust<br>host replication replica 192.168.62.130/24 trust<br><span class="hljs-comment">#å…è®¸VPCç½‘æ®µä¸­md5å¯†ç è®¤è¯è¿æ¥</span><br>host    all    all    192.168.0.0/24    md5<br>host    all    all     0.0.0.0/0 md5<br><br><br><span class="hljs-comment">#è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‰“å¼€postgresql.confæ–‡ä»¶</span><br>vim /var/lib/pgsql/14/data/postgresql.conf<br><br>listen_addresses = <span class="hljs-string">&#x27;*&#x27;</span>     <span class="hljs-comment">#ç›‘å¬çš„IPåœ°å€</span><br>max_connections = 100      <span class="hljs-comment">#æœ€å¤§è¿æ¥æ•°ï¼Œä»åº“çš„max_connectionså¿…é¡»è¦å¤§äºä¸»åº“çš„</span><br><span class="hljs-comment">#archive_mode = on  # å…è®¸å½’æ¡£</span><br><span class="hljs-comment">#archive_command = &#x27;cp %p /opt/pgsql/pg_archive/%f&#x27; ## é€šè¿‡å‘½ä»¤æŒ‡å®šå½’æ¡£è·¯å¾„/</span><br>wal_level = logical    <span class="hljs-comment">#å†™å…¥WALçš„çº§åˆ«(minimal:ä¸èƒ½é€šè¿‡åŸºç¡€å¤‡ä»½å’Œwalæ—¥å¿—æ¢å¤æ•°æ®åº“; replica: æ”¯æŒwalå½’æ¡£å’Œå¤åˆ¶; logical: åœ¨replicaçº§åˆ«æ·»åŠ äº†é€»è¾‘è§£ç æ‰€éœ€çš„ä¿¡æ¯)</span><br>synchronous_commit = on    <span class="hljs-comment">#å¼€å¯åŒæ­¥å¤åˆ¶</span><br>max_wal_senders = 32       <span class="hljs-comment"># å…è®¸æœ€å¤šçš„æµå¤åˆ¶è¿æ¥å‘é€æ•°é‡ï¼Œ æ ¹æ®ä»èŠ‚ç‚¹æ•°é‡æ¥è®¾å®š</span><br>wal_sender_timeout = 60s   <span class="hljs-comment">#æµå¤åˆ¶ä¸»æœºå‘é€æ•°æ®çš„è¶…æ—¶æ—¶é—´</span><br><br><br><span class="hljs-comment">#å¦‚æœpostgresql.confä¸­çš„hot_standbyå‚æ•°è®¾ç½®ä¸ºonï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œå¹¶ä¸”æ•°æ®ç›®å½•ä¸­å­˜åœ¨Standby.signalæ–‡ä»¶ï¼Œåˆ™replication slaveå°†åœ¨â€œçƒ­å¤‡â€æ¨¡å¼ä¸‹è¿è¡Œã€‚</span><br></code></pre></td></tr></table></figure><h4 id="3-2-3ï¼‰é‡å¯ä¸»èŠ‚ç‚¹æœåŠ¡"><a href="#3-2-3ï¼‰é‡å¯ä¸»èŠ‚ç‚¹æœåŠ¡" class="headerlink" title="3.2.3ï¼‰é‡å¯ä¸»èŠ‚ç‚¹æœåŠ¡"></a>3.2.3ï¼‰é‡å¯ä¸»èŠ‚ç‚¹æœåŠ¡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart postgresql-14.service<br></code></pre></td></tr></table></figure><h3 id="3-3ã€é…ç½®PostgreSQLä»èŠ‚ç‚¹ï¼ˆä»èŠ‚ç‚¹çš„æ“ä½œå»ºè®®å…¨éƒ¨åœ¨postgresç”¨æˆ·ä¸‹è¿›è¡Œã€‚ï¼‰"><a href="#3-3ã€é…ç½®PostgreSQLä»èŠ‚ç‚¹ï¼ˆä»èŠ‚ç‚¹çš„æ“ä½œå»ºè®®å…¨éƒ¨åœ¨postgresç”¨æˆ·ä¸‹è¿›è¡Œã€‚ï¼‰" class="headerlink" title="3.3ã€é…ç½®PostgreSQLä»èŠ‚ç‚¹ï¼ˆä»èŠ‚ç‚¹çš„æ“ä½œå»ºè®®å…¨éƒ¨åœ¨postgresç”¨æˆ·ä¸‹è¿›è¡Œã€‚ï¼‰"></a>3.3ã€é…ç½®PostgreSQLä»èŠ‚ç‚¹ï¼ˆä»èŠ‚ç‚¹çš„æ“ä½œå»ºè®®å…¨éƒ¨åœ¨postgresç”¨æˆ·ä¸‹è¿›è¡Œã€‚ï¼‰</h3><h4 id="3-3-1ï¼‰åˆ‡æ¢postgresç”¨æˆ·"><a href="#3-3-1ï¼‰åˆ‡æ¢postgresç”¨æˆ·" class="headerlink" title="3.3.1ï¼‰åˆ‡æ¢postgresç”¨æˆ·"></a>3.3.1ï¼‰åˆ‡æ¢postgresç”¨æˆ·</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">su - postgres<br></code></pre></td></tr></table></figure><h4 id="3-3-2-å°†ä¸»èŠ‚ç‚¹çš„æ•°æ®è¿›è¡Œå¤‡ä»½åˆ°ä»èŠ‚ç‚¹"><a href="#3-3-2-å°†ä¸»èŠ‚ç‚¹çš„æ•°æ®è¿›è¡Œå¤‡ä»½åˆ°ä»èŠ‚ç‚¹" class="headerlink" title="3.3.2) å°†ä¸»èŠ‚ç‚¹çš„æ•°æ®è¿›è¡Œå¤‡ä»½åˆ°ä»èŠ‚ç‚¹"></a>3.3.2) å°†ä¸»èŠ‚ç‚¹çš„æ•°æ®è¿›è¡Œå¤‡ä»½åˆ°ä»èŠ‚ç‚¹</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">rm</span> -rf /var/lib/pgsql/14/data/*<br><br><span class="hljs-comment">#å¤åˆ¶åä»èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ä¼šå’Œä¸»èŠ‚ç‚¹çš„ä¸€æ ·ï¼Œå¹¶ä¸”ä¸€å¹¶å¤åˆ¶çš„è¿˜æœ‰æ•°æ®åº“æ–‡ä»¶ï¼Œé‡Œé¢çš„æ•°æ®ä¹Ÿä¸€æ ·ï¼Œæ„å‘³ç€ä¸»èŠ‚ç‚¹æœ‰ä»€ä¹ˆç”¨æˆ·æ•°æ®ä»èŠ‚ç‚¹ä¹Ÿæœ‰</span><br>pg_basebackup -h 192.168.62.129 -D /var/lib/pgsql/14/data -U replica -P -v  -R -X stream -C -S pgstandby1 <br><br>å‚æ•°è¯¦è§£ï¼š<br>-h â€“æŒ‡å®šä½œä¸ºä¸»æœåŠ¡å™¨çš„ä¸»æœºã€‚<br>-D â€“æŒ‡å®šæ•°æ®ç›®å½•ã€‚<br>-U â€“æŒ‡å®šè¿æ¥ç”¨æˆ·ã€‚<br>-P â€“å¯ç”¨è¿›åº¦æŠ¥å‘Šã€‚<br>-v â€“å¯ç”¨è¯¦ç»†æ¨¡å¼ã€‚<br>-Râ€“å¯ç”¨æ¢å¤é…ç½®çš„åˆ›å»ºï¼šåˆ›å»ºä¸€ä¸ªstandby.signalæ–‡ä»¶ï¼Œå¹¶å°†è¿æ¥è®¾ç½®é™„åŠ åˆ°æ•°æ®ç›®å½•ä¸‹çš„postgresql.auto.confã€‚<br>-Xâ€“ç”¨äºåœ¨å¤‡ä»½ä¸­åŒ…æ‹¬æ‰€éœ€çš„é¢„å†™æ—¥å¿—æ–‡ä»¶ï¼ˆWALæ–‡ä»¶ï¼‰ã€‚æµçš„å€¼è¡¨ç¤ºåœ¨åˆ›å»ºå¤‡ä»½æ—¶æµå¼ä¼ è¾“WALã€‚<br>-C â€“åœ¨å¼€å§‹å¤‡ä»½ä¹‹å‰ï¼Œå…è®¸åˆ›å»ºç”±-Sé€‰é¡¹å‘½åçš„å¤åˆ¶æ’æ§½ã€‚<br>-S â€“æŒ‡å®šå¤åˆ¶æ’æ§½åç§°ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¤‡ä»½è¿‡ç¨‹å®Œæˆåï¼Œä¼šåœ¨dataç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªstandby.signalï¼Œå¹¶å°†primary_conninfoå†™å…¥postgresql.auto.conf</span><br><span class="hljs-built_in">cat</span> /var/lib/pgsql/14/data/postgresql.auto.conf <br><span class="hljs-comment">#è¾“å‡ºä¿¡æ¯ï¼š</span><br><span class="hljs-comment"># Do not edit this file manually!</span><br><span class="hljs-comment"># It will be overwritten by the ALTER SYSTEM command.</span><br>primary_conninfo = <span class="hljs-string">&#x27;user=replica passfile=&#x27;</span><span class="hljs-string">&#x27;/var/lib/pgsql/.pgpass&#x27;</span><span class="hljs-string">&#x27; channel_binding=prefer host=192.168.62.129 port=5432 sslmode=prefer sslcompression=0 sslsni=1 ssl_min_protocol_version=TLSv1.2 gssencmode=prefer krbsrvname=postgres target_session_attrs=any&#x27;</span><br>primary_slot_name = <span class="hljs-string">&#x27;pgstandby1&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="3-3-3ï¼‰å¯åŠ¨ä»èŠ‚ç‚¹"><a href="#3-3-3ï¼‰å¯åŠ¨ä»èŠ‚ç‚¹" class="headerlink" title="3.3.3ï¼‰å¯åŠ¨ä»èŠ‚ç‚¹"></a>3.3.3ï¼‰å¯åŠ¨ä»èŠ‚ç‚¹</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start postgresql-14<br></code></pre></td></tr></table></figure><h2 id="å››ã€éªŒè¯ä¸»ä»ï¼Œè¯»å†™æµ‹è¯•"><a href="#å››ã€éªŒè¯ä¸»ä»ï¼Œè¯»å†™æµ‹è¯•" class="headerlink" title="å››ã€éªŒè¯ä¸»ä»ï¼Œè¯»å†™æµ‹è¯•"></a>å››ã€éªŒè¯ä¸»ä»ï¼Œè¯»å†™æµ‹è¯•</h2><h3 id="4-1ã€éªŒè¯ä¸»ä»ä¿¡æ¯"><a href="#4-1ã€éªŒè¯ä¸»ä»ä¿¡æ¯" class="headerlink" title="4.1ã€éªŒè¯ä¸»ä»ä¿¡æ¯"></a>4.1ã€éªŒè¯ä¸»ä»ä¿¡æ¯</h3><h4 id="4-1-1ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å¤åˆ¶æ’æ§½-ä¸»èŠ‚ç‚¹æ‰§è¡Œ"><a href="#4-1-1ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å¤åˆ¶æ’æ§½-ä¸»èŠ‚ç‚¹æ‰§è¡Œ" class="headerlink" title="4.1.1ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å¤åˆ¶æ’æ§½(ä¸»èŠ‚ç‚¹æ‰§è¡Œ)"></a>4.1.1ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å¤åˆ¶æ’æ§½(ä¸»èŠ‚ç‚¹æ‰§è¡Œ)</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">su - postgres<br>psql -c <span class="hljs-string">&quot;SELECT * FROM pg_replication_slots;&quot;</span><br>psql -c <span class="hljs-string">&#x27;select client_addr,sync_state from pg_stat_replication;&#x27;</span><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><h4 id="4-1-2ï¼‰æŸ¥çœ‹ä»èŠ‚ç‚¹æ¥æ”¶çŠ¶æ€ï¼š-æ­¤ä¿¡æ¯åªæœ‰ä»èŠ‚ç‚¹æ‰ä¼šæœ‰"><a href="#4-1-2ï¼‰æŸ¥çœ‹ä»èŠ‚ç‚¹æ¥æ”¶çŠ¶æ€ï¼š-æ­¤ä¿¡æ¯åªæœ‰ä»èŠ‚ç‚¹æ‰ä¼šæœ‰" class="headerlink" title="4.1.2ï¼‰æŸ¥çœ‹ä»èŠ‚ç‚¹æ¥æ”¶çŠ¶æ€ï¼š(#æ­¤ä¿¡æ¯åªæœ‰ä»èŠ‚ç‚¹æ‰ä¼šæœ‰)"></a>4.1.2ï¼‰æŸ¥çœ‹ä»èŠ‚ç‚¹æ¥æ”¶çŠ¶æ€ï¼š(#æ­¤ä¿¡æ¯åªæœ‰ä»èŠ‚ç‚¹æ‰ä¼šæœ‰)</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">su - postgres<br>psql -c <span class="hljs-string">&quot;\x&quot;</span> -c <span class="hljs-string">&quot;SELECT * FROM pg_stat_wal_receiver;&quot;</span><br><br></code></pre></td></tr></table></figure><h4 id="4-1-3ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å‘é€çŠ¶æ€ï¼š-æ­¤ä¿¡æ¯åªæœ‰ä¸»èŠ‚ç‚¹æ‰ä¼šæœ‰"><a href="#4-1-3ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å‘é€çŠ¶æ€ï¼š-æ­¤ä¿¡æ¯åªæœ‰ä¸»èŠ‚ç‚¹æ‰ä¼šæœ‰" class="headerlink" title="4.1.3ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å‘é€çŠ¶æ€ï¼š(#æ­¤ä¿¡æ¯åªæœ‰ä¸»èŠ‚ç‚¹æ‰ä¼šæœ‰)"></a>4.1.3ï¼‰æŸ¥çœ‹ä¸»èŠ‚ç‚¹å‘é€çŠ¶æ€ï¼š(#æ­¤ä¿¡æ¯åªæœ‰ä¸»èŠ‚ç‚¹æ‰ä¼šæœ‰)</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">su - postgres<br>psql -c <span class="hljs-string">&quot;\x&quot;</span> -c <span class="hljs-string">&quot;SELECT * FROM pg_stat_replication;&quot;</span><br></code></pre></td></tr></table></figure><h3 id="4-2ã€è¯»å†™æµ‹è¯•"><a href="#4-2ã€è¯»å†™æµ‹è¯•" class="headerlink" title="4.2ã€è¯»å†™æµ‹è¯•"></a>4.2ã€è¯»å†™æµ‹è¯•</h3><h4 id="4-2-1ï¼‰åœ¨ä¸»èŠ‚ç‚¹å†™æ•°æ®ï¼Œä»èŠ‚ç‚¹è¯»æ•°æ®ã€‚"><a href="#4-2-1ï¼‰åœ¨ä¸»èŠ‚ç‚¹å†™æ•°æ®ï¼Œä»èŠ‚ç‚¹è¯»æ•°æ®ã€‚" class="headerlink" title="4.2.1ï¼‰åœ¨ä¸»èŠ‚ç‚¹å†™æ•°æ®ï¼Œä»èŠ‚ç‚¹è¯»æ•°æ®ã€‚"></a>4.2.1ï¼‰åœ¨ä¸»èŠ‚ç‚¹å†™æ•°æ®ï¼Œä»èŠ‚ç‚¹è¯»æ•°æ®ã€‚</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">create database <span class="hljs-built_in">test</span>;<br>\l<br></code></pre></td></tr></table></figure><h4 id="4-2-2ï¼‰åœ¨ä»èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹åˆ›å»ºä¹‹åçš„æ•°æ®åº“ã€‚å¯ä»¥çœ‹è§ï¼Œæ•°æ®åº“åŒæ­¥äº†ã€‚"><a href="#4-2-2ï¼‰åœ¨ä»èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹åˆ›å»ºä¹‹åçš„æ•°æ®åº“ã€‚å¯ä»¥çœ‹è§ï¼Œæ•°æ®åº“åŒæ­¥äº†ã€‚" class="headerlink" title="4.2.2ï¼‰åœ¨ä»èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹åˆ›å»ºä¹‹åçš„æ•°æ®åº“ã€‚å¯ä»¥çœ‹è§ï¼Œæ•°æ®åº“åŒæ­¥äº†ã€‚"></a>4.2.2ï¼‰åœ¨ä»èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹åˆ›å»ºä¹‹åçš„æ•°æ®åº“ã€‚å¯ä»¥çœ‹è§ï¼Œæ•°æ®åº“åŒæ­¥äº†ã€‚</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">\l<br></code></pre></td></tr></table></figure><hr><hr><h2 id="äº”ã€postgresç”¨æˆ·é—´å…å¯†ç™»å½•"><a href="#äº”ã€postgresç”¨æˆ·é—´å…å¯†ç™»å½•" class="headerlink" title="äº”ã€postgresç”¨æˆ·é—´å…å¯†ç™»å½•"></a>äº”ã€postgresç”¨æˆ·é—´å…å¯†ç™»å½•</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ç»™postgresç”¨æˆ·æ›´æ”¹å¯†ç </span><br>passwd postgres<br><br><span class="hljs-comment">#ç”Ÿæˆå¹¶åŒæ­¥å¯†é’¥</span><br>su postgres<br>ssh-keygen<br>ssh-copy-id 192.168.62.130<br><br><span class="hljs-comment">#æµ‹è¯•å…å¯†</span><br>ssh  192.168.62.130<br>ip addr<br></code></pre></td></tr></table></figure><h2 id="å…­ã€å®‰è£…pgpool"><a href="#å…­ã€å®‰è£…pgpool" class="headerlink" title="å…­ã€å®‰è£…pgpool"></a>å…­ã€å®‰è£…pgpool</h2><p>pgpoolä»‹ç»ï¼š<a href="https://blog.csdn.net/qq_35241223/article/details/105453826">https://blog.csdn.net/qq_35241223/article/details/105453826</a><br>ç®€ä»‹ï¼šå¯ä»¥å®ç°è‡ªåŠ¨æ•…éšœè½¬ç§»ã€è´Ÿè½½å‡è¡¡ã€åœ¨çº¿æ¢å¤ã€è¿æ¥æ± ã€å¤åˆ¶ã€é™åˆ¶è¶…å‡ºè¿æ¥ã€çœ‹é—¨ç‹—ã€å†…å­˜æŸ¥è¯¢ç¼“å­˜</p><h3 id="6-1ã€å®‰è£…-ä¸¤å°æœºå™¨éƒ½éœ€è¦å®‰è£…"><a href="#6-1ã€å®‰è£…-ä¸¤å°æœºå™¨éƒ½éœ€è¦å®‰è£…" class="headerlink" title="6.1ã€å®‰è£…(ä¸¤å°æœºå™¨éƒ½éœ€è¦å®‰è£…)"></a>6.1ã€å®‰è£…(ä¸¤å°æœºå™¨éƒ½éœ€è¦å®‰è£…)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#Pgpool-IIå®‰è£…</span><br>vim /etc/yum.repos.d/pgdg-redhat-all.repo<br><span class="hljs-comment">#åœ¨pgdgåé¢æ·»åŠ exclude=pgpool*</span><br>[pgdg-common]<br>...<br>exclude=pgpool*<br>[pgdg14]<br>...<br>exclude=pgpool*<br>[pgdg13]<br>...<br>exclude=pgpool*<br>[pgdg12]<br>...<br>exclude=pgpool*<br>[pgdg11]<br><span class="hljs-comment">#...</span><br>exclude=pgpool*<br><br>[pgdg10]<br><span class="hljs-comment">#...</span><br>exclude=pgpool*<br>[pgdg9]<br>...<br>exclude=pgpool*<br><br><span class="hljs-comment"># æ·»åŠ æº</span><br>yum install -y https://www.pgpool.net/yum/rpms/4.3/redhat/rhel-7-x86_64/pgpool-II-release-4.3-1.noarch.rpm<br><span class="hljs-comment"># å®‰è£…</span><br>yum install -y pgpool-II-pg14-*<br><br><span class="hljs-comment">## å®‰è£…å®Œä¹‹åpgpoolçš„é…ç½®æ–‡ä»¶åœ¨/etc/pgpool-II/ä¸‹</span><br></code></pre></td></tr></table></figure><h3 id="6-2ã€ä¿®æ”¹é…ç½®ï¼ˆä¸¤å°æœºå™¨éƒ½éœ€è¦é…ç½®ï¼‰"><a href="#6-2ã€ä¿®æ”¹é…ç½®ï¼ˆä¸¤å°æœºå™¨éƒ½éœ€è¦é…ç½®ï¼‰" class="headerlink" title="6.2ã€ä¿®æ”¹é…ç½®ï¼ˆä¸¤å°æœºå™¨éƒ½éœ€è¦é…ç½®ï¼‰"></a>6.2ã€ä¿®æ”¹é…ç½®ï¼ˆä¸¤å°æœºå™¨éƒ½éœ€è¦é…ç½®ï¼‰</h3><p>pool_hba.confå’Œä¹‹å‰é…ç½®çš„PostgreSQLä¸­çš„é…ç½®æ—¶ä¸€æ ·çš„</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/pgpool-II/pool_hba.conf<br>host    replication replica     192.168.62.129/24    trust<br>host    replication replica     192.168.62.130/24    trust<br>host    all          all        192.168.0.0/24       md5<br>host    all          all        0.0.0.0/0      md5<br></code></pre></td></tr></table></figure><h3 id="6-3ã€å¯¹postgresçš„å¯†ç è¿›è¡ŒåŠ å¯†ã€‚å°†postgresçš„å¯†ç è®¾ç½®ä¸ºå’Œç”¨æˆ·åç›¸åŒ"><a href="#6-3ã€å¯¹postgresçš„å¯†ç è¿›è¡ŒåŠ å¯†ã€‚å°†postgresçš„å¯†ç è®¾ç½®ä¸ºå’Œç”¨æˆ·åç›¸åŒ" class="headerlink" title="6.3ã€å¯¹postgresçš„å¯†ç è¿›è¡ŒåŠ å¯†ã€‚å°†postgresçš„å¯†ç è®¾ç½®ä¸ºå’Œç”¨æˆ·åç›¸åŒ"></a>6.3ã€å¯¹postgresçš„å¯†ç è¿›è¡ŒåŠ å¯†ã€‚å°†postgresçš„å¯†ç è®¾ç½®ä¸ºå’Œç”¨æˆ·åç›¸åŒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¯†ç åŠ å¯†</span><br>pg_md5 postgres<br>&gt;&gt;e8a48653851e28c69d0506508fb27fc5<br><br><span class="hljs-comment">#å°†åŠ å¯†ç»“æœå¤åˆ¶ï¼Œå¹¶ç²˜è´´åˆ°pcp.confä¸­ç›¸åº”çš„ä½ç½®ï¼Œå–æ¶ˆæ‰è¯¥è¡Œçš„æ³¨é‡Š</span><br>vim /etc/pgpool-II/pcp.conf<br>postgres:e8a48653851e28c69d0506508fb27fc5<br></code></pre></td></tr></table></figure><h3 id="6-4ã€æ‰§è¡Œå‘½ä»¤-å…ˆåˆ‡æ¢åˆ°postgresç”¨æˆ·å†æ‰§è¡Œç„¶åè¾“å…¥å¯†ç "><a href="#6-4ã€æ‰§è¡Œå‘½ä»¤-å…ˆåˆ‡æ¢åˆ°postgresç”¨æˆ·å†æ‰§è¡Œç„¶åè¾“å…¥å¯†ç " class="headerlink" title="6.4ã€æ‰§è¡Œå‘½ä»¤(å…ˆåˆ‡æ¢åˆ°postgresç”¨æˆ·å†æ‰§è¡Œç„¶åè¾“å…¥å¯†ç ):"></a>6.4ã€æ‰§è¡Œå‘½ä»¤(å…ˆåˆ‡æ¢åˆ°postgresç”¨æˆ·å†æ‰§è¡Œç„¶åè¾“å…¥å¯†ç ):</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">pg_md5 -m -p -u postgres pool_passwd<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>PostgreSQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PostgreSQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerå®‰è£…PostgreSQL</title>
    <link href="/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/Docker%E5%AE%89%E8%A3%85PostgreSQL/"/>
    <url>/2023/03/29/%E6%95%B0%E6%8D%AE%E5%BA%93/postgreSQL/Docker%E5%AE%89%E8%A3%85PostgreSQL/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Dockerå®‰è£…PostgreSQL"><a href="#Dockerå®‰è£…PostgreSQL" class="headerlink" title="Dockerå®‰è£…PostgreSQL"></a>Dockerå®‰è£…PostgreSQL</h1><h2 id="1-æ‹‰å–é•œåƒ"><a href="#1-æ‹‰å–é•œåƒ" class="headerlink" title="1.æ‹‰å–é•œåƒ"></a>1.æ‹‰å–é•œåƒ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull postgres<br></code></pre></td></tr></table></figure><h2 id="2-å¯åŠ¨é•œåƒ"><a href="#2-å¯åŠ¨é•œåƒ" class="headerlink" title="2.å¯åŠ¨é•œåƒ"></a>2.å¯åŠ¨é•œåƒ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run --name mypostgres -d -p 5432:5432 -e POSTGRES_PASSWORD=123456 postgres<br><br>å‚æ•°è§£é‡Šï¼š<br>â€“nameï¼ŒæŒ‡å®šåˆ›å»ºçš„å®¹å™¨çš„åå­—<br>-e POSTGRES_PASSWORD=123456ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡ï¼ŒæŒ‡å®šæ•°æ®åº“çš„ç™»å½•å£ä»¤ä¸ºpasswordï¼›<br>-p 54321:5432ï¼Œç«¯å£æ˜ å°„å°†å®¹å™¨çš„5432ç«¯å£æ˜ å°„åˆ°å¤–éƒ¨æœºå™¨çš„54321ç«¯å£ï¼›<br>-d æŒ‡å®šä½¿ç”¨postgres:9.4ä½œä¸ºé•œåƒï¼›<br>-e ALLOW_IP_RANGE=0.0.0.0/0 å…è®¸ä»»ä½•ä¸»æœºè®¿é—®ï¼›<br></code></pre></td></tr></table></figure><h2 id="3-ç›´æ¥è¿›å…¥å®¹å™¨ï¼Œè¿æ¥"><a href="#3-ç›´æ¥è¿›å…¥å®¹å™¨ï¼Œè¿æ¥" class="headerlink" title="3.ç›´æ¥è¿›å…¥å®¹å™¨ï¼Œè¿æ¥"></a>3.ç›´æ¥è¿›å…¥å®¹å™¨ï¼Œè¿æ¥</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker <span class="hljs-built_in">exec</span> -it mypostgres psql -U postgres -d postgres<br></code></pre></td></tr></table></figure><h2 id="4-ä½¿ç”¨ç»ˆç«¯å‘½ä»¤è¿æ¥"><a href="#4-ä½¿ç”¨ç»ˆç«¯å‘½ä»¤è¿æ¥" class="headerlink" title="4.ä½¿ç”¨ç»ˆç«¯å‘½ä»¤è¿æ¥"></a>4.ä½¿ç”¨ç»ˆç«¯å‘½ä»¤è¿æ¥</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">psql -U postgres -h ipaddress -d dbname<br></code></pre></td></tr></table></figure><h2 id="5-æŸ¥çœ‹æ•°æ®åº“æ‰€æœ‰è¡¨"><a href="#5-æŸ¥çœ‹æ•°æ®åº“æ‰€æœ‰è¡¨" class="headerlink" title="5.æŸ¥çœ‹æ•°æ®åº“æ‰€æœ‰è¡¨"></a>5.æŸ¥çœ‹æ•°æ®åº“æ‰€æœ‰è¡¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">select * from pg_tables;<br></code></pre></td></tr></table></figure><h2 id="6-åˆ›å»ºæ•°æ®åº“"><a href="#6-åˆ›å»ºæ•°æ®åº“" class="headerlink" title="6.åˆ›å»ºæ•°æ®åº“"></a>6.åˆ›å»ºæ•°æ®åº“</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿›å…¥å®¹å™¨</span><br>docker <span class="hljs-built_in">exec</span> -it mypostgres bash<br><br><span class="hljs-comment"># åˆ‡æ¢postgresç”¨æˆ·</span><br>su postgres<br><br><span class="hljs-comment"># è¿›å…¥æ•°æ®åº“</span><br>psql<br><br><span class="hljs-comment"># åˆ›å»ºsonaræ•°æ®åº“</span><br>&gt; CREATE DATABASE sonar;<br><br><span class="hljs-comment"># é€€å‡ºæ•°æ®åº“</span><br>\q<br><br><span class="hljs-comment"># é€€å‡ºpostgresç”¨æˆ·</span><br><span class="hljs-built_in">exit</span><br><br><span class="hljs-comment"># é€€å‡ºå®¹å™¨</span><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ›å»ºsonarç”¨æˆ·</span><br>&gt; create user sonar with password <span class="hljs-string">&#x27;123456&#x27;</span>;<br><span class="hljs-comment">#åˆ›å»ºsonarqubeæ•°æ®åº“</span><br>&gt; create database sonarqube owner sonar;<br></code></pre></td></tr></table></figure><h2 id="7-å…¶ä»–å®‰è£…å‚è€ƒï¼š"><a href="#7-å…¶ä»–å®‰è£…å‚è€ƒï¼š" class="headerlink" title="7.å…¶ä»–å®‰è£…å‚è€ƒï¼š"></a>7.å…¶ä»–å®‰è£…å‚è€ƒï¼š</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">PostgreSqlå®‰è£…ï¼š<br>å‚è€ƒï¼šhttps://blog.csdn.net/weixin_42450728/article/details/121904389<br>PostgreSqlå¸¸è§çš„é”™è¯¯å¤„ç†<br>https://blog.csdn.net/zhu_xun/article/details/21234663<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>PostgreSQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PostgreSQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨dockeræ­å»ºminio</title>
    <link href="/2023/03/28/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAminio/"/>
    <url>/2023/03/28/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAminio/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ä½¿ç”¨dockeræ­å»ºminio"><a href="#ä½¿ç”¨dockeræ­å»ºminio" class="headerlink" title="ä½¿ç”¨dockeræ­å»ºminio"></a>ä½¿ç”¨dockeræ­å»ºminio</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/networken/article/details/111500745<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€dockeréƒ¨ç½²minioé›†ç¾¤"><a href="#ä¸€ã€dockeréƒ¨ç½²minioé›†ç¾¤" class="headerlink" title="ä¸€ã€dockeréƒ¨ç½²minioé›†ç¾¤"></a>ä¸€ã€dockeréƒ¨ç½²minioé›†ç¾¤</h2><p><strong>å‰ç½®æ¡ä»¶ï¼š</strong></p><ul><li>å‡†å¤‡3ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹åˆ›å»º2ä¸ªæŒ‚è½½ç‚¹ï¼Œç”±äºé›†ç¾¤æ¨¡å¼ä¸‹ä¸èƒ½ä½¿ç”¨æ ¹ç£ç›˜ï¼Œè¿™é‡Œä½¿ç”¨dockerå·ä½œä¸ºæŒ‚è½½ç‚¹ã€‚</li><li>3èŠ‚ç‚¹çš„é›†ç¾¤ï¼Œæ•…éšœä¸€ä¸ªèŠ‚ç‚¹æ—¶ä¸å½±å“å¯¹é›†ç¾¤çš„è¯»å†™æ“ä½œã€‚</li><li>æ‰€æœ‰èŠ‚ç‚¹å‡å®‰è£…dockerï¼Œæ—¶é—´åŒæ­¥ï¼Œå…³é—­é˜²ç«å¢™ä»¥åŠselinux</li></ul><table><thead><tr><th>æœåŠ¡å™¨ip</th><th>æ­å»ºæœåŠ¡</th></tr></thead><tbody><tr><td>192.168.92.10</td><td>minio-1ã€nginxã€keepalive</td></tr><tr><td>192.168.92.11</td><td>minio-2ã€nginxã€keepalive</td></tr><tr><td>192.168.92.12</td><td>minio-3ã€nginxã€keepalive</td></tr><tr><td>192.168.92.50</td><td>è™šæ‹Ÿip</td></tr></tbody></table><h3 id="1ã€æ‰€æœ‰èŠ‚ç‚¹é…ç½®ä¸»æœºåè§£æï¼š"><a href="#1ã€æ‰€æœ‰èŠ‚ç‚¹é…ç½®ä¸»æœºåè§£æï¼š" class="headerlink" title="1ã€æ‰€æœ‰èŠ‚ç‚¹é…ç½®ä¸»æœºåè§£æï¼š"></a>1ã€æ‰€æœ‰èŠ‚ç‚¹é…ç½®ä¸»æœºåè§£æï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">192.168.92.10 minio-1</span><br><span class="hljs-string">192.168.92.11 minio-2</span><br><span class="hljs-string">192.168.92.12 minio-3</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h3 id="2ã€éƒ¨ç½²minioé›†ç¾¤ï¼Œ3ä¸ªèŠ‚ç‚¹æ¯ä¸ªèŠ‚ç‚¹æŒ‚è½½2ä¸ªç›®å½•"><a href="#2ã€éƒ¨ç½²minioé›†ç¾¤ï¼Œ3ä¸ªèŠ‚ç‚¹æ¯ä¸ªèŠ‚ç‚¹æŒ‚è½½2ä¸ªç›®å½•" class="headerlink" title="2ã€éƒ¨ç½²minioé›†ç¾¤ï¼Œ3ä¸ªèŠ‚ç‚¹æ¯ä¸ªèŠ‚ç‚¹æŒ‚è½½2ä¸ªç›®å½•"></a>2ã€éƒ¨ç½²minioé›†ç¾¤ï¼Œ3ä¸ªèŠ‚ç‚¹æ¯ä¸ªèŠ‚ç‚¹æŒ‚è½½2ä¸ªç›®å½•</h3><p>æ³¨æ„ï¼šdockeréƒ¨ç½²é›†ç¾¤æ¨¡å¼æ—¶å¿…é¡»æŒ‡å®šâ€“net&#x3D;hostå‚æ•°ï¼Œä½¿ç”¨ä¸»æœºç½‘ç»œï¼Œä½¿ç”¨ç«¯å£æ˜ å°„æ— æ³•åˆ›å»ºé›†ç¾¤ã€‚</p><p><strong>minio-1èŠ‚ç‚¹æ‰§è¡Œ:</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d --name minio \<br>  --restart=always --net=host \<br>  -e MINIO_ACCESS_KEY=minio \<br>  -e MINIO_SECRET_KEY=minio123 \<br>  -v minio-data1:/data1 \<br>  -v minio-data2:/data2 \<br>  minio/minio server \<br>  --address 192.168.92.10:9000 \<br>  http://minio-&#123;1...3&#125;/data&#123;1...2&#125;<br></code></pre></td></tr></table></figure><p><strong>minio-2èŠ‚ç‚¹æ‰§è¡Œ:</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d --name minio \<br>  --restart=always --net=host \<br>  -e MINIO_ACCESS_KEY=minio \<br>  -e MINIO_SECRET_KEY=minio123 \<br>  -v minio-data1:/data1 \<br>  -v minio-data2:/data2 \<br>  minio/minio server \<br>  --address 192.168.92.11:9000 \<br>  http://minio-&#123;1...3&#125;/data&#123;1...2&#125;<br></code></pre></td></tr></table></figure><p><strong>minio-3èŠ‚ç‚¹æ‰§è¡Œ:</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d --name minio \<br>  --restart=always --net=host \<br>  -e MINIO_ACCESS_KEY=minio \<br>  -e MINIO_SECRET_KEY=minio123 \<br>  -v minio-data1:/data1 \<br>  -v minio-data2:/data2 \<br>  minio/minio server \<br>  --address 192.168.92.12:9000 \<br>  http://minio-&#123;1...3&#125;/data&#123;1...2&#125;<br></code></pre></td></tr></table></figure><h3 id="3ã€æŸ¥çœ‹minioçŠ¶æ€"><a href="#3ã€æŸ¥çœ‹minioçŠ¶æ€" class="headerlink" title="3ã€æŸ¥çœ‹minioçŠ¶æ€"></a>3ã€æŸ¥çœ‹minioçŠ¶æ€</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">mc config host add minio http://minio-1:9000 minio minio12<br><br>mc admin info minio<br><br><span class="hljs-comment">#3ä¸ªèŠ‚ç‚¹åŠæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„Driverså…¨éƒ¨åœ¨çº¿</span><br></code></pre></td></tr></table></figure><h3 id="4ã€ä½¿ç”¨nginx-keepaliveå®ç°è´Ÿè½½å‡è¡¡"><a href="#4ã€ä½¿ç”¨nginx-keepaliveå®ç°è´Ÿè½½å‡è¡¡" class="headerlink" title="4ã€ä½¿ç”¨nginx+keepaliveå®ç°è´Ÿè½½å‡è¡¡"></a>4ã€ä½¿ç”¨nginx+keepaliveå®ç°è´Ÿè½½å‡è¡¡</h3><h4 id="4-1ã€åˆ›å»ºnginxé…ç½®æ–‡ä»¶-2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ"><a href="#4-1ã€åˆ›å»ºnginxé…ç½®æ–‡ä»¶-2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ" class="headerlink" title="4.1ã€åˆ›å»ºnginxé…ç½®æ–‡ä»¶,2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ"></a>4.1ã€åˆ›å»ºnginxé…ç½®æ–‡ä»¶,2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /etc/nginx/conf.d<br><br><span class="hljs-built_in">cat</span> &gt; /etc/nginx/conf.d/minio-lb.conf &lt;&lt; <span class="hljs-string">&#x27;EOF&#x27;</span><br>upstream minio_server &#123;<br>    server 192.168.92.10:9000;<br>    server 192.168.92.11:9000;<br>    server 192.168.92.12:9000;<br>    &#125;<br><br>server &#123;<br>    listen 9001;<br>    server_name  localhost;<br>    ignore_invalid_headers off;<br>    client_max_body_size 0;<br>    proxy_buffering off;<br>    location / &#123;<br>        proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        proxy_set_header X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>        proxy_set_header Host <span class="hljs-variable">$http_host</span>;<br>        proxy_connect_timeout 300;<br>        proxy_http_version 1.1;<br>        proxy_set_header Connection <span class="hljs-string">&quot;&quot;</span>;<br>        chunked_transfer_encoding off;<br>        proxy_pass http://minio_server;<br>    &#125;<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><h4 id="4-2ã€éƒ¨ç½²nginxå®¹å™¨-2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ"><a href="#4-2ã€éƒ¨ç½²nginxå®¹å™¨-2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ" class="headerlink" title="4.2ã€éƒ¨ç½²nginxå®¹å™¨,2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ"></a>4.2ã€éƒ¨ç½²nginxå®¹å™¨,2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d --name nginx \<br>  --restart always -p 9001:9001 \<br>  -v /etc/nginx/conf.d:/etc/nginx/conf.d \<br>  nginx<br><br></code></pre></td></tr></table></figure><h4 id="4-3ã€å‡†å¤‡keepalivedé…ç½®æ–‡ä»¶-2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ"><a href="#4-3ã€å‡†å¤‡keepalivedé…ç½®æ–‡ä»¶-2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ" class="headerlink" title="4.3ã€å‡†å¤‡keepalivedé…ç½®æ–‡ä»¶,2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ"></a>4.3ã€å‡†å¤‡keepalivedé…ç½®æ–‡ä»¶,2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br><span class="hljs-built_in">mkdir</span> /etc/keepalived<br><br><span class="hljs-comment">#æ³¨æ„ä¿®æ”¹interface(æœºå™¨ç½‘å¡)åŠvirtual_ipaddress(è™šæ‹ŸIPåœ°å€)å‚æ•°</span><br><span class="hljs-built_in">cat</span> &gt; /etc/keepalived/keepalived.conf &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">! Configuration File for keepalived</span><br><span class="hljs-string"></span><br><span class="hljs-string">global_defs &#123;</span><br><span class="hljs-string">   router_id minio</span><br><span class="hljs-string">   vrrp_version 2</span><br><span class="hljs-string">   vrrp_garp_master_delay 1</span><br><span class="hljs-string">   script_user root</span><br><span class="hljs-string">   enable_script_security   </span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">vrrp_script chk_nginx &#123;</span><br><span class="hljs-string">    script       &quot;/bin/sh -c &#x27;curl -I http://127.0.0.1:9001 &amp;&gt; /dev/null&#x27;&quot;</span><br><span class="hljs-string">    timeout 3</span><br><span class="hljs-string">    interval 1   # check every 1 second</span><br><span class="hljs-string">    fall 2       # require 2 failures for KO</span><br><span class="hljs-string">    rise 2       # require 2 successes for OK</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">vrrp_instance lb-minio &#123;</span><br><span class="hljs-string">    state BACKUP</span><br><span class="hljs-string">    interface ens33</span><br><span class="hljs-string">    virtual_router_id 51</span><br><span class="hljs-string">    priority 100</span><br><span class="hljs-string">    virtual_ipaddress &#123;</span><br><span class="hljs-string">        192.168.92.50  #è™šæ‹Ÿipåœ°å€</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    track_script &#123;</span><br><span class="hljs-string">        chk_nginx</span><br><span class="hljs-string">    &#125; </span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><br></code></pre></td></tr></table></figure><h4 id="4-4ã€éƒ¨ç½²keepalivedå®¹å™¨ï¼Œ2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ"><a href="#4-4ã€éƒ¨ç½²keepalivedå®¹å™¨ï¼Œ2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ" class="headerlink" title="4.4ã€éƒ¨ç½²keepalivedå®¹å™¨ï¼Œ2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ"></a>4.4ã€éƒ¨ç½²keepalivedå®¹å™¨ï¼Œ2ä¸ªèŠ‚ç‚¹æ‰§è¡Œ</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d --name keepalived \<br>  --restart always \<br>  --cap-add=NET_ADMIN \<br>  --net=host \<br>  -v /etc/keepalived/keepalived.conf:/container/service/keepalived/assets/keepalived.conf \<br>  --detach osixia/keepalived --copy-service<br></code></pre></td></tr></table></figure><p><strong>æµè§ˆå™¨è®¿é—®minio UIï¼Œä½¿ç”¨vipåœ°å€å’Œ9001ç«¯å£</strong></p><h2 id="äºŒã€docker-composeéƒ¨ç½²minio"><a href="#äºŒã€docker-composeéƒ¨ç½²minio" class="headerlink" title="äºŒã€docker-composeéƒ¨ç½²minio"></a>äºŒã€docker-composeéƒ¨ç½²minio</h2><h3 id="1ã€docker-compose-éƒ¨ç½²å•æœºæ¨¡å¼ï¼š"><a href="#1ã€docker-compose-éƒ¨ç½²å•æœºæ¨¡å¼ï¼š" class="headerlink" title="1ã€docker-compose éƒ¨ç½²å•æœºæ¨¡å¼ï¼š"></a>1ã€docker-compose éƒ¨ç½²å•æœºæ¨¡å¼ï¼š</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">minio:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">minio/minio</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">&quot;minio&quot;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">9000</span><span class="hljs-string">:9000</span> <span class="hljs-comment"># api ç«¯å£</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">9001</span><span class="hljs-string">:9001</span> <span class="hljs-comment"># æ§åˆ¶å°ç«¯å£</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">MINIO_ACCESS_KEY:</span> <span class="hljs-string">admin</span>    <span class="hljs-comment">#ç®¡ç†åå°ç”¨æˆ·å</span><br>      <span class="hljs-attr">MINIO_SECRET_KEY:</span> <span class="hljs-string">admin123</span> <span class="hljs-comment">#ç®¡ç†åå°å¯†ç ï¼Œæœ€å°8ä¸ªå­—ç¬¦</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/docker/minio/data:/data</span>               <span class="hljs-comment">#æ˜ å°„å½“å‰ç›®å½•ä¸‹çš„dataç›®å½•è‡³å®¹å™¨å†…/dataç›®å½•</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/docker/minio/config:/root/.minio/</span>     <span class="hljs-comment">#æ˜ å°„é…ç½®ç›®å½•</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">server</span> <span class="hljs-string">--console-address</span> <span class="hljs-string">&#x27;:9001&#x27;</span> <span class="hljs-string">/data</span>  <span class="hljs-comment">#æŒ‡å®šå®¹å™¨ä¸­çš„ç›®å½• /data</span><br>    <span class="hljs-attr">privileged:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br></code></pre></td></tr></table></figure><h3 id="2ã€docker-compose-éƒ¨ç½²å¤šåˆ†å¸ƒå¼å®ä¾‹ï¼š"><a href="#2ã€docker-compose-éƒ¨ç½²å¤šåˆ†å¸ƒå¼å®ä¾‹ï¼š" class="headerlink" title="2ã€docker-compose éƒ¨ç½²å¤šåˆ†å¸ƒå¼å®ä¾‹ï¼š"></a>2ã€docker-compose éƒ¨ç½²å¤šåˆ†å¸ƒå¼å®ä¾‹ï¼š</h3><p>æ³¨æ„ï¼šdocker-composeåªèƒ½åœ¨å•ä¸»æœºéƒ¨ç½²å¤šä¸ªåˆ†å¸ƒå¼MinIOå®ä¾‹ï¼Œåˆ†å¸ƒå¼MinIOå®ä¾‹å°†éƒ¨ç½²åœ¨åŒä¸€ä¸»æœºä¸Šçš„å¤šä¸ªå®¹å™¨ä¸­:<br>å®‰è£…docker-composeåï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> -p /date/minio<br><span class="hljs-built_in">cd</span> /date/minio<br><br>wget https://raw.githubusercontent.com/minio/minio/master/docs/orchestration/docker-compose/docker-compose.yaml<br>wget https://raw.githubusercontent.com/minio/minio/master/docs/orchestration/docker-compose/nginx.conf<br><br>docker-compose up -d<br><br></code></pre></td></tr></table></figure><p><strong>docker-compose.yaml:</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.7&#x27;</span><br><br><span class="hljs-comment"># Settings and configurations that are common for all containers</span><br><span class="hljs-attr">x-minio-common:</span> <span class="hljs-string">&amp;minio-common</span><br>  <span class="hljs-attr">image:</span> <span class="hljs-string">quay.io/minio/minio:RELEASE.2022-09-17T00-09-45Z</span><br>  <span class="hljs-attr">command:</span> <span class="hljs-string">server</span> <span class="hljs-string">--console-address</span> <span class="hljs-string">&quot;:9001&quot;</span> <span class="hljs-string">http://minio&#123;1...4&#125;/data&#123;1...2&#125;</span><br>  <span class="hljs-attr">expose:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9000&quot;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9001&quot;</span><br>  <span class="hljs-comment"># environment:  è´¦å·å¯†ç ï¼Œç™»å½•éœ€è¦å–æ¶ˆæ³¨é‡Š</span><br>    <span class="hljs-comment"># MINIO_ROOT_USER: minioadmin</span><br>    <span class="hljs-comment"># MINIO_ROOT_PASSWORD: minioadmin</span><br>  <span class="hljs-attr">healthcheck:</span><br>    <span class="hljs-attr">test:</span> [<span class="hljs-string">&quot;CMD&quot;</span>, <span class="hljs-string">&quot;curl&quot;</span>, <span class="hljs-string">&quot;-f&quot;</span>, <span class="hljs-string">&quot;http://localhost:9000/minio/health/live&quot;</span>]<br>    <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span><br>    <span class="hljs-attr">timeout:</span> <span class="hljs-string">20s</span><br>    <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span><br><br><span class="hljs-comment"># starts 4 docker containers running minio server instances.</span><br><span class="hljs-comment"># using nginx reverse proxy, load balancing, you can access</span><br><span class="hljs-comment"># it through port 9000.</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">minio1:</span><br>    <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-string">*minio-common</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">minio1</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">data1-1:/data1</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">data1-2:/data2</span><br><br>  <span class="hljs-attr">minio2:</span><br>    <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-string">*minio-common</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">minio2</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">data2-1:/data1</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">data2-2:/data2</span><br><br>  <span class="hljs-attr">minio3:</span><br>    <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-string">*minio-common</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">minio3</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">data3-1:/data1</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">data3-2:/data2</span><br><br>  <span class="hljs-attr">minio4:</span><br>    <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-string">*minio-common</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">minio4</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">data4-1:/data1</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">data4-2:/data2</span><br><br>  <span class="hljs-attr">nginx:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:1.19.2-alpine</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./nginx.conf:/etc/nginx/nginx.conf:ro</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9000:9000&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9001:9001&quot;</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">minio1</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">minio2</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">minio3</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">minio4</span><br><br><span class="hljs-comment">## By default this config uses default local driver,</span><br><span class="hljs-comment">## For custom volumes replace with volume driver configuration.</span><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">data1-1:</span><br>  <span class="hljs-attr">data1-2:</span><br>  <span class="hljs-attr">data2-1:</span><br>  <span class="hljs-attr">data2-2:</span><br>  <span class="hljs-attr">data3-1:</span><br>  <span class="hljs-attr">data3-2:</span><br>  <span class="hljs-attr">data4-1:</span><br>  <span class="hljs-attr">data4-2:</span><br></code></pre></td></tr></table></figure><p><strong>nginx.conf:</strong> </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs conf">user  nginx;<br>worker_processes  auto;<br><br>error_log  /var/log/nginx/error.log warn;<br>pid        /var/run/nginx.pid;<br><br>events &#123;<br>    worker_connections  4096;<br>&#125;<br><br>http &#123;<br>    include       /etc/nginx/mime.types;<br>    default_type  application/octet-stream;<br><br>    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;<br>                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;<br>                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;<br><br>    access_log  /var/log/nginx/access.log  main;<br>    sendfile        on;<br>    keepalive_timeout  65;<br><br>    # include /etc/nginx/conf.d/*.conf;<br><br>    upstream minio &#123;<br>        server minio1:9000;<br>        server minio2:9000;<br>        server minio3:9000;<br>        server minio4:9000;<br>    &#125;<br><br>    upstream console &#123;<br>        ip_hash;<br>        server minio1:9001;<br>        server minio2:9001;<br>        server minio3:9001;<br>        server minio4:9001;<br>    &#125;<br><br>    server &#123;<br>        listen       9000;<br>        listen  [::]:9000;<br>        server_name  localhost;<br><br>        # To allow special characters in headers<br>        ignore_invalid_headers off;<br>        # Allow any size file to be uploaded.<br>        # Set to a value such as 1000m; to restrict file size to a specific value<br>        client_max_body_size 0;<br>        # To disable buffering<br>        proxy_buffering off;<br>        proxy_request_buffering off;<br><br>        location / &#123;<br>            proxy_set_header Host $http_host;<br>            proxy_set_header X-Real-IP $remote_addr;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Forwarded-Proto $scheme;<br><br>            proxy_connect_timeout 300;<br>            # Default is HTTP/1, keepalive is only enabled in HTTP/1.1<br>            proxy_http_version 1.1;<br>            proxy_set_header Connection &quot;&quot;;<br>            chunked_transfer_encoding off;<br><br>            proxy_pass http://minio;<br>        &#125;<br>    &#125;<br><br>    server &#123;<br>        listen       9001;<br>        listen  [::]:9001;<br>        server_name  localhost;<br><br>        # To allow special characters in headers<br>        ignore_invalid_headers off;<br>        # Allow any size file to be uploaded.<br>        # Set to a value such as 1000m; to restrict file size to a specific value<br>        client_max_body_size 0;<br>        # To disable buffering<br>        proxy_buffering off;<br>        proxy_request_buffering off;<br><br>        location / &#123;<br>            proxy_set_header Host $http_host;<br>            proxy_set_header X-Real-IP $remote_addr;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Forwarded-Proto $scheme;<br>            proxy_set_header X-NginX-Proxy true;<br><br>            # This is necessary to pass the correct IP to be hashed<br>            real_ip_header X-Real-IP;<br><br>            proxy_connect_timeout 300;<br>            <br>            # To support websocket<br>            proxy_http_version 1.1;<br>            proxy_set_header Upgrade $http_upgrade;<br>            proxy_set_header Connection &quot;upgrade&quot;;<br>            <br>            chunked_transfer_encoding off;<br><br>            proxy_pass http://console;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨nginxè¿›è¡Œäº†è´Ÿè½½å‡è¡¡ï¼Œæµè§ˆå™¨è®¿é—®http:localhost:9000ï¼Œç™»å½•çš„è´¦å·å¯†ç éœ€è¦å°†docker-composeä¸­environment<code>å–æ¶ˆæ³¨é‡Š</code>,<br>é»˜è®¤æƒ…å†µä¸‹ä¼šåˆ›å»º4ä¸ªminioå®ä¾‹</strong></p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>Minio</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Minio</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­å»ºåˆ†å¸ƒå¼å­˜å‚¨æœåŠ¡minio</title>
    <link href="/2023/03/28/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/%E6%90%AD%E5%BB%BA%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1minio%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B/"/>
    <url>/2023/03/28/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/%E6%90%AD%E5%BB%BA%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1minio%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="æ­å»ºåˆ†å¸ƒå¼å­˜å‚¨æœåŠ¡minioè¯¦ç»†è¿‡ç¨‹"><a href="#æ­å»ºåˆ†å¸ƒå¼å­˜å‚¨æœåŠ¡minioè¯¦ç»†è¿‡ç¨‹" class="headerlink" title="æ­å»ºåˆ†å¸ƒå¼å­˜å‚¨æœåŠ¡minioè¯¦ç»†è¿‡ç¨‹"></a>æ­å»ºåˆ†å¸ƒå¼å­˜å‚¨æœåŠ¡minioè¯¦ç»†è¿‡ç¨‹</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/yhj_911/article/details/122607159<br>å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/hahaha111122222/p/15990604.html<br>å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/qq_43437874/article/details/109608069<br>minioåˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼šhttps://blog.csdn.net/yujia_666/article/details/121637775<br></code></pre></td></tr></table></figure><p><strong>æ­å»ºç¯å¢ƒï¼š</strong></p><table><thead><tr><th>æœåŠ¡å™¨ip</th><th>æœåŠ¡å™¨é…ç½®</th></tr></thead><tbody><tr><td>192.168.62.128</td><td>4G+4CPU+40G</td></tr><tr><td>192.168.62.129</td><td>4G+4CPU+40G</td></tr></tbody></table><h2 id="1ã€åˆ›å»ºç›®å½•"><a href="#1ã€åˆ›å»ºç›®å½•" class="headerlink" title="1ã€åˆ›å»ºç›®å½•"></a>1ã€åˆ›å»ºç›®å½•</h2><p>æœ¬é›†ç¾¤ç”±2å°æœåŠ¡å™¨æ„æˆï¼ˆå®˜æ–¹æ¨èé›†ç¾¤æœ€å°4å°æœåŠ¡å™¨ï¼‰ï¼Œæ¯ä¸ªæœåŠ¡å™¨ä¸ŠæŒ‚è½½å››ä¸ªç£ç›˜ç›®å½•ï¼Œå››ä¸ªç›®å½•çš„åŸå› ï¼šæ¨¡æ‹Ÿç”±ä¸€å°æœåŠ¡å™¨æ‰©å®¹åˆ°ä¸¤å°æœåŠ¡å™¨ã€‚</p><p>æ³¨æ„ï¼šåœ¨ä¸€å°ä¸»æœºä¸Šåˆ›å»º4ä¸ªä¸åŒçš„è·¯å¾„æ¨¡æ‹Ÿ4ä¸ªä¸åŒçš„ç£ç›˜æ¥è¿›è¡Œã€‚è¿™ç§æ–¹å¼è¡Œä¸é€š!</p><p><img src="/2023/03/28/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/%E6%90%AD%E5%BB%BA%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1minio%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B/image-20220921161607211.png" alt="192.168.62.128æœºå™¨"></p><p><img src="/2023/03/28/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/%E6%90%AD%E5%BB%BA%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1minio%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B/image-20220921160920315.png" alt="192.168.62.129æœºå™¨"></p><p>æ•°æ®å­˜å‚¨ç›®å½•ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino">mkdir -p /home/minio/data1<br>mkdir -p /home/minio/data2<br>mkdir -p /home/minio/data3<br>mkdir -p /home/minio/data4<br></code></pre></td></tr></table></figure><p>å¯åŠ¨è„šæœ¬ç›®å½•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mkdir -p <span class="hljs-regexp">/opt/mi</span>nio<br></code></pre></td></tr></table></figure><p>é…ç½®åŸŸåï¼Œåœ¨&#x2F;etc&#x2F;hostsä¸­ï¼Œè¿½åŠ å¦‚ä¸‹å†…å®¹ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">cat &gt;&gt; /etc/hosts &lt;&lt; EOF<br><span class="hljs-number">192.168.62.128</span>  minio-<span class="hljs-number">1</span><br><span class="hljs-number">192.168.62.129</span>  minio-<span class="hljs-number">2</span><br>EOF<br></code></pre></td></tr></table></figure><h2 id="2ã€ç¼–å†™é›†ç¾¤å¯åŠ¨è„šæœ¬ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰"><a href="#2ã€ç¼–å†™é›†ç¾¤å¯åŠ¨è„šæœ¬ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰" class="headerlink" title="2ã€ç¼–å†™é›†ç¾¤å¯åŠ¨è„šæœ¬ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰"></a>2ã€ç¼–å†™é›†ç¾¤å¯åŠ¨è„šæœ¬ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /opt/minio/run.sh<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>export MINIO_ACCESS_KEY=Minio<br>export MINIO_SECRET_KEY=Test123456<br> <br>/opt/minio/minio server --config-dir /etc/minio \<br>http://minio-&#123;1...2&#125;/home/minio/data&#123;1...4&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">http://minio-&#123;1...1&#125;/home/minio/data&#123;1...4&#125; http://minio-&#123;2...2&#125;/home/minio/data&#123;1...4&#125;</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœä»¥åæƒ³æ‰©å®¹ï¼Œå¿…é¡»ç”¨è¿™ç§æ–¹å¼&#123;&#125;</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœåªæœ‰ä¸€å°æœåŠ¡å™¨åªæ‰§è¡Œhttp://minio-&#123;1...1&#125;/home/minio/data&#123;1...4&#125;</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœä¸¤å°æœåŠ¡å™¨http://minio-&#123;1...2&#125;/home/minio/data&#123;1...4&#125;</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰©å®¹æ—¶è¿½åŠ http://minio-&#123;2...2&#125;/home/minio/data&#123;1...4&#125;</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç»è¿‡éªŒè¯ï¼Œä¸€ä¸ªæ–‡ä»¶è¦ä¹ˆå­˜å‚¨åˆ°æºå­˜å‚¨ä¸­ï¼Œè¦ä¹ˆå­˜å‚¨åˆ°æ‰©å®¹åçš„å­˜å‚¨ä¸­</span><br></code></pre></td></tr></table></figure><h2 id="3ã€ç¼–å†™æœåŠ¡è„šæœ¬ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰"><a href="#3ã€ç¼–å†™æœåŠ¡è„šæœ¬ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰" class="headerlink" title="3ã€ç¼–å†™æœåŠ¡è„šæœ¬ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰"></a>3ã€ç¼–å†™æœåŠ¡è„šæœ¬ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs routeros">vim /usr/lib/systemd/system/minio.service<br> <br>[Unit]<br><span class="hljs-attribute">Description</span>=Minio<span class="hljs-built_in"> service</span><br><span class="hljs-built_in"></span><span class="hljs-attribute">Documentation</span>=https://docs.minio.io/<br> <br>[Service]<br><span class="hljs-attribute">WorkingDirectory</span>=/opt/minio/<br><span class="hljs-attribute">ExecStart</span>=/opt/minio/run.sh<br> <br><span class="hljs-attribute">Restart</span>=on-failure<br><span class="hljs-attribute">RestartSec</span>=5<br> <br>[Install]<br><span class="hljs-attribute">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><h2 id="4ã€è¿½åŠ æƒé™ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰"><a href="#4ã€è¿½åŠ æƒé™ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰" class="headerlink" title="4ã€è¿½åŠ æƒé™ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰"></a>4ã€è¿½åŠ æƒé™ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">chmod +x <span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/systemd/</span>system/minio.service<br><span class="hljs-comment">#åˆ·æ–°æœåŠ¡</span><br>systemctl daemon-reload<br><br>wget https:<span class="hljs-regexp">//</span>dl.minio.io<span class="hljs-regexp">/server/mi</span>nio<span class="hljs-regexp">/release/</span>linux-amd64<span class="hljs-regexp">/minio -P /</span>opt/minio<br><span class="hljs-comment">#-p ä¸‹è½½minioåˆ°/opt/minioä¸­</span><br>chmod +x minio<br>chmod +x <span class="hljs-regexp">/opt/mi</span>nio/run.sh<br></code></pre></td></tr></table></figure><h2 id="5ã€å¯åŠ¨ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰"><a href="#5ã€å¯åŠ¨ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰" class="headerlink" title="5ã€å¯åŠ¨ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰"></a>5ã€å¯åŠ¨ï¼ˆä¸¤å°æœåŠ¡å™¨ï¼‰</h2><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl start minio<br><span class="hljs-params">system</span>ctl enable minio<br><span class="hljs-params">system</span>ctl stop minio<br></code></pre></td></tr></table></figure><h2 id="6ã€ç™»å½•ã€æµ‹è¯•ï¼ˆä¸¤ä¸ªåœ°å€éƒ½å¯ä»¥çœ‹ï¼Œéƒ¨åˆ†ä¸»æ¬¡ï¼‰"><a href="#6ã€ç™»å½•ã€æµ‹è¯•ï¼ˆä¸¤ä¸ªåœ°å€éƒ½å¯ä»¥çœ‹ï¼Œéƒ¨åˆ†ä¸»æ¬¡ï¼‰" class="headerlink" title="6ã€ç™»å½•ã€æµ‹è¯•ï¼ˆä¸¤ä¸ªåœ°å€éƒ½å¯ä»¥çœ‹ï¼Œéƒ¨åˆ†ä¸»æ¬¡ï¼‰"></a>6ã€ç™»å½•ã€æµ‹è¯•ï¼ˆä¸¤ä¸ªåœ°å€éƒ½å¯ä»¥çœ‹ï¼Œéƒ¨åˆ†ä¸»æ¬¡ï¼‰</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">62.128</span>:<span class="hljs-number">9000</span>  (è¾“å…¥è´¦å·å¯†ç å³å¯ï¼Œrun.shè„šæœ¬å†…çš„MINIO_ACCESS_KEYã€MINIO_SECRET_KEYå°±æ˜¯è´¦å·å’Œå¯†ç )<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">62.129</span>:<span class="hljs-number">9000</span><br></code></pre></td></tr></table></figure><h2 id="7ã€ä½¿ç”¨nginxå®ç°è´Ÿè½½å‡è¡¡"><a href="#7ã€ä½¿ç”¨nginxå®ç°è´Ÿè½½å‡è¡¡" class="headerlink" title="7ã€ä½¿ç”¨nginxå®ç°è´Ÿè½½å‡è¡¡"></a>7ã€ä½¿ç”¨nginxå®ç°è´Ÿè½½å‡è¡¡</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> minio&#123;<br>        <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.62.128:9000</span>;<br>        <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.62.129:9000</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">19000</span>;<br>        <span class="hljs-comment">#server_name minio;</span><br>        <span class="hljs-section">location</span> / &#123;<br>            <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$http_host</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$remote_addr</span>;<br>            <span class="hljs-attribute">client_body_buffer_size</span> <span class="hljs-number">10M</span>;<br>            <span class="hljs-attribute">client_max_body_size</span> <span class="hljs-number">10G</span>;<br>            <span class="hljs-attribute">proxy_buffers</span> <span class="hljs-number">1024</span> <span class="hljs-number">4k</span>;<br>            <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">300</span>;<br>            <span class="hljs-attribute">proxy_next_upstream</span> <span class="hljs-literal">error</span> timeout http_404;<br>            <span class="hljs-attribute">proxy_pass</span> http://minio;<br>        &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>Minio</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Minio</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLä½¿ç”¨binlogæ¢å¤æ•°æ®</title>
    <link href="/2023/03/28/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL%E4%BD%BF%E7%94%A8binlog%E6%81%A2%E5%A4%8D%E6%95%B0%E6%8D%AE/"/>
    <url>/2023/03/28/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL%E4%BD%BF%E7%94%A8binlog%E6%81%A2%E5%A4%8D%E6%95%B0%E6%8D%AE/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="MySQLä½¿ç”¨binlogæ¢å¤æ•°æ®"><a href="#MySQLä½¿ç”¨binlogæ¢å¤æ•°æ®" class="headerlink" title="MySQLä½¿ç”¨binlogæ¢å¤æ•°æ®"></a>MySQLä½¿ç”¨binlogæ¢å¤æ•°æ®</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/p2073123/article/details/126487588?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1-126487588-blog-108519295.pc_relevant_default&amp;spm=1001.2101.3001.4242.2&amp;utm_relevant_index=4<br>å‚è€ƒæ–‡æ¡£2ï¼šhttps://www.cnblogs.com/michael9/p/11923483.html<br></code></pre></td></tr></table></figure><p><strong>binlogçš„ä¸‰ç§æ¨¡å¼</strong></p><p>statementï¼šè®°å½•æ¯ä¸€æ¡ä¿®æ”¹æ•°æ®çš„sql<br>rowï¼šä¿å­˜å“ªæ¡è®°å½•è¢«ä¿®æ”¹<br>mixedï¼šå…¼é¡¾å‰ä¸¤è€…çš„ä¼˜ç‚¹ã€‚</p><h2 id="æ¢å¤æ•°æ®åˆ°æŸä¸ªæ—¶é—´ç‚¹"><a href="#æ¢å¤æ•°æ®åˆ°æŸä¸ªæ—¶é—´ç‚¹" class="headerlink" title="æ¢å¤æ•°æ®åˆ°æŸä¸ªæ—¶é—´ç‚¹"></a>æ¢å¤æ•°æ®åˆ°æŸä¸ªæ—¶é—´ç‚¹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># æŸ¥çœ‹binlogæœ‰æ²¡æœ‰å¼€å¯</span><br>SHOW VARIABLES LIKE <span class="hljs-string">&#x27;log_bin%&#x27;</span>;<br><span class="hljs-comment"># æŸ¥çœ‹å½“å‰binlogçš„æ¨¡å¼</span><br>SHOW VARIABLES LIKE <span class="hljs-string">&#x27;binlog%&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯</span><br>mysqlbinlog --no-defaults --database=<span class="hljs-built_in">test</span> --base64-output=decode-rows --skip-gtids --stop-datetime=<span class="hljs-string">&#x27;2023-3-7 10:40:00&#x27;</span> /data/mysql-bin.000007 | less <br>:G <span class="hljs-comment">#å¯æŸ¥çœ‹æœ€åä¸€è¡Œ</span><br><br><br>æ³¨æ„ï¼šåŠ ä¸Š`--base64-output=decode-rows`å‚æ•°å¯¼å‡ºçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥åˆ†æï¼Œå†³å®šæ¢å¤å“ªäº›æ—¶é—´æ®µå†…çš„ï¼Œæˆ–è€…å“ªäº› äº‹åŠ¡åŒºé—´æ®µå†…çš„ã€‚è¿™æ ·å°±èƒ½æ‰¾åˆ° ç¬¬äºŒæ­¥çš„ å¼€å§‹æ—¶é—´ ç»“æŸæ—¶é—´ æˆ–è€…äº‹åŠ¡åŒºé—´ çš„å¼€å§‹äº‹åŠ¡èŠ‚ç‚¹ï¼Œç»“æŸäº‹åŠ¡èŠ‚ç‚¹ã€‚è€Œå¯¼å‡ºæ¢å¤æ•°æ®.sqlæ–‡ä»¶æ—¶ã€ä¸€å®šä¸èƒ½åœ¨å‘½ä»¤ä¸­åŠ  --base64-output=decode-rows<br><br><br>æ‰¾åˆ°ç›¸å…³ä¿¡æ¯åï¼š<br><span class="hljs-comment">#ä½¿ç”¨binlogï¼ŒåŸºäºæ—¶é—´ç‚¹å¯¼å‡ºæ•°æ®</span><br>mysqlbinlog --no-defaults --database=coinpay  --skip-gtids --stop-datetime=<span class="hljs-string">&#x27;2023-3-7 10:40:00&#x27;</span> /data/mysql-bin.000007 &gt; /opt/binlog.sql<br><br><br><span class="hljs-comment">#åœ¨ MySQL å®¢æˆ·ç«¯å‘½ä»¤è¡Œè¿›å…¥</span><br><span class="hljs-comment">#å‘½ä»¤è¡Œç™»å½•mysqlæ‰§è¡Œ</span><br>&gt; use <span class="hljs-built_in">test</span>ã€<br>&gt; <span class="hljs-built_in">source</span> /opt/binlog.sql<br></code></pre></td></tr></table></figure><h2 id="æ¢å¤æ•°æ®å¯é‡‡ç”¨æ–¹å¼"><a href="#æ¢å¤æ•°æ®å¯é‡‡ç”¨æ–¹å¼" class="headerlink" title="æ¢å¤æ•°æ®å¯é‡‡ç”¨æ–¹å¼"></a>æ¢å¤æ•°æ®å¯é‡‡ç”¨æ–¹å¼</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">åŸºäºæ—¶é—´ç‚¹:<br><span class="hljs-comment"># èµ·å§‹æ—¶é—´</span><br>mysqlbinlog --start-datetime=<span class="hljs-string">&#x27;2016-01-04 15:11:00&#x27;</span><br><span class="hljs-comment"># ç»“æŸæ—¶é—´</span><br>mysqlbinlog --stop-datetime=<span class="hljs-string">&#x27;2016-01-04 15:11:00&#x27;</span> <br><br>åŸºäºå®šä½ç¬¦:<br><span class="hljs-comment"># èµ·å§‹å®šä½ç¬¦</span><br>mysqlbinlog --start-position=249 binlog.000006<br><span class="hljs-comment"># ç»“æŸå®šä½ç¬¦</span><br>mysqlbinlog --stop-position=249 binlog.000006<br> <br><span class="hljs-comment">#æŒ‡å®šè¡¨</span><br><span class="hljs-comment">#ä½¿ç”¨ grep å‘½ä»¤æŠ½å–äºŒè¿›åˆ¶æ—¥å¿—ï¼š</span><br>grep -B3 -w tb_name db_name.sql &gt; tb_name.sql<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL5.7å‡çº§åˆ°æœ€æ–°ç‰ˆ</title>
    <link href="/2023/03/27/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL5.7%E5%8D%87%E7%BA%A7%E5%88%B0%E6%9C%80%E6%96%B0%E7%89%88/"/>
    <url>/2023/03/27/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL5.7%E5%8D%87%E7%BA%A7%E5%88%B0%E6%9C%80%E6%96%B0%E7%89%88/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="MySQL5-7å‡çº§åˆ°æœ€æ–°ç‰ˆ"><a href="#MySQL5-7å‡çº§åˆ°æœ€æ–°ç‰ˆ" class="headerlink" title="MySQL5.7å‡çº§åˆ°æœ€æ–°ç‰ˆ"></a>MySQL5.7å‡çº§åˆ°æœ€æ–°ç‰ˆ</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/qq_41788609/article/details/118147232<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€ç”¨mysqldumpå¤‡ä»½ï¼Œå†å®‰è£…æ–°ç‰ˆæœ¬ï¼Œæ¢å¤sqlæ–‡ä»¶ï¼ˆç”¨äºæ•°æ®é‡å°çš„å‡çº§ï¼‰"><a href="#ä¸€ã€ç”¨mysqldumpå¤‡ä»½ï¼Œå†å®‰è£…æ–°ç‰ˆæœ¬ï¼Œæ¢å¤sqlæ–‡ä»¶ï¼ˆç”¨äºæ•°æ®é‡å°çš„å‡çº§ï¼‰" class="headerlink" title="ä¸€ã€ç”¨mysqldumpå¤‡ä»½ï¼Œå†å®‰è£…æ–°ç‰ˆæœ¬ï¼Œæ¢å¤sqlæ–‡ä»¶ï¼ˆç”¨äºæ•°æ®é‡å°çš„å‡çº§ï¼‰"></a>ä¸€ã€ç”¨mysqldumpå¤‡ä»½ï¼Œå†å®‰è£…æ–°ç‰ˆæœ¬ï¼Œæ¢å¤sqlæ–‡ä»¶ï¼ˆç”¨äºæ•°æ®é‡å°çš„å‡çº§ï¼‰</h2><p>mysqldump -uroot -pâ€™123456â€™ â€“single-transaction â€“master-data&#x3D;1 â€“all-databases &gt; all.sql</p><h2 id="äºŒã€ä»¥ä¸‹é€šè¿‡mysql-upgradeå‡çº§ï¼š"><a href="#äºŒã€ä»¥ä¸‹é€šè¿‡mysql-upgradeå‡çº§ï¼š" class="headerlink" title="äºŒã€ä»¥ä¸‹é€šè¿‡mysql_upgradeå‡çº§ï¼š"></a>äºŒã€ä»¥ä¸‹é€šè¿‡mysql_upgradeå‡çº§ï¼š</h2><p>è¯´æ˜ï¼š<br>mysql_upgradeæ˜¯å®˜æ–¹æä¾›çš„MySQLå‡çº§å·¥å…·ï¼Œæ”¯æŒè·¨å¤§ç‰ˆæœ¬å‡çº§ï¼Œå¦‚5.0å‡çº§åˆ°5.7ã€‚ä½†ä¸ºäº†æ•°æ®å®‰å…¨ï¼Œåœ¨å‡çº§å‰åŠ¡å¿…åšå¥½å¤‡ä»½ã€‚<br>å¦‚æœæ˜¯ä¸»ä»æ¶æ„ï¼ŒæŒ‰ç…§å…ˆå‡çº§ä»åº“â€“&gt;å†å‡çº§ä¸»åº“çš„æ­¥éª¤å®ç°å‡çº§ã€‚ä¸»åº“ç‰ˆæœ¬ä¸èƒ½é«˜äºä»åº“ï¼Œé¿å…æ–°ç‰¹æ€§åœ¨ä»åº“ä¸Šä¸æ”¯æŒã€‚<br>mysql_upgradeæ£€æŸ¥æ‰€æœ‰æ•°æ®åº“ä¸­ä¸mysqlæœåŠ¡å™¨å½“å‰ç‰ˆæœ¬ä¸å…¼å®¹çš„æ‰€æœ‰è¡¨.ã€‚<br>mysql_upgradeä¹Ÿä¼šå‡çº§ç³»ç»Ÿè¡¨ï¼Œä»¥ä¾¿ä½ èƒ½ä½¿ç”¨æ–°æ·»åŠ çš„æƒé™æˆ–åŠŸèƒ½ã€‚<br>å¦‚æœmysql_upgradeå‘ç°ä¸€å¼ è¡¨å¯èƒ½ä¸å…¼å®¹ï¼Œå°†è¯¥è¡¨è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœå‘ç°é—®é¢˜ï¼Œåˆ™è¯•å›¾å¯¹å…¶è¿›è¡Œä¿®å¤ã€‚å¦‚æœä¸èƒ½ä¿®å¤ï¼Œåˆ™éœ€è¦äººå·¥è¿›è¡Œè¡¨å’Œç´¢å¼•é‡å»ºæˆ–ä¿®å¤ã€‚<br>æ¯æ¬¡å‡çº§mysqlï¼Œéƒ½éœ€è¦è¿è¡Œmysql_upgradeã€‚</p><p><strong>mysqlå®‰è£…è·¯å¾„ä¸º&#x2F;app&#x2F;mysqlä¸‹ï¼Œä½¿ç”¨æ–‡æ¡£ï¼šã€ŠäºŒè¿›åˆ¶å®‰è£…mysqlã€‹</strong></p><h3 id="1-åœæœ"><a href="#1-åœæœ" class="headerlink" title="1. åœæœ"></a>1. åœæœ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">service mysqld stop<br></code></pre></td></tr></table></figure><h3 id="2-å¤‡ä»½ï¼š"><a href="#2-å¤‡ä»½ï¼š" class="headerlink" title="2. å¤‡ä»½ï¼š"></a>2. å¤‡ä»½ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿›å…¥äºŒè¿›åˆ¶å®‰è£…è·¯å¾„</span><br><span class="hljs-built_in">cd</span> /app/mysql/<br><br><span class="hljs-comment">#å¤‡ä»½æ•°æ®ç›®å½•</span><br><span class="hljs-built_in">cp</span> -a data/ /root/data<br><br><span class="hljs-comment">#å¤‡ä»½æ•´ä¸ªå®‰è£…åŒ…æ–‡ä»¶</span><br><span class="hljs-built_in">mv</span> mysql-5.7.32 mysql-5.7.32-bak<br><br><span class="hljs-comment">#å¤‡ä»½my.cnf</span><br><span class="hljs-built_in">mv</span> /etc/my.cnf /etc/my.cnfbak<br><br><span class="hljs-comment">#å¤‡ä»½mysqld</span><br><span class="hljs-built_in">mv</span> /etc/init.d/mysqld /etc/init.d/mysqldbak<br></code></pre></td></tr></table></figure><h3 id="3-å®‰è£…æ–°ç‰ˆæœ¬ï¼š"><a href="#3-å®‰è£…æ–°ç‰ˆæœ¬ï¼š" class="headerlink" title="3. å®‰è£…æ–°ç‰ˆæœ¬ï¼š"></a>3. å®‰è£…æ–°ç‰ˆæœ¬ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è§£å‹ä¸Šä¼ çš„æ–°ç‰ˆæœ¬æ–‡ä»¶</span><br>tar -xnf mysql-5.7.38-el7-x86_64.tar.gz<br><br><span class="hljs-comment">#æ›´å</span><br><span class="hljs-built_in">mv</span> mysql-5.7.38-el7-x86_64 mysql-5.7.38<br><br><span class="hljs-comment">#åˆ é™¤æ—§çš„è½¯é“¾æ¥ï¼Œè®¾ç½®æ–°çš„è½¯é“¾æ¥ï¼ˆå¦‚æœä¹‹å‰ç‰ˆæœ¬æœªè®¾ç½®è½¯é“¾æ¥ï¼Œåˆ™è·³è¿‡è¯¥æ­¥éª¤ï¼‰</span><br><span class="hljs-built_in">rm</span> -r /app/mysql <br><span class="hljs-built_in">ln</span> -sv /app/mysql-5.7.38 /app/mysql<br><span class="hljs-built_in">chown</span> -R mysql.mysql /app/mysql<br><br><span class="hljs-comment">#æ¢å¤my.cnf</span><br><span class="hljs-built_in">cp</span> /etc/my.cnfbak /etc/my.cnf<br><br><span class="hljs-comment">#åˆå§‹åŒ– mysqld</span><br>/app/mysql/bin/mysqld --initialize --user=mysql --basedir=/app/mysql --datadir=/app/mysql/data<br><br><span class="hljs-comment">#å°†å¯åŠ¨è„šæœ¬æ”¾åˆ°å¼€æœºåˆå§‹åŒ–ç›®å½•å†…</span><br><span class="hljs-built_in">cp</span> /app/mysql/support-files/mysql.server /etc/init.d/mysqld <br>sed -i <span class="hljs-string">&#x27;s#/usr/local#/app#g&#x27;</span> /app/mysql/bin/mysqld_safe /etc/init.d/mysqld<br>sed -i  <span class="hljs-string">&quot;47a basedir=/app/mysql\ndatadir=/app/mysql/data&quot;</span> /etc/init.d/mysqld <br></code></pre></td></tr></table></figure><h3 id="4-å¤‡ä»½æ–°ç‰ˆæœ¬æ•°æ®ç›®å½•data"><a href="#4-å¤‡ä»½æ–°ç‰ˆæœ¬æ•°æ®ç›®å½•data" class="headerlink" title="4. å¤‡ä»½æ–°ç‰ˆæœ¬æ•°æ®ç›®å½•data"></a>4. å¤‡ä»½æ–°ç‰ˆæœ¬æ•°æ®ç›®å½•data</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mv</span> data/ databak<br></code></pre></td></tr></table></figure><h3 id="5-è¿˜åŸæ—§ç‰ˆæœ¬æ•°æ®ç›®å½•data"><a href="#5-è¿˜åŸæ—§ç‰ˆæœ¬æ•°æ®ç›®å½•data" class="headerlink" title="5. è¿˜åŸæ—§ç‰ˆæœ¬æ•°æ®ç›®å½•data"></a>5. è¿˜åŸæ—§ç‰ˆæœ¬æ•°æ®ç›®å½•data</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mv</span> /root/data /app/mysql<br></code></pre></td></tr></table></figure><h3 id="6-å¯åŠ¨"><a href="#6-å¯åŠ¨" class="headerlink" title="6. å¯åŠ¨"></a>6. å¯åŠ¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">service mysqld start<br></code></pre></td></tr></table></figure><h3 id="7-æ‰§è¡Œmysql-upgradeå‡çº§"><a href="#7-æ‰§è¡Œmysql-upgradeå‡çº§" class="headerlink" title="7. æ‰§è¡Œmysql_upgradeå‡çº§"></a>7. æ‰§è¡Œmysql_upgradeå‡çº§</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä½œç”¨ï¼šæ£€æŸ¥æ‰€æœ‰è¡¨æ˜¯å¦ä¸å½“å‰ç‰ˆæœ¬å…¼å®¹ï¼Œå¹¶æ›´æ–°ç³»ç»Ÿåº“</span><br><br>/app/mysql/bin/mysql_upgrade -uroot -p123456 <span class="hljs-comment">#åŸå¯†ç </span><br></code></pre></td></tr></table></figure><h3 id="8-æŸ¥çœ‹ç‰ˆæœ¬"><a href="#8-æŸ¥çœ‹ç‰ˆæœ¬" class="headerlink" title="8. æŸ¥çœ‹ç‰ˆæœ¬"></a>8. æŸ¥çœ‹ç‰ˆæœ¬</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql -V<br></code></pre></td></tr></table></figure><h3 id="9-ç™»å½•æ£€æŸ¥"><a href="#9-ç™»å½•æ£€æŸ¥" class="headerlink" title="9. ç™»å½•æ£€æŸ¥"></a>9. ç™»å½•æ£€æŸ¥</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql -uroot -p123456<br>&gt;show databases;<br></code></pre></td></tr></table></figure><h3 id="10-æ³¨æ„çš„é—®é¢˜"><a href="#10-æ³¨æ„çš„é—®é¢˜" class="headerlink" title="10. æ³¨æ„çš„é—®é¢˜"></a>10. æ³¨æ„çš„é—®é¢˜</h3><p>1ã€åŸæ¥æ˜¯rpmå®‰è£…çš„è¯å…ˆå¸è½½ï¼Œrpm -qa | grep mysql<br>2ã€å¦‚æœç›®å½•ä¸æ˜¯&#x2F;app&#x2F;mysql&#x2F;æ³¨æ„ä¿®æ”¹&#x2F;etc&#x2F;init.d&#x2F;mysqldçš„æ•°æ®ç›®å½•å’Œpidæ–‡ä»¶è·¯å¾„<br>3ã€è¿æ¥æ•°æ®åº“çš„æ—¶å€™æŠ¥é”™cant connect to mysql server through socket â€˜&#x2F;tmp&#x2F;mysql.sockâ€™ï¼Œä¿®æ”¹ä¿®æ”¹my.cnfçš„socketè·¯å¾„<br>4ã€mysql_upgradeæŠ¥é”™æ‰¾ä¸åˆ°sockï¼Œå¯ä»¥ç”¨-SæŒ‡å®šsock</p><h2 id="ä¸‰ã€ä¸»ä»æ¶æ„æ•°æ®åº“å‡çº§å®ä¾‹ï¼š"><a href="#ä¸‰ã€ä¸»ä»æ¶æ„æ•°æ®åº“å‡çº§å®ä¾‹ï¼š" class="headerlink" title="ä¸‰ã€ä¸»ä»æ¶æ„æ•°æ®åº“å‡çº§å®ä¾‹ï¼š"></a>ä¸‰ã€ä¸»ä»æ¶æ„æ•°æ®åº“å‡çº§å®ä¾‹ï¼š</h2><p>1.ä¸€ä¸»ä¸€ä»å‡çº§ï¼š<br>    å…ˆåœæ‰ä¸»åº“mysqlï¼Œå†åœæ‰ä»åº“mysqlï¼Œç„¶åæ“ä½œä»åº“æœºå™¨è¿›è¡Œå‡çº§ï¼Œä»åº“å‡çº§åï¼Œå†å‡çº§ä¸»åº“ã€‚<br>2.åŒä¸»+ä¸€ä»å‡çº§ï¼š<br>    å…ˆåœæ‰VIPï¼ˆå…ˆåœVIPæ²¡åœ¨çš„ä¸€æ–¹ï¼‰systemctl stop keeplived<br>    å†åœæ‰VIPæ²¡åœ¨çš„ä¸»åº“æ•°æ®åº“ï¼Œç„¶ååœæ‰ä¸»åº“æ•°æ®åº“ï¼Œå†åœæ‰ä»åº“æ•°æ®åº“ã€‚<br>    å†ä¾æ¬¡å‡çº§ä»åº“&gt;ä¸»åº“(vipæœªåœ¨ï¼‰&gt;ä¸»åº“ï¼ˆvipåœ¨)çš„æ•°æ®åº“<br>    æœ€åå¯åŠ¨VIPï¼Œç„¶åå…ˆå¯åŠ¨ä¸»åº“(vipåœ¨çš„) &gt;ä¸»åº“ï¼ˆvipæœªåœ¨)&gt;ä»åº“çš„æ•°æ®åº“    </p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlä¸»ä»å¤åˆ¶</title>
    <link href="/2023/03/27/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"/>
    <url>/2023/03/27/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="mysqlä¸»ä»å¤åˆ¶"><a href="#mysqlä¸»ä»å¤åˆ¶" class="headerlink" title="mysqlä¸»ä»å¤åˆ¶"></a>mysqlä¸»ä»å¤åˆ¶</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">ä¸€ä¸»äºŒä»å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.csdn.net/qq_38711927/article/details/107013588<br>mysqlåŒä¸»å‚è€ƒæ–‡æ¡£ï¼šhttps://www.cnblogs.com/jpfss/p/11577924.html<br></code></pre></td></tr></table></figure><p><strong>éœ€ï¼šç‰ˆæœ¬ä¸€è‡´ã€åˆå§‹åŒ–è¡¨ï¼Œå¹¶åœ¨åå°å¯åŠ¨mysqlã€ä¿®æ”¹rootçš„å¯†ç </strong></p><h2 id="ä¸€ã€mysqlä¸€ä¸»ä¸€ä»é…ç½®"><a href="#ä¸€ã€mysqlä¸€ä¸»ä¸€ä»é…ç½®" class="headerlink" title="ä¸€ã€mysqlä¸€ä¸»ä¸€ä»é…ç½®"></a>ä¸€ã€mysqlä¸€ä¸»ä¸€ä»é…ç½®</h2><h3 id="1-ä¿®æ”¹ä¸»æœåŠ¡å™¨master"><a href="#1-ä¿®æ”¹ä¸»æœåŠ¡å™¨master" class="headerlink" title="1.ä¿®æ”¹ä¸»æœåŠ¡å™¨master"></a>1.ä¿®æ”¹ä¸»æœåŠ¡å™¨master</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/my.cnf<br><span class="hljs-comment">#-----------------------------------</span><br>[mysqld]<br><br>sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES<br><br>server-id=129   <span class="hljs-comment">#//[å¿…é¡»]æœåŠ¡å™¨å”¯ä¸€IDï¼Œé»˜è®¤æ˜¯1ï¼Œä¸€èˆ¬å–IPæœ€åä¸€æ®µ</span><br>log-bin=mysql-bin <span class="hljs-comment">#//[å¿…é¡»]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—</span><br>binlog_format=row  <span class="hljs-comment">#mysqlå¤åˆ¶ä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼šåŸºäºSQLè¯­å¥çš„å¤åˆ¶(statement-based replication, SBR)ï¼ŒåŸºäºè¡Œçš„å¤åˆ¶(row-based replication, RBR)ï¼Œæ··åˆæ¨¡å¼å¤åˆ¶(mixed-based replication, MBR)ã€‚å¯¹åº”çš„ï¼Œbinlogçš„æ ¼å¼ä¹Ÿæœ‰ä¸‰ç§ï¼šSTATEMENTï¼ŒROWï¼ŒMIXEDã€‚https://www.cnblogs.com/langtianya/p/5504774.html</span><br>expire_logs_days=7<br><br>slow_query_log=ON  <span class="hljs-comment">#//å¼€å¯binlogæ—¥å¿—</span><br>slow_query_log_file=/app/data/slow.log<br>long_query_time=2<br>character-set-server=utf8mb4<br><span class="hljs-comment">#/å¼€å¯gtid</span><br>gtid-mode = on  <br>enforce-gtid-consistency = <span class="hljs-literal">true</span><br><br>max_connections=2000<br>lower_case_table_names=1<br><span class="hljs-comment">#---------------------------------------</span><br><br>å¤‡æ³¨ï¼šå…³äºbinlogæ—¥å¿—ï¼Œå½“ row_format ä¸ºmixedæˆ–è€…statementæ ¼å¼æ—¶ï¼Œbinlog çš„å¤§å°å‘ç”Ÿæ”¹å˜ï¼Œä¸ç®¡æ˜¯å¦çœŸçš„æ›´æ–°æ•°æ®ï¼ŒMySQLéƒ½è®°å½•æ‰§è¡Œçš„sql åˆ°binlogã€‚åŸºäºrowæ¨¡å¼æ—¶ï¼Œserverå±‚åŒ¹é…åˆ°è¦æ›´æ–°çš„è®°å½•ï¼Œå‘ç°æ–°å€¼å’Œæ—§å€¼ä¸€è‡´ï¼Œä¸åšæ›´æ–°ï¼Œå°±ç›´æ¥è¿”å›ï¼Œä¹Ÿä¸è®°å½•binlogã€‚<br></code></pre></td></tr></table></figure><h3 id="2-ä¿®æ”¹ä»æœåŠ¡å™¨slave"><a href="#2-ä¿®æ”¹ä»æœåŠ¡å™¨slave" class="headerlink" title="2.ä¿®æ”¹ä»æœåŠ¡å™¨slave"></a>2.ä¿®æ”¹ä»æœåŠ¡å™¨slave</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/my.cnf<br><span class="hljs-comment">#-----------------------------------------------------</span><br>[mysqld]<br>sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES<br><br>server-id=226      <span class="hljs-comment">#//[å¿…é¡»]æœåŠ¡å™¨å”¯ä¸€IDï¼Œé»˜è®¤æ˜¯1ï¼Œä¸€èˆ¬å–IPæœ€åä¸€æ®µ</span><br>log-bin=mysql-bin  <span class="hljs-comment">#//[ä¸æ˜¯å¿…é¡»]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—</span><br><br>basedir = /app/mysql<br>datadir = /app/mysql/data<br>port = 3306<br>socket = /tmp/mysql.sock<br>character-set-server=utf8<br><br>log-error = /app/mysql/mysql/data/mysqld.log<br>pid-file = /app/mysql/mysql/data/mysqld.pid<br><br><br><span class="hljs-comment">#//å¼€å¯gtid</span><br>gtid-mode = on    <br>log_slave_updates = 1<br>slave-skip-errors = all<br>enforce-gtid-consistency = <span class="hljs-literal">true</span><br><span class="hljs-comment">#----------------------------------------------------------</span><br></code></pre></td></tr></table></figure><h3 id="3-é‡å¯ä¸¤å°æœåŠ¡å™¨çš„mysql"><a href="#3-é‡å¯ä¸¤å°æœåŠ¡å™¨çš„mysql" class="headerlink" title="3.é‡å¯ä¸¤å°æœåŠ¡å™¨çš„mysql"></a>3.é‡å¯ä¸¤å°æœåŠ¡å™¨çš„mysql</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">/etc/init.d/mysqld restart<br><span class="hljs-comment">#service mysqld restart</span><br></code></pre></td></tr></table></figure><h3 id="4-åœ¨ä¸»æœåŠ¡å™¨ä¸Šå»ºç«‹å¸æˆ·å¹¶æˆæƒslave-è¿æ¥mysql"><a href="#4-åœ¨ä¸»æœåŠ¡å™¨ä¸Šå»ºç«‹å¸æˆ·å¹¶æˆæƒslave-è¿æ¥mysql" class="headerlink" title="4.åœ¨ä¸»æœåŠ¡å™¨ä¸Šå»ºç«‹å¸æˆ·å¹¶æˆæƒslave,è¿æ¥mysql"></a>4.åœ¨ä¸»æœåŠ¡å™¨ä¸Šå»ºç«‹å¸æˆ·å¹¶æˆæƒslave,è¿æ¥mysql</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql&gt;GRANT REPLICATION SLAVE ON *.* to <span class="hljs-string">&#x27;repl&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>; <br><span class="hljs-comment">#ä¸€èˆ¬ä¸ç”¨rootå¸å·ï¼Œ%è¡¨ç¤ºæ‰€æœ‰å®¢æˆ·ç«¯éƒ½å¯èƒ½è¿ï¼Œåªè¦å¸å·ï¼Œå¯†ç æ­£ç¡®ï¼Œæ­¤å¤„å¯ç”¨å…·ä½“å®¢æˆ·ç«¯IPä»£æ›¿ï¼Œå¦‚192.168.145.226ï¼ŒåŠ å¼ºå®‰å…¨ã€‚</span><br></code></pre></td></tr></table></figure><h3 id="5-ç™»å½•ä¸»æœåŠ¡å™¨çš„mysqlï¼ŒæŸ¥è¯¢masterçš„çŠ¶æ€"><a href="#5-ç™»å½•ä¸»æœåŠ¡å™¨çš„mysqlï¼ŒæŸ¥è¯¢masterçš„çŠ¶æ€" class="headerlink" title="5.ç™»å½•ä¸»æœåŠ¡å™¨çš„mysqlï¼ŒæŸ¥è¯¢masterçš„çŠ¶æ€"></a>5.ç™»å½•ä¸»æœåŠ¡å™¨çš„mysqlï¼ŒæŸ¥è¯¢masterçš„çŠ¶æ€</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql&gt;show master status;<br><span class="hljs-comment">#æ³¨ï¼šæ‰§è¡Œå®Œæ­¤æ­¥éª¤åä¸è¦å†æ“ä½œä¸»æœåŠ¡å™¨MYSQLï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–</span><br></code></pre></td></tr></table></figure><h3 id="6-é…ç½®ä»æœåŠ¡å™¨Slave"><a href="#6-é…ç½®ä»æœåŠ¡å™¨Slave" class="headerlink" title="6.é…ç½®ä»æœåŠ¡å™¨Slave"></a>6.é…ç½®ä»æœåŠ¡å™¨Slave</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql&gt;change master to master_host=<span class="hljs-string">&#x27;192.168.94.129&#x27;</span>,master_user=<span class="hljs-string">&#x27;repl&#x27;</span>,master_password=<span class="hljs-string">&#x27;123456&#x27;</span>,master_port=3306,MASTER_AUTO_POSITION=1;<br><br><span class="hljs-comment">#æŒ‡å®šå¤åˆ¶ç‚¹</span><br>change master to master_host=<span class="hljs-string">&#x27;192.168.94.129&#x27;</span>,master_user=<span class="hljs-string">&#x27;repl&#x27;</span>,master_password=<span class="hljs-string">&#x27;123456&#x27;</span>,master_port=3306,MASTER_AUTO_POSITION=1,master_log_file=<span class="hljs-string">&#x27;mysql-bin.000006&#x27;</span>,master_log_pos=2192;<br><br>å‚æ•°è¯¦è§£ï¼š<br>master_host :ä¸»æœåŠ¡å™¨åœ°å€<br>master_port :ç«¯å£åœ°å€<br>MASTER_AUTO_POSITION=1  :1æ˜¯å¼€å¯ï¼Œ0æ˜¯å…³é—­,å¼€å¯gtidå¤åˆ¶<br>master_log_file  :ä¸»masterä¸Šshow master status\G  è·å–çš„ File ä¸€æ çš„ä¿¡æ¯<br>master_log_pos=2192; :ä¸»masterä¸Šshow master status\G è·å–çš„Position çš„ä¿¡æ¯;<br><br>       <br>Mysql&gt;start slave;    <span class="hljs-comment">#å¯åŠ¨ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½</span><br></code></pre></td></tr></table></figure><h3 id="7-æ£€æŸ¥ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½çŠ¶æ€"><a href="#7-æ£€æŸ¥ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½çŠ¶æ€" class="headerlink" title="7.æ£€æŸ¥ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½çŠ¶æ€"></a>7.æ£€æŸ¥ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½çŠ¶æ€</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">show slave status\G<br><br>Slave_IO_State: Waiting <span class="hljs-keyword">for</span> master to send event<br>              Master_Host: 192.168.2.222  //ä¸»æœåŠ¡å™¨åœ°å€<br>              Master_User: mysync   //æˆæƒå¸æˆ·åï¼Œå°½é‡é¿å…ä½¿ç”¨root<br>              Master_Port: 3306    //æ•°æ®åº“ç«¯å£ï¼Œéƒ¨åˆ†ç‰ˆæœ¬æ²¡æœ‰æ­¤è¡Œ<br>              Connect_Retry: 60<br>              Master_Log_File: mysql-bin.000004<br>              Read_Master_Log_Pos: 600     //<span class="hljs-comment">#åŒæ­¥è¯»å–äºŒè¿›åˆ¶æ—¥å¿—çš„ä½ç½®ï¼Œå¤§äºç­‰äºExec_Master_Log_Pos</span><br>              Relay_Log_File: ddte-relay-bin.000003<br>              Relay_Log_Pos: 251<br>              Relay_Master_Log_File: mysql-bin.000004<br>              Slave_IO_Running: Yes    //æ­¤çŠ¶æ€å¿…é¡»YES<br>              Slave_SQL_Running: Yes     //æ­¤çŠ¶æ€å¿…é¡»YES<br></code></pre></td></tr></table></figure><h3 id="8-ä¸€ä¸»å¤šä»æ³¨æ„bin-logæ—¥å¿—"><a href="#8-ä¸€ä¸»å¤šä»æ³¨æ„bin-logæ—¥å¿—" class="headerlink" title="8.ä¸€ä¸»å¤šä»æ³¨æ„bin_logæ—¥å¿—"></a>8.ä¸€ä¸»å¤šä»æ³¨æ„bin_logæ—¥å¿—</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æŸ¥çœ‹bin_logæ—¥å¿—ï¼ŒåŒæ­¥éœ€è¦ä½¿ç”¨bin_logæ—¥å¿—</span><br>show binary logs;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerè¿è¡ŒMySQLå•èŠ‚ç‚¹å’Œä¸»ä»èŠ‚ç‚¹</title>
    <link href="/2023/03/27/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/docker%E8%BF%90%E8%A1%8Cmysql%E5%8D%95%E8%8A%82%E7%82%B9%E5%92%8C%E4%B8%BB%E4%BB%8E%E8%8A%82%E7%82%B9/"/>
    <url>/2023/03/27/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/docker%E8%BF%90%E8%A1%8Cmysql%E5%8D%95%E8%8A%82%E7%82%B9%E5%92%8C%E4%B8%BB%E4%BB%8E%E8%8A%82%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="dockerè¿è¡Œmysql"><a href="#dockerè¿è¡Œmysql" class="headerlink" title="dockerè¿è¡Œmysql"></a>dockerè¿è¡Œmysql</h1><h2 id="ä¸€ã€ä½¿ç”¨dockerè¿è¡Œmysqlå•èŠ‚ç‚¹ï¼ˆå¯¹mysqlæ€§èƒ½æœ‰è¦æ±‚çš„ï¼Œä¸å»ºè®®ä½¿ç”¨dockerè¿è¡Œmysqlï¼‰"><a href="#ä¸€ã€ä½¿ç”¨dockerè¿è¡Œmysqlå•èŠ‚ç‚¹ï¼ˆå¯¹mysqlæ€§èƒ½æœ‰è¦æ±‚çš„ï¼Œä¸å»ºè®®ä½¿ç”¨dockerè¿è¡Œmysqlï¼‰" class="headerlink" title="ä¸€ã€ä½¿ç”¨dockerè¿è¡Œmysqlå•èŠ‚ç‚¹ï¼ˆå¯¹mysqlæ€§èƒ½æœ‰è¦æ±‚çš„ï¼Œä¸å»ºè®®ä½¿ç”¨dockerè¿è¡Œmysqlï¼‰"></a>ä¸€ã€ä½¿ç”¨dockerè¿è¡Œmysqlå•èŠ‚ç‚¹ï¼ˆå¯¹mysqlæ€§èƒ½æœ‰è¦æ±‚çš„ï¼Œä¸å»ºè®®ä½¿ç”¨dockerè¿è¡Œmysqlï¼‰</h2><h3 id="æŒä¹…åŒ–æ•°æ®ï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶ã€æ—¥å¿—ã€ä»¥åŠæ•°æ®ç›®å½•"><a href="#æŒä¹…åŒ–æ•°æ®ï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶ã€æ—¥å¿—ã€ä»¥åŠæ•°æ®ç›®å½•" class="headerlink" title="æŒä¹…åŒ–æ•°æ®ï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶ã€æ—¥å¿—ã€ä»¥åŠæ•°æ®ç›®å½•"></a>æŒä¹…åŒ–æ•°æ®ï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶ã€æ—¥å¿—ã€ä»¥åŠæ•°æ®ç›®å½•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /app/mysql/&#123;conf,<span class="hljs-built_in">log</span>,data&#125;<br><br><br><span class="hljs-comment">#ä¿®æ”¹æŒ‚è½½åˆ°æœ¬åœ°çš„æ—¥å¿—ç›®å½•çš„æƒé™ã€‚æœ‰äº›æ—¶å€™ä¼šå› ä¸ºæƒé™é—®é¢˜å¯¼è‡´æ— æ³•æ˜ å°„åˆ°æœ¬åœ°</span><br><span class="hljs-built_in">chown</span> -R 999:999 /app/mysql/log<br><br><span class="hljs-comment">#/app/mysql/conf/æ–‡ä»¶ç›®å½•ä¸­éœ€è¦æœ‰ç›¸åº”çš„my.cnfï¼Œå¦åˆ™ç›´æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ—¶ä¼šæ— æ³•å¯åŠ¨</span><br><span class="hljs-built_in">cat</span> &gt;mysqld.cnf &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[mysqld]</span><br><span class="hljs-string">skip-host-cache</span><br><span class="hljs-string">skip-name-resolve</span><br><span class="hljs-string"></span><br><span class="hljs-string">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES </span><br><span class="hljs-string"></span><br><span class="hljs-string">server-id=1</span><br><span class="hljs-string">log-bin=mysql-bin</span><br><span class="hljs-string">binlog_format=row</span><br><span class="hljs-string">expire_logs_days=7</span><br><span class="hljs-string"></span><br><span class="hljs-string">slow_query_log=ON</span><br><span class="hljs-string">slow_query_log_file=/var/log/mysql/slow.log</span><br><span class="hljs-string">long_query_time=2</span><br><span class="hljs-string"></span><br><span class="hljs-string">gtid-mode=on</span><br><span class="hljs-string">enforce-gtid-consistency=true</span><br><span class="hljs-string"></span><br><span class="hljs-string">max_connections=1000</span><br><span class="hljs-string"></span><br><span class="hljs-string">lower_case_table_names=1</span><br><span class="hljs-string"></span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-built_in">chmod</span> 655 mysqld.cnf<br></code></pre></td></tr></table></figure><h3 id="dockerè¿è¡Œmysqlï¼ˆå•èŠ‚ç‚¹ï¼‰"><a href="#dockerè¿è¡Œmysqlï¼ˆå•èŠ‚ç‚¹ï¼‰" class="headerlink" title="dockerè¿è¡Œmysqlï¼ˆå•èŠ‚ç‚¹ï¼‰"></a>dockerè¿è¡Œmysqlï¼ˆå•èŠ‚ç‚¹ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -p 3306:3306 \<br>--name mysql -e TZ=Asia/Shanghai \<br>--restart=always \<br>-v /app/mysql/conf:/etc/mysql/conf.d \<br>-v /app/mysql/log:/logs \<br>-v /app/mysql/data:/var/lib/mysql \<br>-e MYSQL_ROOT_PASSWORD=123456 \<br>-e MYSQL_DATABASE=<span class="hljs-built_in">test</span> \<br>-d mysql:5.7<br><br><br>å¤‡æ³¨ï¼š<br>-v å°†æœ¬åœ°æ•°æ®æ˜ å°„åˆ°å®¹å™¨å†…<br>-e è®¾ç½®çš„ç¯å¢ƒå˜é‡ï¼ŒMYSQL_ROOT_PASSWORDä¸ºæ•°æ®åº“å¯†ç ï¼ŒMYSQL_DATABASEä¸ºæ•°æ®åº“å<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰æ—¶å¹¶ä¸éœ€è¦åœ¨æœ¬åœ°å®‰è£…ä¸€ä¸ªmysql-serveræœåŠ¡ï¼Œåªéœ€è¦å®‰è£…ä¸€ä¸ªç™»å½•mysql-server-çš„mysqlçš„å®¢æˆ·ç«¯clientï¼Œå¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š"><a href="#ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰æ—¶å¹¶ä¸éœ€è¦åœ¨æœ¬åœ°å®‰è£…ä¸€ä¸ªmysql-serveræœåŠ¡ï¼Œåªéœ€è¦å®‰è£…ä¸€ä¸ªç™»å½•mysql-server-çš„mysqlçš„å®¢æˆ·ç«¯clientï¼Œå¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š" class="headerlink" title="ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰æ—¶å¹¶ä¸éœ€è¦åœ¨æœ¬åœ°å®‰è£…ä¸€ä¸ªmysql serveræœåŠ¡ï¼Œåªéœ€è¦å®‰è£…ä¸€ä¸ªç™»å½•mysql server çš„mysqlçš„å®¢æˆ·ç«¯clientï¼Œå¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š"></a>ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰æ—¶å¹¶ä¸éœ€è¦åœ¨æœ¬åœ°å®‰è£…ä¸€ä¸ªmysql serveræœåŠ¡ï¼Œåªéœ€è¦å®‰è£…ä¸€ä¸ªç™»å½•mysql server çš„mysqlçš„å®¢æˆ·ç«¯clientï¼Œå¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#centos6ç³»ç»Ÿä¸Šå®‰è£…mysql-clientçš„æ–¹å¼ï¼š</span><br>yum install mysql-clent mysql-devel -y<br><span class="hljs-comment">#centos7çš„ç³»ç»Ÿä¸Šå®‰è£…mysql clientçš„æ–¹å¼ï¼š</span><br>yum install -y mariadb.x86_64 mariadb-libs.x86_64<br></code></pre></td></tr></table></figure><h2 id="äºŒã€ä½¿ç”¨dockerè¿è¡Œï¼ˆmysql-ä¸»ä»ï¼‰masterå’ŒslaveèŠ‚ç‚¹"><a href="#äºŒã€ä½¿ç”¨dockerè¿è¡Œï¼ˆmysql-ä¸»ä»ï¼‰masterå’ŒslaveèŠ‚ç‚¹" class="headerlink" title="äºŒã€ä½¿ç”¨dockerè¿è¡Œï¼ˆmysql-ä¸»ä»ï¼‰masterå’ŒslaveèŠ‚ç‚¹"></a>äºŒã€ä½¿ç”¨dockerè¿è¡Œï¼ˆmysql-ä¸»ä»ï¼‰masterå’ŒslaveèŠ‚ç‚¹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åˆ›å»ºnetwork</span><br>docker network create --subnet=172.18.0.0/16 mysqlnetwork<br><br><span class="hljs-comment">#ä¸»èŠ‚ç‚¹ï¼š</span><br>docker run -p 12347:3306 \<br>--restart=always \<br>--name mysql-master1 \<br>--net mysqlnetwork \<br>--ip 172.18.0.2 \<br>-v /app/mysql-master/conf:/etc/mysql/conf.d \<br>-v /app/mysql-master/logs:/var/log/mysql \<br>-v /app/mysql-master/data:/var/lib/mysql \<br>-e MYSQL_ROOT_PASSWORD=123456 \<br>-d mysql:5.7 \<br>--character-set-server=utf8mb4 \<br>--collation-server=utf8mb4_unicode_ci<br><br><span class="hljs-comment">#è¿æ¥masteræ•°æ®åº“æ‰§è¡Œ</span><br>&gt;GRANT REPLICATION SLAVE ON *.* to <span class="hljs-string">&#x27;repl&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>; <br>&gt;show master status;<br><br><span class="hljs-comment">#ä»èŠ‚ç‚¹ï¼š</span><br>docker run -p 12348:3306 \<br>--restart=always \<br>--name mysql-slave1 \<br>--net mysqlnetwork \<br>--ip 172.18.0.3 \<br>-v /home/coinpay/middlerware/mysql/slave1/conf:/etc/mysql/conf.d \<br>-v /home/coinpay/middlerware/mysql/slave1/logs:/var/log/mysql \<br>-v /home/coinpay/middlerware/mysql/slave1/data:/var/lib/mysql \<br>-e MYSQL_ROOT_PASSWORD=123456 \<br>-d mysql:5.7 --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci<br><br><span class="hljs-comment">#è¿æ¥slaveæ•°æ®åº“æ‰§è¡Œ</span><br>&gt;change master to master_host=<span class="hljs-string">&#x27;172.18.0.2&#x27;</span>,master_user=<span class="hljs-string">&#x27;repl&#x27;</span>,master_password=<span class="hljs-string">&#x27;123456&#x27;</span>,master_port=3306,MASTER_AUTO_POSITION=1;<br>&gt;start slave;<br>&gt;show slave status\G<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äºŒè¿›åˆ¶å®‰è£…mysql</title>
    <link href="/2023/03/27/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85mysql/"/>
    <url>/2023/03/27/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85mysql/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="äºŒè¿›åˆ¶å®‰è£…MySQL"><a href="#äºŒè¿›åˆ¶å®‰è£…MySQL" class="headerlink" title="äºŒè¿›åˆ¶å®‰è£…MySQL"></a>äºŒè¿›åˆ¶å®‰è£…MySQL</h1><h2 id="1-å®‰è£…å‰æ£€æŸ¥"><a href="#1-å®‰è£…å‰æ£€æŸ¥" class="headerlink" title="1.å®‰è£…å‰æ£€æŸ¥"></a>1.å®‰è£…å‰æ£€æŸ¥</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦è‡ªå¸¦å®‰è£… MySQLï¼Œå¦‚æœæœ‰çš„è¯&#x27;rpm -e&#x27;æ™®é€šåˆ é™¤&#x27;rpm -e --nodeps&#x27;å¼ºåˆ¶åˆ é™¤</span><br>rpm -qa | grep mysql<br><br><span class="hljs-comment">#æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦è‡ªå¸¦å®‰è£… mariadbï¼Œå¦‚æœæœ‰çš„è¯&#x27;rpm -e --nodeps&#x27;å¼ºåˆ¶åˆ é™¤</span><br>rpm -qa | grep mariadb<br><br><span class="hljs-comment">#å®‰è£…ä¾èµ–åŒ…</span><br>yum install libaio* -y<br></code></pre></td></tr></table></figure><h2 id="2-å®‰è£…mysql"><a href="#2-å®‰è£…mysql" class="headerlink" title="2.å®‰è£…mysql"></a>2.å®‰è£…mysql</h2><p>å‰è¨€:mysqlå®‰è£…åœ¨&#x2F;appä¸­</p><h3 id="2-1-å®˜ç½‘ä¸‹è½½ç›¸å…³çš„mysqlåŒ…"><a href="#2-1-å®˜ç½‘ä¸‹è½½ç›¸å…³çš„mysqlåŒ…" class="headerlink" title="2.1 å®˜ç½‘ä¸‹è½½ç›¸å…³çš„mysqlåŒ…"></a>2.1 å®˜ç½‘ä¸‹è½½ç›¸å…³çš„mysqlåŒ…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.39-linux-glibc2.12-x86_64.tar.gz</span><br><span class="hljs-comment">#wget https://cdn.mysql.com/archives/mysql-5.7/mysql-5.7.39-linux-glibc2.12-x86_64.tar.gz</span><br><br>tar -xnf mysql-5.7.32.tar.gz   <span class="hljs-comment">#è§£å‹</span><br><span class="hljs-built_in">mv</span> mysql-5.7.32-linux-glibc2.12-x86_64 mysql-5.7.32  <span class="hljs-comment">#é‡å‘½å æˆ–è€…æ·»åŠ ln -sè½¯é“¾æ¥</span><br></code></pre></td></tr></table></figure><h3 id="2-2-æ·»åŠ ç³»ç»Ÿmysqlç»„å’Œmysqlç”¨æˆ·"><a href="#2-2-æ·»åŠ ç³»ç»Ÿmysqlç»„å’Œmysqlç”¨æˆ·" class="headerlink" title="2.2 æ·»åŠ ç³»ç»Ÿmysqlç»„å’Œmysqlç”¨æˆ·"></a>2.2 æ·»åŠ ç³»ç»Ÿmysqlç»„å’Œmysqlç”¨æˆ·</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ£€æŸ¥æ˜¯å¦å«æœ‰mysqlç»„ï¼Œæ²¡æœ‰çš„è¯éœ€è¦æ–°å»º</span><br><span class="hljs-built_in">cat</span> /etc/group | grep mysql <br><span class="hljs-comment">#æ–°å»ºmysqlç»„</span><br>groupadd mysql<br>useradd -r -g mysql mysql <span class="hljs-comment">#useradd -rå‚æ•°è¡¨ç¤ºmysqlç”¨æˆ·æ˜¯ç³»ç»Ÿç”¨æˆ·ï¼Œä¸å¯ç”¨äºç™»å½•ç³»ç»Ÿ</span><br></code></pre></td></tr></table></figure><h3 id="2-3-åˆ›å»ºdataç›®å½•"><a href="#2-3-åˆ›å»ºdataç›®å½•" class="headerlink" title="2.3 åˆ›å»ºdataç›®å½•"></a>2.3 åˆ›å»ºdataç›®å½•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /app/mysql-5.7.32<br><span class="hljs-built_in">mkdir</span> data<br></code></pre></td></tr></table></figure><h3 id="2-4-å°†mysqlæ–‡ä»¶çš„æ‰€æœ‰è€…åŠæ‰€å±ç»„æ”¹ä¸ºmysql"><a href="#2-4-å°†mysqlæ–‡ä»¶çš„æ‰€æœ‰è€…åŠæ‰€å±ç»„æ”¹ä¸ºmysql" class="headerlink" title="2.4 å°†mysqlæ–‡ä»¶çš„æ‰€æœ‰è€…åŠæ‰€å±ç»„æ”¹ä¸ºmysql"></a>2.4 å°†mysqlæ–‡ä»¶çš„æ‰€æœ‰è€…åŠæ‰€å±ç»„æ”¹ä¸ºmysql</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /app/<br><span class="hljs-built_in">chown</span> -R mysql.mysql /app/mysql-5.7.32   <span class="hljs-comment">#ä¿®æ”¹æ‰€å±ç»„ å¦‚æœæ·»åŠ è½¯é“¾æ¥çš„è¯ï¼Œä¸¤ä¸ªéƒ½è¦ä¿®æ”¹</span><br></code></pre></td></tr></table></figure><h3 id="2-5-è®¾ç½®my-cnfæ–‡ä»¶"><a href="#2-5-è®¾ç½®my-cnfæ–‡ä»¶" class="headerlink" title="2.5 è®¾ç½®my.cnfæ–‡ä»¶"></a>2.5 è®¾ç½®my.cnfæ–‡ä»¶</h3><p><strong>æ–¹æ³•ä¸€</strong></p><p>åœ¨&#x2F;app&#x2F;mysql-5.7.32&#x2F;support-filesç›®å½•ä¸‹åˆ›å»ºmy_default.cnf</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /app/mysql-5.7.32/support-files/my_default.cnf<br><br>[mysqld]<br>sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES <br> <br>basedir = /app/mysql-5.7.32/<br>datadir = /app/mysql-5.7.32/data<br>port = 3306<br>socket = /tmp/mysql.sock<br>character-set-server=utf8<br> <br>log-error = /app/mysql-5.7.32/data/mysqld.log<br>pid-file = /app/mysql-5.7.32/data/mysqld.pid<br></code></pre></td></tr></table></figure><p><strong>æ–¹æ³•äºŒ</strong></p><p>å°†è¯¥æ–‡ä»¶æ‹·è´è¦†ç›–</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> support-files/my_default.cnf /etc/my.cnf<br></code></pre></td></tr></table></figure><p>ç›´æ¥å»ºç«‹&#x2F;etc&#x2F;my.cnf</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/my.cnf<br><br>[mysqld]<br>sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES <br><br>server-id=59<br><br>basedir = /app/mysql/<br>datadir = /app/mysql/data<br><br><span class="hljs-comment">##pid-file = /app/mysql/data/mysqld.pid</span><br>log-bin = mysql-bin<br>binlog-format = row<br>slow_query_log = ON<br>slow_query_log_file = /app/mysql/data/slow.log<br>long_query_time = 1<br>gtid-mode = on<br>log_slave_updates = 1<br>slave-skip-errors = all<br>enforce-gtid-consistency = <span class="hljs-literal">true</span><br>log_timestamps = SYSTEM<br><br></code></pre></td></tr></table></figure><h3 id="2-6-åˆå§‹åŒ–-mysqld"><a href="#2-6-åˆå§‹åŒ–-mysqld" class="headerlink" title="2.6  åˆå§‹åŒ– mysqld"></a>2.6  åˆå§‹åŒ– mysqld</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /app/mysql-5.7.32<br>./bin/mysqld --initialize --user=mysql --basedir=/app/mysql-5.7.32 --datadir=/app/mysql-5.7.32/data/ <br><span class="hljs-comment">#åˆå§‹åŒ–ï¼Œç”Ÿæˆæ—¥å¿—ï¼Œæ—¥å¿—å†…æœ‰ä¸´æ—¶mysqlå¯†ç </span><br><span class="hljs-comment">#æŸ¥çœ‹æ—¥å¿—</span><br><span class="hljs-built_in">cat</span> /app/mysql/data/mysqld.log<br></code></pre></td></tr></table></figure><h3 id="2-7-å°†è„šæœ¬æ”¾åˆ°å¼€æœºåˆå§‹åŒ–ç›®å½•å†…"><a href="#2-7-å°†è„šæœ¬æ”¾åˆ°å¼€æœºåˆå§‹åŒ–ç›®å½•å†…" class="headerlink" title="2.7  å°†è„šæœ¬æ”¾åˆ°å¼€æœºåˆå§‹åŒ–ç›®å½•å†…"></a>2.7  å°†è„šæœ¬æ”¾åˆ°å¼€æœºåˆå§‹åŒ–ç›®å½•å†…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> support-files/mysql.server /etc/init.d/mysql<br></code></pre></td></tr></table></figure><h3 id="2-8-å¯åŠ¨mysqlæœåŠ¡"><a href="#2-8-å¯åŠ¨mysqlæœåŠ¡" class="headerlink" title="2.8 å¯åŠ¨mysqlæœåŠ¡"></a>2.8 å¯åŠ¨mysqlæœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">service mysql start<br></code></pre></td></tr></table></figure><h3 id="2-9-æ·»åŠ ç¯å¢ƒå˜é‡"><a href="#2-9-æ·»åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="2.9 æ·»åŠ ç¯å¢ƒå˜é‡"></a>2.9 æ·»åŠ ç¯å¢ƒå˜é‡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åœ¨ç¯å¢ƒå˜é‡çš„ç›®å½•å†…æ–°å»ºä¸€ä¸ªmysql.shè„šæœ¬</span><br>vim /etc/profile.d/mysql.sh<br><br><span class="hljs-built_in">export</span> PATH=/app/mysql-5.7.32/bin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment">#ä½¿è„šæœ¬ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> ./mysql.sh  <br></code></pre></td></tr></table></figure><h3 id="2-10-è¿æ¥æ•°æ®åº“"><a href="#2-10-è¿æ¥æ•°æ®åº“" class="headerlink" title="2.10 è¿æ¥æ•°æ®åº“"></a>2.10 è¿æ¥æ•°æ®åº“</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">mysql -uroot -<span class="hljs-selector-tag">p</span>ä¸´æ—¶å¯†ç <br></code></pre></td></tr></table></figure><h4 id="2-10-1-å¦‚æœåˆå§‹åŒ–å¯†ç å¿˜äº†æˆ–è€…æ²¡æœ‰ä¿å­˜ï¼š"><a href="#2-10-1-å¦‚æœåˆå§‹åŒ–å¯†ç å¿˜äº†æˆ–è€…æ²¡æœ‰ä¿å­˜ï¼š" class="headerlink" title="2.10.1  å¦‚æœåˆå§‹åŒ–å¯†ç å¿˜äº†æˆ–è€…æ²¡æœ‰ä¿å­˜ï¼š"></a>2.10.1  å¦‚æœåˆå§‹åŒ–å¯†ç å¿˜äº†æˆ–è€…æ²¡æœ‰ä¿å­˜ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ³¨æ„ï¼šmysqlå¦‚æœå·²ç»å¼€å¯äº†ï¼Œè¯·å…ˆå…³é—­mysql</span><br>service mysqld stop<br><br><span class="hljs-comment">#åœ¨my.confå†…[mysqld]åé¢ä»»æ„ä¸€è¡Œæ·»åŠ â€œskip-grant-tablesâ€   </span><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/my.conf &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">skip-grant-tables</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment">#å¯åŠ¨mysql</span><br>service mysqld start<br><br><span class="hljs-comment">#è¿æ¥mysqlï¼Œç›´æ¥è¾“å…¥mysqlå³å¯</span><br>mysql<br><br>mysql&gt; use mysql; <br><span class="hljs-comment">#ä¿®æ”¹å¯†ç </span><br>mysql&gt; update user <span class="hljs-built_in">set</span> authentication_string=passworD(<span class="hljs-string">&quot;ä½ çš„æ–°å¯†ç &quot;</span>) <span class="hljs-built_in">where</span> user=<span class="hljs-string">&#x27;root&#x27;</span>;<br>mysql&gt; flush privileges;<br><span class="hljs-comment">######æˆ–è€…########     </span><br>mysql&gt; update user <span class="hljs-built_in">set</span> password=password(<span class="hljs-string">&quot;ä½ çš„æ–°å¯†ç &quot;</span>) <span class="hljs-built_in">where</span> user=<span class="hljs-string">&quot;root&quot;</span>;<br>mysql&gt; flush privileges;<br><br><span class="hljs-comment">#ä¿®æ”¹å¯†ç åï¼Œæ³¨é‡Š/etc/my.cnfä¸­skip-grant-tableså¹¶é‡å¯</span><br>service mysqld restart<br><br><span class="hljs-comment">#ç™»å½•æ—¶æç¤ºï¼š</span><br><span class="hljs-comment">#ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.åˆ™éœ€è¦ä¿®æ”¹åˆå§‹å¯†ç </span><br></code></pre></td></tr></table></figure><h3 id="2-11-ä¿®æ”¹åˆå§‹å¯†ç "><a href="#2-11-ä¿®æ”¹åˆå§‹å¯†ç " class="headerlink" title="2.11 ä¿®æ”¹åˆå§‹å¯†ç "></a>2.11 ä¿®æ”¹åˆå§‹å¯†ç </h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql&gt; <span class="hljs-built_in">set</span> password=password(<span class="hljs-string">&#x27;123456&#x27;</span>);<br>mysql&gt; grant all privileges on *.* to root@<span class="hljs-string">&#x27;%&#x27;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>;<br>mysql&gt; flush privileges;<br></code></pre></td></tr></table></figure><h3 id="2-12-æ·»åŠ è¿œç¨‹è®¿é—®æƒé™"><a href="#2-12-æ·»åŠ è¿œç¨‹è®¿é—®æƒé™" class="headerlink" title="2.12 æ·»åŠ è¿œç¨‹è®¿é—®æƒé™"></a>2.12 æ·»åŠ è¿œç¨‹è®¿é—®æƒé™</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql&gt; use mysql;<br>mysql&gt; update user <span class="hljs-built_in">set</span> host=<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-built_in">where</span> user = <span class="hljs-string">&#x27;root&#x27;</span>;<br>mysql&gt; flush privileges;<br></code></pre></td></tr></table></figure><h3 id="2-13-æµ‹è¯•ï¼ˆå¯å¿½ç•¥ï¼‰"><a href="#2-13-æµ‹è¯•ï¼ˆå¯å¿½ç•¥ï¼‰" class="headerlink" title="2.13 æµ‹è¯•ï¼ˆå¯å¿½ç•¥ï¼‰"></a>2.13 æµ‹è¯•ï¼ˆå¯å¿½ç•¥ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ’å…¥ä¸Šä¸‡è¡Œæµ‹è¯•æ•°æ®ï¼š</span><br>create database <span class="hljs-built_in">test</span>;<br><br>CREATE TABLE `t_user` (<br>  `<span class="hljs-built_in">id</span>` bigint(20) NOT NULL AUTO_INCREMENT,<br>  `name` varchar(255) DEFAULT NULL,<br>  `age` tinyint(4) DEFAULT NULL,<br>  `create_time` datetime DEFAULT NULL,<br>  `update_time` datetime DEFAULT NULL,<br>  PRIMARY KEY (`<span class="hljs-built_in">id</span>`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8;<br><br><span class="hljs-comment">#ä¸‹é¢çš„å­˜å‚¨è¿‡ç¨‹æ¥æ’å…¥100000æ¡æ•°æ®</span><br>delimiter //<br>DROP PROCEDURE IF EXISTS proc_batch_insert;<br>CREATE PROCEDURE proc_batch_insert()<br>BEGIN<br>DECLARE pre_name BIGINT;<br>DECLARE ageVal INT;<br>DECLARE i INT;<br>SET pre_name=187635267;<br>SET ageVal=100;<br>SET i=1;<br>WHILE i &lt;= 10000 DO<br>        INSERT INTO t_user(`name`,age,create_time,update_time) VALUES(CONCAT(pre_name,<span class="hljs-string">&#x27;@qq.com&#x27;</span>),(ageVal+1)%30,NOW(),NOW());<br>SET pre_name=pre_name+100;<br>SET i=i+1;<br>END WHILE;<br>END //<br> <br>delimiter ;<br>call proc_batch_insert();<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginxè´Ÿè½½å‡è¡¡å®ç°ç­–ç•¥</title>
    <link href="/2023/03/27/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%AD%96%E7%95%A5/"/>
    <url>/2023/03/27/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%AD%96%E7%95%A5/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><table><thead><tr><th>è½®è¯¢</th><th>é»˜è®¤æ–¹å¼</th></tr></thead><tbody><tr><td>weight</td><td>æƒé‡æ–¹å¼</td></tr><tr><td>ip_hash</td><td>ä¾æ®ipåˆ†é…æ–¹å¼</td></tr><tr><td>least_conn</td><td>æœ€å°‘è¿æ¥æ–¹å¼</td></tr><tr><td>fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰</td><td>å“åº”æ—¶é—´æ–¹å¼</td></tr><tr><td>url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰</td><td>ä¾æ®URLåˆ†é…æ–¹å¼</td></tr></tbody></table><h3 id="Nginxä½¿ç”¨çš„é…ç½®è¯¦è§£"><a href="#Nginxä½¿ç”¨çš„é…ç½®è¯¦è§£" class="headerlink" title="Nginxä½¿ç”¨çš„é…ç½®è¯¦è§£:"></a>Nginxä½¿ç”¨çš„é…ç½®è¯¦è§£:</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss">(<span class="hljs-number">1</span>). downï¼š è¡¨ç¤ºå½“å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½ã€‚<br>(<span class="hljs-number">2</span>). weightï¼š  é»˜è®¤ä¸º<span class="hljs-number">1</span><span class="hljs-selector-class">.weight</span>è¶Šå¤§ï¼Œè´Ÿè½½çš„æƒé‡å°±è¶Šå¤§ã€‚<br>(<span class="hljs-number">3</span>). max_failsï¼š å…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°é»˜è®¤ä¸º<span class="hljs-number">1</span>.å½“è¶…è¿‡æœ€å¤§æ¬¡æ•°æ—¶ï¼Œè¿”å›proxy_next_upstream æ¨¡å—å®šä¹‰çš„é”™è¯¯<br>(<span class="hljs-number">4</span>). fail_timeoutï¼š max_fails æ¬¡å¤±è´¥åï¼Œæš‚åœçš„æ—¶é—´ã€‚<br>(<span class="hljs-number">5</span>). backupï¼š å…¶å®ƒæ‰€æœ‰çš„ébackupæœºå™¨downæˆ–è€…å¿™çš„æ—¶å€™ï¼Œè¯·æ±‚backupæœºå™¨ï¼Œæ‰€ä»¥è¿™å°æœºå™¨å‹åŠ›ä¼šæœ€è½»ã€‚<br></code></pre></td></tr></table></figure><h2 id="è½®è¯¢"><a href="#è½®è¯¢" class="headerlink" title="è½®è¯¢:"></a>è½®è¯¢:</h2><p>æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åº”ç”¨æœåŠ¡å™¨ï¼Œå¦‚æœåº”ç”¨æœåŠ¡å™¨downæ‰ï¼Œè‡ªåŠ¨å‰”é™¤ï¼Œå‰©ä¸‹çš„ç»§ç»­è½®è¯¢ã€‚å®ƒæ˜¯upstreamæ¨¡å—é»˜è®¤çš„è´Ÿè½½å‡è¡¡é»˜è®¤ç­–ç•¥ã€‚æ¯ä¸ªè¯·æ±‚ä¼šæŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">upstream dynamic_name &#123;<br>        server localhost:8081;<br>        server localhost:8082;<br>        server localhost:8083;<br>&#125;<br>server &#123;<br><span class="hljs-comment">#...çœç•¥...</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="weight-æƒé‡"><a href="#weight-æƒé‡" class="headerlink" title="weight(æƒé‡):"></a>weight(æƒé‡):</h2><p>æƒé‡æ–¹å¼ï¼Œåœ¨è½®è¯¢ç­–ç•¥çš„åŸºç¡€ä¸ŠæŒ‡å®šè½®è¯¢çš„å‡ ç‡ã€‚æƒé‡å’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåº”ç”¨æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ä½¿ç”¨weight&#x3D;xï¼Œæ¥é…ç½®æƒé‡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">upstream dynamic_name &#123;<br>        server localhost:8081 weight=9; <span class="hljs-comment">#è®¾ç½®ä¸º9ï¼Œä»£è¡¨è¯¥æœåŠ¡å™¨æ€§èƒ½å¼ºï¼Œèƒ½å¤Ÿå¤„ç†æ›´å¤šçš„è¯·æ±‚</span><br>        server localhost:8082;<br>        server localhost:8083 max_fails=3 fail_timeout=20s;<br>&#125; <br>server &#123;<br><span class="hljs-comment">#...çœç•¥...</span><br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="ip-hashï¼š"><a href="#ip-hashï¼š" class="headerlink" title="ip_hashï¼š"></a>ip_hashï¼š</h2><p>æŒ‡å®šè´Ÿè½½å‡è¡¡å™¨æŒ‰ç…§åŸºäºå®¢æˆ·ç«¯IPçš„åˆ†é…æ–¹å¼ï¼Œè¿™ä¸ªæ–¹æ³•ç¡®ä¿äº†ç›¸åŒçš„å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸€ç›´å‘é€åˆ°ç›¸åŒçš„æœåŠ¡å™¨ï¼Œä»¥ä¿è¯sessionä¼šè¯ã€‚è¿™æ ·æ¯ä¸ªè®¿å®¢éƒ½å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionä¸èƒ½è·¨æœåŠ¡å™¨çš„é—®é¢˜ã€‚<br>â€‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">upstream dynamic_name &#123;<br>        ip_hash;    <span class="hljs-comment">#ä¿è¯æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨</span><br>        server localhost:8081 weight=9;<br>        server localhost:8082; <br>        server localhost:8083   max_fails=3 fail_timeout=20s;<br>&#125;              <br>server &#123;<br><span class="hljs-comment">#...çœç•¥...</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="least-connï¼š"><a href="#least-connï¼š" class="headerlink" title="least_connï¼š"></a>least_connï¼š</h2><p>æŠŠè¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„åç«¯æœåŠ¡å™¨ã€‚è½®è¯¢ç®—æ³•æ˜¯æŠŠè¯·æ±‚å¹³å‡çš„è½¬å‘ç»™å„ä¸ªåç«¯ï¼Œä½¿å®ƒä»¬çš„è´Ÿè½½å¤§è‡´ç›¸åŒï¼›ä½†æ˜¯ï¼Œæœ‰äº›è¯·æ±‚å ç”¨çš„æ—¶é—´å¾ˆé•¿ï¼Œä¼šå¯¼è‡´å…¶æ‰€åœ¨çš„åç«¯è´Ÿè½½è¾ƒé«˜ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œleast_connè¿™ç§æ–¹å¼å°±å¯ä»¥è¾¾åˆ°æ›´å¥½çš„è´Ÿè½½å‡è¡¡æ•ˆæœã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">upstream dynamic_name &#123;<br>        least_conn;    <span class="hljs-comment">#æŠŠè¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„åç«¯æœåŠ¡å™¨</span><br>        server localhost:8081;<br>        server localhost:8082 backup;<br>        server localhost:8083   max_fails=3 fail_timeout=20s;<br>&#125; <br>server &#123;<br><span class="hljs-comment">#...çœç•¥...</span><br>&#125;           <br></code></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰æ–¹ç­–ç•¥ï¼š"><a href="#ç¬¬ä¸‰æ–¹ç­–ç•¥ï¼š" class="headerlink" title="ç¬¬ä¸‰æ–¹ç­–ç•¥ï¼š"></a>ç¬¬ä¸‰æ–¹ç­–ç•¥ï¼š</h2><p>ç¬¬ä¸‰æ–¹çš„è´Ÿè½½å‡è¡¡ç­–ç•¥çš„å®ç°éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚</p><h3 id="fairï¼š"><a href="#fairï¼š" class="headerlink" title="fairï¼š"></a>fairï¼š</h3><p>æŒ‰ç…§æœåŠ¡å™¨ç«¯çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">upstream dynamic_name &#123;<br>        server localhost:8081;<br>        server localhost:8082;<br>        server localhost:8083;<br>        fair;    <span class="hljs-comment">#å®ç°å“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…</span><br>&#125;              <br>server &#123;<br><span class="hljs-comment">#...çœç•¥...</span><br>&#125;            <br></code></pre></td></tr></table></figure><h3 id="url-hashï¼š"><a href="#url-hashï¼š" class="headerlink" title="url_hashï¼š"></a>url_hashï¼š</h3><p>ã€€æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œè¦é…åˆç¼“å­˜å‘½ä¸­æ¥ä½¿ç”¨ã€‚åŒä¸€ä¸ªèµ„æºå¤šæ¬¡è¯·æ±‚ï¼Œå¯èƒ½ä¼šåˆ°è¾¾ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¯¼è‡´ä¸å¿…è¦çš„å¤šæ¬¡ä¸‹è½½ï¼Œç¼“å­˜å‘½ä¸­ç‡ä¸é«˜ï¼Œä»¥åŠä¸€äº›èµ„æºæ—¶é—´çš„æµªè´¹ã€‚è€Œä½¿ç”¨url_hashï¼Œå¯ä»¥ä½¿å¾—åŒä¸€ä¸ªurlï¼ˆä¹Ÿå°±æ˜¯åŒä¸€ä¸ªèµ„æºè¯·æ±‚ï¼‰ä¼šåˆ°è¾¾åŒä¸€å°æœåŠ¡å™¨ï¼Œä¸€æ—¦ç¼“å­˜ä½äº†èµ„æºï¼Œå†æ­¤æ”¶åˆ°è¯·æ±‚ï¼Œå°±å¯ä»¥ä»ç¼“å­˜ä¸­è¯»å–ã€‚ã€€</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">upstream dynamic_name &#123;<br>        <span class="hljs-built_in">hash</span> <span class="hljs-variable">$request_uri</span>;    <span class="hljs-comment">#å®ç°æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨</span><br>        server localhost:8081;<br>        server localhost:8082;<br>        server localhost:8083;<br>&#125;<br>server &#123;<br><span class="hljs-comment">#...çœç•¥...</span><br>&#125;   <br></code></pre></td></tr></table></figure><p><strong>æ€»ç»“</strong></p><p>ã€€ã€€ä»¥ä¸Šä¾¿æ˜¯6ç§è´Ÿè½½å‡è¡¡ç­–ç•¥çš„å®ç°æ–¹å¼ï¼Œå…¶ä¸­é™¤äº†è½®è¯¢å’Œè½®è¯¢æƒé‡å¤–ï¼Œéƒ½æ˜¯Nginxæ ¹æ®ä¸åŒçš„ç®—æ³•å®ç°çš„ã€‚åœ¨å®é™…è¿ç”¨ä¸­ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„åœºæ™¯é€‰æ‹©æ€§è¿ç”¨ï¼Œå¤§éƒ½æ˜¯å¤šç§ç­–ç•¥ç»“åˆä½¿ç”¨ä»¥è¾¾åˆ°å®é™…éœ€æ±‚ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nginxå®‰è£…</title>
    <link href="/2023/03/27/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx%E5%AE%89%E8%A3%85/"/>
    <url>/2023/03/27/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Nginxå®‰è£…"><a href="#Nginxå®‰è£…" class="headerlink" title="Nginxå®‰è£…"></a>Nginxå®‰è£…</h1><h2 id="ä¸€ã€äºŒè¿›åˆ¶å®‰è£…"><a href="#ä¸€ã€äºŒè¿›åˆ¶å®‰è£…" class="headerlink" title="ä¸€ã€äºŒè¿›åˆ¶å®‰è£…"></a>ä¸€ã€äºŒè¿›åˆ¶å®‰è£…</h2><h3 id="1-å»nginxå®˜ç½‘æ‹‰å–æºæ–‡ä»¶"><a href="#1-å»nginxå®˜ç½‘æ‹‰å–æºæ–‡ä»¶" class="headerlink" title="1.å»nginxå®˜ç½‘æ‹‰å–æºæ–‡ä»¶"></a>1.å»nginxå®˜ç½‘æ‹‰å–æºæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget http://nginx.org/download/nginx-1.18.0.tar.gz<br><span class="hljs-comment">#æˆ–è€…ä¸‹è½½æºæ–‡ä»¶åˆ°æœ¬åœ°ï¼Œå»ºè®®æ”¾åˆ°/home/ç›®å½•ä¸‹</span><br></code></pre></td></tr></table></figure><h3 id="2-å®‰è£…ä¾èµ–ç¯å¢ƒ"><a href="#2-å®‰è£…ä¾èµ–ç¯å¢ƒ" class="headerlink" title="2.å®‰è£…ä¾èµ–ç¯å¢ƒ"></a>2.å®‰è£…ä¾èµ–ç¯å¢ƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install gcc openssl-devel pcre pcre-devel zlib zlib-devel -y<br>æˆ–è€…<br>yum install -y gcc-c++ zlib zlib-devel openssl openssl--devel pcre pcre-devel <br></code></pre></td></tr></table></figure><h3 id="3-è§£å‹nginxæºæ–‡ä»¶å‹ç¼©åŒ…"><a href="#3-è§£å‹nginxæºæ–‡ä»¶å‹ç¼©åŒ…" class="headerlink" title="3.è§£å‹nginxæºæ–‡ä»¶å‹ç¼©åŒ…"></a>3.è§£å‹nginxæºæ–‡ä»¶å‹ç¼©åŒ…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -xf nginx-1.18.0.tar.gz<br></code></pre></td></tr></table></figure><h3 id="4-è§£å‹åè¿›å…¥nginxæ–‡ä»¶å†…"><a href="#4-è§£å‹åè¿›å…¥nginxæ–‡ä»¶å†…" class="headerlink" title="4.è§£å‹åè¿›å…¥nginxæ–‡ä»¶å†…"></a>4.è§£å‹åè¿›å…¥nginxæ–‡ä»¶å†…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> nginx-1.18.0<br></code></pre></td></tr></table></figure><h3 id="5-é…ç½®nginxçš„å®‰è£…è·¯å¾„"><a href="#5-é…ç½®nginxçš„å®‰è£…è·¯å¾„" class="headerlink" title="5.é…ç½®nginxçš„å®‰è£…è·¯å¾„"></a>5.é…ç½®nginxçš„å®‰è£…è·¯å¾„</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">./configure --prefix=/usr/local/nginx<br><br><span class="hljs-comment">#å¦‚æœ--prefixå®‰è£…çš„è·¯å¾„ä¸æ˜¯åœ¨ç¯å¢ƒå˜é‡PATHå†…ï¼Œåˆ™éœ€è¦æ·»åŠ è½¯é“¾æ¥</span><br><span class="hljs-built_in">ln</span> -s ./nginx/sbin/nginx /usr/bin/nginx<br><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><h3 id="6-è¿›è¡Œç¼–è¯‘"><a href="#6-è¿›è¡Œç¼–è¯‘" class="headerlink" title="6.è¿›è¡Œç¼–è¯‘"></a>6.è¿›è¡Œç¼–è¯‘</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">make <br>make install<br></code></pre></td></tr></table></figure><h3 id="7-å¯åŠ¨"><a href="#7-å¯åŠ¨" class="headerlink" title="7.å¯åŠ¨"></a>7.å¯åŠ¨</h3><h4 id="7-1ã€æ™®é€šå¯åŠ¨"><a href="#7-1ã€æ™®é€šå¯åŠ¨" class="headerlink" title="7.1ã€æ™®é€šå¯åŠ¨"></a>7.1ã€æ™®é€šå¯åŠ¨</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /usr/local/nginx/sbin<br><br>./nginx<br><br><span class="hljs-comment">#å¦‚æœå¯åŠ¨ä¸äº†ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦å¯åŠ¨äº†ç›¸å…³çš„è¿›ç¨‹ï¼Œç«¯å£æ˜¯å¦å†²çªï¼Œå†²çªçš„è¯ä½¿ç”¨kill +ç«¯å£å·ï¼Œé˜²ç«å¢™æ˜¯å¦å…³é—­</span><br><br><span class="hljs-comment">#æŸ¥çœ‹å¯åŠ¨çš„è¿›ç¨‹  master å’Œ workerä¸¤ä¸ªè¿›ç¨‹</span><br>ps -ef |grep nginx <br><br><span class="hljs-comment">#æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ </span><br>systemctl status firewalld <br><br><span class="hljs-comment">#å…³é—­é˜²ç«å¢™</span><br>systemctl stop firewalld<br>systemctl <span class="hljs-built_in">disable</span> firewalld<br></code></pre></td></tr></table></figure><h4 id="7-2ã€é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œå‰é¢çš„æ˜¯å¯åŠ¨æ–‡ä»¶sbinåœ°å€ï¼Œåé¢æ˜¯nginxé…ç½®æ–‡ä»¶"><a href="#7-2ã€é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œå‰é¢çš„æ˜¯å¯åŠ¨æ–‡ä»¶sbinåœ°å€ï¼Œåé¢æ˜¯nginxé…ç½®æ–‡ä»¶" class="headerlink" title="7.2ã€é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œå‰é¢çš„æ˜¯å¯åŠ¨æ–‡ä»¶sbinåœ°å€ï¼Œåé¢æ˜¯nginxé…ç½®æ–‡ä»¶"></a>7.2ã€é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œå‰é¢çš„æ˜¯å¯åŠ¨æ–‡ä»¶sbinåœ°å€ï¼Œåé¢æ˜¯nginxé…ç½®æ–‡ä»¶</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">/usr/local/nginx/sbin/nginx  -c /usr/local/nginx/conf/nginx.conf<br></code></pre></td></tr></table></figure><h3 id="8-å…³é—­nginx"><a href="#8-å…³é—­nginx" class="headerlink" title="8.å…³é—­nginx"></a>8.å…³é—­nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æŸ¥çœ‹nginxçš„è¿›ç¨‹</span><br>ps  -ef|grep nginx<br><span class="hljs-comment">#å¤„ç†è¯·æ±‚åå†å…³é—­ è¿›ç¨‹</span><br><span class="hljs-built_in">kill</span> -QUIT ä¸»pid<br><span class="hljs-comment">#ç›´æ¥å…³é—­è¿›ç¨‹ï¼Œä¸ç®¡è¯·æ±‚æ˜¯å¦å¤„ç†å®Œæˆ</span><br><span class="hljs-built_in">kill</span> -TERM ä¸»pid<br></code></pre></td></tr></table></figure><h3 id="9-é‡å¯nginx"><a href="#9-é‡å¯nginx" class="headerlink" title="9.é‡å¯nginx"></a>9.é‡å¯nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">./nginx -s reload<br></code></pre></td></tr></table></figure><h3 id="10-é…ç½®æ£€æŸ¥"><a href="#10-é…ç½®æ£€æŸ¥" class="headerlink" title="10.é…ç½®æ£€æŸ¥"></a>10.é…ç½®æ£€æŸ¥</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å‰é¢çš„æ˜¯å¯åŠ¨æ–‡ä»¶sbinåœ°å€ï¼Œåé¢æ˜¯nginxé…ç½®æ–‡ä»¶</span><br>/usr/local/nginx/sbin/nginx  -c /usr/local/nginx/conf/nginx.conf -t<br>æˆ–è€…<br>nginx -t<br></code></pre></td></tr></table></figure><h3 id="11-æŸ¥çœ‹é…ç½®ä¿¡æ¯"><a href="#11-æŸ¥çœ‹é…ç½®ä¿¡æ¯" class="headerlink" title="11.æŸ¥çœ‹é…ç½®ä¿¡æ¯"></a>11.æŸ¥çœ‹é…ç½®ä¿¡æ¯</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">./nginx -v    æŸ¥çœ‹nginxçš„ç‰ˆæœ¬<br>./nginx -v    æŸ¥çœ‹nginxçš„ç‰ˆæœ¬<br></code></pre></td></tr></table></figure><h2 id="äºŒã€rpmåŒ…å®‰è£…nginx"><a href="#äºŒã€rpmåŒ…å®‰è£…nginx" class="headerlink" title="äºŒã€rpmåŒ…å®‰è£…nginx"></a>äºŒã€rpmåŒ…å®‰è£…nginx</h2><h3 id="1-ä¸‹è½½rpmåŒ…"><a href="#1-ä¸‹è½½rpmåŒ…" class="headerlink" title="1.ä¸‹è½½rpmåŒ…"></a>1.ä¸‹è½½rpmåŒ…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.16.1-1.el7.ngx.x86_64.rpm<br></code></pre></td></tr></table></figure><h3 id="2-yumå®‰è£…nginx"><a href="#2-yumå®‰è£…nginx" class="headerlink" title="2.yumå®‰è£…nginx"></a>2.yumå®‰è£…nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install nginx-1.16.1-1.e17<br></code></pre></td></tr></table></figure><h3 id="3-å¯åŠ¨"><a href="#3-å¯åŠ¨" class="headerlink" title="3.å¯åŠ¨"></a>3.å¯åŠ¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start nginx<br>systemctl <span class="hljs-built_in">enable</span> nginx  //è®¾ç½®å¼€æœºè‡ªå¯<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€yumå®‰è£…"><a href="#ä¸‰ã€yumå®‰è£…" class="headerlink" title="ä¸‰ã€yumå®‰è£…"></a>ä¸‰ã€yumå®‰è£…</h2><h3 id="1ã€æ·»åŠ æº"><a href="#1ã€æ·»åŠ æº" class="headerlink" title="1ã€æ·»åŠ æº"></a>1ã€æ·»åŠ æº</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#é»˜è®¤æƒ…å†µCentos7ä¸­æ— Nginxçš„æºï¼Œæœ€è¿‘å‘ç°Nginxå®˜ç½‘æä¾›äº†Centosçš„æºåœ°å€ã€‚å› æ­¤å¯ä»¥å¦‚ä¸‹æ‰§è¡Œå‘½ä»¤æ·»åŠ æºï¼š</span><br>rpm -Uvh  http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm<br></code></pre></td></tr></table></figure><h3 id="2ã€å®‰è£…Nginx"><a href="#2ã€å®‰è£…Nginx" class="headerlink" title="2ã€å®‰è£…Nginx"></a>2ã€å®‰è£…Nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#é€šè¿‡yum search nginxçœ‹çœ‹æ˜¯å¦å·²ç»æ·»åŠ æºæˆåŠŸã€‚å¦‚æœæˆåŠŸåˆ™æ‰§è¡Œä¸‹åˆ—å‘½ä»¤å®‰è£…Nginxã€‚</span><br>sudo yum install -y nginx<br></code></pre></td></tr></table></figure><h3 id="3ã€å¯åŠ¨Nginx"><a href="#3ã€å¯åŠ¨Nginx" class="headerlink" title="3ã€å¯åŠ¨Nginx"></a>3ã€å¯åŠ¨Nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¸¤ç§æ–¹å¼ï¼š</span><br>nginx -c /etc/nginx/nginx.conf<br><br>nginx -s reload<br><br><span class="hljs-comment">#è®¾ç½®å¼€æœºè‡ªåŠ¨è¿è¡Œ</span><br>sudo systemctl start nginx.service<br>sudo systemctl <span class="hljs-built_in">enable</span> nginx.service<br></code></pre></td></tr></table></figure><h2 id="å››ã€dockerå®‰è£…nginx"><a href="#å››ã€dockerå®‰è£…nginx" class="headerlink" title="å››ã€dockerå®‰è£…nginx"></a>å››ã€dockerå®‰è£…nginx</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull nginx:latest<br><br>docker run --name nginx-docker -p 8080:80 -d nginx<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerfileè¯¦è§£</title>
    <link href="/2023/03/24/docker/dockerfile/dockerfile%E8%AF%A6%E8%A7%A3/"/>
    <url>/2023/03/24/docker/dockerfile/dockerfile%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Dockerfile-æ–‡ä»¶å…¨é¢è¯¦è§£"><a href="#Dockerfile-æ–‡ä»¶å…¨é¢è¯¦è§£" class="headerlink" title="Dockerfile æ–‡ä»¶å…¨é¢è¯¦è§£"></a>Dockerfile æ–‡ä»¶å…¨é¢è¯¦è§£</h1><p>Docker å¯ä»¥é€šè¿‡è¯»å– Dockerfile ä¸­çš„æŒ‡ä»¤è‡ªåŠ¨æ„å»ºé•œåƒã€‚Dockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£ï¼Œå…¶ä¸­åŒ…å«äº†ç”¨æˆ·åˆ›å»ºé•œåƒçš„æ‰€æœ‰å‘½ä»¤å’Œè¯´æ˜ã€‚</p><p><strong>ä¸€ã€ å˜é‡</strong></p><p>å˜é‡ç”¨ $variable_name æˆ–è€… ${variable_name} è¡¨ç¤ºã€‚</p><ul><li>${variable:-word} è¡¨ç¤ºå¦‚æœ variable è®¾ç½®ï¼Œåˆ™ç»“æœå°†æ˜¯è¯¥å€¼ã€‚å¦‚æœ variable æœªè®¾ç½®ï¼Œword åˆ™å°†æ˜¯ç»“æœã€‚</li><li>${variable:+word} è¡¨ç¤ºå¦‚æœ variable è®¾ç½®åˆ™ä¸º word ç»“æœï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</li></ul><p>å˜é‡å‰åŠ  \ å¯ä»¥è½¬ä¹‰æˆæ™®é€šå­—ç¬¦ä¸²ï¼š$foo or ${foo}ï¼Œè¡¨ç¤ºè½¬æ¢ä¸º $foo å’Œ ${foo} æ–‡å­—ã€‚</p><p><strong>äºŒã€FROM</strong></p><p>åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„æ„å»ºé˜¶æ®µï¼Œå¹¶è®¾ç½®åŸºç¡€é•œåƒï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">FROM [--platform=&lt;platform&gt;] &lt;image&gt; [AS &lt;name&gt;]<br>FROM [--platform=&lt;platform&gt;] &lt;image&gt;[:&lt;tag&gt;] [AS &lt;name&gt;]<br>FROM [--platform=&lt;platform&gt;] &lt;image&gt;[@&lt;digest&gt;] [AS &lt;name&gt;]<br></code></pre></td></tr></table></figure><ul><li>å•ä¸ª Dockfile å¯ä»¥å¤šæ¬¡å‡ºç° FROMï¼Œä»¥ä½¿ç”¨ä¹‹å‰çš„æ„å»ºé˜¶æ®µä½œä¸ºå¦ä¸€ä¸ªæ„å»ºé˜¶æ®µçš„ä¾èµ–é¡¹</li><li>AS name è¡¨ç¤ºä¸ºæ„å»ºé˜¶æ®µå‘½åï¼Œåœ¨åç»­ FROM å’Œ COPY â€“from&#x3D;<name> è¯´æ˜ä¸­å¯ä»¥ä½¿ç”¨è¿™ä¸ªåè¯ï¼Œå¼•ç”¨æ­¤é˜¶æ®µæ„å»ºçš„æ˜ åƒ</name></li><li>digest å…¶å®å°±æ˜¯å°±æ˜¯æ ¹æ®é•œåƒå†…å®¹äº§ç”Ÿçš„ä¸€ä¸ª IDï¼Œåªè¦é•œåƒçš„å†…å®¹ä¸å˜ digest ä¹Ÿä¸ä¼šå˜</li><li>tag æˆ– digest å€¼æ˜¯å¯é€‰çš„ã€‚å¦‚æœæ‚¨çœç•¥å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œæ„å»ºå™¨é»˜è®¤ä½¿ç”¨ä¸€ä¸ª latest æ ‡ç­¾ã€‚å¦‚æœæ‰¾ä¸åˆ°è¯¥ tag å€¼ï¼Œæ„å»ºå™¨å°†è¿”å›é”™è¯¯ã€‚</li><li>â€“platform æ ‡å¿—å¯ç”¨äºåœ¨ FROM å¼•ç”¨å¤šå¹³å°é•œåƒçš„æƒ…å†µä¸‹æŒ‡å®šå¹³å°ã€‚ä¾‹å¦‚ï¼Œlinux&#x2F;amd64ã€linux&#x2F;arm64ã€ æˆ– windows&#x2F;amd64ã€‚</li></ul><p><strong>ä¸‰ã€RUN</strong></p><p>å°†åœ¨å½“å‰é•œåƒä¹‹ä¸Šçš„æ–°å±‚ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œåœ¨ docker buildæ—¶è¿è¡Œã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">RUN /bin/bash -c <span class="hljs-string">&#x27;source $HOME/.bashrc; \</span><br><span class="hljs-string">echo $HOME&#x27;</span><br></code></pre></td></tr></table></figure><p>RUN æœ‰ä¸¤ç§å½¢å¼ï¼š</p><ul><li>RUN<command>ï¼ˆshell å½¢å¼ï¼Œå‘½ä»¤åœ¨ shell ä¸­è¿è¡Œï¼Œé»˜è®¤ &#x2F;bin&#x2F;sh -c åœ¨ Linux æˆ– cmd &#x2F;S &#x2F;CWindows ä¸Šï¼‰</li><li>RUN [â€œexecutableâ€, â€œparam1â€, â€œparam2â€]ï¼ˆæ‰§è¡Œå½¢å¼ï¼‰</li></ul><p>è¯´æ˜ï¼š</p><ul><li>å¯ä»¥ä½¿ç”¨ \ï¼ˆåæ–œæ ï¼‰å°†å•ä¸ª RUN æŒ‡ä»¤å»¶ç»­åˆ°ä¸‹ä¸€è¡Œ</li><li>RUN åœ¨ä¸‹ä¸€æ¬¡æ„å»ºæœŸé—´ï¼ŒæŒ‡ä»¤ç¼“å­˜ä¸ä¼šè‡ªåŠ¨å¤±æ•ˆã€‚å¯ä»¥ä½¿ç”¨ â€“no-cache æ ‡å¿—ä½¿æŒ‡ä»¤ç¼“å­˜æ— æ•ˆ</li><li>Dockerfile çš„æŒ‡ä»¤æ¯æ‰§è¡Œä¸€æ¬¡éƒ½ä¼šåœ¨ Docker ä¸Šæ–°å»ºä¸€å±‚ã€‚æ‰€ä»¥è¿‡å¤šæ— æ„ä¹‰çš„å±‚ï¼Œä¼šé€ æˆé•œåƒè†¨èƒ€è¿‡å¤§ï¼Œå¯ä»¥ä½¿ç”¨ &amp;&amp; ç¬¦å·è¿æ¥å‘½ä»¤ï¼Œè¿™æ ·æ‰§è¡Œåï¼Œåªä¼šåˆ›å»º 1 å±‚é•œåƒ</li></ul><p><strong>å››ã€CMD</strong></p><p>è¿è¡Œç¨‹åºï¼Œåœ¨ docker run æ—¶è¿è¡Œï¼Œä½†æ˜¯å’Œ run å‘½ä»¤ä¸åŒï¼ŒRUN æ˜¯åœ¨ docker build æ—¶è¿è¡Œã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">FROM ubuntu<br>CMD [<span class="hljs-string">&quot;/usr/bin/wc&quot;</span>,<span class="hljs-string">&quot;--help&quot;</span>]<br></code></pre></td></tr></table></figure><p>æ”¯æŒä¸‰ç§æ ¼å¼ï¼š</p><ul><li>CMD [â€œexecutableâ€,â€param1â€,â€param2â€] ä½¿ç”¨ exec æ‰§è¡Œï¼Œæ¨èæ–¹å¼ï¼›</li><li>CMD command param1 param2 åœ¨ &#x2F;bin&#x2F;sh ä¸­æ‰§è¡Œï¼Œæä¾›ç»™éœ€è¦äº¤äº’çš„åº”ç”¨ï¼›</li><li>CMD [â€œparam1â€,â€param2â€] æä¾›ç»™ ENTRYPOINT çš„é»˜è®¤å‚æ•°ã€‚</li></ul><p>æŒ‡å®šå¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ¯ä¸ª Dockerfile åªèƒ½æœ‰ä¸€æ¡ CMD å‘½ä»¤ã€‚å¦‚æœæŒ‡å®šäº†å¤šæ¡å‘½ä»¤ï¼Œåªæœ‰æœ€åä¸€æ¡ä¼šè¢«æ‰§è¡Œã€‚</p><p>å¦‚æœç”¨æˆ·å¯åŠ¨å®¹å™¨æ—¶å€™æŒ‡å®šäº†è¿è¡Œçš„å‘½ä»¤ï¼Œåˆ™ä¼šè¦†ç›–æ‰ CMD æŒ‡å®šçš„å‘½ä»¤ã€‚</p><p><strong>äº”ã€LABEL</strong></p><p>æ·»åŠ å…ƒæ•°æ®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">LABEL multi.label1=<span class="hljs-string">&quot;value1&quot;</span> \<br>      multi.label2=<span class="hljs-string">&quot;value2&quot;</span> \<br>      other=<span class="hljs-string">&quot;value3&quot;</span><br></code></pre></td></tr></table></figure><p><strong>å…­ã€EXPOSE</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">EXPOSE &lt;port&gt; [&lt;port&gt;/&lt;protocol&gt;...]<br></code></pre></td></tr></table></figure><p>Docker å®¹å™¨åœ¨è¿è¡Œæ—¶ä¾¦å¬æŒ‡å®šçš„ç½‘ç»œç«¯å£ã€‚å¯ä»¥æŒ‡å®šç«¯å£æ˜¯ç›‘å¬TCPè¿˜æ˜¯UDPï¼Œå¦‚æœä¸æŒ‡å®šåè®®ï¼Œé»˜è®¤ä¸ºTCPã€‚</p><p>è¯¥ EXPOSE æŒ‡ä»¤å®é™…ä¸Šå¹¶æœªå‘å¸ƒç«¯å£ã€‚è¦åœ¨è¿è¡Œå®¹å™¨æ—¶å®é™…å‘å¸ƒç«¯å£ï¼Œdocker run -P æ¥å‘å¸ƒå’Œæ˜ å°„ä¸€ä¸ªæˆ–å¤šä¸ªç«¯å£ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒEXPOSE å‡å®š TCPã€‚æ‚¨è¿˜å¯ä»¥æŒ‡å®š UDPï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">EXPOSE 80/udp<br></code></pre></td></tr></table></figure><p><strong>ä¸ƒã€ENV</strong></p><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ENV &lt;key&gt;=&lt;value&gt; ...<br></code></pre></td></tr></table></figure><p>è®¾ç½®çš„ç¯å¢ƒå˜é‡å°†æŒç»­å­˜åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ docker inspect æ¥æŸ¥çœ‹ã€‚ä½¿ç”¨ docker run â€“env <key>&#x3D;<value> æ¥æ›´æ”¹ç¯å¢ƒå˜é‡çš„å€¼ã€‚</value></key></p><p>å¦‚æœç¯å¢ƒå˜é‡åªåœ¨æ„å»ºæœŸé—´éœ€è¦ï¼Œè¯·è€ƒè™‘ä¸ºå•ä¸ªå‘½ä»¤è®¾ç½®ä¸€ä¸ªå€¼ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">RUN DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y ...<br></code></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨ ARGï¼Œå®ƒä¸ä¼šä¿ç•™åœ¨æœ€ç»ˆé•œåƒä¸­ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">ARG DEBIAN_FRONTEND=noninteractive<br>RUN apt-get update &amp;&amp; apt-get install -y ...<br></code></pre></td></tr></table></figure><p><strong>å…«ã€ADD</strong></p><p>å¤åˆ¶æ–°æ–‡ä»¶ã€ç›®å½•æˆ–è¿œç¨‹æ–‡ä»¶ URL <src> ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ° <dest> ä¸­ã€‚</dest></src></p><p><src> å¯ä»¥æŒ‡å®šå¤šä¸ªèµ„æºï¼Œä½†å¦‚æœå®ƒä»¬æ˜¯æ–‡ä»¶æˆ–ç›®å½•ï¼Œåˆ™å®ƒä»¬çš„è·¯å¾„è¢«è§£é‡Šä¸ºç›¸å¯¹äºæ„å»ºä¸Šä¸‹æ–‡çš„æºï¼Œä¹Ÿå°±æ˜¯ WORKDIRã€‚</src></p><p>æ¯ä¸ªéƒ½ <src> å¯èƒ½åŒ…å«é€šé…ç¬¦ï¼ŒåŒ¹é…å°†ä½¿ç”¨ Go çš„ filepath.Match è§„åˆ™ã€‚ä¾‹å¦‚ï¼š</src></p><p>æ·»åŠ æ‰€æœ‰ä»¥â€œhomâ€å¼€å¤´çš„æ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ADD hom* /mydir/<br></code></pre></td></tr></table></figure><p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ? è¢«æ›¿æ¢ä¸ºä»»ä½•å•ä¸ªå­—ç¬¦ï¼Œä¾‹å¦‚â€œhome.txtâ€ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ADD hom?.txt /mydir/<br></code></pre></td></tr></table></figure><p><dest> æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œæˆ–ç›¸å¯¹ WORKDIR çš„ç›¸å¯¹è·¯å¾„ã€‚</dest></p><p><strong>ä¹ã€COPY</strong></p><p>è¯­æ³•åŒADDä¸€è‡´ï¼Œå¤åˆ¶æ‹·è´æ–‡ä»¶ã€‚</p><p>COPY æŒ‡ä»¤å’Œ ADD æŒ‡ä»¤çš„å”¯ä¸€åŒºåˆ«åœ¨äºï¼šæ˜¯å¦æ”¯æŒä»è¿œç¨‹URLè·å–èµ„æºã€‚COPY æŒ‡ä»¤åªèƒ½ä»æ‰§è¡Œ docker build æ‰€åœ¨çš„ä¸»æœºä¸Šè¯»å–èµ„æºå¹¶å¤åˆ¶åˆ°é•œåƒä¸­ã€‚è€Œ ADD æŒ‡ä»¤è¿˜æ”¯æŒé€šè¿‡ URL ä»è¿œç¨‹æœåŠ¡å™¨è¯»å–èµ„æºå¹¶å¤åˆ¶åˆ°é•œåƒä¸­ã€‚</p><p>ç›¸åŒéœ€æ±‚æ—¶ï¼Œæ¨èä½¿ç”¨ COPY æŒ‡ä»¤ã€‚ADD æŒ‡ä»¤æ›´æ“…é•¿è¯»å–æœ¬åœ°taræ–‡ä»¶å¹¶è§£å‹ç¼©ã€‚</p><p><strong>åã€ENTRYPOINT</strong></p><p>ENTRYPOINT å’Œ CMD ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨æŒ‡å®šå®¹å™¨å¯åŠ¨ç¨‹åºåŠå‚æ•°ï¼Œä¸è¿‡å®ƒä¸ä¼šè¢« docker run çš„å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šçš„æŒ‡ä»¤æ‰€è¦†ç›–ã€‚å¦‚æœè¦è¦†ç›–çš„è¯ï¼Œéœ€è¦é€šè¿‡ docker run â€“entrypoint æ¥æŒ‡å®šã€‚</p><p>å®ƒæœ‰2ç§æ ¼å¼ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">ENTRYPOINT [<span class="hljs-string">&quot;executable&quot;</span>, <span class="hljs-string">&quot;param1&quot;</span>, <span class="hljs-string">&quot;param2&quot;</span>]<br>ENTRYPOINT <span class="hljs-built_in">command</span> param1 param2<br></code></pre></td></tr></table></figure><p>æŒ‡å®šäº† ENTRYPOINT åï¼Œ CMD çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ ç»™ ENTRYPOINT æŒ‡ä»¤ï¼Œå®é™…æ‰§è¡Œæ—¶ï¼Œå°†å˜ä¸ºï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;ENTRYPOINT&gt; &lt;CMD&gt;<br></code></pre></td></tr></table></figure><p><strong>åä¸€ã€VOLUME</strong></p><p>åˆ›å»ºä¸€ä¸ªå…·æœ‰æŒ‡å®šåç§°çš„æŒ‚è½½æ•°æ®å·ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">VOLUME [<span class="hljs-string">&quot;/var/log/&quot;</span>]<br>VOLUME /var/log<br></code></pre></td></tr></table></figure><p>å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ï¼š</p><ul><li>é¿å…é‡è¦çš„æ•°æ®ï¼Œå› å®¹å™¨é‡å¯è€Œä¸¢å¤±</li><li>é¿å…å®¹å™¨ä¸æ–­å˜å¤§</li></ul><p><strong>åäºŒã€ARG</strong></p><p>å®šä¹‰å˜é‡ï¼Œä¸ ENV ä½œç”¨ç›¸åŒï¼Œä¸è¿‡ ARG å˜é‡ä¸ä¼šåƒ ENV å˜é‡é‚£æ ·æŒä¹…åŒ–åˆ°æ„å»ºå¥½çš„é•œåƒä¸­ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ARG &lt;name&gt;[=&lt;default value&gt;]<br></code></pre></td></tr></table></figure><p>Docker æœ‰ä¸€ç»„é¢„å®šä¹‰çš„ ARG å˜é‡ï¼Œæ‚¨å¯ä»¥åœ¨ Dockerfile ä¸­æ²¡æœ‰ç›¸åº”æŒ‡ä»¤çš„æƒ…å†µä¸‹ä½¿ç”¨è¿™äº›å˜é‡ã€‚</p><ul><li>HTTP_PROXY</li><li>http_proxy</li><li>HTTPS_PROXY</li><li>https_proxy</li><li>FTP_PROXY</li><li>ftp_proxy</li><li>NO_PROXY</li><li>no_proxy</li></ul><p>è¦ä½¿ç”¨è¿™äº›ï¼Œè¯·ä½¿ç”¨ â€“build-arg æ ‡å¿—åœ¨å‘½ä»¤è¡Œä¸Šä¼ é€’å®ƒä»¬ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker build --build-arg HTTPS_PROXY=https://my-proxy.example.com .<br></code></pre></td></tr></table></figure><p><strong>åä¸‰ã€ONBUILD</strong></p><p>å°†ä¸€ä¸ªè§¦å‘æŒ‡ä»¤æ·»åŠ åˆ°é•œåƒä¸­ï¼Œä»¥ä¾¿ç¨ååœ¨è¯¥é•œåƒç”¨ä½œå¦ä¸€ä¸ªæ„å»ºçš„åŸºç¡€æ—¶æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯å¦å¤–ä¸€ä¸ª dockerfile FROM äº†è¿™ä¸ªé•œåƒçš„æ—¶å€™æ‰§è¡Œã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">ONBUILD ADD . /app/src<br>ONBUILD RUN /usr/local/bin/python-build --<span class="hljs-built_in">dir</span> /app/src<br></code></pre></td></tr></table></figure><p><strong>åå››ã€STOPSIGNAL</strong></p><p>è®¾ç½®å°†å‘é€åˆ°å®¹å™¨é€€å‡ºçš„ç³»ç»Ÿè°ƒç”¨ä¿¡å·ã€‚è¯¥ä¿¡å·å¯ä»¥æ˜¯ä¸å†…æ ¸ç³»ç»Ÿè°ƒç”¨è¡¨ä¸­çš„ä½ç½®åŒ¹é…çš„æœ‰æ•ˆæ— ç¬¦å·æ•°ï¼Œä¾‹å¦‚ 9ï¼Œæˆ–æ ¼å¼ä¸º SIGNAME çš„ä¿¡å·åç§°ï¼Œä¾‹å¦‚ SIGKILLã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">STOPSIGNAL signal<br></code></pre></td></tr></table></figure><p>é»˜è®¤çš„ stop-signal æ˜¯ SIGTERMï¼Œåœ¨ docker stop çš„æ—¶å€™ä¼šç»™å®¹å™¨å†… PID ä¸º 1 çš„è¿›ç¨‹å‘é€è¿™ä¸ª signalï¼Œé€šè¿‡ â€“stop-signal å¯ä»¥è®¾ç½®è‡ªå·±éœ€è¦çš„ signalï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è®©å®¹å™¨å†…çš„åº”ç”¨ç¨‹åºåœ¨æ¥æ”¶åˆ° signal ä¹‹åå¯ä»¥å…ˆå¤„ç†ä¸€äº›äº‹ç‰©ï¼Œå®ç°å®¹å™¨çš„å¹³æ»‘é€€å‡ºï¼Œå¦‚æœä¸åšä»»ä½•å¤„ç†ï¼Œå®¹å™¨å°†åœ¨ä¸€æ®µæ—¶é—´ä¹‹åå¼ºåˆ¶é€€å‡ºï¼Œä¼šé€ æˆä¸šåŠ¡çš„å¼ºåˆ¶ä¸­æ–­ï¼Œé»˜è®¤æ—¶é—´æ˜¯ 10sã€‚</p><p><strong>åäº”ã€HEALTHCHECK</strong></p><p>ç”¨äºæŒ‡å®šæŸä¸ªç¨‹åºæˆ–è€…æŒ‡ä»¤æ¥ç›‘æ§ Docker å®¹å™¨æœåŠ¡çš„è¿è¡ŒçŠ¶æ€ã€‚è¯¥ HEALTHCHECK æŒ‡ä»¤æœ‰ä¸¤ç§å½¢å¼ï¼š</p><ul><li>HEALTHCHECK [OPTIONS] CMD commandï¼ˆé€šè¿‡åœ¨å®¹å™¨å†…è¿è¡Œå‘½ä»¤æ¥æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶å†µï¼‰</li><li>HEALTHCHECK NONEï¼ˆç¦ç”¨ä»åŸºç¡€é•œåƒç»§æ‰¿çš„ä»»ä½•å¥åº·æ£€æŸ¥ï¼‰</li></ul><p><strong>åå…­ã€SHELL</strong></p><p>è¦†ç›–ç”¨äºå‘½ä»¤çš„ shell å½¢å¼çš„é»˜è®¤ shellã€‚Linux ä¸Šçš„é»˜è®¤ shell æ˜¯ [â€œ&#x2F;bin&#x2F;shâ€, â€œ-câ€]ï¼ŒWindows ä¸Šæ˜¯ [â€œcmdâ€, â€œ&#x2F;Sâ€, â€œ&#x2F;Câ€]ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">SHELL [<span class="hljs-string">&quot;executable&quot;</span>, <span class="hljs-string">&quot;parameters&quot;</span>]<br></code></pre></td></tr></table></figure><p>è¯¥ SHELL æŒ‡ä»¤åœ¨ Windows ä¸Šç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸º Windows æœ‰ä¸¤ç§å¸¸ç”¨ä¸”æˆªç„¶ä¸åŒçš„æœ¬æœº SHELLï¼šcmd å’Œ powershellï¼Œä»¥åŠå¯ç”¨çš„å¤‡ç”¨ shellï¼ŒåŒ…æ‹¬ shã€‚è¯¥ SHELL æŒ‡ä»¤å¯ä»¥å‡ºç°å¤šæ¬¡ã€‚æ¯æ¡ SHELL æŒ‡ä»¤éƒ½ä¼šè¦†ç›–æ‰€æœ‰å…ˆå‰çš„ SHELL æŒ‡ä»¤ï¼Œå¹¶å½±å“æ‰€æœ‰åç»­æŒ‡ä»¤ã€‚</p><p><strong>åä¸ƒã€WORKDIR</strong></p><p>å·¥ä½œç›®å½•ï¼Œå¦‚æœ WORKDIR ä¸å­˜åœ¨ï¼Œå³ä½¿å®ƒæ²¡æœ‰åœ¨åç»­ Dockerfile æŒ‡ä»¤ä¸­ä½¿ç”¨ï¼Œå®ƒä¹Ÿä¼šè¢«åˆ›å»ºã€‚</p><p>docker build æ„å»ºé•œåƒè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ª RUN å‘½ä»¤éƒ½ä¼šæ–°å»ºä¸€å±‚ã€‚åªæœ‰é€šè¿‡ WORKDIR åˆ›å»ºçš„ç›®å½•æ‰ä¼šä¸€ç›´å­˜åœ¨ã€‚</p><p>å¯ä»¥è®¾ç½®å¤šä¸ª WORKDIRï¼Œå¦‚æœæä¾›äº†ç›¸å¯¹è·¯å¾„ï¼Œå®ƒå°†ç›¸å¯¹äºå‰ä¸€æ¡ WORKDIR æŒ‡ä»¤çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">WORKDIR /a<br>WORKDIR b<br>WORKDIR c<br>RUN <span class="hljs-built_in">pwd</span><br></code></pre></td></tr></table></figure><p>æœ€ç»ˆ pwd å‘½ä»¤çš„è¾“å‡ºæ˜¯ &#x2F;a&#x2F;b&#x2F;cã€‚</p><p>è¯¥ WORKDIR æŒ‡ä»¤å¯ä»¥è§£æå…ˆå‰ä½¿ç”¨ ENVï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">ENV DIRPATH=/path<br>WORKDIR <span class="hljs-variable">$DIRPATH</span>/<span class="hljs-variable">$DIRNAME</span><br>RUN <span class="hljs-built_in">pwd</span><br></code></pre></td></tr></table></figure><p>æœ€ç»ˆ pwd å‘½ä»¤çš„è¾“å‡ºæ˜¯ &#x2F;path&#x2F;$DIRNAMEã€‚</p><p><strong>åå…«ã€USER</strong></p><p>è®¾ç½®ç”¨æˆ·åï¼ˆæˆ– UIDï¼‰å’Œå¯é€‰çš„ç”¨æˆ·ç»„ï¼ˆæˆ– GIDï¼‰ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">USER &lt;user&gt;[:&lt;group&gt;]<br>USER &lt;UID&gt;[:&lt;GID&gt;]<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>dockerfile</category>
      
    </categories>
    
    
    <tags>
      
      <tag>dockerfile</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker-composeå®‰è£…</title>
    <link href="/2023/03/24/docker/docker-compose/docker-compose%E5%AE%89%E8%A3%85/"/>
    <url>/2023/03/24/docker/docker-compose/docker-compose%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="docker-composeçš„ä½¿ç”¨å’Œå®‰è£…"><a href="#docker-composeçš„ä½¿ç”¨å’Œå®‰è£…" class="headerlink" title="docker-composeçš„ä½¿ç”¨å’Œå®‰è£…:"></a>docker-composeçš„ä½¿ç”¨å’Œå®‰è£…:</h1><p>é€šè¿‡ä¸€ä¸ªyamlæ–‡ä»¶  æ¥å¯åŠ¨å’Œç®¡ç†å¤šä¸ªå®¹å™¨</p><h2 id="ä¸€ã€docker-composeçš„å®‰è£…ï¼š"><a href="#ä¸€ã€docker-composeçš„å®‰è£…ï¼š" class="headerlink" title="ä¸€ã€docker-composeçš„å®‰è£…ï¼š"></a>ä¸€ã€docker-composeçš„å®‰è£…ï¼š</h2><p>Linux ä¸Šæˆ‘ä»¬å¯ä»¥ä» Github ä¸Šä¸‹è½½å®ƒçš„äºŒè¿›åˆ¶åŒ…æ¥ä½¿ç”¨ï¼Œæœ€æ–°å‘è¡Œçš„ç‰ˆæœ¬åœ°å€ï¼š<a href="https://github.com/docker/compose/releases">https://github.com/docker/compose/releases</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">ä¸‹è½½äºŒè¿›åˆ¶åŒ…:<br><span class="hljs-comment">##1.24.1ç‰ˆæœ¬çš„ï¼šä¸‹è½½è·¯å¾„https://github.com/docker/compose/releases/download/1.24.1/docker-compose-Linux-x86_64</span><br><br>curl -L <span class="hljs-string">&quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class="hljs-subst">$(uname -s)</span>-<span class="hljs-subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose<br><span class="hljs-comment">#è¦å®‰è£…å…¶ä»–ç‰ˆæœ¬çš„ Composeï¼Œå¯ç›´æ¥æ›¿æ¢versionï¼š1.24.1ã€‚</span><br><br><br>å°†å¯æ‰§è¡Œæƒé™åº”ç”¨äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š<br>sudo <span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-compose<br><br>åˆ›å»ºè½¯é“¾ï¼š<br>sudo <span class="hljs-built_in">ln</span> -s /usr/local/bin/docker-compose /usr/bin/docker-compose<br><br></code></pre></td></tr></table></figure><h2 id="äºŒã€docker-composeçš„ä½¿ç”¨ï¼š"><a href="#äºŒã€docker-composeçš„ä½¿ç”¨ï¼š" class="headerlink" title="äºŒã€docker-composeçš„ä½¿ç”¨ï¼š"></a>äºŒã€docker-composeçš„ä½¿ç”¨ï¼š</h2><h3 id="1-ç¼–å†™docker-compose-ymlæ–‡ä»¶"><a href="#1-ç¼–å†™docker-compose-ymlæ–‡ä»¶" class="headerlink" title="1.ç¼–å†™docker-compose.ymlæ–‡ä»¶"></a>1.ç¼–å†™docker-compose.ymlæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¾‹å¦‚ï¼šDocker-Composeç®¡ç†MySQLå’ŒTomcatå®¹å™¨ï¼Œymlæ–‡ä»¶ä»¥key: valueæ–¹å¼æ¥æŒ‡å®šé…ç½®ä¿¡æ¯ï¼Œå¤šä¸ªé…ç½®ä¿¡æ¯ä»¥æ¢è¡Œ+ç¼©è¿›çš„æ–¹å¼æ¥åŒºåˆ†</span><br><span class="hljs-comment">#åœ¨docker-compose.ymlæ–‡ä»¶ä¸­ï¼Œä¸è¦ä½¿ç”¨åˆ¶è¡¨ç¬¦</span><br> <br>version: <span class="hljs-string">&#x27;3.1&#x27;</span><br>services:<br>  mysql:           <span class="hljs-comment"># æœåŠ¡çš„åç§°</span><br>    restart: always   <span class="hljs-comment"># ä»£è¡¨åªè¦dockerå¯åŠ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹å™¨å°±è·Ÿç€ä¸€èµ·å¯åŠ¨</span><br>    image: daocloud.io/library/mysql:5.7.4  <span class="hljs-comment"># æŒ‡å®šé•œåƒè·¯å¾„</span><br>    container_name: mysql  <span class="hljs-comment"># æŒ‡å®šå®¹å™¨åç§°</span><br>    ports:<br>      - 3306:3306   <span class="hljs-comment">#  æŒ‡å®šç«¯å£å·çš„æ˜ å°„</span><br>    environment:<br>      MYSQL_ROOT_PASSWORD: root   <span class="hljs-comment"># æŒ‡å®šMySQLçš„ROOTç”¨æˆ·ç™»å½•å¯†ç </span><br>      TZ: Asia/Shanghai        <span class="hljs-comment"># æŒ‡å®šæ—¶åŒº</span><br>    volumes:<br>     - /opt/docker_mysql_tomcat/mysql_data:/var/lib/mysql   <span class="hljs-comment"># æ˜ å°„æ•°æ®å·</span><br>  tomcat:<br>    restart: always<br>    image: daocloud.io/library/tomcat:8.5.15-jre8<br>    container_name: tomcat<br>    ports:<br>      - 8080:8080<br>    environment:<br>      TZ: Asia/Shanghai<br>    volumes:<br>      - /opt/docker_mysql_tomcat/tomcat_webapps:/usr/local/tomcat/webapps<br>      - /opt/docker_mysql_tomcat/tomcat_logs:/usr/local/tomcat/logs<br><br></code></pre></td></tr></table></figure><h3 id="2-docker-composeç›¸å…³å‘½ä»¤"><a href="#2-docker-composeç›¸å…³å‘½ä»¤" class="headerlink" title="2.docker-composeç›¸å…³å‘½ä»¤"></a>2.docker-composeç›¸å…³å‘½ä»¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä½¿ç”¨docker-composeå‘½ä»¤æ—¶ï¼Œé»˜è®¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹å¯»æ‰¾docker-compose.ymlæ–‡ä»¶</span><br><br>docker-compose up -d<span class="hljs-comment">#å¯åŠ¨ç®¡ç†çš„å®¹å™¨</span><br><br>docker-compose down <span class="hljs-comment">#å…³é—­å¹¶åˆ é™¤å®¹å™¨</span><br><br>docker-compose start|restart|stop    <span class="hljs-comment">#å¼€å¯|é‡å¯||å…³é—­å·²ç»å­˜åœ¨çš„ç”±docker-composeç»´æŠ¤çš„å®¹å™¨</span><br><br>docker-compose ps<span class="hljs-comment">#æŸ¥çœ‹ç”±docker-composeç®¡ç†çš„å®¹å™¨</span><br><br>docker-compose logs -f<span class="hljs-comment">#æŸ¥çœ‹æ—¥å¿—</span><br><br>docker-compose -f consul-compose.yaml up -d  <span class="hljs-comment">#æ‰§è¡Œyamlæ–‡ä»¶å¯åŠ¨</span><br><br>docker-compose -f consul-compose.yaml config <span class="hljs-comment">#æ£€æŸ¥yamlæ–‡ä»¶çš„é”™è¯¯</span><br></code></pre></td></tr></table></figure><h3 id="3-docker-composeé…åˆDockerfileä½¿ç”¨"><a href="#3-docker-composeé…åˆDockerfileä½¿ç”¨" class="headerlink" title="3.docker-composeé…åˆDockerfileä½¿ç”¨"></a>3.docker-composeé…åˆDockerfileä½¿ç”¨</h3><p>ä½¿ç”¨docker-compose.ymlæ–‡ä»¶ä»¥åŠDockerfileæ–‡ä»¶åœ¨ç”Ÿæˆè‡ªå®šä¹‰é•œåƒçš„åŒæ—¶å¯åŠ¨å½“å‰é•œåƒï¼Œå¹¶ä¸”ç”±docker-composeå»ç®¡ç†å®¹å™¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sh">ä¾‹å¦‚ï¼š<br>docker-compose.ymlæ–‡ä»¶ï¼š<br><br>version: <span class="hljs-string">&#x27;3.1&#x27;</span><br>services:                   <br>  ssm:                          <span class="hljs-comment">#æœåŠ¡çš„åç§°</span><br>    restart: always             <span class="hljs-comment">#ä»£è¡¨dockerå¯åŠ¨ï¼ŒæœåŠ¡å°±å¯åŠ¨</span><br>    build:                      <span class="hljs-comment">#æ„å»ºè‡ªå®šä¹‰é•œåƒ</span><br>      context: ../              <span class="hljs-comment">#æŒ‡å®šè‡ªå®šä¹‰çš„dockerfileæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„</span><br>      dockerfile: ssmfile       <span class="hljs-comment">#æŒ‡å®šè‡ªå®šä¹‰çš„dockerfileæ–‡ä»¶çš„åç§°</span><br>    image: ssm:1.0.1            <span class="hljs-comment">#æŒ‡å®šè‡ªå®šä¹‰çš„dockerfileæƒ³å«ä»€ä¹ˆåç§°ï¼Œä¸éœ€è¦å»ä¸­å¤®ä»“åº“ä¸Šå–</span><br>    container_name: ssm       <br>    ports: <br>      8081:8081<br>    environment:<br>      TZ: Asia/Shanghai<br>      <br>dockerfileæ–‡ä»¶:<br><br>from daocloud.io/library/tomcat:7.0.56 <span class="hljs-comment">#ä¾èµ–çš„Tomcaté•œåƒåœ°å€</span><br>copy ssm.war /usr/local/tomcat/webapps <span class="hljs-comment">#å°†webæ–‡ä»¶ssm.waræ‹·è´åˆ°Tomcatå·¥ä½œç›®å½•å†…</span><br><br><span class="hljs-comment">#å°†ssm.var  dockerfile docker-compose.yml æŒ‰ç…§å¯¹åº”æ ¼å¼å­˜æ”¾</span><br><br>ç„¶åè¿›å…¥åˆ°docker-composeç›®å½•ä¸‹,å¯ä»¥ç›´æ¥å¯åŠ¨åŸºäºdocker-compose.ymlä»¥åŠdockerfileæ–‡ä»¶æ„å»ºçš„è‡ªå®šä¹‰é•œåƒ<br>docker-compose up -d<br><span class="hljs-comment">#å¦‚æœè‡ªå®šä¹‰é•œåƒä¸å­˜åœ¨ï¼Œä¼šå¸®åŠ©æˆ‘ä»¬æ„å»ºå‡ºè‡ªå®šä¹‰é•œåƒï¼Œå¦‚æœè‡ªå®šä¹‰é•œåƒå·²ç»å­˜åœ¨ï¼Œä¼šç›´æ¥è¿è¡Œè¿™ä¸ªè‡ªå®šä¹‰é•œåƒ</span><br><br><br><span class="hljs-comment">#é‡æ–°æ„å»ºè‡ªå®šä¹‰é•œåƒ</span><br>docker-compose build <br><br><span class="hljs-comment">#è¿è¡Œå½“å‰å†…å®¹ï¼Œå¹¶é‡æ–°æ„å»º</span><br>docker-compose up -d --build<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>docker-compose</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker-compose</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker-compose.yml é…ç½®æ–‡ä»¶ç¼–å†™è¯¦è§£</title>
    <link href="/2023/03/24/docker/docker-compose/docker-compose_yaml%E6%96%87%E4%BB%B6/"/>
    <url>/2023/03/24/docker/docker-compose/docker-compose_yaml%E6%96%87%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="docker-compose-yml-é…ç½®æ–‡ä»¶ç¼–å†™è¯¦è§£"><a href="#docker-compose-yml-é…ç½®æ–‡ä»¶ç¼–å†™è¯¦è§£" class="headerlink" title="docker-compose.yml é…ç½®æ–‡ä»¶ç¼–å†™è¯¦è§£"></a>docker-compose.yml é…ç½®æ–‡ä»¶ç¼–å†™è¯¦è§£</h1><h2 id="ä¸€-å‰è¨€"><a href="#ä¸€-å‰è¨€" class="headerlink" title="ä¸€.å‰è¨€"></a>ä¸€.å‰è¨€</h2><p>å…³äº docker compose æŠ€æœ¯å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ Docker Compose<br>æ’°å†™è§„èŒƒï¼š<a href="https://github.com/compose-spec/compose-spec/blob/master/spec.md">https://github.com/compose-spec/compose-spec/blob/master/spec.md</a></p><p>ä»¥ä¸‹çš„å†…å®¹æ˜¯ç¡®ç«‹åœ¨å·²ç»ä¸‹è½½å¥½ Docker ä»¥åŠ Docker Composeï¼Œå¯å‚çœ‹ Docker Compose çš„å®˜æ–¹å®‰è£…æ•™ç¨‹ Install Docker Compose</p><p>åŸæ–‡å‚è€ƒï¼š [<a href="https://blog.csdn.net/qq_36148847/article/details/79427878]">https://blog.csdn.net/qq_36148847/article/details/79427878]</a><br>( <a href="https://blog.csdn.net/Aria_Miazzy/article/details/89326829">https://blog.csdn.net/Aria_Miazzy/article/details/89326829</a>)<br>( <a href="https://blog.csdn.net/qq_36148847/article/details/79427878">https://blog.csdn.net/qq_36148847/article/details/79427878</a>)</p><h2 id="äºŒ-Docker-Compose-é…ç½®æ–‡ä»¶çš„æ„å»ºå‚æ•°è¯´æ˜"><a href="#äºŒ-Docker-Compose-é…ç½®æ–‡ä»¶çš„æ„å»ºå‚æ•°è¯´æ˜" class="headerlink" title="äºŒ. Docker Compose é…ç½®æ–‡ä»¶çš„æ„å»ºå‚æ•°è¯´æ˜"></a>äºŒ. Docker Compose é…ç½®æ–‡ä»¶çš„æ„å»ºå‚æ•°è¯´æ˜</h2><p>é¦–å…ˆï¼Œå®˜æ–¹æä¾›äº†ä¸€ä¸ª yaml Docker Compose é…ç½®æ–‡ä»¶çš„æ ‡å‡†ä¾‹å­</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">services:</span><br><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:alpine</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;6379&quot;</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">frontend</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>      <span class="hljs-attr">update_config:</span><br>        <span class="hljs-attr">parallelism:</span> <span class="hljs-number">2</span><br>        <span class="hljs-attr">delay:</span> <span class="hljs-string">10s</span><br>      <span class="hljs-attr">restart_policy:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">on-failure</span><br><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres:9.4</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db-data:/var/lib/postgresql/data</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">placement:</span><br>        <span class="hljs-attr">constraints:</span> [<span class="hljs-string">node.role</span> <span class="hljs-string">==</span> <span class="hljs-string">manager</span>]<br><br>  <span class="hljs-attr">vote:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dockersamples/examplevotingapp_vote:before</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">5000</span><span class="hljs-string">:80</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">frontend</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>      <span class="hljs-attr">update_config:</span><br>        <span class="hljs-attr">parallelism:</span> <span class="hljs-number">2</span><br>      <span class="hljs-attr">restart_policy:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">on-failure</span><br><br>  <span class="hljs-attr">result:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dockersamples/examplevotingapp_result:before</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">5001</span><span class="hljs-string">:80</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">update_config:</span><br>        <span class="hljs-attr">parallelism:</span> <span class="hljs-number">2</span><br>        <span class="hljs-attr">delay:</span> <span class="hljs-string">10s</span><br>      <span class="hljs-attr">restart_policy:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">on-failure</span><br><br>  <span class="hljs-attr">worker:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dockersamples/examplevotingapp_worker</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">frontend</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">mode:</span> <span class="hljs-string">replicated</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">labels:</span> [<span class="hljs-string">APP=VOTING</span>]<br>      <span class="hljs-attr">restart_policy:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">on-failure</span><br>        <span class="hljs-attr">delay:</span> <span class="hljs-string">10s</span><br>        <span class="hljs-attr">max_attempts:</span> <span class="hljs-number">3</span><br>        <span class="hljs-attr">window:</span> <span class="hljs-string">120s</span><br>      <span class="hljs-attr">placement:</span><br>        <span class="hljs-attr">constraints:</span> [<span class="hljs-string">node.role</span> <span class="hljs-string">==</span> <span class="hljs-string">manager</span>]<br><br>  <span class="hljs-attr">visualizer:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dockersamples/visualizer:stable</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8080:8080&quot;</span><br>    <span class="hljs-attr">stop_grace_period:</span> <span class="hljs-string">1m30s</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">placement:</span><br>        <span class="hljs-attr">constraints:</span> [<span class="hljs-string">node.role</span> <span class="hljs-string">==</span> <span class="hljs-string">manager</span>]<br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">frontend:</span><br>  <span class="hljs-attr">backend:</span><br><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">db-data:</span><br><br></code></pre></td></tr></table></figure><p>æ­¤æ–‡ä»¶é…ç½®äº†å¤šä¸ªæœåŠ¡ï¼Œå…³äºæ­¤é…ç½®æ–‡ä»¶çš„å„ä¸ªè¯­å¥å«ä¹‰å°±éœ€è¦å¼„æ‡‚é…ç½®é€‰é¡¹çš„å«ä¹‰äº†</p><h3 id="æ–‡ä»¶é…ç½®"><a href="#æ–‡ä»¶é…ç½®" class="headerlink" title="æ–‡ä»¶é…ç½®"></a>æ–‡ä»¶é…ç½®</h3><p>compose æ–‡ä»¶æ˜¯ä¸€ä¸ªå®šä¹‰æœåŠ¡ã€ ç½‘ç»œå’Œå·çš„ YAML æ–‡ä»¶ ã€‚Compose æ–‡ä»¶çš„é»˜è®¤è·¯å¾„æ˜¯ .&#x2F;docker-compose.yml</p><blockquote><p>æç¤ºï¼šå¯ä»¥æ˜¯ç”¨ .yml æˆ– .yaml ä½œä¸ºæ–‡ä»¶æ‰©å±•å</p></blockquote><p>æœåŠ¡å®šä¹‰åŒ…å«åº”ç”¨äºä¸ºè¯¥æœåŠ¡å¯åŠ¨çš„æ¯ä¸ªå®¹å™¨çš„é…ç½®ï¼Œå°±åƒä¼ é€’å‘½ä»¤è¡Œå‚æ•°ä¸€æ · <strong>docker container create</strong>ã€‚åŒæ ·ï¼Œç½‘ç»œå’Œå·çš„å®šä¹‰ç±»ä¼¼äº docker network create å’Œ docker volume createã€‚</p><p>æ­£å¦‚ docker container create åœ¨ Dockerfile æŒ‡å®šé€‰é¡¹ï¼Œå¦‚ CMDã€ EXPOSEã€VOLUMEã€ENVï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ ä¸éœ€è¦å†æ¬¡æŒ‡å®šå®ƒä»¬docker-compose.ymlã€‚</p><p>å¯ä»¥ä½¿ç”¨ Bash ç±» ${VARIABLE} è¯­æ³•åœ¨é…ç½®å€¼ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ã€‚</p><h3 id="é…ç½®é€‰é¡¹"><a href="#é…ç½®é€‰é¡¹" class="headerlink" title="é…ç½®é€‰é¡¹"></a>é…ç½®é€‰é¡¹</h3><h4 id="1-bulid"><a href="#1-bulid" class="headerlink" title="1.bulid"></a>1.bulid</h4><p>æœåŠ¡é™¤äº†å¯ä»¥åŸºäºæŒ‡å®šçš„é•œåƒï¼Œè¿˜å¯ä»¥åŸºäºä¸€ä»½ Dockerfileï¼Œåœ¨ä½¿ç”¨ up å¯åŠ¨ä¹‹æ—¶æ‰§è¡Œæ„å»ºä»»åŠ¡ï¼Œè¿™ä¸ªæ„å»ºæ ‡ç­¾å°±æ˜¯ buildï¼Œå®ƒå¯ä»¥æŒ‡å®š Dockerfile æ‰€åœ¨æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚Compose å°†ä¼šåˆ©ç”¨å®ƒè‡ªåŠ¨æ„å»ºè¿™ä¸ªé•œåƒï¼Œç„¶åä½¿ç”¨è¿™ä¸ªé•œåƒå¯åŠ¨æœåŠ¡å®¹å™¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">build:</span> <span class="hljs-string">/path/to/build/dir</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">build:</span> <span class="hljs-string">./dir</span><br></code></pre></td></tr></table></figure><p>è®¾å®šä¸Šä¸‹æ–‡æ ¹ç›®å½•ï¼Œç„¶åä»¥è¯¥ç›®å½•ä¸ºå‡†æŒ‡å®š Dockerfile</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">build:</span><br>  <span class="hljs-attr">context:</span> <span class="hljs-string">../</span><br>  <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">path/of/Dockerfile</span><br>  <br><span class="hljs-comment"># ä¾‹å­</span><br><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">webapp:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">./dir</span><br></code></pre></td></tr></table></figure><p>å¦‚æœ context ä¸­æœ‰æŒ‡å®šçš„è·¯å¾„ï¼Œå¹¶ä¸”å¯ä»¥é€‰å®š Dockerfile å’Œ argsã€‚é‚£ä¹ˆ arg è¿™ä¸ªæ ‡ç­¾ï¼Œå°±åƒ Dockerfile ä¸­çš„ ARG æŒ‡ä»¤ï¼Œå®ƒå¯ä»¥åœ¨æ„å»ºè¿‡ç¨‹ä¸­æŒ‡å®šç¯å¢ƒå˜é‡ï¼Œä½†æ˜¯åœ¨æ„å»ºæˆåŠŸåå–æ¶ˆï¼Œåœ¨ docker-compose.yml æ–‡ä»¶ä¸­ä¹Ÿæ”¯æŒè¿™æ ·çš„å†™æ³•ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">webapp:</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">./dir</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile-alternate</span><br>      <span class="hljs-attr">args:</span><br>        <span class="hljs-attr">buildno:</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>ä¸ ENV ä¸åŒçš„æ˜¯ï¼ŒARG å¯ä»¥ä¸ºç©ºå€¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">args:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">buildno</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">password</span><br></code></pre></td></tr></table></figure><p>å¦‚æœè¦æŒ‡å®š image ä»¥åŠ build ï¼Œé€‰é¡¹æ ¼å¼ä¸º</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">build:</span> <span class="hljs-string">./dir</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">webapp:tag</span><br></code></pre></td></tr></table></figure><p>è¿™ä¼šåœ¨ .&#x2F;dir ç›®å½•ç”Ÿæˆä¸€ä¸ªåä¸º webaapp å’Œæ ‡è®°ä¸º tag çš„é•œåƒ</p><blockquote><p>Note:å½“ç”¨(Version 3) Compose æ–‡ä»¶åœ¨ç¾¤é›†æ¨¡å¼ä¸‹éƒ¨ç½²å †æ ˆæ—¶ï¼Œè¯¥é€‰é¡¹è¢«å¿½ç•¥ã€‚å› ä¸º docker stack å‘½ä»¤åªæ¥å—é¢„å…ˆæ„å»ºçš„é•œåƒ</p></blockquote><h4 id="2-context"><a href="#2-context" class="headerlink" title="2.context"></a>2.context</h4><p>context é€‰é¡¹å¯ä»¥æ˜¯ Dockerfile çš„æ–‡ä»¶è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ°é“¾æ¥åˆ° git ä»“åº“çš„ url</p><p>å½“æä¾›çš„å€¼æ˜¯ç›¸å¯¹è·¯å¾„æ—¶ï¼Œå®ƒè¢«è§£æä¸ºç›¸å¯¹äºæ’°å†™æ–‡ä»¶çš„è·¯å¾„ï¼Œæ­¤ç›®å½•ä¹Ÿæ˜¯å‘é€åˆ° Docker å®ˆæŠ¤è¿›ç¨‹çš„ context</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">build:</span><br>  <span class="hljs-attr">context:</span> <span class="hljs-string">./dir</span><br></code></pre></td></tr></table></figure><h4 id="3-dockerfile"><a href="#3-dockerfile" class="headerlink" title="3.dockerfile"></a>3.dockerfile</h4><p>ä½¿ç”¨æ­¤ dockerfile æ–‡ä»¶æ¥æ„å»ºï¼Œå¿…é¡»æŒ‡å®šæ„å»ºè·¯å¾„</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">build:</span><br>  <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>  <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile-alternate</span><br></code></pre></td></tr></table></figure><h4 id="4-args"><a href="#4-args" class="headerlink" title="4.args"></a>4.args</h4><p>æ·»åŠ æ„å»ºå‚æ•°ï¼Œè¿™äº›å‚æ•°æ˜¯ä»…åœ¨æ„å»ºè¿‡ç¨‹ä¸­å¯è®¿é—®çš„ç¯å¢ƒå˜é‡</p><p>é¦–å…ˆï¼Œ åœ¨Dockerfileä¸­æŒ‡å®šå‚æ•°ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">ARG buildno<br>ARG password<br><br>RUN <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Build number: <span class="hljs-variable">$buildno</span>&quot;</span><br>RUN script-requiring-password.sh <span class="hljs-string">&quot;<span class="hljs-variable">$password</span>&quot;</span><br></code></pre></td></tr></table></figure><p>ç„¶åæŒ‡å®š build ä¸‹çš„å‚æ•°,å¯ä»¥ä¼ é€’æ˜ å°„æˆ–åˆ—è¡¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">build:</span><br>  <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>  <span class="hljs-attr">args:</span><br>    <span class="hljs-attr">buildno:</span> <span class="hljs-number">1</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">secret</span><br></code></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">build:</span><br>  <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>  <span class="hljs-attr">args:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">buildno=1</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">password=secret</span><br></code></pre></td></tr></table></figure><p>æŒ‡å®šæ„å»ºå‚æ•°æ—¶å¯ä»¥çœç•¥è¯¥å€¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ„å»ºæ—¶çš„å€¼é»˜è®¤æ„æˆè¿è¡Œç¯å¢ƒä¸­çš„å€¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">args:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">buildno</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">password</span><br></code></pre></td></tr></table></figure><blockquote><p>Noteï¼š YAML å¸ƒå°”å€¼ï¼ˆtrueï¼Œfalseï¼Œyesï¼Œnoï¼Œonï¼Œoffï¼‰å¿…é¡»ä½¿ç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œä»¥ä¸ºäº†èƒ½å¤Ÿæ­£å¸¸è¢«è§£æä¸ºå­—ç¬¦ä¸²</p></blockquote><h4 id="5-cache-from"><a href="#5-cache-from" class="headerlink" title="5.cache_from"></a>5.cache_from</h4><p>ç¼–å†™ç¼“å­˜è§£æé•œåƒåˆ—è¡¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">build:</span><br>  <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>  <span class="hljs-attr">cache_from:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">alpine:latest</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">corp/web_app:3.14</span><br></code></pre></td></tr></table></figure><h4 id="6-labels"><a href="#6-labels" class="headerlink" title="6.labels"></a>6.labels</h4><p>ä½¿ç”¨ Dockeræ ‡ç­¾ å°†å…ƒæ•°æ®æ·»åŠ åˆ°ç”Ÿæˆçš„é•œåƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ã€‚</p><p>å»ºè®®ä½¿ç”¨åå‘ DNS æ ‡è®°æ¥é˜²æ­¢ç­¾åä¸å…¶ä»–è½¯ä»¶æ‰€ä½¿ç”¨çš„ç­¾åå†²çª</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">build:</span><br>  <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">com.example.description:</span> <span class="hljs-string">&quot;Accounting webapp&quot;</span><br>    <span class="hljs-attr">com.example.department:</span> <span class="hljs-string">&quot;Finance&quot;</span><br>    <span class="hljs-attr">com.example.label-with-empty-value:</span> <span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">build:</span><br>  <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;com.example.description=Accounting webapp&quot;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;com.example.department=Finance&quot;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;com.example.label-with-empty-value&quot;</span><br></code></pre></td></tr></table></figure><h4 id="7-shm-size"><a href="#7-shm-size" class="headerlink" title="7.shm_size"></a>7.shm_size</h4><p>è®¾ç½®å®¹å™¨ &#x2F;dev&#x2F;shm åˆ†åŒºçš„å¤§å°ï¼Œå€¼ä¸ºè¡¨ç¤ºå­—èŠ‚çš„æ•´æ•°å€¼æˆ–è¡¨ç¤ºå­—ç¬¦çš„å­—ç¬¦ä¸²</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">build:</span><br>  <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>  <span class="hljs-attr">shm_size:</span> <span class="hljs-string">&#x27;2gb&#x27;</span><br><br><span class="hljs-comment"># æˆ–</span><br><br><span class="hljs-attr">build:</span><br>  <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>  <span class="hljs-attr">shm_size:</span> <span class="hljs-number">10000000</span><br></code></pre></td></tr></table></figure><h4 id="8-target"><a href="#8-target" class="headerlink" title="8.target"></a>8.target</h4><p>æ ¹æ®å¯¹åº”çš„ Dockerfile æ„å»ºæŒ‡å®š Stage</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">build:</span><br>    <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>    <span class="hljs-attr">target:</span> <span class="hljs-string">prod</span><br></code></pre></td></tr></table></figure><h4 id="9-cap-addã€cap-drop"><a href="#9-cap-addã€cap-drop" class="headerlink" title="9.cap_addã€cap_drop"></a>9.cap_addã€cap_drop</h4><p>æ·»åŠ æˆ–åˆ é™¤å®¹å™¨åŠŸèƒ½ï¼Œå¯æŸ¥çœ‹ man 7 capabilities</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">cap_add:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">ALL</span><br><br><span class="hljs-attr">cap_drop:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">NET_ADMIN</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">SYS_ADMIN</span><br></code></pre></td></tr></table></figure><blockquote><p>Note:å½“ç”¨(Version 3) Compose æ–‡ä»¶åœ¨ç¾¤é›†æ¨¡å¼ä¸‹éƒ¨ç½²å †æ ˆæ—¶ï¼Œè¯¥é€‰é¡¹è¢«å¿½ç•¥ã€‚å› ä¸º docker stack å‘½ä»¤åªæ¥å—é¢„å…ˆæ„å»ºçš„é•œåƒ</p></blockquote><h4 id="10-command"><a href="#10-command" class="headerlink" title="10.command"></a>10.command</h4><p>è¦†ç›–å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">command:</span> <span class="hljs-string">bundle</span> <span class="hljs-string">exec</span> <span class="hljs-string">thin</span> <span class="hljs-string">-p</span> <span class="hljs-number">3000</span><br></code></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ–¹æ³•ç±»ä¼¼äº dockerfile:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;bundle&quot;</span>, <span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-string">&quot;thin&quot;</span>, <span class="hljs-string">&quot;-p&quot;</span>, <span class="hljs-string">&quot;3000&quot;</span>]<br></code></pre></td></tr></table></figure><h4 id="11-configs"><a href="#11-configs" class="headerlink" title="11.configs"></a>11.configs</h4><p>ä½¿ç”¨æœåŠ¡ configs é…ç½®ä¸ºæ¯ä¸ªæœåŠ¡èµ‹äºˆç›¸åº”çš„è®¿é—®æƒé™ï¼Œæ”¯æŒä¸¤ç§ä¸åŒçš„è¯­æ³•ã€‚</p><blockquote><p>Note: é…ç½®å¿…é¡»å­˜åœ¨æˆ–åœ¨ configs æ­¤å †æ ˆæ–‡ä»¶çš„é¡¶å±‚ä¸­å®šä¹‰ï¼Œå¦åˆ™å †æ ˆéƒ¨ç½²å¤±æ•ˆ</p></blockquote><h5 id="1-SHORT-è¯­æ³•"><a href="#1-SHORT-è¯­æ³•" class="headerlink" title="1.SHORT è¯­æ³•"></a>1.SHORT è¯­æ³•</h5><p>SHORT è¯­æ³•åªèƒ½æŒ‡å®šé…ç½®åç§°ï¼Œè¿™å…è®¸å®¹å™¨è®¿é—®é…ç½®å¹¶å°†å…¶å®‰è£…åœ¨ &#x2F;<config_name> å®¹å™¨å†…ï¼Œæºåç§°å’Œç›®æ ‡è£…å…¥ç‚¹éƒ½è®¾ä¸ºé…ç½®åç§°ã€‚</config_name></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.3&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:latest</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>    <span class="hljs-attr">configs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">my_config</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">my_other_config</span><br><span class="hljs-attr">configs:</span><br>  <span class="hljs-attr">my_config:</span><br>    <span class="hljs-attr">file:</span> <span class="hljs-string">./my_config.txt</span><br>  <span class="hljs-attr">my_other_config:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šå®ä¾‹ä½¿ç”¨ SHORT è¯­æ³•å°† redis æœåŠ¡è®¿é—®æˆäºˆ my_config å’Œ my_other_config ,å¹¶è¢« my_other_config å®šä¹‰ä¸ºå¤–éƒ¨èµ„æºï¼Œè¿™æ„å‘³ç€å®ƒå·²ç»åœ¨ Docker ä¸­å®šä¹‰ã€‚å¯ä»¥é€šè¿‡ docker config create å‘½ä»¤æˆ–é€šè¿‡å¦ä¸€ä¸ªå †æ ˆéƒ¨ç½²ã€‚å¦‚æœå¤–éƒ¨éƒ¨ç½²é…ç½®éƒ½ä¸å­˜åœ¨ï¼Œåˆ™å †æ ˆéƒ¨ç½²ä¼šå¤±è´¥å¹¶å‡ºç° config not found é”™è¯¯ã€‚</p><blockquote><p>Note: config å®šä¹‰ä»…åœ¨ 3.3 ç‰ˆæœ¬æˆ–åœ¨æ›´é«˜ç‰ˆæœ¬çš„æ’°å†™æ–‡ä»¶æ ¼å¼ä¸­å—æ”¯æŒï¼ŒYAML çš„å¸ƒå°”å€¼ï¼ˆtrue, false, yes, no, on, offï¼‰å¿…é¡»è¦ä½¿ç”¨å¼•å·å¼•èµ·æ¥ï¼ˆå•å¼•å·ã€åŒå¼•å·å‡å¯ï¼‰ï¼Œå¦åˆ™ä¼šå½“æˆå­—ç¬¦ä¸²è§£æã€‚</p></blockquote><h5 id="2-LONG-è¯­æ³•"><a href="#2-LONG-è¯­æ³•" class="headerlink" title="2.LONG è¯­æ³•"></a>2.LONG è¯­æ³•</h5><p>LONG è¯­æ³•æä¾›äº†åˆ›å»ºæœåŠ¡é…ç½®çš„æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯</p><ul><li><p>source:Docker ä¸­å­˜åœ¨çš„é…ç½®çš„åç§°</p></li><li><p>target:è¦åœ¨æœåŠ¡çš„ä»»åŠ¡ä¸­è£…è½½çš„æ–‡ä»¶çš„è·¯å¾„æˆ–åç§°ã€‚å¦‚æœæœªæŒ‡å®šåˆ™é»˜è®¤ä¸º &#x2F;<source></p></li><li><p>uid å’Œ gid:åœ¨æœåŠ¡çš„ä»»åŠ¡å®¹å™¨ä¸­æ‹¥æœ‰å®‰è£…çš„é…ç½®æ–‡ä»¶çš„æ•°å­— UID æˆ– GIDã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸ºåœ¨Linuxä¸Šã€‚Windowsä¸æ”¯æŒ</p></li><li><p>mode:åœ¨æœåŠ¡çš„ä»»åŠ¡å®¹å™¨ä¸­å®‰è£…çš„æ–‡ä»¶çš„æƒé™ï¼Œä»¥å…«è¿›åˆ¶è¡¨ç¤ºæ³•ã€‚ä¾‹å¦‚ï¼Œ0444 ä»£è¡¨æ–‡ä»¶å¯è¯»çš„ã€‚é»˜è®¤æ˜¯ 0444ã€‚å¦‚æœé…ç½®æ–‡ä»¶æ— æ³•å†™å…¥ï¼Œæ˜¯å› ä¸ºå®ƒä»¬å®‰è£…åœ¨ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ‰€ä»¥å¦‚æœè®¾ç½®äº†å¯å†™ä½ï¼Œå®ƒå°†è¢«å¿½ç•¥ã€‚å¯æ‰§è¡Œä½å¯ä»¥è®¾ç½®ã€‚å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰ UNIX æ–‡ä»¶æƒé™æ¨¡å¼ï¼ŒUnix Permissions Calculator</p><p>ä¸‹é¢ç¤ºä¾‹åœ¨å®¹å™¨ä¸­å°† my_config åç§°è®¾ç½®ä¸º redis_configï¼Œå°†æ¨¡å¼è®¾ç½®ä¸º 0440ï¼ˆgroup-readableï¼‰å¹¶å°†ç”¨æˆ·å’Œç»„è®¾ç½®ä¸º 103ã€‚è¯¥ã€€ï½€redisã€€æœåŠ¡æ— æ³•è®¿é—® my_other_config é…ç½®ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.3&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:latest</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>    <span class="hljs-attr">configs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">source:</span> <span class="hljs-string">my_config</span><br>        <span class="hljs-attr">target:</span> <span class="hljs-string">/redis_config</span><br>        <span class="hljs-attr">uid:</span> <span class="hljs-string">&#x27;103&#x27;</span><br>        <span class="hljs-attr">gid:</span> <span class="hljs-string">&#x27;103&#x27;</span><br>        <span class="hljs-attr">mode:</span> <span class="hljs-number">0440</span><br><span class="hljs-attr">configs:</span><br>  <span class="hljs-attr">my_config:</span><br>    <span class="hljs-attr">file:</span> <span class="hljs-string">./my_config.txt</span><br>  <span class="hljs-attr">my_other_config:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥åŒæ—¶æˆäºˆå¤šä¸ªé…ç½®çš„æœåŠ¡ç›¸åº”çš„è®¿é—®æƒé™ï¼Œä¹Ÿå¯ä»¥æ··åˆä½¿ç”¨ LONG å’Œ SHORT è¯­æ³•ã€‚å®šä¹‰é…ç½®å¹¶ä¸æ„å‘³ç€æˆäºˆæœåŠ¡è®¿é—®æƒé™ã€‚</p><h4 id="12-cgroup-parent"><a href="#12-cgroup-parent" class="headerlink" title="12.cgroup_parent"></a>12.cgroup_parent</h4><p>å¯ä»¥ä¸ºå®¹å™¨é€‰æ‹©ä¸€ä¸ªå¯é€‰çš„çˆ¶ cgroup</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">cgroup_parent:</span> <span class="hljs-string">m-executor-abcd</span><br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šå½“ ä½¿ç”¨ï¼ˆVersion 3ï¼‰Compose æ–‡ä»¶åœ¨ç¾¤é›†æ¨¡å¼ä¸‹éƒ¨ç½²å †æ ˆæ—¶ï¼Œå¿½ç•¥æ­¤é€‰é¡¹</p></blockquote><h4 id="13-container-name"><a href="#13-container-name" class="headerlink" title="13.container_name"></a>13.container_name</h4><p>ä¸ºè‡ªå®šä¹‰çš„å®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„åç§°</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">container_name:</span> <span class="hljs-string">my-web-container</span><br></code></pre></td></tr></table></figure><p>å› ä¸º docker å®¹å™¨åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥å¦‚æœæŒ‡å®šäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„åç§°ï¼Œä¸èƒ½æ‰©å±•ä¸€ä¸ªæœåŠ¡è¶…è¿‡ 1 ä¸ªå®¹å™¨</p><h4 id="14-credential-spec"><a href="#14-credential-spec" class="headerlink" title="14.credential_spec"></a>14.credential_spec</h4><p>ä¸ºæ‰˜ç®¡æœåŠ¡è´¦æˆ·é…ç½®å‡­æ®è§„èŒƒï¼Œæ­¤é€‰é¡¹ä»…é€‚ç”¨äº Windows å®¹å™¨æœåŠ¡</p><p>åœ¨ credential_spec ä¸Šçš„é…ç½®åˆ—è¡¨æ ¼å¼ä¸º file:&#x2F;&#x2F;<filename> æˆ– registry:&#x2F;&#x2F;<value-name></value-name></filename></p><p>ä½¿ç”¨ file: åº”è¯¥æ³¨æ„å¼•ç”¨çš„æ–‡ä»¶å¿…é¡»å­˜åœ¨äº <strong>CredentialSpecs,docker</strong>  æ•°æ®ç›®å½•çš„å­ç›®å½•ä¸­ã€‚åœ¨ Windows ä¸Šï¼Œè¯¥ç›®å½•é»˜è®¤ä¸º C:\ProgramData\Docker\ ã€‚ä»¥ä¸‹ç¤ºä¾‹ä»åä¸º  C:\ProgramData\Docker\CredentialSpecs\my-credential-spec.json  çš„æ–‡ä»¶åŠ è½½å‡­è¯è§„èŒƒ ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">credential_spec:</span><br>  <span class="hljs-attr">file:</span> <span class="hljs-string">my-credential-spec.json</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ registry: å°†ä»å®ˆæŠ¤è¿›ç¨‹ä¸»æœºä¸Šçš„ Windows æ³¨å†Œè¡¨ä¸­è¯»å–å‡­æ®è§„èŒƒã€‚å…¶æ³¨å†Œè¡¨å€¼å¿…é¡»ä½äºï¼š</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Virtualization\Containers\CredentialSpecs<br></code></pre></td></tr></table></figure><p>ä¸‹é¢çš„ç¤ºä¾‹é€šè¿‡ my-credential-spec æ³¨å†Œè¡¨ä¸­æŒ‡å®šçš„å€¼åŠ è½½å‡­è¯è§„èŒƒï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">credential_spec:</span><br>  <span class="hljs-attr">registry:</span> <span class="hljs-string">my-credential-spec</span><br></code></pre></td></tr></table></figure><h4 id="15-deploy"><a href="#15-deploy" class="headerlink" title="15.deploy"></a>15.deploy</h4><p>æŒ‡å®šä¸éƒ¨ç½²å’Œè¿è¡ŒæœåŠ¡ç›¸å…³çš„é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:alpine</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">6</span><br>      <span class="hljs-attr">update_config:</span><br>        <span class="hljs-attr">parallelism:</span> <span class="hljs-number">2</span><br>        <span class="hljs-attr">delay:</span> <span class="hljs-string">10s</span><br>      <span class="hljs-attr">restart_policy:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">on-failure</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰å‡ ä¸ªå­é€‰é¡¹</p><h5 id="1-endpoint-mode"><a href="#1-endpoint-mode" class="headerlink" title="1.endpoint_mode"></a>1.endpoint_mode</h5><p>æŒ‡å®šè¿æ¥åˆ°ç¾¤ç»„å¤–éƒ¨å®¢æˆ·ç«¯æœåŠ¡å‘ç°æ–¹æ³•</p><p><strong>endpoint_mode: vip</strong> ï¼šDocker ä¸ºè¯¥æœåŠ¡åˆ†é…äº†ä¸€ä¸ªè™šæ‹Ÿ IP(VIP),ä½œä¸ºå®¢æˆ·ç«¯çš„ â€œå‰ç«¯â€œ éƒ¨ä½ç”¨äºè®¿é—®ç½‘ç»œä¸Šçš„æœåŠ¡ã€‚<br><strong>endpoint_mode: dnsrr</strong> : DNSè½®è¯¢ï¼ˆDNSRRï¼‰æœåŠ¡å‘ç°ä¸ä½¿ç”¨å•ä¸ªè™šæ‹Ÿ IPã€‚Dockerä¸ºæœåŠ¡è®¾ç½® DNS æ¡ç›®ï¼Œä½¿å¾—æœåŠ¡åç§°çš„ DNS æŸ¥è¯¢è¿”å›ä¸€ä¸ª IP åœ°å€åˆ—è¡¨ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯ç›´æ¥è¿æ¥åˆ°å…¶ä¸­çš„ä¸€ä¸ªã€‚å¦‚æœæƒ³ä½¿ç”¨è‡ªå·±çš„è´Ÿè½½å¹³è¡¡å™¨ï¼Œæˆ–è€…æ··åˆ Windows å’Œ Linux åº”ç”¨ç¨‹åºï¼Œåˆ™ DNS è½®è¯¢è°ƒåº¦ï¼ˆround-robinï¼‰åŠŸèƒ½å°±éå¸¸å®ç”¨ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.3&quot;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">wordpress:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">wordpress</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">8080</span><span class="hljs-string">:80</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">overlay</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">mode:</span> <span class="hljs-string">replicated</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>      <span class="hljs-attr">endpoint_mode:</span> <span class="hljs-string">vip</span><br><br>  <span class="hljs-attr">mysql:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql</span><br>    <span class="hljs-attr">volumes:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">db-data:/var/lib/mysql/data</span><br>    <span class="hljs-attr">networks:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">overlay</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">mode:</span> <span class="hljs-string">replicated</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>      <span class="hljs-attr">endpoint_mode:</span> <span class="hljs-string">dnsrr</span><br><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">db-data:</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">overlay:</span><br></code></pre></td></tr></table></figure><p>ç›¸å…³ä¿¡æ¯ï¼šSwarm æ¨¡å¼ CLI å‘½ä»¤ ã€Configure æœåŠ¡å‘ç°</p><blockquote><p><strong>æ³¨æ„ï¼š</strong> ä½¿ç”¨ <strong>deploy</strong> å­—æ®µé…ç½®æ—¶ï¼Œè¯¥é…ç½®é»˜è®¤åªåœ¨swarmæ¨¡å¼ä¸‹ç”Ÿæ•ˆï¼Œå¦‚æœä¸æƒ³å¼€å¯swarmï¼Œ</p><p>åªè¦åœ¨ docker-compos å¯åŠ¨æ—¶åŠ ä¸Š <strong>â€“compatibility</strong> å³å¯</p></blockquote><h5 id="2-labels"><a href="#2-labels" class="headerlink" title="2.labels"></a>2.labels</h5><p>æŒ‡å®šæœåŠ¡çš„æ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾ä»…åœ¨æœåŠ¡ä¸Šè®¾ç½®ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">web</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">com.example.description:</span> <span class="hljs-string">&quot;This label will appear on the web service&quot;</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡å°† deploy å¤–é¢çš„ labels æ ‡ç­¾æ¥è®¾ç½®å®¹å™¨ä¸Šçš„ labels</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">web</span><br>    <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">com.example.description:</span> <span class="hljs-string">&quot;This label will appear on all containers for the web service&quot;</span><br></code></pre></td></tr></table></figure><h5 id="3-mode"><a href="#3-mode" class="headerlink" title="3.mode"></a>3.mode</h5><ul><li><p>global:æ¯ä¸ªé›†èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå®¹å™¨</p></li><li><p>replicated:æŒ‡å®šå®¹å™¨æ•°é‡ï¼ˆé»˜è®¤ï¼‰</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">worker:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dockersamples/examplevotingapp_worker</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">mode:</span> <span class="hljs-string">global</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="4-placement"><a href="#4-placement" class="headerlink" title="4.placement"></a>4.placement</h5><p>æŒ‡å®š constraints å’Œ preferences</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">placement:</span><br>        <span class="hljs-attr">constraints:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">node.role</span> <span class="hljs-string">==</span> <span class="hljs-string">manager</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">engine.labels.operatingsystem</span> <span class="hljs-string">==</span> <span class="hljs-string">ubuntu</span> <span class="hljs-number">14.04</span><br>        <span class="hljs-attr">preferences:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">spread:</span> <span class="hljs-string">node.labels.zone</span><br></code></pre></td></tr></table></figure><h5 id="5-replicas"><a href="#5-replicas" class="headerlink" title="5.replicas"></a>5.replicas</h5><p>å¦‚æœæœåŠ¡æ˜¯ replicatedï¼ˆé»˜è®¤)ï¼Œéœ€è¦æŒ‡å®šè¿è¡Œçš„å®¹å™¨æ•°é‡</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">worker:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dockersamples/examplevotingapp_worker</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">frontend</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">mode:</span> <span class="hljs-string">replicated</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><h5 id="6-resources"><a href="#6-resources" class="headerlink" title="6.resources"></a>6.resources</h5><p>é…ç½®èµ„æºé™åˆ¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:alpine</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">resources:</span><br>        <span class="hljs-attr">limits:</span><br>          <span class="hljs-attr">cpus:</span> <span class="hljs-string">&#x27;0.50&#x27;</span><br>          <span class="hljs-attr">memory:</span> <span class="hljs-string">50M</span><br>        <span class="hljs-attr">reservations:</span><br>          <span class="hljs-attr">cpus:</span> <span class="hljs-string">&#x27;0.25&#x27;</span><br>          <span class="hljs-attr">memory:</span> <span class="hljs-string">20M</span><br></code></pre></td></tr></table></figure><p>æ­¤ä¾‹å­ä¸­ï¼Œredis æœåŠ¡é™åˆ¶ä½¿ç”¨ä¸è¶…è¿‡ 50M çš„å†…å­˜å’Œ 0.50ï¼ˆ50ï¼…ï¼‰å¯ç”¨å¤„ç†æ—¶é—´ï¼ˆCPUï¼‰ï¼Œå¹¶ä¸” ä¿ç•™ 20M äº†å†…å­˜å’Œ 0.25 CPUæ—¶é—´</p><h5 id="7-restart-policy"><a href="#7-restart-policy" class="headerlink" title="7.restart_policy"></a>7.restart_policy</h5><p>é…ç½®å®¹å™¨çš„é‡æ–°å¯åŠ¨ï¼Œä»£æ›¿ restart</p><ul><li><p><strong>condition:</strong> å€¼å¯ä»¥ä¸º <strong>none</strong> ã€<strong>on-failure</strong> ä»¥åŠ <strong>any</strong> (é»˜è®¤)</p></li><li><p><strong>delay:</strong>  å°è¯•é‡å¯çš„ç­‰å¾…æ—¶é—´ï¼Œé»˜è®¤ä¸º 0</p></li><li><p><strong>max_attempts:</strong> æ”¾å¼ƒä¹‹å‰å°è¯•é‡æ–°å¯åŠ¨å®¹å™¨æ¬¡æ•°ï¼ˆé»˜è®¤ï¼šä»ä¸æ”¾å¼ƒï¼‰ã€‚å¦‚æœé‡æ–°å¯åŠ¨åœ¨é…ç½®ä¸­æ²¡æœ‰æˆåŠŸ windowï¼Œåˆ™æ­¤å°è¯•ä¸è®¡å…¥é…ç½®max_attempts å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ max_attempts å€¼ä¸º 2ï¼Œå¹¶ä¸”ç¬¬ä¸€æ¬¡å°è¯•é‡æ–°å¯åŠ¨å¤±è´¥ï¼Œåˆ™å¯èƒ½ä¼šå°è¯•é‡æ–°å¯åŠ¨ä¸¤æ¬¡ä»¥ä¸Šã€‚</p></li><li><p><strong>windows:</strong> åœ¨å†³å®šé‡æ–°å¯åŠ¨æ˜¯å¦æˆåŠŸä¹‹å‰çš„ç­‰æ—¶é—´ï¼ŒæŒ‡å®šä¸ºæŒç»­æ—¶é—´ï¼ˆé»˜è®¤å€¼ï¼šç«‹å³å†³å®šï¼‰ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:alpine</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">restart_policy:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">on-failure</span><br>        <span class="hljs-attr">delay:</span> <span class="hljs-string">5s</span><br>        <span class="hljs-attr">max_attempts:</span> <span class="hljs-number">3</span><br>        <span class="hljs-attr">window:</span> <span class="hljs-string">120s</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="8-update-config"><a href="#8-update-config" class="headerlink" title="8.update_config"></a>8.update_config</h5><p>é…ç½®æ›´æ–°æœåŠ¡ï¼Œç”¨äºæ— ç¼æ›´æ–°åº”ç”¨ï¼ˆrolling update)</p><ul><li><p><strong>parallelismï¼š</strong>ä¸€æ¬¡æ€§æ›´æ–°çš„å®¹å™¨æ•°é‡</p></li><li><p><strong>delay</strong>ï¼šæ›´æ–°ä¸€ç»„å®¹å™¨ä¹‹é—´çš„ç­‰å¾…æ—¶é—´ã€‚</p></li><li><p><strong>failure_actionï¼š</strong>å¦‚æœæ›´æ–°å¤±è´¥ï¼Œå¯ä»¥æ‰§è¡Œçš„çš„æ˜¯ continueã€rollback æˆ– pause ï¼ˆé»˜è®¤ï¼‰</p></li><li><p><strong>monitorï¼š</strong>æ¯æ¬¡ä»»åŠ¡æ›´æ–°åç›‘è§†å¤±è´¥çš„æ—¶é—´ (ns|us|ms|s|m|h)ï¼ˆé»˜è®¤ä¸º0ï¼‰</p></li><li><p><strong>max_failure_ratioï¼š</strong>åœ¨æ›´æ–°æœŸé—´èƒ½æ¥å—çš„å¤±è´¥ç‡</p></li><li><p><strong>orderï¼š</strong>æ›´æ–°æ¬¡åºè®¾ç½®ï¼Œtop-firstï¼ˆæ—§çš„ä»»åŠ¡åœ¨å¼€å§‹æ–°ä»»åŠ¡ä¹‹å‰åœæ­¢ï¼‰ã€start-firstï¼ˆæ–°çš„ä»»åŠ¡é¦–å…ˆå¯åŠ¨ï¼Œå¹¶ä¸”æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡çŸ­æš‚é‡å ï¼‰ï¼ˆé»˜è®¤ stop-firstï¼‰</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.4&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">vote:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dockersamples/examplevotingapp_vote:before</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>      <span class="hljs-attr">update_config:</span><br>        <span class="hljs-attr">parallelism:</span> <span class="hljs-number">2</span><br>        <span class="hljs-attr">delay:</span> <span class="hljs-string">10s</span><br>        <span class="hljs-attr">order:</span> <span class="hljs-string">stop-first</span><br></code></pre></td></tr></table></figure><p><strong>ä¸æ”¯æŒ Docker stack desploy çš„å‡ ä¸ªå­é€‰é¡¹</strong><br>buildã€cgroup_parentã€container_nameã€devicesã€tmpfsã€external_linksã€inksã€network_modeã€restartã€security_optã€stop_signalã€sysctlsã€userns_mode</p></li></ul><h4 id="16-devices"><a href="#16-devices" class="headerlink" title="16.devices"></a>16.devices</h4><p>è®¾ç½®æ˜ å°„åˆ—è¡¨ï¼Œä¸ Docker å®¢æˆ·ç«¯çš„ â€“device å‚æ•°ç±»ä¼¼ :</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">devices:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;/dev/ttyUSB0:/dev/ttyUSB0&quot;</span><br></code></pre></td></tr></table></figure><h4 id="17-depends-on"><a href="#17-depends-on" class="headerlink" title="17.depends_on"></a>17.depends_on</h4><p>æ­¤é€‰é¡¹è§£å†³äº†å¯åŠ¨é¡ºåºçš„é—®é¢˜</p><p>åœ¨ä½¿ç”¨ Compose æ—¶ï¼Œæœ€å¤§çš„å¥½å¤„å°±æ˜¯å°‘æ‰“å¯åŠ¨å‘½ä»¤ï¼Œä½†æ˜¯ä¸€èˆ¬é¡¹ç›®å®¹å™¨å¯åŠ¨çš„é¡ºåºæ˜¯æœ‰è¦æ±‚çš„ï¼Œå¦‚æœç›´æ¥ä»ä¸Šåˆ°ä¸‹å¯åŠ¨å®¹å™¨ï¼Œå¿…ç„¶ä¼šå› ä¸ºå®¹å™¨ä¾èµ–é—®é¢˜è€Œå¯åŠ¨å¤±è´¥ã€‚ä¾‹å¦‚åœ¨æ²¡å¯åŠ¨æ•°æ®åº“å®¹å™¨çš„æ—¶å€™å¯åŠ¨äº†åº”ç”¨å®¹å™¨ï¼Œè¿™æ—¶å€™åº”ç”¨å®¹å™¨ä¼šå› ä¸ºæ‰¾ä¸åˆ°æ•°æ®åº“è€Œé€€å‡ºï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦åŠ å…¥ä¸€ä¸ªæ ‡ç­¾ï¼Œå°±æ˜¯ depends_onï¼Œè¿™ä¸ªæ ‡ç­¾è§£å†³äº†å®¹å™¨çš„ä¾èµ–ã€å¯åŠ¨å…ˆåçš„é—®é¢˜ã€‚</p><p>æŒ‡å®šæœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæœ‰ä¸¤ç§æ•ˆæœ</p><ul><li><p>docker-compose up ä»¥ä¾èµ–é¡ºåºå¯åŠ¨æœåŠ¡ï¼Œä¸‹é¢ä¾‹å­ä¸­ redis å’Œ db æœåŠ¡åœ¨ web å¯åŠ¨å‰å¯åŠ¨</p></li><li><p>docker-compose up SERVICE è‡ªåŠ¨åŒ…å« SERVICE çš„ä¾èµ–æ€§ï¼Œä¸‹é¢ä¾‹å­ä¸­ï¼Œä¾‹å¦‚ä¸‹é¢å®¹å™¨ä¼šå…ˆå¯åŠ¨ redis å’Œ db<br>ä¸¤ä¸ªæœåŠ¡ï¼Œæœ€åæ‰å¯åŠ¨ web æœåŠ¡ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis</span><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ docker-compose up web è¿™æ ·çš„æ–¹å¼å¯åŠ¨ web æœåŠ¡æ—¶ï¼Œä¹Ÿä¼šå¯åŠ¨ redis å’Œ db ä¸¤ä¸ªæœåŠ¡ï¼Œå› ä¸ºåœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†ä¾èµ–å…³ç³»</p></li></ul><h4 id="18-dns"><a href="#18-dns" class="headerlink" title="18.dns"></a>18.dns</h4><p>è‡ªå®šä¹‰ DNS æœåŠ¡å™¨ï¼Œä¸ â€“dns å…·æœ‰ä¸€æ ·çš„ç”¨é€”ï¼Œå¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dns:</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span><br><span class="hljs-attr">dns:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-number">9.9</span><span class="hljs-number">.9</span><span class="hljs-number">.9</span><br></code></pre></td></tr></table></figure><h4 id="19-dns-search"><a href="#19-dns-search" class="headerlink" title="19.dns_search"></a>19.dns_search</h4><p>è‡ªå®šä¹‰ DNS æœç´¢åŸŸï¼Œå¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dns_search:</span> <span class="hljs-string">example.com</span><br><span class="hljs-attr">dns_search:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">dc1.example.com</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">dc2.example.com</span><br></code></pre></td></tr></table></figure><h4 id="20-tmpfs"><a href="#20-tmpfs" class="headerlink" title="20.tmpfs"></a>20.tmpfs</h4><p>æŒ‚è½½ä¸´æ—¶æ–‡ä»¶ç›®å½•åˆ°å®¹å™¨å†…éƒ¨ï¼Œä¸ run çš„å‚æ•°ä¸€æ ·æ•ˆæœï¼Œå¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tmpfs:</span> <span class="hljs-string">/run</span><br><span class="hljs-attr">tmpfs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">/run</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">/tmp</span><br></code></pre></td></tr></table></figure><h4 id="21-entrypoint"><a href="#21-entrypoint" class="headerlink" title="21.entrypoint"></a>21.entrypoint</h4><p>åœ¨ Dockerfile ä¸­æœ‰ä¸€ä¸ªæŒ‡ä»¤å«åš ENTRYPOINT æŒ‡ä»¤ï¼Œç”¨äºæŒ‡å®šæ¥å…¥ç‚¹ã€‚åœ¨ docker-compose.yml ä¸­å¯ä»¥å®šä¹‰æ¥å…¥ç‚¹ï¼Œè¦†ç›– Dockerfile ä¸­çš„å®šä¹‰ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">entrypoint:</span> <span class="hljs-string">/code/entrypoint.sh</span><br></code></pre></td></tr></table></figure><p><strong>entrypoint</strong> ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ–¹æ³•ç±»ä¼¼äº dockerfile</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">entrypoint:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">php</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">-d</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-20100525/xdebug.so</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">-d</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">memory_limit=-1</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">vendor/bin/phpunit</span><br></code></pre></td></tr></table></figure><h4 id="21-env-file"><a href="#21-env-file" class="headerlink" title="21.env_file"></a>21.env_file</h4><p>ä»æ–‡ä»¶ä¸­æ·»åŠ ç¯å¢ƒå˜é‡ã€‚å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–æ˜¯åˆ—è¡¨<br>å¦‚æœå·²ç»ç”¨ docker-compose -f FILE æŒ‡å®šäº† Compose æ–‡ä»¶ï¼Œé‚£ä¹ˆ env_file è·¯å¾„å€¼ä¸ºç›¸å¯¹äºè¯¥æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</p><p>ä½† environment ç¯å¢ƒä¸­çš„è®¾ç½®çš„å˜é‡ä¼šä¼šè¦†ç›–è¿™äº›å€¼ï¼Œæ— è®ºè¿™äº›å€¼æœªå®šä¹‰è¿˜æ˜¯ä¸º None</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">env_file:</span> <span class="hljs-string">.env</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…æ ¹æ® docker-compose.yml è®¾ç½®å¤šä¸ªï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">env_file:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">./common.env</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">./apps/web.env</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">/opt/secrets.env</span><br></code></pre></td></tr></table></figure><p>ç¯å¢ƒé…ç½®æ–‡ä»¶ env_file ä¸­çš„å£°æ˜æ¯è¡Œéƒ½æ˜¯ä»¥ VAR&#x3D;VAL æ ¼å¼ï¼Œå…¶ä¸­ä»¥ # å¼€å¤´çš„è¢«è§£æä¸ºæ³¨é‡Šè€Œè¢«å¿½ç•¥</p><blockquote><p>æ³¨æ„ç¯å¢ƒå˜é‡é…ç½®åˆ—è¡¨çš„é¡ºåº*,ä¾‹å¦‚ä¸‹é¢ä¾‹å­</p></blockquote><p>docker_compose.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">some-service:</span><br>    <span class="hljs-attr">env_file:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">a.env</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">b.env</span><br></code></pre></td></tr></table></figure><p>a.env æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># a.env</span><br><span class="hljs-string">VAR=1</span><br></code></pre></td></tr></table></figure><p>b.envæ–‡ä»¶</p><p>å¯¹äºåœ¨æ–‡ä»¶a.env ä¸­æŒ‡å®šçš„ç›¸åŒå˜é‡ä½†åœ¨æ–‡ä»¶ b.env ä¸­åˆ†é…äº†ä¸åŒçš„å€¼ï¼Œå¦‚æœ b.env åƒä¸‹é¢åˆ—åœ¨ a.env ä¹‹åï¼Œåˆ™åˆšåœ¨ a.env è®¾ç½®çš„å€¼è¢« b.env ç›¸åŒå˜é‡çš„å€¼è¦†ç›–ï¼Œæ­¤æ—¶ $VAR å€¼ä¸º helloã€‚æ­¤å¤–ï¼Œè¿™é‡Œæ‰€è¯´çš„ç¯å¢ƒå˜é‡æ˜¯å¯¹å®¿ä¸»æœºçš„ Compose è€Œè¨€çš„ï¼Œå¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­æœ‰ build æ“ä½œï¼Œè¿™äº›å˜é‡å¹¶ä¸ä¼šè¿›å…¥æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¦åœ¨æ„å»ºä¸­ä½¿ç”¨å˜é‡è¿˜æ˜¯é¦–é€‰ arg æ ‡ç­¾</p><h4 id="22-environment"><a href="#22-environment" class="headerlink" title="22.environment"></a>22.environment</h4><p>æ·»åŠ ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ã€‚ä¸ä¸Šé¢çš„ env_file é€‰é¡¹å®Œå…¨ä¸åŒï¼Œåè€Œå’Œ arg æœ‰å‡ åˆ†ç±»ä¼¼ï¼Œè¿™ä¸ªæ ‡ç­¾çš„ä½œç”¨æ˜¯è®¾ç½®é•œåƒå˜é‡ï¼Œå®ƒå¯ä»¥ä¿å­˜å˜é‡åˆ°é•œåƒé‡Œé¢ï¼Œä¹Ÿå°±æ˜¯è¯´å¯åŠ¨çš„å®¹å™¨ä¹Ÿä¼šåŒ…å«è¿™äº›å˜é‡è®¾ç½®ï¼Œè¿™æ˜¯ä¸ arg æœ€å¤§çš„ä¸åŒã€‚<br>ä¸€èˆ¬ arg æ ‡ç­¾çš„å˜é‡ä»…ç”¨åœ¨æ„å»ºè¿‡ç¨‹ä¸­ã€‚è€Œ environment å’Œ Dockerfile ä¸­çš„ ENV æŒ‡ä»¤ä¸€æ ·ä¼šæŠŠå˜é‡ä¸€ç›´ä¿å­˜åœ¨é•œåƒã€å®¹å™¨ä¸­ï¼Œç±»ä¼¼ docker run -e çš„æ•ˆæœ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">environment:</span><br>  <span class="hljs-attr">RACK_ENV:</span> <span class="hljs-string">development</span><br>  <span class="hljs-attr">SHOW:</span> <span class="hljs-string">&#x27;true&#x27;</span><br>  <span class="hljs-attr">SESSION_SECRET:</span><br><br><span class="hljs-comment"># æˆ–</span><br><br><span class="hljs-attr">environment:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">RACK_ENV=development</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">SHOW=true</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">SESSION_SECRET</span><br></code></pre></td></tr></table></figure><h4 id="23-expose"><a href="#23-expose" class="headerlink" title="23.expose"></a>23.expose</h4><p>æš´éœ²ç«¯å£ï¼Œä½†ä¸æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œåªè¢«è¿æ¥çš„æœåŠ¡è®¿é—®ã€‚è¿™ä¸ªæ ‡ç­¾ä¸ Dockerfile ä¸­çš„ EXPOSE æŒ‡ä»¤ä¸€æ ·ï¼Œç”¨äºæŒ‡å®šæš´éœ²çš„ç«¯å£ï¼Œä½†æ˜¯åªæ˜¯ä½œä¸ºä¸€ç§å‚è€ƒï¼Œå®é™…ä¸Š docker-compose.yml çš„ç«¯å£æ˜ å°„è¿˜å¾— ports è¿™æ ·çš„æ ‡ç­¾</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">expose:</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3000&quot;</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8000&quot;</span><br></code></pre></td></tr></table></figure><h4 id="24-external-links"><a href="#24-external-links" class="headerlink" title="24.external_links"></a>24.external_links</h4><p>é“¾æ¥åˆ° docker-compose.yml å¤–éƒ¨çš„å®¹å™¨ï¼Œç”šè‡³ å¹¶é Compose é¡¹ç›®æ–‡ä»¶ç®¡ç†çš„å®¹å™¨ã€‚å‚æ•°æ ¼å¼è·Ÿ links ç±»ä¼¼</p><blockquote><p>åœ¨ä½¿ç”¨Dockerè¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰è®¸å¤šå•ç‹¬ä½¿ç”¨ docker run å¯åŠ¨çš„å®¹å™¨çš„æƒ…å†µï¼Œä¸ºäº†ä½¿ Compose èƒ½å¤Ÿè¿æ¥è¿™äº›ä¸åœ¨docker-compose.yml é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„å®¹å™¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„æ ‡ç­¾ï¼Œå°±æ˜¯ external_linksï¼Œå®ƒå¯ä»¥è®©Compose é¡¹ç›®é‡Œé¢çš„å®¹å™¨è¿æ¥åˆ°é‚£äº›é¡¹ç›®é…ç½®å¤–éƒ¨çš„å®¹å™¨ï¼ˆå‰ææ˜¯å¤–éƒ¨å®¹å™¨ä¸­å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ˜¯è¿æ¥åˆ°ä¸é¡¹ç›®å†…çš„æœåŠ¡çš„åŒä¸€ä¸ªç½‘ç»œé‡Œé¢ï¼‰ã€‚</p></blockquote><p>æ ¼å¼å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">external_links:</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">redis_1</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">project_db_1:mysql</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">project_db_1:postgresql</span><br></code></pre></td></tr></table></figure><h4 id="25-extra-hosts"><a href="#25-extra-hosts" class="headerlink" title="25.extra_hosts"></a>25.extra_hosts</h4><p>æ·»åŠ ä¸»æœºåçš„æ ‡ç­¾ï¼Œå°±æ˜¯å¾€ &#x2F;etc&#x2F;hosts æ–‡ä»¶ä¸­æ·»åŠ ä¸€äº›è®°å½•ï¼Œä¸ Docker å®¢æˆ·ç«¯ ä¸­çš„ â€“add-host ç±»ä¼¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">extra_hosts:</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;somehost:162.242.195.82&quot;</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;otherhost:50.31.209.229&quot;</span><br></code></pre></td></tr></table></figure><p>å…·æœ‰ IP åœ°å€å’Œä¸»æœºåçš„æ¡ç›®åœ¨ &#x2F;etc&#x2F;hosts å†…éƒ¨å®¹å™¨ä¸­åˆ›å»ºã€‚å¯åŠ¨ä¹‹åæŸ¥çœ‹å®¹å™¨å†…éƒ¨ hosts ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-number">162.242</span><span class="hljs-number">.195</span><span class="hljs-number">.82</span>  somehost<br><span class="hljs-number">50.31</span><span class="hljs-number">.209</span><span class="hljs-number">.229</span>   otherhost<br></code></pre></td></tr></table></figure><h4 id="26-healthcheck"><a href="#26-healthcheck" class="headerlink" title="26.healthcheck"></a>26.healthcheck</h4><p>ç”¨äºæ£€æŸ¥æµ‹è¯•æœåŠ¡ä½¿ç”¨çš„å®¹å™¨æ˜¯å¦æ­£å¸¸</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">healthcheck:</span><br><span class="hljs-symbol">  test:</span> [<span class="hljs-string">&quot;CMD&quot;</span>, <span class="hljs-string">&quot;curl&quot;</span>, <span class="hljs-string">&quot;-f&quot;</span>, <span class="hljs-string">&quot;http://localhost&quot;</span>]<br><span class="hljs-symbol">  interval:</span> <span class="hljs-number">1</span>m30s<br><span class="hljs-symbol">  timeout:</span> <span class="hljs-number">10</span>s<br><span class="hljs-symbol">  retries:</span> <span class="hljs-number">3</span><br><span class="hljs-symbol">  start_period:</span> <span class="hljs-number">40</span>s<br></code></pre></td></tr></table></figure><p><strong>intervalï¼Œtimeout</strong>  ä»¥åŠ <strong>start_period</strong> éƒ½å®šä¸ºæŒç»­æ—¶é—´</p><p>test å¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–åˆ—è¡¨ï¼Œå¦‚æœå®ƒæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œç¬¬ä¸€é¡¹å¿…é¡»æ˜¯ NONEï¼ŒCMD æˆ– CMD-SHELL ï¼›å¦‚æœå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™ç›¸å½“äºæŒ‡å®šCMD-SHELL åè·Ÿè¯¥å­—ç¬¦ä¸²ã€‚</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs subunit"># Hit the local web app<br><span class="hljs-keyword">test: </span>[&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;]<br><br># As above, but wrapped in /bin/sh. Both forms below are equivalent.<br><span class="hljs-keyword">test: </span>[&quot;CMD-SHELL&quot;, &quot;curl -f http://localhost || exit 1&quot;]<br><span class="hljs-keyword">test: </span>curl -f https://localhost || exit 1<br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦ç¦ç”¨é•œåƒçš„æ‰€æœ‰æ£€æŸ¥é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨ disable:true,ç›¸å½“äº test:[â€œNONEâ€]</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">healthcheck:</span><br>  <span class="hljs-attr">disable:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h4 id="27-image"><a href="#27-image" class="headerlink" title="27.image"></a>27.image</h4><p>ä»æŒ‡å®šçš„é•œåƒä¸­å¯åŠ¨å®¹å™¨ï¼Œå¯ä»¥æ˜¯å­˜å‚¨ä»“åº“ã€æ ‡ç­¾ä»¥åŠé•œåƒ ID</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">image:</span> <span class="hljs-string">redis</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">ubuntu:14.04</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">tutum/influxdb</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">example-registry.com:4000/postgresql</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">a4bc65fd</span><br></code></pre></td></tr></table></figure><p>å¦‚æœé•œåƒä¸å­˜åœ¨ï¼ŒCompose ä¼šè‡ªåŠ¨æ‹‰å»é•œåƒ</p><h4 id="28-isolation"><a href="#28-isolation" class="headerlink" title="28.isolation"></a>28.isolation</h4><p>Linux ä¸Šä»…ä»…æ”¯æŒ default å€¼</p><h4 id="29-labels"><a href="#29-labels" class="headerlink" title="29.labels"></a>29.labels</h4><p>ä½¿ç”¨ Docker æ ‡ç­¾å°†å…ƒæ•°æ®æ·»åŠ åˆ°å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ã€‚ä¸ Dockerfile ä¸­çš„ LABELS ç±»ä¼¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">labels:</span><br>  <span class="hljs-attr">com.example.description:</span> <span class="hljs-string">&quot;Accounting webapp&quot;</span><br>  <span class="hljs-attr">com.example.department:</span> <span class="hljs-string">&quot;Finance&quot;</span><br>  <span class="hljs-attr">com.example.label-with-empty-value:</span> <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-attr">labels:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;com.example.description=Accounting webapp&quot;</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;com.example.department=Finance&quot;</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;com.example.label-with-empty-value&quot;</span><br></code></pre></td></tr></table></figure><h4 id="30-links"><a href="#30-links" class="headerlink" title="30.links"></a>30.links</h4><p>é“¾æ¥åˆ°å…¶å®ƒæœåŠ¡çš„ä¸­çš„å®¹å™¨ï¼Œå¯ä»¥æŒ‡å®šæœåŠ¡åç§°ä¹Ÿå¯ä»¥æŒ‡å®šé“¾æ¥åˆ«åï¼ˆSERVICEï¼šALIAS)ï¼Œä¸ Docker å®¢æˆ·ç«¯çš„ â€“link æœ‰ä¸€æ ·æ•ˆæœï¼Œä¼šè¿æ¥åˆ°å…¶å®ƒæœåŠ¡ä¸­çš„å®¹å™¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">web:</span><br>  <span class="hljs-attr">links:</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">db</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">db:database</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨çš„åˆ«åå°†ä¼šè‡ªåŠ¨åœ¨æœåŠ¡å®¹å™¨ä¸­çš„ &#x2F;etc&#x2F;hosts é‡Œåˆ›å»ºã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-number">172.12</span><span class="hljs-number">.2</span><span class="hljs-number">.186</span>  db<br><span class="hljs-number">172.12</span><span class="hljs-number">.2</span><span class="hljs-number">.186</span>  database<br><span class="hljs-number">172.12</span><span class="hljs-number">.2</span><span class="hljs-number">.187</span>  redis<br></code></pre></td></tr></table></figure><p>ç›¸åº”çš„ç¯å¢ƒå˜é‡ä¹Ÿå°†è¢«åˆ›å»º</p><h4 id="31-logging"><a href="#31-logging" class="headerlink" title="31.logging"></a>31.logging</h4><p>é…ç½®æ—¥å¿—æœåŠ¡</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">logging:</span><br>  <span class="hljs-attr">driver:</span> <span class="hljs-string">syslog</span><br>  <span class="hljs-attr">options:</span><br>    <span class="hljs-attr">syslog-address:</span> <span class="hljs-string">&quot;tcp://192.168.0.42:123&quot;</span><br></code></pre></td></tr></table></figure><p>è¯¥ driverå€¼æ˜¯æŒ‡å®šæœåŠ¡å™¨çš„æ—¥å¿—è®°å½•é©±åŠ¨ç¨‹åºï¼Œé»˜è®¤å€¼ä¸º json-file,ä¸ â€“log-diver é€‰é¡¹ä¸€æ ·</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">driver:</span> <span class="hljs-string">&quot;json-file&quot;</span><br><span class="hljs-attr">driver:</span> <span class="hljs-string">&quot;syslog&quot;</span><br><span class="hljs-attr">driver:</span> <span class="hljs-string">&quot;none&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šåªæœ‰é©±åŠ¨ç¨‹åº json-file å’Œ journald é©±åŠ¨ç¨‹åºå¯ä»¥ç›´æ¥ä» docker-compose up å’Œ docker-compose logs è·å–æ—¥å¿—ã€‚ä½¿ç”¨ä»»ä½•å…¶ä»–æ–¹å¼ä¸ä¼šæ˜¾ç¤ºä»»ä½•æ—¥å¿—ã€‚</p></blockquote><p>å¯¹äºå¯é€‰å€¼ï¼Œå¯ä»¥ä½¿ç”¨ options æŒ‡å®šæ—¥å¿—è®°å½•ä¸­çš„æ—¥å¿—è®°å½•é€‰é¡¹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">driver:</span> <span class="hljs-string">&quot;syslog&quot;</span><br><span class="hljs-attr">options:</span><br>  <span class="hljs-attr">syslog-address:</span> <span class="hljs-string">&quot;tcp://192.168.0.42:123&quot;</span><br></code></pre></td></tr></table></figure><p>é»˜è®¤é©±åŠ¨ç¨‹åº json-file å…·æœ‰é™åˆ¶å­˜å‚¨æ—¥å¿—é‡çš„é€‰é¡¹ï¼Œæ‰€ä»¥ï¼Œä½¿ç”¨é”®å€¼å¯¹æ¥è·å¾—æœ€å¤§å­˜å‚¨å¤§å°ä»¥åŠæœ€å°å­˜å‚¨æ•°é‡</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">options:</span><br>  <span class="hljs-attr">max-size:</span> <span class="hljs-string">&quot;200k&quot;</span><br>  <span class="hljs-attr">max-file:</span> <span class="hljs-string">&quot;10&quot;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢å®ä¾‹å°†å­˜å‚¨æ—¥å¿—æ–‡ä»¶ï¼Œç›´åˆ°å®ƒä»¬è¾¾åˆ°max-size:200kBï¼Œå­˜å‚¨çš„å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„æ•°é‡ç”±è¯¥ max-file å€¼æŒ‡å®šã€‚éšç€æ—¥å¿—å¢é•¿è¶…å‡ºæœ€å¤§é™åˆ¶ï¼Œæ—§æ—¥å¿—æ–‡ä»¶å°†è¢«åˆ é™¤ä»¥å­˜å‚¨æ–°æ—¥å¿—</p><p>docker-compose.yml é™åˆ¶æ—¥å¿—å­˜å‚¨çš„ç¤ºä¾‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">some-service:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">some-service</span><br>    <span class="hljs-attr">logging:</span><br>      <span class="hljs-attr">driver:</span> <span class="hljs-string">&quot;json-file&quot;</span><br>      <span class="hljs-attr">options:</span><br>        <span class="hljs-attr">max-size:</span> <span class="hljs-string">&quot;200k&quot;</span><br>        <span class="hljs-attr">max-file:</span> <span class="hljs-string">&quot;10&quot;</span><br></code></pre></td></tr></table></figure><h4 id="32-network-mode"><a href="#32-network-mode" class="headerlink" title="32.network_mode"></a>32.network_mode</h4><p>ç½‘ç»œæ¨¡å¼ï¼Œç”¨æ³•ç±»ä¼¼äº Docke å®¢æˆ·ç«¯çš„ â€“net é€‰é¡¹ï¼Œæ ¼å¼ä¸ºï¼šservice:[service name]</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">network_mode:</span> <span class="hljs-string">&quot;bridge&quot;</span><br><span class="hljs-attr">network_mode:</span> <span class="hljs-string">&quot;host&quot;</span><br><span class="hljs-attr">network_mode:</span> <span class="hljs-string">&quot;none&quot;</span><br><span class="hljs-attr">network_mode:</span> <span class="hljs-string">&quot;service:[service name]&quot;</span><br><span class="hljs-attr">network_mode:</span> <span class="hljs-string">&quot;container:[container name/id]&quot;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥æŒ‡å®šä½¿ç”¨æœåŠ¡æˆ–è€…å®¹å™¨çš„ç½‘ç»œ</p><h4 id="33-networks"><a href="#33-networks" class="headerlink" title="33.networks"></a>33.networks</h4><p>åŠ å…¥æŒ‡å®šç½‘ç»œ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">some-service:</span><br>    <span class="hljs-attr">networks:</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-string">some-network</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-string">other-network</span><br></code></pre></td></tr></table></figure><h4 id="34-aliases"><a href="#34-aliases" class="headerlink" title="34.aliases"></a>34.aliases</h4><p>åŒä¸€ç½‘ç»œä¸Šçš„å…¶ä»–å®¹å™¨å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨åç§°æˆ–åˆ«åæ¥è¿æ¥åˆ°å…¶ä»–æœåŠ¡çš„å®¹å™¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">some-service:</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-attr">some-network:</span><br>        <span class="hljs-attr">aliases:</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-string">alias1</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-string">alias3</span><br>      <span class="hljs-attr">other-network:</span><br>        <span class="hljs-attr">aliases:</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-string">alias2</span><br></code></pre></td></tr></table></figure><p>ä¸‹é¢å®ä¾‹ä¸­ï¼Œæä¾› web ã€workerä»¥åŠdb æœåŠ¡ï¼Œä¼´éšç€ä¸¤ä¸ªç½‘ç»œ new å’Œ legacy ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;2&#x27;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">./web</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">new</span><br><br>  <span class="hljs-attr">worker:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">./worker</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">legacy</span><br><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-attr">new:</span><br>        <span class="hljs-attr">aliases:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">database</span><br>      <span class="hljs-attr">legacy:</span><br>        <span class="hljs-attr">aliases:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">mysql</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">new:</span><br>  <span class="hljs-attr">legacy:</span><br></code></pre></td></tr></table></figure><p>ç›¸åŒçš„æœåŠ¡å¯ä»¥åœ¨ä¸åŒçš„ç½‘ç»œæœ‰ä¸åŒçš„åˆ«å</p><h4 id="35-ipv4-addressã€ipv6-address"><a href="#35-ipv4-addressã€ipv6-address" class="headerlink" title="35.ipv4_addressã€ipv6_address"></a>35.ipv4_addressã€ipv6_address</h4><p>ä¸ºæœåŠ¡çš„å®¹å™¨æŒ‡å®šä¸€ä¸ªé™æ€ IP åœ°å€</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;2.1&#x27;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">app:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">ifconfig</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-attr">app_net:</span><br>        <span class="hljs-attr">ipv4_address:</span> <span class="hljs-number">172.16</span><span class="hljs-number">.238</span><span class="hljs-number">.10</span><br>        <span class="hljs-attr">ipv6_address:</span> <span class="hljs-number">2001</span><span class="hljs-string">:3984:3989::10</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">app_net:</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span><br>    <span class="hljs-attr">enable_ipv6:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">ipam:</span><br>      <span class="hljs-attr">driver:</span> <span class="hljs-string">default</span><br>      <span class="hljs-attr">config:</span><br>      <span class="hljs-bullet">-</span><br>        <span class="hljs-attr">subnet:</span> <span class="hljs-number">172.16</span><span class="hljs-number">.238</span><span class="hljs-number">.0</span><span class="hljs-string">/24</span><br>      <span class="hljs-bullet">-</span><br>        <span class="hljs-attr">subnet:</span> <span class="hljs-number">2001</span><span class="hljs-string">:3984:3989::/64</span><br></code></pre></td></tr></table></figure><h4 id="36-PID"><a href="#36-PID" class="headerlink" title="36.PID"></a>36.PID</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">pid:</span> <span class="hljs-string">&quot;host&quot;</span><br></code></pre></td></tr></table></figure><p>å°† PID æ¨¡å¼è®¾ç½®ä¸ºä¸»æœº PID æ¨¡å¼ï¼Œå¯ä»¥æ‰“å¼€å®¹å™¨ä¸ä¸»æœºæ“ä½œç³»ç»Ÿä¹‹é—´çš„å…±äº« PID åœ°å€ç©ºé—´ã€‚ä½¿ç”¨æ­¤æ ‡å¿—å¯åŠ¨çš„å®¹å™¨å¯ä»¥è®¿é—®å’Œæ“ä½œå®¿ä¸»æœºçš„å…¶ä»–å®¹å™¨ï¼Œåä¹‹äº¦ç„¶ã€‚</p><h4 id="37-ports"><a href="#37-ports" class="headerlink" title="37. ports"></a>37. ports</h4><p>æ˜ å°„ç«¯å£</p><h5 id="1-SHORT-è¯­æ³•-1"><a href="#1-SHORT-è¯­æ³•-1" class="headerlink" title="1.SHORT è¯­æ³•"></a>1.SHORT è¯­æ³•</h5><p>å¯ä»¥ä½¿ç”¨ HOST:CONTAINER çš„æ–¹å¼æŒ‡å®šç«¯å£ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå®¹å™¨ç«¯å£ï¼ˆé€‰æ‹©ä¸´æ—¶ä¸»æœºç«¯å£ï¼‰ï¼Œå®¿ä¸»æœºä¼šéšæœºæ˜ å°„ç«¯å£</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">ports:</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3000&quot;</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3000-3005&quot;</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8000:8000&quot;</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9090-9091:8080-8081&quot;</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;49100:22&quot;</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;127.0.0.1:8001:8001&quot;</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;127.0.0.1:5000-5010:5000-5010&quot;</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;6060:6060/udp&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šå½“ä½¿ç”¨ HOST:CONTAINER æ ¼å¼æ¥æ˜ å°„ç«¯å£æ—¶ï¼Œå¦‚æœä½¿ç”¨çš„å®¹å™¨ç«¯å£å°äº 60 å¯èƒ½ä¼šå¾—åˆ°é”™è¯¯å¾—ç»“æœï¼Œå› ä¸ºYAML å°†ä¼šè§£æ xx:yy è¿™ç§æ•°å­—æ ¼å¼ä¸º 60 è¿›åˆ¶ï¼Œæ‰€ä»¥å»ºè®®é‡‡ç”¨å­—ç¬¦ä¸²æ ¼å¼ã€‚</p></blockquote><h5 id="2-LONG-è¯­æ³•-1"><a href="#2-LONG-è¯­æ³•-1" class="headerlink" title="2.LONG è¯­æ³•"></a>2.LONG è¯­æ³•</h5><p>LONG è¯­æ³•æ”¯æŒ SHORT è¯­æ³•ä¸æ”¯æŒçš„é™„åŠ å­—æ®µ</p><ul><li><p>targetï¼šå®¹å™¨å†…çš„ç«¯å£</p></li><li><p>publishedï¼šå…¬å¼€çš„ç«¯å£</p></li><li><p>protocolï¼š ç«¯å£åè®®ï¼ˆtcp æˆ– udpï¼‰</p></li><li><p>modeï¼šé€šè¿‡host ç”¨åœ¨æ¯ä¸ªèŠ‚ç‚¹è¿˜æ˜¯å“ªä¸ªå‘å¸ƒçš„ä¸»æœºç«¯å£æˆ–ä½¿ç”¨ ingress ç”¨äºé›†ç¾¤æ¨¡å¼ç«¯å£è¿›è¡Œå¹³è¡¡è´Ÿè½½ï¼Œ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">target:</span> <span class="hljs-number">80</span><br>    <span class="hljs-attr">published:</span> <span class="hljs-number">8080</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">tcp</span><br>    <span class="hljs-attr">mode:</span> <span class="hljs-string">host</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="38-secrets"><a href="#38-secrets" class="headerlink" title="38.secrets"></a>38.secrets</h4><p>é€šè¿‡ secretsä¸ºæ¯ä¸ªæœåŠ¡æˆäºˆç›¸åº”çš„è®¿é—®æƒé™</p><h5 id="1-SHORT-è¯­æ³•-2"><a href="#1-SHORT-è¯­æ³•-2" class="headerlink" title="1.SHORT è¯­æ³•"></a>1.SHORT è¯­æ³•</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.1&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:latest</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>    <span class="hljs-attr">secrets:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">my_secret</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">my_other_secret</span><br><span class="hljs-attr">secrets:</span><br>  <span class="hljs-attr">my_secret:</span><br>    <span class="hljs-attr">file:</span> <span class="hljs-string">./my_secret.txt</span><br>  <span class="hljs-attr">my_other_secret:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h5 id="2-LONG-è¯­æ³•-2"><a href="#2-LONG-è¯­æ³•-2" class="headerlink" title="2.LONG è¯­æ³•"></a>2.LONG è¯­æ³•</h5><p>LONG è¯­æ³•å¯ä»¥æ·»åŠ å…¶ä»–é€‰é¡¹</p><ul><li><p>sourceï¼šsecret åç§°</p></li><li><p>targetï¼šåœ¨æœåŠ¡ä»»åŠ¡å®¹å™¨ä¸­éœ€è¦è£…è½½åœ¨ &#x2F;run&#x2F;secrets&#x2F; ä¸­çš„æ–‡ä»¶åç§°ï¼Œå¦‚æœ source æœªå®šä¹‰ï¼Œé‚£ä¹ˆé»˜è®¤ä¸ºæ­¤å€¼</p></li><li><p>uid&amp;gidï¼šåœ¨æœåŠ¡çš„ä»»åŠ¡å®¹å™¨ä¸­æ‹¥æœ‰è¯¥æ–‡ä»¶çš„ UID æˆ– GID ã€‚å¦‚æœæœªæŒ‡å®šï¼Œä¸¤è€…éƒ½é»˜è®¤ä¸º 0ã€‚</p></li><li><p>modeï¼šä»¥å…«è¿›åˆ¶è¡¨ç¤ºæ³•å°†æ–‡ä»¶è£…è½½åˆ°æœåŠ¡çš„ä»»åŠ¡å®¹å™¨ä¸­ &#x2F;run&#x2F;secrets&#x2F; çš„æƒé™ã€‚ä¾‹å¦‚ï¼Œ0444 ä»£è¡¨å¯è¯»ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.1&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:latest</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>    <span class="hljs-attr">secrets:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">source:</span> <span class="hljs-string">my_secret</span><br>        <span class="hljs-attr">target:</span> <span class="hljs-string">redis_secret</span><br>        <span class="hljs-attr">uid:</span> <span class="hljs-string">&#x27;103&#x27;</span><br>        <span class="hljs-attr">gid:</span> <span class="hljs-string">&#x27;103&#x27;</span><br>        <span class="hljs-attr">mode:</span> <span class="hljs-number">0440</span><br><span class="hljs-attr">secrets:</span><br>  <span class="hljs-attr">my_secret:</span><br>    <span class="hljs-attr">file:</span> <span class="hljs-string">./my_secret.txt</span><br>  <span class="hljs-attr">my_other_secret:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="39-security-opt"><a href="#39-security-opt" class="headerlink" title="39.security_opt"></a>39.security_opt</h4><p>ä¸ºæ¯ä¸ªå®¹å™¨è¦†ç›–é»˜è®¤çš„æ ‡ç­¾ã€‚ç®€å•è¯´æ¥å°±æ˜¯ç®¡ç†å…¨éƒ¨æœåŠ¡çš„æ ‡ç­¾ï¼Œæ¯”å¦‚è®¾ç½®å…¨éƒ¨æœåŠ¡çš„ user æ ‡ç­¾å€¼ä¸º USER</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">security_opt:<br>  - label:user:<span class="hljs-keyword">USER</span><br>  <span class="hljs-title">- label</span>:role:ROLE<br></code></pre></td></tr></table></figure><h5 id="40-stop-grace-period"><a href="#40-stop-grace-period" class="headerlink" title="40.stop_grace_period"></a>40.stop_grace_period</h5><p>åœ¨å‘é€ SIGKILL ä¹‹å‰æŒ‡å®š stop_signal ï¼Œå¦‚æœè¯•å›¾åœæ­¢å®¹å™¨ï¼ˆå¦‚æœå®ƒæ²¡æœ‰å¤„ç† SIGTERMï¼ˆæˆ–æŒ‡å®šçš„ä»»ä½•åœæ­¢ä¿¡å·ï¼‰ï¼‰ï¼Œåˆ™éœ€è¦ç­‰å¾…çš„æ—¶é—´</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">stop_grace_period:</span> <span class="hljs-string">1s</span><br><span class="hljs-attr">stop_grace_period:</span> <span class="hljs-string">1m30s</span><br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œstop åœ¨å‘é€SIGKILLä¹‹å‰ç­‰å¾…10ç§’é’Ÿå®¹å™¨é€€å‡º</p><h4 id="41-stop-signal"><a href="#41-stop-signal" class="headerlink" title="41.stop_signal"></a>41.stop_signal</h4><p>è®¾ç½®å¦ä¸€ä¸ªä¿¡å·æ¥åœæ­¢å®¹å™¨ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨çš„ SIGTERM æ¥åœæ­¢å®¹å™¨ã€‚è®¾ç½®å¦ä¸€ä¸ªä¿¡å·å¯ä»¥ä½¿ç”¨ stop_signal æ ‡ç­¾ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">stop_signal:</span> <span class="hljs-string">SIGUSR1</span><br></code></pre></td></tr></table></figure><h4 id="42-sysctls"><a href="#42-sysctls" class="headerlink" title="42.sysctls"></a>42.sysctls</h4><p>åœ¨å®¹å™¨ä¸­è®¾ç½®çš„å†…æ ¸å‚æ•°ï¼Œå¯ä»¥ä¸ºæ•°ç»„æˆ–å­—å…¸</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">sysctls:</span><br>  <span class="hljs-attr">net.core.somaxconn:</span> <span class="hljs-number">1024</span><br>  <span class="hljs-attr">net.ipv4.tcp_syncookies:</span> <span class="hljs-number">0</span><br><br><span class="hljs-attr">sysctls:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">net.core.somaxconn=1024</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">net.ipv4.tcp_syncookies=0</span><br></code></pre></td></tr></table></figure><h4 id="43-ulimits"><a href="#43-ulimits" class="headerlink" title="43.ulimits"></a>43.ulimits</h4><p>è¦†ç›–å®¹å™¨çš„é»˜è®¤é™åˆ¶ï¼Œå¯ä»¥å•ä¸€åœ°å°†é™åˆ¶å€¼è®¾ä¸ºä¸€ä¸ªæ•´æ•°ï¼Œä¹Ÿå¯ä»¥å°†soft&#x2F;hard é™åˆ¶æŒ‡å®šä¸ºæ˜ å°„</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">ulimits:</span><br>  <span class="hljs-attr">nproc:</span> <span class="hljs-number">65535</span><br>  <span class="hljs-attr">nofile:</span><br>    <span class="hljs-attr">soft:</span> <span class="hljs-number">20000</span><br>    <span class="hljs-attr">hard:</span> <span class="hljs-number">40000</span><br></code></pre></td></tr></table></figure><h4 id="44-userns-mode"><a href="#44-userns-mode" class="headerlink" title="44.userns_mode"></a>44.userns_mode</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">userns_mode:</span> <span class="hljs-string">&quot;host&quot;</span><br></code></pre></td></tr></table></figure><h4 id="45-volumes"><a href="#45-volumes" class="headerlink" title="45.volumes"></a>45.volumes</h4><p>æŒ‚è½½ä¸€ä¸ªç›®å½•æˆ–è€…ä¸€ä¸ªå·²å­˜åœ¨çš„æ•°æ®å·å®¹å™¨ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ HOST:CONTAINER è¿™æ ·çš„æ ¼å¼ï¼Œæˆ–è€…ä½¿ç”¨ HOST:CONTAINER:ro è¿™æ ·çš„æ ¼å¼ï¼Œåè€…å¯¹äºå®¹å™¨æ¥è¯´ï¼Œæ•°æ®å·æ˜¯åªè¯»çš„ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆä¿æŠ¤å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.2&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:alpine</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">volume</span><br>        <span class="hljs-attr">source:</span> <span class="hljs-string">mydata</span><br>        <span class="hljs-attr">target:</span> <span class="hljs-string">/data</span><br>        <span class="hljs-attr">volume:</span><br>          <span class="hljs-attr">nocopy:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">bind</span><br>        <span class="hljs-attr">source:</span> <span class="hljs-string">./static</span><br>        <span class="hljs-attr">target:</span> <span class="hljs-string">/opt/app/static</span><br><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres:latest</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;dbdata:/var/lib/postgresql/data&quot;</span><br><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">mydata:</span><br>  <span class="hljs-attr">dbdata:</span><br></code></pre></td></tr></table></figure><p>Compose çš„æ•°æ®å·æŒ‡å®šè·¯å¾„å¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä½¿ç”¨ . æˆ–è€… .. æ¥æŒ‡å®šç›¸å¯¹ç›®å½•ã€‚</p><p>æ•°æ®å·çš„æ ¼å¼å¯ä»¥æ˜¯ä¸‹é¢å¤šç§å½¢å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">volumes:</span><br>  <span class="hljs-comment"># åªæ˜¯æŒ‡å®šä¸€ä¸ªè·¯å¾„ï¼ŒDocker ä¼šè‡ªåŠ¨åœ¨åˆ›å»ºä¸€ä¸ªæ•°æ®å·ï¼ˆè¿™ä¸ªè·¯å¾„æ˜¯å®¹å™¨å†…éƒ¨çš„ï¼‰ã€‚</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">/var/lib/mysql</span><br><br>  <span class="hljs-comment"># ä½¿ç”¨ç»å¯¹è·¯å¾„æŒ‚è½½æ•°æ®å·</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">/opt/data:/var/lib/mysql</span><br><br>  <span class="hljs-comment"># ä»¥ Compose é…ç½®æ–‡ä»¶ä¸ºä¸­å¿ƒçš„ç›¸å¯¹è·¯å¾„ä½œä¸ºæ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨ã€‚</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">./cache:/tmp/cache</span><br><br>  <span class="hljs-comment"># ä½¿ç”¨ç”¨æˆ·çš„ç›¸å¯¹è·¯å¾„ï¼ˆ~/ è¡¨ç¤ºçš„ç›®å½•æ˜¯ /home/&lt;ç”¨æˆ·ç›®å½•&gt;/ æˆ–è€… /root/ï¼‰ã€‚</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">~/configs:/etc/configs/:ro</span><br><br>  <span class="hljs-comment"># å·²ç»å­˜åœ¨çš„å‘½åçš„æ•°æ®å·ã€‚</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">datavolume:/var/lib/mysql</span><br><br></code></pre></td></tr></table></figure><p>å¦‚æœä½ ä¸ä½¿ç”¨å®¿ä¸»æœºçš„è·¯å¾„ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ª volume_driver</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">volume_driver:</span> <span class="hljs-string">mydriver</span><br></code></pre></td></tr></table></figure><h5 id="1-SHORT-è¯­æ³•-3"><a href="#1-SHORT-è¯­æ³•-3" class="headerlink" title="1.SHORT è¯­æ³•"></a>1.SHORT è¯­æ³•</h5><p>å¯ä»¥é€‰æ‹©åœ¨ä¸»æœºï¼ˆHOST:CONTAINERï¼‰æˆ–è®¿é—®æ¨¡å¼ï¼ˆHOST:CONTAINER:roï¼‰ä¸ŠæŒ‡å®šè·¯å¾„ã€‚</p><p>å¯ä»¥åœ¨ä¸»æœºä¸ŠæŒ‚è½½ç›¸å¯¹è·¯å¾„ï¼Œè¯¥è·¯å¾„ç›¸å¯¹äºæ­£åœ¨ä½¿ç”¨çš„ Compose é…ç½®æ–‡ä»¶çš„ç›®å½•è¿›è¡Œæ‰©å±•ã€‚ç›¸å¯¹è·¯å¾„åº”å§‹ç»ˆä»¥ . æˆ– .. å¼€å¤´</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">volumes:</span><br>  <span class="hljs-comment"># Just specify a path and let the Engine create a volume</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">/var/lib/mysql</span><br><br>  <span class="hljs-comment"># Specify an absolute path mapping</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">/opt/data:/var/lib/mysql</span><br><br>  <span class="hljs-comment"># Path on the host, relative to the Compose file</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">./cache:/tmp/cache</span><br><br>  <span class="hljs-comment"># User-relative path</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">~/configs:/etc/configs/:ro</span><br><br>  <span class="hljs-comment"># Named volume</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">datavolume:/var/lib/mysql</span><br></code></pre></td></tr></table></figure><h5 id="2-LONG-è¯­æ³•-3"><a href="#2-LONG-è¯­æ³•-3" class="headerlink" title="2.LONG è¯­æ³•"></a>2.LONG è¯­æ³•</h5><p>LONG è¯­æ³•æœ‰äº›é™„åŠ å­—æ®µ</p><ul><li><p>typeï¼šå®‰è£…ç±»å‹ï¼Œå¯ä»¥ä¸º volumeã€bind æˆ– tmpfs</p></li><li><p>sourceï¼šå®‰è£…æºï¼Œä¸»æœºä¸Šç”¨äºç»‘å®šå®‰è£…çš„è·¯å¾„æˆ–å®šä¹‰åœ¨é¡¶çº§ volumeså¯†é’¥ä¸­å·çš„åç§° ,ä¸é€‚ç”¨äº tmpfs ç±»å‹å®‰è£…ã€‚</p></li><li><p>targetï¼šå·å®‰è£…åœ¨å®¹å™¨ä¸­çš„è·¯å¾„</p></li><li><p>read_onlyï¼šæ ‡å¿—å°†å·è®¾ç½®ä¸ºåªè¯»</p></li><li><p>bindï¼šé…ç½®é¢å¤–çš„ç»‘å®šé€‰é¡¹</p></li><li><p>propagationï¼šç”¨äºç»‘å®šçš„ä¼ æ’­æ¨¡å¼</p></li><li><p>volumeï¼šé…ç½®é¢å¤–çš„éŸ³é‡é€‰é¡¹</p></li><li><p>nocopyï¼šåˆ›å»ºå·æ—¶ç¦æ­¢ä»å®¹å™¨å¤åˆ¶æ•°æ®çš„æ ‡å¿—</p></li><li><p>tmpfsï¼šé…ç½®é¢å¤–çš„ tmpfs é€‰é¡¹</p></li><li><p>sizeï¼štmpfs çš„å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.2&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:alpine</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;80:80&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">volume</span><br>        <span class="hljs-attr">source:</span> <span class="hljs-string">mydata</span><br>        <span class="hljs-attr">target:</span> <span class="hljs-string">/data</span><br>        <span class="hljs-attr">volume:</span><br>          <span class="hljs-attr">nocopy:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">bind</span><br>        <span class="hljs-attr">source:</span> <span class="hljs-string">./static</span><br>        <span class="hljs-attr">target:</span> <span class="hljs-string">/opt/app/static</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">webnet:</span><br><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">mydata:</span><br></code></pre></td></tr></table></figure><h5 id="3-volumes-from"><a href="#3-volumes-from" class="headerlink" title="3.volumes_from"></a>3.volumes_from</h5><p>ä»å…¶å®ƒå®¹å™¨æˆ–è€…æœåŠ¡æŒ‚è½½æ•°æ®å·ï¼Œå¯é€‰çš„å‚æ•°æ˜¯ :ro æˆ– :rwï¼Œå‰è€…è¡¨ç¤ºå®¹å™¨åªè¯»ï¼Œåè€…è¡¨ç¤ºå®¹å™¨å¯¹æ•°æ®å·æ˜¯å¯è¯»å¯å†™çš„ï¼ˆé»˜è®¤æƒ…å†µä¸ºå¯è¯»å¯å†™çš„ï¼‰ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">volumes_from:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">service_name</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">service_name:ro</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">container:container_name</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">container:container_name:rw</span><br></code></pre></td></tr></table></figure><h5 id="4-ç”¨äºæœåŠ¡ã€ç¾¤é›†ä»¥åŠå †æ ˆæ–‡ä»¶çš„å·"><a href="#4-ç”¨äºæœåŠ¡ã€ç¾¤é›†ä»¥åŠå †æ ˆæ–‡ä»¶çš„å·" class="headerlink" title="4.ç”¨äºæœåŠ¡ã€ç¾¤é›†ä»¥åŠå †æ ˆæ–‡ä»¶çš„å·"></a>4.ç”¨äºæœåŠ¡ã€ç¾¤é›†ä»¥åŠå †æ ˆæ–‡ä»¶çš„å·</h5><p>åœ¨ä½¿ç”¨æœåŠ¡ï¼Œç¾¤é›†å’Œ docker-stack.yml æ–‡ä»¶æ—¶ï¼Œè¯·è®°ä½æ”¯æŒæœåŠ¡çš„ä»»åŠ¡ï¼ˆå®¹å™¨ï¼‰å¯ä»¥éƒ¨ç½²åœ¨ç¾¤é›†ä¸­çš„ä»»ä½•èŠ‚ç‚¹ä¸Šï¼Œå¹¶ä¸”æ¯æ¬¡æ›´æ–°æœåŠ¡æ—¶éƒ½å¯èƒ½æ˜¯ä¸åŒçš„èŠ‚ç‚¹ã€‚</p><p>åœ¨ç¼ºå°‘æŒ‡å®šæºçš„å‘½åå·çš„æƒ…å†µä¸‹ï¼ŒDocker ä¸ºæ”¯æŒæœåŠ¡çš„æ¯ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªåŒ¿åå·ã€‚å…³è”çš„å®¹å™¨è¢«ç§»é™¤åï¼ŒåŒ¿åå·ä¸ä¼šä¿ç•™ã€‚</p><p>å¦‚æœå¸Œæœ›æ•°æ®æŒä¹…å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å¯è¯†åˆ«å¤šä¸»æœºçš„å‘½åå·å’Œå·é©±åŠ¨ç¨‹åºï¼Œä»¥ä¾¿å¯ä»¥ä»ä»»ä½•èŠ‚ç‚¹è®¿é—®æ•°æ®ã€‚æˆ–è€…ï¼Œå¯¹è¯¥æœåŠ¡è®¾ç½®çº¦æŸï¼Œä»¥ä¾¿å°†å…¶ä»»åŠ¡éƒ¨ç½²åœ¨å…·æœ‰è¯¥å·çš„èŠ‚ç‚¹ä¸Šã€‚</p><p>ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼ŒDocker Labs ä¸­ votingapp ç¤ºä¾‹çš„ docker-stack.ymlæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªç§°ä¸º db çš„æœåŠ¡ã€‚å®ƒè¢«é…ç½®ä¸ºä¸€ä¸ªå‘½åå·æ¥ä¿å­˜ç¾¤ä½“ä¸Šçš„æ•°æ®ï¼Œ å¹¶ä¸”ä»…é™äºåœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ä¸‹é¢æ˜¯æ¥è‡ªè¯¥æ–‡ä»¶çš„éƒ¨åˆ†å†…å®¹ï¼šdb postgres manager</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres:9.4</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db-data:/var/lib/postgresql/data</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">placement:</span><br>        <span class="hljs-attr">constraints:</span> [<span class="hljs-string">node.role</span> <span class="hljs-string">==</span> <span class="hljs-string">manager</span>]<br></code></pre></td></tr></table></figure><h4 id="46-restart"><a href="#46-restart" class="headerlink" title="46.restart"></a>46.restart</h4><p>é»˜è®¤å€¼ä¸º no ï¼Œå³åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šé‡æ–°å¯åŠ¨å®¹å™¨ï¼›å½“å€¼ä¸º always æ—¶ï¼Œå®¹å™¨æ€»æ˜¯é‡æ–°å¯åŠ¨ï¼›å½“å€¼ä¸º on-failure æ—¶ï¼Œå½“å‡ºç° on-failure æŠ¥é”™å®¹å™¨é€€å‡ºæ—¶ï¼Œå®¹å™¨é‡æ–°å¯åŠ¨ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">restart:</span> <span class="hljs-string">&quot;no&quot;</span><br><span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br><span class="hljs-attr">restart:</span> <span class="hljs-string">on-failure</span><br><span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br></code></pre></td></tr></table></figure><h4 id="47-å…¶ä»–é€‰é¡¹"><a href="#47-å…¶ä»–é€‰é¡¹" class="headerlink" title="47.å…¶ä»–é€‰é¡¹"></a>47.å…¶ä»–é€‰é¡¹</h4><p>å…³äºæ ‡ç­¾ï¼šcpu_sharesã€cpu_quotaã€ cpuseã€domainnameã€hostnameã€ ipcã€ mac_addressã€privilegedã€ read_onlyã€ shm_sizeã€stdin_openã€ttyã€ userã€ working_dir</p><p>ä¸Šé¢è¿™äº›éƒ½æ˜¯ä¸€ä¸ªå•å€¼çš„æ ‡ç­¾ï¼Œç±»ä¼¼äºä½¿ç”¨ docker run çš„æ•ˆæœ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">cpu_shares:</span> <span class="hljs-number">73</span><br><span class="hljs-attr">cpu_quota:</span> <span class="hljs-number">50000</span><br><span class="hljs-attr">cpuset:</span> <span class="hljs-number">0</span><span class="hljs-string">,1</span><br><br><span class="hljs-attr">user:</span> <span class="hljs-string">postgresql</span><br><span class="hljs-attr">working_dir:</span> <span class="hljs-string">/code</span><br><br><span class="hljs-attr">domainname:</span> <span class="hljs-string">foo.com</span><br><span class="hljs-attr">hostname:</span> <span class="hljs-string">foo</span><br><span class="hljs-attr">ipc:</span> <span class="hljs-string">host</span><br><span class="hljs-attr">mac_address:</span> <span class="hljs-number">02</span><span class="hljs-string">:42:ac:11:65:43</span><br><br><span class="hljs-attr">privileged:</span> <span class="hljs-literal">true</span><br><br><br><span class="hljs-attr">read_only:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">shm_size:</span> <span class="hljs-string">64M</span><br><span class="hljs-attr">stdin_open:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">tty:</span> <span class="hljs-literal">true</span><br><br></code></pre></td></tr></table></figure><h4 id="48-æŒç»­æ—¶é—´"><a href="#48-æŒç»­æ—¶é—´" class="headerlink" title="48.æŒç»­æ—¶é—´"></a>48.æŒç»­æ—¶é—´</h4><p>æŸäº›é…ç½®é€‰é¡¹å¦‚ check çš„å­é€‰é¡¹intervalä»¥åŠtimeout çš„è®¾ç½®æ ¼å¼</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-number">2.</span>5s<br>10s<br>1m30s<br>2h32m<br>5h34m56s<br></code></pre></td></tr></table></figure><p>æ”¯æŒçš„å•ä½æœ‰ usã€msã€sã€m ä»¥åŠ h</p><h3 id="49-æŒ‡å®šå­—èŠ‚å€¼"><a href="#49-æŒ‡å®šå­—èŠ‚å€¼" class="headerlink" title="49.æŒ‡å®šå­—èŠ‚å€¼"></a>49.æŒ‡å®šå­—èŠ‚å€¼</h3><p>æŸäº›é€‰é¡¹å¦‚ bulid çš„å­é€‰é¡¹ shm_size</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript">2b<br>1024kb<br>2048k<br>300m<br>1gb<br></code></pre></td></tr></table></figure><p>æ”¯æŒçš„å•ä½æ˜¯ bï¼Œkï¼Œm ä»¥åŠ gï¼Œæˆ– kbï¼Œ mb å’Œ gbã€‚ç›®å‰ä¸æ”¯æŒåè¿›åˆ¶å€¼</p><h3 id="50-extends"><a href="#50-extends" class="headerlink" title="50.extends"></a>50.extends</h3><p>è¿™ä¸ªæ ‡ç­¾å¯ä»¥æ‰©å±•å¦ä¸€ä¸ªæœåŠ¡ï¼Œæ‰©å±•å†…å®¹å¯ä»¥æ˜¯æ¥è‡ªåœ¨å½“å‰æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯æ¥è‡ªå…¶ä»–æ–‡ä»¶ï¼Œç›¸åŒæœåŠ¡çš„æƒ…å†µä¸‹ï¼Œåæ¥è€…ä¼šæœ‰é€‰æ‹©åœ°è¦†ç›–åŸæœ‰é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">extends:</span><br>  <span class="hljs-attr">file:</span> <span class="hljs-string">common.yml</span><br>  <span class="hljs-attr">service:</span> <span class="hljs-string">webapp</span><br></code></pre></td></tr></table></figure><p>ç”¨æˆ·å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨è¿™ä¸ªæ ‡ç­¾ï¼Œåªè¦æ ‡ç­¾å†…å®¹åŒ…å« file å’Œ service ä¸¤ä¸ªå€¼å°±å¯ä»¥äº†ã€‚file çš„å€¼å¯ä»¥æ˜¯ç›¸å¯¹æˆ–è€…ç»å¯¹è·¯å¾„ï¼Œå¦‚æœä¸æŒ‡å®š file çš„å€¼ï¼Œé‚£ä¹ˆ Compose ä¼šè¯»å–å½“å‰ YML æ–‡ä»¶çš„ä¿¡æ¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>docker-compose</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker-compose</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockeré•œåƒæ“ä½œï¼Œä»¥åŠdockerå‘½ä»¤çš„ä½¿ç”¨</title>
    <link href="/2023/03/24/docker/docker%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E8%A3%85/docker%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C%EF%BC%8C%E4%BB%A5%E5%8F%8Adocker%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/03/24/docker/docker%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E8%A3%85/docker%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C%EF%BC%8C%E4%BB%A5%E5%8F%8Adocker%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="dockeré•œåƒæ“ä½œï¼Œä»¥åŠdockerå‘½ä»¤ä½¿ç”¨"><a href="#dockeré•œåƒæ“ä½œï¼Œä»¥åŠdockerå‘½ä»¤ä½¿ç”¨" class="headerlink" title="dockeré•œåƒæ“ä½œï¼Œä»¥åŠdockerå‘½ä»¤ä½¿ç”¨"></a>dockeré•œåƒæ“ä½œï¼Œä»¥åŠdockerå‘½ä»¤ä½¿ç”¨</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">å‚è€ƒæ–‡çŒ®ï¼š<br>Dockeråˆå­¦è€…çš„å¸¸ç”¨å‘½ä»¤ï¼šhttps:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/weixin_43062251/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">103825065</span><br>Dockerè¯¦ç»†ï¼šhttps:<span class="hljs-regexp">//</span>jiajially.gitbooks.io<span class="hljs-regexp">/dockerguide/</span>content<span class="hljs-regexp">/chapter_fastlearn/</span>docker_run/index.html<br>http:<span class="hljs-regexp">//</span>docker.baoshu.red<span class="hljs-regexp">/network/m</span>ode.html<br></code></pre></td></tr></table></figure><h2 id="ä¸€ã€é•œåƒçš„ç›¸å…³æ“ä½œ"><a href="#ä¸€ã€é•œåƒçš„ç›¸å…³æ“ä½œ" class="headerlink" title="ä¸€ã€é•œåƒçš„ç›¸å…³æ“ä½œ"></a>ä¸€ã€é•œåƒçš„ç›¸å…³æ“ä½œ</h2><h3 id="1-æ‹‰å–é•œåƒåˆ°æœ¬åœ°"><a href="#1-æ‹‰å–é•œåƒåˆ°æœ¬åœ°" class="headerlink" title="1.æ‹‰å–é•œåƒåˆ°æœ¬åœ°"></a>1.æ‹‰å–é•œåƒåˆ°æœ¬åœ°</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull é•œåƒåç§°[:tag]<span class="hljs-comment">#é“¾æ¥å¯ä»¥åœ¨ç½‘ä¸Šæ‹‰å–</span><br><span class="hljs-comment"># ä¸¾ä¸ªä¾‹å­</span><br>docker pull tomcat daocloud.io/library/tomcat:8.5.15-jre8<br></code></pre></td></tr></table></figure><h3 id="2-æŸ¥çœ‹å…¨éƒ¨æœ¬åœ°çš„é•œåƒ"><a href="#2-æŸ¥çœ‹å…¨éƒ¨æœ¬åœ°çš„é•œåƒ" class="headerlink" title="2.æŸ¥çœ‹å…¨éƒ¨æœ¬åœ°çš„é•œåƒ"></a>2.æŸ¥çœ‹å…¨éƒ¨æœ¬åœ°çš„é•œåƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker images<br></code></pre></td></tr></table></figure><h3 id="3-åˆ é™¤æœ¬åœ°é•œåƒ"><a href="#3-åˆ é™¤æœ¬åœ°é•œåƒ" class="headerlink" title="3.åˆ é™¤æœ¬åœ°é•œåƒ"></a>3.åˆ é™¤æœ¬åœ°é•œåƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker rmi é•œåƒçš„æ ‡è¯† <br>docker rmi -f é•œåƒæ ‡è¯†<br><span class="hljs-comment">#å¦‚æœæ‰“äº†ä¸¤ä¸ªæ ‡ç­¾ï¼ŒåŒä¸€æ ‡è¯†ï¼Œåˆ é™¤ä¸äº†</span><br>docker rmi  é•œåƒåç§°ï¼šé•œåƒæ ‡è¯†<br></code></pre></td></tr></table></figure><h3 id="4-é•œåƒçš„å¯¼å…¥å¯¼å‡ºï¼ˆä¸è§„èŒƒï¼‰"><a href="#4-é•œåƒçš„å¯¼å…¥å¯¼å‡ºï¼ˆä¸è§„èŒƒï¼‰" class="headerlink" title="4.é•œåƒçš„å¯¼å…¥å¯¼å‡ºï¼ˆä¸è§„èŒƒï¼‰"></a>4.é•œåƒçš„å¯¼å…¥å¯¼å‡ºï¼ˆä¸è§„èŒƒï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># å°†æœ¬åœ°çš„é•œåƒå¯¼å‡º</span><br>docker save -o å¯¼å‡ºçš„è·¯å¾„ é•œåƒ<span class="hljs-built_in">id</span><br><br>docker save 120.27.153.22:5000/rel/file_rel:1.1.114 |gzip &gt; file-rel-114.tar.gz  <span class="hljs-comment">#æ‰“åŒ…å‹ç¼©</span><br><br><span class="hljs-comment"># åŠ è½½æœ¬åœ°çš„é•œåƒæ–‡ä»¶</span><br>docker load -i é•œåƒæ–‡ä»¶<br></code></pre></td></tr></table></figure><h3 id="5-ä¿®æ”¹é•œåƒåç§°"><a href="#5-ä¿®æ”¹é•œåƒåç§°" class="headerlink" title="5.ä¿®æ”¹é•œåƒåç§°"></a>5.ä¿®æ”¹é•œåƒåç§°</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker tag é•œåƒ<span class="hljs-built_in">id</span> æ–°é•œåƒåç§°:ç‰ˆæœ¬<br></code></pre></td></tr></table></figure><h2 id="äºŒã€dockerè¿è¡Œç›¸å…³å®¹å™¨çš„ç›¸å…³æ“ä½œ"><a href="#äºŒã€dockerè¿è¡Œç›¸å…³å®¹å™¨çš„ç›¸å…³æ“ä½œ" class="headerlink" title="äºŒã€dockerè¿è¡Œç›¸å…³å®¹å™¨çš„ç›¸å…³æ“ä½œ"></a>äºŒã€dockerè¿è¡Œç›¸å…³å®¹å™¨çš„ç›¸å…³æ“ä½œ</h2><h3 id="1-è¿è¡Œå®¹å™¨"><a href="#1-è¿è¡Œå®¹å™¨" class="headerlink" title="1.è¿è¡Œå®¹å™¨"></a>1.è¿è¡Œå®¹å™¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ç®€å•æ“ä½œ</span><br>docker run é•œåƒçš„æ ‡è¯†|é•œåƒåç§°[:tag]<br><br>å¤‡æ³¨ï¼š<br>å¸¸ç”¨çš„å‚æ•°docker run -d -p å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ --name å®¹å™¨åç§° é•œåƒçš„æ ‡è¯†|é•œåƒåç§°[:tag]<br>-dï¼šä»£è¡¨åå°è¿è¡Œå®¹å™¨<br>-p å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ï¼šä¸ºäº†æ˜ å°„å½“å‰Linuxç«¯å£å’Œå®¹å™¨ç«¯å£<br>--name å®¹å™¨åç§°ï¼šæŒ‡å®šå®¹å™¨çš„åç§°<br></code></pre></td></tr></table></figure><h3 id="2-æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨"><a href="#2-æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨" class="headerlink" title="2.æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨"></a>2.æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker ps [-q,a]<br><br>-a æŸ¥çœ‹å…¨éƒ¨çš„å®¹å™¨ï¼ŒåŒ…æ‹¬æ²¡æœ‰è¿è¡Œ<br>-q æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„æ ‡è¯†<br></code></pre></td></tr></table></figure><h3 id="3-æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—"><a href="#3-æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—" class="headerlink" title="3.æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—"></a>3.æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker logs -f å®¹å™¨ID<br><br>-fï¼šå¯ä»¥æ»šåŠ¨æŸ¥çœ‹æ—¥å¿—çš„æœ€åå‡ è¡Œ<br></code></pre></td></tr></table></figure><h3 id="4-æ‰§è¡Œå®¹å™¨å†…å‘½ä»¤"><a href="#4-æ‰§è¡Œå®¹å™¨å†…å‘½ä»¤" class="headerlink" title="4.æ‰§è¡Œå®¹å™¨å†…å‘½ä»¤"></a>4.æ‰§è¡Œå®¹å™¨å†…å‘½ä»¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¿›å…¥å®¹å™¨å†…æ‰§è¡Œï¼š</span><br>docker <span class="hljs-built_in">exec</span> -it å®¹å™¨ID bash  [ç­‰äº=] docker <span class="hljs-built_in">exec</span> -it å®¹å™¨ID /bin/bash<br><span class="hljs-comment">#æˆ–docker exec -it å®¹å™¨ID sh  [ç­‰äº=] docker exec -it /bin/sh </span><br><br><span class="hljs-comment">#Dockeråœ¨å®¹å™¨å¤–æ‰§è¡Œå®¹å™¨å†…å‘½ä»¤æˆ–è„šæœ¬:</span><br>docker <span class="hljs-built_in">exec</span> å®¹å™¨ID /bin/bash -c <span class="hljs-string">&quot;XXXå‘½ä»¤&quot;</span><br><span class="hljs-comment">#ä¾‹å¦‚ï¼š</span><br>docker <span class="hljs-built_in">exec</span> å®¹å™¨IDæˆ–å®¹å™¨å /bin/sh -c <span class="hljs-string">&quot;mkdir /www/default/runtime; \</span><br><span class="hljs-string">                                 chmod +x /www/default/ank; \</span><br><span class="hljs-string">                                 /www/default/ank clearcache; \</span><br><span class="hljs-string">                                 chmod 754 -R /www/default/runtime;&quot;</span><br><br><span class="hljs-comment">#æ‰§è¡Œå®¹å™¨å†…shellè„šæœ¬:</span><br>docker <span class="hljs-built_in">exec</span> web-blog /www/default/start.sh<br></code></pre></td></tr></table></figure><h3 id="5ã€åˆ é™¤å®¹å™¨ï¼ˆåˆ é™¤å®¹å™¨å‰ï¼Œéœ€è¦å…ˆåœæ­¢å®¹å™¨è¿è¡Œï¼‰"><a href="#5ã€åˆ é™¤å®¹å™¨ï¼ˆåˆ é™¤å®¹å™¨å‰ï¼Œéœ€è¦å…ˆåœæ­¢å®¹å™¨è¿è¡Œï¼‰" class="headerlink" title="5ã€åˆ é™¤å®¹å™¨ï¼ˆåˆ é™¤å®¹å™¨å‰ï¼Œéœ€è¦å…ˆåœæ­¢å®¹å™¨è¿è¡Œï¼‰"></a>5ã€åˆ é™¤å®¹å™¨ï¼ˆåˆ é™¤å®¹å™¨å‰ï¼Œéœ€è¦å…ˆåœæ­¢å®¹å™¨è¿è¡Œï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åœæ­¢æŒ‡å®šçš„å®¹å™¨</span><br>docker stop å®¹å™¨ID<br><br><span class="hljs-comment">#åœæ­¢å…¨éƒ¨çš„å®¹å™¨</span><br>docker stop $(docker ps -qa)<br><br><span class="hljs-comment">#åˆ é™¤æŒ‡å®šçš„å®¹å™¨</span><br>docker <span class="hljs-built_in">rm</span> å®¹å™¨<span class="hljs-built_in">id</span><br><br><span class="hljs-comment">#åˆ é™¤å…¨éƒ¨çš„å®¹å™¨</span><br>docker <span class="hljs-built_in">rm</span> $(docker ps -qa)<br></code></pre></td></tr></table></figure><h3 id="6-å¯åŠ¨å®¹å™¨"><a href="#6-å¯åŠ¨å®¹å™¨" class="headerlink" title="6. #å¯åŠ¨å®¹å™¨"></a>6. #å¯åŠ¨å®¹å™¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker start å®¹å™¨ID<br></code></pre></td></tr></table></figure><h3 id="7-dockerå®¹å™¨ä¸­æ–‡ä»¶çš„ä¸Šä¼ ä¸ä¸‹è½½"><a href="#7-dockerå®¹å™¨ä¸­æ–‡ä»¶çš„ä¸Šä¼ ä¸ä¸‹è½½" class="headerlink" title="7. #dockerå®¹å™¨ä¸­æ–‡ä»¶çš„ä¸Šä¼ ä¸ä¸‹è½½"></a>7. #dockerå®¹å™¨ä¸­æ–‡ä»¶çš„ä¸Šä¼ ä¸ä¸‹è½½</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#ä¸Šä¼ æœ¬æœºæ–‡ä»¶åˆ°é•œåƒå†…:</span><br>docker <span class="hljs-built_in">cp</span> /root/test.txt ecef8319d2c8:/root/<br><span class="hljs-comment">#æœ¬æœº/root/test.txt æ–‡ä»¶ä¸Šä¼ åˆ°å®¹å™¨IDä¸ºecef8319d2c8çš„rootç›®å½•</span><br><br><span class="hljs-comment">#ä¸‹è½½å®¹å™¨å†…æ–‡ä»¶åˆ°æœ¬æœºï¼š</span><br>docker <span class="hljs-built_in">cp</span> ecef8319d2c8:/root/test.txt /root/<br><span class="hljs-comment">#å°†å®¹å™¨IDï¼šecef8319d2c8 /root/ç›®å½•ä¸‹çš„test.txtæ–‡ä»¶ä¸‹è½½åˆ°æœ¬æœºçš„rootç›®å½•ä¸‹</span><br><br><span class="hljs-comment">#å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹ï¼š</span><br>docker container <span class="hljs-built_in">cp</span> -a flink_taskmanager_1:/opt/flink/conf/ /app/flink/conf/<br><br></code></pre></td></tr></table></figure><h3 id="8-docker-commitå¯ä»¥å°†å®¹å™¨çš„å­˜å‚¨å±‚ä¿å­˜ä¸‹æ¥æˆä¸ºé•œåƒã€‚"><a href="#8-docker-commitå¯ä»¥å°†å®¹å™¨çš„å­˜å‚¨å±‚ä¿å­˜ä¸‹æ¥æˆä¸ºé•œåƒã€‚" class="headerlink" title="8. docker commitå¯ä»¥å°†å®¹å™¨çš„å­˜å‚¨å±‚ä¿å­˜ä¸‹æ¥æˆä¸ºé•œåƒã€‚"></a>8. docker commitå¯ä»¥å°†å®¹å™¨çš„å­˜å‚¨å±‚ä¿å­˜ä¸‹æ¥æˆä¸ºé•œåƒã€‚</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">æ¢å¥è¯è¯´:åœ¨åŸæœ‰é•œåƒçš„åŸºç¡€ä¸Šï¼Œå†å åŠ ä¸Šå®¹å™¨çš„å­˜å‚¨å±‚ï¼Œå¹¶æ„æˆæ–°çš„é•œåƒã€‚ä»¥åæˆ‘ä»¬è¿è¡Œè¿™ä¸ªæ–°é•œåƒçš„æ—¶å€™ï¼Œå°±ä¼šæ‹¥æœ‰åŸæœ‰å®¹å™¨æœ€åçš„æ–‡ä»¶å˜åŒ–ã€‚ä¸dockerfileä¸€æ ·ï¼Œä½†æ˜¯dockerfileæ›´åŠ æ™ºèƒ½ï¼Œèƒ½é’ˆå¯¹æ¯ä¸€æ­¥è¿›è¡Œè®°å½•ï¼Œå¹¶æ ¹æ®æ¯ä¸€æ­¥å¯ç”Ÿæˆä¸åŒä¾èµ–çš„é•œåƒ</span><br></code></pre></td></tr></table></figure><p>å‚è€ƒåœ°å€ï¼š<a href="https://blog.csdn.net/qq_28723681/article/details/107210775">https://blog.csdn.net/qq_28723681/article/details/107210775</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker commit [é€‰é¡¹] &lt;å®¹å™¨IDæˆ–å®¹å™¨å&gt; [&lt;ä»“åº“å&gt;[:&lt;æ ‡ç­¾&gt;]]<br><br><br>$ docker commit \<br>    --author <span class="hljs-string">&quot;jiangzhenzhou &lt;1962821461@qq.com&gt;&quot;</span> \<br>    --message <span class="hljs-string">&quot;ä¿®æ”¹äº†é»˜è®¤ç½‘é¡µ&quot;</span> \<br>    webserver \<br>    nginx:v2<br><br><span class="hljs-comment">#è¾“å‡ºå¦‚ä¸‹ï¼š</span><br>sha256:07e33465974800ce65751acc279adc6ed2dc5ed4e0838f8b86f0c87aa1795214<br><span class="hljs-comment">#å¯ä»¥åœ¨ docker image ls ä¸­çœ‹åˆ°è¿™ä¸ªæ–°å®šåˆ¶çš„é•œåƒ</span><br><br><br>dockerçš„è¯¦ç»†å®æˆ˜ï¼šhttps://blog.csdn.net/weixin_43062251/article/details/103825065<br></code></pre></td></tr></table></figure><h3 id="9-è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆä»¥mongoä¸¾ä¾‹ï¼‰"><a href="#9-è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆä»¥mongoä¸¾ä¾‹ï¼‰" class="headerlink" title="9. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆä»¥mongoä¸¾ä¾‹ï¼‰"></a>9. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆä»¥mongoä¸¾ä¾‹ï¼‰</h3><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nsis">å½“ä½ å¼€å§‹ mongoé•œåƒï¼Œä½ å¯ä»¥é€šè¿‡ä¼ é€’ä¸€ä¸ªæˆ–å¤šä¸ªç¯å¢ƒå˜é‡æ¥è°ƒæ•´ MongoDB å®ä¾‹çš„åˆå§‹åŒ– docker runå‘½ä»¤è¡Œã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨ä½¿ç”¨å·²ç»åŒ…å«æ•°æ®åº“çš„æ•°æ®ç›®å½•å¯åŠ¨å®¹å™¨ï¼Œåˆ™ä»¥ä¸‹ä»»ä½•å˜é‡éƒ½ä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ï¼šåœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œä»»ä½•é¢„å…ˆå­˜åœ¨çš„æ•°æ®åº“å°†å§‹ç»ˆä¿æŒä¸å˜ã€‚<br>MONGO_INITDB_ROOT_USERNAME, MONGO_INITDB_ROOT_PASSWORD è¿™äº›å˜é‡ç»“åˆä½¿ç”¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·å¹¶è®¾ç½®è¯¥ç”¨æˆ·çš„å¯†ç ã€‚ è¯¥ç”¨æˆ·åˆ›å»ºäº <span class="hljs-literal">admin</span> èº«ä»½éªŒè¯æ•°æ®åº“ å¹¶èµ‹äºˆ è§’è‰² rootï¼Œè¿™æ˜¯ ä¸€ä¸ªâ€œè¶…çº§ç”¨æˆ·â€è§’è‰² ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨è¿™ä¸¤ä¸ªå˜é‡åˆ›å»ºä¸€ä¸ªMongoDBå®ä¾‹ï¼Œç„¶åä½¿ç”¨ mongocli è¿æ¥åˆ° <span class="hljs-literal">admin</span>èº«ä»½éªŒè¯æ•°æ®åº“ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æŸ¥çœ‹å®¹å™¨ä¹‹é—´çš„å†…éƒ¨é€šä¿¡</span><br>docker network <span class="hljs-built_in">ls</span> <br><br><span class="hljs-comment">#docker networkåˆ›å»ºä¸€ä¸ªæ¡¥æ¥ç½‘ç»œï¼Œåœ¨docker runçš„æ—¶å€™å°†å®¹å™¨æŒ‡å®šåˆ°æ–°åˆ›å»ºçš„æ¡¥æ¥ç½‘ç»œä¸­ï¼Œè¿™æ ·åŒä¸€æ¡¥æ¥ç½‘ç»œä¸­çš„å®¹å™¨å°±å¯ä»¥é€šè¿‡äº’ç›¸è®¿é—®ã€‚</span><br>docker network create some-network <br><br><span class="hljs-comment">#åˆ›å»ºmongoå®ä¾‹</span><br>docker run -d --network some-network --name some-mongo \<br>    -e MONGO_INITDB_ROOT_USERNAME=mongoadmin \<br>    -e MONGO_INITDB_ROOT_PASSWORD=secret \<br>    mongo<br><br><span class="hljs-comment">#è¿è¡Œä¸€ä¸ªmongoä¸´æ—¶å®¹å™¨ï¼Œé€€å‡ºåå³æ¸…é™¤</span><br>docker run -it --<span class="hljs-built_in">rm</span> --network some-network mongo \<br>    mongo --host some-mongo \<br>        -u mongoadmin \<br>        -p secret \<br>        --authenticationDatabase admin \<br>        some-db<br><span class="hljs-comment">#æŸ¥çœ‹æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„æ•°æ®åº“    </span><br>&gt; db.getName(); <br><br>æ³¨æ„ï¼š<br>some-mongo æ˜¯å®šä¹‰çš„å®¹å™¨å<br>some-network æ˜¯åˆ›å»ºçš„dockeræ¡¥æ¥ç½‘ç»œ<br>some-db ä½¿ç”¨çš„æ•°æ®åº“<br></code></pre></td></tr></table></figure><h3 id="10-æŸ¥çœ‹dockerè¯¦æƒ…"><a href="#10-æŸ¥çœ‹dockerè¯¦æƒ…" class="headerlink" title="10. æŸ¥çœ‹dockerè¯¦æƒ…"></a>10. æŸ¥çœ‹dockerè¯¦æƒ…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker inspect  01193d2fb1b1   <span class="hljs-comment">#01193d2fb1b1ä»£è¡¨dockerè¿è¡Œçš„é•œåƒid</span><br><br><span class="hljs-comment">#æ ¹æ®é•œåƒç­›é€‰åäº”è¡Œæ•°æ®</span><br>docker inspect  01193d2fb1b1 |grep -A 5 Binds    <br></code></pre></td></tr></table></figure><h3 id="11-æŸ¥çœ‹å®¹å™¨çš„cpuã€å†…å­˜å’ŒPID"><a href="#11-æŸ¥çœ‹å®¹å™¨çš„cpuã€å†…å­˜å’ŒPID" class="headerlink" title="11. æŸ¥çœ‹å®¹å™¨çš„cpuã€å†…å­˜å’ŒPID"></a>11. æŸ¥çœ‹å®¹å™¨çš„cpuã€å†…å­˜å’ŒPID</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker stats --no-stream --format <span class="hljs-string">&quot;table &#123;&#123;.Name&#125;&#125;\t&#123;&#123;.CPUPerc&#125;&#125;\t&#123;&#123;.MemUsage&#125;&#125;\t&#123;&#123;.PIDs&#125;&#125;&quot;</span><br><br></code></pre></td></tr></table></figure><h3 id="12-æŸ¥çœ‹å®¹å™¨å ç”¨ç£ç›˜ç©ºé—´"><a href="#12-æŸ¥çœ‹å®¹å™¨å ç”¨ç£ç›˜ç©ºé—´" class="headerlink" title="12. æŸ¥çœ‹å®¹å™¨å ç”¨ç£ç›˜ç©ºé—´"></a>12. æŸ¥çœ‹å®¹å™¨å ç”¨ç£ç›˜ç©ºé—´</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker ps -a --format <span class="hljs-string">&quot;table &#123;&#123;.Size&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;</span><br><br><span class="hljs-comment">#æŸ¥çœ‹å ç”¨ç©ºé—´çš„PIDï¼Œä»¥åŠå¯¹åº”çš„å®¹å™¨åç§°</span><br>docker ps -q | xargs docker inspect --format <span class="hljs-string">&#x27;&#123;&#123;.State.Pid&#125;&#125;, &#123;&#123;.Name&#125;&#125;, &#123;&#123;.GraphDriver.Data.WorkDir&#125;&#125;&#x27;</span> | grep <span class="hljs-string">&quot;ec3241de83a99bb8a18764142a1194a1b248ea7c53e39447ddf198d5b61b0099&quot;</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>dockeråŸºç¡€ã€å®‰è£…</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerå®‰è£…</title>
    <link href="/2023/03/24/docker/docker%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E8%A3%85/docker%E5%AE%89%E8%A3%85/"/>
    <url>/2023/03/24/docker/docker%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E8%A3%85/docker%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å®‰è£…dockerï¼š"><a href="#å®‰è£…dockerï¼š" class="headerlink" title="å®‰è£…dockerï¼š"></a>å®‰è£…dockerï¼š</h1><h2 id="ä¸€ã€yumåœ¨çº¿å®‰è£…ï¼š"><a href="#ä¸€ã€yumåœ¨çº¿å®‰è£…ï¼š" class="headerlink" title="ä¸€ã€yumåœ¨çº¿å®‰è£…ï¼š"></a>ä¸€ã€yumåœ¨çº¿å®‰è£…ï¼š</h2><p>å®‰è£…æŒ‡å®šç‰ˆå¯å‚è€ƒæ–‡æ¡£ï¼š<a href="https://www.cnblogs.com/lixie0215/p/14804777.html">https://www.cnblogs.com/lixie0215/p/14804777.html</a></p><h3 id="1ã€ä¸‹è½½å…³äºdockerçš„ä¾èµ–ç¯å¢ƒ"><a href="#1ã€ä¸‹è½½å…³äºdockerçš„ä¾èµ–ç¯å¢ƒ" class="headerlink" title="1ã€ä¸‹è½½å…³äºdockerçš„ä¾èµ–ç¯å¢ƒ"></a>1ã€ä¸‹è½½å…³äºdockerçš„ä¾èµ–ç¯å¢ƒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install yum-utils device-mapper-persistent-data lvm2<br><br>å¯ä»¥ä½¿ç”¨è¯¥æ’ä»¶æ›´å¿«ç¼–è¯‘è¡¥é½ä»£ç ï¼š<br><span class="hljs-comment"># yum -y install bash-completion.noarch</span><br>yum -y install bash-completion.noarch net-tools vim lrzsz wget tree screen lsof tcpdump nc telnet unzip <br></code></pre></td></tr></table></figure><h3 id="2ã€è®¾ç½®ä¸€ä¸‹ä¸‹è½½Dockerçš„é•œåƒæº"><a href="#2ã€è®¾ç½®ä¸€ä¸‹ä¸‹è½½Dockerçš„é•œåƒæº" class="headerlink" title="2ã€è®¾ç½®ä¸€ä¸‹ä¸‹è½½Dockerçš„é•œåƒæº"></a>2ã€è®¾ç½®ä¸€ä¸‹ä¸‹è½½Dockerçš„é•œåƒæº</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br><br></code></pre></td></tr></table></figure><h3 id="3-å®‰è£…docker"><a href="#3-å®‰è£…docker" class="headerlink" title="3.å®‰è£…docker"></a>3.å®‰è£…docker</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum makecache fast<br>yum -y install docker-ce<br></code></pre></td></tr></table></figure><h3 id="4ã€å¯åŠ¨dockeræœåŠ¡"><a href="#4ã€å¯åŠ¨dockeræœåŠ¡" class="headerlink" title="4ã€å¯åŠ¨dockeræœåŠ¡"></a>4ã€å¯åŠ¨dockeræœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl start docker<br></code></pre></td></tr></table></figure><h3 id="5-è®¾ç½®å¼€æœºå¯åŠ¨"><a href="#5-è®¾ç½®å¼€æœºå¯åŠ¨" class="headerlink" title="5.è®¾ç½®å¼€æœºå¯åŠ¨"></a>5.è®¾ç½®å¼€æœºå¯åŠ¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl <span class="hljs-built_in">enable</span> docker<br></code></pre></td></tr></table></figure><h3 id="6-æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ"><a href="#6-æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ" class="headerlink" title="6.æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ"></a>6.æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run hello-world<br></code></pre></td></tr></table></figure><h3 id="7-è®¾ç½®dockerä¸­å¤®ä»“åº“"><a href="#7-è®¾ç½®dockerä¸­å¤®ä»“åº“" class="headerlink" title="7.è®¾ç½®dockerä¸­å¤®ä»“åº“"></a>7.è®¾ç½®dockerä¸­å¤®ä»“åº“</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">1ã€Dockerå®˜æ–¹çš„ä¸­å¤®ä»“åº“ï¼šè¿™ä¸ªä»“åº“æ˜¯é•œåƒæœ€å…¨çš„ï¼Œä½†æ˜¯ä¸‹è½½é€Ÿåº¦å¾ˆæ…¢ã€‚https://hub.docker.com<br><br>2ã€å›½å†…çš„é•œåƒç½‘ç«™ï¼š<br>https://c.163yun.com/hub<span class="hljs-comment">#/home</span><br>http://hub.daocloud.io <span class="hljs-comment">#(æ¨èä½¿ç”¨)</span><br><br>3ã€åœ¨å…¬å¸å†…éƒ¨ä¼šé‡‡ç”¨ç§æœçš„æ–¹å¼æ‹‰å–é•œåƒã€‚ï¼ˆæ·»åŠ é…ç½®ï¼‰<br>éœ€è¦åœ¨/etc/docker/daemon.jsonä¸­ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œéœ€è¦å¢åŠ <br>&#123;<br><span class="hljs-string">&quot;registry-mirrors&quot;</span>:[<span class="hljs-string">&quot;https://registry.docker-cn.com&quot;</span>],<br>    <span class="hljs-string">&quot;insecure-registries&quot;</span>:[<span class="hljs-string">&quot;ip:port&quot;</span>]<br>    <span class="hljs-comment">#&quot;graph&quot;: &quot;/app&quot;  å­˜æ”¾è·¯å¾„</span><br>&#125;<br><br>4ã€é‡å¯ä¸¤ä¸ªæœåŠ¡<br>systemctl daemon-reload<br>systemctl restart docker<br></code></pre></td></tr></table></figure><h2 id="äºŒã€äºŒè¿›åˆ¶å®‰è£…"><a href="#äºŒã€äºŒè¿›åˆ¶å®‰è£…" class="headerlink" title="äºŒã€äºŒè¿›åˆ¶å®‰è£…"></a>äºŒã€äºŒè¿›åˆ¶å®‰è£…</h2><p>å‚è€ƒæ–‡çŒ®ï¼š<a href="https://blog.csdn.net/gzt19881123/article/details/109454467">https://blog.csdn.net/gzt19881123/article/details/109454467</a></p><h3 id="1-ä¸‹è½½dockeräºŒè¿›åˆ¶ç‰ˆæœ¬"><a href="#1-ä¸‹è½½dockeräºŒè¿›åˆ¶ç‰ˆæœ¬" class="headerlink" title="1. ä¸‹è½½dockeräºŒè¿›åˆ¶ç‰ˆæœ¬"></a>1. ä¸‹è½½dockeräºŒè¿›åˆ¶ç‰ˆæœ¬</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¯·é€‰æ‹©æœ€æ–°æœ€ç¨³å®šçš„CEç‰ˆæœ¬</span><br>https://download.docker.com/linux/static/stable/x86_64/<br><br>ä¾‹å¦‚ ï¼šä¸‹è½½ç‰ˆæœ¬ä¸º18.06.3-ceçš„dockeräºŒè¿›åˆ¶å‹ç¼©åŒ…åˆ° /tmpç›®å½•ä¸‹ï¼š<br>wget  https://download.docker.com/linux/static/stable/x86_64/docker-18.06.3-ce.tgz<br></code></pre></td></tr></table></figure><h3 id="2-è§£å‹å‡ºäºŒè¿›åˆ¶æ–‡ä»¶"><a href="#2-è§£å‹å‡ºäºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="2. è§£å‹å‡ºäºŒè¿›åˆ¶æ–‡ä»¶"></a>2. è§£å‹å‡ºäºŒè¿›åˆ¶æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">è§£å‹å‡ºçš„ä¸€ä¸ªæ–‡ä»¶ç›®å½•ä¸º docker/<br><br>[root@localhost tmp]<span class="hljs-comment"># tar -xvf docker-18.06.3-ce.tgz</span><br>[root@localhost tmp]<span class="hljs-comment"># ls</span><br>docker  docker-18.06.3-ce.tgz<br></code></pre></td></tr></table></figure><h3 id="3-å¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶åˆ°-x2F-usr-x2F-binç›®å½•ä¸‹"><a href="#3-å¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶åˆ°-x2F-usr-x2F-binç›®å½•ä¸‹" class="headerlink" title="3. å¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶åˆ°&#x2F;usr&#x2F;binç›®å½•ä¸‹"></a>3. å¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶åˆ°&#x2F;usr&#x2F;binç›®å½•ä¸‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@localhost tmp]<span class="hljs-comment"># cp docker/* /usr/bin/</span><br><br>æ£€æŸ¥dockerå‘½ä»¤æ˜¯å¦å¯ç”¨<br>[root@localhost tmp]<span class="hljs-comment"># docker --version</span><br>Docker version 18.06.3-ce, build d7080c1<br></code></pre></td></tr></table></figure><h3 id="4-é…ç½®systemctl-å¯åŠ¨å‘½ä»¤å¹¶è®¾ç½®å¼€æœºå¯åŠ¨"><a href="#4-é…ç½®systemctl-å¯åŠ¨å‘½ä»¤å¹¶è®¾ç½®å¼€æœºå¯åŠ¨" class="headerlink" title="4. é…ç½®systemctl å¯åŠ¨å‘½ä»¤å¹¶è®¾ç½®å¼€æœºå¯åŠ¨"></a>4. é…ç½®systemctl å¯åŠ¨å‘½ä»¤å¹¶è®¾ç½®å¼€æœºå¯åŠ¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh">ä»¥ä¸Šæ­¥éª¤å®‰è£…æˆåŠŸåï¼Œshellå‘½ä»¤è¡Œä¸‹ sudo dockerd &amp; å³å¯å¯åŠ¨dockerï¼Œä½†ä¸€èˆ¬æˆ‘ä»¬é‡‡ç”¨ systemctlæ–¹å¼å¯åŠ¨dockeræœåŠ¡å¹¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼Œæ‰€ä»¥åˆ›å»º /usr/lib/systemd/system/docker.service æ–‡ä»¶<br><br>vim /usr/lib/systemd/system/docker.service<br><span class="hljs-comment">#å¹¶ä¸”åœ¨æ–‡ä»¶é‡Œé¢è®¾ç½®å¦‚ä¸‹å†…å®¹ï¼š</span><br><br>[Unit]<br>Description=Docker Application Container Engine<br>Documentation=https://docs.docker.com<br>After=network-online.target firewalld.service<br>Wants=network-online.target<br><br>[Service]<br>Type=notify<br>ExecStart=/usr/bin/dockerd<br>ExecReload=/bin/kill -s HUP <span class="hljs-variable">$MAINPID</span><br>LimitNOFILE=infinity<br>LimitNPROC=infinity<br>TimeoutStartSec=0<br>Delegate=<span class="hljs-built_in">yes</span><br>KillMode=process<br>Restart=on-failure<br>StartLimitBurst=3<br>StartLimitInterval=60s<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><h3 id="5-é‡‡ç”¨-systemctl-è®¾ç½®è‡ªåŠ¨é‡å¯"><a href="#5-é‡‡ç”¨-systemctl-è®¾ç½®è‡ªåŠ¨é‡å¯" class="headerlink" title="5. é‡‡ç”¨ systemctl è®¾ç½®è‡ªåŠ¨é‡å¯"></a>5. é‡‡ç”¨ systemctl è®¾ç½®è‡ªåŠ¨é‡å¯</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl daemon-reload<br>systemctl start docker.service<br><br><span class="hljs-comment"># --------------è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨-------------------</span><br>systemctl <span class="hljs-built_in">enable</span> docker<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
      <category>dockeråŸºç¡€ã€å®‰è£…</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
